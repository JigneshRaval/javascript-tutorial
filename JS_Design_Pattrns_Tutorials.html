<html>
	<head>
	<title>JS Design Patterns : 1</title>
		<style>
* { box-sizing: border-box; }
body { 
	font-family: 'Open Sans', Arial, sans-serif;
	font-size: 14px;
	line-height: 1.7;
	padding: 0.5em;
	font-family: 'PT Sans', Arial, sans-serif;
	
}
h1 { font-size: 1.6em; font-family: 'PT Serif', Arial, serif; padding: 10px 0; margin: 0; }
h2, h3, h6 { 
	font-size: 1.3em;
	font-family: 'PT Serif', Arial, serif;
	padding-left: 1em;
	border-left: 2px solid #868686; 
}
img { display: block; margin: 0 auto; max-width: 100%; }
pre { 
	border: 1px dashed #333; 
	padding: 1em 2em; 
	font-family: Consolas,monospace; 
	background-color: #EEE; 
	overflow-x: scroll; 
	font-size: 14px;  
	white-space: pre-wrap; 
	word-wrap: break-word; 
}
pre {
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    margin: 1em auto;
    border: 1px dashed #333;
    width: 100%;
    padding: 1em 1.5em;
    font-family: Inconsolata, Consolas, monospace, sans-serif;
    font-size: 1em;
	line-height: 1.5;
    overflow: auto;
    background: #F7FAFB;
    border-radius: 3px;
	position:relative;
}
code { 
	background-color: #EEE;
    font-family: Consolas,monospace;
    border: solid 1px #CCC;
    padding: 3px;
    border-radius: 3px;
    display: inline-block;
    font-size: 14px;
}
pre code { background-color: transparent; padding: 0; display: block; border: 0px solid; }
pre:after {
	content: "<CODE>";
	position: absolute;
	top:0;
	right: 0;
	padding: 5px 15px;
	background: #999;
	color: #FFF;
}

.home-screen { border: 1px solid #777; padding: 4em 0; }
.home-screen * { font-family: 'PT Sans', Arial, sans-serif; font-size: 3em; font-weight: normal; }

/* = Index
-------------------------------*/
.tutorial-index {
	counter-reset: section;
}
.tutorial-index h1:before {
    counter-increment: section;
    content: counter(section) " : ";
}
.tutorial-index h1 {font-size: 1.2em; padding: 5px 0; font-family: 'Open Sans', Arial, sans-serif; line-height: normal;}
.tutorial-index a { display: block; float: left; width: 50%;}
.tutorial-index a { text-decoration: none; }


/* = Main
-------------------------------*/
.main { counter-reset: mainsection; }
.main h1 { font-size: 1.6em; border-bottom: 2px solid #000; font-family: 'PT Serif', Arial, serif; padding: 10px 0; margin: 0; }
.main h1:before {
    /*counter-increment: mainsection;
    content: counter(mainsection) " : ";
	*/
}

/* = ClearFix
-------------------------------*/
.cf:before,
.cf:after {
    content: " ";
    display: table;
}
.cf:after {
    clear: both;
}
.tc { text-align: center}

/* = TABLE
-------------------------------*/
table { width: 100%; max-width: 100%; margin: 1em 0; border-collapse: collapse;}
table td, table th { border: 1px solid #cdcfd0; padding: 10px;}
table th { border-bottom-width: 2px; background-color: #e8e9ea; }
table tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}
@media print {
    .main article h1 { 
		page-break-before: always; 
	}
	pre, code, pre code, pre span, code span, pre code span {
		/*page-break-inside: avoid;
		-webkit-column-break-inside : avoid;*/
	}
}
		</style>
	</head>
	
	
<body>
			<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<article>
        <h1>JavaScript Design Patterns</h1>
        <div class="date">Posted on: August 22, 2013</div>
        <blockquote>"One of the most important aspects of writing maintainable code is being able to notice the recurring themes in that code and optimize them. This is an area where knowledge of design patterns can prove invaluable." - Addy Osmani</blockquote>
<p>In modern day JavaScript, it's easy to pursue the development of large scale JavaScript applications. We are constantly writing more and more complex web apps that thrive on the latest frameworks and libraries. It's easy for a developer to use four or more libraries in one project. Often though, we tend to overlook some of the core principles involved in the creation of these libraries. </p>
<p>It's important to understand the significance of how and why your favorite libraries are written the way they are.</p>
<p>Having structured, reusable code makes for an easily maintainable code base that helps us to prevent repeating ourselves. JavaScript design patterns don't solve every design problem but they do, however, provide a clear approach that provides stability and in some cases security, for our web apps.</p>
<h2>Why are design patterns important?</h2>
<p>Design patterns are established ways of programming that help you facilitate scalable, easily maintainable and highly decoupled code, all of which are extremely important concepts when engineering large JavaScript applications. When a design pattern is implemented correctly, it makes the code base easier for others to grok. Having an established pattern in play helps to keep your code clean and promotes a declarative method for you and your team to follow.</p>
<blockquote>"The implementation of a design pattern per day keeps the angry developer away." - Old Chinese proverb</blockquote>
<p>Let's take a look at some reasons as to why design patterns are extremely useful.</p>
<ul>  
<li>Patterns are an easy way to refer to a very specific implementation of code while avoiding the additional discussion it would take to get everyone on the same page if the vocabulary used for patterns didn't exist.</li>  
<li>Patterns can help to thwart minor issues that can create major problems later down the road.</li>  
<li>Patterns exemplify a level of sophistication that can provide both performance boosts and reduction of excess memory usage.</li>  
<li>Patterns are established through rigorous testing which means they are, for the most part, "tried and true" and do aid in solving a particular type of problem.</li>  
</ul>
<h2>Categories of Design Patterns</h2>
<p>There are numerous ways we can categorize all of the design patterns but for the sake of brevity, the three most popular are: <a href="#creational-design-patterns">creational</a>, <a href="#structural-design-patterns">structural</a> &amp; <a href="behavioral-design-patterns">behavioral</a>. Creational focuses on object creation (imagine that). Structural focuses on object composition. Behavioral focuses on communication between objects. While no single implementation of these types of design patterns are perfect, it's important to understand that being familiar with all of them can educate you to make an informed decision based on the needs of your application. Take some time to review the following tables as they summarize the methods that each design pattern implements.</p>
<h3 id="creational-design-patterns"><a href="#creational-design-patterns">#</a> Creational Design Patterns</h3>
<p>Creational design patterns deal directly with object initialization procedures focusing on the creation of situation-specific objects. Without thinking about how objects are created, a level of complexity can be added to the design of an application. Creational design patterns work to solve this problem by adding a layer to the object creation process.</p>
<center> <br>
<img src="/content/images/2015/03/creational-pattern-types.jpg" alt="">
</center>
<p><small style="padding: 0 0 0 10px;"><i>Image Credit: <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#summarytabledesignpatterns">http://addyosmani.com/resources/essentialjsdesignpatterns/book/#summarytabledesignpatterns</a></i></small></p>
<h3 id="structural-design-patterns"><a href="#structural-design-patterns">#</a> Structural Design Patterns</h3>
<p>Structural design patterns are ones that focus on easing the relationship between different components of an application. They help to provide stability by ensuring that if one part of the app changes, the entire thing doesn't need to as well.</p>
<center> <br>
<img src="/content/images/2015/03/structural-pattern-types.jpg" alt="">
</center>
<p><small style="padding: 0 0 0 10px;"><i>Image Credit: <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#summarytabledesignpatterns">http://addyosmani.com/resources/essentialjsdesignpatterns/book/#summarytabledesignpatterns</a></i></small></p>
<h3 id="behavioral-design-patterns"><a href="#behavioral-design-patterns">#</a> Behavioral Design Patterns</h3>
<p>Behavioral design patterns emphasize flexibility through the identification of common communication patterns between various objects.</p>
<center> <br>
<img src="/content/images/2015/03/behavioral-pattern-types.jpg" alt="">
</center>
<p><small style="padding: 0 0 0 10px;"><i>Image Credit: <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#summarytabledesignpatterns">http://addyosmani.com/resources/essentialjsdesignpatterns/book/#summarytabledesignpatterns</a></i></small></p>
<p>If you've made it this far, you should have a pretty basic understanding of the different design patterns and what they do. Please feel free to refer back to these tables at any time as a point of reference; they're perfect for jogging your memory on a slow Monday morning.</p>
<h2>Modern Day JavaScript Design Patterns</h2>
<p>Below is a list of each JavaScript design pattern I've had the opportunity to write about with breakdowns on various aspects of that pattern such as their advantages and disadvantages. Browse away!</p>
<p><a href="http://carldanley.com/js-module-pattern/">The Module Pattern</a> <br>
<a href="http://carldanley.com/js-revealing-module-pattern/">The Revealing Module Pattern</a> <br>
<a href="http://carldanley.com/js-singleton-pattern/">The Singleton Pattern</a> <br>
<a href="http://carldanley.com/js-observer-pattern/">The Observer Pattern</a> <br>
<a href="http://carldanley.com/js-mediator-pattern/">The Mediator Pattern</a> <br>
<a href="http://carldanley.com/js-prototype-pattern/">The Prototype Pattern</a> <br>
<a href="http://carldanley.com/js-facade-pattern/">The Facade Pattern</a> <br>
<a href="http://carldanley.com/js-factory-pattern/">The Factory Pattern</a></p>
<h2>Closing Thoughts</h2>
<p>The idea behind this article, and the individual pattern articles listed above, originated from my hopes to thoroughly understand modern day JavaScript design patterns. Thanks to <a href="https://twitter.com/addyosmani">Addy Osmani</a> (and the others involved) for writing the book "Learning JavaScript Design Patterns" which has vastly improved my understanding (and opinions) of the many design pattern implementations. If you have any questions, please feel free to drop a comment as I would be happy to help wherever I can.</p>
<p>I mentioned this before but I feel like it's worth mentioning again as a conclusive note: there is no one design pattern that is perfect but rather the use of multiple design patterns can help to facilitate a better approach to the web applications you write.</p>
<blockquote>"You have your way. I have my way. As for the right way, the correct way, and the only way, it does not exist." - Friedrich Nietzsche</blockquote>
</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<article>
        <h1>The Module Pattern</h1>
        <p>This pattern is used to mimic classes in conventional software engineering and focuses on public and private access to methods &amp; variables. The module pattern strives to improve the reduction of globally scoped variables, thus decreasing the chances of collision with other code throughout an application.</p>
<p>The module pattern is, by far, the most commonly used design pattern and widely accepted in a number of large projects such as <a href="http://jquery.com/">jQuery</a>, <a href="http://dojotoolkit.org/">Dojo</a>, <a href="http://www.sencha.com/products/extjs">ExtJS</a> and <a href="http://yuilibrary.com/">YUI</a>.</p>
<blockquote>"I'm currently in the process of writing a large-scale JavaScript application based on this pattern, and I have to say, it's a delight." <br>- Brian Cray</blockquote> 
<p>This article is part of a series called <a href="http://carldanley.com/javascript-design-patterns/">JavaScript Design Patterns</a>.</p>
<h2>Advantages</h2>  
<ul>  
<li>Cleaner approach for developers</li>  
<li>Supports private data</li>  
<li>Less clutter in the global namespace</li>  
<li>Localization of functions and variables through closures</li>  
</ul>
<h2>Disadvantages</h2>  
<ul>  
<li>Private methods are unaccessible.<p style="margin: 10px 0 0 0; font-style: italic;">Some people say that this leads to the inability of unit testing but more often than not, if you're questioning the integrity of a function, it should probably be engineered in such a fashion that exposes the utility of that function publicly, thus making it testable. Given the adaptation of the module pattern by jQuery and their everyday use of QUnit to automate testing, this bullet point isn't really relevant but still listed for documentation purposes.</p></li>  
<li>Private methods and functions lose extendability since they are unaccessible (see my comment in the previous bullet point).</li>  
</ul>
<h2>Example</h2>
<script async="" src="//www.google-analytics.com/analytics.js"></script><script src="https://gist.github.com/carldanley/5da969fbbe2ba3f060da.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>( function( window, undefined ) {
  
  // normally variables &amp; functions start with a lowercase letter but with modules, that is not the case.
  // The general tradition is to start them with a capital letter instead.
  function MyModule() {
    
    // `this` refers to the instance of `MyModule` when created
    this.myMethod = function myMethod() {
      alert( 'my method' );
    };
    
    // note that we still use a function declaration even when using a function expression.
    // for more information on why, check out: http://kangax.github.io/nfe/
    this.myOtherMethod = function myOtherMethod() {
      alert( 'my other method' );
    };
    
  }
  
  // expose access to the constructor
  window.MyModule = MyModule;
  
} )( window );

// example usage
var myModule = new MyModule();
myModule.myMethod(); // alerts "my method"
myModule.myOtherMethod(); // alerts "my other method"
view rawmodule-pattern-example-1.js hosted with â¤ by GitHub
</code></pre>
<p>Another example of the module pattern that exposes the module a little differently and makes use of a shared private cache. This method encourages more of an object creation approach where we can optimize performance by being efficient with shared storage.</p>
<script src="https://gist.github.com/carldanley/8453d2d1f910daa1b3dc.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>var MyModule = ( function( window, undefined ) {

  // this object is used to store private variables and methods across multiple instantiations
  var privates = {};
  
  function MyModule() {
    
    this.myMethod = function myMethod() {
      alert( 'my method' );
    };

    this.myOtherMethod = function myOtherMethod() {
      alert( 'my other method' );
    };

  }

  return MyModule;
  
} )( window );

// example usage
var myMod = new MyModule();
myMod.myMethod(); // alerts "my method"
myMod.myOtherMethod(); // alerts "my other method"
</code></pre>
</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<article>
        <h1>The Revealing Module Pattern</h1>
        <p>This pattern is the same concept as the <a href="http://carldanley.com/js-module-pattern/">module pattern</a> in that it focuses on public &amp; private methods. The only difference is that the revealing module pattern was engineered as a way to ensure that all methods and variables are kept private until they are explicitly exposed; usually through an object literal returned by the closure from which it's defined. Personally, I like this approach for vanilla JavaScript as it puts a clear emphasis on both the intent of the developer and the module itself.</p>
<blockquote>"I've used this pattern on projects ranging from 100 to 100,000 lines of code." - Bob Holt</blockquote>
<p>This article is part of a series called <a href="http://carldanley.com/javascript-design-patterns/">JavaScript Design Patterns</a>.</p>
<h2>Advantages</h2>
<ul>  
<li>Cleaner approach for developers</li>  
<li>Supports private data</li>  
<li>Less clutter in the global namespace</li>  
<li>Localization of functions and variables through closures</li>  
<li>The syntax of our scripts are even more consistent</li>  
<li>Explicitly defined public methods and variables which lead to increased readability</li>  
</ul>
<h2>Disadvantages</h2>
<ul>  
<li>Private methods are unaccessible.<em style="display: block; margin: 20px 0;">Some people say that this leads to the inability of unit testing but more often than not, if you're questioning the integrity of a function, it should probably be engineered in such a fashion that exposes the utility of that function publicly, thus making it testable. Given the adaptation of the module pattern by jQuery and their everyday use of QUnit to automate testing, this bullet point isn't really relevant but still listed for documentation purposes.</em></li>  
<li>Private methods and functions lose extendability since they are unaccessible (see my comment in the previous bullet point).</li>  
<li>It's harder to patch public methods and variables that are referred to by something private.</li>  
</ul>
<h2>Example</h2>
<script async="" src="//www.google-analytics.com/analytics.js"></script><script src="https://gist.github.com/carldanley/ef95b006eaa08761b0ca.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>var MyModule = ( function( window, undefined ) {
  
  function myMethod() {
    alert( 'my method' );
  }
  
  function myOtherMethod() {
    alert( 'my other method' );
  }
  
  // explicitly return public methods when this object is instantiated
  return {
    someMethod : myMethod,
    someOtherMethod : myOtherMethod
  };
  
} )( window );

//  example usage
MyModule.myMethod(); // undefined
MyModule.myOtherMethod(); // undefined
MyModule.someMethod(); // alerts "my method"
MyModule.someOtherMethod(); // alerts "my other method"
view rawrevealing-module-pattern-example.js hosted with â¤ by GitHub
</code></pre>
<p>This pattern can also be implemented using a privately shared cache (see <a href="http://carldanley.com/js-module-pattern/#file-module-pattern-example-2-js-L1">Example 2</a> of the <a href="http://carldanley.com/js-module-pattern/">module pattern</a> for an example.)</p>
</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<article>
        <h1>The Singleton Pattern</h1>
        <p>This pattern restricts instantiation of an object to a single reference thus reducing its memory footprint and allowing a "delayed" initialization on an as-needed basis. This isn't too common amongst JavaScript projects today but more common in WordPress (see Eric Mann's in-depth article <a href="http://eamann.com/tech/the-case-for-singletons/">here</a>).</p>
<p>This article is part of a series called <a href="http://carldanley.com/javascript-design-patterns/">JavaScript Design Patterns</a>.</p>
<h2>Advantages</h2>
<ul>  
<li>Reduced memory footprint</li>  
<li>Single point of access</li>  
<li>Delayed initialization that prevents instantiation until required</li>  
</ul>
<h2>Disadvantages</h2>
<ul>  
<li>Once instantiated, they're hardly ever "reset"</li>  
<li>Harder to unit test and sometimes introduces hidden dependencies</li>  
</ul>
<h2>Example</h2>
<script async="" src="//www.google-analytics.com/analytics.js"></script><script src="https://gist.github.com/carldanley/6ac14bb0766e8bd146c5.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>var mySingleton = ( function( window, undefined ) {
  
  var instance = null;
  
  // revealing module pattern that handles initialization of our new module
  function initializeNewModule() {
    
    function myMethod() {
      alert( 'my method' );
    }
    
    function myOtherMethod() {
      alert( 'my other method' );
    }
    
    return {
      someMethod : myMethod,
      someOtherMethod : myOtherMethod
    };
    
  }
  
  // handles the prevention of additional instantiations
  function getInstance() {
    if( ! instance ) {
      instance = new initializeNewModule();
    }
    return instance;
  }
  
  return {
    getInstance : getInstance
  };
  
} )( window );

// example usage
mySingleton.getInstance().someMethod(); // alerts "my method"
mySingleton.getInstance().someOtherMethod(); // alerts "my other method"
view rawsingleton-pattern-example.js hosted with â¤ by GitHub
</code></pre>
</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>Singleton</h1>
		<div style="padding: 10px 0 0 30px;">
                    <h3>Definition</h3>
                    <div style="width:80%;padding:6px 0;">
                        Ensure a class has only one instance and provide a global point of access to it.
                    </div>
                    <br>
                    <div class="clearfix">
                        <div class="pull-left" style="padding:5px 20px 0 0;">Frequency of use (<i>in JavaScript</i>):</div>
                        <div class="pull-left"><img src="/images/use_high.gif"></div>
                        <div class="pull-left" style="padding:5px 0px 0 15px;">high</div>
                    </div>
                    <div style="width:90%;">
<h3 class="phead">Summary</h3>
<p class="ptext">
    The Singleton Pattern limits the number of instances of a particular object to just one.  This single instance is called the singleton.
</p>
<p class="ptext">
    Singletons are useful in situations where system-wide actions need to be coordinated from a single central place.
    An example is a database connection pool.
    The pool manages the creation, destruction, and lifetime of all database connections for the entire application ensuring that no connections are 'lost'.
</p>
<p class="ptext">
    Singletons reduce the need for global variables which is particularly important in JavaScript because it limits namespace
    pollution and associated risk of name collisions.
    The Module pattern (see our <a href="/products/javascript-jquery-design-pattern-framework">JavaScript + jQuery Design Pattern Framework</a>)
    is JavaScript's manifestation of the Singleton pattern.
</p>
<p class="ptext">
    Several other patterns, such as, Factory, Prototype, and FaÃ§ade are frequently implemented as Singletons when only one instance is needed.
</p>
<br>
<h3 class="phead">Diagram</h3>
<div style="padding-left:30px;">
    <img class="diagram" src="/images/diagrams/javascript/javascript-singleton.jpg" alt="Diagram JavaScript Singleton  Design Pattern">
</div>
<br>
<br>
<h3 class="phead">Participants</h3>
<div class="ptext">
    The objects participating in this pattern are:<br><br>
    <ul>
        <li>
            <b>Singleton</b> -- In sample code: <b style="color:#088;">Singleton</b>
            <ul>
                <li>defines getInstance() which returns the unique instance.</li>
                <li>responsible for creating and managing the instance object.</li>
            </ul>
        </li>
    </ul>
</div>
<br>
<h3 class="phead">Sample code in JavaScript</h3>
<p class="ptext">
    The <span class="cd">Singleton</span> object is implemented as an <i>immediate anonymous function</i>.
    The function executes immediately by wrapping it in brackets followed by two additional brackets.
    It is called anonymous because it doesn't have a name.
</p>
<p class="ptext">
    The <span class="cd">getInstance</span> method is Singleton's gatekeeper. It returns the one and only instance of the object
    while maintaining a private reference to it which is not accessible to the outside world.
</p>
<p class="ptext">
    The <span class="cd">getInstance</span> method demonstates another design pattern called Lazy Load.
    Lazy Load checks if an instance has already been created; if not, it creates one and
    stores it for future reference. All subsequent calls will receive the stored instance.
    Lazy loading is a CPU and memory saving technique by creating objects only when absolutely necessary.
</p>
<p class="ptext">
    Singleton is a manifestation of a common JavaScript pattern: the Module pattern.
    Module is the basis to all popular JavaScript libraries and frameworks (jQuery, Backbone, Ember, etc.).
    To learn how to benefit from Module, Lazy Load and many other JavaScript patterns in your own projects, check out our
    unique <a href="/products/javascript-jquery-design-pattern-framework">JavaScript + jQuery Design Pattern Framework</a>.
</p>
<pre class="prettyprint linenums run"><ol class="linenums"><li class="L0"><span class="kwd">var</span><span class="pln"> </span><span class="typ">Singleton</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> instance</span><span class="pun">;</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pln">    </span><span class="kwd">function</span><span class="pln"> createInstance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L4"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">(</span><span class="str">"I am the instance"</span><span class="pun">);</span></li><li class="L5"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">;</span></li><li class="L6"><span class="pln">    </span><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span></li><li class="L9"><span class="pln">        getInstance</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">instance</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">                instance </span><span class="pun">=</span><span class="pln"> createInstance</span><span class="pun">();</span></li><li class="L2"><span class="pln">            </span><span class="pun">}</span></li><li class="L3"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> instance</span><span class="pun">;</span></li><li class="L4"><span class="pln">        </span><span class="pun">}</span></li><li class="L5"><span class="pln">    </span><span class="pun">};</span></li><li class="L6"><span class="pun">})();</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="kwd">function</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> instance1 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Singleton</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">();</span></li><li class="L1"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> instance2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Singleton</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">();</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pln">    alert</span><span class="pun">(</span><span class="str">"Same instance? "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">instance1 </span><span class="pun">===</span><span class="pln"> instance2</span><span class="pun">));</span><span class="pln">  </span></li><li class="L4"><span class="pun">}</span></li></ol></pre>
<a class="btn btn-brown" href="javascript:void(0);" onclick="run();return false">Run</a>
                    </div>
                </div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<article>
        <h1>The Observer Pattern</h1>
        <p>This pattern implements a single object (the subject) that maintains a reference to a collection of objects (known as "observers") and broadcasts notifications when a change to state occurs. When we don't want to observe an object, we simply remove it from the collection of objects being observed. The observer pattern is similar to both the pub/sub implementation and the <a href="http://carldanley.com/js-mediator-pattern/">mediator pattern</a> but still different in purpose &amp; theory and worth mentioning. Study the example below for a good idea of what's happening behind the scenes.</p>

<p>This article is part of a series called <a href="http://carldanley.com/javascript-design-patterns/">JavaScript Design Patterns</a>.</p>

<h2>Advantages</h2>

<ul>  
<li>Requires deeper-level thinking of the relationship between the various components of an application</li>  
<li>Helps us pinpoint dependencies</li>  
<li>Excellent at decoupling objects which often promotes smaller, reusable components</li>  
</ul>

<h2>Disadvantages</h2>

<ul>  
<li>Checking the integrity of your application can become difficult</li>  
<li>Switching a subscriber from one publisher to another can be costly</li>  
</ul>

<h2>Example</h2>

<script async="" src="//www.google-analytics.com/analytics.js"></script><script src="https://gist.github.com/carldanley/3a382adec88b9d035b94.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>// build the Subject base class
var Subject = ( function( window, undefined ) {

  function Subject() {
    this._list = [];
  }

  // this method will handle adding observers to the internal list
  Subject.prototype.observe = function observeObject( obj ) {
    console.log( 'added new observer' );
    this._list.push( obj );
  };
  
  Subject.prototype.unobserve = function unobserveObject( obj ) {
    for( var i = 0, len = this._list.length; i &lt; len; i++ ) {
      if( this._list[ i ] === obj ) {
        this._list.splice( i, 1 );
        console.log( 'removed existing observer' );
        return true;
      }
    }
    return false;
  };
  
  Subject.prototype.notify = function notifyObservers() {
    var args = Array.prototype.slice.call( arguments, 0 );
    for( var i = 0, len = this._list.length; i &lt; len; i++ ) {
      this._list[ i ].update.apply( null, args );
    }
  };

  return Subject;

} )( window );

// setup an object that fetchs stocks
function StockGrabber() {
  
  var subject = new Subject();
  
  this.addObserver = function addObserver( newObserver ) {
    subject.observe( newObserver );
  };
  
  this.removeObserver = function removeObserver( deleteObserver ) {
    subject.unobserve( deleteObserver );
  };
  
  this.fetchStocks = function fetchStocks() {
    // fake fetching the stocks
    var stocks = {
      aapl : 167.00,
      goog : 243.67,
      msft : 99.34
    };
    
    // notify our observers of the stock change
    subject.notify( stocks );
  };
  
}

// define a couple of different observers
var StockUpdaterComponent = {
  update : function() {
    console.log( '"update" called on StockUpdater with: ', arguments );
  }
};
var StockChartsComponent = {
  update : function() {
    console.log( '"update" called on StockCharts with: ', arguments );
  }
};

// example usage
var stockApp = new StockGrabber();
stockApp.addObserver( StockUpdaterComponent );
stockApp.fetchStocks(); // console logs: "update" called on StockUpdater with...
stockApp.addObserver( StockChartsComponent );
stockApp.fetchStocks(); // console logs: "update" called on StockUpdater with... "update" called on StockCarts with...
stockApp.removeObserver( StockUpdaterComponent );
stockApp.fetchStocks(); // console logs: "update" called on StockCharts with...
stockApp.removeObserver( StockChartsComponent );
stockApp.fetchStocks(); // does nothing; no observers
view rawobserver-pattern-example.js hosted with â¤ by GitHub
</code></pre>


<p>In the example above, the <code>Subject</code> object becomes a base class from which we build an example stock tracking application. You can see that the <code>StockGrabber</code> object uses the <code>Subject</code> object internally to handle notifications to other components of the application such as the <code>StockUpdaterComponent</code> and the <code>StockChartsComponent</code>.</p>

</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<article>
        <h1>The Mediator Pattern</h1>
        <p>The American Heritage dictionary defines the word <a href="http://www.thefreedictionary.com/mediator">mediator</a> as <i>"one that mediates, especially one that reconciles differences between disputants."</i> In this manner, the mediator pattern usually implements a single object that becomes a shared resource through all of the different pieces of an application. It's a higher-level version of pub/sub in that it's commonly used to communicate across the different features of an application in contrast to being used within one feature to communicate with all of the individual pieces of that same feature.</p>

<blockquote>"Understanding the similarities and differences between an event aggregator and mediator is important for semantic reasons." <br>- Derick Bailey</blockquote>

<p>This article is part of a series called <a href="http://carldanley.com/javascript-design-patterns/">JavaScript Design Patterns</a>.</p>

<h2>Advantages</h2>

<ul>  
<li>Reduces the communication relationship from "many-to-many" to "many-to-one"</li>  
<li>Helps us pinpoint dependencies</li>  
<li>Excellent at decoupling objects which often promotes smaller, reusable components</li>  
</ul>

<h2>Disadvantages</h2>

<ul>  
<li>Introduces a single point of failure</li>  
<li>When modules communicate back and forth using a mediator pattern, it tends to become cumbersome and usually results in a clear performance hit. It's best when the mediator is only used to coordinate actions across multiple features and not for communication within the individual features themselves; keep the airways clean!</li>  
</ul>

<h2>Example</h2>

<script async="" src="//www.google-analytics.com/analytics.js"></script><script src="https://gist.github.com/carldanley/e5854fe87bfd607ad96c.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>var Mediator = ( function( window, undefined ) {

	function Mediator() {
		this._topics = {};
	}

	Mediator.prototype.subscribe = function mediatorSubscribe( topic, callback ) {
		if( ! this._topics.hasOwnProperty( topic ) ) {
			this._topics[ topic ] = [];
		}

		this._topics[ topic ].push( callback );
		return true;
	};

	Mediator.prototype.unsubscribe = function mediatorUnsubscrive( topic, callback ) {
		if( ! this._topics.hasOwnProperty( topic ) ) {
			return false;
		}

		for( var i = 0, len = this._topics[ topic ].length; i &lt; len; i++ ) {
			if( this._topics[ topic ][ i ] === callback ) {
				this._topics[ topic ].splice( i, 1 );
				return true;
			}
		}

		return false;
	};

	Mediator.prototype.publish = function mediatorPublish() {
		var args = Array.prototype.slice.call( arguments );
		var topic = args.shift();

		if( ! this._topics.hasOwnProperty( topic ) ) {
			return false;
		}

		for( var i = 0, len = this._topics[ topic ].length; i &lt; len; i++ ) {
			this._topics[ topic ][ i ].apply( undefined, args );
		}
		return true;
	};

	return Mediator;

} )( window );

// example subscriber function
var Subscriber = function ExampleSubscriber( myVariable ) {
  console.log( myVariable );
};

// example usages
var myMediator = new Mediator();
myMediator.subscribe( 'some event', Subscriber );
myMediator.publish( 'some event', 'foo bar' ); // console logs "foo bar"
view rawmediator-pattern-example.js hosted with â¤ by GitHub
</code></pre>


</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<article>
        <h1>The Prototype Pattern</h1>
        <p>The prototype pattern focuses on creating an object that can be used as a blueprint for other objects through prototypal inheritance. This pattern is inherently easy to work with in JavaScript because of the native support for prototypal inheritance in JS which means we don't need to spend time or effort imitating this topology.</p>

<p>This article is part of a series called <a href="http://carldanley.com/javascript-design-patterns/">JavaScript Design Patterns</a>.</p>

<h2>Advantages</h2>

<ul>  
<li>New objects created from the "skeleton" of an existing object inherit references to existing functions on the prototype chain, thus boosting performance and keeping memory footprints to a minimum.</li>  
<li>Great for an application where the focus is on object creation</li>  
</ul>

<h2>Disadvantages</h2>

<ul>  
<li>Overkill for a project that uses very few objects and/or does not have an underlying emphasis on the extension of prototype chains</li>  
</ul>

<h2>Example</h2>

<script async="" src="//www.google-analytics.com/analytics.js"></script><script src="https://gist.github.com/carldanley/ec2204682f7b01844e69.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>// build our blueprint object
var MyBluePrint = function MyBluePrintObject() {
  
  this.someFunction = function someFunction() {
    alert( 'some function' );
  };
  
  this.someOtherFunction = function someOtherFunction() {
    alert( 'some other function' );
  };
  
  this.showMyName = function showMyName() {
    alert( this.name );
  };
  
};

function MyObject() {
  this.name = 'testing';
}
MyObject.prototype = new MyBluePrint();

// example usage
var testObject = new MyObject();
testObject.someFunction(); // alerts "some function"
testObject.someOtherFunction(); // alerts "some other function"
testObject.showMyName(); // alerts "testing"
view rawprototype-pattern-example-1.js hosted with â¤ by GitHub
</code></pre>

</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<article>
        <h1>The Facade Pattern</h1>
        <p>The purpose of the facade pattern is to conceal the underlying complexity of the code by using an anonymous function as an extra layer. Internal subroutines are never exposed but rather invoked through a <a href="http://www.merriam-webster.com/dictionary/facade">facade</a> which makes this pattern secure in that it never exposes anything to the developers working with it. The facade pattern is both extremely interesting and very useful for adding an extra layer of security to your already minified code. This pattern is extremely useful when coupled with the <a href="http://carldanley.com/js-revealing-module-pattern/">revealing module pattern</a>.</p>

<p>This article is part of a series called <a href="http://carldanley.com/javascript-design-patterns/">JavaScript Design Patterns</a>.</p>

<h2>Advantages</h2>

<ul>  
<li>Enhances security for your web application</li>  
<li>Works well in combination with other patterns</li>  
<li>Easy to implement</li>  
<li>Makes it easy to patch internals</li>  
<li>Provides a simpler public interface</li>  
<li>Proven useful for other major libraries such as jQuery</li>  
</ul>

<h2>Disadvantages</h2>

<p>There aren't any real drawbacks as it provides a unified interface to a set of interfaces in a subsystem. As a result, you aren't forced to make any unwanted compromises, thus a win-win. One possible note worth mentioning is that a developer must decide whether the implicit cost of implementation is really worth the abstraction (though this is generally a small footprint).</p>

<h2>Examples</h2>

<script async="" src="//www.google-analytics.com/analytics.js"></script><script src="https://gist.github.com/carldanley/28e40cc32c60909fb947.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>// a simple facade that masks the various browser-specific methods
function addEvent( element, event, callback ) {
  
  if( window.addEventListener ) {
    element.addEventListener( event, callback, false );
  } else if( document.attachEvent ) {
    element.attachEvent( 'on' + event, callback );
  } else {
    element[ 'on' + event ] = callback;
  }
  
}
view rawfacade-pattern-example-1.js hosted with â¤ by GitHub
</code></pre>


<p>The above is a basic example of the facade pattern.</p>

<script src="https://gist.github.com/carldanley/9187f369adcfc5c25e4f.js"></script><link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist/embed-3313cb70789df61d3bb75cd878325a1266ccab50b6aac9b80f1691ae0694a216.css"><pre><code>var MyModule = ( function( window, undefined ) {

  // revealing module pattern ftw
  function MyModule() {
    
    function someMethod() {
      alert( 'some method' );
    }
    
    function someOtherMethod() {
      alert( 'some other method' );
    }
    
    // expose publicly available methods
    return {
      
      // in our normal revealing module pattern, we'd do the following:
      someMethod : someMethod,
      
      // in the facade pattern, we mask the internals so no one has direct access by doing this:
      someMethod : function() {
        someMethod();
      }
      
    };
    
  }
  
} )( window );
view rawfacade-pattern-example-2.js hosted with â¤ by GitHub
</code></pre>


<p>The above is a more advanced version of the facade pattern that adds security to internal methods.</p>

</article>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<h1>JavaScript design patterns â€“ Part 1: Singleton, composite, and faÃ§ade</h1>
<div id="articlecontentAdobe">
<a name="articlecontentAdobe_text" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>This is the first article in a series about common design patterns used in JavaScript. Design patterns are proven ways of programming to help make your code more maintainable, scalable, and decoupled, all of which are necessary when creating large JavaScript applications, especially in large groups.</p>
<p>In Part 2 of this series, you're introduced to another 3 design patterns:&nbsp;<a href="/devnet/archive/html5/articles/javascript-design-patterns-pt2-adapter-decorator-factory.html" onclick="s_objectID=&quot;http://www.adobe.com/devnet/archive/html5/articles/javascript-design-patterns-pt2-adapter-decorat_1&quot;;return this.s_oc?this.s_oc(e):true">adapter, decorator, and factory</a>. Part 3 discusses 3 more design patterns:&nbsp;<a href="/devnet/archive/html5/articles/javascript-design-patterns-pt3-proxy-observer-command.html" onclick="s_objectID=&quot;http://www.adobe.com/devnet/archive/html5/articles/javascript-design-patterns-pt3-proxy-observer-_1&quot;;return this.s_oc?this.s_oc(e):true">proxy, observer, and command</a>.</p>
</div>
				</div>
<a name="articlecontentAdobe_numberedheader" style="visibility:hidden"></a><div class="parbase compbase numberedheader section"><h3 class="TextH3 LayoutCellSides LayoutRow">
        <a id="articlecontentAdobe_numberedheader"></a>
        Singleton</h3>
</div>
<a name="articlecontentAdobe_text_0" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>The singleton pattern is what you use when you want to ensure that only one instance of an object is ever created. In classical object-oriented programming languages, the concepts behind creating a singleton was a bit tricky to wrap your mind around because it involved a class that has both static and non-static properties and methods. I'm talking about JavaScript here though, so with JavaScript being a dynamic language without true classes, the JavaScript version of a singleton is excessively simple.</p>
<h4>Why do you need the singleton?</h4>
<p>Before I get into implementation details, I should discuss why the singleton pattern is useful for your applications. The ability to ensure you have only one instance of an object can actually come in quite handy. In server-side languages, you might use a singleton for handling a connection to a database because it's just a waste of resources to create more than one database connection for each request. Similarly, in front-end JavaScript, you might want to have an object that handles all AJAX requests be a singleton. A simple rule could be: if it has the exact same functionality every time you create a new instance, then make it a singleton.</p>
<p>This isn't the only reason to make a singleton, though. At least in JavaScript, the singleton allows you to namespace objects and functions to keep them organized and keep them from cluttering the global namespace, which as you probably know is a horrible idea, especially if you use third party code. Using the singleton for name-spacing is also referred to as the module design pattern.</p>
<h4>Show me the singleton</h4>
<p>To create a singleton, all you really need to do is create an object literal.</p>
</div>
				</div>
<a name="articlecontentAdobe_codeblock" style="visibility:hidden"></a><div class="parbase codeblock compbase section"><div class="PanelFillLight PanelBevelTop LayoutCell LayoutRow">
        <code class="CodeBlock">var Singleton = {
    prop: 1,
    another_prop: 'value',
    method: function() {â€¦},
    another_method: function() {â€¦}
};
</code>
    </div>
</div>
<a name="articlecontentAdobe_text_1" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>You can also create singletons that have private properties and methods, but it's a little bit trickier as it involves using a closure and a self-invoking anonymous function. Inside a function, some local functions and/or variables are declared. You then create and return an object literal, which has some methods that refererence the variables and functions that you declared within the larger function's scope. That outer function is immediatly executed by placing () immediately after the function declaration and the resulting object literal is assigned to a variable. If this is confusing, then take a look over the following code and then I'll explain it some more afterward.</p>
</div>
				</div>
<a name="articlecontentAdobe_codeblock_0" style="visibility:hidden"></a><div class="parbase codeblock compbase section"><div class="PanelFillLight PanelBevelTop LayoutCell LayoutRow">
        <code class="CodeBlock">var Singleton = (function() {
    var private_property = 0,
        private_method = function () {
            console.log('This is private');
        }
    
    return {
        prop: 1,
        another_prop: 'value',
        method: function() {
            private_method();
            return private_property;
        },
        another_method: function() {â€¦}
    }
}());

</code>
    </div>
</div>
<a name="articlecontentAdobe_text_3" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>The key is that when a variable is declared with var in front of it inside a function, that variable is only accessible inside the function and by functions that were declared within that function (the functions in the object literal for example). The return statement gives us back the object literal, which gets assigned to Singleton after the outer function executes itself.</p>
<h4>Namespacing with the singleton</h4>
<p>In JavaScript, namespacing is done by adding objects as properties of another object, so that it is one or more layers deep. This is useful for organizing code into logical sections. While the YUI JavaScript library does this to a degree that I feel is nearly excessive with numerous levels of namespacing, in general it is considered best practice to limit nesting namespaces to only a few lavels or less. The code below is an example of namespacing.</p>
</div>
				</div>
<a name="articlecontentAdobe_codeblock_1" style="visibility:hidden"></a><div class="parbase codeblock compbase section"><div class="PanelFillLight PanelBevelTop LayoutCell LayoutRow">
        <code class="CodeBlock">var Namespace = {
    Util: {
        util_method1: function() {â€¦},
        util_method2: function() {â€¦}
    },
    Ajax: {
        ajax_method: function() {â€¦}
    },
    some_method: function() {â€¦}
};

// Here's what it looks like when it's used
Namespace.Util.util_method1();
Namespace.Ajax.ajax_method();
Namespace.some_method();
</code>
    </div>
</div>
<a name="articlecontentAdobe_text_2" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>The use of namespacing, as I said earlier, keeps global variables to a minumum. Heck, you can even have entire applications attached to a single object namespace named app if that's your perogative. If you'd like to learn a little more about the singleton design pattern as well as its applicability in namespacing, then go ahead and check out the <a href="http://www.joezimjs.com/javascript/javascript-design-patterns-singleton/" target="_blank" onclick="s_objectID=&quot;http://www.joezimjs.com/javascript/javascript-design-patterns-singleton/_1&quot;;return this.s_oc?this.s_oc(e):true">"JavaScript Design Patterns: Singleton"</a> article on my personal blog.</p>
</div>
				</div>
<a name="articlecontentAdobe_numberedheader_0" style="visibility:hidden"></a><div class="parbase compbase numberedheader section"><h3 class="TextH3 LayoutCellSides LayoutRow">
        <a id="articlecontentAdobe_numberedheader_0"></a>
        Composite</h3>
</div>
<a name="articlecontentAdobe_text_4" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>If you read through the section about the singleton pattern and thought, "well, that was simple," don't worry, I have some more complicated patterns to discuss, one of which is the composite pattern. Composites, as the word implies, are objects composed of multiple parts that create a single entity. This single entity serves as the access point for all the parts, which, while simplifying things greatly, can also be deceiving because there's no implicit way to tell just how many parts the composite contains.</p>
<h4>Structure of the composite</h4>
<p>The composite is explained best using an illustration. In Figure 1, you can see two different types of objects: containers and galleries are the composites and images are the leaves. A composite can hold children and generally doesn't implement much behavior. A leaf contains most of the behavior, but it cannot hold any children, at least not in the classical composite example.</p>
</div>
				</div>
<a name="articlecontentAdobe_image" style="visibility:hidden"></a><div class="parbase image section"><div class="LayoutRow LayoutCellSides">
	<img title="Figure 1. The structure of a composite" alt="Figure 1. The structure of a composite" class="cq-dd-image  LayoutImage LayoutRow " src="http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/html5/articles/javascript-design-patterns-pt1-singleton-composite-faade/fig01.png"></div>
<div class="TextSmall LayoutCellSides LayoutRowTop LayoutBigRowBottom">
        Figure 1. The structure of a composite</div>
</div>
<a name="articlecontentAdobe_text_16" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>As another example, I'm 100% certain you've seen the composite pattern in action before but never really thought about it. The file structure in computers is an example of the composite pattern. If you delete a folder, all of its contents get deleted too, right? That's essentially how the composite pattern works. You can call a method on a composite object higher up on the tree and the message will be delivered down through the hierarchy.</p>
<h4>Composite coding example</h4>
<p>This example creates an image gallery as an example of the composite pattern. You will have just three levels: album, gallery, and image. The album and galleries will be composites and the images will be the leaves, just like in Figure 1. This is a more defined structure than a composite needs to have, but for this example, it makes sense to limit the levels to only being composites or leaves. A standard composite doesn't limit which levels of the hierarchy that leaves can be on, nor do they limit the number of levels.</p>
<p>To start things off, you create the <code>GalleryComposite</code> "class" used for both the album and the galleries. Please note that I am using jQuery for the DOM manipulation to simplify things.</p>
</div>
				</div>
<a name="articlecontentAdobe_codeblock_2" style="visibility:hidden"></a><div class="parbase codeblock compbase section"><div class="PanelFillLight PanelBevelTop LayoutCell LayoutRow">
        <code class="CodeBlock">var GalleryComposite = function (heading, id) {
    this.children = [];

    this.element = $('&lt;div id="' + id + '" class="composite-gallery"&gt;&lt;/div&gt;')
    .append('&lt;h2&gt;' + heading + '&lt;/h2&gt;');
}

GalleryComposite.prototype = {
    add: function (child) {
        this.children.push(child);
        this.element.append(child.getElement());
    },

    remove: function (child) {
        for (var node, i = 0; node = this.getChild(i); i++) {
            if (node == child) {
                this.children.splice(i, 1);
                this.element.detach(child.getElement());
                return true;
            }

            if (node.remove(child)) {
                return true;
            }
        }

        return false;
    },

    getChild: function (i) {
        return this.children[i];
    },

    hide: function () {
        for (var node, i = 0; node = this.getChild(i); i++) {
            node.hide();
        }

        this.element.hide(0);
    },

    show: function () {
        for (var node, i = 0; node = this.getChild(i); i++) {
            node.show();
        }

        this.element.show(0);
    },

    getElement: function () {
        return this.element;
    }
}
</code>
    </div>
</div>
<a name="articlecontentAdobe_text_5" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>There's quite a bit there, so how about I explain it a little bit? The <code>add</code>, <code>remove</code>, and <code>getChild</code> methods are used for constructing the composite. This example won't actually be using <code>remove</code> and <code>getChild</code>, but they are helpful for creating dynamic composites. The <code>hide</code>, <code>show</code>, and <code>getElement</code> methods are used to manipulate the DOM. This composite is designed to be a <i>representation </i>of the gallery that is shown to the user on the page. The composite can control the gallery elements through <code>hide</code> and <code>show</code>. If you call <code>hide</code> on the album, the entire album will disappear, or you can call it on just a single image and just the image will disappear.</p>
<p>Now create the <code>GalleryImage</code> class. Notice that it uses all of the exact same methods as the <code>GalleryComposite</code>. In other words, they implement the same interface, except that the image is a leaf so it doesn't actually do anything for the methods regarding children, as it cannot have any. Using the same interface is required for the composite to work because a composite element doesn't know whether it's adding another composite element or a leaf, so if it tries to call these methods on its children, it needs to work without any errors.<br>
</p>
</div>
				</div>
<a name="articlecontentAdobe_codeblock_3" style="visibility:hidden"></a><div class="parbase codeblock compbase section"><div class="PanelFillLight PanelBevelTop LayoutCell LayoutRow">
        <code class="CodeBlock">var GalleryImage = function (src, id) {
    this.children = [];

    this.element = $('&lt;img /&gt;')
    .attr('id', id)
    .attr('src', src);
}

GalleryImage.prototype = {
    // Due to this being a leaf, it doesn't use these methods,
    // but must implement them to count as implementing the
    // Composite interface
    add: function () { },

    remove: function () { },

    getChild: function () { },

    hide: function () {
        this.element.hide(0);
    },

    show: function () {
        this.element.show(0);
    },

    getElement: function () {
        return this.element;
    }
}
</code>
    </div>
</div>
<a name="articlecontentAdobe_text_6" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>Now that you have the object prototypes built, you can use them. Below you can see the code that actually builds the image gallery.</p>
</div>
				</div>
<a name="articlecontentAdobe_codeblock_4" style="visibility:hidden"></a><div class="parbase codeblock compbase section"><div class="PanelFillLight PanelBevelTop LayoutCell LayoutRow">
        <code class="CodeBlock">var container = new GalleryComposite('', 'allgalleries');
var gallery1 = new GalleryComposite('Gallery 1', 'gallery1');
var gallery2 = new GalleryComposite('Gallery 2', 'gallery2');
var image1 = new GalleryImage('image1.jpg', 'img1');
var image2 = new GalleryImage('image2.jpg', 'img2');
var image3 = new GalleryImage('image3.jpg', 'img3');
var image4 = new GalleryImage('image4.jpg', 'img4');

gallery1.add(image1);
gallery1.add(image2);

gallery2.add(image3);
gallery2.add(image4);

container.add(gallery1);
container.add(gallery2);

// Make sure to add the top container to the body,
// otherwise it'll never show up.
container.getElement().appendTo('body');
container.show();
</code>
    </div>
</div>
<a name="articlecontentAdobe_text_17" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>That's all there is to the composite! If you want to see a live demo of the gallery, you can visit the <a href="http://www.joezimjs.com/composite-pattern-demo-page/" target="_blank" onclick="s_objectID=&quot;http://www.joezimjs.com/composite-pattern-demo-page/_1&quot;;return this.s_oc?this.s_oc(e):true">demo page</a> on my blog. You can also read the "<a href="http://www.joezimjs.com/javascript/javascript-design-patterns-composite/" target="_blank" onclick="s_objectID=&quot;http://www.joezimjs.com/javascript/javascript-design-patterns-composite/_1&quot;;return this.s_oc?this.s_oc(e):true">JavaScript Design Patterns: Composite</a>" article on my blog for a little more information on this pattern.</p>
</div>
				</div>
<a name="articlecontentAdobe_numberedheader_1" style="visibility:hidden"></a><div class="parbase compbase numberedheader section"><h3 class="TextH3 LayoutCellSides LayoutRow">
        <a id="articlecontentAdobe_numberedheader_1"></a>
        FaÃ§ade</h3>
</div>
<a name="articlecontentAdobe_text_7" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>The faÃ§ade pattern is the final design pattern in this article, which is just a function or other piece of code that simplifies a more complex interface. This is actually quite common, and, one could argue, most functions are actually made for this very purpose. The goal of a faÃ§ade is to simplify a larger piece of logic into one simple function call.</p>
<h4>Examples of the faÃ§ade</h4>
<p>You just might be using the&nbsp;faÃ§ade&nbsp;pattern all the time without realizing that you're using any design pattern at all. Just about every single library that you use in any programming language uses the facade pattern to some degreebecause generally their purpose is to make complex things simpler.</p>
<p>Let's look at jQuery for an example. jQuery has a single function (<code>jquery()</code>) to do so many things; It can query the DOM, create elements, or just convert DOM elements into jQuery objects. If you just look at querying the DOM, and take a peek at the number of lines of code used to create that capability, you'd probably say to yourself, "I'm glad I didn't have to write this," because it is very long and complex code. They have successfully used the<br>
<span style="font-size: 13px; background-color: rgb(255, 255, 255);">faÃ§ade&nbsp;</span>pattern to convert hundreds of lines of complex code into a single, short function call for your convenience.</p>
<h4>Finishing up</h4>
<p>The faÃ§ade pattern is pretty easy to understand but if you are interested you can learn more from the <a href="http://www.joezimjs.com/javascript/javascript-design-patterns-facade/" target="_blank" onclick="s_objectID=&quot;http://www.joezimjs.com/javascript/javascript-design-patterns-facade/_1&quot;;return this.s_oc?this.s_oc(e):true">JavaScript Design Patterns: FaÃ§ade</a> post on my personal blog.<br>
</p>
</div>
				</div>
<a name="articlecontentAdobe_numberedheader_3" style="visibility:hidden"></a><div class="parbase compbase numberedheader section"><h3 class="TextH3 LayoutCellSides LayoutRow">
        Where to go from here</h3>
</div>
<a name="articlecontentAdobe_text_15" style="visibility:hidden"></a><div class="text parbase section"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p>In this part of the JavaScript Design Patterns series I covered the singleton, composite, and faÃ§ade. In Part 2 of this series, you're introduced to another 3 design patterns: <a href="/devnet/archive/html5/articles/javascript-design-patterns-pt2-adapter-decorator-factory.html" onclick="s_objectID=&quot;http://www.adobe.com/devnet/archive/html5/articles/javascript-design-patterns-pt2-adapter-decorat_2&quot;;return this.s_oc?this.s_oc(e):true">adapter, decorator, and factory</a>. Part 3 discusses 3 more design patterns:&nbsp;<a href="/devnet/archive/html5/articles/javascript-design-patterns-pt3-proxy-observer-command.html" onclick="s_objectID=&quot;http://www.adobe.com/devnet/archive/html5/articles/javascript-design-patterns-pt3-proxy-observer-_2&quot;;return this.s_oc?this.s_oc(e):true">proxy, observer, and command</a>.</p>
<p>I also have already completed a series on JavaScript design patterns on my personal blog that also includes a few patterns that I didn't feature in this series. You can find all of the posts in that series on <a href="http://www.joezimjs.com/tag/design-patterns/" target="_blank" onclick="s_objectID=&quot;http://www.joezimjs.com/tag/design-patterns/_1&quot;;return this.s_oc?this.s_oc(e):true">my blog</a>.</p>
</div>
				</div>
<a name="articlecontentAdobe_reference" style="visibility:hidden"></a><div class="parbase section reference"><div style="display:inline;" class="cq-dd-paragraph"><div class="text parbase"><div class="Semantic LayoutCellSides LayoutBreakAfter TextMedium TextBreak">
						<p><a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" onclick="s_objectID=&quot;http://creativecommons.org/licenses/by-nc-sa/3.0/_1&quot;;return this.s_oc?this.s_oc(e):true"><img src="http://cookbooks.adobe.com/resources/images/license_creative_commons.png" alt="Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License"></a>+<a target="_blank" href="/communities/guidelines/ccplus/commercialcode_plus_permission.html" onclick="s_objectID=&quot;http://www.adobe.com/communities/guidelines/ccplus/commercialcode_plus_permission.html_1&quot;;return this.s_oc?this.s_oc(e):true"><img src="http://cookbooks.adobe.com/resources/images/license_adobe.jpg" alt="Adobe Commercial Rights"></a></p>
 <p>This work is licensed under a <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" onclick="s_objectID=&quot;http://creativecommons.org/licenses/by-nc-sa/3.0/_2&quot;;return this.s_oc?this.s_oc(e):true">Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License</a>. Permissions beyond the scope of this license, pertaining to the examples of code included within this work are available at <a target="_blank" href="/communities/guidelines/ccplus/commercialcode_plus_permission.html" onclick="s_objectID=&quot;http://www.adobe.com/communities/guidelines/ccplus/commercialcode_plus_permission.html_2&quot;;return this.s_oc?this.s_oc(e):true">Adobe</a>.</p>
</div>
				</div>
</div>
</div>
</div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>Mediator</h1>
		<div style="padding: 10px 0 0 30px;">

                    <h3>Definition</h3>

                    <div style="width:80%;padding:6px 0;">
                        Define an object that encapsulates how a set of objects interact. Mediator promotes loose coupling by keeping objects from referring to each other explicitly, and it lets you vary their interaction independently.
                    </div>

                    <br>

                    <div class="clearfix">
                        <div class="pull-left" style="padding:5px 20px 0 0;">Frequency of use (<i>in JavaScript</i>):</div>
                        <div class="pull-left"><img src="/images/use_medium_low.gif"></div>
                        <div class="pull-left" style="padding:5px 0px 0 15px;">medium low</div>
                    </div>


                    
                    <hr class="hr-orange">
                    

                    <div style="width:90%;">
                        

<h3 class="phead">Summary</h3>

<p class="ptext">
    The Mediator pattern provides central authority over a group of objects by encapsulating how these objects interact.
    This model is useful for scenarios where there is a need to manage complex conditions in which every object is aware of any state change in any other object in the group.
</p>
<p class="ptext">
    The Mediator patterns are useful in the development of complex forms. Take for example a page in which you enter options to make a flight reservation.
    A simple Mediator rule would be: you must enter a valid departure date, a valid return date,
    the return date must be after the departure date, a valid departure airport, a valid arrival airport, a valid number of travelers, and only then the Search button can be activated.
</p>
<p class="ptext">
    Another example of Mediator is that of a control tower on an airport coordinating arrivals and departures of airplanes.
</p>
<br>

<h3 class="phead">Diagram</h3>
<div style="padding-left:1px;">
    <img class="diagram" src="/images/diagrams/javascript/javascript-mediator.jpg" alt="Diagram JavaScript Mediator Design Pattern">
</div>
<br>
<br>

<h3 class="phead">Participants</h3>
<div class="ptext">
    The objects participating in this pattern are:<br><br>

    <ul>

        <li>
            <b>Mediator</b> -- In sample code: <b style="color:#088;">Chatroom</b>
            <ul>
                <li>defines an interface for communicating with Colleague objects</li>
                <li>maintains references to Colleague objects</li>
                <li>manages central control over operations</li>
            </ul>
        </li>
        <li>
            <b>Colleagues</b> -- In sample code: <b style="color:#088;">Participants</b>
            <ul>
                <li>objects that are being mediated by the Mediator</li>
                <li>each instance maintains a reference to the Mediator</li>
            </ul>
        </li>
    </ul>

</div>

<br>

<h3 class="phead">Sample code in JavaScript</h3>

<p class="ptext">
    In the example code we have four participants that are joining in a chat session by registering with a <span class="cd">Chatroom</span> (the Mediator).
    Each participant is represented by a <span class="cd">Participant</span> object.
    Participants send messages to each other and the Chatroom handles the routing.
</p>
<p class="ptext">
    This example is simple, but other complex rules could have been added, such as a 'junk filter' to protect participants from receiving junk messages.
</p>
<p class="ptext">
    The <span class="cd">log</span> function is a helper which collects and displays results.
</p>

<pre class="prettyprint linenums run"><ol class="linenums"><li class="L0"><span class="kwd">var</span><span class="pln"> </span><span class="typ">Participant</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span></li><li class="L2"><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">chatroom </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></li><li class="L3"><span class="pun">};</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="typ">Participant</span><span class="pun">.</span><span class="pln">prototype </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></li><li class="L6"><span class="pln">    send</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> to</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">chatroom</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> to</span><span class="pun">);</span></li><li class="L8"><span class="pln">    </span><span class="pun">},</span></li><li class="L9"><span class="pln">    receive</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">        log</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">from</span><span class="pun">.</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">" to "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">": "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> message</span><span class="pun">);</span></li><li class="L1"><span class="pln">    </span><span class="pun">}</span></li><li class="L2"><span class="pun">};</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="kwd">var</span><span class="pln"> </span><span class="typ">Chatroom</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L5"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> participants </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="pln">        </span><span class="kwd">register</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">participant</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">            participants</span><span class="pun">[</span><span class="pln">participant</span><span class="pun">.</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> participant</span><span class="pun">;</span></li><li class="L1"><span class="pln">            participant</span><span class="pun">.</span><span class="pln">chatroom </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span></li><li class="L2"><span class="pln">        </span><span class="pun">},</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln">        send</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">,</span><span class="pln"> to</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L5"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">to</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                      </span><span class="com">// single message</span></li><li class="L6"><span class="pln">                to</span><span class="pun">.</span><span class="pln">receive</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">);</span><span class="pln">    </span></li><li class="L7"><span class="pln">            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                       </span><span class="com">// broadcast message</span></li><li class="L8"><span class="pln">                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">key </span><span class="kwd">in</span><span class="pln"> participants</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">   </span></li><li class="L9"><span class="pln">                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">participants</span><span class="pun">[</span><span class="pln">key</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">                        participants</span><span class="pun">[</span><span class="pln">key</span><span class="pun">].</span><span class="pln">receive</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">);</span></li><li class="L1"><span class="pln">                    </span><span class="pun">}</span></li><li class="L2"><span class="pln">                </span><span class="pun">}</span></li><li class="L3"><span class="pln">            </span><span class="pun">}</span></li><li class="L4"><span class="pln">        </span><span class="pun">}</span></li><li class="L5"><span class="pln">    </span><span class="pun">};</span></li><li class="L6"><span class="pun">};</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">// log helper</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="kwd">var</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span></li><li class="L4"><span class="pln">        add</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> log </span><span class="pun">+=</span><span class="pln"> msg </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln"> </span><span class="pun">},</span></li><li class="L5"><span class="pln">        show</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> alert</span><span class="pun">(</span><span class="pln">log</span><span class="pun">);</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span></li><li class="L6"><span class="pln">    </span><span class="pun">}</span></li><li class="L7"><span class="pun">})();</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="kwd">function</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> yoko </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Participant</span><span class="pun">(</span><span class="str">"Yoko"</span><span class="pun">);</span></li><li class="L1"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> john </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Participant</span><span class="pun">(</span><span class="str">"John"</span><span class="pun">);</span></li><li class="L2"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> paul </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Participant</span><span class="pun">(</span><span class="str">"Paul"</span><span class="pun">);</span></li><li class="L3"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> ringo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Participant</span><span class="pun">(</span><span class="str">"Ringo"</span><span class="pun">);</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> chatroom </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Chatroom</span><span class="pun">();</span></li><li class="L6"><span class="pln">    chatroom</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">yoko</span><span class="pun">);</span></li><li class="L7"><span class="pln">    chatroom</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">john</span><span class="pun">);</span></li><li class="L8"><span class="pln">    chatroom</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">paul</span><span class="pun">);</span></li><li class="L9"><span class="pln">    chatroom</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="pln">ringo</span><span class="pun">);</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="pln">    yoko</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="str">"All you need is love."</span><span class="pun">);</span></li><li class="L2"><span class="pln">    yoko</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="str">"I love you John."</span><span class="pun">);</span></li><li class="L3"><span class="pln">    john</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="str">"Hey, no need to broadcast"</span><span class="pun">,</span><span class="pln"> yoko</span><span class="pun">);</span></li><li class="L4"><span class="pln">    paul</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="str">"Ha, I heard that!"</span><span class="pun">);</span></li><li class="L5"><span class="pln">    ringo</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="str">"Paul, what do you think?"</span><span class="pun">,</span><span class="pln"> paul</span><span class="pun">);</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="pln">    log</span><span class="pun">.</span><span class="pln">show</span><span class="pun">();</span></li><li class="L8"><span class="pun">}</span></li></ol></pre>





                    </div>
                    
                    

                    
                    
                    

                    
                    

                </div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>Facade Pattern</h1>
		<div style="padding: 10px 0 0 30px;">

                    <h3>Definition</h3>

                    <div style="width:80%;padding:6px 0;">
                        Provide a unified interface to a set of interfaces in a subsystem. FaÃ§ade defines a higher-level interface that makes the subsystem easier to use.
                    </div>

                    <br>

                    <div class="clearfix">
                        <div class="pull-left" style="padding:5px 20px 0 0;">Frequency of use (<i>in JavaScript</i>):</div>
                        <div class="pull-left"><img src="/images/use_high.gif"></div>
                        <div class="pull-left" style="padding:5px 0px 0 15px;">high</div>
                    </div>


                    <br>
                    <hr class="hr-orange">
                    <br>

                    <div style="width:90%;">
                        


<h3 class="phead">Summary</h3>

<p class="ptext">
    The FaÃ§ade pattern provides an interface which shields clients from complex functionality in one or more subsystems.
    It is a simple pattern that may seem trivial but it is powerful and extremely useful.
    It is often present in systems that are built around a multi-layer architecture.
</p>
<p class="ptext">
    The intent of the FaÃ§ade is to provide a high-level interface (properties and methods) that makes a subsystem or toolkit easy to use for the client.
</p>
<p class="ptext">
    On the server, in a multi-layer web application you frequently have a presentation layer which is a client to a service layer.
    Communication between these two layers takes place via a well-defined API.
    This API, or faÃ§ade, hides the complexities of the business objects and their interactions from the presentation layer.
</p>
<p class="ptext">
    Another area where FaÃ§ades are used is in refactoring. Suppose you have a confusing or messy set of legacy objects that the client should not be concerned about.
    You can hide this code behind a FaÃ§ade. The FaÃ§ade exposes only what is necessary and presents a cleaner and easy-to-use interface.
</p>
<p class="ptext">
    FaÃ§ades are frequently combined with other design patterns.  Facades themselves are often implemented as singleton factories.
</p>
<br>

<h3 class="phead">Diagram</h3>
<div style="padding-left:30px;">
    <img class="diagram" src="/images/diagrams/javascript/javascript-facade.jpg" alt="Diagram JavaScript Facade  Design Pattern">
</div>
<br>
<br>

<h3 class="phead">Participants</h3>
<div class="ptext">
    The objects participating in this pattern are:<br><br>

    <ul>
        <li>
            <b>Facade</b> -- In sample code: <b style="color:#088;">Mortgage</b>
            <ul>
                <li>knows which subsystems are responsible for a request</li>
                <li>delegates client requests to appropriate subsystem objects</li>
            </ul>
        </li>
        <li>
            <b>Sub Systems</b> -- In sample code: <b style="color:#088;">Bank, Credit, Background</b>
            <ul>
                <li>implements and performs specialized subsystem functionality</li>
                <li>have no knowledge of or reference to the facade</li>
            </ul>
        </li>

    </ul>


</div>

<br>

<h3 class="phead">Sample code in JavaScript</h3>

<p class="ptext">
    The  <span class="cd">Mortgage</span> object is the Facade in the sample code.
    It presents a simple interface to the client with only a single method: <span class="cd">applyFor</span>.
    Eut underneath this simple API lies considerable complexity.
</p>
<p class="ptext">
    The applicant's name is passed into the Mortgage constructor function.
    Then the <span class="cd">applyFor</span> method is called with the requested loan amount.
    Internally, this method uses services from 3 separate subsystems that are complex and possibly take some time to process; they are
    <span class="cd">Bank</span>,  <span class="cd">Credit</span>, and  <span class="cd">Background</span>.
</p>
<p class="ptext">
    Based on several criteria (bank statements, credit reports, and criminal background) the applicant is either accepted or denied for the
    requested loan.
</p>

<pre class="prettyprint linenums run"><ol class="linenums"><li class="L0"><span class="kwd">var</span><span class="pln"> </span><span class="typ">Mortgage</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="typ">Mortgage</span><span class="pun">.</span><span class="pln">prototype </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">    applyFor</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">amount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="com">// access multiple subsystems...</span></li><li class="L8"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"approved"</span><span class="pun">;</span></li><li class="L9"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bank</span><span class="pun">().</span><span class="pln">verify</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">            result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"denied"</span><span class="pun">;</span></li><li class="L1"><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Credit</span><span class="pun">().</span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></li><li class="L2"><span class="pln">            result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"denied"</span><span class="pun">;</span></li><li class="L3"><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Background</span><span class="pun">().</span><span class="pln">check</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></li><li class="L4"><span class="pln">            result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"denied"</span><span class="pun">;</span></li><li class="L5"><span class="pln">        </span><span class="pun">}</span></li><li class="L6"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">" has been "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> result </span><span class="pun">+</span></li><li class="L7"><span class="pln">               </span><span class="str">" for a "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> amount </span><span class="pun">+</span><span class="pln"> </span><span class="str">" mortgage"</span><span class="pun">;</span></li><li class="L8"><span class="pln">    </span><span class="pun">}</span></li><li class="L9"><span class="pun">}</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="kwd">var</span><span class="pln"> </span><span class="typ">Bank</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L2"><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">verify </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L3"><span class="pln">        </span><span class="com">// complex logic ...</span></li><li class="L4"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class="L5"><span class="pln">    </span><span class="pun">}</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="kwd">var</span><span class="pln"> </span><span class="typ">Credit</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L9"><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">get</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">        </span><span class="com">// complex logic ...</span></li><li class="L1"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class="L2"><span class="pln">    </span><span class="pun">}</span></li><li class="L3"><span class="pun">}</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="kwd">var</span><span class="pln"> </span><span class="typ">Background</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L6"><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">check </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="com">// complex logic ...</span></li><li class="L8"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class="L9"><span class="pln">    </span><span class="pun">}</span></li><li class="L0"><span class="pun">}</span></li><li class="L1"><span class="pln">&nbsp;</span></li><li class="L2"><span class="kwd">function</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L3"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> mortgage </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Mortgage</span><span class="pun">(</span><span class="str">"Joan Templeton"</span><span class="pun">);</span></li><li class="L4"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> mortgage</span><span class="pun">.</span><span class="pln">applyFor</span><span class="pun">(</span><span class="str">"$100,000"</span><span class="pun">);</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">    alert</span><span class="pun">(</span><span class="pln">result</span><span class="pun">);</span></li><li class="L7"><span class="pun">}</span></li><li class="L8"><span class="pln">&nbsp;</span></li></ol></pre>
                    </div>
                </div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>Observer</h1>
		<div style="padding: 10px 0 0 30px;">

                    <h3>Definition</h3>

                    <div style="width:80%;padding:6px 0;">
                        Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.
                    </div>

                    <br>

                    <div class="clearfix">
                        <div class="pull-left" style="padding:5px 20px 0 0;">Frequency of use (<i>in JavaScript</i>):</div>
                        <div class="pull-left"><img src="/images/use_high.gif"></div>
                        <div class="pull-left" style="padding:5px 0px 0 15px;">high</div>
                    </div>


                    <br>
                    
                    

                    <div style="width:90%;">
                        



<h3 class="phead">Summary</h3>

<p class="ptext">
    The Observer pattern offers a subscription model in which objects subscribe to an event and get notified when the event occurs.
    This pattern is the cornerstone of event driven programming, including JavaScript.
    The Observer pattern facilitates good object-oriented design and promotes loose coupling.
</p>
<p class="ptext">
    When building web apps you end up writing many event handlers. Event handlers are functions that will be notified when a certain event fires.
    These notifications optionally receive an event argument with details about the event (for example the x and y position of the mouse at a click event).
</p>
<p class="ptext">
    The event and event-handler paradigm in JavaScript is the manifestation of the Observer design pattern.
    Another name for the Observer pattern is Pub/Sub, short for Publication/Subscription.
</p>

<br>

<h3 class="phead">Diagram</h3>
<div style="padding-left:60px;">
    <img class="diagram" src="/images/diagrams/javascript/javascript-observer.jpg" alt="Diagram JavaScript Observer Design Pattern">
</div>
<br>
<br>

<h3 class="phead">Participants</h3>
<div class="ptext">
    The objects participating in this pattern are:<br><br>

    <ul>
        <li>
            <b>Subject</b> -- In sample code: <b style="color:#088;">Click</b>
            <ul>
                <li>maintains list of observers. Any number of Observer objects may observe a Subject</li>
                <li>implements an interface that lets observer objects subscribe or unsubscribe</li>
                <li>sends a notification to its observers when its state changes</li>
            </ul>
        </li>
        <li>
            <b>Observers</b> -- In sample code: <b style="color:#088;">clickHandler</b>
            <ul>
                <li>has a function signature that can be invoked when Subject changes (i.e. event occurs)</li>
            </ul>
        </li>
    </ul>

</div>

<br>

<h3 class="phead">Sample code in JavaScript</h3>

<p class="ptext">
    The <span class="cd">Click</span> object represents the Subject.
    The <span class="cd">clickHandler</span> function is the subscribing Observer.
    This handler subscribes, unsubscribes, and then subscribes itself while events are firing.
    It gets notified only of events #1 and #3.
</p>
<p class="ptext">
    Notice that the <span class="cd">fire</span> method accepts two arguments.
    The first one has details about the event and the second one is the
    context, that is, the <span class="cd">this</span> value for when the eventhandlers are called.
    If no context is provided <span class="cd">this</span> will be bound to the global object (window).
</p>
<p class="ptext">
    The <span class="cd">log</span> function is a helper which collects and displays results.
</p>

<pre class="prettyprint linenums run"><ol class="linenums"><li class="L0"><span class="kwd">function</span><span class="pln"> </span><span class="typ">Click</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handlers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln">  </span><span class="com">// observers</span></li><li class="L2"><span class="pun">}</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="typ">Click</span><span class="pun">.</span><span class="pln">prototype </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></li><li class="L5"><span class="pln">&nbsp;</span></li><li class="L6"><span class="pln">    subscribe</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L7"><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handlers</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">fn</span><span class="pun">);</span></li><li class="L8"><span class="pln">    </span><span class="pun">},</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pln">    unsubscribe</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handlers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handlers</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span></li><li class="L2"><span class="pln">            </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L3"><span class="pln">                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item </span><span class="pun">!==</span><span class="pln"> fn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L4"><span class="pln">                    </span><span class="kwd">return</span><span class="pln"> item</span><span class="pun">;</span></li><li class="L5"><span class="pln">                </span><span class="pun">}</span></li><li class="L6"><span class="pln">            </span><span class="pun">}</span></li><li class="L7"><span class="pln">        </span><span class="pun">);</span></li><li class="L8"><span class="pln">    </span><span class="pun">},</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="pln">    fire</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">o</span><span class="pun">,</span><span class="pln"> thisObj</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> scope </span><span class="pun">=</span><span class="pln"> thisObj </span><span class="pun">||</span><span class="pln"> window</span><span class="pun">;</span></li><li class="L2"><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handlers</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class="L3"><span class="pln">            item</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">,</span><span class="pln"> o</span><span class="pun">);</span></li><li class="L4"><span class="pln">        </span><span class="pun">});</span></li><li class="L5"><span class="pln">    </span><span class="pun">}</span></li><li class="L6"><span class="pun">}</span></li><li class="L7"><span class="pln">&nbsp;</span></li><li class="L8"><span class="com">// log helper</span></li><li class="L9"><span class="pln">&nbsp;</span></li><li class="L0"><span class="kwd">var</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L1"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span></li><li class="L2"><span class="pln">&nbsp;</span></li><li class="L3"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span></li><li class="L4"><span class="pln">        add</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> log </span><span class="pun">+=</span><span class="pln"> msg </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln"> </span><span class="pun">},</span></li><li class="L5"><span class="pln">        show</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> alert</span><span class="pun">(</span><span class="pln">log</span><span class="pun">);</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span></li><li class="L6"><span class="pln">    </span><span class="pun">}</span></li><li class="L7"><span class="pun">})();</span></li><li class="L8"><span class="pln">&nbsp;</span></li><li class="L9"><span class="kwd">function</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class="L0"><span class="pln">&nbsp;</span></li><li class="L1"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> clickHandler </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span></li><li class="L2"><span class="pln">        log</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">"fired: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> item</span><span class="pun">);</span><span class="pln"> </span></li><li class="L3"><span class="pln">    </span><span class="pun">};</span></li><li class="L4"><span class="pln">&nbsp;</span></li><li class="L5"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> click </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Click</span><span class="pun">();</span></li><li class="L6"><span class="pln">&nbsp;</span></li><li class="L7"><span class="pln">    click</span><span class="pun">.</span><span class="pln">subscribe</span><span class="pun">(</span><span class="pln">clickHandler</span><span class="pun">);</span></li><li class="L8"><span class="pln">    click</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'event #1'</span><span class="pun">);</span></li><li class="L9"><span class="pln">    click</span><span class="pun">.</span><span class="pln">unsubscribe</span><span class="pun">(</span><span class="pln">clickHandler</span><span class="pun">);</span></li><li class="L0"><span class="pln">    click</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'event #2'</span><span class="pun">);</span></li><li class="L1"><span class="pln">    click</span><span class="pun">.</span><span class="pln">subscribe</span><span class="pun">(</span><span class="pln">clickHandler</span><span class="pun">);</span></li><li class="L2"><span class="pln">    click</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'event #3'</span><span class="pun">);</span></li><li class="L3"><span class="pln">&nbsp;</span></li><li class="L4"><span class="pln">    log</span><span class="pun">.</span><span class="pln">show</span><span class="pun">();</span></li><li class="L5"><span class="pun">}</span></li></ol></pre>




                    </div>
                    
                    

                    
                    
                    

                    
                    

                </div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1 class="title">The Constructor Pattern</h1>
		<div class="sect1" title="The Constructor Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-constructor-pattern"></a>The Constructor Pattern</h1></div></div></div><p><a id="index-702D513KM6P" class="indexterm"></a>In classical object-oriented programming languages, a
    constructor is a special method used to initialize a newly created object
    once memory has been allocated for it. In JavaScript, as almost everything
    is an object, we're most often interested in
    <span class="emphasis"><em>object</em></span><a id="I_indexterm9_d1e1551" class="indexterm"></a> constructors.</p><p>Object constructors are used to create specific types of
    objectsâ€”both preparing the object for use and accepting arguments a
    constructor can use to set the values of member properties and methods
    when the object is first created (<a class="xref" href="ch09s01.html#constructor" title="Figure&nbsp;9-1.&nbsp;Constructor pattern">Figure&nbsp;9-1</a>).</p><div class="figure-float"><div class="figure"><a id="constructor"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e1564"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326906.png" alt="Constructor pattern" width="362" height="142" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326906.png"></div></div><p class="title">Figure&nbsp;9-1.&nbsp;Constructor pattern</p></div></div><div class="sect2" title="Object Creation"><div class="titlepage"><div><div><h2 class="title"><a id="object-creation"></a>Object Creation</h2></div></div></div><p><a id="I_indexterm9_d1e1573" class="indexterm"></a><a id="I_indexterm9_d1e1578" class="indexterm"></a>The two common ways to create new objects in JavaScript
      are as follows:</p><a id="I_programlisting9_d1e1584"></a><pre class="programlisting_javascript"><code class="c1">// Each of the following options will create a new empty object:</code>

<code class="kd">var</code> <code class="nx">newObject</code> <code class="o">=</code> <code class="p">{};</code> 

<code class="c1">// or which is a shorthand for the object constructor</code>
<code class="kd">var</code><code class="err">&nbsp;</code><code class="nx">newObject</code><code class="err">&nbsp;</code><code class="o">=</code><code class="err">&nbsp;</code><code class="k">new</code><code class="err">&nbsp;</code><code class="nb">Object</code><code class="p">();</code>
</pre><p>Where the <code class="literal">Object</code> constructor creates an object
      wrapper for a specific value, or where no value is passed, it will
      create an empty object and return it.</p><p>There are then four ways in which keys and values can be assigned
      to an object:</p><a id="I_programlisting9_d1e1593"></a><pre class="programlisting_javascript"><code class="c1">// ECMAScript 3 compatible approaches</code>

<code class="c1">// 1. Dot syntax</code>

<code class="c1">// Set properties</code>
<code class="nx">newObject</code><code class="p">.</code><code class="nx">someKey</code> <code class="o">=</code> <code class="s2">"Hello World"</code><code class="p">;</code> 

<code class="c1">// Get properties</code>
<code class="kd">var</code> <code class="nx">key</code> <code class="o">=</code> <code class="nx">newObject</code><code class="p">.</code><code class="nx">someKey</code><code class="p">;</code> 



<code class="c1">// 2. Square bracket syntax</code>

<code class="c1">// Set properties</code>
<code class="nx">newObject</code><code class="p">[</code><code class="s2">"someKey"</code><code class="p">]</code> <code class="o">=</code> <code class="s2">"Hello World"</code><code class="p">;</code> 

<code class="c1">// Get properties</code>
<code class="kd">var</code> <code class="nx">key</code> <code class="o">=</code> <code class="nx">newObject</code><code class="p">[</code><code class="s2">"someKey"</code><code class="p">];</code> 



<code class="c1">// ECMAScript 5 only compatible approaches</code>
<code class="c1">// For more information see: http://kangax.github.com/es5-compat-table/</code>

<code class="c1">// 3. Object.defineProperty</code>

<code class="c1">// Set properties </code>
<code class="nb">Object</code><code class="p">.</code><code class="nx">defineProperty</code><code class="p">(</code> <code class="nx">newObject</code><code class="p">,</code> <code class="s2">"someKey"</code><code class="p">,</code> <code class="p">{</code>
    <code class="nx">value</code><code class="o">:</code> <code class="s2">"for more control of the property's behavior"</code><code class="p">,</code>
    <code class="nx">writable</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
    <code class="nx">enumerable</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
    <code class="nx">configurable</code><code class="o">:</code> <code class="kc">true</code>
<code class="p">});</code>

<code class="c1">// If the above feels a little difficult to read, a short-hand could</code>
<code class="c1">// be written as follows:</code>

<code class="kd">var</code> <code class="nx">defineProp</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">obj</code><code class="p">,</code> <code class="nx">key</code><code class="p">,</code> <code class="nx">value</code> <code class="p">){</code>
  <code class="nx">config</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">value</code><code class="p">;</code>
  <code class="nb">Object</code><code class="p">.</code><code class="nx">defineProperty</code><code class="p">(</code> <code class="nx">obj</code><code class="p">,</code> <code class="nx">key</code><code class="p">,</code> <code class="nx">config</code> <code class="p">);</code>
<code class="p">};</code>

<code class="c1">// To use, we then create a new empty "person" object</code>
<code class="kd">var</code> <code class="nx">person</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">create</code><code class="p">(</code> <code class="kc">null</code> <code class="p">);</code>

<code class="c1">// Populate the object with properties</code>
<code class="nx">defineProp</code><code class="p">(</code> <code class="nx">person</code><code class="p">,</code> <code class="s2">"car"</code><code class="p">,</code>  <code class="s2">"Delorean"</code> <code class="p">);</code>
<code class="nx">defineProp</code><code class="p">(</code> <code class="nx">person</code><code class="p">,</code> <code class="s2">"dateOfBirth"</code><code class="p">,</code> <code class="s2">"1981"</code> <code class="p">);</code>
<code class="nx">defineProp</code><code class="p">(</code> <code class="nx">person</code><code class="p">,</code> <code class="s2">"hasBeard"</code><code class="p">,</code> <code class="kc">false</code> <code class="p">);</code>


<code class="c1">// 4. Object.defineProperties</code>

<code class="c1">// Set properties</code>
<code class="nb">Object</code><code class="p">.</code><code class="nx">defineProperties</code><code class="p">(</code> <code class="nx">newObject</code><code class="p">,</code> <code class="p">{</code> 

  <code class="s2">"someKey"</code><code class="o">:</code> <code class="p">{</code>  
    <code class="nx">value</code><code class="o">:</code> <code class="s2">"Hello World"</code><code class="p">,</code>  
    <code class="nx">writable</code><code class="o">:</code> <code class="kc">true</code>  
  <code class="p">},</code> 

  <code class="s2">"anotherKey"</code><code class="o">:</code> <code class="p">{</code>  
    <code class="nx">value</code><code class="o">:</code> <code class="s2">"Foo bar"</code><code class="p">,</code>  
    <code class="nx">writable</code><code class="o">:</code> <code class="kc">false</code>  
  <code class="p">}</code>  

<code class="p">});</code>

<code class="c1">// Getting properties for 3. and 4. can be done using any of the</code>
<code class="c1">// options in 1. and 2.</code>
</pre><p>As we will see a little later in the book, these methods can even
      be used for inheritance,<a id="I_indexterm9_d1e1597" class="indexterm"></a> as follows:</p><a id="I_programlisting9_d1e1603"></a><pre class="programlisting_javascript"><code class="c1">// Usage:</code>

<code class="c1">// Create a race car driver that inherits from the person object</code>
<code class="kd">var</code> <code class="nx">driver</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">create</code><code class="p">(</code> <code class="nx">person</code> <code class="p">);</code>

<code class="c1">// Set some properties for the driver</code>
<code class="nx">defineProp</code><code class="p">(</code><code class="nx">driver</code><code class="p">,</code> <code class="s2">"topSpeed"</code><code class="p">,</code> <code class="s2">"100mph"</code><code class="p">);</code>

<code class="c1">// Get an inherited property (1981)</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">driver</code><code class="p">.</code><code class="nx">dateOfBirth</code> <code class="p">);</code>

<code class="c1">// Get the property we set (100mph)</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">driver</code><code class="p">.</code><code class="nx">topSpeed</code> <code class="p">);</code>
</pre></div><div class="sect2" title="Basic Constructors"><div class="titlepage"><div><div><h2 class="title"><a id="basic-constructors"></a>Basic Constructors</h2></div></div></div><p><a id="index-770U674VD8M" class="indexterm"></a>As we saw earlier, JavaScript doesn't support the concept
      of classes, <a id="I_indexterm9_d1e1615" class="indexterm"></a><a id="I_indexterm9_d1e1620" class="indexterm"></a>but it does support special constructor functions that
      work with objects. By simply prefixing a call to a constructor function
      with the keyword <code class="literal">new</code>, we can tell JavaScript we would
      like the function to behave like a constructor and instantiate a new
      object with the members defined by that function.</p><p>Inside a constructor, the keyword
      <code class="literal">this</code><a id="I_indexterm9_d1e1633" class="indexterm"></a><a id="I_indexterm9_d1e1636" class="indexterm"></a> references the new object that's being created.
      Revisiting object creation, a basic constructor may look as
      follows:</p><a id="I_programlisting9_d1e1640"></a><pre class="programlisting_javascript"><code class="kd">function</code> <code class="nx">Car</code><code class="p">(</code> <code class="nx">model</code><code class="p">,</code> <code class="nx">year</code><code class="p">,</code> <code class="nx">miles</code> <code class="p">)</code> <code class="p">{</code>

  <code class="k">this</code><code class="p">.</code><code class="nx">model</code> <code class="o">=</code> <code class="nx">model</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">year</code> <code class="o">=</code> <code class="nx">year</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">miles</code> <code class="o">=</code> <code class="nx">miles</code><code class="p">;</code>

  <code class="k">this</code><code class="p">.</code><code class="nx">toString</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">model</code> <code class="o">+</code> <code class="s2">" has done "</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">miles</code> <code class="o">+</code> <code class="s2">" miles"</code><code class="p">;</code>
  <code class="p">};</code>
<code class="p">}</code>

<code class="c1">// Usage:</code>

<code class="c1">// We can create new instances of the car</code>
<code class="kd">var</code> <code class="nx">civic</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Car</code><code class="p">(</code> <code class="s2">"Honda Civic"</code><code class="p">,</code> <code class="mi">2009</code><code class="p">,</code> <code class="mi">20000</code> <code class="p">);</code>
<code class="kd">var</code> <code class="nx">mondeo</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Car</code><code class="p">(</code> <code class="s2">"Ford Mondeo"</code><code class="p">,</code> <code class="mi">2010</code><code class="p">,</code> <code class="mi">5000</code> <code class="p">);</code>

<code class="c1">// and then open our browser console to view the </code>
<code class="c1">// output of the toString() method being called on </code>
<code class="c1">// these objects</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">civic</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code> <code class="p">);</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">mondeo</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code> <code class="p">);</code>
</pre><p>The above is a simple version of the constructor pattern, but it
      does suffer from some problems. One is that it makes inheritance
      difficult and the other is that functions such as <code class="literal">toString()</code> are redefined for each of new
      object created using the <code class="literal">Car</code> constructor. This isn't
      optimal, as the function should ideally be shared between all instances
      of the <code class="literal">Car</code> type.</p><p>Thankfully, as there are a number of both ES3- and ES5-compatible
      alternatives to constructing objects, it's trivial to work around this
      limitation.</p></div><div class="sect2" title="Constructors with Prototypes"><div class="titlepage"><div><div><h2 class="title"><a id="constructors-with-prototypes"></a>Constructors with Prototypes</h2></div></div></div><p><a id="I_indexterm9_d1e1661" class="indexterm"></a><a id="I_indexterm9_d1e1664" class="indexterm"></a>Functions in JavaScript have a property <a id="I_indexterm9_d1e1670" class="indexterm"></a>called a <em class="firstterm">prototype</em>. When we call a
      JavaScript constructor to create an object, all the properties of the
      constructor's prototype are then made available to the new object. In
      this fashion, multiple <code class="literal">Car</code> objects can be created
      that access the same prototype. We can thus extend the original example
      as follows:</p><a id="I_programlisting9_d1e1682"></a><pre class="programlisting_javascript"><code class="kd">function</code> <code class="nx">Car</code><code class="p">(</code> <code class="nx">model</code><code class="p">,</code> <code class="nx">year</code><code class="p">,</code> <code class="nx">miles</code> <code class="p">)</code> <code class="p">{</code>

  <code class="k">this</code><code class="p">.</code><code class="nx">model</code> <code class="o">=</code> <code class="nx">model</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">year</code> <code class="o">=</code> <code class="nx">year</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">miles</code> <code class="o">=</code> <code class="nx">miles</code><code class="p">;</code>

<code class="p">}</code>


<code class="c1">// Note here that we are using Object.prototype.newMethod rather than </code>
<code class="c1">// Object.prototype so as to avoid redefining the prototype object</code>
<code class="nx">Car</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">model</code> <code class="o">+</code> <code class="s2">" has done "</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">miles</code> <code class="o">+</code> <code class="s2">" miles"</code><code class="p">;</code>
<code class="p">};</code>

<code class="c1">// Usage:</code>

<code class="kd">var</code> <code class="nx">civic</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Car</code><code class="p">(</code> <code class="s2">"Honda Civic"</code><code class="p">,</code> <code class="mi">2009</code><code class="p">,</code> <code class="mi">20000</code> <code class="p">);</code>
<code class="kd">var</code> <code class="nx">mondeo</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Car</code><code class="p">(</code> <code class="s2">"Ford Mondeo"</code><code class="p">,</code> <code class="mi">2010</code><code class="p">,</code> <code class="mi">5000</code> <code class="p">);</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">civic</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code> <code class="p">);</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">mondeo</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code> <code class="p">);</code>
</pre><p>A single instance of <code class="literal">toString()</code> will now be
      shared between all <code class="literal">Car</code> objects.<a id="I_indexterm9_d1e1692" class="indexterm"></a><a id="I_indexterm9_d1e1693" class="indexterm"></a></p></div></div>
		</div>
		<!--=========================
			END : POST
		=============================--><!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Module Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-module-pattern"></a>The Module Pattern</h1></div></div></div><p><a id="I_indexterm9_d1e1699" class="indexterm"></a><a id="index-653D847TP4R" class="indexterm"></a>Modules are an integral piece of any robust application's
    architecture and typically help in keeping the units of code for a project
    both cleanly separated and organized.</p><p>In JavaScript, there are several options for implementing modules.
    These include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Object literal notation</p></li><li class="listitem"><p>The Module pattern</p></li><li class="listitem"><p>AMD modules</p></li><li class="listitem"><p>CommonJS modules</p></li><li class="listitem"><p>ECMAScript Harmony modules</p></li></ul></div><p>We will be exploring the latter three of these options later on in
    the book in <a class="xref" href="ch11.html" title="Chapter&nbsp;11.&nbsp;Modern Modular JavaScript Design Patterns">Chapter&nbsp;11</a>.</p><p>The Module pattern is based in part on object literals, so it makes
    sense to refresh our knowledge of them first.</p><div class="sect2" title="Object Literals"><div class="titlepage"><div><div><h2 class="title"><a id="id440004"></a>Object Literals</h2></div></div></div><p><a id="I_indexterm9_d1e1739" class="indexterm"></a><a id="I_indexterm9_d1e1746" class="indexterm"></a><a id="I_indexterm9_d1e1751" class="indexterm"></a>In object literal notation, an object is described as a
      set of comma-separated name/value pairs enclosed in curly braces
      (<code class="literal">{}</code>).<a id="I_indexterm9_d1e1758" class="indexterm"></a><a id="I_indexterm9_d1e1761" class="indexterm"></a> Names inside the object may be either strings or
      identifiers that are followed by a colon. There should be no comma used
      after the final name/value pair in the object, as this may result in
      errors.</p><a id="I_programlisting9_d1e1765"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myObjectLiteral</code> <code class="o">=</code> <code class="p">{</code>

    <code class="nx">variableKey</code><code class="o">:</code> <code class="nx">variableValue</code><code class="p">,</code>

    <code class="nx">functionKey</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="c1">// ...</code>
    <code class="p">};</code>
<code class="p">};</code>
</pre><p>Object literals don't require instantiation using the <code class="literal">new</code> operator, but shouldn't be used at the
      start of a statement, as the opening <code class="literal">{</code> may be interpreted as the beginning of a
      block. Outside of an object, new members may be added to the object
      literal using assignment as follows: <code class="literal">myModule.property = "someValue";</code></p><p>Below, we can see a more complete example of a module defined
      using object literal notation:</p><a id="I_programlisting9_d1e1779"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myModule</code> <code class="o">=</code> <code class="p">{</code>

  <code class="nx">myProperty</code><code class="o">:</code> <code class="s2">"someValue"</code><code class="p">,</code>

  <code class="c1">// object literals can contain properties and methods.</code>
  <code class="c1">// e.g we can define a further object for module configuration:</code>
  <code class="nx">myConfig</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">useCaching</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
    <code class="nx">language</code><code class="o">:</code> <code class="s2">"en"</code>
  <code class="p">},</code>

  <code class="c1">// a very basic method</code>
  <code class="nx">myMethod</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"Where in the world is Paul Irish today?"</code> <code class="p">);</code>
  <code class="p">},</code>

  <code class="c1">// output a value based on the current configuration</code>
  <code class="nx">myMethod2</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"Caching is:"</code> <code class="o">+</code> <code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">myConfig</code><code class="p">.</code><code class="nx">useCaching</code> <code class="p">)</code> <code class="o">?</code> <code class="s2">"enabled"</code> <code class="o">:</code> <code class="s2">"disabled"</code> <code class="p">);</code>
  <code class="p">},</code>

  <code class="c1">// override the current configuration</code>
  <code class="nx">myMethod3</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">newConfig</code> <code class="p">)</code> <code class="p">{</code>

    <code class="k">if</code> <code class="p">(</code> <code class="k">typeof</code> <code class="nx">newConfig</code> <code class="o">===</code> <code class="s2">"object"</code> <code class="p">)</code> <code class="p">{</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">myConfig</code> <code class="o">=</code> <code class="nx">newConfig</code><code class="p">;</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">myConfig</code><code class="p">.</code><code class="nx">language</code> <code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">};</code>

<code class="c1">// Outputs: Where in the world is Paul Irish today?</code>
<code class="nx">myModule</code><code class="p">.</code><code class="nx">myMethod</code><code class="p">();</code>

<code class="c1">// Outputs: enabled</code>
<code class="nx">myModule</code><code class="p">.</code><code class="nx">myMethod2</code><code class="p">();</code>

<code class="c1">// Outputs: fr</code>
<code class="nx">myModule</code><code class="p">.</code><code class="nx">myMethod3</code><code class="p">({</code>
  <code class="nx">language</code><code class="o">:</code> <code class="s2">"fr"</code><code class="p">,</code>
  <code class="nx">useCaching</code><code class="o">:</code> <code class="kc">false</code>
<code class="p">});</code>
</pre><p>Using object literals can assist in encapsulating and organizing
      your code. Rebecca Murphey has previously written about this topic in
      <a class="ulink" href="http://rmurphey.com/blog/2009/10/15/using-objects-to-organize-your-code/">depth</a>,
      should you wish to read into object literals further.</p><p>That said, if we're opting for this technique, we may be equally
      as interested in the Module pattern. It still uses object literals but
      only as the return value from a scoping function.</p></div><div class="sect2" title="The Module Pattern"><div class="titlepage"><div><div><h2 class="title"><a id="id451169"></a>The Module Pattern</h2></div></div></div><p>The Module pattern was originally defined as a way to provide both
      private and public encapsulation for classes in conventional software
      engineering.</p><p>In JavaScript, the Module pattern is used to further
      <span class="emphasis"><em>emulate</em></span> the concept of classes <a id="I_indexterm9_d1e1798" class="indexterm"></a>in such a way that we're able to include both
      public/private methods and variables inside a single object, thus
      shielding particular parts from the global scope. What this results in
      is a reduction in the likelihood of our function names conflicting with
      other functions defined in additional scripts on the page (<a class="xref" href="ch09s02.html#module" title="Figure&nbsp;9-2.&nbsp;Module pattern">Figure&nbsp;9-2</a>).</p><div class="figure-float"><div class="figure"><a id="module"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e1809"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326918.png" alt="Module pattern" width="390" height="185" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326918.png"></div></div><p class="title">Figure&nbsp;9-2.&nbsp;Module pattern</p></div></div><div class="sect3" title="Privacy"><div class="titlepage"><div><div><h3 class="title"><a id="id463501"></a>Privacy</h3></div></div></div><p><a id="I_indexterm9_d1e1818" class="indexterm"></a><a id="I_indexterm9_d1e1821" class="indexterm"></a>The Module pattern encapsulates "privacy" state and
        organization using closures. It provides a way of wrapping a mix of
        public and private methods and variables, protecting pieces from
        leaking into the global scope and accidentally colliding with another
        developer's interface. With this pattern, only a public API is
        returned, keeping everything else within the closure private.</p><p>This gives us a clean solution for shielding logic doing the
        heavy lifting while only exposing an interface we would like other
        parts of our application to use. The pattern is quite similar to an
        immediately-invoked functional expression<sup>[<a id="iife_footnote" href="#ftn.iife_footnote" class="footnote totri-footnote">1</a>]</sup> , except that an object is returned rather than a
        function.</p><p>It should be noted that there isn't really an explicitly true
        sense of "privacy" inside JavaScript because unlike some traditional
        languages, it doesn't have access modifiers. Variables can't
        technically be declared as being public nor private, and so we use
        function scope to simulate this concept. Within the Module pattern,
        variables or methods declared are only available inside the module
        itself, thanks to closure. Variables or methods defined within the
        returning object, however, are available to everyone.</p></div><div class="sect3" title="History"><div class="titlepage"><div><div><h3 class="title"><a id="id647442"></a>History</h3></div></div></div><p><a id="I_indexterm9_d1e1845" class="indexterm"></a><a id="I_indexterm9_d1e1848" class="indexterm"></a>From a historical perspective, the Module pattern was
        originally developed by a number of people, including <a class="ulink" href="http://groups.google.com/group/comp.lang.javascript/msg/9f58bd11bd67d937">Richard
        Cornford</a> in 2003. It was later popularized by Douglas
        Crockford in his lectures. In addition, if you've ever played with
        Yahoo's YUI library,<a id="I_indexterm9_d1e1859" class="indexterm"></a> some of its features may appear quite familiar, because
        the Module pattern was a strong influence for YUI when creating their
        components.</p></div><div class="sect3" title="Examples"><div class="titlepage"><div><div><h3 class="title"><a id="id417132"></a>Examples</h3></div></div></div><p><a id="index-405D673DO6R" class="indexterm"></a>Let's begin looking at an implementation of the Module
        pattern by creating a module that is self-contained.</p><a id="I_programlisting9_d1e1875"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">testModule</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

  <code class="kd">var</code> <code class="nx">counter</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

  <code class="k">return</code> <code class="p">{</code>

    <code class="nx">incrementCounter</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="o">++</code><code class="nx">counter</code><code class="p">;</code>
    <code class="p">},</code>

    <code class="nx">resetCounter</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"counter value prior to reset: "</code> <code class="o">+</code> <code class="nx">counter</code> <code class="p">);</code>
      <code class="nx">counter</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">};</code>

<code class="p">})();</code>

<code class="c1">// Usage:</code>

<code class="c1">// Increment our counter</code>
<code class="nx">testModule</code><code class="p">.</code><code class="nx">incrementCounter</code><code class="p">();</code>

<code class="c1">// Check the counter value and reset</code>
<code class="c1">// Outputs: 1</code>
<code class="nx">testModule</code><code class="p">.</code><code class="nx">resetCounter</code><code class="p">();</code>
</pre><p>Here, other parts of the code are unable to directly read the
        value of our <code class="literal">incrementCounter()</code> or
        <code class="literal">resetCounter()</code>. The
        <code class="literal">counter</code> variable is actually fully shielded from
        our global scope so it acts just like a private variable wouldâ€”its
        existence is limited to within the module's closure so that the only
        code able to access its scope, are our two functions. Our methods are
        effectively namespaced so in the test section of our code, we need to
        prefix any calls with the name of the module (e.g.,
        <code class="literal">testModule</code>).</p><p>When working with the Module pattern, we may find it useful to
        define a simple template for getting started with it. Here's one that
        covers namespacing, public, and private variables:</p><a id="I_programlisting9_d1e1893"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myNamespace</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>


  <code class="c1">// A private counter variable</code>
  <code class="kd">var</code> <code class="nx">myPrivateVar</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

  <code class="c1">// A private function which logs any arguments</code>
  <code class="kd">var</code> <code class="nx">myPrivateMethod</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">foo</code> <code class="p">)</code> <code class="p">{</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">foo</code> <code class="p">);</code>
  <code class="p">};</code>

  <code class="k">return</code> <code class="p">{</code>

    <code class="c1">// A public variable</code>
    <code class="nx">myPublicVar</code><code class="o">:</code> <code class="s2">"foo"</code><code class="p">,</code>

    <code class="c1">// A public function utilizing privates</code>
    <code class="nx">myPublicFunction</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">bar</code> <code class="p">)</code> <code class="p">{</code>

      <code class="c1">// Increment our private counter</code>
      <code class="nx">myPrivateVar</code><code class="o">++</code><code class="p">;</code>

      <code class="c1">// Call our private method using bar</code>
      <code class="nx">myPrivateMethod</code><code class="p">(</code> <code class="nx">bar</code> <code class="p">);</code>

    <code class="p">}</code>
  <code class="p">};</code>

<code class="p">})();</code>
</pre><p>Looking at another example, we can see a shopping basket
        implemented using this pattern. The module itself is completely
        self-contained in a global variable called <code class="literal">basketModule</code>. The <code class="literal">basket</code> array in the module is kept private,
        so other parts of our application are unable to directly read it. It
        only exists with the module's closure, so the only methods able to
        access it are those with access to its scope (i.e., <code class="literal">addItem()</code>, <code class="literal">getItem()</code>, etc.).</p><a id="I_programlisting9_d1e1909"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">basketModule</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

  <code class="c1">// privates</code>

  <code class="kd">var</code> <code class="nx">basket</code> <code class="o">=</code> <code class="p">[];</code> 

  <code class="kd">function</code> <code class="nx">doSomethingPrivate</code><code class="p">()</code> <code class="p">{</code>
    <code class="c1">//...</code>
  <code class="p">}</code>

  <code class="kd">function</code> <code class="nx">doSomethingElsePrivate</code><code class="p">()</code> <code class="p">{</code>
    <code class="c1">//...</code>
  <code class="p">}</code>

  <code class="c1">// Return an object exposed to the public</code>
  <code class="k">return</code> <code class="p">{</code> 

    <code class="c1">// Add items to our basket</code>
    <code class="nx">addItem</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">values</code> <code class="p">)</code> <code class="p">{</code>
      <code class="nx">basket</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">values</code><code class="p">);</code>
    <code class="p">},</code>

    <code class="c1">// Get the count of items in the basket</code>
    <code class="nx">getItemCount</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="nx">basket</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code>
    <code class="p">},</code>

    <code class="c1">// Public alias to a  private function</code>
    <code class="nx">doSomething</code><code class="o">:</code> <code class="nx">doSomethingPrivate</code><code class="p">,</code>

    <code class="c1">// Get the total value of items in the basket</code>
    <code class="nx">getTotal</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

      <code class="kd">var</code> <code class="nx">itemCount</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">getItemCount</code><code class="p">(),</code>
          <code class="nx">total</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

      <code class="k">while</code> <code class="p">(</code><code class="nx">itemCount</code><code class="o">--</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">total</code> <code class="o">+=</code> <code class="nx">basket</code><code class="p">[</code><code class="nx">itemCount</code><code class="p">].</code><code class="nx">price</code><code class="p">;</code>
      <code class="p">}</code>

      <code class="k">return</code> <code class="nx">total</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">};</code>
<code class="p">}());</code>
</pre><p>Inside the module, you may have noticed that we return an
        <code class="literal">object</code>. This gets automatically
        assigned to <code class="literal">basketModule</code> so that we
        can interact with it as follows:</p><a id="I_programlisting9_d1e1919"></a><pre class="programlisting_javascript"><code class="c1">// basketModule returns an object with a public API we can use</code>

<code class="nx">basketModule</code><code class="p">.</code><code class="nx">addItem</code><code class="p">({</code>
  <code class="nx">item</code><code class="o">:</code> <code class="s2">"bread"</code><code class="p">,</code>
  <code class="nx">price</code><code class="o">:</code> <code class="mf">0.5</code>
<code class="p">});</code>

<code class="nx">basketModule</code><code class="p">.</code><code class="nx">addItem</code><code class="p">({</code>
  <code class="nx">item</code><code class="o">:</code> <code class="s2">"butter"</code><code class="p">,</code>
  <code class="nx">price</code><code class="o">:</code> <code class="mf">0.3</code>
<code class="p">});</code>

<code class="c1">// Outputs: 2</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">basketModule</code><code class="p">.</code><code class="nx">getItemCount</code><code class="p">()</code> <code class="p">);</code>

<code class="c1">// Outputs: 0.8</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">basketModule</code><code class="p">.</code><code class="nx">getTotal</code><code class="p">()</code> <code class="p">);</code>

<code class="c1">// However, the following will not work:</code>

<code class="c1">// Outputs: undefined</code>
<code class="c1">// This is because the basket itself is not exposed as a part of our</code>
<code class="c1">// the public API</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">basketModule</code><code class="p">.</code><code class="nx">basket</code> <code class="p">);</code> 

<code class="c1">// This also won't work as it only exists within the scope of our</code>
<code class="c1">// basketModule closure, but not the returned public object</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">basket</code> <code class="p">);</code>
</pre><p>The methods above are effectively namespaced inside <code class="literal">basketModule</code>.</p><p>Notice how the scoping function in the above basket module is
        wrapped around all of our functions, which we then call and
        immediately store the return value of. This has a number of advantages
        including:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The freedom to have private functions <a id="I_indexterm9_d1e1933" class="indexterm"></a><a id="I_indexterm9_d1e1938" class="indexterm"></a>that can only be consumed by our module. As they
            aren't exposed to the rest of the page (only our exported API is),
            they're considered truly private.</p></li><li class="listitem"><p>Given that functions are declared normally and are named, it
            can be easier to show call stacks in a debugger when we're
            attempting to discover what function(s) threw exceptions.</p></li><li class="listitem"><p>As T.J. Crowder has pointed out in the past, it also enables
            us to return different functions depending on the environment. In
            the past, I've seen developers use this to perform UA testing to
            provide a codepath in their module specific to IE, but we can
            easily opt for feature detection these days to achieve a similar
            goal.<a id="I_indexterm9_d1e1950" class="indexterm"></a></p></li></ul></div></div></div><div class="sect2" title="Module Pattern Variations"><div class="titlepage"><div><div><h2 class="title"><a id="id620561"></a>Module Pattern Variations</h2></div></div></div><div class="sect3" title="Import mixins"><div class="titlepage"><div><div><h3 class="title"><a id="id529910"></a>Import mixins</h3></div></div></div><p><a id="index-620Q214EG5A" class="indexterm"></a>This variation of the pattern demonstrates how globals
        <a id="I_indexterm9_d1e1966" class="indexterm"></a>(e.g., <code class="literal">jQuery</code>,
        <code class="literal">Underscore</code>) can be passed in as arguments to our
        module's anonymous function. This effectively allows us to
        <span class="emphasis"><em>import</em></span> them and locally alias them as we
        wish.</p><a id="I_programlisting9_d1e1981"></a><pre class="programlisting_javascript"><code class="c1">// Global module</code>
<code class="kd">var</code> <code class="nx">myModule</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">(</code> <code class="nx">jQ</code><code class="p">,</code> <code class="nx">_</code> <code class="p">)</code> <code class="p">{</code>
  
    <code class="kd">function</code> <code class="nx">privateMethod1</code><code class="p">(){</code>
        <code class="nx">jQ</code><code class="p">(</code><code class="s2">".container"</code><code class="p">).</code><code class="nx">html</code><code class="p">(</code><code class="s2">"test"</code><code class="p">);</code>
    <code class="p">}</code>

    <code class="kd">function</code> <code class="nx">privateMethod2</code><code class="p">(){</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">_</code><code class="p">.</code><code class="nx">min</code><code class="p">([</code><code class="mi">10</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">1000</code><code class="p">])</code> <code class="p">);</code>
    <code class="p">}</code>
    
    <code class="k">return</code><code class="p">{</code>
        <code class="nx">publicMethod</code><code class="o">:</code> <code class="kd">function</code><code class="p">(){</code>
            <code class="nx">privateMethod1</code><code class="p">();</code>                
        <code class="p">}</code>            
    <code class="p">};</code>
   
<code class="c1">// Pull in jQuery and Underscore</code>
<code class="p">}(</code> <code class="nx">jQuery</code><code class="p">,</code> <code class="nx">_</code> <code class="p">));</code>

<code class="nx">myModule</code><code class="p">.</code><code class="nx">publicMethod</code><code class="p">();</code>
</pre></div><div class="sect3" title="Exports"><div class="titlepage"><div><div><h3 class="title"><a id="id441416"></a>Exports</h3></div></div></div><p>This next variation allows us to declare globals without
        consuming them and could similarly support the concept of global
        imports seen in the last example.</p><a id="I_programlisting9_d1e1988"></a><pre class="programlisting_javascript"><code class="c1">// Global module</code>
<code class="kd">var</code> <code class="nx">myModule</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

    <code class="c1">// Module object </code>
  <code class="kd">var</code> <code class="nx">module</code> <code class="o">=</code> <code class="p">{},</code>
    <code class="nx">privateVariable</code> <code class="o">=</code> <code class="s2">"Hello World"</code><code class="p">;</code>
  
  <code class="kd">function</code> <code class="nx">privateMethod</code><code class="p">()</code> <code class="p">{</code>
    <code class="c1">// ...</code>
  <code class="p">}</code>

  <code class="nx">module</code><code class="p">.</code><code class="nx">publicProperty</code> <code class="o">=</code> <code class="s2">"Foobar"</code><code class="p">;</code>
  <code class="nx">module</code><code class="p">.</code><code class="nx">publicMethod</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">privateVariable</code> <code class="p">);</code>
  <code class="p">};</code>
  
  <code class="k">return</code> <code class="nx">module</code><code class="p">;</code>

<code class="p">}());</code>
</pre></div><div class="sect3" title="Toolkit and framework-specific module pattern implementations"><div class="titlepage"><div><div><h3 class="title"><a id="id441430"></a>Toolkit and framework-specific module pattern
        implementations</h3></div></div></div><div class="sect4" title="Dojo"><div class="titlepage"><div><div><h4 class="title"><a id="id1893712"></a>Dojo</h4></div></div></div><p>Dojo <a id="I_indexterm9_d1e1999" class="indexterm"></a><a id="I_indexterm9_d1e2004" class="indexterm"></a>provides a convenience method for working with objects
          called <code class="literal">dojo.setObject()</code>. This
          takes as its first argument a dot-separated string such as <code class="literal">myObj.parent.child</code>, which refers to a
          property called <code class="literal">child</code> within an object
          <code class="literal">parent</code> defined inside <code class="literal">myObj</code>.
          Using <code class="literal">setObject()</code> allows us to
          set the value of children, creating any of the intermediate objects
          in the rest of the path passed if they don't already exist.</p><p>For example, if we wanted to declare <code class="literal">basket.core</code> as an object of the <code class="literal">store</code> namespace, this could be achieved as
          follows using the traditional way:</p><a id="I_programlisting9_d1e2037"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">store</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">store</code> <code class="o">||</code> <code class="p">{};</code>

<code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="nx">store</code><code class="p">[</code><code class="s2">"basket"</code><code class="p">]</code> <code class="p">)</code> <code class="p">{</code>
  <code class="nx">store</code><code class="p">.</code><code class="nx">basket</code> <code class="o">=</code> <code class="p">{};</code>
<code class="p">}</code>

<code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="nx">store</code><code class="p">.</code><code class="nx">basket</code><code class="p">[</code><code class="s2">"core"</code><code class="p">]</code> <code class="p">)</code> <code class="p">{</code>
  <code class="nx">store</code><code class="p">.</code><code class="nx">basket</code><code class="p">.</code><code class="nx">core</code> <code class="o">=</code> <code class="p">{};</code>
<code class="p">}</code>

<code class="nx">store</code><code class="p">.</code><code class="nx">basket</code><code class="p">.</code><code class="nx">core</code> <code class="o">=</code> <code class="p">{</code>
  <code class="c1">// ...rest of our logic</code>
<code class="p">};</code>
</pre><p>Or as follows using Dojo 1.7 (AMD-compatible version) and
          above:</p><a id="I_programlisting9_d1e2041"></a><pre class="programlisting_javascript"><code class="nx">require</code><code class="p">([</code><code class="s2">"dojo/_base/customStore"</code><code class="p">],</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">store</code> <code class="p">){</code>

  <code class="c1">// using dojo.setObject()</code>
  <code class="nx">store</code><code class="p">.</code><code class="nx">setObject</code><code class="p">(</code> <code class="s2">"basket.core"</code><code class="p">,</code> <code class="p">(</code><code class="kd">function</code><code class="p">()</code> <code class="p">{</code>

      <code class="kd">var</code> <code class="nx">basket</code> <code class="o">=</code> <code class="p">[];</code>

      <code class="kd">function</code> <code class="nx">privateMethod</code><code class="p">()</code> <code class="p">{</code>
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">basket</code><code class="p">);</code>
      <code class="p">}</code>

      <code class="k">return</code> <code class="p">{</code>
          <code class="nx">publicMethod</code><code class="o">:</code> <code class="kd">function</code><code class="p">(){</code>
                  <code class="nx">privateMethod</code><code class="p">();</code>
          <code class="p">}</code>
      <code class="p">};</code>

  <code class="p">}()));</code>

<code class="p">});</code>
</pre><p>For more information on <code class="literal">dojo.setObject()</code>, see the official <a class="ulink" href="http://dojotoolkit.org/reference-guide/1.7/dojo/setObject.html">documentation</a>.</p></div><div class="sect4" title="ExtJS"><div class="titlepage"><div><div><h4 class="title"><a id="id428464"></a>ExtJS</h4></div></div></div><p><a id="I_indexterm9_d1e2055" class="indexterm"></a>For those using Sencha's ExtJS, you're in for some
          luck, as the official documentation incorporates <a class="ulink" href="http://www.sencha.com/learn/legacy/Tutorial:Application_Layout_for_Beginners">examples</a>
          that demonstrate how to correctly use the Module pattern with the
          framework.</p><p>Here we can see an example of how to define a namespace
          <a id="I_indexterm9_d1e2064" class="indexterm"></a>that can then be populated with a module containing
          both a private and public API. With the exception of some semantic
          differences, it's quite close to how the Module pattern is
          implemented in vanilla JavaScript:</p><p><a id="I_programlisting9_d1e2071"></a></p><pre class="programlisting_javascript"><code class="c1">// create namespace</code>
<code class="nx">Ext</code><code class="p">.</code><code class="nx">namespace</code><code class="p">(</code><code class="s2">"myNameSpace"</code><code class="p">);</code>

<code class="c1">// create application</code>
<code class="nx">myNameSpace</code><code class="p">.</code><code class="nx">app</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

  <code class="c1">// do NOT access DOM from here; elements don't exist yet</code>
  <code class="c1">// private variables</code>

  <code class="kd">var</code> <code class="nx">btn1</code><code class="p">,</code>
      <code class="nx">privVar1</code> <code class="o">=</code> <code class="mi">11</code><code class="p">;</code>

  <code class="c1">// private functions</code>
  <code class="kd">var</code> <code class="nx">btn1Handler</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">button</code><code class="p">,</code> <code class="nx">event</code> <code class="p">)</code> <code class="p">{</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"privVar1"</code><code class="p">,</code> <code class="nx">privVar1</code> <code class="p">);</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"this.btn1Text="</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">btn1Text</code> <code class="p">);</code>
    <code class="p">};</code>

  <code class="c1">// public space</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="c1">// public properties, e.g. strings to translate</code>
    <code class="nx">btn1Text</code><code class="o">:</code> <code class="s2">"Button 1"</code><code class="p">,</code>

    <code class="c1">// public methods</code>
    <code class="nx">init</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

      <code class="k">if</code> <code class="p">(</code> <code class="nx">Ext</code><code class="p">.</code><code class="nx">Ext2</code> <code class="p">)</code> <code class="p">{</code>

        <code class="nx">btn1</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Ext</code><code class="p">.</code><code class="nx">Button</code><code class="p">({</code>
          <code class="nx">renderTo</code><code class="o">:</code> <code class="s2">"btn1-ct"</code><code class="p">,</code>
          <code class="nx">text</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">btn1Text</code><code class="p">,</code>
          <code class="nx">handler</code><code class="o">:</code> <code class="nx">btn1Handler</code>
        <code class="p">});</code>

      <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>

        <code class="nx">btn1</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Ext</code><code class="p">.</code><code class="nx">Button</code><code class="p">(</code> <code class="s2">"btn1-ct"</code><code class="p">,</code> <code class="p">{</code>
          <code class="nx">text</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">btn1Text</code><code class="p">,</code>
          <code class="nx">handler</code><code class="o">:</code> <code class="nx">btn1Handler</code>
        <code class="p">});</code>

      <code class="p">}</code>
    <code class="p">}</code>
  <code class="p">};</code>
<code class="p">}();</code>
</pre></div><div class="sect4" title="YUI"><div class="titlepage"><div><div><h4 class="title"><a id="id611757"></a>YUI</h4></div></div></div><p>Similarly, we can implement the Module pattern when building
          applications using YUI3.<a id="I_indexterm9_d1e2078" class="indexterm"></a> The following example is heavily based on the
          original YUI Module pattern implementation by Eric Miraglia, but
          again, isn't vastly different from the vanilla JavaScript
          version:</p><a id="I_programlisting9_d1e2082"></a><pre class="programlisting_javascript"><code class="nx">Y</code><code class="p">.</code><code class="nx">namespace</code><code class="p">(</code> <code class="s2">"store.basket"</code> <code class="p">)</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

    <code class="kd">var</code> <code class="nx">myPrivateVar</code><code class="p">,</code> <code class="nx">myPrivateMethod</code><code class="p">;</code>

    <code class="c1">// private variables:</code>
    <code class="nx">myPrivateVar</code> <code class="o">=</code> <code class="s2">"I can be accessed only within Y.store.basket."</code><code class="p">;</code>

    <code class="c1">// private method:</code>
    <code class="nx">myPrivateMethod</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
        <code class="nx">Y</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"I can be accessed only from within YAHOO.store.basket"</code> <code class="p">);</code>
    <code class="p">}</code>

    <code class="k">return</code> <code class="p">{</code>
        <code class="nx">myPublicProperty</code><code class="o">:</code> <code class="s2">"I'm a public property."</code><code class="p">,</code>

        <code class="nx">myPublicMethod</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
            <code class="nx">Y</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"I'm a public method."</code> <code class="p">);</code>

            <code class="c1">// Within basket, I can access "private" vars and methods:</code>
            <code class="nx">Y</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myPrivateVar</code> <code class="p">);</code>
            <code class="nx">Y</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myPrivateMethod</code><code class="p">()</code> <code class="p">);</code>

            <code class="c1">// The native scope of myPublicMethod is store so we can</code>
            <code class="c1">// access public members using "this":</code>
            <code class="nx">Y</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">myPublicProperty</code> <code class="p">);</code>
        <code class="p">}</code>
    <code class="p">};</code>

<code class="p">})();</code>
</pre></div><div class="sect4" title="jQuery"><div class="titlepage"><div><div><h4 class="title"><a id="id517805"></a>jQuery</h4></div></div></div><p>There are a number of ways in which jQuery <a id="I_indexterm9_d1e2089" class="indexterm"></a>code unspecific to plug-ins can be wrapped inside the
          Module pattern. Ben Cherry previously suggested an implementation in
          which a function wrapper is used around module definitions in the
          event of there being a number of commonalities between
          modules.</p><p>In the following example, a <code class="literal">library</code> function <a id="I_indexterm9_d1e2100" class="indexterm"></a><a id="I_indexterm9_d1e2105" class="indexterm"></a>is defined that declares a new library and
          automatically binds up the <code class="literal">init</code>
          function to <code class="literal">document.ready</code> when
          new libraries (i.e., modules) are created.<a id="I_indexterm9_d1e2117" class="indexterm"></a></p><a id="I_programlisting9_d1e2118"></a><pre class="programlisting_javascript"><code class="kd">function</code> <code class="nx">library</code><code class="p">(</code> <code class="nx">module</code> <code class="p">)</code> <code class="p">{</code>

  <code class="nx">$</code><code class="p">(</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code> <code class="nx">module</code><code class="p">.</code><code class="nx">init</code> <code class="p">)</code> <code class="p">{</code>
      <code class="nx">module</code><code class="p">.</code><code class="nx">init</code><code class="p">();</code>
    <code class="p">}</code>
  <code class="p">});</code>

  <code class="k">return</code> <code class="nx">module</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">var</code> <code class="nx">myLibrary</code> <code class="o">=</code> <code class="nx">library</code><code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">init</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="c1">// module implementation</code>
    <code class="p">}</code>
  <code class="p">};</code>
<code class="p">}());</code>
</pre></div></div><div class="sect3" title="Advantages"><div class="titlepage"><div><div><h3 class="title"><a id="id446175"></a>Advantages</h3></div></div></div><p><a id="I_indexterm9_d1e2124" class="indexterm"></a>We've seen why the Singleton pattern can be useful, but
        why is the Module pattern a good choice? For starters, it's a lot
        cleaner for developers coming from an object-oriented background than
        the idea of true encapsulation, at least from a JavaScript
        perspective.</p><p>Second, it supports private dataâ€”so, in the Module pattern,
        public parts of our code are able to touch the private parts, however
        the outside world is unable to touch the class's private parts (thanks
        to David Engfer for the joke).</p></div><div class="sect3" title="Disadvantages"><div class="titlepage"><div><div><h3 class="title"><a id="id613119"></a>Disadvantages</h3></div></div></div><p><a id="I_indexterm9_d1e2138" class="indexterm"></a>The disadvantages of the Module pattern are that, as we
        access both public and private members differently, when we wish to
        change visibility, we actually have to make changes to each place the
        member was used.</p><p>We also can't access private members in methods that are added
        to the object at a later point. That said, in many cases, the Module
        pattern is still quite useful and, when used correctly, certainly has
        the potential to improve the structure of our application.</p><p>Other disadvantages include the inability to create automated
        unit tests for private members and additional complexity when bugs
        require hot fixes. It's simply not possible to patch privates.
        Instead, one must override all public methods that interact with the
        buggy privates. Developers can't easily extend privates either, so
        it's worth remembering privates are not as flexible as they may
        initially appear.</p><p>For further reading on the Module pattern, see Ben Cherry's
        excellent in-depth <a class="ulink" href="http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth">article</a>.<a id="I_indexterm9_d1e2155" class="indexterm"></a></p></div></div><div class="footnotes"><br><hr><div class="footnote"><p><sup>[<a id="ftn.iife_footnote" href="#iife_footnote" class="para totri-footnote">1</a>] </sup><a class="ulink" href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">IIFE</a>.
            See <a class="xref" href="ch13s14.html" title="Namespacing Patterns">Namespacing Patterns</a> for more on
            this.</p></div></div></div>
		</div>
		<!--=========================
			END : POST
		=============================--><!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Revealing Module Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-revealing-module-pattern"></a>The Revealing Module Pattern</h1></div></div></div><p><a id="I_indexterm9_d1e2160" class="indexterm"></a><a id="I_indexterm9_d1e2163" class="indexterm"></a>Now that we're a little more familiar with the Module
    pattern, let's take a look at a slightly improved versionâ€”Christian
    Heilmann's Revealing Module pattern<a id="I_indexterm9_d1e2169" class="indexterm"></a>.</p><p>The Revealing Module pattern came about as Heilmann was frustrated
    with the fact that he had to repeat the name of the main object when he
    wanted to call one public method from another or access public variables.
    He also disliked the Module pattern's requirement of having to switch to
    object literal notation for the things he wished to make public.</p><p>The result of his efforts was an updated pattern in which he could
    simply define all functions and variables in the private scope and return
    an anonymous object with pointers to the private functionality he wished
    to reveal as public<a id="I_indexterm9_d1e2177" class="indexterm"></a><a id="I_indexterm9_d1e2182" class="indexterm"></a>.</p><p>An example of how to use the Revealing Module pattern is as
    follows:</p><a id="I_programlisting9_d1e2190"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myRevealingModule</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

        <code class="kd">var</code> <code class="nx">privateVar</code> <code class="o">=</code> <code class="s2">"Ben Cherry"</code><code class="p">,</code>
          <code class="nx">publicVar</code>  <code class="o">=</code> <code class="s2">"Hey there!"</code><code class="p">;</code>

        <code class="kd">function</code> <code class="nx">privateFunction</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"Name:"</code> <code class="o">+</code> <code class="nx">privateVar</code> <code class="p">);</code>
        <code class="p">}</code>
        
        <code class="kd">function</code> <code class="nx">publicSetName</code><code class="p">(</code> <code class="nx">strName</code> <code class="p">)</code> <code class="p">{</code>
            <code class="nx">privateName</code> <code class="o">=</code> <code class="nx">strName</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="kd">function</code> <code class="nx">publicGetName</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">privateFunction</code><code class="p">();</code>
        <code class="p">}</code>


        <code class="c1">// Reveal public pointers to  </code>
        <code class="c1">// private functions and properties</code>

        <code class="k">return</code> <code class="p">{</code>
            <code class="nx">setName</code><code class="o">:</code> <code class="nx">publicSetName</code><code class="p">,</code>
            <code class="nx">greeting</code><code class="o">:</code> <code class="nx">publicVar</code><code class="p">,</code>
            <code class="nx">getName</code><code class="o">:</code> <code class="nx">publicGetName</code>
        <code class="p">};</code>

    <code class="p">}();</code>

<code class="nx">myRevealingModule</code><code class="p">.</code><code class="nx">setName</code><code class="p">(</code> <code class="s2">"Paul Kinlan"</code> <code class="p">);</code>
</pre><p>The pattern can also be used to reveal private functions and
    properties with a more specific naming scheme if you would prefer:</p><a id="I_programlisting9_d1e2194"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myRevealingModule</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

        <code class="kd">var</code> <code class="nx">privateCounter</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

        <code class="kd">function</code> <code class="nx">privateFunction</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">privateCounter</code><code class="o">++</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="kd">function</code> <code class="nx">publicFunction</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">publicIncrement</code><code class="p">();</code>
        <code class="p">}</code>

        <code class="kd">function</code> <code class="nx">publicIncrement</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">privateFunction</code><code class="p">();</code>
        <code class="p">}</code>

        <code class="kd">function</code> <code class="nx">publicGetCount</code><code class="p">(){</code>
          <code class="k">return</code> <code class="nx">privateCounter</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="c1">// Reveal public pointers to </code>
        <code class="c1">// private functions and properties        </code>

       <code class="k">return</code> <code class="p">{</code>
            <code class="nx">start</code><code class="o">:</code> <code class="nx">publicFunction</code><code class="p">,</code>
            <code class="nx">increment</code><code class="o">:</code> <code class="nx">publicIncrement</code><code class="p">,</code>
            <code class="nx">count</code><code class="o">:</code> <code class="nx">publicGetCount</code>
        <code class="p">};</code>

    <code class="p">}();</code>

<code class="nx">myRevealingModule</code><code class="p">.</code><code class="nx">start</code><code class="p">();</code>
</pre><div class="sect2" title="Advantages"><div class="titlepage"><div><div><h2 class="title"><a id="id1564954"></a>Advantages</h2></div></div></div><p>This pattern allows the syntax of our scripts to be more
      consistent. It also makes it easier to tell at the end of the module
      which of our functions and variables may be accessed publicly, which
      eases readability.</p></div><div class="sect2" title="Disadvantages"><div class="titlepage"><div><div><h2 class="title"><a id="id573218"></a>Disadvantages</h2></div></div></div><p>A disadvantage of this pattern is that if a private function
      refers to a public function,<a id="I_indexterm9_d1e2206" class="indexterm"></a><a id="I_indexterm9_d1e2209" class="indexterm"></a> that public function can't be overridden if a patch is
      necessary. This is because the private function will continue to refer
      to the private implementation, and the pattern doesn't apply to public
      members, only to functions.</p><p>Public object members that refer to private variables are also
      subject to the no-patch rule.</p><p>As a result of this, modules created with the Revealing Module
      pattern may be more fragile than those created with the original Module
      pattern, so care should be taken during usage.</p></div></div>
		</div>
		<!--=========================
			END : POST
		=============================--><!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<div class="sect1" title="Namespacing Fundamentals"><div class="titlepage"><div><div><h1 class="title"><a id="namespacing-fundamentals"></a>Namespacing Fundamentals</h1></div></div></div><p>Namespaces can be found in almost any serious JavaScript
    application. Unless we're working with a simple code snippet, it's
    imperative that we do our best to ensure that we're implementing
    namespacing correctly, as it's not just simple to pick up, it'll also
    avoid third-party code clobbering our own. The patterns we'll be examining
    in this section are:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Single global variables</p></li><li class="listitem"><p>Prefix namespacing</p></li><li class="listitem"><p>Object literal notation</p></li><li class="listitem"><p>Nested namespacing</p></li><li class="listitem"><p>Immediately-invoked Function</p></li><li class="listitem"><p>Expressions</p></li><li class="listitem"><p>Namespace injection</p></li></ol></div><div class="sect2" title="Single Global Variables"><div class="titlepage"><div><div><h2 class="title"><a id="single-global-variables"></a>Single Global Variables</h2></div></div></div><p><a id="I_indexterm13_d1e8743" class="indexterm"></a><a id="I_indexterm13_d1e8750" class="indexterm"></a><a id="I_indexterm13_d1e8755" class="indexterm"></a>One popular pattern for namespacing in JavaScript is
      opting for a single global variable as our primary object of reference.
      A skeleton implementation of this where we return an object with
      functions and properties can be found below:</p><a id="I_programlisting13_d1e8761"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myApplication</code> <code class="o">=</code>  <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code> 
        <code class="kd">function</code><code class="p">(){</code>
            <code class="c1">//...</code>
        <code class="p">},</code>
        <code class="k">return</code><code class="p">{</code>
            <code class="c1">//...</code>
        <code class="p">}</code>
<code class="p">})();</code>
</pre><p>Although this works for certain situations, the biggest challenge
      with the single global variable pattern is ensuring that no one else has
      used the same global variable name as we have in the page.</p></div><div class="sect2" title="Prefix Namespacing"><div class="titlepage"><div><div><h2 class="title"><a id="prefix-namespacing"></a>Prefix Namespacing</h2></div></div></div><p><a id="I_indexterm13_d1e8769" class="indexterm"></a><a id="I_indexterm13_d1e8776" class="indexterm"></a><a id="I_indexterm13_d1e8781" class="indexterm"></a>One solution to the above problem, as mentioned by <a class="ulink" href="http://michaux.ca/articles/javascript-namespacing">Peter
      Michaux</a>, is to use prefix namespacing. It's a simple concept at
      heart, but the idea is we select a unique prefix namespace we wish to
      use (in this example, <code class="literal">myApplication_</code>)
      and then define any methods, variables, or other objects after the
      prefix as follows:</p><a id="I_programlisting13_d1e8791"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myApplication_propertyA</code> <code class="o">=</code> <code class="p">{};</code>
<code class="kd">var</code> <code class="nx">myApplication_propertyB</code> <code class="o">=</code> <code class="p">{};</code>
<code class="kd">function</code> <code class="nx">myApplication_myMethod</code><code class="p">(){</code> 
  <code class="c1">//...</code>
<code class="p">}</code>
</pre><p>This is effective from the perspective of decreasing the chances
      of a particular variable existing in the global scope, but remember that
      a uniquely named object can have the same effect.</p><p>This aside, the biggest issue with the pattern is that it can
      result in a large number of global objects once our application starts
      to grow. There is also quite a heavy reliance on our prefix not being
      used by any other developers in the global namespace, so be careful if
      opting to use this.</p><p>For more on Peter's views about the single global variable
      pattern, read his excellent post on them: <a class="ulink" href="http://michaux.ca/articles/javascript-namespacing">http://michaux.ca/articles/javascript-namespacing</a>.</p></div><div class="sect2" title="Object Literal Notation"><div class="titlepage"><div><div><h2 class="title"><a id="object-literal-notation"></a>Object Literal Notation</h2></div></div></div><p><a id="index-837J624QT1M" class="indexterm"></a><a id="index-343V563PF0Q" class="indexterm"></a><a id="index-702F878FM3P" class="indexterm"></a>Object literal notation, which we also cover in the Module
      pattern section, can be thought of as an object containing a collection
      of key-value pairs with a colon separating each pair of keys and values,
      where keys can also represent new namespaces.</p><a id="I_programlisting13_d1e8823"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myApplication</code> <code class="o">=</code> <code class="p">{</code>

    <code class="c1">// As we've seen, we can easily define functionality for</code>
    <code class="c1">// this object literal..</code>
    <code class="nx">getInfo</code><code class="o">:</code><code class="kd">function</code><code class="p">(){</code> 
      <code class="c1">//...</code>
    <code class="p">},</code>

    <code class="c1">// but we can also populate it to support </code>
    <code class="c1">// further object namespaces containing anything</code>
    <code class="c1">// anything we wish:</code>
    <code class="nx">models</code> <code class="o">:</code> <code class="p">{},</code>
    <code class="nx">views</code> <code class="o">:</code> <code class="p">{</code>
        <code class="nx">pages</code> <code class="o">:</code> <code class="p">{}</code>
    <code class="p">},</code>
    <code class="nx">collections</code> <code class="o">:</code> <code class="p">{}</code>
<code class="p">};</code>
</pre><p>One can also opt for adding properties directly to the
      namespace:</p><a id="I_programlisting13_d1e8827"></a><pre class="programlisting_javascript"><code class="nx">myApplication</code><code class="p">.</code><code class="nx">foo</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(){</code>
    <code class="k">return</code> <code class="s2">"bar"</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">myApplication</code><code class="p">.</code><code class="nx">utils</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">toString</code><code class="o">:</code><code class="kd">function</code><code class="p">(){</code>
        <code class="c1">//...</code>
    <code class="p">},</code>
    <code class="kr">export</code><code class="o">:</code> <code class="kd">function</code><code class="p">(){</code>
        <code class="c1">//...</code>
    <code class="p">}</code>
<code class="p">}</code>
</pre><p>Object literals <a id="I_indexterm13_d1e8831" class="indexterm"></a>have the advantage of not polluting the global namespace
      but assist in organizing code and parameters logically. They are truly
      beneficial if you wish to create easily readable structures that can be
      expanded to support deep nesting. Unlike simple global variables, object
      literals often also take into account tests for the existence of a
      variable by the same name, so the chances of collision occurring are
      significantly reduced.</p><p>The next sample demonstrates a number of different ways in which
      you can check to see if an object namespace already exists, defining it
      if it doesn't.</p><a id="I_programlisting13_d1e8842"></a><pre class="programlisting_javascript"><code class="c1">// This doesn't check for existence of "myApplication" in</code>
<code class="c1">// the global namespace. Bad practice as we can easily</code>
<code class="c1">// clobber an existing variable/namespace with the same name</code>
<code class="kd">var</code> <code class="nx">myApplication</code> <code class="o">=</code> <code class="p">{};</code>

<code class="c1">// The following options *do* check for variable/namespace existence. </code>
<code class="c1">// If already defined, we use that instance, otherwise we assign a new </code>
<code class="c1">// object literal to myApplication.</code>
<code class="c1">// </code>
<code class="c1">// Option 1: var myApplication = myApplication || {};</code>
<code class="c1">// Option 2  if( !MyApplication ){ MyApplication = {} };</code>
<code class="c1">// Option 3: window.myApplication || ( window.myApplication = {} );</code>
<code class="c1">// Option 4: var myApplication = $.fn.myApplication = function() {};</code>
<code class="c1">// Option 5: var myApplication = myApplication === undefined ? {} : myApplication;</code>
</pre><p>You'll often see developers opting for Option 1 or Option 2â€”they
      are both straightforward and are equivalent in terms of their end
      result.</p><p>Option 3 assumes that you're working in the global namespace, but
      it can also be written as:</p><a id="I_programlisting13_d1e8848"></a><pre class="programlisting_javascript"><code class="nx">myApplication</code> <code class="o">||</code> <code class="p">(</code><code class="nx">myApplication</code> <code class="o">=</code> <code class="p">{});</code>
</pre><p>This variation assumes that <code class="literal">myApplication</code> has
      already been initialized, so it's only really useful for a
      parameter/argument scenario, as in the following example:</p><p><a id="I_programlisting13_d1e8857"></a></p><pre class="programlisting">function foo() {
  myApplication || ( myApplication = {} );
}

// myApplication hasn't been initialized, 
// so foo() throws a ReferenceError

foo(); 

// However accepting myApplication as an
// argument

function foo( myApplication ) {
  myApplication || ( myApplication = {} );
}

foo();

// Even if myApplication === undefined, there is no error
// and myApplication gets set to {} correctly </pre><p>Options 4 can be useful for writing jQuery plug-ins where:</p><a id="I_programlisting13_d1e8861"></a><pre class="programlisting">// If we were to define a new plug-in..
var myPlugin = $.fn.myPlugin = function() { ... };

// Then later rather than having to type:
$.fn.myPlugin.defaults = {};

// We can do:
myPlugin.defaults = {};</pre><p>This results in better compression (minification) and can save on
      scope lookups.</p><p>Option 5 is a little similar to Option 4, but is a long form that
      evaluates whether <code class="literal">myApplication</code> is
      <code class="literal">undefined</code> inlineâ€”such that it's defined as an object
      if notâ€”and set to an existing value for <code class="literal">myApplication</code>
      if so.</p><p>It is shown just for the sake of being thorough, but in most
      situations, Options 1â€“4 will more than suffice for most needs.</p><p>There is, of course, a great deal of variance in how and where
      object literals are used for organizing and structuring code. For
      smaller applications wishing to expose a nested API for a particular
      self-enclosed module, you may just find yourself using the Revealing
      Module pattern, which we covered earlier in the book:</p><p><a id="I_programlisting13_d1e8881"></a></p><pre class="programlisting">var namespace = (function () {

    // defined within the local scope
    var privateMethod1 = function () { /* ... */ },
        privateMethod2 = function () { /* ... */ }
        privateProperty1 = "foobar";

    return {

        // the object literal returned here can have as many 
        // nested depths as we wish, however as mentioned, 
        // this way of doing things works best for smaller, 
        // limited-scope applications in my personal opinion
        publicMethod1: privateMethod1,

        // nested namespace with public properties
        properties:{
            publicProperty1: privateProperty1
        },

        // another tested namespace
        utils:{
            publicMethod2: privateMethod2
        }
        ...
    }
})();</pre><p>The benefit of using object literals here is that they
      offer us a very elegant key/value syntax to work with; one where we're
      able to easily encapsulate any distinct logic or functionality for our
      application in a way that clearly separates it from others and provides
      a solid foundation for extending our code.</p><a id="I_programlisting13_d1e8884"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myConfig</code> <code class="o">=</code> <code class="p">{</code>

    <code class="nx">language</code><code class="o">:</code> <code class="s2">"english"</code><code class="p">,</code>

    <code class="nx">defaults</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">enableGeolocation</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
        <code class="nx">enableSharing</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
        <code class="nx">maxPhotos</code><code class="o">:</code> <code class="mi">20</code>
    <code class="p">},</code>

    <code class="nx">theme</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">skin</code><code class="o">:</code> <code class="s2">"a"</code><code class="p">,</code>
        <code class="nx">toolbars</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">index</code><code class="o">:</code> <code class="s2">"ui-navigation-toolbar"</code><code class="p">,</code>
            <code class="nx">pages</code><code class="o">:</code> <code class="s2">"ui-custom-toolbar"</code>    
        <code class="p">}</code>
    <code class="p">}</code>

<code class="p">}</code>
</pre><p>Note that JSON <a id="I_indexterm13_d1e8888" class="indexterm"></a><a id="I_indexterm13_d1e8891" class="indexterm"></a>is a subset of object literal notation, and there are
      really only minor syntactical differences between it and the above
      (e.g., JSON keys must be strings). If, for
      any reason, one wishes to use JSON for storing configuration
      data instead (e.g., for simpler storage when sending to the backend),
      feel free to. For more on the object literal pattern, I recommend
      reading Rebecca Murphey's excellent <a class="ulink" href="http://rmurphey.com/blog/2009/10/15/using-objects-to-organize-your-code/">article
      on the topic</a>, as she covers a few areas we didn't touch
      upon.<a id="I_indexterm13_d1e8903" class="indexterm"></a><a id="I_indexterm13_d1e8904" class="indexterm"></a><a id="I_indexterm13_d1e8905" class="indexterm"></a></p></div><div class="sect2" title="Nested Namespacing"><div class="titlepage"><div><div><h2 class="title"><a id="nested-namespacing"></a>Nested Namespacing</h2></div></div></div><p><a id="I_indexterm13_d1e8910" class="indexterm"></a><a id="I_indexterm13_d1e8917" class="indexterm"></a><a id="I_indexterm13_d1e8922" class="indexterm"></a>An extension of the object literal pattern is nested
      namespacing. It's another common pattern used that offers a lower risk
      of collision <a id="I_indexterm13_d1e8930" class="indexterm"></a>due to the fact that even if a namespace already exists,
      it's unlikely the same nested children do.</p><p>Does this look familiar?</p><a id="I_programlisting13_d1e8936"></a><pre class="programlisting_javascript"><code class="nx">YAHOO</code><code class="p">.</code><code class="nx">util</code><code class="p">.</code><code class="nx">Dom</code><code class="p">.</code><code class="nx">getElementsByClassName</code><code class="p">(</code><code class="s2">"test"</code><code class="p">);</code>
</pre><p>Older versions of Yahoo!'s YUI library use the nested object
      namespacing pattern regularly. During my time as an engineer at AOL, we
      also used this pattern in many of our larger applications. A sample
      implementation of nested namespacing may look like this:</p><a id="I_programlisting13_d1e8940"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myApp</code> <code class="o">=</code>  <code class="nx">myApp</code> <code class="o">||</code> <code class="p">{};</code>
 
<code class="c1">// perform a similar existence check when defining nested </code>
<code class="c1">// children</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">routers</code> <code class="o">=</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">routers</code> <code class="o">||</code> <code class="p">{};</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">model</code> <code class="o">=</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">model</code> <code class="o">||</code> <code class="p">{};</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">special</code> <code class="o">=</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">special</code> <code class="o">||</code> <code class="p">{};</code>

<code class="c1">// nested namespaces can be as complex as required:</code>
<code class="c1">// myApp.utilities.charting.html5.plotGraph(/*..*/);</code>
<code class="c1">// myApp.modules.financePlanner.getSummary();</code>
<code class="c1">// myApp.services.social.facebook.realtimeStream.getLatest();</code>
</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>The above differs from how YUI3 approaches namespacing as
          modules there use a sandboxed API host object with far less and far
          shallower namespacing.</p></div><p>We can also opt to declare new nested namespaces/properties as
      indexed properties as follows:</p><a id="I_programlisting13_d1e8948"></a><pre class="programlisting_javascript"><code class="nx">myApp</code><code class="p">[</code><code class="s2">"routers"</code><code class="p">]</code> <code class="o">=</code> <code class="nx">myApp</code><code class="p">[</code><code class="s2">"routers"</code><code class="p">]</code> <code class="o">||</code> <code class="p">{};</code> 
<code class="nx">myApp</code><code class="p">[</code><code class="s2">"models"</code><code class="p">]</code> <code class="o">=</code> <code class="nx">myApp</code><code class="p">[</code><code class="s2">"models"</code><code class="p">]</code> <code class="o">||</code> <code class="p">{};</code> 
<code class="nx">myApp</code><code class="p">[</code><code class="s2">"controllers"</code><code class="p">]</code> <code class="o">=</code> <code class="nx">myApp</code><code class="p">[</code><code class="s2">"controllers"</code><code class="p">]</code> <code class="o">||</code> <code class="p">{};</code>
</pre><p>Both options are readable, organized, and offer a relatively safe
      way of namespacing our application in a similar fashion to what we may
      be used to in other languages. The only real caveat, however, is that it
      requires our browser's JavaScript engine first locating the
      <code class="literal">myApp</code> object and then digging down until it gets to
      the function we actually wish to use.</p><p>This can mean an increased amount of work to perform lookups;
      however, developers such as <a class="ulink" href="http://twitter.com/kangax">Juriy
      Zaytsev</a> have previously tested and found the performance
      differences between single object namespacing versus the "nested"
      approach to be quite negligible.</p></div><div class="sect2" title="Immediately Invoked Function Expressions (IIFE)s"><div class="titlepage"><div><div><h2 class="title"><a id="immediately-invoked-function-expressions-iifes"></a>Immediately Invoked Function Expressions (IIFE)s</h2></div></div></div><p><a id="index-413O758IG0T" class="indexterm"></a><a id="index-577L526KF8N" class="indexterm"></a><a id="index-254V705DW5O" class="indexterm"></a>Earlier in the book, we briefly covered the concept of an
      immediately invoked function expression; <a class="ulink" href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">IIFE</a>,
      which is effectively an unnamed function, immediately invoked after it's
      been defined. If it sounds familiar it's because you may have previous
      come across it referred to as a self-executing (or self-invoked)
      anonymous function, however I personally feel Ben Alman's IIFE naming is
      more accurate. In JavaScript, because both variables and functions
      explicitly defined within such a context may only be accessed inside of
      it, function invocation provides an easy means to achieving
      privacy.</p><p>IIFEs are a popular approach to encapsulating application logic to
      protect it from the global namespace but also have their use in the
      world of namespacing.</p><p>Examples of IIFEs can be found below:</p><a id="I_programlisting13_d1e8987"></a><pre class="programlisting_javascript"><code class="c1">// an (anonymous) immediately-invoked function expression</code>
<code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code> <code class="cm">/*...*/</code><code class="p">})();</code>

<code class="c1">// a named immediately-invoked function expression</code>
<code class="p">(</code><code class="kd">function</code> <code class="nx">foobar</code> <code class="p">()</code> <code class="p">{</code> <code class="cm">/*..*/</code><code class="p">}());</code>

<code class="c1">// this is technically a self-executing function which is quite different</code>
<code class="kd">function</code> <code class="nx">foobar</code> <code class="p">()</code> <code class="p">{</code> <code class="nx">foobar</code><code class="p">();</code> <code class="p">}</code>
</pre><p>while a slightly more expanded version of the first example might
      look like:</p><a id="I_programlisting13_d1e8991"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">namespace</code> <code class="o">=</code> <code class="nx">namespace</code> <code class="o">||</code> <code class="p">{};</code>

<code class="c1">// here a namespace object is passed as a function </code>
<code class="c1">// parameter, where we assign public methods and </code>
<code class="c1">// properties to it</code>
<code class="p">(</code><code class="kd">function</code><code class="p">(</code> <code class="nx">o</code> <code class="p">){</code>    
    <code class="nx">o</code><code class="p">.</code><code class="nx">foo</code> <code class="o">=</code> <code class="s2">"foo"</code><code class="p">;</code>
    <code class="nx">o</code><code class="p">.</code><code class="nx">bar</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(){</code>
        <code class="k">return</code> <code class="s2">"bar"</code><code class="p">;</code>    
    <code class="p">};</code>
<code class="p">})(</code> <code class="nx">namespace</code> <code class="p">);</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">namespace</code> <code class="p">);</code>
</pre><p>Whilst readable, this example could be significantly expanded on
      to address common development concerns such as defined levels of privacy
      (public/private functions and variables) as well as convenient namespace
      extension. Let's go through some more code:</p><a id="I_programlisting13_d1e8995"></a><pre class="programlisting_javascript"><code class="c1">// namespace (our namespace name) and undefined are passed here </code>
<code class="c1">// to ensure 1. namespace can be modified locally and isn't </code>
<code class="c1">// overwritten outside of our function context</code>
<code class="c1">// 2. the value of undefined is guaranteed as being truly </code>
<code class="c1">// undefined. This is to avoid issues with undefined being </code>
<code class="c1">// mutable pre-ES5.</code>

<code class="p">;(</code><code class="kd">function</code> <code class="p">(</code> <code class="nx">namespace</code><code class="p">,</code> <code class="kc">undefined</code> <code class="p">)</code> <code class="p">{</code>

    <code class="c1">// private properties</code>
    <code class="kd">var</code> <code class="nx">foo</code> <code class="o">=</code> <code class="s2">"foo"</code><code class="p">,</code> 
        <code class="nx">bar</code> <code class="o">=</code> <code class="s2">"bar"</code><code class="p">;</code>

    <code class="c1">// public methods and properties</code>
    <code class="nx">namespace</code><code class="p">.</code><code class="nx">foobar</code> <code class="o">=</code> <code class="s2">"foobar"</code><code class="p">;</code>
    <code class="nx">namespace</code><code class="p">.</code><code class="nx">sayHello</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
        <code class="nx">speak</code><code class="p">(</code> <code class="s2">"hello world"</code> <code class="p">);</code>
    <code class="p">};</code>

    <code class="c1">// private method</code>
    <code class="kd">function</code> <code class="nx">speak</code><code class="p">(</code><code class="nx">msg</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"You said: "</code> <code class="o">+</code> <code class="nx">msg</code> <code class="p">);</code>
    <code class="p">};</code>

    <code class="c1">// check to evaluate whether "namespace" exists in the </code>
    <code class="c1">// global namespace - if not, assign window.namespace an </code>
    <code class="c1">// object literal</code>

<code class="p">}(</code> <code class="nb">window</code><code class="p">.</code><code class="nx">namespace</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">namespace</code> <code class="o">||</code> <code class="p">{}</code> <code class="p">));</code>


<code class="c1">// we can then test our properties and methods as follows</code>

<code class="c1">// public</code>

<code class="c1">// Outputs: foobar</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">namespace</code><code class="p">.</code><code class="nx">foobar</code> <code class="p">);</code>

<code class="c1">// Outputs: hello world</code>
<code class="nx">namescpace</code><code class="p">.</code><code class="nx">sayHello</code><code class="p">();</code>

<code class="c1">// assigning new properties</code>
<code class="nx">namespace</code><code class="p">.</code><code class="nx">foobar2</code> <code class="o">=</code> <code class="s2">"foobar"</code><code class="p">;</code>

<code class="c1">// Outputs: foobar</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">namespace</code><code class="p">.</code><code class="nx">foobar2</code> <code class="p">);</code>
</pre><p>Extensibility is of course key to any scalable namespacing pattern
      and IIFEs can be used to achieve this quite easily. In the below
      example, our "namespace" is once again passed as an argument to our
      anonymous function and is then extended (or decorated) with further
      functionality:</p><a id="I_programlisting13_d1e8999"></a><pre class="programlisting_javascript"><code class="c1">// let's extend the namespace with new functionality</code>
<code class="p">(</code><code class="kd">function</code><code class="p">(</code> <code class="nx">namespace</code><code class="p">,</code> <code class="kc">undefined</code> <code class="p">){</code>

    <code class="c1">// public method</code>
    <code class="nx">namespace</code><code class="p">.</code><code class="nx">sayGoodbye</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">namespace</code><code class="p">.</code><code class="nx">foo</code> <code class="p">);</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">namespace</code><code class="p">.</code><code class="nx">bar</code> <code class="p">);</code>
        <code class="nx">speak</code><code class="p">(</code> <code class="s2">"goodbye"</code> <code class="p">);</code>
    <code class="p">}</code>    
<code class="p">}(</code> <code class="nb">window</code><code class="p">.</code><code class="nx">namespace</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">namespace</code> <code class="o">||</code> <code class="p">{});</code>

<code class="nx">namespace</code><code class="p">.</code><code class="nx">sayGoodbye</code><code class="p">();</code> <code class="c1">// goodbye</code>
</pre><p>If you would like to find out more about this pattern, I recommend
      reading Ben's <a class="ulink" href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">IIFE
      post</a> for more information.<a id="I_indexterm13_d1e9007" class="indexterm"></a><a id="I_indexterm13_d1e9008" class="indexterm"></a><a id="I_indexterm13_d1e9009" class="indexterm"></a></p></div><div class="sect2" title="Namespace Injection"><div class="titlepage"><div><div><h2 class="title"><a id="namespace-injection"></a>Namespace Injection</h2></div></div></div><p><a id="I_indexterm13_d1e9014" class="indexterm"></a><a id="I_indexterm13_d1e9021" class="indexterm"></a><a id="I_indexterm13_d1e9026" class="indexterm"></a>Namespace injection is another variation on the IIFE in
      which we "inject" the methods and properties for a specific namespace
      from within a function wrapper using <code class="literal">this</code> as a
      namespace proxy. The benefit this pattern offers is easy application of
      functional behavior to multiple objects or namespaces and can come in
      useful when applying a set of base methods to be built on later (e.g.,
      getters and setters).</p><p>The disadvantages of this pattern are that there may be easier or
      more optimal approaches to achieving this goal (e.g., deep object
      extension or merging), which I cover earlier in the section.</p><p>Below we can see an example of this pattern in action, where we
      use it to populate the behavior for two namespaces: one initially
      defined (<code class="literal">utils</code>) and another which we dynamically
      create as a part of the functionality assignment for
      <code class="literal">utils</code> (a new namespace called
      <code class="literal">tools</code>).</p><a id="I_programlisting13_d1e9046"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myApp</code> <code class="o">=</code> <code class="nx">myApp</code> <code class="o">||</code> <code class="p">{};</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">utils</code> <code class="o">=</code>  <code class="p">{};</code>

<code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">val</code> <code class="o">=</code> <code class="mi">5</code><code class="p">;</code>

  <code class="k">this</code><code class="p">.</code><code class="nx">getValue</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="nx">val</code><code class="p">;</code>
  <code class="p">};</code>
   
  <code class="k">this</code><code class="p">.</code><code class="nx">setValue</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">newVal</code> <code class="p">)</code> <code class="p">{</code>
      <code class="nx">val</code> <code class="o">=</code> <code class="nx">newVal</code><code class="p">;</code>
  <code class="p">}</code>
      
  <code class="c1">// also introduce a new sub-namespace</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">tools</code> <code class="o">=</code> <code class="p">{};</code>
    
<code class="p">}).</code><code class="nx">apply</code><code class="p">(</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">utils</code> <code class="p">);</code>  

<code class="c1">// inject new behaviour into the tools namespace</code>
<code class="c1">// which we defined via the utilities module</code>

<code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">diagnose</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(){</code>
        <code class="k">return</code> <code class="s2">"diagnosis"</code><code class="p">;</code>   
    <code class="p">}</code>
<code class="p">}).</code><code class="nx">apply</code><code class="p">(</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">utils</code><code class="p">.</code><code class="nx">tools</code> <code class="p">);</code>

<code class="c1">// note, this same approach to extension could be applied</code>
<code class="c1">// to a regular IIFE, by just passing in the context as </code>
<code class="c1">// an argument and modifying the context rather than just</code>
<code class="c1">// "this"</code>

<code class="c1">// Usage:</code>

<code class="c1">// Outputs our populated namespace</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myApp</code> <code class="p">);</code>

<code class="c1">// Outputs: 5</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">utils</code><code class="p">.</code><code class="nx">getValue</code><code class="p">()</code> <code class="p">);</code>

<code class="c1">// Sets the value of `val` and returns it</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">utils</code><code class="p">.</code><code class="nx">setValue</code><code class="p">(</code> <code class="mi">25</code> <code class="p">);</code> 
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">utils</code><code class="p">.</code><code class="nx">getValue</code><code class="p">()</code> <code class="p">);</code>

<code class="c1">// Testing another level down</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">utils</code><code class="p">.</code><code class="nx">tools</code><code class="p">.</code><code class="nx">diagnose</code><code class="p">()</code> <code class="p">);</code>
</pre><p>Angus Croll has also suggested the idea of using the call API to
      provide a natural separation between contexts and arguments <a class="ulink" href="http://msdn.microsoft.com/en-us/scriptjunkie/gg578608">previously</a>.
      This pattern can feel a lot more like a module creator, but as modules
      still offer an encapsulation solution, we'll briefly cover it for the
      sake of thoroughness:</p><a id="I_programlisting13_d1e9053"></a><pre class="programlisting_javascript"><code class="c1">// define a namespace we can use later</code>
<code class="kd">var</code> <code class="nx">ns</code> <code class="o">=</code> <code class="nx">ns</code> <code class="o">||</code> <code class="p">{},</code> 
    <code class="nx">ns2</code> <code class="o">=</code> <code class="nx">ns2</code> <code class="o">||</code> <code class="p">{};</code>

<code class="c1">// the module/namespace creator</code>
<code class="kd">var</code> <code class="nx">creator</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">val</code> <code class="p">){</code>

    <code class="kd">var</code> <code class="nx">val</code> <code class="o">=</code> <code class="nx">val</code> <code class="o">||</code> <code class="mi">0</code><code class="p">;</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">next</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
        <code class="k">return</code> <code class="nx">val</code><code class="o">++</code>
    <code class="p">};</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">reset</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
        <code class="nx">val</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nx">creator</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code> <code class="nx">ns</code> <code class="p">);</code>

<code class="c1">// ns.next, ns.reset now exist</code>
<code class="nx">creator</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code> <code class="nx">ns2</code> <code class="p">,</code> <code class="mi">5000</code> <code class="p">);</code>

<code class="c1">// ns2 contains the same methods</code>
<code class="c1">// but has an overridden value for val</code>
<code class="c1">// of 5000</code>
</pre><p>As mentioned, this type of pattern is useful for assigning a
      similar base set of functionality to multiple modules or namespaces. I
      would however only really suggest using it where explicitly declaring
      functionality within an object/closure for direct access doesn't make
      sense.</p></div></div>
		</div>
		<!--=========================
			END : POST
		=============================--><!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="Advanced Namespacing Patterns"><div class="titlepage"><div><div><h1 class="title"><a id="advanced-namespacing-patterns"></a>Advanced Namespacing Patterns</h1></div></div></div><p>We'll now explore some advanced patterns and utilities that I have
    found invaluable when working on larger applications, some of which have
    required a rethink of traditional approaches to application namespacing.
    I'll note that I am not advocating any of the following as
    <span class="emphasis"><em>the</em></span> way to namespace, but rather ways that I have
    found work in practice.</p><div class="sect2" title="Automating Nested Namespacing"><div class="titlepage"><div><div><h2 class="title"><a id="automating-nested-namespacing"></a>Automating Nested Namespacing</h2></div></div></div><p><a id="I_indexterm13_d1e9069" class="indexterm"></a><a id="I_indexterm13_d1e9076" class="indexterm"></a><a id="I_indexterm13_d1e9083" class="indexterm"></a>As we've reviewed, nested namespaces can provide an
      organized hierarchy of structure for a unit of code. An example of such
      a namespace could be the following:
      <em class="replaceable"><code>application.utilities.drawing.canvas.2d</code></em>. This
      can also be expanded using the object literal pattern to be:</p><a id="I_programlisting13_d1e9092"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">application</code> <code class="o">=</code> <code class="p">{</code>
      <code class="nx">utilities</code><code class="o">:</code><code class="p">{</code>
          <code class="nx">drawing</code><code class="o">:</code><code class="p">{</code>
              <code class="nx">canvas</code><code class="o">:</code><code class="p">{</code>
                  <code class="mi">2</code><code class="nx">d</code><code class="o">:</code><code class="p">{</code>
                          <code class="c1">//...</code>
                  <code class="p">}</code>
              <code class="p">}</code>
          <code class="p">}</code>
    <code class="p">}</code>        
<code class="p">};</code>
</pre><p>One of the obvious challenges with this pattern is that each
      additional layer we wish to create requires yet another object to be
      defined as a child of some parent in our top-level namespace. This can
      become particularly laborious when multiple depths are required as our
      application increases in complexity.</p><p>How can this problem be better solved? In <a class="ulink" href="http://www.amazon.com/JavaScript-Patterns-Stoyan-Stefanov/dp/0596806752">JavaScript
      Patterns</a>, <a class="ulink" href="http://jspatterns.com">Stoyan
      Stefanov</a> presents a very clever approach for automatically
      defining nested namespaces under an existing global variable. He
      suggests a convenience method that takes a single string argument for a
      nest, parses this, and automatically populates our base namespace with
      the objects required.</p><p>The method he suggests using is the following, which I've updated
      it to be a generic function for easier reuse with multiple
      namespaces:</p><a id="I_programlisting13_d1e9107"></a><pre class="programlisting_javascript"><code class="c1">// top-level namespace being assigned an object literal</code>
<code class="kd">var</code> <code class="nx">myApp</code> <code class="o">=</code> <code class="nx">myApp</code> <code class="o">||</code> <code class="p">{};</code>

<code class="c1">// a convenience function for parsing string namespaces and </code>
<code class="c1">// automatically generating nested namespaces</code>
<code class="kd">function</code> <code class="nx">extend</code><code class="p">(</code> <code class="nx">ns</code><code class="p">,</code> <code class="nx">ns_string</code> <code class="p">)</code> <code class="p">{</code>
    <code class="kd">var</code> <code class="nx">parts</code> <code class="o">=</code> <code class="nx">ns_string</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code><code class="s2">"."</code><code class="p">),</code>
        <code class="nx">parent</code> <code class="o">=</code> <code class="nx">ns</code><code class="p">,</code>
        <code class="nx">pl</code><code class="p">;</code>

    <code class="nx">pl</code> <code class="o">=</code> <code class="nx">parts</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code>

    <code class="k">for</code> <code class="p">(</code> <code class="kd">var</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">pl</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code> <code class="p">)</code> <code class="p">{</code>
        <code class="c1">// create a property if it doesn't exist</code>
        <code class="k">if</code> <code class="p">(</code> <code class="k">typeof</code> <code class="nx">parent</code><code class="p">[</code><code class="nx">parts</code><code class="p">[</code><code class="nx">i</code><code class="p">]]</code> <code class="o">===</code> <code class="s2">"undefined"</code> <code class="p">)</code> <code class="p">{</code>
            <code class="nx">parent</code><code class="p">[</code><code class="nx">parts</code><code class="p">[</code><code class="nx">i</code><code class="p">]]</code> <code class="o">=</code> <code class="p">{};</code>
        <code class="p">}</code>

        <code class="nx">parent</code> <code class="o">=</code> <code class="nx">parent</code><code class="p">[</code><code class="nx">parts</code><code class="p">[</code><code class="nx">i</code><code class="p">]];</code>
    <code class="p">}</code>

    <code class="k">return</code> <code class="nx">parent</code><code class="p">;</code>
<code class="p">}</code>

<code class="c1">// Usage:</code>
<code class="c1">// extend myApp with a deeply nested namespace</code>
<code class="kd">var</code> <code class="nx">mod</code> <code class="o">=</code> <code class="nx">extend</code><code class="p">(</code><code class="nx">myApp</code><code class="p">,</code> <code class="s2">"myApp.modules.module2"</code><code class="p">);</code>

<code class="c1">// the correct object with nested depths is output</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">mod</code><code class="p">);</code>

<code class="c1">// minor test to check the instance of mod can also</code>
<code class="c1">// be used outside of the myApp namesapce as a clone</code>
<code class="c1">// that includes the extensions </code>

<code class="c1">// Outputs: true</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">mod</code> <code class="o">==</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">modules</code><code class="p">.</code><code class="nx">module2</code><code class="p">);</code> 

<code class="c1">// further demonstration of easier nested namespace</code>
<code class="c1">// assignment using extend</code>
<code class="nx">extend</code><code class="p">(</code><code class="nx">myApp</code><code class="p">,</code> <code class="s2">"moduleA.moduleB.moduleC.moduleD"</code><code class="p">);</code>
<code class="nx">extend</code><code class="p">(</code><code class="nx">myApp</code><code class="p">,</code> <code class="s2">"longer.version.looks.like.this"</code><code class="p">);</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">myApp</code><code class="p">);</code>
</pre><p><a class="xref" href="ch13s16.html#web_inspector_output" title="Figure&nbsp;13-1.&nbsp;Chrome Developer Tools output">Figure&nbsp;13-1</a> shows the Chrome Developer
      Tools output:</p><div class="figure-float"><div class="figure"><a id="web_inspector_output"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e9115"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326892.png" alt="Chrome Developer Tools output" width="573" height="421" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326892.png"></div></div><p class="title">Figure&nbsp;13-1.&nbsp;Chrome Developer Tools output</p></div></div><p>Where one would previously have had to explicitly declare the
      various nests for their namespace as objects, this can now be easily
      achieved using a single, cleaner line of code.</p></div><div class="sect2" title="Dependency Declaration Pattern"><div class="titlepage"><div><div><h2 class="title"><a id="dependency-declaration-pattern"></a>Dependency Declaration Pattern</h2></div></div></div><p><a id="I_indexterm13_d1e9126" class="indexterm"></a><a id="I_indexterm13_d1e9133" class="indexterm"></a><a id="I_indexterm13_d1e9138" class="indexterm"></a>We're now going to explore a minor augmentation to the
      Nested Namespacing pattern which we'll refer to as the Dependency
      Declaration pattern. We all know that local references to objects can
      decrease overall lookup times, but let's apply this to namespacing to
      see how it might look in practice:</p><a id="I_programlisting13_d1e9144"></a><pre class="programlisting_javascript"><code class="c1">// common approach to accessing nested namespaces</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">utilities</code><code class="p">.</code><code class="nx">math</code><code class="p">.</code><code class="nx">fibonacci</code><code class="p">(</code> <code class="mi">25</code> <code class="p">);</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">utilities</code><code class="p">.</code><code class="nx">math</code><code class="p">.</code><code class="nx">sin</code><code class="p">(</code> <code class="mi">56</code> <code class="p">);</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">utilities</code><code class="p">.</code><code class="nx">drawing</code><code class="p">.</code><code class="nx">plot</code><code class="p">(</code> <code class="mi">98</code><code class="p">,</code><code class="mi">50</code><code class="p">,</code><code class="mi">60</code> <code class="p">);</code>

<code class="c1">// with local/cached references</code>
<code class="kd">var</code> <code class="nx">utils</code> <code class="o">=</code> <code class="nx">myApp</code><code class="p">.</code><code class="nx">utilities</code><code class="p">,</code>
<code class="nx">maths</code> <code class="o">=</code> <code class="nx">utils</code><code class="p">.</code><code class="nx">math</code><code class="p">,</code>
<code class="nx">drawing</code> <code class="o">=</code> <code class="nx">utils</code><code class="p">.</code><code class="nx">drawing</code><code class="p">;</code>

<code class="c1">// easier to access the namespace</code>
<code class="nx">maths</code><code class="p">.</code><code class="nx">fibonacci</code><code class="p">(</code> <code class="mi">25</code> <code class="p">);</code>
<code class="nx">maths</code><code class="p">.</code><code class="nx">sin</code><code class="p">(</code> <code class="mi">56</code> <code class="p">);</code>
<code class="nx">drawing</code><code class="p">.</code><code class="nx">plot</code><code class="p">(</code> <code class="mi">98</code><code class="p">,</code> <code class="mi">50</code><code class="p">,</code><code class="mi">60</code> <code class="p">);</code>

<code class="c1">// note that the above is particularly performant when </code>
<code class="c1">// compared to hundreds or thousands of calls to nested </code>
<code class="c1">// namespaces vs. a local reference to the namespace</code>
</pre><p>Working with a <a id="I_indexterm13_d1e9148" class="indexterm"></a>local variable here is almost always faster than working
      with a top-level global (e.g., <code class="literal">myApp</code>). It's also both
      more convenient and more performant than accessing nested
      properties/subnamespaces on every subsequent line and can improve
      readability in more complex applications.</p><p>Stoyan recommends declaring localized namespaces required by a
      function or module at the top of our function scope (using the
      single-variable pattern) and calls this a Dependency Declaration
      pattern. One of the benefits this offers is a decrease in locating
      dependencies and resolving them, should we have an extendable
      architecture that dynamically loads modules into our namespace when
      required.</p><p>In my opinion, this pattern works best when working at a modular
      level, localizing a namespace to be used by a group of methods.
      Localizing namespaces on a per-function level, especially where there is
      significant overlap between namespace dependencies, would be something I
      would recommend avoiding where possible. Instead, define it further up
      and just have them all access the same reference.</p></div><div class="sect2" title="Deep Object Extension"><div class="titlepage"><div><div><h2 class="title"><a id="deep-object-extension"></a>Deep Object Extension</h2></div></div></div><p><a id="I_indexterm13_d1e9165" class="indexterm"></a><a id="I_indexterm13_d1e9172" class="indexterm"></a><a id="I_indexterm13_d1e9177" class="indexterm"></a>An alternative approach to automatic namespacing is deep
      object extension. Namespaces defined using object literal notation may
      be easily extended (or merged) with other objects (or namespaces) such
      that the properties and functions of both namespaces can be accessible
      under the same namespace post-merge.</p><p>This is something that's been made fairly easy to accomplish with
      modern JavaScript frameworks (e.g., see jQuery's <a class="ulink" href="http://api.jquery.com/jQuery.extend/">$.extend</a>); however,
      if looking to extend objects (namespaces) using vanilla JS, the
      following routine may be of assistance.</p><a id="I_programlisting13_d1e9186"></a><pre class="programlisting_javascript"><code class="c1">// extend.js</code>
<code class="c1">// Written by Andrew Dupont, optimized by Addy Osmani</code>

<code class="kd">function</code> <code class="nx">extend</code><code class="p">(</code> <code class="nx">destination</code><code class="p">,</code> <code class="nx">source</code> <code class="p">)</code> <code class="p">{</code>

    <code class="kd">var</code> <code class="nx">toString</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code><code class="p">,</code>
        <code class="nx">objTest</code> <code class="o">=</code> <code class="nx">toString</code><code class="p">.</code><code class="nx">call</code><code class="p">({});</code>

    <code class="k">for</code> <code class="p">(</code> <code class="kd">var</code> <code class="nx">property</code> <code class="k">in</code> <code class="nx">source</code> <code class="p">)</code> <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code> <code class="nx">source</code><code class="p">[</code><code class="nx">property</code><code class="p">]</code> <code class="o">&amp;&amp;</code> <code class="nx">objTest</code> <code class="o">===</code> <code class="nx">toString</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="nx">source</code><code class="p">[</code><code class="nx">property</code><code class="p">])</code> <code class="p">)</code> <code class="p">{</code>
            <code class="nx">destination</code><code class="p">[</code><code class="nx">property</code><code class="p">]</code> <code class="o">=</code> <code class="nx">destination</code><code class="p">[</code><code class="nx">property</code><code class="p">]</code> <code class="o">||</code> <code class="p">{};</code>
            <code class="nx">extend</code><code class="p">(</code><code class="nx">destination</code><code class="p">[</code><code class="nx">property</code><code class="p">],</code> <code class="nx">source</code><code class="p">[</code><code class="nx">property</code><code class="p">]);</code>
        <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
            <code class="nx">destination</code><code class="p">[</code><code class="nx">property</code><code class="p">]</code> <code class="o">=</code> <code class="nx">source</code><code class="p">[</code><code class="nx">property</code><code class="p">];</code>
        <code class="p">}</code>
    <code class="p">}</code>
    <code class="k">return</code> <code class="nx">destination</code><code class="p">;</code>

<code class="p">};</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">group</code><code class="p">(</code> <code class="s2">"objExtend namespacing tests"</code> <code class="p">);</code>

<code class="c1">// define a top-level namespace for usage</code>
<code class="kd">var</code> <code class="nx">myNS</code> <code class="o">=</code> <code class="nx">myNS</code> <code class="o">||</code> <code class="p">{};</code>

<code class="c1">// 1. extend namespace with a "utils" object</code>
<code class="nx">extend</code><code class="p">(</code><code class="nx">myNS</code><code class="p">,</code> <code class="p">{</code> 
        <code class="nx">utils</code><code class="o">:</code><code class="p">{</code>
        <code class="p">}</code>
<code class="p">});</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"test 1"</code> <code class="p">,</code> <code class="nx">myNS</code><code class="p">);</code>
<code class="c1">// myNS.utils now exists</code>

<code class="c1">// 2. extend with multiple depths (namespace.hello.world.wave)</code>
<code class="nx">extend</code><code class="p">(</code><code class="nx">myNS</code><code class="p">,</code> <code class="p">{</code>
                <code class="nx">hello</code><code class="o">:</code><code class="p">{</code>
                        <code class="nx">world</code><code class="o">:</code><code class="p">{</code>
                                <code class="nx">wave</code><code class="o">:</code><code class="p">{</code>
                                    <code class="nx">test</code><code class="o">:</code> <code class="kd">function</code><code class="p">(){</code>
                                        <code class="c1">//...</code>
                                    <code class="p">}</code>
                                <code class="p">}</code>
                        <code class="p">}</code>
                <code class="p">}</code>
<code class="p">});</code>

<code class="c1">// test direct assignment works as expected</code>
<code class="nx">myNS</code><code class="p">.</code><code class="nx">hello</code><code class="p">.</code><code class="nx">test1</code> <code class="o">=</code> <code class="s2">"this is a test"</code><code class="p">;</code>
<code class="nx">myNS</code><code class="p">.</code><code class="nx">hello</code><code class="p">.</code><code class="nx">world</code><code class="p">.</code><code class="nx">test2</code> <code class="o">=</code> <code class="s2">"this is another test"</code><code class="p">;</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"test 2"</code><code class="p">,</code> <code class="nx">myNS</code> <code class="p">);</code>

<code class="c1">// 3. what if myNS already contains the namespace being added </code>
<code class="c1">// (e.g. "library")? we want to ensure no namespaces are being </code>
<code class="c1">// overwritten during extension</code>

<code class="nx">myNS</code><code class="p">.</code><code class="nx">library</code> <code class="o">=</code> <code class="p">{</code>
        <code class="nx">foo</code><code class="o">:</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{}</code>
<code class="p">};</code>

<code class="nx">extend</code><code class="p">(</code> <code class="nx">myNS</code><code class="p">,</code> <code class="p">{</code>
        <code class="nx">library</code><code class="o">:</code><code class="p">{</code> 
                <code class="nx">bar</code><code class="o">:</code><code class="kd">function</code><code class="p">(){</code>
                    <code class="c1">//... </code>
                <code class="p">}</code>
        <code class="p">}</code>
<code class="p">});</code>

<code class="c1">// confirmed that extend is operating safely (as expected)</code>
<code class="c1">// myNS now also contains library.foo, library.bar</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"test 3"</code><code class="p">,</code> <code class="nx">myNS</code> <code class="p">);</code> 


<code class="c1">// 4. what if we wanted easier access to a specific namespace without having</code>
<code class="c1">// to type the whole namespace out each time?</code>

<code class="kd">var</code> <code class="nx">shorterAccess1</code> <code class="o">=</code> <code class="nx">myNS</code><code class="p">.</code><code class="nx">hello</code><code class="p">.</code><code class="nx">world</code><code class="p">;</code>
<code class="nx">shorterAccess1</code><code class="p">.</code><code class="nx">test3</code> <code class="o">=</code> <code class="s2">"hello again"</code><code class="p">;</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"test 4"</code><code class="p">,</code> <code class="nx">myNS</code><code class="p">);</code>

<code class="c1">//success, myApp.hello.world.test3 is now "hello again"</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">groupEnd</code><code class="p">();</code>
</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>The above implementation is not <a id="I_indexterm13_d1e9192" class="indexterm"></a>cross-browser compatible for all objects and should be
          considered a proof-of-concept only. One may find the Underscore.js
          <code class="literal">extend()</code> method a simpler, more
          cross-browser-friendly implementation to start with: <a class="ulink" href="http://documentcloud.github.com/underscore/docs/underscore.html#section-67">http://documentcloud.github.com/underscore/docs/underscore.html#section-67</a>.
          Alternatively, a version of the jQuery <code class="literal">$.extend()</code>
          method extracted from core can be found here: <a class="ulink" href="https://github.com/addyosmani/jquery.parts">https://github.com/addyosmani/jquery.parts</a>.</p></div><p>For developers who are going to use jQuery in their
      applications, one can achieve the exact same object namespace
      extensibility with <code class="literal">$.extend</code> as
      follows:</p><a id="I_programlisting13_d1e9212"></a><pre class="programlisting_javascript"><code class="c1">// top-level namespace</code>
<code class="kd">var</code> <code class="nx">myApp</code> <code class="o">=</code> <code class="nx">myApp</code> <code class="o">||</code> <code class="p">{};</code>

<code class="c1">// directly assign a nested namespace</code>
<code class="nx">myApp</code><code class="p">.</code><code class="nx">library</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">foo</code><code class="o">:</code><code class="kd">function</code><code class="p">(){</code> 
    <code class="c1">//...</code>
  <code class="p">}</code>
<code class="p">};</code>

<code class="c1">// deep extend/merge this namespace with another</code>
<code class="c1">// to make things interesting, let's say it's a namespace</code>
<code class="c1">// with the same name but with a different function</code>
<code class="c1">// signature: $.extend( deep, target, object1, object2 )</code>
<code class="nx">$</code><code class="p">.</code><code class="nx">extend</code><code class="p">(</code> <code class="kc">true</code><code class="p">,</code> <code class="nx">myApp</code><code class="p">,</code> <code class="p">{</code>
    <code class="nx">library</code><code class="o">:</code><code class="p">{</code> 
        <code class="nx">bar</code><code class="o">:</code><code class="kd">function</code><code class="p">(){</code>
            <code class="c1">//...</code>
        <code class="p">}</code>
    <code class="p">}</code>
<code class="p">});</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"test"</code><code class="p">,</code> <code class="nx">myApp</code><code class="p">);</code> 
<code class="c1">// myApp now contains both library.foo() and library.bar() methods</code>
<code class="c1">// nothing has been overwritten which is what we're hoping for.</code>
</pre><p>For the sake of thoroughness, please see <a class="ulink" href="https://gist.github.com/1221980">here</a> for jQuery
      <code class="literal">$.extend</code> equivalents to the rest of the namespacing
      experiments found in this section.</p></div><div class="sect2" title="Recommendation"><div class="titlepage"><div><div><h2 class="title"><a id="recommendation"></a>Recommendation</h2></div></div></div><p>Reviewing the namespace patterns we've explored in this section,
      the option that I would personally use for most larger applications is
      nested object namespacing with the Object Literal pattern. Where
      possible, I would implement this using automated nested namespacing,
      however, this is just a personal preference.</p><p>IIFEs and single global variables may work fine for applications
      in the small to medium range, however, larger code bases requiring both
      namespaces and deep subnamespaces require a succinct solution that
      promotes readability and scales. I feel this pattern achieves all of
      these objectives well.</p><p>I would also recommend trying out some of the suggested advanced
      utility methods for namespace extension, as they really can save time in
      the long run.<a id="I_indexterm13_d1e9231" class="indexterm"></a><a id="I_indexterm13_d1e9232" class="indexterm"></a><a id="I_indexterm13_d1e9233" class="indexterm"></a></p></div></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Singleton Pattern"><div class="titlepage"><div><div><h1 class="title">The Singleton Pattern</h1></div></div></div><p><a id="index-476I751CL8E" class="indexterm"></a><a id="I_indexterm9_d1e2227" class="indexterm"></a>The Singleton pattern is thus known because it restricts
    instantiation of a class to a single object. Classically, the Singleton
    pattern can be implemented by creating a class with a method that creates
    a new instance of the class if one doesn't exist. In the event of an
    instance already existing, it simply returns a reference to that object.
    Singletons differ from static <em class="firstterm">classes</em> (or objects)
    as we can delay their initialization, generally because they require some
    information that may not be available during initialization time. For code
    that is unaware of a previous reference to them, they do not provide a
    method for easy retrieval. This is because it is neither the object nor
    "class" that's returned by a Singleton; it's a structure. Think of how
    closured variables aren't actually closuresâ€”the function scope that
    provides the closure is the closure. In JavaScript, Singletons serve as a
    shared resource namespace which isolate implementation code from the
    global namespace so as to provide a single point of access for functions.
    We can implement a Singleton as follows:</p><p><a id="I_programlisting9_d1e2237"></a></p><pre class="programlisting">var mySingleton = (function () {

  // Instance stores a reference to the Singleton
  var instance;

  function init() {

    // Singleton

    // Private methods and variables
    function privateMethod(){
        console.log( "I am private" );
    }

    var privateVariable = "Im also private";

    return {

      // Public methods and variables
      publicMethod: function () {
        console.log( "The public can see me!" );
      },

      publicProperty: "I am also public"
    };

  };

  return {

    // Get the Singleton instance if one exists
    // or create one if it doesn't
    getInstance: function () {

      if ( !instance ) {
        instance = init();
      }

      return instance;
    }

  };

})();

// Usage:

var singleA = mySingleton;
var singleB = mySingleton;
console.log( singleA === singleB ); // true</pre><p>What makes the Singleton is the global access to the instance
    (generally through <code class="literal">MySingleton.getInstance()</code>) as we
    don't (at least in static languages) call a new
    <code class="literal">MySingleton()</code> directly. This is, however, possible in
    JavaScript. In the GoF book, the <span class="emphasis"><em>applicability</em></span> of the
    Singleton pattern is described as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>There must be exactly one instance of a class, and it must be
          accessible to clients from a well-known access point.</p></li><li class="listitem"><p>The sole instance should be extensible by subclassing, and
          clients should be able to use an extended instance without modifying
          their code.</p></li></ul></div><p>The second of these points refers to a case where we
    might need code, such as:</p><a id="I_programlisting9_d1e2259"></a><pre class="programlisting_javascript"><code class="nx">mySingleton</code><code class="p">.</code><code class="nx">getInstance</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(){</code>
  <code class="k">if</code> <code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">_instance</code> <code class="o">==</code> <code class="kc">null</code> <code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code> <code class="nx">isFoo</code><code class="p">()</code> <code class="p">)</code> <code class="p">{</code>
       <code class="k">this</code><code class="p">.</code><code class="nx">_instance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FooSingleton</code><code class="p">();</code>
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
       <code class="k">this</code><code class="p">.</code><code class="nx">_instance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">BasicSingleton</code><code class="p">();</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">_instance</code><code class="p">;</code>
<code class="p">};</code>
</pre><p>Here, <code class="literal">getInstance</code> becomes a little like a Factory
    method and we don't need to update each point in our code when accessing
    it. <code class="literal">FooSingleton</code> (above) would be a subclass of
    <code class="literal">BasicSingleton</code> and would implement the same
    interface.</p><p>Why is deferring execution considered important for a
    Singleton?:</p><div class="blockquote"><blockquote class="blockquote"><p>In C++, it serves as isolation from the unpredictability of the
        dynamic initialization order, returning control to the
        programmer.</p></blockquote></div><p>It is important to note the difference between a static instance of
    a class (object) and a Singleton: while a Singleton can be implemented as
    a static instance, it can also be constructed lazily, without the use of
    resources or memory, until the static instance is needed.</p><p>If we have a static object that can be initialized directly, we need
    to ensure the code is always executed in the same order (e.g., in case
    <code class="literal">objCar</code> needs <code class="literal">objWheel</code> during its
    initialization), and this doesn't scale when you have a large number of
    source files.</p><p>Both Singletons and static objects are useful, but they shouldn't be
    overused in the same way that we shouldn't overuse other patterns.</p><p>In practice, the Singleton pattern is useful when exactly one object
    is needed to coordinate others across a system. Here, you can see the
    pattern being used in this context:</p><a id="I_programlisting9_d1e2293"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">SingletonTester</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

  <code class="c1">// options: an object containing configuration options for the singleton</code>
  <code class="c1">// e.g var options = { name: "test", pointX: 5};  </code>
  <code class="kd">function</code> <code class="nx">Singleton</code><code class="p">(</code> <code class="nx">options</code> <code class="p">)</code>  <code class="p">{</code>

    <code class="c1">// set options to the options supplied </code>
    <code class="c1">// or an empty object if none are provided</code>
    <code class="nx">options</code> <code class="o">=</code> <code class="nx">options</code> <code class="o">||</code> <code class="p">{};</code>

    <code class="c1">// set some properties for our singleton</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s2">"SingletonTester"</code><code class="p">;</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">pointX</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">pointX</code> <code class="o">||</code> <code class="mi">6</code><code class="p">;</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">pointY</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">pointY</code> <code class="o">||</code> <code class="mi">10</code><code class="p">;</code>  

  <code class="p">}</code>

  <code class="c1">// our instance holder  </code>
  <code class="kd">var</code> <code class="nx">instance</code><code class="p">;</code>

  <code class="c1">// an emulation of static variables and methods</code>
  <code class="kd">var</code> <code class="nx">_static</code>  <code class="o">=</code> <code class="p">{</code>   

    <code class="nx">name</code><code class="o">:</code>  <code class="s2">"SingletonTester"</code><code class="p">,</code>

    <code class="c1">// Method for getting an instance. It returns </code>
    <code class="c1">// a singleton instance of a singleton object</code>
    <code class="nx">getInstance</code><code class="o">:</code>  <code class="kd">function</code><code class="p">(</code> <code class="nx">options</code> <code class="p">)</code> <code class="p">{</code>    
      <code class="k">if</code><code class="p">(</code> <code class="nx">instance</code>  <code class="o">===</code>  <code class="kc">undefined</code> <code class="p">)</code>  <code class="p">{</code>     
        <code class="nx">instance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Singleton</code><code class="p">(</code> <code class="nx">options</code> <code class="p">);</code>    
      <code class="p">}</code>    

      <code class="k">return</code>  <code class="nx">instance</code><code class="p">;</code>  
       
    <code class="p">}</code>  
  <code class="p">};</code>  

  <code class="k">return</code>  <code class="nx">_static</code><code class="p">;</code>

<code class="p">})();</code>

<code class="kd">var</code> <code class="nx">singletonTest</code>  <code class="o">=</code>  <code class="nx">SingletonTester</code><code class="p">.</code><code class="nx">getInstance</code><code class="p">({</code>
  <code class="nx">pointX</code><code class="o">:</code>  <code class="mi">5</code>
<code class="p">});</code>

<code class="c1">// Log the output of pointX just to verify it is correct</code>
<code class="c1">// Outputs: 5</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">singletonTest</code><code class="p">.</code><code class="nx">pointX</code> <code class="p">);</code> 
</pre><p>While the Singleton has valid uses, often when we find ourselves
    needing it in JavaScript, it's a sign that we may need to reevaluate our
    design.</p><p>The presence of the Singleton is often an indication that modules in
    a system are either tightly coupled or that logic is overly spread across
    multiple parts of a code base. Singletons can be more difficult to test
    due to issues ranging from hidden dependencies to difficulty in creating
    multiple instances, difficulty in stubbing dependencies, etc.</p><p>Miller Medeiros has previously recommended this excellent <a class="ulink" href="http://www.ibm.com/developerworks/webservices/library/co-single/index.html">article</a>
    for further reading on the Singleton and its various issues. Also
    recommended reading are the comments to this <a class="ulink" href="http://misko.hevery.com/2008/10/21/dependency-injection-myth-reference-passing/">article</a>,
    discussing how Singletons can increase tight coupling. I'm happy to second
    these recommendations, as both pieces raise many important points about
    this pattern.<a id="I_indexterm9_d1e2307" class="indexterm"></a></p></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Observer Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-observer-pattern"></a>The Observer Pattern</h1></div></div></div><p><a id="index-716D148EI1G" class="indexterm"></a>The Observer is a design pattern in which an object
    <a id="I_indexterm9_d1e2316" class="indexterm"></a><a id="I_indexterm9_d1e2321" class="indexterm"></a>(known as a subject) maintains a list of objects depending
    on it (observers), automatically notifying them of any changes to state
    (<a class="xref" href="ch09s05.html#observer" title="Figure&nbsp;9-3.&nbsp;Observer pattern">Figure&nbsp;9-3</a>).</p><div class="figure"><a id="observer"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e2332"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326916.png" alt="Observer pattern" width="530" height="332" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326916.png"></div></div><p class="title">Figure&nbsp;9-3.&nbsp;Observer pattern</p></div><p>When a subject needs to notify observers about something interesting
    happening, it broadcasts a notification to the observers (which can
    include specific data related to the topic of the notification).</p><p>When we no longer wish for a particular observer to be notified of
    changes by the subject it is registered with, the subject can remove it
    from the list of observers.</p><p>It's often useful to refer back to published definitions of design
    patterns that are language agnostic to get a broader sense of their usage
    and advantages over time. The definition of the Observer pattern provided
    in the GoF book, <span class="emphasis"><em>Design Patterns: Elements of Reusable
    Object-Oriented Software</em></span>, is:</p><div class="blockquote"><blockquote class="blockquote"><p>One or more observers are interested in the state of a subject
        and register their interest with the subject by attaching themselves.
        When something changes in our subject that the observer may be
        interested in, a notify message is sent which calls the update method
        in each observer. When the observer is no longer interested in the
        subject's state, they can simply detach themselves.</p></blockquote></div><p>We can now expand on what we've learned to implement the
    Observer pattern with the following components:</p><div class="variablelist"><dl><dt><span class="term"><span class="emphasis"><em>Subject</em></span><a id="I_indexterm9_d1e2356" class="indexterm"></a></span></dt><dd><p>Maintains a list of observers, facilitates adding or
            removing observers</p></dd><dt><span class="term">Observer</span></dt><dd><p>Provides an update interface for objects that need to be
            notified of a Subject's changes of state</p></dd><dt><span class="term"><code class="literal">ConcreteSubject</code><a id="I_indexterm9_d1e2372" class="indexterm"></a></span></dt><dd><p>Broadcasts notifications to Observers on changes of state,
            stores the state of <code class="literal">ConcreteObservers</code></p></dd><dt><span class="term"><code class="literal">ConcreteObserver</code><a id="I_indexterm9_d1e2384" class="indexterm"></a></span></dt><dd><p>Stores a reference to the
            <code class="literal">ConcreteSubject</code>, implements an update interface
            for the Observer to ensure state is consistent with the
            Subject's</p></dd></dl></div><p>First, let's model the list of dependent Observers a subject may
    have:</p><a id="I_programlisting9_d1e2395"></a><pre class="programlisting_javascript"><code class="kd">function</code> <code class="nx">ObserverList</code><code class="p">(){</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code> <code class="o">=</code> <code class="p">[];</code>
<code class="p">}</code>

<code class="nx">ObserverList</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">Add</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">obj</code> <code class="p">){</code>
  <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code> <code class="nx">obj</code> <code class="p">);</code>
<code class="p">};</code>

<code class="nx">ObserverList</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">Empty</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(){</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code> <code class="o">=</code> <code class="p">[];</code>
<code class="p">};</code>

<code class="nx">ObserverList</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">Count</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(){</code>
  <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code>
<code class="p">};</code>


<code class="nx">ObserverList</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">Get</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">index</code> <code class="p">){</code>
  <code class="k">if</code><code class="p">(</code> <code class="nx">index</code> <code class="o">&gt;</code> <code class="o">-</code><code class="mi">1</code> <code class="o">&amp;&amp;</code> <code class="nx">index</code> <code class="o">&lt;</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">length</code> <code class="p">){</code>
    <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">[</code> <code class="nx">index</code> <code class="p">];</code>
  <code class="p">}</code>
<code class="p">};</code>

<code class="nx">ObserverList</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">Insert</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">obj</code><code class="p">,</code> <code class="nx">index</code> <code class="p">){</code>
  <code class="kd">var</code> <code class="nx">pointer</code> <code class="o">=</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>

  <code class="k">if</code><code class="p">(</code> <code class="nx">index</code> <code class="o">===</code> <code class="mi">0</code> <code class="p">){</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">unshift</code><code class="p">(</code> <code class="nx">obj</code> <code class="p">);</code>
    <code class="nx">pointer</code> <code class="o">=</code> <code class="nx">index</code><code class="p">;</code>
  <code class="p">}</code><code class="k">else</code> <code class="k">if</code><code class="p">(</code> <code class="nx">index</code> <code class="o">===</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">length</code> <code class="p">){</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code> <code class="nx">obj</code> <code class="p">);</code>
    <code class="nx">pointer</code> <code class="o">=</code> <code class="nx">index</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="k">return</code> <code class="nx">pointer</code><code class="p">;</code>
<code class="p">};</code>

<code class="nx">ObserverList</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">IndexOf</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">obj</code><code class="p">,</code> <code class="nx">startIndex</code> <code class="p">){</code>
  <code class="kd">var</code> <code class="nx">i</code> <code class="o">=</code> <code class="nx">startIndex</code><code class="p">,</code> <code class="nx">pointer</code> <code class="o">=</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>

  <code class="k">while</code><code class="p">(</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">length</code> <code class="p">){</code>
    <code class="k">if</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code> <code class="o">===</code> <code class="nx">obj</code> <code class="p">){</code>
      <code class="nx">pointer</code> <code class="o">=</code> <code class="nx">i</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">}</code>

<code class="nx">i</code><code class="o">++</code><code class="p">;</code>

<code class="nx">i</code><code class="p">.</code><code class="nx">e</code>

  <code class="k">while</code><code class="p">(</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">length</code> <code class="p">){</code>
    <code class="k">if</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code> <code class="o">===</code> <code class="nx">obj</code> <code class="p">){</code>
      <code class="nx">pointer</code> <code class="o">=</code> <code class="nx">i</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="nx">i</code><code class="o">++</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="k">return</code> <code class="nx">pointer</code><code class="p">;</code>
<code class="p">};</code>


<code class="nx">ObserverList</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">RemoveIndexAt</code><code class="p">()</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">index</code> <code class="p">){</code>
  <code class="k">if</code><code class="p">(</code> <code class="nx">index</code> <code class="o">===</code> <code class="mi">0</code> <code class="p">){</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">shift</code><code class="p">();</code>
  <code class="p">}</code><code class="k">else</code> <code class="k">if</code><code class="p">(</code> <code class="nx">index</code> <code class="o">===</code> <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">length</code> <code class="o">-</code><code class="mi">1</code> <code class="p">){</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">observerList</code><code class="p">.</code><code class="nx">pop</code><code class="p">();</code>
  <code class="p">}</code>
<code class="p">};</code>


<code class="c1">// Extend an object with an extension</code>
<code class="kd">function</code> <code class="nx">extend</code><code class="p">(</code> <code class="nx">obj</code><code class="p">,</code> <code class="nx">extension</code> <code class="p">){</code>
  <code class="k">for</code> <code class="p">(</code> <code class="kd">var</code> <code class="nx">key</code> <code class="k">in</code> <code class="nx">obj</code> <code class="p">){</code>
    <code class="nx">extension</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">=</code> <code class="nx">obj</code><code class="p">[</code><code class="nx">key</code><code class="p">];</code>
  <code class="p">}</code>
<code class="p">}</code>
</pre><p>Next, let's model the Subject and the ability to add, remove, or
    notify observers on the observer list.</p><a id="I_programlisting9_d1e2399"></a><pre class="programlisting_javascript"><code class="kd">function</code> <code class="nx">Subject</code><code class="p">(){</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">observers</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ObserverList</code><code class="p">();</code>
<code class="p">}</code>

<code class="nx">Subject</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">AddObserver</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">observer</code> <code class="p">){</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">observers</code><code class="p">.</code><code class="nx">Add</code><code class="p">(</code> <code class="nx">observer</code> <code class="p">);</code>
<code class="p">};</code>  

<code class="nx">Subject</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">RemoveObserver</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">observer</code> <code class="p">){</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">observers</code><code class="p">.</code><code class="nx">RemoveIndexAt</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">observers</code><code class="p">.</code><code class="nx">IndexOf</code><code class="p">(</code> <code class="nx">observer</code><code class="p">,</code> <code class="mi">0</code> <code class="p">)</code> <code class="p">);</code>
<code class="p">};</code>  

<code class="nx">Subject</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">Notify</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">context</code> <code class="p">){</code>
  <code class="kd">var</code> <code class="nx">observerCount</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">observers</code><code class="p">.</code><code class="nx">Count</code><code class="p">();</code>
  <code class="k">for</code><code class="p">(</code><code class="kd">var</code> <code class="nx">i</code><code class="o">=</code><code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">observerCount</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">){</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">observers</code><code class="p">.</code><code class="nx">Get</code><code class="p">(</code><code class="nx">i</code><code class="p">).</code><code class="nx">Update</code><code class="p">(</code> <code class="nx">context</code> <code class="p">);</code>
  <code class="p">}</code>
<code class="p">};</code>
</pre><p>We then define a skeleton for creating new Observers. The <code class="literal">Update</code> functionality here will be overwritten
    later with custom behavior.</p><a id="I_programlisting9_d1e2407"></a><pre class="programlisting_javascript"><code class="c1">// The Observer</code>
<code class="kd">function</code> <code class="nx">Observer</code><code class="p">(){</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">Update</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(){</code>
    <code class="c1">// ...</code>
  <code class="p">};</code>
<code class="p">}</code>
</pre><p>In our sample application using the above Observer components, we
    now define:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A button for adding new observable checkboxes to the page</p></li><li class="listitem"><p>A control checkbox, which will act as a subject, notifying other
        checkboxes they should be checked</p></li><li class="listitem"><p>A container for the new checkboxes being added</p></li></ul></div><p>We then define <code class="literal">ConcreteSubject</code> and
    <code class="literal">ConcreteObserver</code> handlers for both adding new observers
    to the page and implementing the updating interface. See below for inline
    comments on what these components do in the context of our example.</p><p>Here is the HTML code:</p><a id="I_programlisting9_d1e2431"></a><pre class="programlisting_javascript"><code class="o">&lt;</code><code class="nx">button</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"addNewObserver"</code><code class="o">&gt;</code><code class="nx">Add</code> <code class="nx">New</code> <code class="nx">Observer</code> <code class="nx">checkbox</code><code class="o">&lt;</code><code class="err">/button&gt;</code>
<code class="o">&lt;</code><code class="nx">input</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"mainCheckbox"</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"checkbox"</code><code class="o">/&gt;</code>
<code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"observersContainer"</code><code class="o">&gt;&lt;</code><code class="err">/div&gt;</code>
</pre><p>Here is a sample script:</p><a id="I_programlisting9_d1e2435"></a><pre class="programlisting_javascript"><code class="c1">// References to our DOM elements</code>

<code class="kd">var</code> <code class="nx">controlCheckbox</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code> <code class="s2">"mainCheckbox"</code> <code class="p">),</code>
  <code class="nx">addBtn</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code> <code class="s2">"addNewObserver"</code> <code class="p">),</code>
  <code class="nx">container</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code> <code class="s2">"observersContainer"</code> <code class="p">);</code>


<code class="c1">// Concrete Subject</code>

<code class="c1">// Extend the controlling checkbox with the Subject class</code>
<code class="nx">extend</code><code class="p">(</code> <code class="k">new</code> <code class="nx">Subject</code><code class="p">(),</code> <code class="nx">controlCheckbox</code> <code class="p">);</code>

<code class="c1">// Clicking the checkbox will trigger notifications to its observers</code>
<code class="nx">controlCheckbox</code><code class="p">[</code><code class="s2">"onclick"</code><code class="p">]</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Function</code><code class="p">(</code> <code class="s2">"controlCheckbox.Notify(controlCheckbox.checked)"</code> <code class="p">);</code>


<code class="nx">addBtn</code><code class="p">[</code><code class="s2">"onclick"</code><code class="p">]</code> <code class="o">=</code> <code class="nx">AddNewObserver</code><code class="p">;</code>

<code class="c1">// Concrete Observer</code>

<code class="kd">function</code> <code class="nx">AddNewObserver</code><code class="p">(){</code>

  <code class="c1">// Create a new checkbox to be added</code>
  <code class="kd">var</code> <code class="nx">check</code>  <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code> <code class="s2">"input"</code> <code class="p">);</code>
  <code class="nx">check</code><code class="p">.</code><code class="nx">type</code> <code class="o">=</code> <code class="s2">"checkbox"</code><code class="p">;</code>

  <code class="c1">// Extend the checkbox with the Observer class</code>
  <code class="nx">extend</code><code class="p">(</code> <code class="k">new</code> <code class="nx">Observer</code><code class="p">(),</code> <code class="nx">check</code> <code class="p">);</code>

  <code class="c1">// Override with custom update behaviour</code>
  <code class="nx">check</code><code class="p">.</code><code class="nx">Update</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">value</code> <code class="p">){</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">checked</code> <code class="o">=</code> <code class="nx">value</code><code class="p">;</code>
  <code class="p">};</code>

  <code class="c1">// Add the new observer to our list of observers</code>
  <code class="c1">// for our main subject</code>
  <code class="nx">controlCheckbox</code><code class="p">.</code><code class="nx">AddObserver</code><code class="p">(</code> <code class="nx">check</code> <code class="p">);</code>

  <code class="c1">// Append the item to the container</code>
  <code class="nx">container</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code> <code class="nx">check</code> <code class="p">);</code>
<code class="p">}</code>
</pre><p>In this example, we looked at how to implement and utilize the
    Observer pattern, covering the concepts of a Subject, Observer,
    <code class="literal">ConcreteSubject</code>, and
    <code class="literal">ConcreteObserver</code>.</p><div class="sect2" title="Differences Between the Observer and Publish/Subscribe Pattern"><div class="titlepage"><div><div><h2 class="title"><a id="differences-between-the-observer-and-publishsubscribe-pattern"></a>Differences Between the Observer and Publish/Subscribe
      Pattern</h2></div></div></div><p><a id="I_indexterm9_d1e2449" class="indexterm"></a><a id="I_indexterm9_d1e2456" class="indexterm"></a>While the Observer pattern is useful to be aware of, quite
      often in the JavaScript world, we'll find it commonly implemented using
      a variation known as the Publish/Subscribe pattern. While very similar,
      there are differences between these patterns worth noting.</p><p>The Observer pattern requires that the observer (or object)
      wishing to receive topic notifications must subscribe this interest to
      the object firing the event (the subject), as seen in <a class="xref" href="ch09s05.html#pubsub" title="Figure&nbsp;9-4.&nbsp;Publish/Subscribe">Figure&nbsp;9-4</a>.</p><div class="figure-float"><div class="figure"><a id="pubsub"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e2469"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326890.png" alt="Publish/Subscribe" width="484" height="300" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326890.png"></div></div><p class="title">Figure&nbsp;9-4.&nbsp;Publish/Subscribe</p></div></div><p>The Publish/Subscribe pattern however uses a topic/event channel
      that sits between the objects wishing to receive notifications
      (subscribers) and the object firing the event (the publisher). This
      event system allows code to define application specific events that can
      pass custom arguments containing values needed by the subscriber. The
      idea here is to avoid dependencies <a id="I_indexterm9_d1e2476" class="indexterm"></a>between the subscriber and publisher.</p><p>This differs from the Observer pattern as it allows any subscriber
      implementing an appropriate event handler to register for and receive
      topic notifications broadcast by the publisher.</p><p>Here is an example of how one might use the Publish/Subscribe
      pattern if provided with a functional implementation powering <code class="literal">publish()</code>, <code class="literal">subscribe()</code>, and <code class="literal">unsubscribe()</code> behind the scenes:</p><a id="I_programlisting9_d1e2495"></a><pre class="programlisting_javascript"><code class="c1">// A very simple new mail handler</code>

<code class="c1">// A count of the number of messages received</code>
<code class="kd">var</code> <code class="nx">mailCounter</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

<code class="c1">// Initialize subscribers that will listen out for a topic</code>
<code class="c1">// with the name "inbox/newMessage".</code>

<code class="c1">// Render a preview of new messages</code>
<code class="kd">var</code> <code class="nx">subscriber1</code> <code class="o">=</code> <code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code><code class="p">,</code> <code class="nx">data</code> <code class="p">)</code> <code class="p">{</code>

  <code class="c1">// Log the topic for debugging purposes</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"A new message was received: "</code><code class="p">,</code> <code class="nx">topic</code> <code class="p">);</code>

  <code class="c1">// Use the data that was passed from our subject</code>
  <code class="c1">// to display a message preview to the user</code>
  <code class="nx">$</code><code class="p">(</code> <code class="s2">".messageSender"</code> <code class="p">).</code><code class="nx">html</code><code class="p">(</code> <code class="nx">data</code><code class="p">.</code><code class="nx">sender</code> <code class="p">);</code>
  <code class="nx">$</code><code class="p">(</code> <code class="s2">".messagePreview"</code> <code class="p">).</code><code class="nx">html</code><code class="p">(</code> <code class="nx">data</code><code class="p">.</code><code class="nx">body</code> <code class="p">);</code>

<code class="p">});</code>

<code class="c1">// Here's another subscriber using the same data to perform</code>
<code class="c1">// a different task.</code>

<code class="c1">// Update the counter displaying the number of new</code>
<code class="c1">// messages received via the publisher</code>

<code class="kd">var</code> <code class="nx">subscriber2</code> <code class="o">=</code> <code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code><code class="p">,</code> <code class="nx">data</code> <code class="p">)</code> <code class="p">{</code>

  <code class="nx">$</code><code class="p">(</code><code class="s1">'.newMessageCounter'</code><code class="p">).</code><code class="nx">html</code><code class="p">(</code> <code class="nx">mailCounter</code><code class="o">++</code> <code class="p">);</code>

<code class="p">});</code>

<code class="nx">publish</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="p">[{</code>
  <code class="nx">sender</code><code class="o">:</code><code class="s2">"hello@google.com"</code><code class="p">,</code> 
  <code class="nx">body</code><code class="o">:</code> <code class="s2">"Hey there! How are you doing today?"</code>
<code class="p">}]);</code>

<code class="c1">// We could then at a later point unsubscribe our subscribers</code>
<code class="c1">// from receiving any new topic notifications as follows:</code>
<code class="c1">// unsubscribe( subscriber1,  );</code>
<code class="c1">// unsubscribe( subscriber2 );</code>
</pre><p>The general idea here is the promotion of loose coupling.
      <a id="I_indexterm9_d1e2499" class="indexterm"></a><a id="I_indexterm9_d1e2502" class="indexterm"></a>Rather than single objects calling on the methods of other
      objects directly, they instead subscribe to a specific task or activity
      of another object and are notified when it occurs.</p></div><div class="sect2" title="Advantages"><div class="titlepage"><div><div><h2 class="title"><a id="advantages-1"></a>Advantages</h2></div></div></div><p><a id="I_indexterm9_d1e2511" class="indexterm"></a>The Observer and Publish/Subscribe patterns encourage us
      to think hard about the relationships between different parts of our
      application. They also help us identify layers containing direct
      relationships that could be replaced with sets of subjects and
      observers. This effectively could be used to break down an application
      into smaller, more loosely coupled blocks to improve code management and
      potential for reuse.</p><p>Further motivation behind using the Observer pattern is where we
      need to maintain consistency between related objects without making
      classes tightly coupled. For example, when an object needs to be able to
      notify other objects without making assumptions regarding those
      objects.</p><p>Dynamic relationships <a id="I_indexterm9_d1e2521" class="indexterm"></a>can exist between observers and subjects when using either
      pattern. This provides a great deal of flexibility that may not be as
      easy to implement when disparate parts of our application are tightly
      coupled.</p><p>While it may not always be the best solution to every problem,
      these patterns remain one of the best tools for designing decoupled
      systems and should be considered an important tool in any JavaScript
      developer's utility belt.</p></div><div class="sect2" title="Disadvantages"><div class="titlepage"><div><div><h2 class="title"><a id="disadvantages-1"></a>Disadvantages</h2></div></div></div><p><a id="I_indexterm9_d1e2531" class="indexterm"></a>Consequently, some of the issues with these patterns
      actually stem from their main benefits. In Publish/Subscribe, by
      decoupling publishers from subscribers, it can sometimes become
      difficult to obtain guarantees that particular parts of our applications
      are functioning as we may expect.</p><p>For example, publishers may make an assumption that one or more
      subscribers are listening to them. Say that we're using such an
      assumption to log or output errors regarding some application process.
      If the subscriber performing the logging crashes (or for some reason
      fails to function), the publisher won't have a way of seeing this due to
      the decoupled nature of the system.</p><p>Another drawback of the pattern is that subscribers are quite
      ignorant to the existence of each other and are blind to the cost of
      switching publishers. Due to the dynamic relationship between
      subscribers and publishers, the update dependency can be difficult to
      track.</p></div><div class="sect2" title="Publish/Subscribe Implementations"><div class="titlepage"><div><div><h2 class="title"><a id="publishsubscribe-implementations"></a>Publish/Subscribe Implementations</h2></div></div></div><p><a id="index-832M126RO0C" class="indexterm"></a><a id="index-562B616JO0Q" class="indexterm"></a>Publish/Subscribe fits in very well in JavaScript
      ecosystems, largely because at the core, ECMAScript <a id="I_indexterm9_d1e2556" class="indexterm"></a>implementations are event driven. This is particularly
      true in browser environments, as the DOM uses events as its main
      interaction API for scripting.</p><p>That said, neither ECMAScript nor DOM <a id="I_indexterm9_d1e2564" class="indexterm"></a>provide core objects or methods for creating custom events
      systems in implementation code (with the exception of perhaps the DOM3
      CustomEvent, which is bound to the DOM and is thus not generically
      useful).</p><p>Luckily, popular JavaScript libraries such as Dojo, jQuery (custom
      events), and YUI already have utilities that can assist in easily
      implementing a Publish/Subscribe system with very little effort. Here we
      can see some examples of this:</p><a id="I_programlisting9_d1e2572"></a><pre class="programlisting_javascript"><code class="c1">// Publish</code>

<code class="c1">// jQuery: $(obj).trigger("channel", [arg1, arg2, arg3]);</code>
<code class="nx">$</code><code class="p">(</code> <code class="nx">el</code> <code class="p">).</code><code class="nx">trigger</code><code class="p">(</code> <code class="s2">"/login"</code><code class="p">,</code> <code class="p">[{</code><code class="nx">username</code><code class="o">:</code><code class="s2">"test"</code><code class="p">,</code> <code class="nx">userData</code><code class="o">:</code><code class="s2">"test"</code><code class="p">}]</code> <code class="p">);</code>

<code class="c1">// Dojo: dojo.publish("channel", [arg1, arg2, arg3] );</code>
<code class="nx">dojo</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"/login"</code><code class="p">,</code> <code class="p">[{</code><code class="nx">username</code><code class="o">:</code><code class="s2">"test"</code><code class="p">,</code> <code class="nx">userData</code><code class="o">:</code><code class="s2">"test"</code><code class="p">}]</code> <code class="p">);</code>

<code class="c1">// YUI: el.publish("channel", [arg1, arg2, arg3]);</code>
<code class="nx">el</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"/login"</code><code class="p">,</code> <code class="p">{</code><code class="nx">username</code><code class="o">:</code><code class="s2">"test"</code><code class="p">,</code> <code class="nx">userData</code><code class="o">:</code><code class="s2">"test"</code><code class="p">}</code> <code class="p">);</code>


<code class="c1">// Subscribe</code>

<code class="c1">// jQuery: $(obj).on( "channel", [data], fn );</code>
<code class="nx">$</code><code class="p">(</code> <code class="nx">el</code> <code class="p">).</code><code class="nx">on</code><code class="p">(</code> <code class="s2">"/login"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">event</code> <code class="p">){...}</code> <code class="p">);</code>

<code class="c1">// Dojo: dojo.subscribe( "channel", fn);</code>
<code class="kd">var</code> <code class="nx">handle</code> <code class="o">=</code> <code class="nx">dojo</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"/login"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">data</code><code class="p">){..}</code> <code class="p">);</code>

<code class="c1">// YUI: el.on("channel", handler);</code>
<code class="nx">el</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code> <code class="s2">"/login"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">data</code> <code class="p">){...}</code> <code class="p">);</code>


<code class="c1">// Unsubscribe</code>

<code class="c1">// jQuery: $(obj).off( "channel" );</code>
<code class="nx">$</code><code class="p">(</code> <code class="nx">el</code> <code class="p">).</code><code class="nx">off</code><code class="p">(</code> <code class="s2">"/login"</code> <code class="p">);</code>

<code class="c1">// Dojo: dojo.unsubscribe( handle );</code>
<code class="nx">dojo</code><code class="p">.</code><code class="nx">unsubscribe</code><code class="p">(</code> <code class="nx">handle</code> <code class="p">);</code>

<code class="c1">// YUI: el.detach("channel");</code>
<code class="nx">el</code><code class="p">.</code><code class="nx">detach</code><code class="p">(</code> <code class="s2">"/login"</code> <code class="p">);</code>
</pre><p>For those wishing to use the Publish/Subscribe pattern with
      vanilla JavaScript (or another library), <a class="ulink" href="http://amplifyjs.com/">AmplifyJS</a><a id="I_indexterm9_d1e2578" class="indexterm"></a> includes a clean, library-agnostic implementation that
      can be used with any library or toolkit. Radio.js (<a class="ulink" href="http://radio.uxder.com/">http://radio.uxder.com/</a>), PubSubJS (<a class="ulink" href="https://github.com/mroderick/PubSubJS">https://github.com/mroderick/PubSubJS</a>), or Pure JS PubSub
      by Peter Higgins (<a class="ulink" href="https://github.com/phiggins42/bloody-jquery-plugins/blob/">https://github.com/phiggins42/bloody-jquery-plugins/blob/</a>)
      are similar alternatives worth checking out.</p><p>jQuery developers in particular have quite a few other options and
      can opt to use one of the many well-developed implementations ranging
      from Peter Higgins's jQuery plug-in to Ben Alman's (optimized) Pub/Sub
      jQuery gist on GitHub.<a id="I_indexterm9_d1e2593" class="indexterm"></a> Links to just a few of these can be found below.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Ben Alman's Pub/Sub gist</p><p><a class="ulink" href="https://gist.github.com/661855">https://gist.github.com/661855</a>
          (recommended)</p></li><li class="listitem"><p>Rick Waldron's jQuery-core style take on the above</p><p><a class="ulink" href="https://gist.github.com/705311">https://gist.github.com/705311</a></p></li><li class="listitem"><p>Peter Higgins' plug-in <a class="ulink" href="http://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js">http://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js</a>.</p></li><li class="listitem"><p>AppendTo's Pub/Sub in AmplifyJS</p><p><a class="ulink" href="http://amplifyjs.com">http://amplifyjs.com</a></p></li><li class="listitem"><p>Ben Truyman's gist</p><p><a class="ulink" href="https://gist.github.com/826794">https://gist.github.com/826794</a></p></li></ul></div><p>So that we are able to get an appreciation for how many of the
      vanilla JavaScript implementations of the Observer pattern might work,
      let's take a walkthrough of a minimalist version of Publish/Subscribe I
      released on GitHub under a project called <a class="ulink" href="http://github.com/addyosmani/pubsubz">pubsubz</a>. This
      demonstrates the core concepts of subscribe, and publish, as well as the
      concept of unsubscribing.</p><p>I've opted to base our examples on this code as it sticks closely
      to both the method signatures and approach of implementation I would
      expect to see in a JavaScript version of the classic Observer
      pattern.</p><div class="sect3" title="A Publish/Subscribe implementation"><div class="titlepage"><div><div><h3 class="title"><a id="a-publishsubscribe-implementation"></a>A Publish/Subscribe implementation</h3></div></div></div><a id="I_programlisting9_d1e2634"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">pubsub</code> <code class="o">=</code> <code class="p">{};</code>

<code class="p">(</code><code class="kd">function</code><code class="p">(</code><code class="nx">q</code><code class="p">)</code> <code class="p">{</code>

    <code class="kd">var</code> <code class="nx">topics</code> <code class="o">=</code> <code class="p">{},</code>
        <code class="nx">subUid</code> <code class="o">=</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>

    <code class="c1">// Publish or broadcast events of interest</code>
    <code class="c1">// with a specific topic name and arguments</code>
    <code class="c1">// such as the data to pass along</code>
    <code class="nx">q</code><code class="p">.</code><code class="nx">publish</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code><code class="p">,</code> <code class="nx">args</code> <code class="p">)</code> <code class="p">{</code>

        <code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">]</code> <code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="kc">false</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="kd">var</code> <code class="nx">subscribers</code> <code class="o">=</code> <code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">],</code>
            <code class="nx">len</code> <code class="o">=</code> <code class="nx">subscribers</code> <code class="o">?</code> <code class="nx">subscribers</code><code class="p">.</code><code class="nx">length</code> <code class="o">:</code> <code class="mi">0</code><code class="p">;</code>

        <code class="k">while</code> <code class="p">(</code><code class="nx">len</code><code class="o">--</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">subscribers</code><code class="p">[</code><code class="nx">len</code><code class="p">].</code><code class="nx">func</code><code class="p">(</code> <code class="nx">topic</code><code class="p">,</code> <code class="nx">args</code> <code class="p">);</code>
        <code class="p">}</code>

        <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">};</code>

    <code class="c1">// Subscribe to events of interest</code>
    <code class="c1">// with a specific topic name and a</code>
    <code class="c1">// callback function, to be executed</code>
    <code class="c1">// when the topic/event is observed</code>
    <code class="nx">q</code><code class="p">.</code><code class="nx">subscribe</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code><code class="p">,</code> <code class="nx">func</code> <code class="p">)</code> <code class="p">{</code>

        <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">])</code> <code class="p">{</code>
            <code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">]</code> <code class="o">=</code> <code class="p">[];</code>
        <code class="p">}</code>

        <code class="kd">var</code> <code class="nx">token</code> <code class="o">=</code> <code class="p">(</code> <code class="o">++</code><code class="nx">subUid</code> <code class="p">).</code><code class="nx">toString</code><code class="p">();</code>
        <code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">].</code><code class="nx">push</code><code class="p">({</code>
            <code class="nx">token</code><code class="o">:</code> <code class="nx">token</code><code class="p">,</code>
            <code class="nx">func</code><code class="o">:</code> <code class="nx">func</code>
        <code class="p">});</code>
        <code class="k">return</code> <code class="nx">token</code><code class="p">;</code>
    <code class="p">};</code>

    <code class="c1">// Unsubscribe from a specific</code>
    <code class="c1">// topic, based on a tokenized reference</code>
    <code class="c1">// to the subscription</code>
    <code class="nx">q</code><code class="p">.</code><code class="nx">unsubscribe</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">token</code> <code class="p">)</code> <code class="p">{</code>
        <code class="k">for</code> <code class="p">(</code> <code class="kd">var</code> <code class="nx">m</code> <code class="k">in</code> <code class="nx">topics</code> <code class="p">)</code> <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code> <code class="nx">topics</code><code class="p">[</code><code class="nx">m</code><code class="p">]</code> <code class="p">)</code> <code class="p">{</code>
                <code class="k">for</code> <code class="p">(</code> <code class="kd">var</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">j</code> <code class="o">=</code> <code class="nx">topics</code><code class="p">[</code><code class="nx">m</code><code class="p">].</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">j</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code> <code class="p">)</code> <code class="p">{</code>
                    <code class="k">if</code> <code class="p">(</code> <code class="nx">topics</code><code class="p">[</code><code class="nx">m</code><code class="p">][</code><code class="nx">i</code><code class="p">].</code><code class="nx">token</code> <code class="o">===</code> <code class="nx">token</code><code class="p">)</code> <code class="p">{</code>
                        <code class="nx">topics</code><code class="p">[</code><code class="nx">m</code><code class="p">].</code><code class="nx">splice</code><code class="p">(</code> <code class="nx">i</code><code class="p">,</code> <code class="mi">1</code> <code class="p">);</code>
                        <code class="k">return</code> <code class="nx">token</code><code class="p">;</code>
                    <code class="p">}</code>
                <code class="p">}</code>
            <code class="p">}</code>
        <code class="p">}</code>
        <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">};</code>
<code class="p">}(</code> <code class="nx">pubsub</code> <code class="p">));</code>
</pre></div><div class="sect3" title="Using our implementation"><div class="titlepage"><div><div><h3 class="title"><a id="example-using-our-implementation"></a>Using our implementation</h3></div></div></div><p>We can now use the implementation to publish and subscribe to
        events of interest as follows (<a class="xref" href="ch09s05.html#using-our-implementation" title="Example&nbsp;9-1.&nbsp;Using our implementation">Example&nbsp;9-1</a>):</p><div class="example"><a id="using-our-implementation"></a><p class="title">Example&nbsp;9-1.&nbsp;Using our implementation</p><div class="example-contents"><p><a id="I_programlisting9_d1e2648"></a></p><pre class="programlisting_javascript"><code class="c1">// Another simple message handler</code>

<code class="c1">// A simple message logger that logs any topics and data received through our</code>
<code class="c1">// subscriber</code>
<code class="kd">var</code> <code class="nx">messageLogger</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">topics</code><code class="p">,</code> <code class="nx">data</code> <code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"Logging: "</code> <code class="o">+</code> <code class="nx">topics</code> <code class="o">+</code> <code class="s2">": "</code> <code class="o">+</code> <code class="nx">data</code> <code class="p">);</code>
<code class="p">};</code>

<code class="c1">// Subscribers listen for topics they have subscribed to and</code>
<code class="c1">// invoke a callback function (e.g messageLogger) once a new </code>
<code class="c1">// notification is broadcast on that topic</code>
<code class="kd">var</code> <code class="nx">subscription</code> <code class="o">=</code> <code class="nx">pubsub</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="nx">messageLogger</code> <code class="p">);</code>

<code class="c1">// Publishers are in charge of publishing topics or notifications of</code>
<code class="c1">// interest to the application. e.g:</code>

<code class="nx">pubsub</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="s2">"hello world!"</code> <code class="p">);</code>

<code class="c1">// or</code>
<code class="nx">pubsub</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="p">[</code><code class="s2">"test"</code><code class="p">,</code> <code class="s2">"a"</code><code class="p">,</code> <code class="s2">"b"</code><code class="p">,</code> <code class="s2">"c"</code><code class="p">]</code> <code class="p">);</code>

<code class="c1">// or</code>
<code class="nx">pubsub</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="p">{</code>
  <code class="nx">sender</code><code class="o">:</code> <code class="s2">"hello@google.com"</code><code class="p">,</code> 
  <code class="nx">body</code><code class="o">:</code> <code class="s2">"Hey again!"</code>
<code class="p">});</code>

<code class="c1">// We can also unsubscribe if we no longer wish for our subscribers</code>
<code class="c1">// to be notified</code>
<code class="c1">// pubsub.unsubscribe( subscription );</code>

<code class="c1">// Once unsubscribed, this for example won't result in our</code>
<code class="c1">// messageLogger being executed as the subscriber is</code>
<code class="c1">// no longer listening</code>
<code class="nx">pubsub</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"inbox/newMessage"</code><code class="p">,</code> <code class="s2">"Hello! are you still there?"</code> <code class="p">);</code>
</pre></div></div></div><div class="sect3" title="User-interface notifications"><div class="titlepage"><div><div><h3 class="title"><a id="example-user-interface-notifications"></a>User-interface notifications</h3></div></div></div><p><a id="I_indexterm9_d1e2654" class="indexterm"></a><a id="I_indexterm9_d1e2659" class="indexterm"></a><a id="I_indexterm9_d1e2664" class="indexterm"></a>Next, let's imagine we have a web application
        responsible for displaying real-time stock information.</p><p>The application might have a grid for displaying the stock stats
        and a counter for displaying the last point of update. When the data
        model changes, the application will need to update the grid and
        counter. In this scenario, our subject (which will be publishing
        topics/notifications) is the data model, and our subscribers are the
        grid and counter.</p><p>When our subscribers receive notification that the model itself
        has changed, they can update accordingly.</p><p>In our implementation, our subscriber will listen to the topic
        <code class="literal">newDataAvailable</code> to find out if new stock
        information is available. If a new notification is published to this
        topic, it will trigger <code class="literal">gridUpdate</code>
        to add a new row to our grid containing this information. It will also
        update a <span class="emphasis"><em>last updated</em></span> counter to log the last
        time data was added (<a class="xref" href="ch09s05.html#user-interface-notifications" title="Example&nbsp;9-2.&nbsp;User-interface notifications">Example&nbsp;9-2</a>).</p><div class="example"><a id="user-interface-notifications"></a><p class="title">Example&nbsp;9-2.&nbsp;User-interface notifications</p><div class="example-contents"><p><a id="I_programlisting9_d1e2691"></a></p><pre class="programlisting_javascript"><code class="c1">// Create a subscription to the newDataAvailable topic</code>
<code class="kd">var</code> <code class="nx">subscriber</code> <code class="o">=</code> <code class="nx">pubsub</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"newDataAvailable"</code><code class="p">,</code> <code class="nx">gridUpdate</code> <code class="p">);</code>

<code class="c1">// Return the current local time to be used in our UI later</code>
<code class="nx">getCurrentTime</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">(){</code>

   <code class="kd">var</code> <code class="nx">date</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(),</code>
         <code class="nx">m</code> <code class="o">=</code> <code class="nx">date</code><code class="p">.</code><code class="nx">getMonth</code><code class="p">()</code> <code class="o">+</code> <code class="mi">1</code><code class="p">,</code>
         <code class="nx">d</code> <code class="o">=</code> <code class="nx">date</code><code class="p">.</code><code class="nx">getDate</code><code class="p">(),</code>
         <code class="nx">y</code> <code class="o">=</code> <code class="nx">date</code><code class="p">.</code><code class="nx">getFullYear</code><code class="p">(),</code>
         <code class="nx">t</code> <code class="o">=</code> <code class="nx">date</code><code class="p">.</code><code class="nx">toLocaleTimeString</code><code class="p">().</code><code class="nx">toLowerCase</code><code class="p">();</code>
         
        <code class="k">return</code> <code class="p">(</code><code class="nx">m</code> <code class="o">+</code> <code class="s2">"/"</code> <code class="o">+</code> <code class="nx">d</code> <code class="o">+</code> <code class="s2">"/"</code> <code class="o">+</code> <code class="nx">y</code> <code class="o">+</code> <code class="s2">" "</code> <code class="o">+</code> <code class="nx">t</code><code class="p">);</code>
<code class="p">};</code>

<code class="c1">// Add a new row of data to our fictional grid component</code>
<code class="kd">function</code> <code class="nx">addGridRow</code><code class="p">(</code> <code class="nx">data</code> <code class="p">)</code> <code class="p">{</code>

   <code class="c1">// ui.grid.addRow( data );</code>
   <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"updated grid component with:"</code> <code class="o">+</code> <code class="nx">data</code> <code class="p">);</code>

<code class="p">}</code>

<code class="c1">// Update our fictional grid to show the time it was last</code>
<code class="c1">// updated</code>
<code class="kd">function</code> <code class="nx">updateCounter</code><code class="p">(</code> <code class="nx">data</code> <code class="p">)</code> <code class="p">{</code>

   <code class="c1">// ui.grid.updateLastChanged( getCurrentTime() );   </code>
   <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"data last updated at: "</code> <code class="o">+</code> <code class="nx">getCurrentTime</code><code class="p">()</code> <code class="o">+</code> <code class="s2">" with "</code> <code class="o">+</code> <code class="nx">data</code><code class="p">);</code>

<code class="p">}</code>

<code class="c1">// Update the grid using the data passed to our subscribers</code>
<code class="nx">gridUpdate</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code><code class="p">,</code> <code class="nx">data</code> <code class="p">){</code>

  <code class="k">if</code> <code class="p">(</code> <code class="nx">data</code> <code class="o">!==</code> <code class="s2">"undefined"</code> <code class="p">)</code> <code class="p">{</code>
     <code class="nx">grid</code><code class="p">.</code><code class="nx">addGridRow</code><code class="p">(</code> <code class="nx">data</code> <code class="p">);</code>
     <code class="nx">grid</code><code class="p">.</code><code class="nx">updateCounter</code><code class="p">(</code> <code class="nx">data</code> <code class="p">);</code>
   <code class="p">}</code>

<code class="p">};</code>

<code class="c1">// The following represents updates to our data layer. This could be</code>
<code class="c1">// powered by ajax requests which broadcast that new data is available</code>
<code class="c1">// to the rest of the application.</code>

<code class="c1">// Publish changes to the gridUpdated topic representing new entries</code>
<code class="nx">pubsub</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"newDataAvailable"</code><code class="p">,</code> <code class="p">{</code>
  <code class="nx">summary</code><code class="o">:</code> <code class="s2">"Apple made $5 billion"</code><code class="p">,</code> 
  <code class="nx">identifier</code><code class="o">:</code> <code class="s2">"APPL"</code><code class="p">,</code>
  <code class="nx">stockPrice</code><code class="o">:</code> <code class="mf">570.91</code>
<code class="p">});</code>

<code class="nx">pubsub</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"newDataAvailable"</code><code class="p">,</code> <code class="p">{</code>
  <code class="nx">summary</code><code class="o">:</code> <code class="s2">"Microsoft made $20 million"</code><code class="p">,</code> 
  <code class="nx">identifier</code><code class="o">:</code> <code class="s2">"MSFT"</code><code class="p">,</code>
  <code class="nx">stockPrice</code><code class="o">:</code> <code class="mf">30.85</code>
<code class="p">});</code>
</pre></div></div></div><div class="sect3" title="Decoupling applications using Ben Alman's Pub/Sub implementation"><div class="titlepage"><div><div><h3 class="title"><a id="example-decoupling-applications-using-ben-almans-pubsub-implementation"></a>Decoupling applications using Ben Alman's Pub/Sub
        implementation</h3></div></div></div><p><a id="I_indexterm9_d1e2697" class="indexterm"></a><a id="I_indexterm9_d1e2702" class="indexterm"></a><a id="I_indexterm9_d1e2705" class="indexterm"></a><a id="index-737Q328RH1O" class="indexterm"></a><a id="I_indexterm9_d1e2711" class="indexterm"></a>In the following movie ratings example, we'll be using
        Ben Alman's jQuery implementation of Publish/Subscribe to demonstrate
        how we can decouple a user interface. Notice how submitting a rating only has
        the effect of publishing the fact that new user and rating data is
        available.</p><p>It's left up to the subscribers to those topics to then delegate
        what happens with that data. In our case, we're pushing that new data
        into existing arrays and then rendering them using the Underscore
        library's<a id="I_indexterm9_d1e2722" class="indexterm"></a> <code class="literal">.template()</code> method
        for templating.</p><p>Here is the HTML/Templates code (<a class="xref" href="ch09s05.html#html-templates-code" title="Example&nbsp;9-3.&nbsp;HTML/Templates code for Pub/Sub">Example&nbsp;9-3</a>):</p><div class="example"><a id="html-templates-code"></a><p class="title">Example&nbsp;9-3.&nbsp;HTML/Templates code for Pub/Sub</p><div class="example-contents"><p><a id="I_programlisting9_d1e2737"></a></p><pre class="programlisting_javascript"><code class="o">&lt;</code><code class="nx">script</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"userTemplate"</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text/html"</code><code class="o">&gt;</code>
   <code class="o">&lt;</code><code class="nx">li</code><code class="o">&gt;&lt;%=</code> <code class="nx">name</code> <code class="o">%&gt;&lt;</code><code class="err">/li&gt;</code>
<code class="o">&lt;</code><code class="err">/script&gt;</code>


<code class="o">&lt;</code><code class="nx">script</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"ratingsTemplate"</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text/html"</code><code class="o">&gt;</code>
   <code class="o">&lt;</code><code class="nx">li</code><code class="o">&gt;&lt;</code><code class="nx">strong</code><code class="o">&gt;&lt;%=</code> <code class="nx">title</code> <code class="o">%&gt;&lt;</code><code class="err">/strong&gt; was rated &lt;%= rating %&gt;/5&lt;/li&gt;</code>
<code class="o">&lt;</code><code class="err">/script&gt;</code>


<code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"container"</code><code class="o">&gt;</code>

   <code class="o">&lt;</code><code class="nx">div</code> <code class="kr">class</code><code class="o">=</code><code class="s2">"sampleForm"</code><code class="o">&gt;</code>
       <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
           <code class="o">&lt;</code><code class="nx">label</code> <code class="k">for</code><code class="o">=</code><code class="s2">"twitter_handle"</code><code class="o">&gt;</code><code class="nx">Twitter</code> <code class="nx">handle</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>
           <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"twitter_handle"</code> <code class="o">/&gt;</code>
       <code class="o">&lt;</code><code class="err">/p&gt;</code>
       <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
           <code class="o">&lt;</code><code class="nx">label</code> <code class="k">for</code><code class="o">=</code><code class="s2">"movie_seen"</code><code class="o">&gt;</code><code class="nx">Name</code> <code class="nx">a</code> <code class="nx">movie</code> <code class="nx">you</code><code class="err">'</code><code class="nx">ve</code> <code class="nx">seen</code> <code class="k">this</code> <code class="nx">year</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>
           <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"movie_seen"</code> <code class="o">/&gt;</code>
       <code class="o">&lt;</code><code class="err">/p&gt;</code>
       <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>

           <code class="o">&lt;</code><code class="nx">label</code> <code class="k">for</code><code class="o">=</code><code class="s2">"movie_rating"</code><code class="o">&gt;</code><code class="nx">Rate</code> <code class="nx">the</code> <code class="nx">movie</code> <code class="nx">you</code> <code class="nx">saw</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>
           <code class="o">&lt;</code><code class="nx">select</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"movie_rating"</code><code class="o">&gt;</code>
                 <code class="o">&lt;</code><code class="nx">option</code> <code class="nx">value</code><code class="o">=</code><code class="s2">"1"</code><code class="o">&gt;</code><code class="mi">1</code><code class="o">&lt;</code><code class="err">/option&gt;</code>
                  <code class="o">&lt;</code><code class="nx">option</code> <code class="nx">value</code><code class="o">=</code><code class="s2">"2"</code><code class="o">&gt;</code><code class="mi">2</code><code class="o">&lt;</code><code class="err">/option&gt;</code>
                  <code class="o">&lt;</code><code class="nx">option</code> <code class="nx">value</code><code class="o">=</code><code class="s2">"3"</code><code class="o">&gt;</code><code class="mi">3</code><code class="o">&lt;</code><code class="err">/option&gt;</code>
                  <code class="o">&lt;</code><code class="nx">option</code> <code class="nx">value</code><code class="o">=</code><code class="s2">"4"</code><code class="o">&gt;</code><code class="mi">4</code><code class="o">&lt;</code><code class="err">/option&gt;</code>
                  <code class="o">&lt;</code><code class="nx">option</code> <code class="nx">value</code><code class="o">=</code><code class="s2">"5"</code> <code class="nx">selected</code><code class="o">&gt;</code><code class="mi">5</code><code class="o">&lt;</code><code class="err">/option&gt;</code>

          <code class="o">&lt;</code><code class="err">/select&gt;</code>
        <code class="o">&lt;</code><code class="err">/p&gt;</code>
        <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>

            <code class="o">&lt;</code><code class="nx">button</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"add"</code><code class="o">&gt;</code><code class="nx">Submit</code> <code class="nx">rating</code><code class="o">&lt;</code><code class="err">/button&gt;</code>
        <code class="o">&lt;</code><code class="err">/p&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>



    <code class="o">&lt;</code><code class="nx">div</code> <code class="kr">class</code><code class="o">=</code><code class="s2">"summaryTable"</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"users"</code><code class="o">&gt;&lt;</code><code class="nx">h3</code><code class="o">&gt;</code><code class="nx">Recent</code> <code class="nx">users</code><code class="o">&lt;</code><code class="err">/h3&gt;&lt;/div&gt;</code>
        <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"ratings"</code><code class="o">&gt;&lt;</code><code class="nx">h3</code><code class="o">&gt;</code><code class="nx">Recent</code> <code class="nx">movies</code> <code class="nx">rated</code><code class="o">&lt;</code><code class="err">/h3&gt;&lt;/div&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>

 <code class="o">&lt;</code><code class="err">/div&gt;</code>
</pre></div></div><p>Here is the JavaScript code (<a class="xref" href="ch09s05.html#the-javascript-code" title="Example&nbsp;9-4.&nbsp;JavaScript code for Pub/Sub">Example&nbsp;9-4</a>):</p><div class="example"><a id="the-javascript-code"></a><p class="title">Example&nbsp;9-4.&nbsp;JavaScript code for Pub/Sub</p><div class="example-contents"><p><a id="I_programlisting9_d1e2747"></a></p><pre class="programlisting_javascript"><code class="p">;(</code><code class="kd">function</code><code class="p">(</code> <code class="nx">$</code> <code class="p">)</code> <code class="p">{</code>

    <code class="c1">// Subscribe to the new user topic, which adds a user</code>
  <code class="c1">// to a list of users who have submitted reviews</code>
  <code class="nx">$</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"/new/user"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">e</code><code class="p">,</code> <code class="nx">data</code> <code class="p">){</code>

    <code class="kd">var</code> <code class="nx">compiledTemplate</code><code class="p">;</code>

    <code class="k">if</code><code class="p">(</code> <code class="nx">data</code> <code class="p">){</code>

       <code class="nx">compiledTemplate</code> <code class="o">=</code> <code class="nx">_</code><code class="p">.</code><code class="nx">template</code><code class="p">(</code><code class="nx">$</code><code class="p">(</code> <code class="s2">"#userTemplate"</code> <code class="p">).</code><code class="nx">html</code><code class="p">());</code>

       <code class="nx">$</code><code class="p">(</code><code class="s1">'#users'</code><code class="p">).</code><code class="nx">append</code><code class="p">(</code> <code class="nx">compiledTemplate</code><code class="p">(</code> <code class="nx">data</code> <code class="p">));</code>

    <code class="p">}</code>

  <code class="p">});</code>


  <code class="c1">// Subscribe to the new rating topic. This is composed of a title and</code>
  <code class="c1">// rating. New ratings are appended to a running list of added user</code>
  <code class="c1">// ratings.</code>
  <code class="nx">$</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"/new/rating"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">e</code><code class="p">,</code> <code class="nx">data</code> <code class="p">){</code>

    <code class="kd">var</code> <code class="nx">compiledTemplate</code><code class="p">;</code>

    <code class="k">if</code><code class="p">(</code> <code class="nx">data</code> <code class="p">){</code>
      
      <code class="nx">compiledTemplate</code> <code class="o">=</code> <code class="nx">_</code><code class="p">.</code><code class="nx">template</code><code class="p">(</code><code class="nx">$</code><code class="p">(</code> <code class="s2">"#ratingsTemplate"</code> <code class="p">).</code><code class="nx">html</code><code class="p">());</code>

      <code class="nx">$</code><code class="p">(</code> <code class="s2">"#ratings"</code> <code class="p">).</code><code class="nx">append</code><code class="p">(</code> <code class="nx">compiledTemplate</code><code class="p">(</code> <code class="nx">data</code> <code class="p">)</code> <code class="p">);</code>

    <code class="p">}</code>

  <code class="p">});</code>

  <code class="c1">// Handler for adding a new user</code>
  <code class="nx">$</code><code class="p">(</code><code class="s2">"#add"</code><code class="p">).</code><code class="nx">on</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">e</code> <code class="p">)</code> <code class="p">{</code>

    <code class="nx">e</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>

    <code class="kd">var</code> <code class="nx">strUser</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s2">"#twitter_handle"</code><code class="p">).</code><code class="nx">val</code><code class="p">(),</code>
       <code class="nx">strMovie</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s2">"#movie_seen"</code><code class="p">).</code><code class="nx">val</code><code class="p">(),</code>
       <code class="nx">strRating</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s2">"#movie_rating"</code><code class="p">).</code><code class="nx">val</code><code class="p">();</code>

    <code class="c1">// Inform the application a new user is available</code>
    <code class="nx">$</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"/new/user"</code><code class="p">,</code>  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="nx">strUser</code> <code class="p">}</code> <code class="p">);</code>

    <code class="c1">// Inform the app a new rating is available</code>
    <code class="nx">$</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"/new/rating"</code><code class="p">,</code>  <code class="p">{</code> <code class="nx">title</code><code class="o">:</code> <code class="nx">strMovie</code><code class="p">,</code> <code class="nx">rating</code><code class="o">:</code> <code class="nx">strRating</code><code class="p">}</code> <code class="p">);</code>

    <code class="p">});</code>

<code class="p">})(</code> <code class="nx">jQuery</code> <code class="p">);</code>
</pre></div></div></div><div class="sect3" title="Decoupling an Ajax-based jQuery application"><div class="titlepage"><div><div><h3 class="title"><a id="example-decoupling-an-ajax-based-jquery-application"></a>Decoupling an Ajax-based jQuery application</h3></div></div></div><p><a id="I_indexterm9_d1e2753" class="indexterm"></a><a id="I_indexterm9_d1e2758" class="indexterm"></a><a id="I_indexterm9_d1e2763" class="indexterm"></a>In our final example, we're going to take a practical
        look at how decoupling our code using Pub/Sub early on in the
        development process can save us some potentially painful refactoring
        later on.</p><p>Quite often in Ajax-heavy applications, once we've received a
        response to a request, we want to achieve more than just one unique
        action. We could simply add all of the post-request logic into a
        success callback, but there are drawbacks to this approach.</p><p>Highly coupled applications sometimes increase the effort
        required to reuse functionality due to the increased
        inter-function/code dependency. What this means is that, although
        keeping our post-request logic hardcoded in a callback might be fine
        if we're just trying to grab a result set once, it's not as
        appropriate when we want to make further Ajax calls to the same data
        source (and different end behavior) without rewriting parts of the
        code multiple times. Rather than having to go back through each layer
        that calls the same data source and generalize them later on, we can
        use pub/sub from the start and save time.</p><p>Using Observers,<a id="I_indexterm9_d1e2773" class="indexterm"></a><a id="I_indexterm9_d1e2778" class="indexterm"></a> we can also easily separate application-wide
        notifications regarding different events down to whatever level of
        granularity we're comfortable withâ€”something that can be less
        elegantly done using other patterns.</p><p>Notice how in our sample below, one topic notification is made
        when a user indicates that he wants to make a search query and another
        is made when the request returns and actual data is available for
        consumption. It's left up to the subscribers to then decide how to use
        knowledge of these events (or the data returned). The benefits of this
        are that, if we wanted, we could have 10 different subscribers using
        the data returned in different ways, but as far as the Ajax-layer is
        concerned, it doesn't care. Its sole duty is to request and return
        data, then pass it on to whoever wants to use it. This separation of
        concerns can make the overall design of our code a little
        cleaner.</p><p>Here is the HTML/Templates code (<a class="xref" href="ch09s05.html#html-templates-ajax" title="Example&nbsp;9-5.&nbsp;HTML/Templates code for Ajax">Example&nbsp;9-5</a>):</p><div class="example"><a id="html-templates-ajax"></a><p class="title">Example&nbsp;9-5.&nbsp;HTML/Templates code for Ajax</p><div class="example-contents"><p><a id="I_programlisting9_d1e2794"></a></p><pre class="programlisting_javascript"><code class="o">&lt;</code><code class="nx">form</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"flickrSearch"</code><code class="o">&gt;</code>

   <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">name</code><code class="o">=</code><code class="s2">"tag"</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"query"</code><code class="o">/&gt;</code>

   <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"submit' name="</code><code class="nx">submit</code><code class="s1">' value="submit'</code><code class="o">/&gt;</code>

<code class="o">&lt;</code><code class="err">/form&gt;</code>



<code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"lastQuery"</code><code class="o">&gt;&lt;</code><code class="err">/div&gt;</code>

<code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"searchResults"</code><code class="o">&gt;&lt;</code><code class="err">/div&gt;</code>



<code class="o">&lt;</code><code class="nx">script</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"resultTemplate"</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text/html"</code><code class="o">&gt;</code>
    <code class="o">&lt;%</code> <code class="nx">_</code><code class="p">.</code><code class="nx">each</code><code class="p">(</code><code class="nx">items</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">item</code> <code class="p">){</code>  <code class="o">%&gt;</code>
            <code class="o">&lt;</code><code class="nx">li</code><code class="o">&gt;&lt;</code><code class="nx">p</code><code class="o">&gt;&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="s2">"&lt;%= item.media.m %&gt;"</code><code class="o">/&gt;&lt;</code><code class="err">/p&gt;&lt;/li&gt;</code>
    <code class="o">&lt;%</code> <code class="p">});</code><code class="o">%&gt;</code>
<code class="o">&lt;</code><code class="err">/script&gt;</code>
</pre></div></div><p>Here is the JavaScript code (<a class="xref" href="ch09s05.html#javascript-code-ajax" title="Example&nbsp;9-6.&nbsp;JavaScript code for Ajax">Example&nbsp;9-6</a>):</p><div class="example"><a id="javascript-code-ajax"></a><p class="title">Example&nbsp;9-6.&nbsp;JavaScript code for Ajax</p><div class="example-contents"><p><a id="I_programlisting9_d1e2804"></a></p><pre class="programlisting_javascript"><code class="p">;(</code><code class="kd">function</code><code class="p">(</code> <code class="nx">$</code> <code class="p">)</code> <code class="p">{</code>

    <code class="c1">// Pre-compile template and "cache" it using closure</code>
    <code class="kd">var</code> <code class="nx">resultTemplate</code> <code class="o">=</code> <code class="nx">_</code><code class="p">.</code><code class="nx">template</code><code class="p">(</code><code class="nx">$</code><code class="p">(</code> <code class="s2">"#resultTemplate"</code> <code class="p">).</code><code class="nx">html</code><code class="p">());</code>

   <code class="c1">// Subscribe to the new search tags topic</code>
   <code class="nx">$</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"/search/tags"</code> <code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">tags</code> <code class="p">)</code> <code class="p">{</code>
       <code class="nx">$</code><code class="p">(</code> <code class="s2">"#searchResults"</code> <code class="p">)</code>
                <code class="p">.</code><code class="nx">html</code><code class="p">(</code><code class="s2">"Searched for:"</code> <code class="o">+</code> <code class="nx">tags</code> <code class="o">+</code> <code class="s2">""</code><code class="p">);</code>
   <code class="p">});</code>

   <code class="c1">// Subscribe to the new results topic</code>
   <code class="nx">$</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code> <code class="s2">"/search/resultSet"</code> <code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">results</code> <code class="p">){</code>

       <code class="nx">$</code><code class="p">(</code> <code class="s2">"#searchResults"</code> <code class="p">).</code><code class="nx">append</code><code class="p">(</code><code class="nx">resultTemplate</code><code class="p">(</code> <code class="nx">results</code> <code class="p">));</code>

       <code class="nx">$</code><code class="p">(</code> <code class="s2">"#searchResults"</code> <code class="p">).</code><code class="nx">append</code><code class="p">(</code><code class="nx">compiled_template</code><code class="p">(</code> <code class="nx">results</code> <code class="p">));</code>

   <code class="p">});</code>

   <code class="c1">// Submit a search query and publish tags on the /search/tags topic</code>
   <code class="nx">$</code><code class="p">(</code> <code class="s2">"#flickrSearch"</code> <code class="p">).</code><code class="nx">submit</code><code class="p">(</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">e</code> <code class="p">)</code> <code class="p">{</code>

       <code class="nx">e</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>
       <code class="kd">var</code> <code class="nx">tags</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="k">this</code><code class="p">).</code><code class="nx">find</code><code class="p">(</code> <code class="s2">"#query"</code><code class="p">).</code><code class="nx">val</code><code class="p">();</code>

       <code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="nx">tags</code> <code class="p">){</code>
        <code class="k">return</code><code class="p">;</code>
       <code class="p">}</code>

       <code class="nx">$</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"/search/tags"</code> <code class="p">,</code> <code class="p">[</code> <code class="nx">$</code><code class="p">.</code><code class="nx">trim</code><code class="p">(</code><code class="nx">tags</code><code class="p">)</code> <code class="p">]);</code>

   <code class="p">});</code>


   <code class="c1">// Subscribe to new tags being published and perform</code>
   <code class="c1">// a search query using them. Once data has returned</code>
   <code class="c1">// publish this data for the rest of the application</code>
   <code class="c1">// to consume</code>

   <code class="nx">$</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code><code class="s2">"/search/tags"</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">tags</code> <code class="p">)</code> <code class="p">{</code>

       <code class="nx">$</code><code class="p">.</code><code class="nx">getJSON</code><code class="p">(</code> <code class="s2">"http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?"</code> <code class="p">,{</code> 
              <code class="nx">tags</code><code class="o">:</code> <code class="nx">tags</code><code class="p">,</code> 
              <code class="nx">tagmode</code><code class="o">:</code> <code class="s2">"any"</code><code class="p">,</code> 
              <code class="nx">format</code><code class="o">:</code> <code class="s2">"json"</code>
            <code class="p">},</code>

          <code class="kd">function</code><code class="p">(</code> <code class="nx">data</code> <code class="p">){</code>

              <code class="k">if</code><code class="p">(</code> <code class="o">!</code><code class="nx">data</code><code class="p">.</code><code class="nx">items</code><code class="p">.</code><code class="nx">length</code> <code class="p">)</code> <code class="p">{</code> 
                <code class="k">return</code><code class="p">;</code> 
              <code class="p">}</code>

              <code class="nx">$</code><code class="p">.</code><code class="nx">publish</code><code class="p">(</code> <code class="s2">"/search/resultSet"</code> <code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">items</code>  <code class="p">);</code>
       <code class="p">});</code>

   <code class="p">});</code>


<code class="p">})();</code>
</pre></div></div><p>The Observer pattern is useful for decoupling a number of
        different scenarios in application design, and if you haven't been
        using it, I recommend picking up one of the prewritten implementations
        mentioned here and giving it a try. It's one of the easier design
        patterns to get started with but also one of the most
        powerful.<a id="I_indexterm9_d1e2810" class="indexterm"></a><a id="I_indexterm9_d1e2811" class="indexterm"></a><a id="I_indexterm9_d1e2812" class="indexterm"></a><a id="I_indexterm9_d1e2813" class="indexterm"></a></p></div></div></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Mediator Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-mediator-pattern"></a>The Mediator Pattern</h1></div></div></div><p><a id="index-656M632EO0H" class="indexterm"></a>The dictionary refers to a mediator as "a neutral party that
    assists in negotiations and conflict resolution."<sup>[<a id="id685811" href="#ftn.id685811" class="footnote totri-footnote">2</a>]</sup> In our world, a mediator is a behavioral design pattern that
    allows us to expose a unified interface through which the different parts
    of a system may communicate.</p><p>If it appears a system has too many direct relationships between
    components, it may be time to have a central point of control that
    components communicate through instead. The Mediator pattern promotes
    loose coupling by ensuring that instead of components referring to each
    other explicitly, their interaction is handled through this central point.
    This can help us decouple systems and improve the potential for component
    reusability.</p><p>A real-world analogy could be a typical airport traffic control
    system.<a id="I_indexterm9_d1e2834" class="indexterm"></a> A tower (mediator) handles which planes can take off and
    land, because all communications (notifications being listened for or
    broadcast) are performed from the planes to the control tower, rather than
    from plane to plane. A centralized controller is key to the success of
    this system, and that's really the role that the Mediator plays in
    software design (<a class="xref" href="ch09s06.html#mediator" title="Figure&nbsp;9-5.&nbsp;Mediator pattern">Figure&nbsp;9-5</a>).</p><div class="figure-float"><div class="figure"><a id="mediator"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e2845"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326898.png" alt="Mediator pattern" width="520" height="314" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326898.png"></div></div><p class="title">Figure&nbsp;9-5.&nbsp;Mediator pattern</p></div></div><p>In implementation terms, the Mediator pattern is essentially a
    shared subject in the Observer pattern. This might assume that a direction
    Publish/Subscribe relationship between objects or modules in such systems
    is sacrificed in order to maintain a central point of contact.</p><p>It may also be considered supplementalâ€”perhaps used for
    application-level notifications such as a communication between different
    subsystems that are themselves complex and may desire internal component
    decoupling through Publish/Subscribe relationships.</p><p>Another analogy would be DOM <a id="I_indexterm9_d1e2856" class="indexterm"></a><a id="I_indexterm9_d1e2861" class="indexterm"></a>event bubbling and event delegation. If all subscriptions in
    a system are made against the document rather than individual nodes, the
    document effectively serves as a mediator. Instead of binding to the
    events of the individual nodes, a higher level object is given the
    responsibility of notifying subscribers about interaction events.</p><div class="sect2" title="Basic Implementation"><div class="titlepage"><div><div><h2 class="title"><a id="basic-implementation"></a>Basic Implementation</h2></div></div></div><p><a id="index-650U356QE4D" class="indexterm"></a>A simple implementation of the Mediator pattern can be
      found below, exposing both <code class="literal">publish()</code>
      and <code class="literal">subscribe()</code> methods for
      use:</p><a id="I_programlisting9_d1e2883"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">mediator</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code><code class="p">(){</code>

    <code class="c1">// Storage for topics that can be broadcast or listened to</code>
    <code class="kd">var</code> <code class="nx">topics</code> <code class="o">=</code> <code class="p">{};</code>

    <code class="c1">// Subscribe to a topic, supply a callback to be executed</code>
    <code class="c1">// when that topic is broadcast to</code>
    <code class="kd">var</code> <code class="nx">subscribe</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code><code class="p">,</code> <code class="nx">fn</code> <code class="p">){</code>

        <code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">]</code> <code class="p">){</code> 
          <code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">]</code> <code class="o">=</code> <code class="p">[];</code>
        <code class="p">}</code>

        <code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">].</code><code class="nx">push</code><code class="p">(</code> <code class="p">{</code> <code class="nx">context</code><code class="o">:</code> <code class="k">this</code><code class="p">,</code> <code class="nx">callback</code><code class="o">:</code> <code class="nx">fn</code> <code class="p">}</code> <code class="p">);</code>

        <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">};</code>

    <code class="c1">// Publish/broadcast an event to the rest of the application</code>
    <code class="kd">var</code> <code class="nx">publish</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code> <code class="p">){</code>

        <code class="kd">var</code> <code class="nx">args</code><code class="p">;</code>

        <code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">]</code> <code class="p">){</code>
          <code class="k">return</code> <code class="kc">false</code><code class="p">;</code>
        <code class="p">}</code> 

        <code class="nx">args</code> <code class="o">=</code> <code class="nb">Array</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">slice</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code> <code class="nx">arguments</code><code class="p">,</code> <code class="mi">1</code> <code class="p">);</code>
        <code class="k">for</code> <code class="p">(</code> <code class="kd">var</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">l</code> <code class="o">=</code> <code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">].</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">l</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code> <code class="p">)</code> <code class="p">{</code>

            <code class="kd">var</code> <code class="nx">subscription</code> <code class="o">=</code> <code class="nx">topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">][</code><code class="nx">i</code><code class="p">];</code>
            <code class="nx">subscription</code><code class="p">.</code><code class="nx">callback</code><code class="p">.</code><code class="nx">apply</code><code class="p">(</code> <code class="nx">subscription</code><code class="p">.</code><code class="nx">context</code><code class="p">,</code> <code class="nx">args</code> <code class="p">);</code>
        <code class="p">}</code>
        <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">};</code>

    <code class="k">return</code> <code class="p">{</code>
        <code class="nx">Publish</code><code class="o">:</code> <code class="nx">publish</code><code class="p">,</code>
        <code class="nx">Subscribe</code><code class="o">:</code> <code class="nx">subscribe</code><code class="p">,</code>
        <code class="nx">installTo</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">obj</code> <code class="p">){</code>
            <code class="nx">obj</code><code class="p">.</code><code class="nx">subscribe</code> <code class="o">=</code> <code class="nx">subscribe</code><code class="p">;</code>
            <code class="nx">obj</code><code class="p">.</code><code class="nx">publish</code> <code class="o">=</code> <code class="nx">publish</code><code class="p">;</code>
        <code class="p">}</code>
    <code class="p">};</code>

<code class="p">}());</code>
</pre></div><div class="sect2" title="Advanced Implementation"><div class="titlepage"><div><div><h2 class="title"><a id="advanced-implementation"></a>Advanced Implementation</h2></div></div></div><p>For those interested in a more advanced implementation, read on
      for a walkthrough of my trimmed-down version of Jack Lawson's excellent
      <a class="ulink" href="http://thejacklawson.com/Mediator.js/">Mediator.js</a>.
      Among other improvements, this version supports topic namespaces,
      subscriber removal, and a much more robust Publish/Subscribe system for
      our Mediator. If however, you wish to skip this walkthrough, you can go
      directly to the next example to continue reading.<sup>[<a id="thanks_jake" href="#ftn.thanks_jake" class="footnote totri-footnote">3</a>]</sup></p><p>To start, let's implement the notion of a subscriber, which we can
      consider an instance of a Mediator's topic registration.</p><p>By generating object instances, we can easily update subscribers
      later without the need to unregister and re-register them. Subscribers
      can be written as constructors that take a function <code class="literal">fn</code> to be called, an <code class="literal">options</code> object, and a <code class="literal">context</code>.</p><a id="I_programlisting9_d1e2909"></a><pre class="programlisting_javascript"><code class="c1">// Pass in a context to attach our Mediator to. </code>
<code class="c1">// By default this will be the window object</code>
<code class="p">(</code><code class="kd">function</code><code class="p">(</code> <code class="nx">root</code> <code class="p">){</code>
   
  <code class="kd">function</code> <code class="nx">guidGenerator</code><code class="p">()</code> <code class="p">{</code> <code class="cm">/*..*/</code><code class="p">}</code>

  <code class="c1">// Our Subscriber constructor</code>
  <code class="kd">function</code> <code class="nx">Subscriber</code><code class="p">(</code> <code class="nx">fn</code><code class="p">,</code> <code class="nx">options</code><code class="p">,</code> <code class="nx">context</code> <code class="p">){</code>

    <code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="k">this</code> <code class="k">instanceof</code> <code class="nx">Subscriber</code> <code class="p">)</code> <code class="p">{</code>

      <code class="k">return</code> <code class="k">new</code> <code class="nx">Subscriber</code><code class="p">(</code> <code class="nx">fn</code><code class="p">,</code> <code class="nx">context</code><code class="p">,</code> <code class="nx">options</code> <code class="p">);</code>

    <code class="p">}</code><code class="k">else</code><code class="p">{</code>

      <code class="c1">// guidGenerator() is a function that generates </code>
      <code class="c1">// GUIDs for instances of our Mediators Subscribers so</code>
      <code class="c1">// we can easily reference them later on. We're going</code>
      <code class="c1">// to skip its implementation for brevity</code>

      <code class="k">this</code><code class="p">.</code><code class="nx">id</code> <code class="o">=</code> <code class="nx">guidGenerator</code><code class="p">();</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">fn</code> <code class="o">=</code> <code class="nx">fn</code><code class="p">;</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">options</code> <code class="o">=</code> <code class="nx">options</code><code class="p">;</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">context</code> <code class="o">=</code> <code class="nx">context</code><code class="p">;</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">topic</code> <code class="o">=</code> <code class="kc">null</code><code class="p">;</code>

    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">})();</code>
</pre><p>Topics in our Mediator hold a list of callbacks and subtopics that
      are fired when <code class="literal">Mediator.Publish</code> is
      called on our Mediator instance. It also contains methods for
      manipulating lists <a id="I_indexterm9_d1e2916" class="indexterm"></a>of data.</p><a id="I_programlisting9_d1e2922"></a><pre class="programlisting_javascript"><code class="c1">// Let's model the Topic.</code>
<code class="c1">// JavaScript lets us use a Function object as a </code>
<code class="c1">// conjunction of a prototype for use with the new </code>
<code class="c1">// object and a constructor function to be invoked.</code>
<code class="kd">function</code> <code class="nx">Topic</code><code class="p">(</code> <code class="nx">namespace</code> <code class="p">){</code>

  <code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="k">this</code> <code class="k">instanceof</code> <code class="nx">Topic</code> <code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="k">new</code> <code class="nx">Topic</code><code class="p">(</code> <code class="nx">namespace</code> <code class="p">);</code>
  <code class="p">}</code><code class="k">else</code><code class="p">{</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">namespace</code> <code class="o">=</code> <code class="nx">namespace</code> <code class="o">||</code> <code class="s2">""</code><code class="p">;</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code> <code class="o">=</code> <code class="p">[];</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code> <code class="o">=</code> <code class="p">[];</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">stopped</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>

  <code class="p">}</code>
<code class="p">}</code>


<code class="c1">// Define the prototype for our topic, including ways to</code>
<code class="c1">// add new subscribers or retrieve existing ones.</code>
<code class="nx">Topic</code><code class="p">.</code><code class="nx">prototype</code> <code class="o">=</code> <code class="p">{</code>

  <code class="c1">// Add a new subscriber </code>
  <code class="nx">AddSubscriber</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">fn</code><code class="p">,</code> <code class="nx">options</code><code class="p">,</code> <code class="nx">context</code> <code class="p">){</code>

    <code class="kd">var</code> <code class="nx">callback</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Subscriber</code><code class="p">(</code> <code class="nx">fn</code><code class="p">,</code> <code class="nx">options</code><code class="p">,</code> <code class="nx">context</code> <code class="p">);</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code> <code class="nx">callback</code> <code class="p">);</code>

    <code class="nx">callback</code><code class="p">.</code><code class="nx">topic</code> <code class="o">=</code> <code class="k">this</code><code class="p">;</code>

    <code class="k">return</code> <code class="nx">callback</code><code class="p">;</code>
  <code class="p">},</code>
<code class="p">...</code>
</pre><p>Our topic instance is passed along as an argument to the Mediator
      callback.<a id="I_indexterm9_d1e2926" class="indexterm"></a> Further callback propagation can then be called using a
      handy utility method called <code class="literal">StopPropagation()</code>:</p><a id="I_programlisting9_d1e2935"></a><pre class="programlisting_javascript">    <code class="nx">StopPropagation</code><code class="o">:</code> <code class="kd">function</code><code class="p">(){</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">stopped</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
    <code class="p">},</code>
</pre><p>We can also make it easy to retrieve existing subscribers when
      given a GUID identifier:</p><a id="I_programlisting9_d1e2939"></a><pre class="programlisting_javascript">    <code class="nx">GetSubscriber</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">identifier</code> <code class="p">){</code>

      <code class="k">for</code><code class="p">(</code><code class="kd">var</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">y</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">x</code> <code class="o">&lt;</code> <code class="nx">y</code><code class="p">;</code> <code class="nx">x</code><code class="o">++</code> <code class="p">){</code>
        <code class="k">if</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">[</code><code class="nx">x</code><code class="p">].</code><code class="nx">id</code> <code class="o">==</code> <code class="nx">identifier</code> <code class="o">||</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">[</code><code class="nx">x</code><code class="p">].</code><code class="nx">fn</code> <code class="o">==</code> <code class="nx">identifier</code> <code class="p">){</code>
          <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">[</code><code class="nx">x</code><code class="p">];</code>
        <code class="p">}</code>
      <code class="p">}</code>

      <code class="k">for</code><code class="p">(</code> <code class="kd">var</code> <code class="nx">z</code> <code class="k">in</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code> <code class="p">){</code>
        <code class="k">if</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">.</code><code class="nx">hasOwnProperty</code><code class="p">(</code> <code class="nx">z</code> <code class="p">)</code> <code class="p">){</code>
          <code class="kd">var</code> <code class="nx">sub</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">[</code><code class="nx">z</code><code class="p">].</code><code class="nx">GetSubscriber</code><code class="p">(</code> <code class="nx">identifier</code> <code class="p">);</code>
          <code class="k">if</code><code class="p">(</code> <code class="nx">sub</code> <code class="o">!==</code> <code class="kc">undefined</code> <code class="p">){</code>
            <code class="k">return</code> <code class="nx">sub</code><code class="p">;</code>
          <code class="p">}</code>
        <code class="p">}</code>
      <code class="p">}</code>

    <code class="p">},</code>
</pre><p>Next, in case we need them, we can offer easy ways to add new
      topics, check for existing topics, or retrieve topics:</p><a id="I_programlisting9_d1e2944"></a><pre class="programlisting_javascript">    <code class="nx">AddTopic</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code> <code class="p">){</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">]</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Topic</code><code class="p">(</code> <code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">namespace</code> <code class="o">?</code> <code class="k">this</code><code class="p">.</code><code class="nx">namespace</code> <code class="o">+</code> <code class="s2">":"</code> <code class="o">:</code> <code class="s2">""</code><code class="p">)</code> <code class="o">+</code> <code class="nx">topic</code> <code class="p">);</code>
    <code class="p">},</code>

    <code class="nx">HasTopic</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code> <code class="p">){</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">.</code><code class="nx">hasOwnProperty</code><code class="p">(</code> <code class="nx">topic</code> <code class="p">);</code>
    <code class="p">},</code>

    <code class="nx">ReturnTopic</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topic</code> <code class="p">){</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">[</code><code class="nx">topic</code><code class="p">];</code>
    <code class="p">},</code>
</pre><p>We can explicitly remove subscribers if we feel they are no longer
      necessary. The following will recursively remove a Subscriber through
      its subtopics:</p><a id="I_programlisting9_d1e2948"></a><pre class="programlisting_javascript">    <code class="nx">RemoveSubscriber</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">identifier</code> <code class="p">){</code>

      <code class="k">if</code><code class="p">(</code> <code class="o">!</code><code class="nx">identifier</code> <code class="p">){</code>
        <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code> <code class="o">=</code> <code class="p">[];</code>

        <code class="k">for</code><code class="p">(</code> <code class="kd">var</code> <code class="nx">z</code> <code class="k">in</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code> <code class="p">){</code>
          <code class="k">if</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">.</code><code class="nx">hasOwnProperty</code><code class="p">(</code><code class="nx">z</code><code class="p">)</code> <code class="p">){</code>
            <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">[</code><code class="nx">z</code><code class="p">].</code><code class="nx">RemoveSubscriber</code><code class="p">(</code> <code class="nx">identifier</code> <code class="p">);</code>
          <code class="p">}</code>
        <code class="p">}</code>
      <code class="p">}</code>

      <code class="k">for</code><code class="p">(</code> <code class="kd">var</code> <code class="nx">y</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">x</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">y</code> <code class="o">&lt;</code> <code class="nx">x</code><code class="p">;</code> <code class="nx">y</code><code class="o">++</code> <code class="p">)</code> <code class="p">{</code>
        <code class="k">if</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">[</code><code class="nx">y</code><code class="p">].</code><code class="nx">fn</code> <code class="o">==</code> <code class="nx">identifier</code> <code class="o">||</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">[</code><code class="nx">y</code><code class="p">].</code><code class="nx">id</code> <code class="o">==</code> <code class="nx">identifier</code> <code class="p">){</code>
          <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">[</code><code class="nx">y</code><code class="p">].</code><code class="nx">topic</code> <code class="o">=</code> <code class="kc">null</code><code class="p">;</code>
          <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">.</code><code class="nx">splice</code><code class="p">(</code> <code class="nx">y</code><code class="p">,</code><code class="mi">1</code> <code class="p">);</code>
          <code class="nx">x</code><code class="o">--</code><code class="p">;</code> <code class="nx">y</code><code class="o">--</code><code class="p">;</code>
        <code class="p">}</code>
      <code class="p">}</code>

    <code class="p">},</code>
</pre><p>Next, we include the ability to <code class="literal">Publish</code> arbitrary arguments to subscribers
      recursively through subtopics.</p><a id="I_programlisting9_d1e2955"></a><pre class="programlisting_javascript">    <code class="nx">Publish</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">data</code> <code class="p">){</code>

      <code class="k">for</code><code class="p">(</code> <code class="kd">var</code> <code class="nx">y</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">x</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">y</code> <code class="o">&lt;</code> <code class="nx">x</code><code class="p">;</code> <code class="nx">y</code><code class="o">++</code> <code class="p">)</code> <code class="p">{</code>

          <code class="kd">var</code> <code class="nx">callback</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">[</code><code class="nx">y</code><code class="p">],</code> <code class="nx">l</code><code class="p">;</code>
            <code class="nx">callback</code><code class="p">.</code><code class="nx">fn</code><code class="p">.</code><code class="nx">apply</code><code class="p">(</code> <code class="nx">callback</code><code class="p">.</code><code class="nx">context</code><code class="p">,</code> <code class="nx">data</code> <code class="p">);</code>

        <code class="nx">l</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">_callbacks</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code>

        <code class="k">if</code><code class="p">(</code> <code class="nx">l</code> <code class="o">&lt;</code> <code class="nx">x</code> <code class="p">){</code>
          <code class="nx">y</code><code class="o">--</code><code class="p">;</code> 
          <code class="nx">x</code> <code class="o">=</code> <code class="nx">l</code><code class="p">;</code>
        <code class="p">}</code>
      <code class="p">}</code>

      <code class="k">for</code><code class="p">(</code> <code class="kd">var</code> <code class="nx">x</code> <code class="k">in</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code> <code class="p">){</code>
        <code class="k">if</code><code class="p">(</code> <code class="o">!</code><code class="k">this</code><code class="p">.</code><code class="nx">stopped</code> <code class="p">){</code>
          <code class="k">if</code><code class="p">(</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">.</code><code class="nx">hasOwnProperty</code><code class="p">(</code> <code class="nx">x</code> <code class="p">)</code> <code class="p">){</code>
            <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">[</code><code class="nx">x</code><code class="p">].</code><code class="nx">Publish</code><code class="p">(</code> <code class="nx">data</code> <code class="p">);</code>
          <code class="p">}</code>
        <code class="p">}</code>
      <code class="p">}</code>

      <code class="k">this</code><code class="p">.</code><code class="nx">stopped</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">};</code>
</pre><p>Here we expose the <code class="literal">Mediator</code>
      instance we will primarily be interacting with. It is through here that
      events <a id="I_indexterm9_d1e2962" class="indexterm"></a>are registered and removed from topics.</p><a id="I_programlisting9_d1e2968"></a><pre class="programlisting_javascript">  <code class="kd">function</code> <code class="nx">Mediator</code><code class="p">()</code> <code class="p">{</code>

    <code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="k">this</code> <code class="k">instanceof</code> <code class="nx">Mediator</code> <code class="p">)</code> <code class="p">{</code>
      <code class="k">return</code> <code class="k">new</code> <code class="nx">Mediator</code><code class="p">();</code>
    <code class="p">}</code><code class="k">else</code><code class="p">{</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Topic</code><code class="p">(</code> <code class="s2">""</code> <code class="p">);</code>
    <code class="p">}</code>

  <code class="p">};</code>
</pre><p>For more advanced-use cases, we can get our Mediator supporting
      namespaces for topics such as <code class="literal">inbox:messages:new:read</code>.<code class="literal">GetTopic</code>, which in the following example,
      returns topic instances based on a namespace.</p><a id="I_programlisting9_d1e2978"></a><pre class="programlisting_javascript">  <code class="nx">Mediator</code><code class="p">.</code><code class="nx">prototype</code> <code class="o">=</code> <code class="p">{</code>

    <code class="nx">GetTopic</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">namespace</code> <code class="p">){</code>
      <code class="kd">var</code> <code class="nx">topic</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">_topics</code><code class="p">,</code>
          <code class="nx">namespaceHierarchy</code> <code class="o">=</code> <code class="nx">namespace</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code> <code class="s2">":"</code> <code class="p">);</code>

      <code class="k">if</code><code class="p">(</code> <code class="nx">namespace</code> <code class="o">===</code> <code class="s2">""</code> <code class="p">){</code>
        <code class="k">return</code> <code class="nx">topic</code><code class="p">;</code>
      <code class="p">}</code>

      <code class="k">if</code><code class="p">(</code> <code class="nx">namespaceHierarchy</code><code class="p">.</code><code class="nx">length</code> <code class="o">&gt;</code> <code class="mi">0</code> <code class="p">){</code>
        <code class="k">for</code><code class="p">(</code> <code class="kd">var</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">j</code> <code class="o">=</code> <code class="nx">namespaceHierarchy</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">j</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code> <code class="p">){</code>

          <code class="k">if</code><code class="p">(</code> <code class="o">!</code><code class="nx">topic</code><code class="p">.</code><code class="nx">HasTopic</code><code class="p">(</code> <code class="nx">namespaceHierarchy</code><code class="p">[</code><code class="nx">i</code><code class="p">])</code> <code class="p">){</code>
            <code class="nx">topic</code><code class="p">.</code><code class="nx">AddTopic</code><code class="p">(</code> <code class="nx">namespaceHierarchy</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code> <code class="p">);</code>
          <code class="p">}</code>

          <code class="nx">topic</code> <code class="o">=</code> <code class="nx">topic</code><code class="p">.</code><code class="nx">ReturnTopic</code><code class="p">(</code> <code class="nx">namespaceHierarchy</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code> <code class="p">);</code>
        <code class="p">}</code>
      <code class="p">}</code>

      <code class="k">return</code> <code class="nx">topic</code><code class="p">;</code>
    <code class="p">},</code>
</pre><p>In this section, we define a <code class="literal">Mediator.Subscribe</code> method, which accepts a
      topic namespace,<a id="I_indexterm9_d1e2985" class="indexterm"></a> a function <code class="literal">fn</code> to be
      executed, <code class="literal">options</code>, and once again a
      <code class="literal">context</code> to call the function into
      <code class="literal">Subscribe</code>. This creates a topic if one doesn't
      exist.</p><a id="I_programlisting9_d1e3005"></a><pre class="programlisting_javascript">    <code class="nx">Subscribe</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topiclName</code><code class="p">,</code> <code class="nx">fn</code><code class="p">,</code> <code class="nx">options</code><code class="p">,</code> <code class="nx">context</code> <code class="p">){</code>
      <code class="kd">var</code> <code class="nx">options</code> <code class="o">=</code> <code class="nx">options</code> <code class="o">||</code> <code class="p">{},</code>
          <code class="nx">context</code> <code class="o">=</code> <code class="nx">context</code> <code class="o">||</code> <code class="p">{},</code>
          <code class="nx">topic</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">GetTopic</code><code class="p">(</code> <code class="nx">topicName</code> <code class="p">),</code>
          <code class="nx">sub</code> <code class="o">=</code> <code class="nx">topic</code><code class="p">.</code><code class="nx">AddSubscriber</code><code class="p">(</code> <code class="nx">fn</code><code class="p">,</code> <code class="nx">options</code><code class="p">,</code> <code class="nx">context</code> <code class="p">);</code>

      <code class="k">return</code> <code class="nx">sub</code><code class="p">;</code>
    <code class="p">},</code>
</pre><p>Continuing on from this, we can define further utilities for
      accessing specific subscribers or removing them from topics
      recursively.</p><a id="I_programlisting9_d1e3009"></a><pre class="programlisting_javascript">    <code class="c1">// Returns a subscriber for a given subscriber id / named function and topic namespace</code>

    <code class="nx">GetSubscriber</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">identifier</code><code class="p">,</code> <code class="nx">topic</code> <code class="p">){</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">GetTopic</code><code class="p">(</code> <code class="nx">topic</code> <code class="o">||</code> <code class="s2">""</code> <code class="p">).</code><code class="nx">GetSubscriber</code><code class="p">(</code> <code class="nx">identifier</code> <code class="p">);</code>
    <code class="p">},</code>

    <code class="c1">// Remove a subscriber from a given topic namespace recursively based on</code>
    <code class="c1">// a provided subscriber id or named function.</code>

    <code class="nx">Remove</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topicName</code><code class="p">,</code> <code class="nx">identifier</code> <code class="p">){</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">GetTopic</code><code class="p">(</code> <code class="nx">topicName</code> <code class="p">).</code><code class="nx">RemoveSubscriber</code><code class="p">(</code> <code class="nx">identifier</code> <code class="p">);</code>
    <code class="p">},</code>
</pre><p>Our primary <code class="literal">Publish</code> method
      allows us to arbitrarily publish data to a chosen topic
      namespace.</p><p>Topics are called recursively downward. For example, a post to
      <code class="literal">inbox:messages</code> will post to <code class="literal">inbox:messages:new</code> and <code class="literal">inbox:messages:new:read</code>. It is used as
      follows:</p><a id="I_programlisting9_d1e3027"></a><pre class="programlisting_javascript">    <code class="nx">Mediator</code><code class="p">.</code><code class="nx">Publish</code><code class="p">(</code> <code class="s2">"inbox:messages:new"</code><code class="p">,</code> <code class="p">[</code><code class="nx">args</code><code class="p">]</code> <code class="p">);</code>
    <code class="nx">Publish</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">topicName</code> <code class="p">){</code>
      <code class="kd">var</code> <code class="nx">args</code> <code class="o">=</code> <code class="nb">Array</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">slice</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code> <code class="nx">arguments</code><code class="p">,</code> <code class="mi">1</code><code class="p">),</code>
          <code class="nx">topic</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">GetTopic</code><code class="p">(</code> <code class="nx">topicName</code> <code class="p">);</code>

      <code class="nx">args</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code> <code class="nx">topic</code> <code class="p">);</code>

      <code class="k">this</code><code class="p">.</code><code class="nx">GetTopic</code><code class="p">(</code> <code class="nx">topicName</code> <code class="p">).</code><code class="nx">Publish</code><code class="p">(</code> <code class="nx">args</code> <code class="p">);</code>
    <code class="p">}</code>
  <code class="p">};</code>
</pre><p>Finally we can easily expose our Mediator for attachment to the
      object passed in to <code class="literal">root</code>:<a id="I_indexterm9_d1e3034" class="indexterm"></a></p><a id="I_programlisting9_d1e3035"></a><pre class="programlisting_javascript">  <code class="nx">root</code><code class="p">.</code><code class="nx">Mediator</code> <code class="o">=</code> <code class="nx">Mediator</code><code class="p">;</code>
  <code class="nx">Mediator</code><code class="p">.</code><code class="nx">Topic</code> <code class="o">=</code> <code class="nx">Topic</code><code class="p">;</code>
  <code class="nx">Mediator</code><code class="p">.</code><code class="nx">Subscriber</code> <code class="o">=</code> <code class="nx">Subscriber</code><code class="p">;</code>

<code class="c1">// Remember we can pass anything in here. I've passed in window to</code>
<code class="c1">// attach the Mediator to, but we can just as easily attach it to another</code>
<code class="c1">// object if desired.</code>
<code class="p">})(</code> <code class="nb">window</code> <code class="p">);</code>
</pre></div><div class="sect2" title="Example"><div class="titlepage"><div><div><h2 class="title"><a id="example"></a>Example</h2></div></div></div><p><a id="I_indexterm9_d1e3041" class="indexterm"></a>Using either of the implementations from above (both the
      simple option and the more advanced one), we can then put together a
      simple chat logging system as follows.</p><p>Here is the HTML code:</p><a id="I_programlisting9_d1e3049"></a><pre class="programlisting_javascript"> <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code><code class="nx">Chat</code><code class="o">&lt;</code><code class="err">/h1&gt;</code>
<code class="o">&lt;</code><code class="nx">form</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"chatForm"</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">label</code> <code class="k">for</code><code class="o">=</code><code class="s2">"fromBox"</code><code class="o">&gt;</code><code class="nx">Your</code> <code class="nx">Name</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>
    <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"fromBox"</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code><code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="nx">br</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="nx">label</code> <code class="k">for</code><code class="o">=</code><code class="s2">"toBox"</code><code class="o">&gt;</code><code class="nx">Send</code> <code class="nx">to</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>
    <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"toBox"</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code><code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="nx">br</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="nx">label</code> <code class="k">for</code><code class="o">=</code><code class="s2">"chatBox"</code><code class="o">&gt;</code><code class="nx">Message</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>
    <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"chatBox"</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code><code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="nx">button</code> <code class="nx">action</code><code class="o">=</code><code class="s2">"submit"</code><code class="o">&gt;</code><code class="nx">Chat</code><code class="o">&lt;</code><code class="err">/button&gt;</code>
<code class="o">&lt;</code><code class="err">/form&gt;</code>

<code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"chatResult"</code><code class="o">&gt;&lt;</code><code class="err">/div&gt;</code>
</pre><p>Here is the JavaScript code:</p><a id="I_programlisting9_d1e3053"></a><pre class="programlisting">$( "#chatForm" ).on( "submit", function(e) {
    e.preventDefault();

    // Collect the details of the chat from our UI
    var text = $( "#chatBox" ).val(),
        from = $( "#fromBox" ).val();
        to = $( "#toBox" ).val();

    // Publish data from the chat to the newMessage topic
    mediator.publish( "newMessage" , { message: text, from: from, to: to } );
});

// Append new messages as they come through
function displayChat( data ) {
    var date = new Date(),
        msg = data.from + " said \"" + data.message + "\" to " + data.to;

    $( "#chatResult" )
        .prepend("" + msg + " (" + date.toLocaleTimeString() + ")");
}

// Log messages
function logChat( data ) {
    if ( window.console ) {
        console.log( data );
    }
}



// Subscribe to new chat messages being submitted
// via the mediator
mediator.subscribe( "newMessage", displayChat );
mediator.subscribe( "newMessage", logChat );


// The following will however only work with the more advanced implementation:

function amITalkingToMyself( data ) {
    return data.from === data.to;
}

function iAmClearlyCrazy( data ) {
    $( "#chatResult" ).prepend("" + data.from + " is talking to himself.");
}

 mediator.Subscribe( amITalkingToMyself, iAmClearlyCrazy );</pre></div><div class="sect2" title="Advantages and Disadvantages"><div class="titlepage"><div><div><h2 class="title"><a id="advantages-disadvantages"></a>Advantages and Disadvantages</h2></div></div></div><p><a id="I_indexterm9_d1e3060" class="indexterm"></a>The largest benefit of the Mediator pattern is that it
      reduces the communication channels <a id="I_indexterm9_d1e3066" class="indexterm"></a>needed between objects or components in a system from many
      to many to just many to one. Adding new publishers and subscribers is
      relatively easy due to the level of decoupling present.</p><p>Perhaps the biggest downside of using the pattern is that it can
      introduce a single point of failure. Placing a Mediator between modules
      can cause a performance hit as they are always communicating indirectly.
      Because of the nature of loose coupling, it's difficult to establish how
      a system might react by only looking at the broadcasts.</p><p>That said, it's useful to remind ourselves that decoupled systems
      have a number of other benefits: if our modules communicated with each
      other directly, changes to modules (e.g., another module throwing an
      exception) could easily have a domino effect on the rest of our
      application. This problem is less of a concern with decoupled
      systems.</p><p>At the end of the day, tight coupling causes all kinds of
      headaches, and this is just another alternative solution, but one that
      can work very well if implemented correctly.</p></div><div class="sect2" title="Mediator Versus Observer"><div class="titlepage"><div><div><h2 class="title"><a id="mediator-vs.-observer"></a>Mediator Versus Observer</h2></div></div></div><p><a id="I_indexterm9_d1e3080" class="indexterm"></a><a id="I_indexterm9_d1e3087" class="indexterm"></a>Developers often wonder what the differences are between
      the Mediator pattern and the Observer pattern. Admittedly, there is a
      bit of overlap, but let's refer back to the GoF for an
      explanation:</p><div class="blockquote"><blockquote class="blockquote"><p>In the Observer pattern, there is no single object that
          encapsulates a constraint. Instead, the Observer and the Subject
          must cooperate to maintain the constraint. Communication patterns
          are determined by the way observers and subjects are interconnected:
          a single subject usually has many observers, and sometimes the
          observer of one subject is a subject of another observer.</p></blockquote></div><p>Both Mediators and Observers promote loose coupling;
      however, the Mediator pattern achieves this by having objects
      communicate strictly through the Mediator. The Observer pattern creates
      observable objects that publish events of interest to objects that are
      subscribed to them.</p></div><div class="sect2" title="Mediator Versus Facade"><div class="titlepage"><div><div><h2 class="title"><a id="mediator-vs.-facade"></a>Mediator Versus Facade</h2></div></div></div><p><a id="I_indexterm9_d1e3103" class="indexterm"></a><a id="I_indexterm9_d1e3110" class="indexterm"></a>We will be covering the Facade pattern shortly, but for
      reference purposes, some developers may also wonder whether there are
      similarities between the Mediator and Facade patterns. They do both
      abstract the functionality of existing modules, but there are some
      subtle differences.</p><p>The Mediator pattern centralizes communication between modules
      where it's explicitly referenced by these modules. In a sense, this is
      multidirectional. The Facade pattern, on the other hand, just defines a
      simpler interface to a module or system but doesn't add any additional
      functionality. Other modules in the system aren't directly aware of the
      concept of a facade and could be considered unidirectional.<a id="I_indexterm9_d1e3118" class="indexterm"></a></p></div><div class="footnotes"><br><hr><div class="footnote"><p><sup>[<a id="ftn.id685811" href="#id685811" class="para totri-footnote">2</a>] </sup><a class="ulink" href="http://en.wikipedia.org/wiki/Mediation">Wikipedia</a>; <a class="ulink" href="http://dictionary.reference.com/browse/mediator">Dictionary.com</a></p></div><div class="footnote"><p><sup>[<a id="ftn.thanks_jake" href="#thanks_jake" class="para totri-footnote">3</a>] </sup>Thanks to Jack for his excellent code comments which assisted
          with this section.</p></div></div></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Prototype Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-prototype-pattern"></a>The Prototype Pattern</h1></div></div></div><p><a id="I_indexterm9_d1e3123" class="indexterm"></a>The GoF refers to the Prototype pattern as one that creates
    objects based on a template of an existing object through cloning.</p><p>We can think of the Prototype pattern as being based on prototypal
    inheritance <a id="I_indexterm9_d1e3129" class="indexterm"></a>in which we create objects that act as prototypes for other
    objects. The <code class="literal">prototype</code> object itself is effectively
    used as a blueprint for each object the constructor creates. If the
    prototype of the constructor function used contains a property called
    <code class="literal">name</code> for example (as per the code
    sample that follows), then each object created by that same constructor
    will also have this same property (<a class="xref" href="ch09s07.html#prototype" title="Figure&nbsp;9-6.&nbsp;Prototype pattern">Figure&nbsp;9-6</a>).</p><div class="figure-float"><div class="figure"><a id="prototype"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e3148"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326888.png" alt="Prototype pattern" width="397" height="272" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326888.png"></div></div><p class="title">Figure&nbsp;9-6.&nbsp;Prototype pattern</p></div></div><p>Reviewing the definitions for this pattern in existing
    (non-JavaScript) literature, we <span class="emphasis"><em>may</em></span> find references
    to classes once again. The reality is that prototypal inheritance avoids
    using classes altogether. There isn't a "definition" object nor a core
    object in theory; we're simply creating copies of existing functional
    objects.</p><p>One of the benefits of using the Prototype pattern is that we're
    working with the prototypal strengths JavaScript has to offer natively
    rather than attempting to imitate features of other languages. With other
    design patterns, this isn't always the case.</p><p>Not only is the pattern an easy way to implement inheritance, but it
    can come with a performance boost as well: when defining functions in an
    object, they're all created by reference (so all child objects point to
    the same function), instead of creating their own individual
    copies.</p><p>For those interested, real prototypal inheritance, as defined in the
    ECMAScript 5 standard<a id="I_indexterm9_d1e3164" class="indexterm"></a>, requires the use of <code class="literal">Object.create</code> (which we previously looked at
    earlier in this section). To review, <code class="literal">Object.create</code> creates an object that has a
    specified prototype and optionally contains specified properties as well
    (e.g., <code class="literal">Object.create( prototype,
    optionalDescriptorObjects )</code>).</p><p>We can see this demonstrated in the following example:</p><a id="I_programlisting9_d1e3181"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">myCar</code> <code class="o">=</code> <code class="p">{</code>

  <code class="nx">name</code><code class="o">:</code> <code class="s2">"Ford Escort"</code><code class="p">,</code>

  <code class="nx">drive</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"Weeee. I'm driving!"</code> <code class="p">);</code>
  <code class="p">},</code>

  <code class="nx">panic</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"Wait. How do you stop this thing?"</code> <code class="p">);</code>
  <code class="p">}</code>

<code class="p">};</code>

<code class="c1">// Use Object.create to instantiate a new car</code>
<code class="kd">var</code> <code class="nx">yourCar</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">create</code><code class="p">(</code> <code class="nx">myCar</code> <code class="p">);</code>

<code class="c1">// Now we can see that one is a prototype of the other</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">yourCar</code><code class="p">.</code><code class="nx">name</code> <code class="p">);</code>
</pre><p><code class="literal">Object.create</code> also allows us to
    easily implement advanced concepts such as differential inheritance
    <a id="I_indexterm9_d1e3187" class="indexterm"></a>in which objects are able to directly inherit from other
    objects. We saw earlier that <code class="literal">Object.create</code> allows us to initialize object
    properties using the second supplied argument. For example:</p><a id="I_programlisting9_d1e3195"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">vehicle</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">getModel</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"The model of this vehicle is.."</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">model</code> <code class="p">);</code>
  <code class="p">}</code>
<code class="p">};</code>

<code class="kd">var</code> <code class="nx">car</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">create</code><code class="p">(</code><code class="nx">vehicle</code><code class="p">,</code> <code class="p">{</code>

  <code class="s2">"id"</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">value</code><code class="o">:</code> <code class="nx">MY_GLOBAL</code><code class="p">.</code><code class="nx">nextId</code><code class="p">(),</code>
    <code class="c1">// writable:false, configurable:false by default</code>
    <code class="nx">enumerable</code><code class="o">:</code> <code class="kc">true</code> 
  <code class="p">},</code>

  <code class="s2">"model"</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">value</code><code class="o">:</code> <code class="s2">"Ford"</code><code class="p">,</code>
    <code class="nx">enumerable</code><code class="o">:</code> <code class="kc">true</code>
  <code class="p">}</code>

<code class="p">});</code>
</pre><p>Here, the properties can be initialized on the second argument of
    <code class="literal">Object.create</code> using an object literal
    with a syntax similar to that used by the <code class="literal">Object.defineProperties</code> and <code class="literal">Object.defineProperty</code> methods that we looked at
    previously.</p><p>It is worth noting that prototypal relationships can cause trouble
    when enumerating properties <a id="I_indexterm9_d1e3210" class="indexterm"></a>of objects <a id="I_indexterm9_d1e3216" class="indexterm"></a>and (as Crockford recommends) wrapping the contents of the
    loop in a <code class="literal">hasOwnProperty()</code>
    check.</p><p>If we wish to implement the Prototype pattern without directly using
    <code class="literal">Object.create</code>, we can simulate the
    pattern as per the above example as follows:</p><a id="I_programlisting9_d1e3230"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">vehiclePrototype</code> <code class="o">=</code> <code class="p">{</code>

  <code class="nx">init</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">carModel</code> <code class="p">)</code> <code class="p">{</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">model</code> <code class="o">=</code> <code class="nx">carModel</code><code class="p">;</code>
  <code class="p">},</code>

  <code class="nx">getModel</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"The model of this vehicle is.."</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">};</code>


<code class="kd">function</code> <code class="nx">vehicle</code><code class="p">(</code> <code class="nx">model</code> <code class="p">)</code> <code class="p">{</code>

  <code class="kd">function</code> <code class="nx">F</code><code class="p">()</code> <code class="p">{};</code>
  <code class="nx">F</code><code class="p">.</code><code class="nx">prototype</code> <code class="o">=</code> <code class="nx">vehiclePrototype</code><code class="p">;</code>

  <code class="kd">var</code> <code class="nx">f</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">F</code><code class="p">();</code>

  <code class="nx">f</code><code class="p">.</code><code class="nx">init</code><code class="p">(</code> <code class="nx">model</code> <code class="p">);</code>
  <code class="k">return</code> <code class="nx">f</code><code class="p">;</code>

<code class="p">}</code>

<code class="kd">var</code> <code class="nx">car</code> <code class="o">=</code> <code class="nx">vehicle</code><code class="p">(</code> <code class="s2">"Ford Escort"</code> <code class="p">);</code>
<code class="nx">car</code><code class="p">.</code><code class="nx">getModel</code><code class="p">();</code>
</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>This alternative does not allow the user to define read-only
        properties in the same manner (as the
        <code class="literal">vehiclePrototype</code> may be altered if not careful).</p></div><p>A final alternative implementation of the Prototype pattern could be
    the following:</p><a id="I_programlisting9_d1e3244"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">beget</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

    <code class="kd">function</code> <code class="nx">F</code><code class="p">()</code> <code class="p">{}</code>

    <code class="k">return</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">proto</code> <code class="p">)</code> <code class="p">{</code>
        <code class="nx">F</code><code class="p">.</code><code class="nx">prototype</code> <code class="o">=</code> <code class="nx">proto</code><code class="p">;</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nx">F</code><code class="p">();</code>
    <code class="p">};</code>
<code class="p">})();</code>
</pre><p>One could reference this method from the <code class="literal">vehicle</code> function. Note, however that <code class="literal">vehicle</code> here is emulating a constructor, since
    the Prototype pattern does not include any notion of initialization beyond
    linking an object to a prototype.</p></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Facade Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-facade-pattern"></a>The Facade Pattern</h1></div></div></div><p><a id="I_indexterm9_d1e3355" class="indexterm"></a>When we put up a facade, we present an outward appearance to
    the world that may conceal a very different reality. This was the
    inspiration for the name behind the next pattern we're going to review:
    the Facade pattern. This pattern provides a convenient higher-level
    interface to a larger body of code, hiding its true underlying complexity.
    Think of it as simplifying the API being presented to other developers,
    something that almost always improves usability (<a class="xref" href="ch09s09.html#facade" title="Figure&nbsp;9-8.&nbsp;Facade pattern">Figure&nbsp;9-8</a>).</p><div class="figure-float"><div class="figure"><a id="facade"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e3366"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326914.png" alt="Facade pattern" width="478" height="411" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326914.png"></div></div><p class="title">Figure&nbsp;9-8.&nbsp;Facade pattern</p></div></div><p>Facades are a structural pattern that can often be seen in
    JavaScript libraries such as jQuery where, although an implementation may
    support methods with a wide range of behaviors, only a "facade," or
    limited abstraction of these methods, is presented to the public for
    use.</p><p>This allows us to interact with the Facade directly rather than the
    subsystem behind the scenes. Whenever we use jQuery's <code class="literal">$(el).css()</code> or <code class="literal">$(el).animate()</code> methods, we're actually using a
    Facade: the simpler public interface that lets us avoid having to manually
    call the many internal methods in jQuery<a id="I_indexterm9_d1e3381" class="indexterm"></a> core required to get some behavior working. This also
    circumvents the need to manually interact with DOM APIs and maintain state
    variables.</p><p>The jQuery core methods should be considered intermediate
    abstractions. The more immediate burden to developers is the DOM API, and
    facades are what make the jQuery library so easy to use.</p><p>To build on what we've learned, the Facade pattern both simplifies
    the interface of a class and decouples the class from the code that uses
    it. This gives us the ability to indirectly interact with subsystems in a
    way that can sometimes be less prone to error than accessing the subsystem
    directly. A Facade's advantages include ease of use and often a
    small-sized footprint in implementing the pattern.</p><p>Let's take a look at the pattern in action. This is an unoptimized
    code example, but here we're using a Facade to simplify an interface for
    listening to events across browsers.<a id="I_indexterm9_d1e3393" class="indexterm"></a> We do this by creating a common method that can be used in
    one's code which does the task of checking for the existence of features
    so that it can provide a safe and cross-browser compatible
    solution.</p><a id="I_programlisting9_d1e3399"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">addMyEvent</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">el</code><code class="p">,</code><code class="nx">ev</code><code class="p">,</code><code class="nx">fn</code> <code class="p">){</code>

   <code class="k">if</code><code class="p">(</code> <code class="nx">el</code><code class="p">.</code><code class="nx">addEventListener</code> <code class="p">){</code>
            <code class="nx">el</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code> <code class="nx">ev</code><code class="p">,</code><code class="nx">fn</code><code class="p">,</code> <code class="kc">false</code> <code class="p">);</code>
      <code class="p">}</code><code class="k">else</code> <code class="k">if</code><code class="p">(</code><code class="nx">el</code><code class="p">.</code><code class="nx">attachEvent</code><code class="p">){</code>
            <code class="nx">el</code><code class="p">.</code><code class="nx">attachEvent</code><code class="p">(</code> <code class="s2">"on"</code> <code class="o">+</code> <code class="nx">ev</code><code class="p">,</code> <code class="nx">fn</code> <code class="p">);</code>
      <code class="p">}</code> <code class="k">else</code><code class="p">{</code>
           <code class="nx">el</code><code class="p">[</code><code class="s2">"on"</code> <code class="o">+</code> <code class="nx">ev</code><code class="p">]</code> <code class="o">=</code> <code class="nx">fn</code><code class="p">;</code>
    <code class="p">}</code>

<code class="p">};</code>
</pre><p>In a similar manner, we're all familiar with jQuery's <code class="literal">$(document).ready(..)</code>. Internally, this is
    actually powered by a method called <code class="literal">bindReady()</code>, which is doing this:</p><a id="I_programlisting9_d1e3409"></a><pre class="programlisting_javascript"><code class="nx">bindReady</code><code class="o">:</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
    <code class="p">...</code>
    <code class="k">if</code> <code class="p">(</code> <code class="nb">document</code><code class="p">.</code><code class="nx">addEventListener</code> <code class="p">)</code> <code class="p">{</code>
      <code class="c1">// Use the handy event callback</code>
      <code class="nb">document</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code> <code class="s2">"DOMContentLoaded"</code><code class="p">,</code> <code class="nx">DOMContentLoaded</code><code class="p">,</code> <code class="kc">false</code> <code class="p">);</code>

      <code class="c1">// A fallback to window.onload, that will always work</code>
      <code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code> <code class="s2">"load"</code><code class="p">,</code> <code class="nx">jQuery</code><code class="p">.</code><code class="nx">ready</code><code class="p">,</code> <code class="kc">false</code> <code class="p">);</code>

    <code class="c1">// If IE event model is used</code>
    <code class="p">}</code> <code class="k">else</code> <code class="k">if</code> <code class="p">(</code> <code class="nb">document</code><code class="p">.</code><code class="nx">attachEvent</code> <code class="p">)</code> <code class="p">{</code>

      <code class="nb">document</code><code class="p">.</code><code class="nx">attachEvent</code><code class="p">(</code> <code class="s2">"onreadystatechange"</code><code class="p">,</code> <code class="nx">DOMContentLoaded</code> <code class="p">);</code>

      <code class="c1">// A fallback to window.onload, that will always work</code>
      <code class="nb">window</code><code class="p">.</code><code class="nx">attachEvent</code><code class="p">(</code> <code class="s2">"onload"</code><code class="p">,</code> <code class="nx">jQuery</code><code class="p">.</code><code class="nx">ready</code> <code class="p">);</code>
               <code class="p">...</code>
</pre><p>This is another example of a Facade, in which the rest of the world
    simply uses the limited interface exposed by <code class="literal">$(document).ready(..)</code> and the more complex
    implementation powering it is kept hidden from sight.</p><p>Facades don't just have to be used on their own, however. They can
    also be integrated with other patterns, such as the Module pattern. As we
    can see below, our instance of the Module pattern contains a number of
    methods that have been privately defined. A Facade is then used to supply
    a much simpler API to accessing these methods:</p><a id="I_programlisting9_d1e3419"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">module</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code><code class="p">()</code> <code class="p">{</code>

    <code class="kd">var</code> <code class="nx">_private</code> <code class="o">=</code> <code class="p">{</code>
        <code class="nx">i</code><code class="o">:</code><code class="mi">5</code><code class="p">,</code>
        <code class="nx">get</code> <code class="o">:</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"current value:"</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">i</code><code class="p">);</code>
        <code class="p">},</code>
        <code class="nx">set</code> <code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">val</code> <code class="p">)</code> <code class="p">{</code>
            <code class="k">this</code><code class="p">.</code><code class="nx">i</code> <code class="o">=</code> <code class="nx">val</code><code class="p">;</code>
        <code class="p">},</code>
        <code class="nx">run</code> <code class="o">:</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"running"</code> <code class="p">);</code>
        <code class="p">},</code>
        <code class="nx">jump</code><code class="o">:</code> <code class="kd">function</code><code class="p">(){</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="s2">"jumping"</code> <code class="p">);</code>
        <code class="p">}</code>
    <code class="p">};</code>

    <code class="k">return</code> <code class="p">{</code>

        <code class="nx">facade</code> <code class="o">:</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">args</code> <code class="p">)</code> <code class="p">{</code>
            <code class="nx">_private</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">args</code><code class="p">.</code><code class="nx">val</code><code class="p">);</code>
            <code class="nx">_private</code><code class="p">.</code><code class="nx">get</code><code class="p">();</code>
            <code class="k">if</code> <code class="p">(</code> <code class="nx">args</code><code class="p">.</code><code class="nx">run</code> <code class="p">)</code> <code class="p">{</code>
                <code class="nx">_private</code><code class="p">.</code><code class="nx">run</code><code class="p">();</code>
            <code class="p">}</code>
        <code class="p">}</code>
    <code class="p">};</code>
<code class="p">}());</code>
 
 
<code class="c1">// Outputs: "running", 10</code>
<code class="nx">module</code><code class="p">.</code><code class="nx">facade</code><code class="p">(</code> <code class="p">{</code><code class="nx">run</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code> <code class="nx">val</code><code class="o">:</code><code class="mi">10</code><code class="p">}</code> <code class="p">);</code>
</pre><p>In this example, calling <code class="literal">module.facade()</code> will actually trigger a set of
    private behavior within the module, but again, the users aren't concerned
    with this. We've made it much easier for them to consume a feature without
    needing to worry about implementation-level details.</p><div class="sect2" title="Notes on Abstraction"><div class="titlepage"><div><div><h2 class="title"><a id="notes-on-abstraction"></a>Notes on Abstraction</h2></div></div></div><p><a id="I_indexterm9_d1e3430" class="indexterm"></a>Facades generally have few disadvantages, but one concern
      worth noting is performance. Namely, one must determine whether there is
      an implicit cost to the abstraction a Facade offers to our
      implementation and, if so, whether this cost is justifiable. Going back
      to the jQuery library, most of us are aware that both<a id="I_indexterm9_d1e3434" class="indexterm"></a> <code class="literal">getElementById("identifier")</code> and <code class="literal">$("#identifier")</code> <a id="I_indexterm9_d1e3444" class="indexterm"></a><a id="I_indexterm9_d1e3447" class="indexterm"></a>can be used to query an element on a page by its
      ID.</p><p>Did you know however that <code class="literal">getElementById()</code> on its own is significantly
      faster by a high order of magnitude? Take a look at this jsPerf test to
      see results on a per-browser level: <a class="ulink" href="http://jsperf.com/getelementbyid-vs-jquery-id">http://jsperf.com/getelementbyid-vs-jquery-id</a>. Now of
      course, we have to keep in mind that jQuery (and Sizzle, its selector
      engine) are doing a lot more behind the scenes to optimize our query
      (and that a jQuery object, not just a DOM node is returned).</p><p>The challenge with this particular Facade is that in order to
      provide an elegant selector function capable of accepting and parsing
      multiple types of queries, there is an implicit cost of abstraction. The
      user isn't required to access <code class="literal">jQuery.getById("identifier")</code> or <code class="literal">jQuery.getbyClass("identifier")</code> and so on.
      That said, the trade-off in performance has been tested in practice over
      the years and, given the success of jQuery, a simple Facade actually
      worked out very well for the team.</p><p>When using the Facade pattern, try to be aware of any performance
      costs involved and make a call on whether they are worth the level of
      abstraction offered.</p></div></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="The Factory Pattern"><div class="titlepage"><div><div><h1 class="title"><a id="the-factory-pattern"></a>The Factory Pattern</h1></div></div></div><p><a id="index-507G534TE3T" class="indexterm"></a>The Factory pattern is another creational pattern concerned
    with the notion of creating objects. Where it differs from the other
    patterns in its category is that it doesn't explicitly require the use of
    a constructor. Instead, a Factory can provide a generic interface for
    creating objects, where we can specify the type of factory object we wish
    to be created (<a class="xref" href="ch09s10.html#factory" title="Figure&nbsp;9-9.&nbsp;Factory pattern">Figure&nbsp;9-9</a>).</p><div class="figure-float"><div class="figure"><a id="factory"></a><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e3483"></a><img src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326896.png" alt="Factory pattern" width="360" height="255" data-mfp-src="/library/view/learning-javascript-design/9781449334840/httpatomoreillycomsourceoreillyimages1326896.png"></div></div><p class="title">Figure&nbsp;9-9.&nbsp;Factory pattern</p></div></div><p>Imagine that we have a UI factory where we are asked to create a
    type of UI component. Rather than creating this component directly using
    the <code class="literal">new</code> operator or via another
    creational constructor, we ask a Factory object for a new component
    instead. We inform the Factory what
    type of object is required (e.g., "Button", "Panel") and it instantiates
    this, returning it to us for use.</p><p>This is particularly useful if the object creation process is
    relatively complexâ€”e.g., if it strongly depends on dynamic factors or
    application configuration.</p><p>Examples of this pattern can be found in UI libraries such as ExtJS,
    where the methods for creating objects or components may be further
    subclassed.</p><p>The following is an example that builds upon our previous snippets
    using the Constructor pattern logic to define cars. It demonstrates how a
    <code class="literal">vehicle</code> factory may be implemented using the Factory
    pattern:</p><a id="I_programlisting9_d1e3505"></a><pre class="programlisting_javascript"><code class="c1">// Types.js - Constructors used behind the scenes</code>

<code class="c1">// A constructor for defining new cars</code>
<code class="kd">function</code> <code class="nx">Car</code><code class="p">(</code> <code class="nx">options</code> <code class="p">)</code> <code class="p">{</code>

  <code class="c1">// some defaults</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">doors</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">doors</code> <code class="o">||</code> <code class="mi">4</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">state</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">state</code> <code class="o">||</code> <code class="s2">"brand new"</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">color</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">color</code> <code class="o">||</code> <code class="s2">"silver"</code><code class="p">;</code>

<code class="p">}</code>

<code class="c1">// A constructor for defining new trucks</code>
<code class="kd">function</code> <code class="nx">Truck</code><code class="p">(</code> <code class="nx">options</code><code class="p">){</code>

  <code class="k">this</code><code class="p">.</code><code class="nx">state</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">state</code> <code class="o">||</code> <code class="s2">"used"</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">wheelSize</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">wheelSize</code> <code class="o">||</code> <code class="s2">"large"</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">color</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">color</code> <code class="o">||</code> <code class="s2">"blue"</code><code class="p">;</code>
<code class="p">}</code>


<code class="c1">// FactoryExample.js</code>

<code class="c1">// Define a skeleton vehicle factory</code>
<code class="kd">function</code> <code class="nx">VehicleFactory</code><code class="p">()</code> <code class="p">{}</code>

<code class="c1">// Define the prototypes and utilities for this factory</code>

<code class="c1">// Our default vehicleClass is Car</code>
<code class="nx">VehicleFactory</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">vehicleClass</code> <code class="o">=</code> <code class="nx">Car</code><code class="p">;</code>

<code class="c1">// Our Factory method for creating new Vehicle instances</code>
<code class="nx">VehicleFactory</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">createVehicle</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">options</code> <code class="p">)</code> <code class="p">{</code>

  <code class="k">if</code><code class="p">(</code> <code class="nx">options</code><code class="p">.</code><code class="nx">vehicleType</code> <code class="o">===</code> <code class="s2">"car"</code> <code class="p">){</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">vehicleClass</code> <code class="o">=</code> <code class="nx">Car</code><code class="p">;</code>
  <code class="p">}</code><code class="k">else</code><code class="p">{</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">vehicleClass</code> <code class="o">=</code> <code class="nx">Truck</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="k">return</code> <code class="k">new</code> <code class="k">this</code><code class="p">.</code><code class="nx">vehicleClass</code><code class="p">(</code> <code class="nx">options</code> <code class="p">);</code>

<code class="p">};</code>

<code class="c1">// Create an instance of our factory that makes cars</code>
<code class="kd">var</code> <code class="nx">carFactory</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">VehicleFactory</code><code class="p">();</code>
<code class="kd">var</code> <code class="nx">car</code> <code class="o">=</code> <code class="nx">carFactory</code><code class="p">.</code><code class="nx">createVehicle</code><code class="p">(</code> <code class="p">{</code> 
            <code class="nx">vehicleType</code><code class="o">:</code> <code class="s2">"car"</code><code class="p">,</code> 
            <code class="nx">color</code><code class="o">:</code> <code class="s2">"yellow"</code><code class="p">,</code> 
            <code class="nx">doors</code><code class="o">:</code> <code class="mi">6</code> <code class="p">}</code> <code class="p">);</code>

<code class="c1">// Test to confirm our car was created using the vehicleClass/prototype Car</code>

<code class="c1">// Outputs: true</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">car</code> <code class="k">instanceof</code> <code class="nx">Car</code> <code class="p">);</code> 

<code class="c1">// Outputs: Car object of color "yellow", doors: 6 in a "brand new" state</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">car</code> <code class="p">);</code>
</pre><p>In Approach 1, we modify a <code class="literal">VehicleFactory</code>
    instance to use the <code class="literal">Truck</code> class:</p><a id="I_programlisting9_d1e3515"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">movingTruck</code> <code class="o">=</code> <code class="nx">carFactory</code><code class="p">.</code><code class="nx">createVehicle</code><code class="p">(</code> <code class="p">{</code> 
                      <code class="nx">vehicleType</code><code class="o">:</code> <code class="s2">"truck"</code><code class="p">,</code> 
                      <code class="nx">state</code><code class="o">:</code> <code class="s2">"like new"</code><code class="p">,</code> 
                      <code class="nx">color</code><code class="o">:</code> <code class="s2">"red"</code><code class="p">,</code> 
                      <code class="nx">wheelSize</code><code class="o">:</code> <code class="s2">"small"</code> <code class="p">}</code> <code class="p">);</code>

<code class="c1">// Test to confirm our truck was created with the vehicleClass/prototype Truck</code>

<code class="c1">// Outputs: true</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">movingTruck</code> <code class="k">instanceof</code> <code class="nx">Truck</code> <code class="p">);</code>

<code class="c1">// Outputs: Truck object of color "red", a "like new" state </code>
<code class="c1">// and a "small" wheelSize</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">movingTruck</code> <code class="p">);</code>
</pre><p>In Approach 2, we subclass <code class="literal">VehicleFactory</code> to
    create a factory class that builds <code class="literal">Trucks</code>:</p><a id="I_programlisting9_d1e3526"></a><pre class="programlisting_javascript"><code class="kd">function</code> <code class="nx">TruckFactory</code> <code class="p">()</code> <code class="p">{}</code>
<code class="nx">TruckFactory</code><code class="p">.</code><code class="nx">prototype</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">VehicleFactory</code><code class="p">();</code>
<code class="nx">TruckFactory</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">vehicleClass</code> <code class="o">=</code> <code class="nx">Truck</code><code class="p">;</code>

<code class="kd">var</code> <code class="nx">truckFactory</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">TruckFactory</code><code class="p">();</code>
<code class="kd">var</code> <code class="nx">myBigTruck</code> <code class="o">=</code> <code class="nx">truckFactory</code><code class="p">.</code><code class="nx">createVehicle</code><code class="p">(</code> <code class="p">{</code> 
                    <code class="nx">state</code><code class="o">:</code> <code class="s2">"omg..so bad."</code><code class="p">,</code> 
                    <code class="nx">color</code><code class="o">:</code> <code class="s2">"pink"</code><code class="p">,</code> 
                    <code class="nx">wheelSize</code><code class="o">:</code> <code class="s2">"so big"</code> <code class="p">}</code> <code class="p">);</code>

<code class="c1">// Confirms that myBigTruck was created with the prototype Truck</code>
<code class="c1">// Outputs: true</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myBigTruck</code> <code class="k">instanceof</code> <code class="nx">Truck</code> <code class="p">);</code>

<code class="c1">// Outputs: Truck object with the color "pink", wheelSize "so big" </code>
<code class="c1">// and state "omg. so bad"</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">myBigTruck</code> <code class="p">);</code>
</pre><div class="sect2" title="When to Use the Factory Pattern"><div class="titlepage"><div><div><h2 class="title"><a id="when-to-use-the-factory-pattern"></a>When to Use the Factory Pattern</h2></div></div></div><p><a id="I_indexterm9_d1e3532" class="indexterm"></a>The Factory pattern can be especially useful when applied
      to the following situations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>When our object or component setup involves a high level of
          complexity.</p></li><li class="listitem"><p>When we need to easily generate different instances of objects
          depending on the environment we are in.</p></li><li class="listitem"><p>When we're working with many small objects or components that
          share the same properties.</p></li><li class="listitem"><p>When composing objects with instances of other objects that
          need only satisfy an API contract (a.k.a., duck typing) to work.
          This is useful for decoupling.</p></li></ul></div></div><div class="sect2" title="When Not to Use the Factory Pattern"><div class="titlepage"><div><div><h2 class="title"><a id="when-not-to-use-the-factory-pattern"></a>When Not to Use the Factory Pattern</h2></div></div></div><p><a id="I_indexterm9_d1e3555" class="indexterm"></a>When applied to the wrong type of problem, this pattern
      can introduce an unnecessarily great deal of complexity to an
      application. Unless providing an interface for object creation is a
      design goal for the library or framework we are writing, I would suggest
      sticking to explicit constructors to avoid the unnecessary
      overhead.</p><p>Due to the fact that the process of object creation is effectively
      abstracted behind an interface, this can also introduce problems with
      unit testing depending on just how complex this process might be.</p></div><div class="sect2" title="Abstract Factories"><div class="titlepage"><div><div><h2 class="title"><a id="abstract-factories"></a>Abstract Factories</h2></div></div></div><p><a id="I_indexterm9_d1e3567" class="indexterm"></a><a id="I_indexterm9_d1e3572" class="indexterm"></a>It is also useful to be aware of the Abstract Factory
      pattern, which aims to encapsulate a group of individual factories with
      a common goal. It separates the details of implementation of a set of
      objects from their general usage.</p><p>An Abstract Factory pattern should be used where a system must be
      independent from the way the objects it creates are generated or it
      needs to work with multiple types of objects.</p><p>An example that is both simple and easier to understand is a
      vehicle factory, which defines ways to get or register vehicles types.
      The abstract factory can be named
      <code class="literal">AbstractVehicleFactory</code>. The abstract factory will
      allow the definition of types of vehicle like <code class="literal">car</code> or
      <code class="literal">truck</code>, and concrete factories will implement only
      classes that fulfill the vehicle contract (e.g., <code class="literal">Vehicle.prototype.drive</code> and <code class="literal">Vehicle.prototype.breakDown</code>).<a id="I_indexterm9_d1e3596" class="indexterm"></a></p><a id="I_programlisting9_d1e3597"></a><pre class="programlisting_javascript">  <code class="kd">var</code> <code class="nx">AbstractVehicleFactory</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

    <code class="c1">// Storage for our vehicle types</code>
    <code class="kd">var</code> <code class="nx">types</code> <code class="o">=</code> <code class="p">{};</code>

    <code class="k">return</code> <code class="p">{</code>
        <code class="nx">getVehicle</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">type</code><code class="p">,</code> <code class="nx">customizations</code> <code class="p">)</code> <code class="p">{</code>
            <code class="kd">var</code> <code class="nx">Vehicle</code> <code class="o">=</code> <code class="nx">types</code><code class="p">[</code><code class="nx">type</code><code class="p">];</code>

            <code class="k">return</code> <code class="p">(</code><code class="nx">Vehicle</code><code class="p">)</code> <code class="o">?</code> <code class="k">return</code> <code class="k">new</code> <code class="nx">Vehicle</code><code class="p">(</code><code class="nx">customizations</code><code class="p">)</code> <code class="o">:</code> <code class="kc">null</code><code class="p">;</code>
        <code class="p">},</code>

        <code class="nx">registerVehicle</code><code class="o">:</code> <code class="kd">function</code> <code class="p">(</code> <code class="nx">type</code><code class="p">,</code> <code class="nx">Vehicle</code> <code class="p">)</code> <code class="p">{</code>
            <code class="kd">var</code> <code class="nx">proto</code> <code class="o">=</code> <code class="nx">Vehicle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">;</code>

            <code class="c1">// only register classes that fulfill the vehicle contract</code>
            <code class="k">if</code> <code class="p">(</code> <code class="nx">proto</code><code class="p">.</code><code class="nx">drive</code> <code class="o">&amp;&amp;</code> <code class="nx">proto</code><code class="p">.</code><code class="nx">breakDown</code> <code class="p">)</code> <code class="p">{</code>
                <code class="nx">types</code><code class="p">[</code><code class="nx">type</code><code class="p">]</code> <code class="o">=</code> <code class="nx">Vehicle</code><code class="p">;</code>
            <code class="p">}</code>

            <code class="k">return</code> <code class="nx">AbstractVehicleFactory</code><code class="p">;</code>
        <code class="p">}</code>
    <code class="p">};</code>
<code class="p">})();</code>


<code class="c1">// Usage: </code>

<code class="nx">AbstractVehicleFactory</code><code class="p">.</code><code class="nx">registerVehicle</code><code class="p">(</code> <code class="s2">"car"</code><code class="p">,</code> <code class="nx">Car</code> <code class="p">);</code>
<code class="nx">AbstractVehicleFactory</code><code class="p">.</code><code class="nx">registerVehicle</code><code class="p">(</code> <code class="s2">"truck"</code><code class="p">,</code> <code class="nx">Truck</code> <code class="p">);</code>

<code class="c1">// Instantiate a new car based on the abstract vehicle type</code>
<code class="kd">var</code> <code class="nx">car</code> <code class="o">=</code> <code class="nx">AbstractVehicleFactory</code><code class="p">.</code><code class="nx">getVehicle</code><code class="p">(</code> <code class="s2">"car"</code> <code class="p">,</code> <code class="p">{</code> 
            <code class="nx">color</code><code class="o">:</code> <code class="s2">"lime green"</code><code class="p">,</code> 
            <code class="nx">state</code><code class="o">:</code> <code class="s2">"like new"</code> <code class="p">}</code> <code class="p">);</code>

<code class="c1">// Instantiate a new truck in a similar manner</code>
<code class="kd">var</code> <code class="nx">truck</code> <code class="o">=</code> <code class="nx">AbstractVehicleFactory</code><code class="p">.</code><code class="nx">getVehicle</code><code class="p">(</code> <code class="s2">"truck"</code> <code class="p">,</code> <code class="p">{</code> 
            <code class="nx">wheelSize</code><code class="o">:</code> <code class="s2">"medium"</code><code class="p">,</code> 
            <code class="nx">color</code><code class="o">:</code> <code class="s2">"neon yellow"</code> <code class="p">}</code> <code class="p">);</code>
</pre></div></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
<div class="sect1" title="Subclassing"><div class="titlepage"><div><div><h1 class="title"><a id="sub-classing"></a>Subclassing</h1></div></div></div><p><a id="I_indexterm9_d1e3611" class="indexterm"></a><a id="I_indexterm9_d1e3616" class="indexterm"></a><a id="I_indexterm9_d1e3619" class="indexterm"></a>For developers unfamiliar with subclassing, we will go
    through a brief beginners' primer before diving into Mixins and Decorators
    further.</p><p><span class="emphasis"><em>Subclassing</em></span> is a term that refers to inheriting
    properties for a new object from a base or <span class="emphasis"><em>superclass</em></span>
    object. In traditional object-oriented programming, a class <code class="literal">B</code> is able to extend another class <code class="literal">A</code>. Here we consider <code class="literal">A</code> a superclass and <code class="literal">B</code> a subclass of <code class="literal">A</code>. As such, all instances of <code class="literal">B</code> inherit the methods from <code class="literal">A</code>. <code class="literal">B</code> is
    however still able to define its own methods, including those that
    override methods originally defined by <code class="literal">A</code>.</p><p>Should <code class="literal">B</code> need to invoke a method
    in <code class="literal">A</code> that has been overridden, we refer
    to this as method chaining. Should <code class="literal">B</code>
    need to invoke the constructor <code class="literal">A</code> (the
    superclass), we call this constructor chaining.</p><p>To demonstrate subclassing, we first need a base object that can
    have new instances of itself created. Let's model this around the concept
    of a person.</p><a id="I_programlisting9_d1e3678"></a><pre class="programlisting_javascript"><code class="kd">var</code> <code class="nx">Person</code> <code class="o">=</code>  <code class="kd">function</code><code class="p">(</code> <code class="nx">firstName</code> <code class="p">,</code> <code class="nx">lastName</code> <code class="p">){</code>

  <code class="k">this</code><code class="p">.</code><code class="nx">firstName</code> <code class="o">=</code> <code class="nx">firstName</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">lastName</code> <code class="o">=</code>  <code class="nx">lastName</code><code class="p">;</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">gender</code> <code class="o">=</code> <code class="s2">"male"</code><code class="p">;</code>

<code class="p">};</code>
</pre><p>Next, we'll want to specify a new class (object) that's a subclass
    of the existing <code class="literal">Person</code> object. Let us
    imagine we want to add distinct properties to distinguish a <code class="literal">Person</code> from a <code class="literal">Superhero</code> while inheriting the properties of the
    <code class="literal">Person</code> superclass. As superheroes share
    many common traits with normal people (e.g. name, gender), this should
    hopefully illustrate how subclassing works adequately.</p><a id="I_programlisting9_d1e3694"></a><pre class="programlisting_javascript"><code class="c1">// a new instance of Person can then easily be created as follows:</code>
<code class="kd">var</code> <code class="nx">clark</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Person</code><code class="p">(</code> <code class="s2">"Clark"</code> <code class="p">,</code> <code class="s2">"Kent"</code> <code class="p">);</code>
       
<code class="c1">// Define a subclass constructor for for "Superhero":</code>
<code class="kd">var</code> <code class="nx">Superhero</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code> <code class="nx">firstName</code><code class="p">,</code> <code class="nx">lastName</code> <code class="p">,</code> <code class="nx">powers</code> <code class="p">){</code>
    
    <code class="c1">// Invoke the superclass constructor on the new object</code>
    <code class="c1">// then use .call() to invoke the constructor as a method of</code>
    <code class="c1">// the object to be initialized.</code>
    
    <code class="nx">Person</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code> <code class="k">this</code><code class="p">,</code> <code class="nx">firstName</code><code class="p">,</code> <code class="nx">lastName</code> <code class="p">);</code>

    <code class="c1">// Finally, store their powers, a new array of traits not found in a normal "Person"</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">powers</code> <code class="o">=</code> <code class="nx">powers</code><code class="p">;</code>
<code class="p">};</code>

<code class="nx">SuperHero</code><code class="p">.</code><code class="nx">prototype</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">create</code><code class="p">(</code> <code class="nx">Person</code><code class="p">.</code><code class="nx">prototype</code> <code class="p">);</code>
<code class="kd">var</code> <code class="nx">superman</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Superhero</code><code class="p">(</code> <code class="s2">"Clark"</code> <code class="p">,</code><code class="s2">"Kent"</code> <code class="p">,</code> <code class="p">[</code><code class="s2">"flight"</code><code class="p">,</code><code class="s2">"heat-vision"</code><code class="p">]</code> <code class="p">);</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code> <code class="nx">superman</code> <code class="p">);</code> 

<code class="c1">// Outputs Person attributes as well as powers</code>
</pre><p>The <code class="literal">Superhero</code> constructor creates
    an object that descends from <code class="literal">Person</code>.
    Objects of this type have attributes of the objects that are above them in
    the chain, and if we had set default values in the <code class="literal">Person</code> object, <code class="literal">Superhero</code> is capable of overriding any inherited
    values with values specific to its object.</p></div>
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		</div>
		<!--=========================
			END : POST
		=============================-->
	
</body>
</html>