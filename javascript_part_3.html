<html><head>
		<meta charset="utf-8">
		<title>Javascript Book :: Part 3</title>
		<meta name="title" content="">
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!--<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
		<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i|PT+Serif:400,700" rel="stylesheet">-->
		<style>
* { box-sizing: border-box; }
body { 
	font-family: 'Open Sans', Arial, sans-serif;
	font-size: 14px;
	line-height: 1.7;
	padding: 0.5em;
	font-family: 'PT Sans', Arial, sans-serif;
	
}
em, strong { font-weight: bold; }
h1 { font-size: 1.6em; font-family: 'PT Serif', Arial, serif; padding: 10px 0; margin: 0; }
h2, h3, h6 { 
	font-size: 1.3em;
	font-family: 'PT Serif', Arial, serif;
	padding-left: 1em;
	border-left: 2px solid #868686; 
}
img { display: block; margin: 0 auto; max-width: 100%; }
pre { 
	border: 1px dashed #333; 
	padding: 1em 2em; 
	font-family: Consolas,monospace; 
	background-color: #EEE; 
	overflow-x: scroll; 
	font-size: 14px;  
	white-space: pre-wrap; 
	word-wrap: break-word; 
}
pre {
-moz-box-sizing: border-box;
    box-sizing: border-box;
    margin: 1em auto;
    border: 1px dashed #333;
    width: 100%;
    padding: 1em 1.5em;
    font-family: Inconsolata, Consolas, monospace, sans-serif;
    font-size: 1em;
	line-height: 1.5;
    overflow: auto;
    background: #F7FAFB;
    border-radius: 3px;
	position:relative;
}
code { 
	background-color: #EEE;
    font-family: Consolas,monospace;
    border: solid 1px #CCC;
    padding: 0 8px;
    border-radius: 3px;
    display: inline-block;
    font-size: 14px;
}
pre code { background-color: transparent; padding: 0; display: block; border: 0px solid; }
pre:after {
	content: "<CODE>";
	position: absolute;
	top:0;
	right: 0;
	padding: 5px 15px;
	background: #999;
	color: #FFF;
}

.home-screen { border: 1px solid #777; padding: 4em 0; margin: 2em 0; }
.home-screen * { font-family: 'PT Sans', Arial, sans-serif; font-size: 3em; font-weight: normal; }

/* = Index
-------------------------------*/
.tutorial-index {
	counter-reset: section;
}
.tutorial-index h1:before {
    /*counter-increment: section;
    content: counter(section) " : ";*/
}
.tutorial-index h1 {font-size: 1.2em; padding: 5px 0; font-family: 'Open Sans', Arial, sans-serif; line-height: normal;}
.tutorial-index a { display: block; float: left; width: 50%;}
.tutorial-index a { text-decoration: none; }


/* = Main
-------------------------------*/
.main { counter-reset: mainsection; }
.main h1 { font-size: 1.6em; border-bottom: 2px solid #000; font-family: 'PT Serif', Arial, serif; padding: 10px 0; margin: 0; }
.main h1:before {
    /*counter-increment: mainsection;
    content: counter(mainsection) " : ";
	*/
}

/* = ClearFix
-------------------------------*/
.cf:before,
.cf:after {
    content: " ";
    display: table;
}
.cf:after {
    clear: both;
}
.tc { text-align: center}

/* = TABLE
-------------------------------*/
table { width: 100%; max-width: 100%; margin: 1em 0; border-collapse: collapse;}
table td, table th { border: 1px solid #cdcfd0; padding: 10px;}
table th { border-bottom-width: 2px; background-color: #e8e9ea; }
table tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}
@media print {
    .main article h1 { 
		page-break-before: always; 
	}
	pre, code, pre code, pre span, code span, pre code span {
		/*page-break-inside: avoid;
		-webkit-column-break-inside : avoid;*/
	}
}
		</style>
	</head>
	<body>
	<div class="links tc"><a href="javascript_part_3.html">Part 3</a> | <a href="javascript_part_4.html">Part 4</a> | <a href="javascript_part_5.html">Part 5</a> | <a href="ES6-javascript_part_6.html">Part 6</a></div>
		<div class="home-screen tc cf">
			<h1>JavaScript Tutorials</h1>
			<h4>- Part 3 -</h4>
		</div>
		<!--================= START :: Tutorial Index =================-->
<div class="tutorial-index cf">
	<a href="#t-01"><h1>01 : Dealing with Design Patterns</h1></a>
	<a href="#t-02"><h1>02 : Index</h1></a>
	<a href="#t-03"><h1>03 : Seven JavaScript Quirks I Wish I'd Known About</h1></a>
	<a href="#t-04"><h1>04 : Named function expressions demystified</h1></a>
	<a href="#t-05"><h1>05 : "Real" Mixins with JavaScript Classes</h1></a>
	<a href="#t-06"><h1>06 : JavaScript Mixins</h1></a>
	<a href="#t-07"><h1>07 : Building a simple PubSub system in JavaScript</h1></a>
	<a href="#t-08"><h1>08 : Build A Simple Javascript App The MVC Way</h1></a>
	<a href="#t-09"><h1>09 : PubSub Design Pattern</h1></a>
	<a href="#t-10"><h1>10 : Glossary of Modern JavaScript Concepts: Part 1</h1></a>
	<a href="#t-11"><h1>11 : ES6 Features</h1></a>
	<a href="#t-12"><h1>12 : "What's the typeof null?", and other confusing JavaScript Types</h1></a>
	<a href="#t-13"><h1>13 : Asynchronous vs Deferred JavaScript</h1></a>
	<a href="#t-14"><h1>14 : An Overview of Client-Side Storage</h1></a>
	<a href="#t-15"><h1>15 : Back to JavaScript Basics: VARIABLES!</h1></a>
	<a href="#t-16"><h1>16 : Quick Tip: How to Sort an Array of Objects in JavaScript</h1></a>
	<a href="#t-17"><h1>17 : Effective Functional JavaScript: First-class and Higher Order Functions</h1></a>
	<a href="#t-18"><h1>18 : Ingredients of Effective Functional JavaScript: Closures, Partial Application and Currying</h1></a>
	<a href="#t-19"><h1>19 : Pub-Sub Event Manager</h1></a>
	<a href="#t-20"><h1>20 : Currying in JavaScript</h1></a>
	<a href="#t-21"><h1>21 : Currying the callback, or the essence of futures...</h1></a>
	<a href="#t-22"><h1>22 : Rethinking JavaScript: Eliminate the switch statement for better code</h1></a>
	<a href="#t-23"><h1>23 : Functional JavaScript: Function Composition For Every Day Use.</h1></a>
	<a href="#t-24"><h1>24 : Currying in JavaScript</h1></a>
	<a href="#t-25"><h1>25 : [object Object] Things You Didn't Know About valueOf</h1></a>
	<a href="#t-26"><h1>26 : Prototypal Inheritance</h1></a>
	<a href="#t-27"><h1>27 : How to impress me in an interview</h1></a>
	<a href="#t-28"><h1>28 : A 10 minute primer to JavaScript modules, module formats, module loaders and module bundlers</h1></a>
	<a href="#t-29"><h1>29 : Rethinking JavaScript: Replace break by going functional</h1></a>
	<a href="#t-30"><h1>30 : An Introduction to Functional JavaScript</h1></a>
	<a href="#t-31"><h1>31 : Filtering and Chaining in Functional JavaScript</h1></a>
	<a href="#t-32"><h1>32 : A Beginner's Guide to Currying in Functional JavaScript</h1></a>
	<a href="#t-33"><h1>33 : Higher-Order Functions in JavaScript</h1></a>
	<a href="#t-34"><h1>34 : Recursion in Functional JavaScript</h1></a>
	<a href="#t-35"><h1>35 : How to Build and Structure a Node.js MVC Application</h1></a>
	<a href="#t-36"><h1>36 : A Beginner's Guide to JavaScript Variables and Datatypes</h1></a>
	<a href="#t-37"><h1>37 : 10 Node.js Best Practices: Enlightenment from the Node Gurus</h1></a>
	<a href="#t-38"><h1>38 : 10 Tips to Become a Better Node Developer in 2017</h1></a>
	<a href="#t-39"><h1>39 : Function Composition: Building Blocks for Maintainable Code</h1></a>
	<a href="#t-40"><h1>40 : Creating Unwritable Properties with Object.defineProperty</h1></a>
	<a href="#t-41"><h1>41 : Advanced objects in JavaScript</h1></a>
	<a href="#t-42"><h1>42 : JavaScript: Function Invocation Patterns</h1></a>
	<a href="#t-43"><h1>43 : Javascript: Object Prototypes</h1></a>
	<a href="#t-44"><h1>44 : Maps, Sets and Iterators in JavaScript</h1></a>
	<a href="#t-45"><h1>45 : ES6 Iterators and Generators in Practice</h1></a>
	<a href="#t-46"><h1>46 : ES6 Iterators and Generators -- 6 exercises and solutions</h1></a>
	<a href="#t-47"><h1>47 : What you should know about JavaScript regular expressions</h1></a>
	<a href="#t-48"><h1>48 : all this</h1></a>
	<a href="#t-49"><h1>49 : Everything you wanted to know about JavaScript scope</h1></a>
	<a href="#t-50"><h1>50 : Advanced Javascript: Objects, Arrays, and Array-Like objects</h1></a>
	<a href="#t-51"><h1>51 : Advanced Javascript: Logical Operators and truthy / falsy</h1></a>
	<a href="#t-52"><h1>52 : Design Patterns - Decorating in JavaScript</h1></a>
	<a href="#t-53"><h1>53 : Design Patterns - The Builder Pattern in JavaScript</h1></a>
	<a href="#t-54"><h1>54 : Better JavaScript with ES6, Pt. II: A Deep Dive into Classes</h1></a>
	<a href="#t-55"><h1>55 : Recursion in JavaScript with ES6, destructuring and rest/spread</h1></a>
	<a href="#t-56"><h1>56 : A Gentle Introduction to Composition in JavaScript</h1></a>
	<a href="#t-57"><h1>57 : Enhancing Mixins with Decorator Functions</h1></a>
	<a href="#t-58"><h1>58 : Currying - the Underrated Concept in Javascript</h1></a>
	<a href="#t-59"><h1>59 : An Introduction to Functional Programming in JavaScript</h1></a>
	<a href="#t-60"><h1>60 : Don't Be Scared Of Functional Programming</h1></a>
	<a href="#t-61"><h1>61 : Classes, Inheritance And Mixins In JavaScript</h1></a>
	<a href="#t-62"><h1>62 : JavaScript Mixins: Beyond Simple Object Extension</h1></a>
	<a href="#t-63"><h1>63 : Beautiful Mixins</h1></a>
	<a href="#t-64"><h1>64 : JavaScript and Functional Programming</h1></a>
	<a href="#t-65"><h1>65 : Functional programming with Javascript</h1></a>
	<a href="#t-66"><h1>66 : Understanding JavaScript's async await</h1></a>
	<a href="#t-67"><h1>67 : Gettin' Freaky Functional w/Curried JavaScript</h1></a>
	<a href="#t-68"><h1>68 : Composing Synchronous and Asynchronous Functions in JavaScript</h1></a>
	<a href="#t-69"><h1>69 : Tidying Up a JavaScript Application with Higher-Order Functions</h1></a>
	<a href="#t-70"><h1>70 : Building a simple offline-capable Notepad app using ServiceWorker</h1></a>
	<a href="#t-71"><h1>71 : Getting Started with Service Workers</h1></a>
</div>
		<!--================= END :: Tutorial Index =================-->
		
		<main class="main cf">
			
			<section class="section__one">
			
			<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-01" name="t-01"></a><h1>01 : Dealing with Design Patterns</h1>
					<div class="tutorial__content">
	<h2>Introduction</h2>
	<p class="readmore">Last months I was dealing with Design Patterns, trying to understand how them work and how to implement in javascript, because of the Didgeridoo IDE development, and today I'll write about Module Pattern and Module Revealing Pattern. These are the ones I used for a part of the Didgeridoo project.</p>

	<p>By the way, it's better if you know something about Design Patterns before. Creational Patterns, Structural Patterns and Behavioral Patterns. That three categories you should keep in mind (There also exist Concurrency Patterns, but I will not write about these for now).</p>

	<h2>Brief Descriptions</h2>
	<h3>Creational Patterns:</h3>
	<p>This kind of patterns define the way objects are created in a manner that they can be decoupled from the system. Some of those are:</p>
	<ul>
		<li>Abstract Factory</li>
		<li>Builder</li>
		<li>Factory Method</li>
		<li>Prototype</li>
		<li>Singleton</li>
	</ul>
	<h3>Structural Patterns:</h3>
	<p>This kind of patterns define the way classes and/or objects are structured. Some of those are:</p>
	<ul>
		<li>Adapter</li>
		<li>Bridge</li>
		<li>Composite</li>
		<li>Decorator</li>
		<li>Facade</li>
		<li>Flyweight</li>
		<li>Proxy</li>
	</ul>
	<h3>Behavioral Patterns:</h3>
	<p>This kind of patterns define the way classes and/or objects behave when used to manage algorithms, relationships and responsibilities between them. Some of those are:</p>
	<ul>
		<li>Chain of Responsibility</li>
		<li>Command</li>
		<li>Interpreter</li>
		<li>Iterator</li>
		<li>Mediator</li>
		<li>Memento</li>
		<li>Observer</li>
		<li>State</li>
		<li>Strategy</li>
		<li>Template Method</li>
		<li>Visitor</li>
	</ul>
	<h2>The Module Pattern</h2>

	<p>As of some programming languages provide mechanism for Module Pattern, in javascript we have to get a little bit tricky to simulate it.</p>

	<pre><code class="js hljs ">
<span class="hljs-keyword">var</span> basketModule = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> basket = []; <span class="hljs-comment">//private</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomethingPrivate</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-comment">//...</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomethingElsePrivate</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-comment">//...</span>
    }
    <span class="hljs-keyword">return</span> { <span class="hljs-comment">//exposed to public</span>
        addItem: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(values)</span> {</span>
            basket.push(values);
        },
        getItemCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> basket.length;
        },
        doSomething: doSomethingPrivate(),
        getTotal: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
           <span class="hljs-keyword">var</span> q = <span class="hljs-keyword">this</span>.getItemCount(),p=<span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span>(q--){
                p+= basket[q].price;
            }
            <span class="hljs-keyword">return</span> p;
        }
    }
}());

<span class="hljs-comment">//basketModule is an object with properties which can also be methods</span>
basketModule.addItem({item:<span class="hljs-string">'bread'</span>,price:<span class="hljs-number">0.5</span>});
basketModule.addItem({item:<span class="hljs-string">'butter'</span>,price:<span class="hljs-number">0.3</span>});

console.log(basketModule.getItemCount());
console.log(basketModule.getTotal());

<span class="hljs-comment">//however, the following will not work:</span>
console.log(basketModule.basket);<span class="hljs-comment">// (undefined as not inside the returned object)</span>
console.log(basket); <span class="hljs-comment">//(only exists within the scope of the closure)</span>
	</code></pre>

	<p>
		<em><small>Example by Addy Osmani (<a title="Essential Javascript Design Patterns" href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/" target="_blank">http://addyosmani.com/resources/essentialjsdesignpatterns/book/</a>).</small></em>
	</p>

	<p>At the beginning, the Module Pattern in javascript was thought as a way to simulate Classes with their own Execution Contexts and Scope in a DRY (Don't Repeat Yourself) manner. To understand how we can simulate modules in javascript, first we have to know about the concept of <a title="Closures" href="http://jibbering.com/faq/notes/closures/" target="_blank">Closures</a>.</p>

	<p>In the example above you can see that the public part is done by returning an object, which acts like an interface for the basketModule module. And there also exists a private part that has its own scope and maintain chainability with the global scope. That way, public parts of your code are able to touch the private parts, however the outside world is unable to touch the class's private parts (nice joke Addy Osmani and David Engfer).</p>

	<p>Note that the Module Pattern itself belongs to Creational Patterns, due to this define the way you should create the objects/modules, and also belongs to Structural Patterns, due to the nature of organizing the code in modules is a way of code structuring. So, many people, consider the Module Pattern as a different kind of "category" apart from the others. I think it's just a pattern that define both aspects (creational and structural).</p>

	<h2>The Revealing Module Pattern</h2>

	<p>This pattern is an improved version of the Module Pattern by Christian Heilmann (Mozilla).</p>
	<p>It consists in a better way of organizing the code, like not writing the code of the public methods in the returning part of the code, but pointing to them in the private part. In other words, define all your methods and variables in the private part and keep the public part clean, as follow:</p>

	<pre><code class="js hljs ">
<span class="hljs-keyword">var</span>&nbsp;myRevealingModule&nbsp;=&nbsp;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>

    <span class="hljs-keyword">var</span>&nbsp;name&nbsp;=&nbsp;<span class="hljs-string">'John Smith'</span>;
    <span class="hljs-keyword">var</span>&nbsp;age&nbsp;=&nbsp;<span class="hljs-number">40</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">updatePerson</span><span class="hljs-params">()</span>{</span>
        name&nbsp;=&nbsp;<span class="hljs-string">'John&nbsp;Smith&nbsp;Updated'</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">setPerson</span>&nbsp;<span class="hljs-params">()</span>&nbsp;{</span>
        name&nbsp;=&nbsp;<span class="hljs-string">'John&nbsp;Smith&nbsp;Set'</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">getPerson</span>&nbsp;<span class="hljs-params">()</span>&nbsp;{</span>
        <span class="hljs-keyword">return</span>&nbsp;name;
    }

    <span class="hljs-comment">//Public interface</span>
    <span class="hljs-keyword">return</span> {
        set:&nbsp;setPerson,
        get:&nbsp;getPerson
    };
}());

<span class="hljs-comment">// Sample usage:</span>
myRevealingModule.get();
	</code></pre>

	<p>It seems like there's no difference but it will help you to maintain your code well organized and clean.</p>

					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-02" name="t-02"></a><h1>02 : Index</h1>
					<div class="tutorial__content">

<p>This post will go over the Javascript language from the point of view of a Java developer, focusing on the differences between the two languages and the frequent pain points. We will go over the following:</p>

<ul>
<li>Objects Only, No Classes</li>
<li>Functions are just Values</li>
<li>The 'this' Keyword </li>
<li>Classic vs Prototypal Inheritance</li>
<li>Constructors vs Constructor Functions</li>
<li>Closures vs Lambdas</li>
<li>Encapsulation and Modules</li>
<li>Block Scope and Hoisting </li>
</ul>

<h3 id="whyjavascriptinthejavaworld">Why Javascript in the Java World ?</h3>

<p>A lot of Java frontend development work is done using Java/XML based frameworks like JSF or GWT. The framework developers themselves need to know Javascript, but in principle the application developers don't. However the reality is that:</p>

<ul>
<li>For doing custom component development in for example Primefaces (JSF), it's important to know Javascript and jQuery. </li>
<li>In GWT, integrating at least some third-party Javascript widgets is common and cost effective.</li>
</ul>

<p>The end result is that Javascript is usually needed to do at least the last 5 to 10% of frontend work, even using Java frameworks. Also it's starting to get more and more used for polyglot enterprise development, alongside <a href="http://angularjs.org/">Angular</a> for example.</p>

<p>The good news is that, besides a few gotchas that we will get into, Javascript is a very learneable language for a Java developer. </p>

<h3 id="objectsonlynoclasses">Objects Only - No Classes</h3>

<p>One of the most surprising things about Javascript is that although it's an object oriented language, there are no classes (although the <a href="http://wiki.ecmascript.org/doku.php?id=harmony:classes">new Ecmascript 6 version</a> will have them).</p>

<p>Take for example this program, that initializes an empty object and set's two properties:</p>

<pre><code>// create an empty object - no class was needed !!
var superhero = {};
 
superhero.name = 'Superman';  
superhero.strength = 100;

</code></pre>


<p>Javascript objects are just like a Java HashMap of related properties, where the keys are Strings only. The following would be the 'equivalent' Java code:</p>
<pre><code>Map&lt;String,Object&gt; superhero = new HashMap&lt;&gt;();
 
superhero.put("name","Superman");  
superhero.put("strength", 100);

</code></pre>


<p>This means that a Javascript object is just a multi-level 'hash map' of key/value pairs, with no class definition needed. </p>

<h3 id="functionsarejustvalues">Functions Are Just Values</h3>

<p>Functions in Javascript are just values of type <code>Function</code>, it's a simple as that! Take for example:</p>
<pre><code>var flyFunction = function() {  
    console.log('Flying like a bird!');
};
 
superhero.fly = flyFunction;

</code></pre>


<p>This creates a function (a value of type <code>Function</code>) and assigns it to a variable <code>flyFunction</code>. A new property named <code>fly</code> is then created in the superhero object, that can be invoked like this:</p>

<pre><code>// prints 'Flying like a bird!' to the console
superhero.fly();

</code></pre>


<p>Java does <strong>not</strong> have the equivalent of the Javascript <code>Function</code> type, but almost.  Take for example the <code>SuperHero</code> class that takes a <code>Power</code> function:</p>

<pre><code>public interface Power {  
    void use();
}
 
public class SuperHero {
 
    private Power flyPower;
 
    public void setFly(Power flyPower) {
        this.flyPower = flyPower;
    }
 
    public void fly() {
        flyPower.use();
    }
}

</code></pre>


<p>This is how to pass <code>SuperHero</code> a function in Java 7 and 8:</p>
<pre><code>// Java 7 equivalent
Power flyFunction = new Power() {  
    @Override
    public void use() {
        System.out.println("Flying like a bird ...");
    }
};
 
// Java 8 equivalent 
superman.setFly(  
    ()-&gt;System.out.println("Flying like a bird ..."));
 
superman.fly();

</code></pre>


<p>So although a <code>Function</code> type does not exist in Java 8, this ends up not preventing a 'Javascript-like' functional programming style. </p>

<p>But if we pass functions around, what happens to the meaning of the <br>
<code>this</code> keyword?</p>

<h3 id="thethiskeywordusage">The 'this' Keyword Usage</h3>

<p>What Javascript allows to do with <code>this</code> is quite surprising compared to the Java world. Let's start with an example:</p>


<pre><code>var superman = {
 
  heroName: 'Superman',  
 
  sayHello: function() {
      console.log("Hello, I'm " + this.heroName );
  }  
};
 
superman.sayHello();  

</code></pre>


<p>This program creates an object <code>superman</code> with two properties: a String <br>
<code>heroName</code> and a <code>Function</code> named <code>sayHello</code>. Running this program outputs as expected <code>Hello, I'm Superman</code>. </p>

<h4 id="whatifwepassthefunctionaround">What if we pass the function around?</h4>

<p>By passing around <code>sayHello</code>, we can easily end up in a context where there is no <code>heroName</code> property:</p>

<pre><code>var failThis = superman.sayHello;
 
failThis();

</code></pre>


<p>Running this snippet would give as output: <code>Hello, I'm undefined</code>. </p>

<h4 id="whydoesthisnotworkanymore">Why does <code>this</code> not work anymore?</h4>

<p>This is because the variable <code>failThis</code> belongs to the global scope, which contains no member variable named <code>heroName</code>.  To solve this:</p>

<blockquote>
  <p>In Javascript the value of the <code>this</code> keyword is completely overridable to be anything that we want!</p>
</blockquote>
<pre><code>// overrides 'this' with superman
hello.call(superman);  

</code></pre>


<p>The snippet above would print again <code>Hello, I'm Superman</code>. This means that the value of <code>this</code> depends on both the context on which the function is called, and on <em>how</em> the function is called.</p>

<h3 id="classicvsprototypalinheritance">Classic vs Prototypal Inheritance</h3>

<p>In Javascript, there is no class inheritance, instead objects can inherit directly from other objects. The way this works is that each object has an implicit property that points to a 'parent' object.</p>

<p>That property is called <code>__proto__</code>, and the parent object is called the object's <strong>prototype</strong>, hence the name Prototypal Inheritance.  </p>

<h4 id="howdoesprototypework">How does <code>prototype</code> work?</h4>

<p>When looking up a property, Javascript will try to find the property in the object itself. If it does not find it then it tries in it's prototype, and so on. For example:</p>

<pre><code>var avengersHero = {  
    editor: 'Marvel'
};
 
var ironMan = {};
 
ironMan.__proto__ = avengersHero;
 
console.log('Iron Man is copyrighted by ' + ironMan.editor);

</code></pre>


<p>This snippet will output <code>Iron Man is copyrighted by Marvel</code>. </p>

<p>As we can see, although the <code>ironMan</code> object is empty, it's prototype does contain the property <code>editor</code>, which get's found. </p>

<h4 id="howdoesthiscomparewithjavainheritance">How does this compare with Java inheritance?</h4>

<p>Let's now say that the rights for the Avengers where bought by DC Comics:</p>

<pre><code>avengersHero.editor = 'DC Comics';
</code></pre>

<p>If we call <code>ironMan.editor</code> again, we now get <code>Iron Man is copyrighted by DC Comics</code>. All the existing object instances with the <code>avengersHero</code> prototype now see <code>DC Comics</code> <em>without</em> having to be recreated.</p>

<p>This mechanism is very simple and very powerful. Anything that can be done with class inheritance can be done with prototypal inheritance. But what about constructors?</p>

<h3 id="constructorsvsconstructorfunctions">Constructors vs Constructor Functions</h3>

<p>In Javascript an attempt was made to make object creation similar to  languages like Java. Let's take for example:</p>

<pre><code>function SuperHero(name, strength) {  
    this.name = name;
    this.strength = strength;
}

</code></pre>


<p>Notice the capitalized name, indicating that it's a constructor function. Let's see how it can be used:</p>

<pre><code>var superman = new SuperHero('Superman', 100);
 
console.log('Hello, my name is ' + superman.name); 

</code></pre>


<p>This code snippet outputs <code>Hello, my name is Superman</code>. </p>

<p>You might think that this looks just like Java, and that is exactly the point! What this <code>new</code> syntax really does is to it creates a new empty object, and then calls the constructor function by forcing <code>this</code> to be the newly created object.</p>

<h4 id="whyisthissyntaxnotrecommendedthen">Why is this syntax not recommended then?</h4>

<p>Let's say that we want to specify that all super heroes have a <br>
<code>sayHello</code> method. This could be done by putting the <code>sayHello</code> function in a common prototype object:</p>

<pre><code>function SuperHero(name, strength) {  
    this.name = name;
    this.strength = strength;
}
 
SuperHero.prototype.sayHello = function() {  
    console.log('Hello, my name is ' + this.name);
}
 
var superman = new SuperHero('Superman', 100);  
superman.sayHello(); 

</code></pre>


<p>This would output <code>Hello, my name is Superman</code>. </p>

<p>But the syntax <code>SuperHero.prototype.sayHello</code> looks anything but Java like! The <code>new</code> operator mechanism sort of half looks like Java but at the same time is completely different.</p>

<h4 id="istherearecommendedalternativetonew">Is there a recommended alternative to <code>new</code>?</h4>

<p>The recommended way to go is to ignore the Javascript <code>new</code> operator altogether  and use <code>Object.create</code>:</p>

<pre><code>var superHeroPrototype = {  
   sayHello: function() {
        console.log('Hello, my name is ' + this.name);
    } 
};
 
var superman = Object.create(superHeroPrototype);  
superman.name = 'Superman';

</code></pre>


<p>Unlike the <code>new</code> operator, one thing that Javascript absolutely got right where Closures.</p>

<h3 id="closuresvslambdas">Closures vs Lambdas</h3>

<p>Javascript Closures are not that different from Java anonymous inner classes used in a certain way. take for example the <code>FlyingHero</code> class:</p>

<pre><code>public interface FlyCommand {  
    public void fly();
}
 
public class FlyingHero {
 
    private String name;
 
    public FlyingHero(String name) {
        this.name = name;
    }
 
    public void fly(FlyCommand flyCommand) {
        flyCommand.fly();
    }
}

</code></pre>


<p>We can can pass it a fly command like this in Java 8:</p>

<pre><code>String destination = "Mars";  
superMan.fly(() -&gt; System.out.println("Flying to " +  
    destination ));
    
    </code></pre>


<p>The output of this snippet is <code>Flying to Mars</code>. Notice that the  <code>FlyCommand</code> lambda had to 'remember' the variable <code>destination</code>, because it needs it for executing the <code>fly</code> method later.</p>

<p>This notion of a function that remembers about variables outside it's block scope for later use is called a <strong>Closure</strong> in Javascript. For further details, have a look at this blog post <a href="http://blog.jhades.org/really-understanding-javascript-closures/">Really Understanding Javascript Closures</a>.</p>

<h4 id="whatisthemaindifferencebetweenlambdasandclosures">What is the main difference between Lambdas and Closures?</h4>

<p>In Javascript a closure looks like this:</p>

<pre><code>var destination = 'Mars';
 
var fly = function() {  
    console.log('Fly to ' + destination);
}
 
fly(); 

</code></pre>


<p>The Javascript closure, unlike the Java Lambda does not have the constraint that the <code>destination</code> variable must be immutable (or effectively immutable since Java 8).</p>

<p>This seemingly innocuous difference is actually a 'killer' feature of Javascript closures, because it allows them to be used for creating encapsulated modules.</p>

<h3 id="modulesandencapsulation">Modules and Encapsulation</h3>

<p>There are no classes in Javascript and no <code>public</code>/ <code>private</code> modifiers, but then again take a look at this:</p>

<pre><code>function createHero(heroName) {
 
    var name = heroName;
 
    return  {
        fly: function(destination) {
          console.log(name + ' flying to ' + destination);
        }
    }; 
}

</code></pre>


<p>Here a function <code>createHero</code> is being defined, which returns an object which has a function <code>fly</code>. The <code>fly</code> function 'remembers' <code>name</code> when needed. </p>

<h4 id="howdoclosuresrelatetoencapsulation">How do Closures relate to Encapsulation?</h4>

<p>When the <code>createHero</code> function returns, noone else will ever be able to directly access <code>name</code>, except via <code>fly</code>. Let's try this out:</p>

<pre><code>var superman = createHero('SuperMan');
 
superman.fly('The Moon');

</code></pre>


<p>The output of this snippet is <code>SuperMan flying to The Moon</code>. But happens if we try to access <code>name</code> directly ?</p>

<pre><code>console.log('Hero name = ' + superman.name);  
</code></pre>

<p>The result is <code>Hero name = undefined</code>. The function <code>createHero</code> is said to a be a Javascript encapsulated <strong>module</strong>, with closed 'private' member variables and a 'public' interface returned as an object with functions.</p>

<h3 id="blockscopeandhoisting">Block Scope and Hoisting</h3>

<p>Understanding block scope in Javascript is simple: there is no block scope! Take a look at this example:</p>

<pre><code>function counterLoop() {
 
    console.log('counter before declaration = ' + i); 
 
    for (var i = 0; i &lt; 3 ; i++) {
        console.log('counter = ' + i); 
    }
 
    console.log('counter after loop = ' + i); 
}
 
counterLoop();  

</code></pre>


<p>By looking at this coming from Java, you might expect:</p>

<ul>
<li>error at line 3: 'variable i does not exist'</li>
<li>values 0, 1, 2 are printed </li>
<li>error at line 9: 'variable i does not exist'</li>
</ul>

<p>It turns out that only one of these three things is true, and the output is actually this:</p>

<pre><code>counter before declaration = undefined  
counter = 0 
counter = 1 
counter = 2 
counter after loop = 3 
</code></pre>

<p>Because there is no block scope, the loop variable i is visible for the <strong>whole</strong> function. This means:</p>

<ul>
<li>line 3 sees the variable declared but not initialized</li>
<li>line 9 sees i after the loop has terminated</li>
</ul>

<p>What might be the most puzzling is that line 3 actually sees the variable declared but undefined, instead of throwing <code>i is not defined</code>.</p>

<p>This is because the Javascript interpreter first scans the function for a list of variables, and then goes back to interpret the function code lines one by one.</p>

<p>The end result is that it's like the variable i was <strong>hoisted</strong> to the top, and this is what the Javascript runtime actually 'sees':</p>
<pre><code>function counterLoop() {
 
    var i; // i is 'seen' as if declared here! 
 
    console.log('counter before declaration = ' + i); 
 
    for (i = 0; i &lt; 3 ; i++) {
        console.log('counter = ' + i); 
    }
 
    console.log('counter after loop:  ' + i); 
}

</code></pre>


<p>To prevent surprises caused by hoisting and lack of block scoping, it's a recommended practice to declare variables always at the top of functions.</p>

<p>This makes hoisting explicit and visible by the developer, and helps to avoid bugs. The next version of Javascript (Ecmascript 6) will include a <a href="http://wiki.ecmascript.org/doku.php?id=harmony:let">new keyword 'let' to allow block scoping</a>.</p>

<h3 id="conclusions">Conclusions</h3>

<p>The Javascript language shares a lot of similarities with Java, but also some huge differences. Some of the differences like inheritance and constructor functions are important, but much less than one would expect for day to day programming.</p>

<p>Some of these features are needed mostly by library developers, and not necessarily for day to day application programming. This is unlike some of their Java counterparts which are needed every day.</p>

<p>So if you are hesitant to give it a try, don't let some of these features prevent you from going further into the language. </p>

<p>One thing is for sure, at least <em>some</em> Javascript is more or less inevitable when doing Java frontend development, so it's really worth to give it a try. </p>

<h3 id="ifyouareinterestedintypesafefrontenddevelopment">If you are interested in Type-Safe Frontend Development</h3>

<p>If that is the case, you might want to have a look at our ongoing YouTube course on Angular 2 - Getting Started With Angular 2:</p>

					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-03" name="t-03"></a><h1>03 : Seven JavaScript Quirks I Wish I'd Known About</h1>
					<div class="tutorial__content">

          

          <p>If you are new to JavaScript or it has only been a minor part of your development effort until recently, you may be feeling frustrated. All languages have their quirks -- but the paradigm shift from strongly typed server-side languages to JavaScript can feel especially confusing at times. I've been there! A few years ago, when I was thrust into full time JavaScript development, there were <em>many</em> things I wish I'd known going into it. In this article, I'll share a few of these quirks in hopes that I might spare you some of the headaches I endured. This isn't an exhaustive list -- just a sampling -- but hopefully it will shed some light on the language as well as show how powerful it can be once you get past these kinds of hurdles.</p>
<h4>The Quirks We'll look at:</h4>
<ol>
<li><a href="#equality">Equality</a></li>
<li><a href="#notation">Dot Notation vs Bracket Notation</a></li>
<li><a href="#functions">Function Context</a></li>
<li><a href="#expdec">Function Declarations vs Function Expressions</a></li>
<li><a href="#anon">Named vs Anonymous Functions</a></li>
<li><a href="#iife">Immediately Invoked Function Expressions</a></li>
<li><a href="#t-ypechecking"><code>typeof</code> vs <code>Object.prototype.toString</code></a></li>
</ol>
<h2 id="equality">1.) Equality</h2>
<p>Coming from C#, I was well familiar with the <code>==</code> comparison operator. Value types (&amp; strings) are either equal (have the same value) or they aren't. Reference types are either equal -- as in pointing to the same reference -- or NOT. (Let's just pretend you're not overloading the <code>==</code> operator, or implementing your own <code>Equals</code> and <code>GetHashCode</code> methods.) I was surprised to learn that JavaScript has <em>two</em> equality operators: <code>==</code> and <code>===</code>. Most of the code I'd initially seen used <code>==</code>, so I followed suit and wasn't aware of what JavaScript was doing for me as I ran code like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"YAY! They're equal!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>So what dark magic is <em>this</em>? How can the <em>integer</em> 1 equal the <em>string</em> "1"?</p>
<p>In JavaScript, there's equality (<code>==</code>) and then there's <em>strict</em> equality (<code>===</code>). The equality comparison operator will coerce the operands to the same type and <em>then</em> perform a strict equality comparison. So in the above example, the string "1" is being converted, behind the scenes, to the integer 1, and then compared to our variable <code>x</code>.</p>
<p>Strict equality doesn't coerce the types for you. If the operands aren't of the same type (as in the integer 1 and string "1"), then they <em>aren't</em> equal:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// with strict equality, the types must be the *same* for it to be true
</span><span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"Sadly, I'll never write this to the console"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"YES! Strict Equality FTW."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>You might already be thinking of the kinds of horrors that could occur when type coercion is done for you -- the sort of assumptions that you could make that misrepresent the true nature of the values in your app which lead to difficult-to-find-yet-hiding-in-plain-sight bugs. It's no surprise, then, that the general rule of thumb recommended by experienced JavaScript developers is to <em>always use strict equality</em>.</p>
<h2 id="notation">2.) Dot Notation vs Bracket Notation</h2>
<p>Depending on what other languages you hail from, you probably weren't too surprised to see these forms of accessing a property on an object and accessing an element in an array in JavaScript:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment" spellcheck="true">// getting the "firstName" value from the person object:
</span><span class="token keyword">var</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span>firstName<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// getting the 3rd element in an array:
</span><span class="token keyword">var</span> theOneWeWant <span class="token operator">=</span> myArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // remember, 0-based index</span></code></pre>
<p>However, did you know it's possible to use bracket notation to reference object members as well? For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> name <span class="token operator">=</span> person<span class="token punctuation">[</span><span class="token string">"firstName"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>Why would this be useful? While you'll probably use dot notation the majority of the time, there are a few instances where bracket notation makes certain approaches possible that couldn't be done otherwise. For example, I will often refactor large <code>switch</code> statements into a <a href="https://en.wikipedia.org/wiki/Dispatch_table">dispatch table</a>, so that something like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> doSomething <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doWhat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">switch<span class="token punctuation">(</span></span>doWhat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        case <span class="token string">"doThisThing"</span><span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // more code...
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
        case <span class="token string">"doThatThing"</span><span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // more code...
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
        case <span class="token string">"doThisOtherThing"</span><span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // more code....
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token comment" spellcheck="true"> // additional cases here, etc.
</span>        default<span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // default behavior
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Can be transformed into something like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> thingsWeCanDo <span class="token operator">=</span> <span class="token punctuation">{</span>
    doThisThing      <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    doThatThing      <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    doThisOtherThing <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    default          <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> doSomething <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doWhat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> thingToDo <span class="token operator">=</span> thingsWeCanDo<span class="token punctuation">.</span><span class="token function">hasOwnProperty<span class="token punctuation">(</span></span>doWhat<span class="token punctuation">)</span> <span class="token operator">?</span> doWhat <span class="token punctuation">:</span> <span class="token string">"default"</span>
    thingsWeCanDo<span class="token punctuation">[</span>thingToDo<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>There's nothing inherently wrong with using a <code>switch</code> (and in many cases, if you're iterating and performance is a huge concern, a <code>switch</code> may outperform the dispatch table). However, dispatch tables offer a nice way to organize and extend behavior, and bracket notation makes it possible by allowing you to reference a property dynamically at runtime.</p>
<h2 id="functions">3.) Function Context</h2>
<p>There have been a number of great blog posts about properly understanding the "<code>this</code> context" in JavaScript (and I'll link to several at the bottom of this post), but it definitely makes my list of "things I wish I'd known" right away. It's really not difficult to look at code and confidently know what <code>this</code> is at any point -- you just have to learn a couple of rules. Unfortunately, many explanations I read about it early on just added to my confusion. As a result, I've tried to simplify the explanation for developers new to JavaScript.</p>
<h3>First -- Start With a Global Assumption</h3>
<p>By default, until there's a reason for the execution context to change, <code>this</code> refers to the <em>global object</em>. In the browser, that would be the <code>window</code> object (or <code>global</code> in node.js).</p>
<h3>Second -- the Value of <code>this</code> in Methods</h3>
<p>When you have an object with a member that is a function, invoking that method <em>from the parent object</em> makes <code>this</code> the parent object. For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> marty <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Marty"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"McFly"</span><span class="token punctuation">,</span>
    timeTravel<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

marty<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span><span class="token number">1955</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Marty McFly is time traveling to 1955</span></code></pre>
<p>You might already know that you can take the <code>marty</code> object's <code>timeTravel</code> method and create a new reference to it from another object. This is actually quite a powerful feature of JavaScript -- enabling us to apply behavior (functions) to more than one target instance:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> doc <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Emmett"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"Brown"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

doc<span class="token punctuation">.</span>timeTravel <span class="token operator">=</span> marty<span class="token punctuation">.</span>timeTravel<span class="token punctuation">;</span></code></pre>
<p>So -- what happens if we invoke <code>doc.timeTravel(1885)</code>?</p>
<pre class=" language-javascript"><code class=" language-javascript">doc<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span><span class="token number">1885</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Emmett Brown is time traveling to 1885</span></code></pre>
<p>Again -- deep dark magic. Well, not really. Remember, when you're invoking a <em>method</em>, the <code>this</code> context is the parent object it's being invoked from. Hold on to your DeLoreans, though, cause it's about the get heavy.</p>
<div style="font-size:x-small;font-style:italic">(Note: I've updated this section for clarity and to make some corrections from the original post.)</div>
<p>What happens when we save a reference to the <code>marty.TimeTravel</code> method and invoke our saved reference? Let's look:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> getBackInTime <span class="token operator">=</span> marty<span class="token punctuation">.</span>timeTravel<span class="token punctuation">;</span>
<span class="token function">getBackInTime<span class="token punctuation">(</span></span><span class="token number">2014</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// undefined undefined is time traveling to 2014</span></code></pre>
<p>Why "undefined undefined"?! Why not "Marty McFly"?</p>
<p>Let's ask an important question: <em>What's the parent/owning object when we invoke our <code>getBackInTime</code> function?</em> While the <code>getBackInTime</code> function will technically exist on the window, we're invoking it as a <em>function</em>, not a method of an object. When we invoke a function like this -- with no owning object -- the <code>this</code> context will be the global object. <a href="http://davidshariff.com/blog/javascript-this-keyword/">David Shariff</a> has a great way of describing this: </p>
<blockquote><p>
Whenever a function is called, we must look at the immediate left side of the brackets / parentheses "()". If on the left side of the parentheses we can see a reference, then the value of "this" passed to the function call is exactly of which that object belongs to, otherwise it is the global object.
</p></blockquote>
<p>Since <code>getBackInTime</code>'s <code>this</code> context is the <code>window</code> -- which does not have <code>firstName</code> and <code>lastName</code> properties -- that explains why we see "undefined undefined".</p>
<p>So we know that invoking a function directly -- no owning object -- results in the <code>this</code> context being the global object. But I also said that I knew our <code>getBackInTime</code> function would exist on the window. How do I know this? Well, unless I've wrapped the <code>getBackInTime</code> in a different scope (which we'll investigate when we discuss immediately-invoked-function-expressions), then any vars I declare get attached to the window. Here's proof from Chrome's console:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_1.png"><img class="alignnone size-full wp-image-491" alt="jsquirks_afjq_1" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_1.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_1.png 1522w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_1-300x28.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_1-1024x96.png 1024w"></a></p>
<p>This is the perfect time to talk about one of the main areas that <code>this</code> trips up developers: subscribing event handlers.</p>
<h3>Third (really just an extension of #2) -- The Value of <code>this</code> in Methods When Invoked Asynchronously</h3>
<p>So, let's pretend we want to invoke our <code>marty.timeTravel</code> method when someone clicks a button:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> flux <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById<span class="token punctuation">(</span></span><span class="token string">"flux-capacitor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
flux<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> marty<span class="token punctuation">.</span>timeTravel<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>With the above code, when the user clicks the button, we'll see "undefined undefined is time traveling to [object MouseEvent]". WAT?! Well -- the first, and most obvious, issue is that we're not providing the <code>year</code> argument to our <code>timeTravel</code> method. Instead, we subscribed the method directly as an event handler, and the <code>MouseEvent</code> argument is being passed to the event handler as the first arg. That's easy to fix, but the real issue is that we're seeing "undefined undefined" again. Don't despair -- you already know why this is the case (even if you don't realize it yet). Let's make a change to our <code>timeTravel</code> function to log whatever <code>this</code> is to help give us some insight:</p>
<pre class=" language-javascript"><code class=" language-javascript">marty<span class="token punctuation">.</span>timeTravel <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Now -- when we click the button, we should see something similar to the following output in our browser console:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_2.png"><img class="alignnone size-full wp-image-501" alt="jsquirks_afjq_2" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_2.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_2.png 970w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_2-300x25.png 300w"></a></p>
<p>Our second <code>console.log</code> shows us the <code>this</code> context when the method was invoked -- and it's the actual button element which we subscribed to. Does this surprise you? Just like earlier -- when we assigned the <code>marty.timeTravel</code> reference to our <code>getBackInTime</code> var -- a reference to <code>marty.timeTravel</code> was saved as our event handler and is being invoked, but not from the "owning" <code>marty</code> object. In this case, it's being invoked asynchronously by the underlying <a href="http://en.wikipedia.org/wiki/Event-driven_architecture">event emitting</a> implementation of the button element instance.</p>
<p>So -- is it possible make <code>this</code> what we want it to be? Absolutely! In this case, the solution is deceptively simple. Instead of subscribing <code>marty.timeTravel</code> directly as the event handler, we can use an anonymous function as our event handler, and call marty.timeTravel from within it. This also provides the opportunity to fix our issue with the missing <code>year</code> parameter.</p>
<pre class=" language-javascript"><code class=" language-javascript">flux<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    marty<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span>someYearValue<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Clicking the button now will result in something similar to this output on the console:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquicks_afjq_3.png"><img class="alignnone size-full wp-image-511" alt="jsquicks_afjq_3" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquicks_afjq_3.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquicks_afjq_3.png 1134w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquicks_afjq_3-300x24.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquicks_afjq_3-1024x83.png 1024w"></a></p>
<p>Success! But why did this work? Think of how we're invoking the <code>timeTravel</code> method. In our first button click example, we subscribed the method reference <em>itself</em> as the event handler, so it was not being called from the parent object of <code>marty</code>. In the second example, it's our anonymous function that will have a <code>this</code> of the button element, and when we invoke <code>marty.timeTravel</code>, we're calling it from the <code>marty</code> parent object, and the <code>this</code> will be <code>marty</code>.</p>
<h3>Fourth -- The Value of <code>this</code> Inside Constructor Functions.</h3>
<p>When you use a constructor function to create a new instance of an object, the <code>this</code> value inside the function is the new object that's being created. For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> TimeTraveler <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fName<span class="token punctuation">,</span> lName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>firstName <span class="token operator">=</span> fName<span class="token punctuation">;</span>
    this<span class="token punctuation">.</span>lastName <span class="token operator">=</span> lName<span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true"> // Constructor functions return the
</span>   <span class="token comment" spellcheck="true"> // newly created object for us unless
</span>   <span class="token comment" spellcheck="true"> // we specifically return something else
</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> marty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimeTraveler</span><span class="token punctuation">(</span><span class="token string">"Marty"</span><span class="token punctuation">,</span> <span class="token string">"McFly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>marty<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> marty<span class="token punctuation">.</span>lastName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Marty McFly</span></code></pre>
<h3>Using Call, Apply &amp; Bind</h3>
<p>You might already suspect, given the above examples, that there might be some language-level features that would allow us to invoke a function and tell it at runtime what <code>this</code> should be. You'd be right. The <code>call</code> and <code>apply</code> methods that exist on the <code>Function</code> prototype both allow us to invoke a function and pass in a <code>this</code> value.</p>
<p><code>call</code>'s method signature takes the <code>this</code> arg, followed by the parameters the function being invoked would take as separate arguments:</p>
<pre class=" language-javascript"><code class=" language-javascript">someFn<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>this<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>`apply` takes `this` as the first arg, followed by an array of the remaining arguments:</p>
<pre class=" language-javascript"><code class=" language-javascript">someFn<span class="token punctuation">.</span><span class="token function">apply<span class="token punctuation">(</span></span>this<span class="token punctuation">,</span> <span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Our `doc` and `marty` instances can time travel on their own, but <a href="http://backtothefuture.wikia.com/wiki/Einstein">Einstein</a> needed their help to time travel. So let's add a method to our `doc` instance from earlier (the one we copied the `timeTravel` method to), so that `doc` can cause an `einstein` instance to travel in time:</p>
<pre class=" language-javascript"><code class=" language-javascript">doc<span class="token punctuation">.</span>timeTravelFor <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>timeTravel<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>instance<span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true"> // alternate syntax if you used apply would be
</span>   <span class="token comment" spellcheck="true"> // this.timeTravel.apply(instance, [year]);
</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Now it's possible to send Einstein on his way:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> einstein <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Einstein"</span><span class="token punctuation">,</span> 
    lastName<span class="token punctuation">:</span> <span class="token string">"(the dog)"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">timeTravelFor<span class="token punctuation">(</span></span>einstein<span class="token punctuation">,</span> <span class="token number">1985</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Einstein (the dog) is time traveling to 1985</span></code></pre>
<p>I know this is a contrived example, but it's enough to give you a glimpse of the power of applying functions to other objects.</p>
<p>There's still one other possibility we haven't explored. Let's give our <code>marty</code> instance a <code>goHome</code> method that's simply a shortcut to calling <code>this.timeTravel(1985)</code>:</p>
<pre class=" language-javascript"><code class=" language-javascript">marty<span class="token punctuation">.</span>goHome <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span><span class="token number">1985</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>However, we know that if we subscribe <code>marty.goHome</code> as the event handler to our button's click event, that <code>this</code> will be the button -- and unfortunately buttons don't have a <code>timeTravel</code> method. We could use our approach from earlier -- where an anonymous function was the event handler, and it invoked the method on the <code>marty</code> instance -- but we have another option, the <code>bind</code> function:</p>
<pre class=" language-javascript"><code class=" language-javascript">flux<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> marty<span class="token punctuation">.</span>goHome<span class="token punctuation">.</span><span class="token function">bind<span class="token punctuation">(</span></span>marty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The <code>bind</code> function actually returns a <em>new</em> function, with the <code>this</code> value of the new function set to what you provide as the argument. If you're supporting older browsers (less than IE9, for example), then you'll need to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">shim the <code>bind</code> function</a> (or, if you're using jQuery, you can use <code>$.proxy</code>; both underscore &amp; lodash provide <code>_.bind</code>).</p>
<blockquote><p>One important thing to remember is that if you use <code>bind</code> on a <em>prototype</em> method, it creates an instance-level method, which bypasses the advantages of having methods on the prototype. It's not <em>wrong</em>, just something to be aware of. I write more about this particular issue <a href="http://freshbrewedcode.com/jimcowart/2013/02/12/getting-into-context-binds/">here</a>.</p></blockquote>
<h2 id="expdec">4.) Function Expressions vs Function Declarations</h2>
<p>There are two main ways you will typically see functions defined in JavaScript (though ES6 will introduce <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope#The_arrow_function_expression_(.3D">another</a>)): function declarations and function expressions.</p>
<p>Function Declarations do not require a <code>var</code> keyword. In fact, as <a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">Angus Croll says</a>: <em>"It's helpful to think of them as siblings of Variable Declarations."</em> For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">function</span> <span class="token function">timeTravel<span class="token punctuation">(</span></span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>The function name <code>timeTravel</code> in the above example is visible not only inside the scope it was declared, but inside the function itself as well (this is especially useful for recursive function calls). Function declarations are, by nature, <em>named functions</em>. In other words, the above function's <code>name</code> property is <code>timeTravel</code>.</p>
<p>Function Expressions define a function and assign it to a variable. They typically look like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> someFn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"I like to express myself..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>It's possible to name function expressions as well -- though, unlike function declarations, a named function expression's name is only accessible <em>inside</em> its scope:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> someFn <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">iHazName<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"I like to express myself..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>needsMoreExpressing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">iHazName<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // the function's name can be used here
</span>    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// you can call someFn() here, but not iHazName()
</span><span class="token function">someFn<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote><p>Discussing function expressions and declarations wouldn't be complete without at least mentioning "hoisting" -- where function and variable declarations are moved to the top of the containing scope by the interpreter. We're not going to cover hoisting here, but be sure to read two great explanations by <a href="http://www.adequatelygood.com/JavaScript-Scoping-and-Hoisting.html">Ben Cherry</a> and <a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">Angus Croll</a>.</p></blockquote>
<h2 id="anon">5.) Named vs Anonymous Functions</h2>
<p>Based on what we've just discussed, you might have guessed that an "anonymous" function is a function without a name. Most JavaScript developers would quickly recognize the second argument below as an anonymous function:</p>
<pre class=" language-javascript"><code class=" language-javascript">someElement<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> // I'm anonymous!
</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>However, it's also true that our <code>marty.timeTravel</code> method is anonymous as well:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> marty <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Marty"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"McFly"</span><span class="token punctuation">,</span>
    timeTravel<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Since function declarations must have a name, only function <em>expressions</em> can be anonymous.</p>
<h2 id="iife">6.) Immediately Invoked Function Expressions</h2>
<p>And since we're talking about function expressions, one thing I wish I'd known right away: the Immediately Invoked Function Expression (IIFE). There are a number of good posts on IIFEs (I'll list a few at the end), but in a nutshell, it's a function expression that is not assigned to a variable to be executed later, it's executed <em>immediately</em>. It might help to see this take shape in a browser console.</p>
<h3>First -- let's start with just entering a function expression -- but not assigning it -- and see what happens:</h3>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_4.png"><img class="alignnone size-full wp-image-521" alt="jsquirks_afjq_4" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_4.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_4.png 604w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_4-300x40.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_4-600x82.png 600w"></a></p>
<p>That's not valid JavaScript syntax -- it's a function declaration missing its name. However, to make it an expression, we just need to surround it with parentheses:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png"><img class="alignnone size-full wp-image-531" alt="jsquirks_afjq_6" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6.png 656w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6-300x33.png 300w"></a> <a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_5.png"><img class="alignnone size-full wp-image-551" alt="jsquirks_afjq_5" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_5.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_5.png 624w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_5-300x41.png 300w"></a></p>
<p>Making this an expression immediately returns our anonymous function to the console (remember, we're not assigning it, but since it's an expression we get its value back). So -- we have the "function expression" part of "immediately invoked function expression". To get the "immediately invoked" aspect, we call what the expression returns by adding another set of parentheses after the expression (just like we'd invoke any other function):</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png"><img class="alignnone size-full wp-image-531" alt="jsquirks_afjq_6" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6.png 656w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6-300x33.png 300w"></a></p>
<p>"But wait, Jim! I think I've seen this before with the invocation parentheses <em>inside</em> the expression parentheses". Indeed you probably have -- it's perfectly legal syntax (and is well known to be Douglas Crockford's preferred syntax):</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_7.png"><img class="alignnone size-full wp-image-561" alt="jsquirks_afjq_7" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_7.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_7.png 700w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_7-300x36.png 300w"></a></p>
<p>Either approach on where to put the invocation parentheses is usable, however I highly recommend reading <a href="https://github.com/airbnb/javascript/issues/21#issuecomment-10203921">one of the best explanations ever</a> on why &amp; when it could matter.</p>
<p>Ok, great -- now we know <em>what</em> an IIFE <em>is</em> -- why is it useful?</p>
<p>It helps us control <em>scope</em> -- an essential part of any JavaScript endeavor! The <code>marty</code> instance we've looked at earlier was created in the <em>global</em> scope. This means that the window (assuming we're in a browser), will have a <code>marty</code> property. If we write all of our JavaScript code this way, we'll quickly end up with a metric ton of vars declared in the global scope, polluting the window with our app's code. Even in the best case scenarios, it's bad practice to leak that many details into the global scope, but what happens when someone names a variable the same name as an <em>already existing</em> property on the window? It gets overwritten!</p>
<p>For example, if your favorite "Amelia Earhart" fan site declares a <code>navigator</code> variable in the global scope, this is a before and after look at what happens:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_8.png"><img class="alignnone size-full wp-image-571" alt="jsquirks_afjq_8" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_8.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_8.png 1290w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_8-300x65.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_8-1024x222.png 1024w"></a></p>
<p>OOPS!</p>
<p>Obviously -- polluting the global scope is <strong>bad</strong>. JavaScript utilizes <em>function scope</em> (not block scope, if you're coming from C# or Java, this is important!), so the way to keep our code from polluting the global scope is to create a <em>new</em> scope, and we can use an IIFE to do this since its contents will be inside its own function scope. In the example below, I'm showing you the <code>window.navigator</code> value in the console, and then I create an IIFE to wrap the behavior and data specific to Amelia Earhart. This IIFE happens to return an object that will serve as our "application namespace". Inside the IIFE I declare a <code>navigator</code> variable to show that it will <em>not</em> overwrite the window.navigator value.</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_9.png"><img class="alignnone size-full wp-image-581" alt="jsquirks_afjq_9" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_9.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_9.png 1372w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_9-300x132.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_9-1024x450.png 1024w"></a></p>
<p>As an added bonus, the IIFE we created above is the beginnings of a <a>module pattern</a> in JavaScript. I'll include some links at the end so you can explore module patterns further.</p>
<h2 id="typechecking">7.) The `typeof` Operator and `Object.prototype.toString`</h2>
<p>Eventually, you'll probably find yourself in a situation where you need to inspect the type of a value passed into a function, or something similar. The <code>typeof</code> operator might seem the obvious choice, however, it's not terribly helpful. For example, what happens when we call <code>typeof</code> on an object, an array, a string and a regular expression?</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_10.png"><img class="alignnone size-full wp-image-591" alt="jsquirks_afjq_10" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_10.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_10.png 422w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_10-300x231.png 300w"></a></p>
<p>Well -- at least we can tell our strings apart from objects, arrays and regular expressions, right? Thankfully, we can take a different approach to get more accurate information about type we're inspecting. We'll use the <code>Object.prototype.toString</code> function and apply our knowledge of the <code>call</code> method from earlier:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_11.png"><img class="alignnone size-full wp-image-601" alt="jsquirks_afjq_11" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_11.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_11.png 822w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_11-300x118.png 300w"></a></p>
<p>Why are we using the <code>toString</code> on <code>Object.prototype</code>? Because it's possible for 3rd party libraries, as well as your own code, to override the <code>toString</code> method with an instance method. By going to the <code>Object.prototype</code>, we can force the original <code>toString</code> behavior on an instance.</p>
<p>If you know what <code>typeof</code> will return and you don't need to check beyond what it will give you (for example, you just need to know if something is a string or not), then using <code>typeof</code> is perfectly fine. However, if you need to tell arrays from objects, regexes from objects, etc., use <code>Object.prototype.toString</code>.</p>
<h2>Where to Go Next</h2>
<p>I've benefitted tremendously from the insights of other JavaScript developers, so please check these links out and give these people a pat on the back for teaching the rest of us!</p>

            
        
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-04" name="t-04"></a><h1>04 : Named function expressions demystified</h1>
					<div class="tutorial__content">
<ol>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#expr-vs-decl">Function expressions vs. Function declarations</a></li>
        <li><a href="#function-statements">Function Statements</a></li>
        <li><a href="#named-expr">Named function expressions</a></li>
        <li><a href="#names-in-debuggers">Function names in debuggers</a></li>
        <li><a href="#jscript-bugs">JScript bugs</a></li>
        <li><a href="#jscript-memory-management">JScript memory management</a></li>
        <li><a href="#t-ests">Tests</a></li>
        <li><a href="#safari-bug">Safari bug</a></li>
        <li><a href="#spidermonkey-peculiarity">SpiderMonkey peculiarity</a></li>
        <li><a href="#solution">Solution</a></li>
        <li><a href="#alt-solution">Alternative solution</a></li>
        <li><a href="#webkit-displayName">WebKit's displayName</a></li>
        <li><a href="#future-considerations">Future considerations</a></li>
        <li><a href="#credits">Credits</a></li>
      </ol>

      <h2 id="introduction">Introduction</h2>

      <p>Surprisingly, a topic of named function expressions doesn't seem to be covered well enough on the web. This is probably why there are so many misconceptions floating around. In this article, I'll try to summarize both — theoretical and practical aspects of these wonderful Javascript constructs; the good, bad and ugly parts of them.</p>

      <p>In a nutshell, named function expressions are useful for one thing only — <strong>descriptive function names in debuggers and profilers</strong>. Well, there is also a possibility of using function names for recursion, but you will soon see that this is often impractical nowadays. If you don't care about debugging experience, you have nothing to worry about. Otherwise, read on to see some of the cross-browser glitches you would have to deal with and tips on how work around them.</p>

      <p>I'll start with a general explanation of what function expressions are how modern debuggers handle them. Feel free to skip to a <a href="#solution">final solution</a>, which explains how to use these constructs safely.</p>

      <h2 id="expr-vs-decl">Function expressions vs. Function declarations</h2>

      <p>One of the two most common ways to create a function object in ECMAScript is by means of either <em>Function Expression</em> or <em>Function Declaration</em>. The difference between two is <strong>rather confusing</strong>. At least it was to me. The only thing ECMA specs make clear is that <em>Function Declaration</em> must always have an <em>Identifier</em> (or a function name, if you prefer), and <em>Function Expression</em> may omit it:</p>

      <blockquote>
        <p>FunctionDeclaration :<br>
        function Identifier ( FormalParameterList <sub>opt</sub> ){ FunctionBody }</p>

        <p>FunctionExpression :<br>

        function Identifier <sub>opt</sub> ( FormalParameterList <sub>opt</sub> ){ FunctionBody }</p>
      </blockquote>

      <p>We can see that when identifier is omitted, that "something" can only be an expression. But what if identifier is present? How can one tell whether it is a function declaration or a function expression — they look identical after all? It appears that ECMAScript differentiates between two based on a context. If a <code>function foo(){}</code> is part of, say, assignment expression, it is considered a function expression. If, on the other hand, <code>function foo(){}</code> is contained in a function body or in a (top level of) program itself — it is parsed as a function declaration.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){}</span> <span class="c1">// declaration, since it's part of a &lt;em&gt;Program&lt;/em&gt;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){};</span> <span class="c1">// expression, since it's part of an &lt;em&gt;AssignmentExpression&lt;/em&gt;</span>

<span class="k">new</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">(){};</span> <span class="c1">// expression, since it's part of a &lt;em&gt;NewExpression&lt;/em&gt;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">function</span> <span class="nx">bar</span><span class="p">(){}</span> <span class="c1">// declaration, since it's part of a &lt;em&gt;FunctionBody&lt;/em&gt;</span>
<span class="p">})();</span></code></pre></div>

<p>A somewhat less obvious example of function expression is the one where function is wrapped with parenthesis — <code>(function foo(){})</code>. The reason it is an expression is again due to a context: "(" and ")" constitute a grouping operator and grouping operator can only contain an expression:</p>

<p>To demonstrate with examples:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){}</span> <span class="c1">// function declaration</span>
<span class="p">(</span><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){});</span> <span class="c1">// function expression: due to grouping operator</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// grouping operator can only contain expression, not a statement (which `var` is)</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// SyntaxError</span>
<span class="p">}</span></code></pre></div>

<p>You might also recall that when evaluating JSON with <code>eval</code>, the string is usually wrapped with parenthesis — <code>eval('(' + json + ')')</code>. This is of course done for the same reason — grouping operator, which parenthesis are, forces JSON brackets to be parsed as expression rather than as a block:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="p">{</span> <span class="s2">"x"</span><span class="o">:</span> <span class="mi">5</span> <span class="p">};</span> <span class="c1">// "{" and "}" are parsed as a block</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// SyntaxError</span>
<span class="p">}</span>

<span class="p">({</span> <span class="s2">"x"</span><span class="o">:</span> <span class="mi">5</span> <span class="p">});</span> <span class="c1">// grouping operator forces "{" and "}" to be parsed as object literal</span></code></pre></div>

      <p>There's a subtle difference in behavior of declarations and expressions.</p>

      <p>First of all, function declarations are parsed and evaluated before any other expressions are. Even if declaration is positioned last in a source, it will be evaluated <strong>foremost any other expressions</strong> contained in a scope. The following example demonstrates how <code>fn</code> function is already defined by the time <code>alert</code> is executed, even though it's being declared right after it:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">alert</span><span class="p">(</span><span class="nx">fn</span><span class="p">());</span>

<span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s1">'Hello world!'</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

      <p>Another important trait of function declarations is that declaring them conditionally is non-standardized and varies across different environments. You should never rely on functions being declared conditionally and use function expressions instead.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Never do this!</span>
<span class="c1">// Some browsers will declare `foo` as the one returning 'first',</span>
<span class="c1">// while others — returning 'second'</span>

<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'first'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'second'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Instead, use function expressions:</span>
<span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'first'</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'second'</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span></code></pre></div>

      <p>If you're curious about actual production rules of function declarations, read on. Otherwise, feel free to skip the following excerpt.</p>

      <div id="function-declarations-in-blocks" class="well bg-success">
        <p>
          <em>FunctionDeclaration</em>s are only allowed to appear in <em>Program</em> or <em>FunctionBody</em>.
          Syntactically, they <strong>can not appear in <em>Block</em></strong> (<code>{ ... }</code>) — such as that of <code>if</code>,
          <code>while</code> or <code>for</code> statements. This is because <em>Block</em>s can only contain <em>Statement</em>s,
          not <em>SourceElement</em>s, which <em>FunctionDeclaration</em> is.
          If we look at production rules carefully, we can see that the only way <em>Expression</em> is allowed directly within <em>Block</em>
          is when it is part of <em>ExpressionStatement</em>. However, <em>ExpressionStatement</em> is explicitly defined
          <strong>to not begin with "function" keyword</strong>, and this is exactly why <em>FunctionDeclaration</em> cannot appear directly within a <em>Statement</em> or <em>Block</em> (note that <em>Block</em> is merely a list of <em>Statement</em>s).
        </p>
        <p>
          Because of these restrictions, whenever function appears directly in a block (such as in the previous example) it should actually be
          <strong>considered a syntax error</strong>, not function declaration or expression. The problem is that almost none of the
          implementations I've seen parse these functions strictly per rules (exceptions are <a href="http://sourceforge.net/projects/besen/">BESEN</a> and <a href="http://www.digitalmars.com/dscript/">DMDScript</a>). They interpret them in proprietary ways instead.
        </p>
      </div>

      <p>It's worth mentioning that as per specification, implementations are allowed to introduce <strong>syntax extensions</strong> (see section 16), yet still be fully conforming. This is exactly what happens in so many clients these days. Some of them interpret function declarations in blocks as any other function declarations — simply hoisting them to the top of the enclosing scope; Others — introduce different semantics and follow slightly more complex rules.</p>

      <h2 id="function-statements">Function statements</h2>

      <div>
        <p>
          One of such syntax extensions to ECMAScript is <strong>Function Statements</strong>,
          currently implemented in Gecko-based browsers (tested in Firefox 1-3.7a1pre on Mac OS X).
          Somehow, this extension doesn't seem to be widely known, either for good or bad (<a href="https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference:Functions#Conditionally_defining_a_function">MDC mentions them</a>, but very briefly).
          Please remember, that we are discussing it here only for learning purposes and to satisfy our curiosity;
          unless you're writing scripts for specific Gecko-based environment,
          <strong>I do not recommend relying on this extension</strong>.
        </p>

        <p>
          So, here are some of the traits of these non-standard constructs:
        </p>

        <ol>
          <li>Function statements are allowed to be anywhere where plain <em>Statement</em>s are allowed. This, of course, includes <em>Block</em>s:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(){</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(){</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>
        </li>
          <li>Function statements are interpreted as any other statements, including conditional execution:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 1</span>
<span class="c1">// Note that other clients interpet `foo` as function declaration here,</span>
<span class="c1">// overwriting first `foo` with the second one, and producing "2", not "1" as a result</span></code></pre></div>
        </li>
        <li>
          Function statements are NOT declared during variable instantiation. They are declared at run time, just like function expressions.
          However, once declared, function statement's identifier <strong>becomes available to the entire scope</strong> of the function.
          This identifier availability is what makes function statements different from function expressions (you will see exact behavior of named function expressions in next chapter).
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// at this point, `foo` is not yet declared</span>
<span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// "undefined"</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// once block is entered, `foo` becomes declared and available to the entire scope</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="c1">// this block is never entered, and `foo` is never redeclared</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// "function"</span></code></pre></div>
  Generally, we can emulate function statements behavior from the previous example with this standards-compliant (and unfortunately, more verbose) code:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">};</span>
<span class="p">}</span></code></pre></div>
        </li>
        <li>
          String representation of functions statements is similar to that of function declarations or named function expressions (and includes identifier — "foo" in this example):
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nb">String</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// function foo() { return 1; }</span></code></pre></div>
        </li>
        <li>
Finally, what appears to be a bug in earlier Gecko-based implementations (present in &lt;= Firefox 3), is the way function statements overwrite function declarations. Earlier versions were somehow failing to overwrite function declarations with function statements:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// function declaration</span>
<span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// overwritting with function statement</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 1 in FF&lt;= 3, 2 in FF3.5 and later</span>

<span class="c1">// however, this doesn't happen when overwriting function expression</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 2 in all versions</span></code></pre></div>
        </li>
        </ol>
        <p id="function-statements-in-safari">
          Note that older Safari (at least 1.2.3, 2.0 - 2.0.4 and 3.0.4, and possibly earlier versions too) implement function statements <strong>identically to SpiderMonkey</strong>.
          All examples from this chapter, except the last "bug" one, produce same results in those versions of Safari as they do in, say, Firefox. Another browser that seems to
          follow same semantics is Blackberry one (at least 8230, 9000 and 9530 models). This diversity in behavior demonstrates once again what a bad idea it is to rely on these extensions.
        </p>
      </div>

      <h2 id="named-expr">Named function expressions</h2>

      <p>Function expressions can actually be seen quite often. A common pattern in web development is to "fork" function definitions based on some kind of a feature test, allowing for the best performance. Since such forking usually happens in the same scope, it is almost always necessary to use function expressions. After all, as we know by now, function declarations should not be executed conditionally:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// `contains` is part of "APE Javascript library" (http://dhtmlkitchen.com/ape/) by Garrett Smith</span>
<span class="kd">var</span> <span class="nx">contains</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">compareDocumentPosition</span> <span class="o">!=</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">contains</span> <span class="o">!=</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">el</span> <span class="o">!==</span> <span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">el</span> <span class="o">!=</span> <span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">el</span> <span class="o">===</span> <span class="nx">b</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">})();</span></code></pre></div>

<p>Quite obviously, when a function expression has a name (technically — <em>Identifier</em>), it is called a <strong>named function expression</strong>. What you've seen in the very first example — <code>var bar = function foo(){};</code> — was exactly that — a named function expression with <code>foo</code> being a function name. An important detail to remember is that this name is <strong>only available in the scope of a newly-defined function</strong>; specs mandate that an identifier should not be available to an enclosing scope:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// "foo" is available in this inner scope</span>
<span class="p">};</span>
<span class="c1">// `foo` is never visible "outside"</span>
<span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// "undefined"</span>
<span class="nx">f</span><span class="p">();</span> <span class="c1">// "function"</span></code></pre></div>

      <p>So what's so special about these named function expressions? Why would we want to give them names at all? </p>

      <p>It appears that named functions make for a much more pleasant debugging experience. When debugging an application, having a call stack with descriptive items makes a huge difference.</p>

      <h2 id="names-in-debuggers">Function names in debuggers</h2>

      <p>When a function has a corresponding identifier, debuggers show that identifier as a function name, when inspecting call stack. Some debuggers (e.g. Firebug) helpfully show names of even anonymous functions — making them identical to names of variables that functions are assigned to. Unfortunately, these debuggers usually rely on simple parsing rules; Such extraction is usually quite fragile and often produces false results. </p>

      <p>Let's look at a simple example:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">bar</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Here, we used function declarations when defining all of 3 functions</span>
<span class="c1">// When debugger stops at the `debugger` statement,</span>
<span class="c1">// the call stack (in Firebug) looks quite descriptive:</span>
<span class="nx">baz</span>
<span class="nx">bar</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>We can see that <code>foo</code> called <code>bar</code> which in its turn called <code>baz</code> (and that <code>foo</code> itself was called from the global scope of <code>expr_test.html</code> document). What's really nice, is that Firebug manages to parse the "name" of a function even when an anonymous expression is used:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Call stack</span>
<span class="nx">baz</span>
<span class="nx">bar</span><span class="p">()</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>What's not very nice, though, is that if a function expression gets any more complex (which, in real life, it almost always is) all of the debugger's efforts turn out to be pretty useless; we end up with a shiny question mark in place of a function name:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">})();</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Call stack</span>
<span class="nx">baz</span>
<span class="p">(</span><span class="o">?</span><span class="p">)()</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>Another confusion appears when a function is being assigned to more than one variable:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">baz</span> <span class="o">=</span> <span class="nx">bar</span><span class="p">;</span>
<span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">'spoofed'</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Call stack:</span>
<span class="nx">bar</span><span class="p">()</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>You can see call stack showing that <code>foo</code> invoked <code>bar</code>. Clearly, that's not what has happened. The confusion is due to the fact that <code>baz</code> was "exchanged" references with another function — the one alerting "spoofed". As you can see, such parsing — while great in simple cases — is often useless in any non-trivial script. </p>

      <p>What it all boils down to is the fact that named <strong>function expressions is the only way to get a truly robust stack inspection</strong>. Let's rewrite our previous example with named functions in mind. Notice how both of the functions returning from self-executing wrapper, are named as <code>bar</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">})();</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// And, once again, we have a descriptive call stack!</span>
<span class="nx">baz</span>
<span class="nx">bar</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>Before we start dancing happily celebrating this holy grail finding, I'd like to bring a beloved JScript into the picture.</p>

      <h2 id="jscript-bugs">JScript bugs</h2>

      <p>Unfortunately, JScript (i.e. Internet Explorer's ECMAScript implementation) seriously messed up named function expressions. JScript is responsible for named function expressions <strong>being recommended against</strong> by many people these days. It's also quite sad that even <strong>last version of JScript — 5.8 — used in Internet Explorer 8, still exhibits every single quirk described below</strong></p>

      <p>Let's look at what exactly is wrong with its broken implementation. Understanding all of its issues will allow us to work around them safely. Note that I broke these discrepancies into few examples — for clarity — even though all of them are most likely a consequence of one major bug.</p>

      <h3 id="example_1_function_expression_identifier_leaks_into_an_enclosing_scope">Example #1: Function expression identifier leaks into an enclosing scope</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
<span class="k">typeof</span> <span class="nx">g</span><span class="p">;</span> <span class="c1">// "function"</span></code></pre></div>

      <p>Remember how I mentioned that an identifier of named function expression is <strong>not available in an enclosing scope</strong>? Well, JScript doesn't agree with specs on this one — <code>g</code> in the above example resolves to a function object. This is a most widely observed discrepancy. It's dangerous in that it inadvertedly pollutes an enclosing scope — a scope that might as well be a global one — with an extra identifier. Such pollution can, of course, be a source of hard-to-track bugs.</p>

      <h3 id="example_2_named_function_expression_is_treated_as_both_function_declaration_and_function_expression">Example #2: Named function expression is treated as BOTH — function declaration AND function expression</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">typeof</span> <span class="nx">g</span><span class="p">;</span> <span class="c1">// "function"</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span></code></pre></div>

      <p>As I explained before, function declarations are parsed foremost any other expressions in a particular execution context. The above example demonstrates how <strong>JScript actually treats named function expressions as function declarations</strong>. You can see that it parses <code>g</code> before an "actual declaration" takes place. </p>

      <p>This brings us to a next example:</p>

      <h3 id="example_3_named_function_expression_creates_two_distinct_function_objects">Example #3: Named function expression creates TWO DISTINCT function objects!</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
<span class="nx">f</span> <span class="o">===</span> <span class="nx">g</span><span class="p">;</span> <span class="c1">// false</span>

<span class="nx">f</span><span class="p">.</span><span class="nx">expando</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">expando</span><span class="p">;</span> <span class="c1">// undefined</span></code></pre></div>

      <p>This is where things are getting interesting. Or rather — completely nuts. Here we are seeing the dangers of having to deal with two distinct objects — augmenting one of them obviously does not modify the other one; This could be quite troublesome if you decided to employ, say, caching mechanism and store something in a property of <code>f</code>, then tried accessing it as a property of <code>g</code>, thinking that it is the same object you're working with.</p>

      <p>Let's look at something a bit more complex.</p>

      <h3 id="example_4_function_declarations_are_parsed_sequentially_and_are_not_affected_by_conditional_blocks">Example #4: Function declarations are parsed sequentially and are not affected by conditional blocks</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="nx">g</span><span class="p">();</span> <span class="c1">// 2</span></code></pre></div>

      <p>An example like this could cause even harder to track bugs. What happens here is actually quite simple. First, <code>g</code> is being parsed as a function declaration, and since declarations in JScript are independent of conditional blocks, <code>g</code> is being declared as a function from the "dead" <code>if</code> branch — <code>function g(){ return 2 }</code>. Then all of the "regular" expressions are being evaluated and <code>f</code> is being assigned another, newly created function object to. "dead" <code>if</code> branch is never entered when evaluating expressions, so <code>f</code> keeps referencing first function — <code>function g(){ return 1 }</code>. It should be clear by now, that if you're not careful enough, and call <code>g</code> from within <code>f</code>, you'll end up calling a completely unrelated <code>g</code> function object.</p>

      <p>You might be wondering how all this mess with different function objects compares to <code>arguments.callee</code>. Does <code>callee</code> reference <code>f</code> or <code>g</code>? Let's take a look:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span> <span class="o">==</span> <span class="nx">f</span><span class="p">,</span>
    <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span> <span class="o">==</span> <span class="nx">g</span>
  <span class="p">];</span>
<span class="p">};</span>
<span class="nx">f</span><span class="p">();</span> <span class="c1">// [true, false]</span>
<span class="nx">g</span><span class="p">();</span> <span class="c1">// [false, true]</span></code></pre></div>

      <p>As you can see, <code>arguments.callee</code> references whatever function is being invoked. This is actually good news, as you will see later on.</p>

      <p>Another interesting example of "unexpected behavior" can be observed when using named <strong>function expression in undeclared assignment</strong>, but only when function is "named" the same way as identifier it's being assigned to:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
<span class="p">})();</span></code></pre></div>
      <p>As you might know, undeclared assignment (which is <strong>not recommended</strong> and is only used here for demonstration purposes) should result in creation of global <code>f</code> property. This is exactly what happens in conforming implementations. However, JScript bug makes things a bit more confusing. Since named function expression is parsed as function declaration (see <a href="#example_2_named_function_expression_is_treated_as_both_function_declaration_and_function_expression">example #2</a>), what happens here is that <code>f</code> becomes declared as a local variable during the phase of variable declarations. Later on, when function execution begins, assignment is no longer undeclared, so <code>function f(){}</code> on the right hand side is simply assigned to this newly created <strong>local</strong> <code>f</code> variable. Global <code>f</code> is never created.</p>

      <p>This demonstrates how failing to understand JScript peculiarities can lead to drastically different behavior in code.</p>

      <p>Looking at JScript deficiencies, it becomes pretty clear what exactly we need to avoid. First, we need <strong>to be aware of a leaking identifier</strong> (so that it doesn't pollute enclosing scope). Second, we should <strong>never reference identifier used as a function name</strong>; A troublesome identifier is <code>g</code> from the previous examples. Notice how many ambiguities could have been avoided if we were to forget about <code>g</code>'s existance. Always referencing function via <code>f</code> or <code>arguments.callee</code> is the key here. If you use named expression, think of that name as something that's only being used for debugging purposes. And finally, a bonus point is to <strong>always clean up an extraneous function</strong> created erroneously during NFE declaration.</p>

      <p>I think last point needs a bit of an explanation:</p>

      <h2 id="jscript-memory-management">JScript memory management</h2>

      <p>Being familiar with JScript discrepancies, we can now see a potential problem with memory consumption when using these buggy constructs. Let's look at a simple example:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
<span class="p">})();</span></code></pre></div>

      <p>We know that a function returned from within this anonymous invocation — the one that has <code>g</code> identifier — is being assigned to outer <code>f</code>. We also know that named function expressions produce superfluous function object, and that this object is not the same as returned function. The memory issue here is caused by this extraneous <code>g</code> function being literally "trapped" in a closure of returning function. This happens because inner function is declared in the same scope as that pesky <code>g</code> one. Unless we <strong>explicitly break reference to <code>g</code> function</strong> it will keep consuming memory.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">g</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="c1">// null `g`, so that it doesn't reference extraneous function any longer</span>
  <span class="nx">g</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>Note that we explicitly declare <code>g</code> as well, so that <code>g = null</code> assignment wouldn't create a global <code>g</code> variable in conforming clients (i.e. non-JScript ones). By <code>null</code>ing reference to <code>g</code>, we allow garbage collector to wipe off this implicitly created function object that <code>g</code> refers to.</p>

      <p>When taking care of JScript NFE memory leak, I decided to run a simple series of tests to confirm that <code>null</code>ing <code>g</code> actually does free memory.</p>

      <h2 id="tests">Tests</h2>

      <p>The test was simple. It would simply create 10000 functions via named function expressions and store them in an array. I would then wait for about a minute and check how high the memory consumption is. After that I would null-out the reference and repeat the procedure again. Here's a test case I used:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">createFn</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span>
        <span class="k">return</span> <span class="s1">'standard'</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span>
        <span class="k">return</span> <span class="s1">'alternative'</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span>
        <span class="k">return</span> <span class="s1">'fallback'</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="c1">// var F = null;</span>
    <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
  <span class="p">})();</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">createFn</span><span class="p">();</span>
<span class="p">}</span></code></pre></div>

      <p>Results as seen in Process Explorer on Windows XP SP2 were:</p>

<pre>  IE6:

    without `null`:   7.6K -&gt; 20.3K
    with `null`:      7.6K -&gt; 18K

  IE7:

    without `null`:   14K -&gt; 29.7K
    with `null`:      14K -&gt; 27K
</pre>

      <p>The results somewhat confirmed my assumptions — explicitly nulling superfluous reference did free memory, but the difference in consumption was relatively insignificant. For 10000 function objects, there would be a ~3MB difference. This is definitely something that should be kept in mind when designing large-scale applications, applications that will run for either long time or on devices with limited memory (such as mobile devices). For any small script, the difference probably doesn't matter.</p>

      <p>You might think that it's all finally over, but we are not just quite there yet :) There's a tiny little detail that I'd like to mention and that detail is Safari 2.x</p>

      <h2 id="safari-bug">Safari bug</h2>

      <p>
      Even less widely known bug with NFE is present in older versions of Safari; namely, Safari 2.x series. I've seen some <a href="http://meyerweb.com/eric/thoughts/2005/07/11/safari-syntaxerror/">claims on the web</a> that Safari 2.x does not support NFE at all. This is not true. Safari does support it, but has bugs in its implementation which you will see shortly.</p>

      <p>When encountering function expression in a certain context, Safari 2.x fails to parse the program entirely. It doesn't throw any errors (such as <code>SyntaxError</code> ones). It simply bails out:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(){})();</span> <span class="c1">// &lt;== NFE</span>
<span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// this line is never reached, since previous expression fails the entire program</span></code></pre></div>

      <p>After fiddling with various test cases, I came to conclusion that Safari 2.x <strong>fails to parse named function expressions, if those are not part of assignment expressions</strong>. Some examples of assignment expressions are:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// part of variable declaration</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// part of simple assignment</span>
<span class="nx">f</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">g</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// part of return statement</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">})();</span></code></pre></div>

      <p>This means that putting named function expression into an assignment makes Safari "happy":</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span> <span class="c1">// fails</span>

<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span> <span class="c1">// works</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span> <span class="c1">// fails</span>
<span class="p">})();</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span> <span class="c1">// works</span>
<span class="p">})();</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(){</span> <span class="p">},</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// fails</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">say</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">say</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="c1">// fails</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">say</span><span class="p">(){</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">// works</span></code></pre></div>

      <p>It also means that we can't use such common pattern as returning named function expression without an assignment:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Instead of this non-Safari-2x-compatible syntax:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
<span class="p">})();</span>

<span class="c1">// we should use this slightly more verbose alternative:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
<span class="p">})();</span>

<span class="c1">// or another variation of it:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
<span class="p">})();</span>

<span class="cm">/*</span>
<span class="cm">  Unfortunately, by doing so, we introduce an extra reference to a function</span>
<span class="cm">  which gets trapped in a closure of returning function. To prevent extra memory usage,</span>
<span class="cm">  we can assign all named function expressions to one single variable.</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">__temp</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
<span class="p">})();</span>

<span class="p">...</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){});</span>
<span class="p">})();</span>

<span class="cm">/*</span>
<span class="cm">  Note that subsequent assignments destroy previous references,</span>
<span class="cm">  preventing any excessive memory usage.</span>
<span class="cm">*/</span></code></pre></div>

      <p>If Safari 2.x compatibility is important, we need to make sure <strong>"incompatible" constructs do not even appear in the source</strong>. This is of course quite irritating, but is definitely possible to achieve, especially when knowing the root of the problem.</p>

      <p>It's also worth mentioning that declaring a function as NFE in Safari 2.x exhibits another minor glitch, where function representation does not contain function identifier:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>

<span class="c1">// Notice how function representation is lacking `g` identifier</span>
<span class="nb">String</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span> <span class="c1">// function () { }</span></code></pre></div>

      <p>This is not really a big deal. As I have already mentioned before, function decompilation is something that <a href="http://perfectionkills.com/those-tricky-functions/">should not be relied upon</a> anyway. </p>

      <h2 id="spidermonkey-peculiarity">SpiderMonkey peculiarity</h2>

      <p>
        We know that identifier of named function expression is only available to the local scope of a function.
        But how does this "magic" scoping actually happen? It appears to be very simple.
        When named function expression is evaluated, a <strong>special object is created</strong>.
        The sole purpose of that object is to hold a property with the name corresponding to function identifier, and value corresponding to function itself.
        That object is then injected into the front of the current scope chain, and this "augmented" scope chain is then used to initialize a function.
      </p>

      <p>
        The interesting part here, however, is the way ECMA-262 defines this "special" object — the one that holds function identifier.
        Spec says that an object is created <strong>"as if by expression new Object()"</strong> which, when interpreted literally,
        makes this object an instance of built-in <code>Object</code> constructor. However, only one implementation — SpiderMonkey —
        followed this specification requirement literally. In SpiderMonkey, it is possible to interfere with function local variables by augmenting <code>Object.prototype</code>:
      </p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="s1">'outer'</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">'inner'</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">    `foo` function here has a special object in its scope chain — to hold an identifier. That object is practically a —</span>
<span class="cm">    `{ foo: &lt;function object&gt; }`. When `x` is being resolved through the scope chain, it is first searched for in</span>
<span class="cm">    `foo`'s local context. When not found, it is searched in the next object from the scope chain. That object turns out</span>
<span class="cm">    to be the one that holds identifier — { foo: &lt;function object&gt; } and since it inherits from `Object.prototype`,</span>
<span class="cm">    `x` is found right here, and is the one that's `Object.prototype.x` (with value of 'outer'). Outer function's scope</span>
<span class="cm">    (with x === 'inner') is never even reached.</span>
<span class="cm">  */</span>

  <span class="p">(</span><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>

    <span class="nx">alert</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// alerts `outer`</span>

  <span class="p">})();</span>
<span class="p">})();</span></code></pre></div>

<p>
  Note that later versions of SpiderMonkey actually <strong>changed this behavior</strong>,
  as it was probably considered a security hole. A "special" object no longer inherits from <code>Object.prototype</code>.
  You can, however, still see it in Firefox &lt;=3.
</p>

<p id="activation-object-in-blackberry-browser">
  Another environment implementing internal object as an instance of global <code>Object</code> is <strong>Blackberry browser</strong>.
  Only this time, it's <em>Activation Object</em> that inherits from <code>Object.prototype</code>. Note that specification actually
  doesn't codify <em>Activation Object</em> to be created "as if by expression new Object()" (as is the case with NFE's identifier holder object).
  It states that <em>Activation Object</em> is merely a specification mechanism.
</p>

<p>So, let's see what happens in Blackberry browser:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="s1">'outer'</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">'inner'</span><span class="p">;</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

    <span class="cm">/*</span>
<span class="cm">    When `x` is being resolved against scope chain, this local function's Activation Object is searched first.</span>
<span class="cm">    There's no `x` in it, of course. However, since Activation Object inherits from `Object.prototype`, it is</span>
<span class="cm">    `Object.prototype` that's being searched for `x` next. `Object.prototype.x` does in fact exist and so `x`</span>
<span class="cm">    resolves to its value — 'outer'. As in the previous example, outer function's scope (Activation Object)</span>
<span class="cm">    with its own x === 'inner' is never even reached.</span>
<span class="cm">    */</span>

    <span class="nx">alert</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// alerts 'outer'</span>

  <span class="p">})();</span>
<span class="p">})();</span></code></pre></div>

<p>
  This might look bizarre, but what's really disturbing is that there's even more chance of conflict with
  already existing <code>Object.prototype</code> members:
</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">constructor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

    <span class="nx">constructor</span><span class="p">();</span> <span class="c1">// evaluates to an object `{ }`, not `1`</span>

    <span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span> <span class="c1">// true</span>
    <span class="nx">toString</span> <span class="o">===</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span> <span class="c1">// true</span>

    <span class="c1">// etc.</span>

  <span class="p">})();</span>
<span class="p">})();</span></code></pre></div>

<p>
  Solution to this Blackberry discrepancy is obvious: avoid naming variables as <code>Object.prototype</code> properties
  — <code>toString</code>, <code>valueOf</code>, <code>hasOwnProperty</code>, and so on.
</p>

      <h2 id="solution">JScript solution</h2>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="c1">// declare a variable to assign function object to</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>

  <span class="c1">// conditionally create a named function</span>
  <span class="c1">// and assign its reference to `f`</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span> <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span> <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span> <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Assign `null` to a variable corresponding to a function name</span>
  <span class="c1">// This marks the function object (referred to by that identifier)</span>
  <span class="c1">// available for garbage collection</span>
  <span class="kd">var</span> <span class="nx">F</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="c1">// return a conditionally defined function</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>Finally, here's how we would apply this "techinque" in real life, when writing something like a cross-browser <code>addEvent</code> function:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 1) enclose declaration with a separate scope</span>
<span class="kd">var</span> <span class="nx">addEvent</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

  <span class="c1">// 2) declare a variable to assign function to</span>
  <span class="kd">var</span> <span class="nx">fn</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">docEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 3) make sure to give function a descriptive identifier</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">addEvent</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">docEl</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">addEvent</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">'on'</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">addEvent</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">[</span><span class="s1">'on'</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 4) clean up `addEvent` function created by JScript</span>
  <span class="c1">//    make sure to either prepend assignment with `var`,</span>
  <span class="c1">//    or declare `addEvent` at the top of the function</span>
  <span class="kd">var</span> <span class="nx">addEvent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="c1">// 5) finally return function referenced by `fn`</span>
  <span class="k">return</span> <span class="nx">fn</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <h2 id="alt-solution">Alternative solution</h2>

      <p>It's worth mentioning that there actually exist alternative ways of having descriptive names in call stacks. Ways that don't require one to use named function expressions. First of all, it is often possible to define function via declaration, rather than via expression. This option is only viable when you don't need to create more than one function:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">hasClassName</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="c1">// define some private variables</span>
  <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>

  <span class="c1">// use function declaration</span>
  <span class="kd">function</span> <span class="nx">hasClassName</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_className</span> <span class="o">=</span> <span class="s1">'(?:^|\\s+)'</span> <span class="o">+</span> <span class="nx">className</span> <span class="o">+</span> <span class="s1">'(?:\\s+|$)'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">_className</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">_className</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">_className</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">className</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// return function</span>
  <span class="k">return</span> <span class="nx">hasClassName</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>This obviously wouldn't work when forking function definitions. Nevertheless, there's an interesting pattern that I first seen used by <a href="http://tobielangel.com/">Tobie Langel</a>. The way it works is by <strong>defining all functions upfront using function declarations, but giving them slightly different identifiers</strong>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">addEvent</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">addEventListener</span><span class="p">(){</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">attachEvent</span><span class="p">(){</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">addEventAsProperty</span><span class="p">(){</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">!=</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">addEventListener</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">attachEvent</span> <span class="o">!=</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">attachEvent</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">addEventAsProperty</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>While it's an elegant approach, it has its own drawbacks. First, by using different identifiers, you lose naming consistency. Whether it's good or bad thing is not very clear. Some might prefer to have identical names, while others wouldn't mind varying ones; after all, different names can often "speak" about implementation used. For example, seeing "attachEvent" in debugger, would let you know that it is an <code>attachEvent</code>-based implementation of <code>addEvent</code>. On the other hand, implementation-related name might not be meaningful at all. If you're providing an API and name "inner" functions in such way, the user of API could easily get lost in all of these implementation details. </p>

      <p>A solution to this problem might be to employ different naming convention. Just be careful not to introduce extra verbosity. Some alternatives that come to mind are:</p>

<pre>  `addEvent`, `altAddEvent` and `fallbackAddEvent`
  // or
  `addEvent`, `addEvent2`, `addEvent3`
  // or
  `addEvent_addEventListener`, `addEvent_attachEvent`, `addEvent_asProperty`
</pre>

      <p>Another minor issue with this pattern is increased memory consumption. By defining all of the function variations upfront, you implicitly create N-1 unused functions. As you can see, if <code>attachEvent</code> is found in <code>document.documentElement</code>, then neither <code>addEventListener</code> nor <code>addEventAsProperty</code> are ever really used. Yet, they already consume memory; memory which is never deallocated for the same reason as with JScript's buggy named expressions — both functions are "trapped" in a closure of returning one. </p>

      <p>This increased consumption is of course hardly an issue. If a library such as Prototype.js was to use this pattern, there would be not more than 100-200 extra function objects created. As long as functions are not created in such way repeatedly (at runtime) but only once (at load time), you probably shouldn't worry about it.</p>

      <h2 id="webkit-displayName">WebKit's displayName</h2>

      <p>A somewhat different approach was taken by WebKit team. Frustrated with poor representation of functions — both, anonymous and named — WebKit introduced "special" <code>displayName</code> property (essentially a string) that when assigned to a function is displayed in debugger/profiler in place of that function's "name". <a href="http://www.alertdebugging.com/2009/04/29/building-a-better-javascript-profiler-with-webkit/">Francisco Tolmasky explains in details</a> the rationale and implementation of this solution.</p>

      <h2 id="future-considerations">Future considerations</h2>

      <p>Upcoming version of ECMAScript — <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" title="Standard ECMA-262">ECMA-262, 5th edition</a> — introduces so-called <strong>strict mode</strong>. The purpose of strict mode is to disallow certain parts of the language which are considered to be fragile, unreliable or dangerous. One of such parts is <code>arguments.callee</code>, "banned" presumably due to security concerns. When in strict mode, access to <code>arguments.callee</code> results in <code>TypeError</code> (see section 10.6). The reason I'm bringing up strict mode is because inability to use <code>arguments.callee</code> for recursion in 5th edition will most likely result in increased use of named function expressions. Understanding their semantics and bugs will become even more important.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Before, you could use arguments.callee</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">})(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// In strict mode, an alternative solution is to use named function expression</span>
<span class="p">(</span><span class="kd">function</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">})(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// or just fall back to slightly less flexible function declaration</span>
<span class="kd">function</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">factorial</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span></code></pre></div>

      <h2 id="credits">Credits</h2>

      <p><strong><em>Richard Cornford</em></strong>, for being one of the first people <a href="http://groups.google.com/group/comp.lang.javascript/msg/5b508b03b004bce8">to explain JScript bug with named function expressions</a>. Richard explains most of the bugs mentioned in this article. I highly recommend reading his explanation. I would also like to thank <strong><em>Yann-Erwan Perio</em></strong> and <strong><em>Douglas Crockford</em></strong> for <a href="http://groups.google.com/group/comp.lang.javascript/msg/03d53d114d176323">mentioning and discussing NFE issues in comp.lang.javascript</a> as far back as in 2003.</p>

      <p><strong><em>John-David Dalton</em></strong>, for giving useful suggestions about "final solution".</p>

      <p><strong><em>Tobie Langel</em></strong>, for ideas presented in "alternative solution".</p>

      <p><strong><em>Garrett Smith</em></strong> and <strong><em>Dmitry A. Soshnikov</em></strong> for various additions and corrections.</p>

      <p>For an extensive explanation of functions in ECMAScript in Russian, see <a href="http://dmitrysoshnikov.com/ecmascript/ru-chapter-5-functions/">this article by Dmitry A. Soshnikov</a>.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-05" name="t-05"></a><h1>05 : "Real" Mixins with JavaScript Classes</h1>
					<div class="tutorial__content">
 <h2 id="mixinsandjavascriptthegoodthebadandtheugly">Mixins and Javascript: The Good, the Bad, and the Ugly.</h2>

<p>Mixins and JavaScript are a like the classic Clint Eastwood movie.</p>

<p>The good is that composing objects out of small pieces of implementation is even possible due to JavaScript's flexible nature, and that mixins are fairly popular in certain circles.</p>

<p>The bad is a long list: there's no common idea of what the concept of a mixin even is in JavaScript; there's no common pattern for them; they require helper libraries to use; more advanced composition (like coordination between mixins and prototypes) is complicated and does not fall out naturally from the patterns; they're difficult to statically analyze and introspect; finally, most mixin libraries mutate objects or their prototypes, causing problems for VMs and some programmers to avoid them.</p>

<p>The ugly is that the result of all this is a balkanized ecosystem of mixin libraries and mixins, with often incompatible construction and semantics across libraries. As far as I can tell, no particular library is popular enough to even be called common. You're more likely to see a project implement its own mixin function than see a mixin library used.</p>

<p>JavaScript mixins so far have simply fallen well short of their potential, of how mixins are described in academic literature and even implemented in a few good languages.</p>

<p>For someone who loves mixins, and thinks they should be used as much as possible, this is terrible. Mixins solve a number of issues that single-inheritance languages have, and to me, most of the complaints that the prototypal crowd has against classes in JavaScript. I would argue all inheritance should be mixin inheritance - subclassing is just a degenerate form of mixin application.</p>

<p>Luckily, there's light at the end of the tunnel with JavaScript classes. Their arrival finally gives JavaScript very easy to use syntax for inheritance. JavaScript classes are more powerful than most people realize, and are a great foundation for building <em>real</em> mixins.</p>

<p>In this post I'll explore what mixins should do, what's wrong with current JavaScript mixins, and how simple it is to build a very capable mixin system in JavaScript that plays extremely well with classes.</p>

<h2 id="whatexactlyaremixins">What, Exactly, are Mixins?</h2>

<p>To understand what a mixin implementation should do, let's first look at what mixins are:</p>

<blockquote>
  <p>A mixin is an abstract subclass; i.e. a subclass definition that may be applied to different superclasses to create a related family of modified classes.</p>
  
  <p><cite>Gilad Bracha and William Cook, <a href="http://www.bracha.org/oopsla90.pdf">Mixin-based Inheritance</a></cite></p>
</blockquote>

<p>This is the best definition of mixins I've been able to find. It clearly shows the difference between a mixin and a normal class, and strongly hints at how mixins can be implemented in JavaScript.</p>

<p>To dig deeper into the implications of this definition, let's add two terms to our mixin lexicon:</p>

<ul>
<li><em>mixin definition</em>: The definition of a class that may be applied to different superclasses.</li>
<li><em>mixin application</em>: The application of a mixin definition to a specific superclass, producing a new subclass.</li>
</ul>

<p>The mixin definition is really a <em>subclass factory</em>, parameterized by the superclass, which produces mixin applications. A mixin application sits in the inheritance hierarchy between the subclass and superclass.</p>

<p>The real, and only, difference between a mixin and normal subclass is that a normal subclass has a fixed superclass, while a mixin definition doesn't yet have a superclass. Only the <em>mixin applications</em> have their own superclasses. You can even look at normal subclass inheritance as a degenerate form of mixin inheritance where the superclass is known at class definition time, and there's only one application of it.  </p>

<h3 id="examples">Examples</h3>

<p>Here's an example of <a href="https://www.dartlang.org/articles/mixins/">mixins in Dart</a>, which has a nice syntax for mixins while being similar to JavaScript:</p>

<pre><code class="language-dart">class B extends A with M {}  
</code></pre>

<p>Here <em>A</em> is a base class, <em>B</em> the subclass, and <em>M</em> a mixin. The mixin application is the specific combination of <em>M</em> mixed into <em>A</em>, often called <em>A-with-M</em>. The superclass of <em>A-with-M</em> is <em>A</em>, and the actual superclass of <em>B</em> is not <em>A</em>, as you might expect, but <em>A-with-M</em>.</p>

<p>Some class declarations and diagrams might be helpful to show what's going on. </p>

<p>Let's start with a simple class hierarchy, with class <em>B</em> inheriting from class <em>A</em>:</p>

<pre><code class="language-dart">class B extends A {}  
</code></pre>

<p><img src="http://justinfagnani.com/content/images/2015/06/class-hierarchy-1-1.svg" alt=""></p>

<p>Now let's add the mixin:</p>

<pre><code class="language-dart">class B extends A with M {}  
</code></pre>

<p><img src="http://justinfagnani.com/content/images/2015/06/class-hierarchy-2.svg" alt=""></p>

<p>As you can see, the mixin application <em>A-with-M</em> is inserted into the hierarchy between the subclass and superclass.</p>

<p>Note: I'm using long-dashed line to represent the mixin declartion (<em>B</em> includes <em>M</em>), and the short-dashed line to represent the mixin application's definition.</p>

<h4 id="multiplemixins">Multiple Mixins</h4>

<p>In Dart, multiple mixins are applied in left-to-right order, resulting in multiple mixin applications being added to the inheritance hierarchy:</p>

<pre><code class="language-dart">class B extends A with M1, M2 {}

class C extends A with M1, M2 {}  
</code></pre>

<p><img src="http://justinfagnani.com/content/images/2015/06/class-hierarchy-3.svg" alt=""></p>

<h2 id="traditionaljavascriptmixins">Traditional JavaScript Mixins</h2>

<p>The ability to freely modify objects in JavaScript means that it's very easy to copy functions around to achieve code reuse without relying on inheritance.</p>

<p>Mixin libraries like <a href="https://github.com/onsi/cocktail">Cocktail</a>, <a href="http://soft.vub.ac.be/~tvcutsem/traitsjs/">traits.js</a>, and patterns described in many blog posts (like one of the latest to hit Hacker News: <a href="http://raganwald.com/2015/06/26/decorators-in-es7.html">Using ES7 Decorators as Mixins</a>), generally work by modifying objects in place, copying in properties from mixin objects and overwriting existing properties.</p>

<p>This is often implemented via a function similar to this:</p>

<pre><code class="language-javascript">function mixin(source, target) {  
  for (var prop in source) {
    if (source.hasOwnProperty(prop)) {
      target[prop] = source[prop];
    }
  }
}
</code></pre>

<p>A version of this has even made it into JavaScript as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a>.</p>

<p><code>mixin()</code> is usually then called on a prototype:</p>

<pre><code class="language-javascript">mixin(MyMixin, MyClass.prototype);  
</code></pre>

<p>and now <code>MyClass</code> has all the properties defined in <code>MyMixin</code>.</p>

<h3 id="whatssobadaboutthat">What's So Bad About That?</h3>

<p>Simply copying properties into a target object has a few issues. Some of this can be worked around with smart enough mixin functions, but the common examples usually have these problems:</p>

<h4 id="prototypesaremodifiedinplace">Prototypes are modified in place.</h4>

<p>When using mixin libraries against prototype objects, the prototypes are directly mutated. This is a problem if the prototype is used anywhere else that the mixed-in properties are not wanted. Mixins that add state can create slower objects in VMs that try to understand the shape of objects at allocation time. It also goes against the idea that a mixin application should create a new class by composing existing ones.</p>

<h4 id="superdoesntwork"><code>super</code> doesn't work.</h4>

<p>With JavaScript finally supporting <code>super</code>, so should mixins: A mixin's methods should be able to delegate to an overridden method up the prototype chain. Since <code>super</code> is essentially lexically bound, this won't work with copying functions.</p>

<h4 id="incorrectprecedence">Incorrect precedence.</h4>

<p>This isn't necessarily always the case, but as often shown in examples, by overwriting properties, mixin methods take precedence over those in the subclass. They should only take precedence over methods in the superclass, allowing the subclass to override methods on the mixin.</p>

<h4 id="compositioniscompromised">Composition is compromised</h4>

<p>Mixins often need to delegate to other mixins or objects on the prototype chain, but there's no natural way to do this with traditional mixins. Since functions are copied onto objects, naive implementations overwrite existing methods. More sophisticated libraries will remember the existing methods, and call multiple methods of the same name, but the library has to invent its own composition rules: What order the methods are called, what arguments are passed, etc.</p>

<p>References to functions are duplicated across all applications of a mixin, where in many cases they could be bundled in a shared prototype. By overwriting properties, the structure of protytpes and some of the dynamic nature of JavaScript is reduced: you can't easily introspect the mixins or remove or re-order mixins, because the mixin has been expanded directly into the target object.</p>

<p>If we actually use the prototype chain, all of this goes away with very little work.</p>

<h2 id="bettermixinsthroughclassexpressions">Better Mixins Through Class Expressions</h2>

<p>Now let's get to the good stuff: <em>Awesome Mixins™ 2015 Edition</em>.</p>

<p>Let's quickly list the features we'd like to enable, so we can judge our implementation against them:</p>

<ol>
<li>Mixins are added to the prototype chain.  </li>
<li>Mixins are applied without modifying existing objects.  </li>
<li>Mixins do no magic, and don't define new semantics on top of the core language.  </li>
<li><code>super.foo</code> property access works within mixins and subclasses.  </li>
<li><code>super()</code> calls work in constructors.  </li>
<li>Mixins are able to extend other mixins.  </li>
<li><code>instanceof</code> works.  </li>
<li>Mixin definitions do not require library support - they can be written in a universal style.</li>
</ol>

<h3 id="subclassfactorieswiththisoneweirdtrick">Subclass Factories with this One Weird Trick</h3>

<p>Above I referred to mixins as "subclass factories, parameterized by the superclass", and in this formulation they are literally just that.</p>

<p>We rely on two features of JavaScript classes:</p>

<ol>
<li><code>class</code> can be used as an expression as well as a statement. As an expression it returns a new class each time it's evaluated. (sort of like a factory!)  </li>
<li>The <code>extends</code> clause accepts arbitrary expressions that return classes or constructors.</li>
</ol>

<p>The key is that classes in JavaScript are first-class: they are values that can be passed to and returned from functions.</p>

<p>All we need to define a mixin is a function that accepts a superclass and creates a new subclass from it, like this:</p>

<pre><code class="language-javascript">let MyMixin = (superclass) =&gt; class extends superclass {  
  foo() {
    console.log('foo from MyMixin');
  }
};
</code></pre>

<p>Then we can use it in an <code>extends</code> clause like this:</p>

<pre><code class="language-javascript">class MyClass extends MyMixin(MyBaseClass) {  
  /* ... */
}
</code></pre>

<p>And <code>MyClass</code> now has a <code>foo</code> method via mixin inheritance:</p>

<pre><code class="language-javascript">let c = new MyClass();  
c.foo(); // prints "foo from MyMixin"  
</code></pre>

<p>Incredibly simple, and incredibly powerful! By just combining function application and class expressions we get a complete mixin solution, that generalizes well too.</p>

<p>Applying multiple mixins works as expected:</p>

<pre><code class="language-javascript">class MyClass extends Mixin1(Mixin2(MyBaseClass)) {  
  /* ... */
}
</code></pre>

<p>Mixins can easily inherit from other mixins by passing the superclass along:</p>

<pre><code class="language-javascript">let Mixin2 = (superclass) =&gt; class extends Mixin1(superclass) {  
  /* Add or override methods here */
}
</code></pre>

<p>And you can use normal function composition to compose mixins:</p>

<pre><code class="language-javascript">let CompoundMixin = (superclass) =&gt; Mixin2(Mixin3(superclass));  
</code></pre>

<h3 id="benefitsofmixinsassubclassfactories">Benefits of Mixins as Subclass Factories</h3>

<p>This approach gives us a very good implementation of mixins</p>

<h4 id="subclassescanoverridemixinmethods">Subclasses can override mixin methods.</h4>

<p>As I mentioned before, many examples of JavaScript mixins get this wrong, and mixins override the subclass. With our approach subclasses correctly override mixin methods which override superclass methods.</p>

<h4 id="superworks"><code>super</code> works.</h4>

<p>One of the biggest benefits is that <code>super</code> works inside methods of the subclass and the mixins. Since we don't ever over<em>write</em> methods on classes or mixins, they're available for <code>super</code> to address.</p>

<p><code>super</code> calls can be a little unintuitive for those new to mixins because the superclass isn't known at mixin definition, and sometimes developers expect <code>super</code> to point to the declared superclass (the parameter to the mixin), not the mixin application. Thinking about the final prototype chain helps here.</p>

<h4 id="compositionispreserved">Composition is preserved.</h4>

<p>This is really just a consequence of the other benefits, but two mixins can define the same method, and as long as they call <code>super</code>, both of them will be invoked then applied.</p>

<p>Sometimes a mixin will not know if a superclass even has a particular property or method, so it's best to guard the super call:</p>

<pre><code class="language-javascript">let Mixin1 = (superclass) =&gt; class extends superclass {  
  foo() {
    console.log('foo from Mixin1');
    if (super.foo) super.foo();
  }
};

let Mixin2 = (superclass) =&gt; class extends superclass {  
  foo() {
    console.log('foo from Mixin2');
    if (super.foo) super.foo();
  }
};

class S {  
  foo() {
    console.log('foo from S');
  }
}

class C extends Mixin1(Mixin2(S)) {  
  foo() {
    console.log('foo from C');
    super.foo();
  }
}

new C().foo();  
</code></pre>

<p>prints:</p>

<pre><code>foo from C  
foo from Mixin1  
foo from Mixin2  
foo from S  
</code></pre>

<h3 id="improvingthesyntax">Improving the Syntax</h3>

<p>I find applying mixins as functions to be both elegantly simple - describing exactly what's going on, but a little bit ugly at the same time. My biggest concern is that this construction isn't optimized for readers unfamiliar with this pattern.</p>

<p>I'd like a syntax that was easier on the eyes and at least that gave new readers something to search for to explain what's going on, like the Dart syntax. I'd also like to add some more features like memoizing the mixin applications and automatically implementing <code>instanceof</code> support.</p>

<p>For that we can write a simple helper which applies a list of mixins to a superclass, in a fluent-like API:</p>

<pre><code class="language-javascript">class MyClass extends mix(MyBaseClass).with(Mixin1, Mixin2) {  
  /* ... */
}
</code></pre>

<p>Here's the code:</p>

<pre><code class="language-javascript">let mix = (superclass) =&gt; new MixinBuilder(superclass);

class MixinBuilder {  
  constructor(superclass) {
    this.superclass = superclass;
  }

  with(...mixins) { 
    return mixins.reduce((c, mixin) =&gt; mixin(c), this.superclass);
  }
}
</code></pre>

<p>That's it! It's still extremely simple for the features and nice syntax it enables.</p>

<h3 id="constructorsandinitialization">Constructors and Initialization</h3>

<p>Constructors are a potential source of confusion with mixins. They essentially behave like methods, except that overriden methods tend to have the same signature, while constructors in a inheritance hierarchy often have different signatures.</p>

<p>Since a mixin likely does not know what superclass it's being applied to, and therefore its super-constructor signature, calling <code>super()</code> can be tricky. The best way to deal with this is to always pass along all constructor arguments to <code>super()</code>, either by not defining a constructor at all, or by using the spread operator: <code>super(...arguments)</code>.</p>

<p>This means that passing arguments specifically to a mixin's constructor is difficult. One easy workaround is to just have an explicit initialization method on the mixin if it requires arguments.</p>

<h2 id="furtherexploration">Further Exploration</h2>

<p>This is just the beginning of many topics related to mixins in JavaScript. I'll post more about things like:</p>

<ul>
<li><a href="http://justinfagnani.com/2016/01/07/enhancing-mixins-with-decorator-functions/">Enhancing Mixins with Decorator Functions</a>  new post that covers:
<ul><li>Caching mixin applications so that the same mixin applied to the same superclass reuses a prototype.</li>
<li>Getting <code>instanceof</code> to work.</li></ul></li>
<li>How mixin inheritance can address the fear that ES6 classes and classical inheritance are bad for JavaScript.</li>
<li>Using subclass-factory-style mixins in ES5.</li>
<li>De-duplicating mixins so mixin composition is more usable.</li>
</ul>

<h2 id="themixwithjsproject">The mixwith.js project</h2>

<p>I started a project on GitHub to build a library around this pattern: <a href="https://github.com/justinfagnani/mixwith.js">https://github.com/justinfagnani/mixwith.js</a> It can be found on npm: <a href="https://www.npmjs.com/package/mixwith">https://www.npmjs.com/package/mixwith</a></p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-06" name="t-06"></a><h1>06 : JavaScript Mixins</h1>
					<div class="tutorial__content">
 <p>Let's start by defining what a mixin is. I would explain it as <em>a way to share set of data (functions, methods, variables…) with objects</em>.</p>

<p>How does that look like? Let's say we have two functions <code>Clark</code> and <code>Bruce</code> and that we want to implement two methods <code>sayName</code> and <code>secretIdentity</code> to their prototypes.</p>

<p>This is how our functions would look like:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Clark</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'Clark Kent'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span> <span class="o">=</span> <span class="s1">'Superman'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">Clark</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fly</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">Bruce</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'Bruce Wayne'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span> <span class="o">=</span> <span class="s1">'Batman'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">Bruce</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">talk</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">"I'm Batman"</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Most common ways of adding the methods these functions are:</p>

<h4>1. Extending objects</h4>

<p>Extending object doesn't really fit our description of mixins, since we are <strong>extending</strong> instead <strong>mixing</strong>, though idea is the same. At least that's the way I see it.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Superhero</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">sayName</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">secretIdentity</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Here we extend function prototypes with object using jQuery.extend</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Clark</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Superhero</span><span class="p">);</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Bruce</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Superhero</span><span class="p">);</span></code></pre></figure>

<p>Biggest downside to this approach is that you'll either need <code>extend</code> function available from some library like <em>Underscore</em> or <em>jQuery</em> or you would have to write it.</p>

<h4>2. Functional mixin</h4>

<p>They don't require any additional library and they are faster compared to extending. Also I find this implementation frequently overlooked.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Superhero</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sayName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">secretIdentity</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Here we extend function prototypes with using mixin function</span>
<span class="nx">Superhero</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Clark</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
<span class="nx">Superhero</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Bruce</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span></code></pre></figure>

<p>Which approach do you prefer?</p>

					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-07" name="t-07"></a><h1>07 : Building a simple PubSub system in JavaScript</h1>
					<div class="tutorial__content">
						<div id="content">
          <div class="author">
            <div>
              <strong>Paul Kinlan</strong>
              <span><time pubdate="">December 8 2016</time></span>
            </div>
          </div>
          
          
          <p>In a recent project building a <a href="/designing-a-webpush-service">web push</a>
service I wanted to have my UI respond to application level events (semantically
if you will) because there were a couple of components that require information
from the system but are not dependent with each other and I wanted them to be
able to manage themselves independently of the 'business logic'.</p>

<p>I looked around at lots of different tools to help me, but because I frequently
have a heavy case of NIH syndrome and the fact that I think people can implement
their own infrastructural elements pretty quickly, I decided to quickly knock-up
a simple client-side PubSub service — it worked pretty well for my
needs.</p>

<p>I debated whether I should use a custom DOM <code>Event</code> and use the existing
infrastructure that the DOM already provides to developers — the ability
to events and consuming events using <code>addEventListener</code> — but the only
problem was that you have to hang the event handler off a DOM Element or the
window because you can't have a model that inherits or mixes in <code>EventTarget</code>.</p>

<p><em><strong>Thought:</strong> having <code>EventTarget</code> as an object would help obviate the need for
creating custom PubSub systems.</em></p>

<p>With this constraint in mind, a will to code something up, and a propensity for
not minding bugs that I create myself, I sketched out a rough plan:</p>

<pre><code>/* When a user is added, do something useful (like update UI) */
EventManager.subscribe('useradded', function(user) {
  console.log(user)
});

/* The UI submits the data, lets publish the event. */
form.onsubmit(function(e) {
  e.preventDefault();

  // do something with user fields

  EventManager.publish('useradded', user);
})
</code></pre>

<p>All of this isn't new. Redux and many other systems already do this and in many
cases they also help you manage state. In my head, I don't really have state
that needs a model that is septate to the state already in the browser.</p>

<p>The implementation is pretty simple to implement and the abstraction is quite
useful for me at least.</p>

<pre><code>var EventManager = new (function() {
  var events = {};

  this.publish = function(name, data) {
    var handlers = events[name];
    if(!!handlers === false) return;
    handlers.forEach(function(handler) {
      handler.call(this, data);
    });
  };

  this.subscribe = function(name, handler) {
    var handlers = events[name];
    if(!!handlers === false) {
      handlers = events[name] = [];
    }
    handlers.push(handler);
  };

  this.unsubscribe = function(name, handler) {
    var handlers = events[name];
    if(!!handlers === false) return;

    var handlerIdx = handlers.indexOf(handler);
    handlers.splice(handlerIdx);
  };
});
</code></pre>

<p>Edit: Removed the use of promise.</p>

<p>And there we are. A simple pubsub system that is likely full of bugs, but I like
it. :) I've put it on <a href="https://github.com/PaulKinlan/EventManager">github</a> if
you are interested in it.</p>

          
          
          
          
          
        </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-08" name="t-08"></a><h1>08 : Build A Simple Javascript App The MVC Way</h1>
					<div class="tutorial__content">
<p>One of the best parts of JavaScript, can also be the worst. This is the undoubtedly simplistic ability to add an opening and closing script tag to the head of the HTML document and throw some spaghetti code in there. And voila! It works! Or does it? What is spaghetti code you ask? Spaghetti code is an unflattering term for code that is messy, has a tangled control structure, and is all over the place. It is nearly impossible to maintain and debug, usually has very poor structure, and is prone to errors. <a href="http://minneapolisdesigngroup.com/why-web-design-in-todays-industry-is-so-challenging/" target="_blank">Web design and development</a> is already challenging enough, don't make your job any harder than it has to be!
</p>
<p>So how do you quit writing this kind of code? In my humble opinion, you only have two options. Again, this is just my opinion. One, you use any of the umpteen number of JavaScript frameworks available at your disposal. Or two, you learn how to write JavaScript code with some sort of pattern or structure. MVC, MVP, and MVVM are a few of the common patterns to help guide developers toward creating abstracted and decoupled solutions. The main difference between these patterns boils down to 
how the Data Layer, Presentation Layer, and Application Logic are handled. In this blog post, you will be focusing on the MVC or Model-View-Controller Pattern.  </p>
<p>Model (Data Layer)- This is where the data is stored for your app. The model is decoupled from the views and controllers and has deliberate ignorance from the wider context. Whenever a model changes, it will notify its observers that a change has occurred using an Event Dispatcher. You will read about the Event Dispatcher shortly. In your To Do List App you will be building, the Model will hold the list of tasks and be responsible for any actions taken upon each task object.  </p>
<p>View (Presentation Layer)- This part of your App has access to the DOM and is responsible for setting up Event Handlers such as: click, onmouseover, onmouseout, etc. The view is also responsible for the presentation of the HTML. In your To Do List App, the view will be responsible for displaying the list of tasks to the user. However, whenever a user enters in a new task through the input field, the view will use an Event Dispatcher to notify the controller, then the controller will update the model. This allows for swift decoupling of the view from the model.
</p>
<p>Controller (Application Logic)- The controller is the glue between the model and the view. The controller processes and responds to events set off by either the model or view. It updates the model whenever the user manipulates the view, and can also be used to update the view whenever the model changes. In this tutorial, you will be updating the view directly from your model by dispatching an event. But, either way is completely acceptable. In your To Do list App, when the user clicks the add task button, the click is forwarded to the controller, and the controller modifies the model by adding the task to it. Any other decision making or logic can also be performed here, such as: saving the data using HTML local storage, making an asynchronous save to the database/server, and more. 
</p>
<p>Event Dispatcher - The Event Dispatcher is an object that allows you to attach an unlimited number of functions/methods to it. When you finally call the notify method on that Event object, every method you attached to that Event will be ran. You will see this happening a lot in the source code below. 
</p>

<p>Now that you have a basic understanding of why you should use a JavaScript Design Pattern, and what the MVC architecture is all about, now you can start building the app. Here is a quick overview of how this tutorial will work. First, I will present the code to you. This will give you the opportunity to examine and walk through it. Second, I will go into detail about a few of the core concepts that the below code base is using, and try to shed some light upon any potential hazy or gray areas that might come across as confusing. In conclusion, I will show you a couple of screenshots of the final component. To get the most out of this tutorial, I suggest you go through this a couple of times until you feel comfortable creating this app on your own. This tutorial assumes prior HTML and JavaScript experience. If you are new to JavaScript, I recommend taking a quick look at <a href="http://www.w3schools.com/Js/" target="_blank">http://www.w3schools.com/Js/</a>. You can also find the project on GitHub at <a href="https://github.com/joshcrawmer4/Javascript-MVC-App" target="_blank">https://github.com/joshcrawmer4/Javascript-MVC-App</a>. Go ahead and get started!
</p>
<h2>Start Writing Some Code
</h2>
<p>Create an <b>index.html</b> file with the below code in it:</p>
<pre><code data-language="html">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;title&gt;Javascript MVC&lt;/title&gt;
    &lt;script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"&gt;&lt;/script&gt;

    &lt;style&gt;

    &lt;/style&gt;

&lt;/head&gt;


&lt;body&gt;

    &lt;div class="js-container"&gt;

        &lt;input type="text" class="js-task-textbox"&gt;
        &lt;input type="button" class="js-add-task-button" value="Add Task"&gt;

        &lt;div class="js-tasks-container"&gt;&lt;/div&gt;
        &lt;!-- end tasks --&gt;
        &lt;input type="button" class="js-complete-task-button" value="Complete Tasks"&gt;
        &lt;input type="button" class="js-delete-task-button" value="Delete Tasks"&gt;

    &lt;/div&gt;
    &lt;!-- end js-container --&gt;



    &lt;script src="EventDispatcher.js"&gt;&lt;/script&gt;
    &lt;script src="TaskModel.js"&gt;&lt;/script&gt;
    &lt;script src="TaskView.js"&gt;&lt;/script&gt;
    &lt;script src="TaskController.js"&gt;&lt;/script&gt;
    &lt;script src="App.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<p>Next create an <b>EventDispatcher.js</b> file with the below code:</p>
<pre><code data-language="javascript">var Event = function (sender) {
    this._sender = sender;
    this._listeners = [];
}

Event.prototype = {

    attach: function (listener) {
        this._listeners.push(listener);
    },

    notify: function (args) {
        for (var i = 0; i &lt; this._listeners.length; i += 1) {
            this._listeners[i](this._sender, args);
        }
    }

};
</code></pre>
<p>Next Create a <b>TaskModel.js</b> file with the below code:</p>
<pre><code data-language="javascript">var TaskModel = function () {
     this.tasks = [];
     this.selectedTasks = [];
     this.addTaskEvent = new Event(this);
     this.removeTaskEvent = new Event(this);
     this.setTasksAsCompletedEvent = new Event(this);
     this.deleteTasksEvent = new Event(this);

 };

 TaskModel.prototype = {

     addTask: function (task) {
         this.tasks.push({
             taskName: task,
             taskStatus: 'uncompleted'
         });
         this.addTaskEvent.notify();
     },

     getTasks: function () {
         return this.tasks;
     },

     setSelectedTask: function (taskIndex) {
         this.selectedTasks.push(taskIndex);
     },

     unselectTask: function (taskIndex) {
         this.selectedTasks.splice(taskIndex, 1);
     },

     setTasksAsCompleted: function () {
         var selectedTasks = this.selectedTasks;
         for (var index in selectedTasks) {
             this.tasks[selectedTasks[index]].taskStatus = 'completed';
         }

         this.setTasksAsCompletedEvent.notify();

         this.selectedTasks = [];

     },


     deleteTasks: function () {
         var selectedTasks = this.selectedTasks.sort();

         for (var i = selectedTasks.length - 1; i &gt;= 0; i--) {
             this.tasks.splice(this.selectedTasks[i], 1);
         }

         // clear the selected tasks
         this.selectedTasks = [];

         this.deleteTasksEvent.notify();

     }


 };
</code></pre>
<p>Next Create a <b>TaskView.js</b> file with the below code:</p>
<pre><code data-language="javascript">var TaskView = function (model) {
    this.model = model;
    this.addTaskEvent = new Event(this);
    this.selectTaskEvent = new Event(this);
    this.unselectTaskEvent = new Event(this);
    this.completeTaskEvent = new Event(this);
    this.deleteTaskEvent = new Event(this);

    this.init();
};

TaskView.prototype = {

    init: function () {
        this.createChildren()
            .setupHandlers()
            .enable();
    },

    createChildren: function () {
        // cache the document object
        this.$container = $('.js-container');
        this.$addTaskButton = this.$container.find('.js-add-task-button');
        this.$taskTextBox = this.$container.find('.js-task-textbox');
        this.$tasksContainer = this.$container.find('.js-tasks-container');

        return this;
    },

    setupHandlers: function () {

        this.addTaskButtonHandler = this.addTaskButton.bind(this);
        this.selectOrUnselectTaskHandler = this.selectOrUnselectTask.bind(this);
        this.completeTaskButtonHandler = this.completeTaskButton.bind(this);
        this.deleteTaskButtonHandler = this.deleteTaskButton.bind(this);

        /**
        Handlers from Event Dispatcher
        */
        this.addTaskHandler = this.addTask.bind(this);
        this.clearTaskTextBoxHandler = this.clearTaskTextBox.bind(this);
        this.setTasksAsCompletedHandler = this.setTasksAsCompleted.bind(this);
        this.deleteTasksHandler = this.deleteTasks.bind(this);

        return this;
    },

    enable: function () {

        this.$addTaskButton.click(this.addTaskButtonHandler);
        this.$container.on('click', '.js-task', this.selectOrUnselectTaskHandler);
        this.$container.on('click', '.js-complete-task-button', this.completeTaskButtonHandler);
        this.$container.on('click', '.js-delete-task-button', this.deleteTaskButtonHandler);

        /**
         * Event Dispatcher
         */
        this.model.addTaskEvent.attach(this.addTaskHandler);
        this.model.addTaskEvent.attach(this.clearTaskTextBoxHandler);
        this.model.setTasksAsCompletedEvent.attach(this.setTasksAsCompletedHandler);
        this.model.deleteTasksEvent.attach(this.deleteTasksHandler);

        return this;
    },

    addTaskButton: function () {
        this.addTaskEvent.notify({
            task: this.$taskTextBox.val()
        });
    },

    completeTaskButton: function () {
        this.completeTaskEvent.notify();
    },

    deleteTaskButton: function () {
        this.deleteTaskEvent.notify();
    },

    selectOrUnselectTask: function () {

        var taskIndex = $(event.target).attr("data-index");

        if ($(event.target).attr('data-task-selected') == 'false') {
            $(event.target).attr('data-task-selected', true);
            this.selectTaskEvent.notify({
                taskIndex: taskIndex
            });
        } else {
            $(event.target).attr('data-task-selected', false);
            this.unselectTaskEvent.notify({
                taskIndex: taskIndex
            });
        }

    },

    show: function () {
        this.buildList();
    },

    buildList: function () {
        var tasks = this.model.getTasks();
        var html = "";
        var $tasksContainer = this.$tasksContainer;

        $tasksContainer.html('');

        var index = 0;
        for (var task in tasks) {

            if (tasks[task].taskStatus == 'completed') {
                html += "&lt;div style="color:green;"&gt;";
            } else {
                html += "&lt;div&gt;";
            }

            $tasksContainer.append(html + "&lt;label&gt;&lt;input type="checkbox" class="js-task" data-index="" + index + "" data-task-selected="false"&gt;" + tasks[task].taskName + "&lt;/label&gt;&lt;/div&gt;");

            index++;
        }

    },



    /* -------------------- Handlers From Event Dispatcher ----------------- */

    clearTaskTextBox: function () {
        this.$taskTextBox.val('');
    },

    addTask: function () {
        this.show();
    },

    setTasksAsCompleted: function () {
        this.show();

    },

    deleteTasks: function () {
        this.show();

    }

    /* -------------------- End Handlers From Event Dispatcher ----------------- */


};
</code>




</pre>
<p>Next Create a <b>TaskController.js</b> file with the below code:</p>
<pre><code data-language="javascript">var TaskController = function (model, view) {
    this.model = model;
    this.view = view;

    this.init();
};

TaskController.prototype = {

    init: function () {
        this.createChildren()
            .setupHandlers()
            .enable();
    },

    createChildren: function () {
        // no need to create children inside the controller
        // this is a job for the view
        // you could all as well leave this function out
        return this;
    },

    setupHandlers: function () {

        this.addTaskHandler = this.addTask.bind(this);
        this.selectTaskHandler = this.selectTask.bind(this);
        this.unselectTaskHandler = this.unselectTask.bind(this);
        this.completeTaskHandler = this.completeTask.bind(this);
        this.deleteTaskHandler = this.deleteTask.bind(this);
        return this;
    },

    enable: function () {

        this.view.addTaskEvent.attach(this.addTaskHandler);
        this.view.completeTaskEvent.attach(this.completeTaskHandler);
        this.view.deleteTaskEvent.attach(this.deleteTaskHandler);
        this.view.selectTaskEvent.attach(this.selectTaskHandler);
        this.view.unselectTaskEvent.attach(this.unselectTaskHandler);

        return this;
    },


    addTask: function (sender, args) {
        this.model.addTask(args.task);
    },

    selectTask: function (sender, args) {
        this.model.setSelectedTask(args.taskIndex);
    },

    unselectTask: function (sender, args) {
        this.model.unselectTask(args.taskIndex);
    },

    completeTask: function () {
        this.model.setTasksAsCompleted();
    },

    deleteTask: function () {
        this.model.deleteTasks();
    }

};
</code></pre>
<p>Next Create a <b>App.js</b> file with the below code:</p>
<pre><code data-language="javascript">$(function () {
     var model = new TaskModel(),
         view = new TaskView(model),
         controller = new TaskController(model, view);
 });

</code></pre>
<h2>Overview
</h2>
<p>Okay, so what is going on in each file!</p>
<p><b>Index.html</b> - Not much new here. Including the jQuery CDN, setting up some basic HTML, and loading the JavaScript files that we will be using in this project. Wow! That was easy!
</p>
<p><b>EventDispatcher.js</b> - This is a class with two methods, <b>attach()</b> and <b>notify()</b>. The <b>attach()</b> method accepts a function as a parameter. You can call <b>attach()</b> as many times as you want, and the function you pass can contain whatever code inside you want. Once you call the notify method on that Event object, each function you attached to that Event will be ran. 
</p>
<p><b>TaskModel.js</b> - This class has some basic methods for adding and deleting actual task objects from the <b>tasks</b> array. Setting up three Event objects inside the constructor function, allows the model to call the <b>notify()</b> method on each event object after a task has been added, marked as complete, or deleted. This, in turn, passes on the responsibility to the view to re-render the HTML to show the updated list of tasks. The main thing to recognize is that the Model passes off responsibility to the View. <b>Model -&gt; View</b>.
</p>
<p><b>TaskView.js</b> - This is the largest file in this project and could have been abstracted into multiple views. But for simplicity's sake, I put everything into one class. The constructor function sets up five Event objects. This allows the view to call the <b>notify()</b> method on each Event object, thus passing the responsibility onto the controller. Next, you see that the constructor calls the <b>init()</b> method. This init method uses method chaining to set up the backbone of this class. 
</p>
<p><b>createChildren()</b> - Caches the <b>$('.js-container')</b> DOM element in a <b>this.$container</b> variable, then refers to that variable for each element thereafter it needs to <b>find()</b>. This is merely a performance thing, and allows jQuery to pull any elements from the variable instead of requerying/crawling the DOM. Notice the use of <b>return this</b>. This allows for the method chaining inside the previous <b>init()</b> call.
</p>
<p><b>setupHandlers()</b> - This part can be a little tricky to wrap your head around for the first time. This method is setting up the event handlers and changing the scope of the <b>this</b> keyword inside that handler. Basically, whenever you run into a JavaScript event handler and plan to use the ever so famous <b>this</b> keyword inside that callback function, then this is going to reference the actual object or element the event took place on. This is not desirable in many cases, as in the MVC case when you want <b>this</b> to reference the actual class itself. Here, you are calling the <b>bind(this)</b> method on a JavaScript callback function. This changes the <b>this</b> keyword scope to point to that of the class instead of the object or element that initialized that event. Mozilla Foundation has a good tutorial explaining how to use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank">scope bound functions</a>. 
</p>
<p><b>enable()</b> - This method sets up any DOM events and attaches any functions to the Event Dispatcher that were created by the Model. Look at this line of code:
</p>
<p><b>this.model.addTaskEvent.attach(this.addTaskHandler);
</b></p>
<p>What is actually happening here? When the model calls <b>addTaskEvent.notify()</b> your view will run the <b>this.addTaskHandler()</b> method. Sweet! You're actually seeing how the EventDispatcher works! This allows your classes to talk to each other while also staying decoupled. The <b>addTaskHandler()</b> method then calls the <b>show()</b> method which in turn calls the <b>buildList()</b> method and re-renders the HTML list. 
</p>
<p>So what should you take from all of this? Basically, once the model passes responsibility to the view, the view then re-renders the HTML to show the most up-to-date task objects. Also, whenever a user manipulates the view through a DOM event the view then passes off responsibility to the controller. The view does not work directly with the model. 
</p>
<p><b>TaskController.js</b> - This class sits between the view and the model and acts as the glue that binds them together. It allows for easy decoupling of your model and view. Whenever the view uses the EventDispatcher, the controller will be there to listen and then update the model. Besides that, all the method declarations inside this file should look relatively similar to the View and Model. 
</p>
<p><b>App.js</b> - This file is responsible for kicking off the app. An instance of the Model-View-Controller gets created here. </p>
<p><img src="http://www.awwwards.com/awards/gallery/2016/08/mvc-js-tasks.jpg" alt="mvc js tasks app"></p>
<h2>Conclusion
</h2>
<p>As a developer you must always be striving to stay current. Whether this is getting involved with projects on GitHub, dabbling in a new language, or learning design patterns and principles. But one thing is for certain, you must always be moving forward. Now that you have a basic overview of how to write JavaScript the MVC way, you see how it is possible to quit writing spaghetti code and how you can start writing cleaner and more maintainable code. Feel free to reach out to me on GitHub or post any questions in the comments section below.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-09" name="t-09"></a><h1>09 : PubSub Design Pattern</h1>
					<div class="tutorial__content">
<div id="post-36" class="post-36 post type-post status-publish format-standard hentry category-javascript category-webdev">
    
          
    
    <p>Welcome to this humble article on the PubSub design pattern in Javascript. If you have ever written a relatively big Javascript app you'll know that it can get out of hand pretty quickly, for that very reason there are lots of solutions out there that you can use to aid you in this issue, <strong>design patterns</strong> are one of the most generic solutions and very often serve as a base for another more abstract solution, like an MV* framework such as Angular and Backbone.</p>
<p>A design pattern is simply a general reusable solution to a common problem, as you might expect the implementation is up to you, nevertheless a lot of production-ready implementations can be found out there, as we'll discuss later on this article.</p>
<p>The good thing about design patterns is that they are robust and generally accepted solutions, so you are in good hands if you decide to use a certain pattern. It's important to remember though, that when you have a hammer everything looks like a nail, you must know when to use it and when not to; in order to do this you need to clearly understand the advantages and disadvantages of the pattern you plan to use.</p>
<p>The PubSub design pattern stands for Publish/Subscribe, and might also be called Observer pattern. This is one of the most popular design patterns in modern Javascript, and for a good reason! The general idea of this pattern is to promote loose coupling, instead of objects calling other object's methods directly, they subscribe to an event and they get notified whenever that event occurs.</p>
<p>Let's get our feet wet with some code, as this is all quite abstract! A nice thing about PubSub is that it's not a complex design pattern at all, in fact, the idea is pretty simple as we just want to be notified when something happens, so if we had a pubsub implementation, our code would look something like this:</p>


		<pre>function myCallback() {
&nbsp;&nbsp;&nbsp;&nbsp;console.log('Event 1 triggered!');
}
pubsub.subscribe('event1', myCallback);
pubsub.publish('event1');
&nbsp;
</pre>
<!-- [Format Time: 0.0008 seconds] -->

<p>As you can see the <code>pubsub</code> object exposes two methods, <code>subscribe</code> and <code>publish</code>, when we want to know whenever an event occurs we <strong>subscribe</strong> to that event, later on we can <strong>publish</strong> that event whenever in our code.</p>
<p>The pattern also exposes an <code>unsubscribe</code> method which simply removes a listener for a given event name.</p>
<h3>Advantages of the PubSub Pattern</h3>
<p>One of the most relevant advantages of this pattern is that it allows us to easily decouple our code, which inherently makes it more maintainable and easier to test. Another advantage is that it helps us to think in term of relationships between the different parts of our app, identifying which layers need to listen and which need to publish events.</p>
<p>We are also able to easily create dynamic relationships between the different entities of our app, making it quite flexible, as Addy Osmani says in his <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">Javascript Design Patterns</a> book:</p>
<blockquote><p>
  Whilst it may not always be the best solution to every problem, it remains one of the best tools for designing decoupled systems and should be considered an important tool in any JavaScript developer's utility belt.
</p></blockquote>
<h3>Disadvantages of the PubSub Pattern</h3>
<p>The main disadvantage of this pattern is that as we highly decouple the different parts of our app, it can get hard to guarantee that a part of our app is working correctly.<br>
Also, as the dependencies are dynamic they can get hard to track.</p>
<h3>Implementing the PubSub Pattern</h3>
<p>Now that you have an idea of the pattern, let's implement it! This is actually quite easy, one simplistic implementation could be as follows:</p>


		<pre>var subs = {};
var pubsub = {
&nbsp;&nbsp;&nbsp;&nbsp;subscribe: function (evt, callback) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!subs[evt]) subs[evt] = [];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subs[evt].push(callback);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return callback;
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;publish: function (evt) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var args = Array.prototype.slice.call(arguments, 1);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subs[evt].forEach(function (callback) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback.apply(null, args);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;unsubscribe: function (evt, callback) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var idx = subs[evt].indexOf(callback);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subs.splice(idx, 1);
&nbsp;&nbsp;&nbsp;&nbsp;}
};
&nbsp;
</pre>
<!-- [Format Time: 0.0036 seconds] -->

<p>We can use this implementation as follows:</p>


		<pre>pubsub.subscribe('greet', function (name) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log('Hello ' + name + '!');
});
pubsub.publish('greet', 'Federico');
&nbsp;
</pre>
<!-- [Format Time: 0.0009 seconds] -->

<p>That would produce a message in the developer console <code>Hello Federico!</code>, as you can see it's pretty easy to implement and use.</p>
<h3>Other PubSub Implementations</h3>
<p>There are a bunch of PubSub implementations, the one I like the most is <a href="https://gist.github.com/661855">Ben Alman's Gist</a>, which is really solid and succinct. Other alternatives include <a href="http://amplifyjs.com/">AmplifyJS</a> and <a href="https://github.com/mroderick/PubSubJS">PubSubJS</a>.</p>


		<pre>/* jQuery Tiny Pub/Sub - v0.7 - 10/27/2011
* http://benalman.com/
* Copyright (c) 2011 "Cowboy" Ben Alman; Licensed MIT, GPL */
&nbsp;
(function($) {
&nbsp;
&nbsp;&nbsp;var o = $({});
&nbsp;
&nbsp;&nbsp;$.subscribe = function() {
&nbsp;&nbsp;&nbsp;&nbsp;o.on.apply(o, arguments);
&nbsp;&nbsp;};
&nbsp;
&nbsp;&nbsp;$.unsubscribe = function() {
&nbsp;&nbsp;&nbsp;&nbsp;o.off.apply(o, arguments);
&nbsp;&nbsp;};
&nbsp;
&nbsp;&nbsp;$.publish = function() {
&nbsp;&nbsp;&nbsp;&nbsp;o.trigger.apply(o, arguments);
&nbsp;&nbsp;};
&nbsp;
}(jQuery));
&nbsp;
</pre>
<!-- [Format Time: 0.0024 seconds] -->

<h3>Using PubSub with AJAX</h3>
<p>A very popular use for PubSub is whenever we are working with AJAX and async code, in the following example I illustrate a case where an user wants to search for posts, whenever the user clicks the <code>#btn-search</code> button our app should:</p>
<ul>
<li>Send an AJAX request to fetch posts which correspond to a keyword</li>
<li>Update the search history with the new keyword</li>
</ul>
<p>We could just do everything in one function, but let's keep everything organized and decouple each task we need to perform:</p>


		<pre>// USING BEN ALMAN'S PUBSUB IMPLEMENTATION
// Subscribers
$.subscribe('posts/search', function (e, keyword) {
&nbsp;&nbsp;&nbsp;&nbsp;$.ajax('/posts', { keyword: keyword }, function (data) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.publish('/posts/all', data);
&nbsp;&nbsp;&nbsp;&nbsp;});
})
$.subscribe('posts/search', drawHistory);
$.subscribe('posts/all', drawResults);
// Publishers
$('#btn-search').click(function () {
&nbsp;&nbsp;&nbsp;&nbsp;var keyword = $('#search-input').val();
&nbsp;&nbsp;&nbsp;&nbsp;$.publish('posts/search', keyword);
});
&nbsp;
</pre>
<!-- [Format Time: 0.0025 seconds] -->

<p>As you can see we don't need to wait for the AJAX request to finish to draw the search history, we can do it as soon as the button is clicked, on the other hand we do have to wait in order to draw the results. This somehow complex behaviour is easily and clearly implemented using the PubSub pattern. This scenario is pretty common in MV* frameworks such as <a href="http://backbonejs.org/">Backbone</a> which are getting increasingly popular, PubSub allows Backbone to easily decouple it's different layers/actors from each other.</p>
<h3>A Real World Example</h3>
<p>Not too long ago I faced this issue and I was glad how easily PubSub solved it. Consider you are working in a quite big WordPress plugin which is divided into modules, each module must be independant of each other, meaning it's possible to swap those modules anytime and their tests must not have any hard dependency, to archieve this this modules must able to "talk" to each other indirectly. How can we do this? Well we know that PubSub excels at decoupling so let's try it out!</p>
<p>Out of all our modules, we are interested in two: <code>favs</code> and <code>images</code>. They both have a JS file: <code>favs.js</code> and <code>images.js</code> respectively.</p>
<p>We are given the task to implement "adding an image to favorites"; <code>favs.js</code> is in charge of favs, so without using pubsub a very bare-bones implementation of <code>images.js</code> might look similar to this:</p>


		<pre>(function ($) {
&nbsp;&nbsp;&nbsp;&nbsp;'use strict';
&nbsp;&nbsp;&nbsp;&nbsp;function onAdded() { /* display OK message */ }
&nbsp;&nbsp;&nbsp;&nbsp;function onFailed() { /* display FAIL message */ }
&nbsp;&nbsp;&nbsp;&nbsp;// add to favs
&nbsp;&nbsp;&nbsp;&nbsp;function addToFavs(id) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.favs.addToFavs(id, onAdded, onFailed);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;// When a #fav element is clicked save to favs
&nbsp;&nbsp;&nbsp;&nbsp;$('#fav').click(addToFavs);
})(jQuery);
&nbsp;
</pre>
<!-- [Format Time: 0.0017 seconds] -->

<p>There are some issues with that code, one is that we have to make some kind of global variable to be able to use the <code>favs</code> API from <code>favs.js</code>, we also assume that the <code>favs.js</code> file will be loaded <strong>before</strong> <code>images.js</code>; this isn't a very big deal as we could fix it by using something like <code>requirejs</code> but still, what if we want to test that code? Testing the <code>addToFavs</code> function would depend on the <code>window.favs</code> object.</p>
<p>Using <strong>PubSub</strong> we can rewrite our code as follows:</p>


		<pre>(function ($) {
&nbsp;&nbsp;&nbsp;&nbsp;'use strict';
&nbsp;&nbsp;&nbsp;&nbsp;function onAdded() { /* display OK message */ }
&nbsp;&nbsp;&nbsp;&nbsp;function onFailed() { /* display FAIL message */ }
&nbsp;&nbsp;&nbsp;&nbsp;// When a #fav element is clicked save to favs
&nbsp;&nbsp;&nbsp;&nbsp;$('#fav').click(function () {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// favs.js is subscribed to this event
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pubsub.trigger('favs/add');
&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;pubsub.subscribe('favs/added', onAdded);
&nbsp;&nbsp;&nbsp;&nbsp;pubsub.subscribe('favs/failed', onFailed);
})(jQuery);
&nbsp;
</pre>
<!-- [Format Time: 0.0020 seconds] -->

<p>Where did <code>window.favs</code> go? We don't need it anymore! We just <strong>publish</strong> a <code>favs/add</code> event (note that it is a good practice to namespace your event names), the <code>favs.js</code> file will be listening and will react accordingly, triggering the <code>favs/added</code> and <code>favs/failed</code> events as needed. We have <strong>decoupled</strong> our little module, as a result we no longer need to use a global variable, have more flexibility on the loading order of the scripts, and more importantly we can now easily test our code by simply publishing events as needed; as a bonus this allows our tests to be more behaviour-driven rather than feature-driven, which is also a good practice :)</p>
<h3>Promises: Another solution for async code</h3>
<p>Promises are another tool we can use to deal with async code, they are gaining popularity and for a good reason! They can be quite helpful so it's important to know what they are and when they should be used, they also plays nice with the PubSub design pattern.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Mozilla Developer Network</a> defines promises as follows:</p>
<blockquote><p>
  The Promise interface represents a proxy for a value not necessarily known when the promise is created. It allows you to associate handlers to an asynchronous action's eventual success or failure. This lets asynchronous methods return values like synchronous methods: instead of the final value, the asynchronous method returns a promise of having a value at some point in the future.<br>
  A pending promise can become either fulfilled with a value, or rejected with a reason. When either of these happens, the associated handlers queued up by a promise's then method are called.
</p></blockquote>
<p>That definition might be a bit hard to swallow, but it's in fact pretty simple. Promises represent an entity which still doesn't have a value, but it's guaranteed that it will eventually either have a value (<strong>succeed</strong>) or <strong>fail</strong>.</p>


		<pre>// A simple promise
var promise = new MyPromise();
promise.then(onPromiseFinished, onPromiseFailed, onProgress);
&nbsp;
</pre>
<!-- [Format Time: 0.0007 seconds] -->

<p>A Promise <strong>must</strong> have a <code>then</code> function which accepts 3 callbacks, the first two are for success and failure respectively, the third one is to notify the consumer on progress, useful for very long operations but seldom used.</p>
<p>Something nice about promises is that they are <strong>chainable</strong>.</p>


		<pre>var promise = new MyPromise();
promise.then(function () {
&nbsp;&nbsp;&nbsp;&nbsp;console.log('First callback');
}).then(function () {
&nbsp;&nbsp;&nbsp;&nbsp;console.log('Second callback');
});
&nbsp;
</pre>
<!-- [Format Time: 0.0011 seconds] -->

<p>This code will print <code>First callback</code> and then <code>Second callback</code>. Something important to not is that if one callback fails, the following won't get executed.</p>


		<pre>var promise = new MyPromise();
promise.then(function () {
&nbsp;&nbsp;&nbsp;&nbsp;console.log('I get executed');
&nbsp;&nbsp;&nbsp;&nbsp;throw 'Error';
}).then(function () {
&nbsp;&nbsp;&nbsp;&nbsp;console.log('I don't get executed');
});
&nbsp;
</pre>
<!-- [Format Time: 0.0013 seconds] -->

<p>This allows us to execute async code in a synchronous manner, as we are used to. Also, if one of your callbacks returns a promise, the subsequent <code>then</code> call will be evaluated on that promise you returned, this makes chaining Promises easy as pie.</p>
<h3>Common Promise Scenario #1</h3>
<p>So by now you've read quite a lot on abstract promises, let's get down to a real use case! I'll illustrate two, the first one is for caching AJAX requests. First let's write an implementation <strong>without</strong> promises:</p>


		<pre>var cache = {};
function loadSong(id, callback) {
&nbsp;&nbsp;&nbsp;&nbsp;if(!cache[id] !== null) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback(cache[id]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;if(cache[id] === null) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;cache[id] = null;
&nbsp;&nbsp;&nbsp;&nbsp;$.post('/songs', { id: id }, function (data) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache[id] = data;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback(cache[id]);
&nbsp;&nbsp;&nbsp;&nbsp;});
}
&nbsp;
</pre>
<!-- [Format Time: 0.0025 seconds] -->

<p>The code above simply loads a song by <code>id</code> only once and then executes a <code>callback</code>. Not too bad, a lot of Javascript code looks like that, but we can do better! Let's use Promises! Because Promises only get resolved once, if <code>then</code> is called when a Promise is already resolved, the callback will be executed <strong>immediatly</strong>, because of this and also taking advantage of jQuery's promises implementation we can easily cache AJAX requests as jQuery AJAX functions actually return promises:</p>


		<pre>var cache = {};
function loadSong(id, callback) {
&nbsp;&nbsp;&nbsp;&nbsp;if(!cache[id]) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache[id] = $.post('/songs', { 'id': id }).promise();
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;cache[id].done(callback);
}
&nbsp;
</pre>
<!-- [Format Time: 0.0017 seconds] -->

<p>Much better! You might notice the use of <code>.promise()</code>, this is because jQuery uses <a href="http://api.jquery.com/category/deferred-object/">Deferred</a>, which is a superset of Promise. In this case we just want to return a Promise object which can be resolved only once, so we use <code>.promise()</code>. The code would also work if we returned a <code>Deferred</code> but it's a good jQuery practice to always return Promises.</p>
<p><strong>Note on jQuery's Promises</strong>: There is a catch with jQuery Promises, they aren't fully compatible with the Promises specification as you can see in <a href="http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/">Domenic Denicola's article</a> so there are some edge cases, but I find it convenient to use jQuery's implementation to demonstrate the concept as it's used by a wide variety of developers. If you want a more loyal implementation you can try other libraries such as <a href="https://github.com/kriskowal/q">Q</a>, <a href="https://github.com/tildeio/rsvp.js">rsvp</a> or <a href="https://github.com/cujojs/when">when.js</a> as Domenic suggests.</p>
<h3>Common Promise Scenario #2</h3>
<p>This situation it's also quite common, it happens whenever we have to wait for several async actions to finish before proceeding, for example:</p>


		<pre>// Get latest comments based on user and latest posts
$.post('/user/get_current_user', function (user) {
&nbsp;&nbsp;&nbsp;&nbsp;$.post('/posts/latest', function (posts) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.post('/coments/latest', {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user: user,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;posts: posts
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, drawToDOM);
&nbsp;&nbsp;&nbsp;&nbsp;});
});
&nbsp;
</pre>
<!-- [Format Time: 0.0020 seconds] -->

<p>Now <strong>that's ugly</strong>, callback spaghetti should always be avoided! Luckly a lot of libraries which implement Promises also provide method called <code>when</code> which resolves when all it's arguments (which are promises) are resolved, knowing this we can simply code:</p>


		<pre>$.when(
&nbsp;&nbsp;&nbsp;&nbsp;$.post('/user/get_current_user'),
&nbsp;&nbsp;&nbsp;&nbsp;$.post('/posts/latest')
).then(function (users, posts) {
&nbsp;&nbsp;&nbsp;&nbsp;$.post('/comments/latest', drawToDom);
});
&nbsp;
</pre>
<!-- [Format Time: 0.0010 seconds] -->

<p>That's much better, now the first two AJAX requests are executed at the same time, so it will be considerably faster. Moreover, the code is much cleaner, but we can still improve! Remember that we can chain <code>then</code> calls? Let's try that:</p>


		<pre>$.when(
&nbsp;&nbsp;&nbsp;&nbsp;$.post('/user/get_current_user'),
&nbsp;&nbsp;&nbsp;&nbsp;$.post('/posts/latest')
).then(function (users, posts) {
&nbsp;&nbsp;&nbsp;&nbsp;return $.post('/comments/latest');
}).then(drawToDom)
&nbsp;
</pre>
<!-- [Format Time: 0.0011 seconds] -->

<p>Looking good! Promises are awesome, don't be afraid to use them and try them out. If you want to know more about Promises I highly reccommend watching <a href="https://www.youtube.com/watch?v=juRtEEsHI9E">this <strong>great</strong> jQuery conference talk</a> by Alex McPherson. I also <a href="http://gosukiwi.svbtle.com/the-right-way-of-caching-ajax-requests-with-jquery">wrote a brief article on the subject</a>.</p>
<h3>Conclusion</h3>
<p>PubSub as well as all design patterns has known advantages and disadvantages which you should know very well. It's main strength is highly decoupling the different parts of your application, but it also helps us work with async code and is pretty easy to use and get started, so don't hesitate to try it out in your next project!</p>
<p>Promises can be used in conjunction with the PubSub pattern and are a very important tool we can use to deal with complex async events, as well as avoiding <a href="http://callbackhell.com/">callback hell</a>.</p>
<h3>References</h3>
<p>The following are references I used for writing this article and are recommended reads on the subject.</p>

  </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-10" name="t-10"></a><h1>10 : Glossary of Modern JavaScript Concepts: Part 1</h1>
					<h3>Learn the fundamentals of functional programming, reactive programming, and functional reactive programming in JavaScript.</h3>
					<div class="tutorial__content">
						<div class="entry-content js-entry-content" itemprop="articleBody">
              <p class="selectionShareable"><strong>TL;DR:</strong> In the first part of the Glossary of Modern JS Concepts series, we'll gain an understanding of <em>functional programming</em>, <em>reactive programming</em>, and <em>functional reactive programming</em>. To do so, we'll learn about purity, statefulness and statelessness, immutability and mutability, imperative and declarative programming, higher-order functions, observables, and the FP, RP, and FRP paradigms.</p>

<hr>

<h2>Introduction</h2>

<p class="selectionShareable">Modern JavaScript has experienced massive proliferation over recent years and shows no signs of slowing. Numerous concepts appearing in JS blogs and documentation are still unfamiliar to many front-end developers. In this post series, we'll learn intermediate and advanced concepts in the current front-end programming landscape and explore how they apply to modern JavaScript.</p>

<hr>

<h2>Concepts</h2>

<p class="selectionShareable">In this article, we'll address concepts that are crucial to understanding <strong>functional programming, reactive programming, and functional reactive programming and their use with JavaScript</strong>.</p>

<p class="selectionShareable">You can jump straight into each concept here, or continue reading to learn about them in order.</p>

<ul>
<li><a href="#purity" target="_self">Purity: Pure Functions, Impure Functions, Side Effects</a></li>
<li><a href="#state" target="_self">State: Stateful and Stateless</a></li>
<li><a href="#immutable-mutable" target="_self">Immutability and Mutability</a></li>
<li><a href="#imperative-declarative" target="_self">Imperative and Declarative Programming</a></li>
<li><a href="#higher-order-functions" target="_self">Higher-order Functions</a></li>
<li><a href="#functional-programming" target="_self">Functional Programming</a></li>
<li><a href="#observables" target="_self">Observables: Hot and Cold</a></li>
<li><a href="#reactive-programming" target="_self">Reactive Programming</a></li>
<li><a href="#functional-reactive-programming" target="_self">Functional Reactive Programming</a></li>
</ul>


<hr>

<h2><span id="purity"></span>Purity: Pure Functions, Impure Functions, Side Effects</h2>

<h3>Pure Functions</h3>

<p class="selectionShareable">A <strong>pure function</strong>'s <em>return value</em> is determined only by its <em>input values</em> (arguments) with no side effects. When given the same argument, the result will always be the same. Here is an example:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">half</span>(<span class="params">x</span>) </span>{
  <span class="keyword">return</span> x / <span class="number">2</span>;
}
</code></pre>

<p class="selectionShareable">The <code>half(x)</code> function takes a number <code>x</code> and returns a value of half of <code>x</code>. If we pass an argument of <code>8</code> to this function, the function will always return <code>4</code>. When invoked, a pure function can be replaced by its result. For example, we could replace <code>half(8)</code> with <code>4</code> wherever used in our code with no change to the final outcome. This is called <a href="https://en.wikipedia.org/wiki/Referential_transparency" target="_blank"><em>referential transparency</em></a>.</p>

<p class="selectionShareable">Pure functions only depend on what's passed to them. For example, a pure function cannot reference variables from a parent scope unless they are explicitly passed into the function as arguments. Even then, the function can <em>not modify</em> the parent scope.</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> someNum = <span class="number">8</span>;

<span class="comment">// this is NOT a pure function</span>
<span class="function"><span class="keyword">function</span> <span class="title">impureHalf</span>(<span class="params"></span>) </span>{
  <span class="keyword">return</span> someNum / <span class="number">2</span>;
}
</code></pre>

<p class="selectionShareable">In summary:</p>

<ul>
<li>Pure functions must take arguments.</li>
<li>The same input (arguments) will always produce the same output (return).</li>
<li>Pure functions rely only on local state and do not mutate external state (<em>note:</em> <code>console.log</code> changes global state).</li>
<li>Pure functions do not produce <a href="https://en.wikipedia.org/wiki/Side_effect_%28computer_science%29" target="_blank">side effects</a>.</li>
<li>Pure functions cannot call impure functions.</li>
</ul>


<h3>Impure Functions</h3>

<p class="selectionShareable">An <strong>impure function</strong> mutates state outside its scope. Any function that has <em>side effects</em> (see below) is impure. Procedural functions with no utilized return value are also impure.</p>

<p class="selectionShareable">Consider the following examples:</p>

<pre><code class="js hljs javascript"><span class="comment">// impure function producing a side effect</span>
<span class="function"><span class="keyword">function</span> <span class="title">showAlert</span>(<span class="params"></span>) </span>{
  alert(<span class="string">'This is a side effect!'</span>);
}

<span class="comment">// impure function mutating external state</span>
<span class="keyword">var</span> globalVal = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">incrementGlobalVal</span>(<span class="params">x</span>) </span>{
  globalVal += x;
}

<span class="comment">// impure function calling pure functions procedurally</span>
<span class="function"><span class="keyword">function</span> <span class="title">proceduralFn</span>(<span class="params"></span>) </span>{
  <span class="keyword">const</span> result1 = pureFnFirst(<span class="number">1</span>);
  <span class="keyword">const</span> result2 = pureFnLast(<span class="number">2</span>);
  <span class="built_in">console</span>.log(<span class="string">`Done with <span class="subst">${result1}</span> and <span class="subst">${result2}</span>!`</span>);
}

<span class="comment">// impure function that resembles a pure function,</span>
<span class="comment">// but returns different results given the same inputs</span>
<span class="function"><span class="keyword">function</span> <span class="title">getRandomRange</span>(<span class="params">min, max</span>) </span>{
  <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;
}
</code></pre>

<h3>Side Effects in JavaScript</h3>

<p class="selectionShareable">When a function or expression modifies state outside its own context, the result is a <strong>side effect</strong>. Examples of side effects include making a call to an API, manipulating the DOM, raising an alert dialog, writing to a database, etc. If a function produces side effects, it is considered <em>impure</em>. Functions that cause side effects are less predictable and harder to test since they result in changes outside their local scope.</p>

<h3>Purity Takeaways</h3>

<p class="selectionShareable">Plenty of quality code consists of <em>impure</em> functions that procedurally invoke <em>pure</em> functions. This still produces advantages for testing and immutability. Referential transparency also enables <a href="https://www.interviewcake.com/concept/python/memoization" target="_blank"><em>memoization</em></a>: caching and storing function call results and <a href="https://www.sitepoint.com/implementing-memoization-in-javascript/" target="_blank">reusing the cached results</a> when the same inputs are used again. It can be a challenge to determine when functions are truly pure.</p>

<p class="selectionShareable">To learn more about <strong>purity</strong>, check out the following resources:</p>

<ul>
<li><a href="https://toddmotto.com/pure-versus-impure-functions" target="_blank">Pure versus impure functions</a></li>
<li><a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976#.kt48h2bfa" target="_blank">Master the JavaScript Interview: What is a Pure Function?</a></li>
<li><a href="https://www.sitepoint.com/functional-programming-pure-functions/" target="_blank">Functional Programming: Pure Functions</a></li>
</ul>


<hr>

<h2><span id="state"></span>State</h2>

<p class="selectionShareable"><strong>State</strong> refers to the information a program has access to and can operate on at a point in time. This includes data stored in memory as well as OS memory, input/output ports, database, etc. For example, the contents of variables in an application at any given instant are representative of the application's <em>state</em>.</p>

<h3>Stateful</h3>

<p class="selectionShareable"><strong>Stateful</strong> programs, apps, or components store data in memory about the current state. They can modify the state as well as access its history. The following example is <em>stateful</em>:</p>

<pre><code class="js hljs javascript"><span class="comment">// stateful</span>
<span class="keyword">var</span> number = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>{
  <span class="keyword">return</span> number++;
}
increment(); <span class="comment">// global variable modified: number = 2</span>
</code></pre>

<h3>Stateless</h3>

<p class="selectionShareable"><strong>Stateless</strong> functions or components perform tasks as though running them for the first time, every time. This means they do not reference or utilize any information from earlier in their execution. Statelessness enables <em>referential transparency</em>. Functions depend only on their arguments and do not access or need knowledge of anything outside their scope. <a href="#purity" target="_self">Pure functions</a> are stateless. See the following example:</p>

<pre><code class="js hljs javascript"><span class="comment">// stateless</span>
<span class="keyword">var</span> number = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params">n</span>) </span>{
  <span class="keyword">return</span> n + <span class="number">1</span>;
}
increment(number); <span class="comment">// global variable NOT modified: returns 2</span>
</code></pre>

<p class="selectionShareable">Stateless applications <em>do</em> still manage state. However, they return their current state without <em>mutating</em> previous state. This is a tenet of <a href="#functional-programming" target="_blank">functional programming</a>.</p>

<h3>State Takeaways</h3>

<p class="selectionShareable">State management is important for any complex application. Stateful functions or components modify state and store history, but are more difficult to test and debug. Stateless functions rely only on their inputs to produce outputs. A stateless program returns new state rather than <em>modifying</em> existing state.</p>

<p class="selectionShareable">To learn more about <strong>state</strong>, check out the following resources:</p>

<ul>
<li><a href="https://en.wikipedia.org/wiki/State_(computer_science)" target="_blank">State</a></li>
<li><a href="http://stackoverflow.com/questions/844536/advantages-of-stateless-programming" target="_blank">Advantages of stateless programming</a></li>
<li><a href="https://toddmotto.com/stateful-stateless-components" target="_blank">Stateful and stateless components, the missing manual</a></li>
<li><a href="http://redux.js.org/" target="_blank">Redux: predictable state container for JavaScript apps</a></li>
</ul>


<hr>

<h2><span id="immutable-mutable"></span>Immutability and Mutability</h2>

<p class="selectionShareable">The concepts of <strong>immutability and mutability</strong> are slightly more nebulous in JavaScript than in some other programming languages. However, you will hear a lot about immutability when reading about <a href="#functional-programming" target="_self">functional programming</a> in JS. It's important to know what these terms mean classically and also how they are referenced and implemented in JavaScript. The definitions are simple enough:</p>

<h3>Immutable</h3>

<p class="selectionShareable">If an object is <strong>immutable</strong>, its value cannot be modified after creation.</p>

<h3>Mutable</h3>

<p class="selectionShareable">If an object is <strong>mutable</strong>, its value can be modified after creation.</p>

<h3>By Design: Immutability and Mutability in JavaScript</h3>

<p class="selectionShareable">In JavaScript, strings and number literals are <em>immutable by design</em>. This is easily understandable if we consider how we operate on them:</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> str = <span class="string">'Hello!'</span>;
<span class="keyword">var</span> anotherStr = str.substring(<span class="number">2</span>);
<span class="comment">// result: str = 'Hello!' (unchanged)</span>
<span class="comment">// result: anotherStr = 'llo!' (new string)</span>
</code></pre>

<p class="selectionShareable">Using the <code>.substring()</code> method on our <code>Hello!</code> string does <em>not</em> modify the original string. Instead, it creates a <em>new</em> string. We could reassign the <code>str</code> <em>variable value</em> to something else, but once we've created our <code>Hello!</code> string, it will always be <code>Hello!</code>.</p>

<p class="selectionShareable">Number literals are immutable as well. The following will always have the same result:</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> three = <span class="number">1</span> + <span class="number">2</span>;
<span class="comment">// result: three = 3</span>
</code></pre>

<p class="selectionShareable">Under no circumstances could <code>1 + 2</code> evaluate to anything other than <code>3</code>.</p>

<p class="selectionShareable">This demonstrates that immutability by design does exist in JavaScript. However, JS developers are aware that the language allows most things to be changed. For example, objects and arrays are <em>mutable by design</em>. Consider the following:</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];
arr.push(<span class="number">4</span>);
<span class="comment">// result: arr = [1, 2, 3, 4]</span>

<span class="keyword">var</span> obj = { greeting: <span class="string">'Hello'</span> };
obj.name = <span class="string">'Jon'</span>;
<span class="comment">// result: obj = { greeting: 'Hello', name: 'Jon' }</span>
</code></pre>

<p class="selectionShareable">In these examples, the <em>original</em> objects are mutated. New objects are not returned.</p>

<p class="selectionShareable">To learn more about mutability in other languages, check out <a href="https://www.interviewcake.com/concept/java/mutable" target="_blank">Mutable vs Immutable Objects</a>.</p>

<h3>In Practice: Immutability in JavaScript</h3>

<p class="selectionShareable"><a href="#functional-programming" target="_self">Functional programming</a> in JavaScript has gained a lot of momentum. But by design, JS is a very mutable, multi-paradigm language. Functional programming emphasizes <em>immutability</em>. Other functional languages will raise errors when a developer tries to mutate an immutable object. So how can we reconcile the innate mutability of JS when writing functional or functional reactive JS?</p>

<p class="selectionShareable">When we talk about functional programming in JS, the word "immutable" is used a lot, but it's the responsibility of the developer to write their code with immutability <em>in mind</em>. For example, <a href="https://egghead.io/lessons/javascript-redux-the-single-immutable-state-tree" target="_blank">Redux relies on a single, immutable state tree</a>. However, <em>JavaScript itself</em> is capable of mutating the state object. To implement an immutable state tree, we need to <a href="https://egghead.io/lessons/javascript-redux-avoiding-array-mutations-with-concat-slice-and-spread" target="_blank">return a <em>new</em></a> <a href="https://egghead.io/lessons/javascript-redux-avoiding-object-mutations-with-object-assign-and-spread" target="_blank">state object</a> each time the state changes.</p>

<p class="selectionShareable">JavaScript objects <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" target="_blank">can also be frozen</a> with <code>Object.freeze(obj)</code> <a href="http://adripofjavascript.com/blog/drips/immutable-objects-with-object-freeze.html" target="_blank">to make them immutable</a>. Note that this is <em>shallow</em>, meaning object values within a frozen object can still be mutated. To further ensure immutability, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" target="_blank">functions like Mozilla's deepFreeze()</a> and <a href="https://www.npmjs.com/package/deep-freeze" target="_blank">npm deep-freeze</a> can recursively freeze objects. Freezing is most practical when used in <em>tests</em> rather than in application JS. Tests will alert developers when mutations occur so they can be corrected or avoided in the actual build without <code>Object.freeze</code> cluttering up the core code.</p>

<p class="selectionShareable">There are also libraries available to support immutability in JS. <a href="http://swannodette.github.io/mori/" target="_blank">Mori</a> delivers persistent data structures based on Clojure. <a href="https://facebook.github.io/immutable-js/" target="_blank">Immutable.js</a> by Facebook also provides <a href="https://auth0.com/blog/intro-to-immutable-js/" target="_blank">immutable collections for JS</a>. Utility libraries like <a href="http://underscorejs.org" target="_blank">Underscore.js</a> and <a href="http://www.lodash.com" target="_blank">lodash</a> provide methods and modules to promote a more immutable <a href="https://github.com/lodash/lodash/wiki/FP-Guide" target="_blank">functional programming <em>style</em></a>.</p>

<h3>Immutability and Mutability Takeaways</h3>

<p class="selectionShareable">Overall, JavaScript is a very mutable language. Some styles of JS coding <em>rely</em> on this innate mutability. However, when writing functional JS, implementing immutability requires mindfulness. JS will not natively throw errors when you modify something unintentionally. Testing and libraries can assist, but working with immutability in JS takes practice and methodology.</p>

<p class="selectionShareable">Immutability has advantages. It results in code that is simpler to reason about. It also enables <a href="https://en.wikipedia.org/wiki/Persistence_(computer_science)" target="_blank"><em>persistency</em></a>, the ability to keep older versions of a data structure and copy only the parts that have changed.</p>

<p class="selectionShareable">The disadvantage of immutability is that many algorithms and operations cannot be implemented efficiently.</p>

<p class="selectionShareable">To learn more about <strong>immutability and mutability</strong>, check out the following resources:</p>

<ul>
<li><a href="https://www.sitepoint.com/immutability-javascript/" target="_blank">Immutability in JavaScript</a></li>
<li><a href="http://adripofjavascript.com/blog/drips/immutable-objects-with-object-freeze.html" target="_blank">Immutable Objects with Object Freeze</a></li>
<li><a href="https://www.interviewcake.com/concept/java/mutable" target="_blank">Mutable vs Immutable Objects</a></li>
<li><a href="http://jlongster.com/Using-Immutable-Data-Structures-in-JavaScript" target="_blank">Using Immutable Data Stuctures in JavaScript</a></li>
<li><a href="https://egghead.io/courses/getting-started-with-redux" target="_blank">Getting Started with Redux</a> (includes examples for addressing immutable state)</li>
</ul>


<hr>

<h2><span id="imperative-declarative"></span>Imperative and Declarative Programming</h2>

<p class="selectionShareable">While some languages were designed to be <strong>imperative</strong> (C, PHP) or <strong>declarative</strong> (SQL, HTML), JavaScript (and others like <a href="http://openjdk.java.net/projects/lambda/" target="_blank">Java</a> and <a href="https://msdn.microsoft.com/en-us/library/bb534803(v=vs.110).aspx" target="_blank">C#</a>) can support both programming paradigms.</p>

<p class="selectionShareable">Most developers familiar with even the most basic JavaScript have written imperative code: instructions informing the computer <em>how</em> to achieve a desired result. If you've written a <code>for</code> loop, you've written imperative JS.</p>

<p class="selectionShareable">Declarative code tells the computer <em>what</em> you want to achieve rather than how, and the computer takes care of how to achieve the end result without explicit description from the developer. If you've used <code>Array.map</code>, you've written declarative JS.</p>

<h3>Imperative Programming</h3>

<p class="selectionShareable"><strong>Imperative programming</strong> describes <em>how</em> a program's logic works in explicit commands with statements that modify the program state.</p>

<p class="selectionShareable">Consider a function that increments every number in an array of integers. An imperative JavaScript example of this might be:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">incrementArray</span>(<span class="params">arr</span>) </span>{
  <span class="keyword">let</span> resultArr = [];
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) {
    resultArr.push(arr[i] + <span class="number">1</span>);
  }
  <span class="keyword">return</span> resultArr;
}
</code></pre>

<p class="selectionShareable">This function shows exactly <em>how</em> the function's logic works: we iterate over the array and explicitly increase each number, pushing it to a new array. We then return the resulting array. This is a step-by-step description of the function's logic.</p>

<h3>Declarative Programming</h3>

<p class="selectionShareable"><strong>Declarative programming</strong> describes <em>what</em> a program's logic accomplishes <em>without</em> describing how.</p>

<p class="selectionShareable">A very straightforward example of declarative programming can be demonstrated with <a href="https://www.khanacademy.org/computing/computer-programming/sql" target="_blank">SQL</a>. We can query a database table (<code>People</code>) for people with the last name <code>Smith</code> like so:</p>

<pre><code class="sql hljs"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> People <span class="keyword">WHERE</span> LastName = <span class="string">'Smith'</span>
</code></pre>

<p class="selectionShareable">This code is easy to read and describes <em>what</em> we want to accomplish. There is no description of <em>how</em> the result should be achieved. The computer takes care of that.</p>

<p class="selectionShareable">Now consider the <code>incrementArray()</code> function we implemented imperatively above. Let's implement this declaratively now:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">incrementArray</span>(<span class="params">arr</span>) </span>{
  <span class="keyword">return</span> arr.map(item =&gt; item + <span class="number">1</span>);
}
</code></pre>

<p class="selectionShareable">We show <em>what</em> we want to achieve, but not how it works. The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" target="_blank"><code>Array.map()</code> method</a> returns a new array with the results of running the callback on each item from the passed array. This approach does not modify existing values, nor does it include any sequential logic showing <em>how</em> it creates the new array.</p>

<blockquote><p class="selectionShareable"><strong>Note:</strong> JavaScript's <a href="https://www.sitepoint.com/map-reduce-functional-javascript/" target="_blank"><code>map</code>, <code>reduce</code>,</a> <a href="https://danmartensen.svbtle.com/javascripts-map-reduce-and-filter" target="_blank">and <code>filter</code></a> are declarative, <a href="#functional-programming" target="_self">functional</a> array methods. Utility libraries like <a href="https://lodash.com/" target="_blank">lodash</a> provide methods like <a href="https://lodash.com/docs/4.17.4#every" target="_blank"><code>every</code></a>, <a href="https://lodash.com/docs/4.17.4#sortBy" target="_blank"><code>sortBy</code></a>, <a href="https://lodash.com/docs/4.17.4#uniq" target="_blank"><code>uniq</code></a>, and more in addition to <code>map</code>, <code>reduce</code>, and <code>filter</code>.</p></blockquote>

<h3>Imperative and Declarative Programming Takeaways</h3>

<p class="selectionShareable">As a language, JavaScript allows both <strong>imperative and declarative programming</strong> paradigms. Much of the JS code we read and write is imperative. However, with the rise of <a href="#functional-programming" target="_self">functional programming</a> in JS, declarative approaches are becoming more common.</p>

<p class="selectionShareable">Declarative programming has obvious advantages with regard to brevity and readability, but at the same time it can feel magical.  Many JavaScript beginners can benefit from gaining experience writing imperative JS before diving too deep into declarative programming.</p>

<p class="selectionShareable">To learn more about <strong>imperative and declarative programming</strong>, check out the following resources:</p>

<ul>
<li><a href="https://tylermcginnis.com/imperative-vs-declarative-programming/" target="_blank">Imperative vs Declarative Programming</a></li>
<li><a href="http://softwareengineering.stackexchange.com/questions/117092/whats-the-difference-between-imperative-procedural-and-structured-programming" target="_blank">What's the Difference Between Imperative, Procedural, and Structured Programming?</a></li>
<li><a href="http://www.redotheweb.com/2015/09/18/declarative-imperative-js.html" target="_blank">Imperative and (Functional) Declarative JS In Practice</a></li>
<li><a href="https://danmartensen.svbtle.com/javascripts-map-reduce-and-filter" target="_blank">JavaScript's Map, Reduce, and Filter</a></li>
</ul>


<hr>

<h2><span id="higher-order-functions"></span>Higher-order Functions</h2>

<p class="selectionShareable">A <strong>higher-order function</strong> is a function that:</p>

<ul>
<li>accepts another function as an argument, or</li>
<li>returns a function as a result.</li>
</ul>


<p class="selectionShareable">In JavaScript, functions are <a href="http://helephant.com/2008/08/19/functions-are-first-class-objects-in-javascript/" target="_blank"><em>first-class objects</em></a>. They can be stored and passed around as <em>values</em>: we can assign a function to a variable or pass a function to another function.</p>

<pre><code class="js hljs javascript"><span class="keyword">const</span> double = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>{
  <span class="keyword">return</span> x * <span class="number">2</span>;
}
<span class="keyword">const</span> timesTwo = double;

timesTwo(<span class="number">4</span>); <span class="comment">// result: returns 8</span>
</code></pre>

<p class="selectionShareable">One example of taking a function as an argument is a <em>callback</em>. Callbacks can be inline anonymous functions or named functions:</p>

<pre><code class="js hljs javascript"><span class="keyword">const</span> myBtn = <span class="built_in">document</span>.getElementById(<span class="string">'myButton'</span>);

<span class="comment">// anonymous callback function</span>
myBtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>{ <span class="built_in">console</span>.log(<span class="string">`Click event: <span class="subst">${e}</span>`</span>); });

<span class="comment">// named callback function</span>
<span class="function"><span class="keyword">function</span> <span class="title">btnHandler</span>(<span class="params">e</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">`Click event: <span class="subst">${e}</span>`</span>);
}
myBtn.addEventListener(<span class="string">'click'</span>, btnHandler);
</code></pre>

<p class="selectionShareable">We can also pass a function as an argument to any other function we create and then execute that argument:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>) </span>{
  alert(<span class="string">'Hi!'</span>);
}
<span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">greeting</span>) </span>{
  greeting();
}
greet(sayHi); <span class="comment">// alerts "Hi!"</span>
</code></pre>

<blockquote><p class="selectionShareable"><strong>Note:</strong> When <em>passing a named function as an argument</em>, as in the two examples above, we don't use parentheses <code>()</code>. This way we're passing the function as an object. Parentheses <em>execute</em> the function and pass the result instead of the function itself.</p></blockquote>

<p class="selectionShareable">Higher-order functions can also return another function:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">whenMeetingJohn</span>(<span class="params"></span>) </span>{
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    alert(<span class="string">'Hi!'</span>);
  }
}
<span class="keyword">var</span> atLunchToday = whenMeetingJohn();

atLunchToday(); <span class="comment">// alerts "Hi!"</span>
</code></pre>

<h3>Higher-order Function Takeaways</h3>

<p class="selectionShareable">The nature of JavaScript functions as first-class objects make them prime for facilitating <a href="#functional-programming" target="_self">functional programming</a>.</p>

<p class="selectionShareable">To learn more about <strong>higher-order functions</strong>, check out the following resources:</p>

<ul>
<li><a href="http://helephant.com/2008/08/19/functions-are-first-class-objects-in-javascript/" target="_blank">Functions are first class objects in JavaScript</a></li>
<li><a href="https://www.sitepoint.com/higher-order-functions-javascript/" target="_blank">Higher-Order Functions in JavaScript</a></li>
<li><a href="https://www.youtube.com/watch?v=BMUiFMZr7vk" target="_blank">Higher-order functions - Part 1 of Functional Programming in JavaScript</a></li>
<li><a href="http://eloquentjavascript.net/05_higher_order.html" target="_blank">Eloquent JavaScript - Higher-order Functions</a></li>
<li><a href="https://medium.com/functional-javascript/higher-order-functions-78084829fff4#.dwg58papp" target="_blank">Higher Order Functions</a></li>
</ul>


<hr>

<h2><span id="functional-programming"></span>Functional Programming</h2>

<p class="selectionShareable">Now we've learned about purity, statelessness, immutability, declarative programming, and higher-order functions. These are all concepts that are important in understanding the functional programming paradigm.</p>

<h3>In Practice: Functional Programming with JavaScript</h3>

<p class="selectionShareable"><strong>Functional programming</strong> encompasses the above concepts in the following ways:</p>

<ul>
<li>Core functionality is implemented using pure functions without side effects.</li>
<li>Data is immutable.</li>
<li>Functional programs are stateless.</li>
<li>Imperative container code manages side effects and executes declarative, pure core code.*</li>
</ul>


<blockquote><p class="selectionShareable">*If we tried to write a JavaScript web application composed of nothing but pure functions with no side effects, it couldn't interact with its environment and therefore wouldn't be particularly useful.</p></blockquote>

<p class="selectionShareable">Let's explore an example. Say we have some text copy and we want to get its word count. We also want to find keywords that are longer than five characters. Using functional programming, our resulting code might look something like this:</p>

<pre><code class="js hljs javascript"><span class="keyword">const</span> fpCopy = <span class="string">`Functional programming is powerful and enjoyable to write. It's very cool!`</span>;

<span class="comment">// remove punctuation from string </span>
<span class="keyword">const</span> stripPunctuation = (str) =&gt;
  str.replace(<span class="regexp">/[.,\/#!$%\^&amp;\*;:{}=\-_`~()]/g</span>, <span class="string">''</span>);

<span class="comment">// split passed string on spaces to create an array</span>
<span class="keyword">const</span> getArr = (str) =&gt;
  str.split(<span class="string">' '</span>);

<span class="comment">// count items in the passed array</span>
<span class="keyword">const</span> getWordCount = (arr) =&gt;
  arr.length;

<span class="comment">// find items in the passed array longer than 5 characters</span>
<span class="comment">// make items lower case</span>
<span class="keyword">const</span> getKeywords = (arr) =&gt;
  arr
    .filter(item =&gt; item.length &gt; <span class="number">5</span>)
    .map(item =&gt; item.toLowerCase());

<span class="comment">// process copy to prep the string, create an array, count words, and get keywords</span>
<span class="function"><span class="keyword">function</span> <span class="title">processCopy</span>(<span class="params">str, prepFn, arrFn, countFn, kwFn</span>) </span>{
  <span class="keyword">const</span> copyArray = arrFn(prepFn(str));

  <span class="built_in">console</span>.log(<span class="string">`Word count: <span class="subst">${countFn(copyArray)}</span>`</span>);
  <span class="built_in">console</span>.log(<span class="string">`Keywords: <span class="subst">${kwFn(copyArray)}</span>`</span>);
}

processCopy(fpCopy, stripPunctuation, getArr, getWordCount, getKeywords);
<span class="comment">// result: Word count: 11</span>
<span class="comment">// result: Keywords: functional,programming,powerful,enjoyable</span>
</code></pre>

<p class="selectionShareable">This code is available to run at this <a href="https://jsfiddle.net/kmaida/xxc7g0ve/" target="_blank">JSFiddle: Functional Programming with JavaScript</a>. It's broken into digestible, declarative functions with clear purpose. If we step through it and read the comments, no further explanation of the code should be necessary. Each <em>core</em> function is modular and relies only on its inputs (<a href="#purity" target="_self">pure</a>). The last function processes the core to generate the collective outputs. This function, <code>processCopy()</code>, is the impure container that executes the core and manages side effects. We've used a <a href="#higher-order-functions" target="_self">higher-order function</a> that accepts the other functions as arguments to maintain the functional style.</p>

<h3>Functional Programming Takeaways</h3>

<p class="selectionShareable">Immutable data and statelessness mean that the program's existing state is not modified. Instead, new values are returned. Pure functions are used for core functionality. In order to implement the program and handle necessary side effects, impure functions can call pure functions imperatively.</p>

<h2><span id="observables"></span>Observables</h2>

<p class="selectionShareable"><strong>Observables</strong> are similar to arrays, except instead of being stored in memory, items arrive asynchronously over time (also called <em>streams</em>). We can <em>subscribe</em> to observables and react to events emitted by them. JavaScript observables are an implementation of the <a href="http://stackoverflow.com/a/15596243" target="_blank"><em>observer pattern</em></a>. <a href="http://reactivex.io/" target="_blank">Reactive Extensions</a> (commonly known as Rx*) provides an observables library for JS via <a href="https://github.com/ReactiveX/rxjs" target="_blank">RxJS</a>.</p>

<p class="selectionShareable">To demonstrate the concept of observables, let's consider a simple example: resizing the browser window. It's easy to understand observables in this context. Resizing the browser window emits a stream of events over a period of time as the window is dragged to its desired size. We can create an observable and subscribe to it to react to the stream of resize events:</p>

<pre><code class="js hljs javascript"><span class="comment">// create window resize stream</span>
<span class="comment">// throttle resize events</span>
<span class="keyword">const</span> resize$ = 
  Rx.Observable
    .fromEvent(<span class="built_in">window</span>, <span class="string">'resize'</span>)
    .throttleTime(<span class="number">350</span>);

<span class="comment">// subscribe to the resize$ observable</span>
<span class="comment">// log window width x height</span>
<span class="keyword">const</span> subscription = 
  resize$.subscribe((event) =&gt; {
    <span class="keyword">let</span> t = event.target;
    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">${t.innerWidth}</span>px x <span class="subst">${t.innerHeight}</span>px`</span>);
  });
</code></pre>

<p class="selectionShareable">The example code above shows that as the window size changes, we can throttle the observable stream and subscribe to the changes to respond to new values in the collection. This is an example of a <em>hot observable</em>.</p>

<h3>Hot Observables</h3>

<p class="selectionShareable">User interface events like button clicks, mouse movement, etc. are <em>hot</em>. <strong>Hot observables</strong> will always push even if we're not specifically reacting to them with a subscription. The window resize example above is a hot observable: the <code>resize$</code> observable fires whether or not <code>subscription</code> exists.</p>

<h3>Cold Observables</h3>

<p class="selectionShareable">A <strong>cold observable</strong> begins pushing <em>only</em> when we subscribe to it. If we subscribe again, it will start over.</p>

<p class="selectionShareable">Let's create an observable collection of numbers ranging from <code>1</code> to <code>5</code>:</p>

<pre><code class="js hljs javascript"><span class="comment">// create source number stream</span>
<span class="keyword">const</span> source$ = Rx.Observable.range(<span class="number">1</span>, <span class="number">5</span>);

<span class="comment">// subscribe to source$ observable</span>
<span class="keyword">const</span> subscription = source$.subscribe(
  (value) =&gt; { <span class="built_in">console</span>.log(<span class="string">`Next: <span class="subst">${value}</span>`</span>); }, <span class="comment">// onNext</span>
  (event) =&gt; { <span class="built_in">console</span>.log(<span class="string">`Error: <span class="subst">${event}</span>`</span>); }, <span class="comment">// onError</span>
  () =&gt; { <span class="built_in">console</span>.log(<span class="string">'Completed!'</span>); }  <span class="comment">// onCompleted</span>
);
</code></pre>

<p class="selectionShareable">We can <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/subscribe.md" target="_blank"><code>subscribe()</code></a> to the <code>source$</code> observable we just created. Upon subscription, the values are sent in sequence to the observer. The <code>onNext</code> callback logs the values: <code>Next: 1</code>, <code>Next: 2</code>, etc. until completion: <code>Completed!</code>. The cold <code>source$</code> observable we created doesn't push unless we <em>subscribe</em> to it.</p>

<h3>Observables Takeaways</h3>

<p class="selectionShareable">Observables are streams. We can observe any stream: from resize events to existing arrays to API responses. We can create observables from almost anything. A <em>promise</em> is an observable with a single emitted value, but observables can return many values over time.</p>

<p class="selectionShareable">We can operate on observables in many ways. <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators" target="_blank">RxJS utilizes numerous operator methods</a>. Observables are often visualized using points on a line, as demonstrated on the <a href="http://rxmarbles.com" target="_blank">RxMarbles</a> site. Since the stream consists of asynchronous events over <em>time</em>, it's easy to conceptualize this in a linear fashion and use such visualizations to understand Rx* operators. For example, the following RxMarbles image illustrates the <a href="http://rxmarbles.com/#filter" target="_blank">filter operator</a>:</p>

<p class="selectionShareable"><img src="https://cdn.auth0.com/blog/jsglossary/rxmarbles.png" alt="reactive programming with Rx observables: filter operator from rxmarbles.com"></p>

<p class="selectionShareable">To learn more about <strong>observables</strong>, check out the following resources:</p>

<ul>
<li><a href="http://reactivex.io/documentation/observable.html" target="_blank">Reactive Extensions: Observable</a></li>
<li><a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/creating.md" target="_blank">Creating and Subscribing to Simple Observable Sequences</a></li>
<li><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754#request-and-response" target="_blank">The introduction to Reactive Programming you've been missing: Request and Response</a></li>
<li><a href="https://egghead.io/lessons/javascript-introducing-the-observable" target="_blank">Introducing the Observable</a></li>
<li><a href="http://rxmarbles.com/" target="_blank">RxMarbles</a></li>
<li><a href="https://xgrommx.github.io/rx-book/content/observable/index.html" target="_blank">Rx Book - Observable</a></li>
<li><a href="https://egghead.io/lessons/javascript-introducing-the-observable" target="_blank">Introducing the Observable</a></li>
</ul>


<hr>

<h2><span id="reactive-programming"></span>Reactive Programming</h2>

<p class="selectionShareable"><strong>Reactive programming</strong> is concerned with propagating and responding to incoming events over time, <a href="#imperative-declarative" target="_self">declaratively</a> (describing <em>what</em> to do rather than <em>how</em>).</p>

<p class="selectionShareable">Reactive programming is often associated with <a href="http://reactivex.io/" target="_blank">Reactive Extensions</a>, an API for asynchronous programming with <a href="#observables" target="_self">observable streams</a>. Reactive Extensions (abbreviated Rx*) <a href="http://reactivex.io/languages.html" target="_blank">provides libraries for a variety of languages</a>, including JavaScript (<a href="https://github.com/Reactive-Extensions/RxJS" target="_blank">RxJS</a>).</p>

<h3>In Practice: Reactive Programming with JavaScript</h3>

<p class="selectionShareable">Here is an example of reactive programming with observables. Let's say we have an input where the user can enter a six-character confirmation code and we want to print out the latest valid code attempt. Our HTML might look like this:</p>

<div class="highlight"><pre><code class="language-html hljs xml" data-lang="html"><span class="c"><span class="comment">&lt;!-- HTML --&gt;</span></span>
<span class="nt"><span class="tag">&lt;<span class="name">input</span></span></span><span class="tag"> </span><span class="na"><span class="tag"><span class="attr">id</span>=</span></span><span class="s"><span class="tag"><span class="string">"confirmation-code"</span></span></span><span class="tag"> </span><span class="na"><span class="tag"><span class="attr">type</span>=</span></span><span class="s"><span class="tag"><span class="string">"text"</span></span></span><span class="nt"><span class="tag">&gt;</span></span>
<span class="nt"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span>
  <span class="nt"><span class="tag">&lt;<span class="name">strong</span>&gt;</span></span>Valid code attempt:<span class="nt"><span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span>
  <span class="nt"><span class="tag">&lt;<span class="name">code</span></span></span><span class="tag"> </span><span class="na"><span class="tag"><span class="attr">id</span>=</span></span><span class="s"><span class="tag"><span class="string">"attempted-code"</span></span></span><span class="nt"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span>
<span class="nt"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></code></pre></div>


<p class="selectionShareable">We'll use RxJS and create a stream of input events to implement our functionality, like so:</p>

<pre><code class="js hljs javascript"><span class="comment">// JS</span>
<span class="keyword">const</span> confCodeInput = <span class="built_in">document</span>.getElementById(<span class="string">'confirmation-code'</span>);
<span class="keyword">const</span> attemptedCode = <span class="built_in">document</span>.getElementById(<span class="string">'attempted-code'</span>);

<span class="keyword">const</span> confCodes$ = 
  Rx.Observable
    .fromEvent(confCodeInput, <span class="string">'input'</span>)
    .map(e =&gt; e.target.value)
    .filter(code =&gt; code.length === <span class="number">6</span>);

<span class="keyword">const</span> subscription = confCodes$.subscribe(
  (value) =&gt; attemptedCode.innerText = value,
  (event) =&gt; { <span class="built_in">console</span>.warn(<span class="string">`Error: <span class="subst">${event}</span>`</span>); },
  () =&gt; { <span class="built_in">console</span>.info(<span class="string">'Completed!'</span>); }
);
</code></pre>

<p class="selectionShareable">This code can be run at this <a href="https://jsfiddle.net/kmaida/v1ozuwgu/" target="_blank">JSFiddle: Reactive Programming with JavaScript</a>. We'll observe <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/fromevent.md" target="_blank">events from</a> the <code>confCodeInput</code> input element. Then we'll use the <a href="http://reactivex.io/documentation/operators/map.html" target="_blank"><code>map</code> operator</a> to get the <code>value</code> from each input event. Next, we'll <a href="http://reactivex.io/documentation/operators/filter.html" target="_blank"><code>filter</code></a> any results that are not six characters so they won't appear in the returned stream. Finally, we'll <a href="http://reactivex.io/documentation/operators/subscribe.html" target="_blank"><code>subscribe</code></a> to our <code>confCodes$</code> observable and print out the latest valid confirmation code attempt. Note that this was done in response to events over time, declaratively: this is the crux of reactive programming.</p>

<h3>Reactive Programming Takeaways</h3>

<p class="selectionShareable">The reactive programming paradigm involves observing and reacting to events in asynchronous data streams. RxJS is used in <a href="https://medium.com/google-developer-experts/angular-introduction-to-reactive-extensions-rxjs-a86a7430a61f#.41aap1i8a" target="_blank">Angular</a> and is gaining popularity as a JavaScript solution for reactive programming.</p>

<p class="selectionShareable">To learn more about <strong>reactive programming</strong>, check out the following resources:</p>

<ul>
<li><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754" target="_blank">The introduction to Reactive Programming you've been missing</a></li>
<li><a href="http://www.introtorx.com/" target="_blank">Introduction to Rx</a></li>
<li><a href="http://www.reactivemanifesto.org/" target="_blank">The Reactive Manifesto</a></li>
<li><a href="https://auth0.com/blog/understanding-reactive-programming-and-rxjs/" target="_blank">Understanding Reactive Programming and RxJS</a></li>
<li><a href="http://paulstovell.com/blog/reactive-programming" target="_blank">Reactive Programming</a></li>
<li><a href="https://davidwalsh.name/modernization-reactivity" target="_blank">Modernization of Reactivity</a></li>
<li><a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core" target="_blank">Reactive-Extensions RxJS API Core</a></li>
</ul>


<hr>

<h2><span id="functional-reactive-programming"></span>Functional Reactive Programming</h2>

<p class="selectionShareable">In simple terms, functional reactive programming could be summarized as declaratively responding to events or behaviors over time. To understand the tenets of FRP in more depth, let's take a look at FRP's formulation. Then we'll examine its use in relation to JavaScript.</p>

<h3>What is Functional Reactive Programming?</h3>

<p class="selectionShareable">A <a href="http://stackoverflow.com/a/5386908" target="_blank">more complete definition</a> from <a href="https://twitter.com/conal" target="_blank">Conal Elliot, FRP's formulator</a>, would be that <strong>functional reactive programming</strong> is "<a href="https://en.wikibooks.org/wiki/Haskell/Denotational_semantics" target="_blank">denotative</a> and temporally continuous". Elliot mentions that he prefers to describe this programming paradigm as <em>denotative continuous-time programming</em> as opposed to "functional reactive programming".</p>

<p class="selectionShareable"><strong>Functional reactive programming</strong>, at its most basic, original  definition, has two fundamental properties:</p>

<ul>
<li><strong>denotative</strong>: the meaning of each function or type is precise, simple, and implementation-independent ("functional" references this)</li>
<li><strong>continuous time</strong>: <a href="https://en.wikipedia.org/wiki/Discrete_time_and_continuous_time#Continuous_time" target="_blank">variables have a particular value for a very short time: between any two points are an infinite number of other points</a>; provides transformation flexibility, efficiency, modularity, and accuracy ("reactive" references this)</li>
</ul>


<p class="selectionShareable">Again, when we put it simply: <a href="https://www.quora.com/What-is-Functional-Reactive-Programming" target="_blank"><strong>functional reactive programming</strong> is programming declaratively with time-varying values</a>.</p>

<p class="selectionShareable">To understand <em>continuous time / temporal continuity</em>, consider an analogy using vector graphics. Vector graphics have an <em>infinite resolution</em>. Unlike bitmap graphics (discrete resolution), vector graphics scale indefinitely. They never pixellate or become indistinct when particularly large or small the way bitmap graphics do.</p>

<blockquote><p class="selectionShareable">"FRP expressions describe entire evolutions of values over time, representing these evolutions directly as first-class values."</p>

<p class="selectionShareable">—<em>Conal Elliot</em></p></blockquote>

<p class="selectionShareable">Functional reactive programming should be:</p>

<ul>
<li>dynamic: can react over time <em>or</em> to input changes</li>
<li>time-varying: reactive <em>behaviors</em> can change continually while reactive <em>values</em> change discretely</li>
<li>efficient: minimize amount of processing necessary when inputs change</li>
<li>historically aware: pure functions map state from a previous point in time to the next point in time; state changes concern the local element and not the global program state</li>
</ul>


<p class="selectionShareable">Conal Elliot's slides on the <a href="http://conal.net/talks/essence-and-origins-of-frp-lambdajam-2015.pdf" target="_blank">Essence and Origins of FRP can be viewed here</a>. The programming language <a href="https://wiki.haskell.org/Functional_Reactive_Programming" target="_blank">Haskell</a> lends itself to true FRP due to its functional, pure, and lazy nature. Evan Czaplicki, the creator of <a href="http://elm-lang.org" target="_blank">Elm</a>, gives a great overview of FRP in his talk <a href="https://www.youtube.com/watch?v=Agu6jipKfYw" target="_blank">Controlling Time and Space: Understanding the Many Formulations of FRP</a>.</p>

<p class="selectionShareable">In fact, let's talk briefly about <a href="http://people.seas.harvard.edu/~chong/pubs/pldi13-elm.pdf" target="_blank">Evan Czapliki</a>'s <a href="https://auth0.com/blog/creating-your-first-elm-app-part-1/" target="_blank">Elm</a>. Elm is a functional, typed language for building web applications. It compiles to JavaScript, CSS, and HTML. <a href="https://guide.elm-lang.org/architecture/" target="_blank">The Elm Architecture</a> was the inspiration for the <a href="http://redux.js.org/" target="_blank">Redux</a> state container for JS apps. <a href="https://www.youtube.com/watch?v=Agu6jipKfYw" target="_blank">Elm was originally considered a true functional reactive programming language</a>, but as of version 0.17, it implemented <em>subscriptions</em> instead of signals in the interest of making the language easier to learn and use. In doing so, Elm <a href="http://elm-lang.org/blog/farewell-to-frp" target="_blank">bid farewell to FRP</a>.</p>

<h3>In Practice: Functional Reactive Programming and JavaScript</h3>

<p class="selectionShareable">The traditional definition of FRP can be difficult to grasp, especially for developers who don't have experience with languages like Haskell or Elm. However, the term has come up more frequently in the front-end ecosystem, so let's shed some light on its application in JavaScript.</p>

<p class="selectionShareable">In order to reconcile what you may have read about FRP in JS, it's important to understand that <a href="https://www.sitepoint.com/functional-reactive-programming-rxjs/" target="_blank">Rx*</a>, <a href="https://baconjs.github.io/" target="_blank">Bacon.js</a>, <a href="http://blog.angular-university.io/functional-reactive-programming-for-angular-2-developers-rxjs-and-observables/" target="_blank">Angular</a>, and others are <em>not</em> consistent with the two primary fundamentals of Conal Elliot's definition of FRP. <a href="https://stackoverflow.com/questions/5875929/specification-for-a-functional-reactive-programming-language#comment36554089_5878525" target="_blank">Elliot states that Rx* and Bacon.js are not FRP. Instead, they are "compositional event systems <em>inspired</em> by FRP"</a>.</p>

<p class="selectionShareable">Functional reactive programming, <em>as it relates specifically to JavaScript implementations</em>, refers to programming in a <a href="#functional-programming" target="_self">functional</a> style while creating and reacting to <a href="#observables" target="_self">streams</a>. This is fairly far from Elliot's original formulation (which <a href="http://conal.net/talks/essence-and-origins-of-frp-lambdajam-2015.pdf" target="_blank">specifically <em>excludes</em> streams as a component</a>), but is nevertheless inspired by traditional FRP.</p>

<p class="selectionShareable">It's also crucial to understand that JavaScript inherently interacts with the user and UI, the DOM, and often a backend. <a href="#purity" target="_self">Side effects</a> and <a href="#imperative-declarative" target="_self">imperative</a> code are par for the course, even when taking a <a href="#functional-programming" target="_self">functional</a> or functional reactive approach. <em>Without</em> imperative or impure code, a JS web application with a UI wouldn't be much use because it couldn't interact with its environment.</p>

<p class="selectionShareable">Let's take a look at an example to demonstrate the basic principles of <em>FRP-inspired</em> JavaScript. This sample uses RxJS and prints out mouse movements over a period of ten seconds:</p>

<pre><code class="js hljs javascript"><span class="comment">// create a time observable that adds an item every 1 second</span>
<span class="comment">// map so resulting stream contains event values</span>
<span class="keyword">const</span> time$ = 
  Rx.Observable
    .timer(<span class="number">0</span>, <span class="number">1000</span>)
    .timeInterval()
    .map(e =&gt; e.value);

<span class="comment">// create a mouse movement observable</span>
<span class="comment">// throttle to every 350ms</span>
<span class="comment">// map so resulting stream pushes objects with x and y coordinates</span>
<span class="keyword">const</span> move$ = 
  Rx.Observable
    .fromEvent(<span class="built_in">document</span>, <span class="string">'mousemove'</span>)
    .throttleTime(<span class="number">350</span>)
    .map(e =&gt; { <span class="keyword">return</span> {x: e.clientX, y: e.clientY} });

<span class="comment">// merge time + mouse movement streams</span>
<span class="comment">// complete after 10 seconds</span>
<span class="keyword">const</span> source$ = 
  Rx.Observable
    .merge(time$, move$)
    .takeUntil(Rx.Observable.timer(<span class="number">10000</span>));

<span class="comment">// subscribe to merged source$ observable</span>
<span class="comment">// if value is a number, createTimeset()</span>
<span class="comment">// if value is a coordinates object, addPoint()</span>
<span class="keyword">const</span> subscription = 
  source$.subscribe(
    <span class="comment">// onNext</span>
    (x) =&gt; { 
      <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">'number'</span>) {
        createTimeset(x);
      } <span class="keyword">else</span> {
        addPoint(x);
      }
    },
    <span class="comment">// onError</span>
    (err) =&gt; { <span class="built_in">console</span>.warn(<span class="string">'Error:'</span>, err); },
    <span class="comment">// onCompleted</span>
    () =&gt; { <span class="built_in">console</span>.info(<span class="string">'Completed'</span>); }
  );

<span class="comment">// add element to DOM to list out points touched in a particular second</span>
<span class="function"><span class="keyword">function</span> <span class="title">createTimeset</span>(<span class="params">n</span>) </span>{
  <span class="keyword">const</span> elem = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);
  <span class="keyword">const</span> num = n + <span class="number">1</span>;
  elem.id = <span class="string">'t'</span> + num;
  elem.innerHTML = <span class="string">`&lt;strong&gt;<span class="subst">${num}</span>&lt;/strong&gt;: `</span>;
  <span class="built_in">document</span>.body.appendChild(elem);
}

<span class="comment">// add points touched to latest time in stream</span>
<span class="function"><span class="keyword">function</span> <span class="title">addPoint</span>(<span class="params">pointObj</span>) </span>{
  <span class="comment">// add point to last appended element</span>
  <span class="keyword">const</span> numberElem = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>].lastChild;
  numberElem.innerHTML += <span class="string">` (<span class="subst">${pointObj.x}</span>, <span class="subst">${pointObj.y}</span>) `</span>;
}
</code></pre>

<p class="selectionShareable">You can check out this code in action in this <a href="https://jsfiddle.net/kmaida/3v8yw02s/" target="_blank">JSFiddle: FRP-inspired JavaScript</a>. Run the fiddle and move your mouse over the result area of the screen as it counts up to 10 seconds. You should see mouse coordinates appear along with the counter. This indicates where your mouse was during each 1-second time interval.</p>

<p class="selectionShareable">Let's briefly discuss this implementation step-by-step.</p>

<p class="selectionShareable">First, we'll create an <a href="#observables" target="_self">observable</a> called <code>time$</code>. This is a timer that adds a value to the collection every <code>1000ms</code> (every second). We need to <code>map</code> the timer event to extract its <code>value</code> and push it in the resulting stream.</p>

<p class="selectionShareable">Next, we'll create a <code>move$</code> observable from the <code>document.mousemove</code> event. Mouse movement is <em>continuous</em>. At any point in the sequence, there are an infinite number of points in between. We'll throttle this so the resulting stream is more manageable. Then we can <code>map</code> the event to return an object with <code>x</code> and <code>y</code> values to represent mouse coordinates.</p>

<p class="selectionShareable">Next we want to <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/merge.md" target="_blank">merge</a> the <code>time$</code> and <code>move$</code> streams. This is a <em>combining operator</em>. This way we can plot which mouse movements occurred during each time interval. We'll call the resulting observable <code>source$</code>. We'll also limit the <code>source$</code> observable so that it completes after ten seconds (<code>10000ms</code>).</p>

<p class="selectionShareable">Now that we have our merged stream of time and movement, we'll create a <code>subscription</code> to the <code>source$</code> observable so we can react to it. In our <code>onNext</code> callback, we'll check to see if the value is a <code>number</code> or not. If it is, we want to call a function called <code>createTimeset()</code>. If it's a coordinates object, we'll call <code>addPoint()</code>. In the <code>onError</code> and <code>onCompleted</code> callbacks, we'll simply log some information.</p>

<p class="selectionShareable">Let's look at the <code>createTimeset(n)</code> function. We'll create a new <code>div</code> element for each second interval, label it, and append it to the DOM.</p>

<p class="selectionShareable">In the <code>addPoint(pointObj)</code> function, we'll print out the latest coordinates in the most recent timeset <code>div</code>. This will associate each set of coordinates with its corresponding time interval. We can now read where the mouse has been over time.</p>

<blockquote><p class="selectionShareable"><strong>Note:</strong> These functions are <a href="#purity" target="_self">impure</a>: they have no return value and they also produce side effects. The side effects are DOM manipulations. As mentioned earlier, the JavaScript we need to write for our apps frequently interacts with scope outside its functions.</p></blockquote>

<h3>Functional Reactive Programming Takeaways</h3>

<p class="selectionShareable">FRP encodes actions that react to events using pure functions that map state from a previous point in time to the next point in time.  FRP in JavaScript doesn't adhere to the two primary fundamentals of Conal Elliot's FRP, but there is certainly value in abstractions of the original concept. JavaScript relies heavily on side effects and imperative programming, but we can certainly take advantage of the power of FRP concepts to improve our JS.</p>

<p class="selectionShareable">Finally, consider this quote from the <a href="http://eloquentjavascript.net/1st_edition/" target="_blank">first edition of Eloquent JavaScript</a> (the <a href="http://eloquentjavascript.net" target="_blank">second edition is available here</a>):</p>

<blockquote><p class="selectionShareable">"Fu-Tzu had written a small program that was full of global state and dubious shortcuts. Reading it, a student asked 'You warned us against these techniques, yet I find them in your program. How can this be?'</p>

<p class="selectionShareable">Fu-Tzu said 'There is no need to fetch a water hose when the house is not on fire.' {This is not to be read as an encouragement of sloppy programming, but rather as a warning against neurotic adherence to rules of thumb.}"</p>

<p class="selectionShareable">—<em>Marijn Haverbeke, <a href="http://eloquentjavascript.net/1st_edition/chapter6.html" target="_blank">Eloquent JavaScript, 1st Edition, Chapter 6</a></em></p></blockquote>

<p class="selectionShareable">To learn more about <strong>functional reactive programming (FRP)</strong>, check out the following resources:</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=vLmaZxegahk" target="_blank">Functional Reactive Programming for Beginners</a></li>
<li><a href="https://sideeffects.xyz/2015/the-functional-reactive-misconception/" target="_blank">The Functional Reactive Misconception</a></li>
<li><a href="http://stackoverflow.com/questions/1028250/what-is-functional-reactive-programming/1030631#1030631" target="_blank">What is Functional Reactive Programming?</a></li>
<li><a href="https://wiki.haskell.org/Functional_Reactive_Programming" target="_blank">Haskell - Functional Reactive Programming</a></li>
<li><a href="http://conal.net/fran/tutorial.htm" target="_blank">Composing Reactive Animations</a></li>
<li><a href="https://stackoverflow.com/questions/5875929/specification-for-a-functional-reactive-programming-language#5878525" target="_blank">Specification for a functional reactive programming language</a></li>
<li><a href="https://github.com/conal/talk-2015-more-elegant-frp" target="_blank">A more elegant specification for FRP</a></li>
<li><a href="https://www.youtube.com/watch?v=vLmaZxegahk" target="_blank">Functional Reactive Programming for Beginners</a></li>
<li><a href="http://elm-lang.org/blog/farewell-to-frp" target="_blank">Elm - A Farewell to FRP</a></li>
<li><a href="http://conal.net/blog/posts/early-inspirations-and-new-directions-in-functional-reactive-programming" target="_blank">Early inspirations and new directions in functional reactive programming</a></li>
<li><a href="https://blogs.janestreet.com/breaking-down-frp/" target="_blank">Breaking Down FRP</a></li>
<li><a href="https://twitter.com/ReactiveX/status/483625917491970048" target="_blank">Rx* is not FRP</a></li>
</ul>


<hr>

<h2>Conclusion</h2>

<p class="selectionShareable">We'll conclude with another excellent quote from the first edition of <a href="http://eloquentjavascript.net/1st_edition/" target="_blank">Eloquent JavaScript</a>:</p>

<blockquote><p class="selectionShareable">"A student had been sitting motionless behind his computer for hours, frowning darkly. He was trying to write a beautiful solution to a difficult problem, but could not find the right approach. Fu-Tzu hit him on the back of his head and shouted '<em>Type something!</em>' The student started writing an ugly solution. After he had finished, he suddenly understood the beautiful solution."</p>

<p class="selectionShareable">—<em>Marijn Haverbeke, <a href="http://eloquentjavascript.net/1st_edition/chapter6.html" target="_blank">Eloquent JavaScript, 1st Edition, Chapter 6</a></em></p></blockquote>

<p class="selectionShareable">The concepts necessary for understanding <a href="#functional-programming" target="_self">functional programming</a>, <a href="#reactive-programming" target="_self">reactive programming</a>, and <a href="#functional-reactive-programming" target="_self">functional reactive programming</a> can be difficult to grasp, let alone <em>master</em>. Writing code that takes advantage of a paradigm's fundamentals is the initial step, even if it isn't entirely faithful at first. Practice illuminates the path ahead and also reveals potential revisions.</p>

<p class="selectionShareable">With this glossary as a starting point, you can begin taking advantage of these concepts and programming paradigms to increase your JavaScript expertise. If anything is still unclear regarding these topics, please consult the links in each section for additional resources. We'll cover more concepts in the next Modern JS Glossary post!</p>

            </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-11" name="t-11"></a><h1>11 : ES6 Features</h1>
					<div class="tutorial__content">
						<a href="https://codetower.github.io/es6-features/">https://codetower.github.io/es6-features/</a>
						
<h2 id="arrow-functions">Arrow Functions</h2>
<p>A short hand notation for <code>function()</code>, but it does not bind <code>this</code>.</p>
<pre><code class="lang-javascript">no-eval
var odds = evens.map(v =&gt; v + 1);  // no parentes and no brackets
var nums = evens.map((v, i) =&gt; v + i);
var pairs = evens.map(v =&gt; ({even: v, odd: v + 1}));

// Statement bodies
nums.forEach(v =&gt; {
  if (v % 5 === 0)
    fives.push(v);
});
</code></pre>
<p>How does <code>this</code> work?</p>
<pre><code class="lang-javascript">var object = {
    name: "Name", 
    arrowGetName: () =&gt; this.name,
    regularGetName: function() { return this.name },
    arrowGetThis: () =&gt; this,
    regularGetThis: function() { return this }
}

console.log(this.name)
console.log(object.arrowGetName());
console.log(object.arrowGetThis());
console.log(this)
console.log(object.regularGetName());
console.log(object.regularGetThis());
</code></pre>

<h2 id="classes">Classes</h2>
<p>As we know them from "real" languages. Syntactic sugar on top of prototype-inheritence. </p>
<pre><code class="lang-javascript">no-eval
class SkinnedMesh extends THREE.Mesh {
  constructor(geometry, materials) {
    super(geometry, materials);

    this.idMatrix = SkinnedMesh.defaultMatrix();
    this.bones = [];
    this.boneMatrices = [];
    //...
  }
  update(camera) {
    //...
    super.update();
  }
  get boneCount() {
    return this.bones.length;
  }
  set matrixType(matrixType) {
    this.idMatrix = SkinnedMesh[matrixType]();
  }
  static defaultMatrix() {
    return new THREE.Matrix4();
  }
}
</code></pre>
<p><a href="https://lebab.io/#">Lebab.io</a></p>
<h2 id="enhanced-object-literals">Enhanced Object Literals</h2>
<pre><code class="lang-javascript">var theProtoObj = {
  toString: function() {
    return "The ProtoOBject To string"
  }
}

var handler = () =&gt; "handler"


var obj = {
    // __proto__
    __proto__: theProtoObj,

    // Shorthand for 'handler: handler'
    handler,

    // Methods
    toString() {

     // Super calls
     return "d " + super.toString();
    },

    // Computed (dynamic) property names
    [ "prop_" + (() =&gt; 42)() ]: 42
};

console.log(obj.handler)
console.log(obj.handler())
console.log(obj.toString())
console.log(obj.prop_42)
</code></pre>
<h2 id="string-interpolation">String interpolation</h2>
<p>Nice syntax for string interpolation (but sligthly worse performance, <a href="http://stackoverflow.com/questions/29055518/are-es6-template-literals-faster-than-string-concatenation">Source</a>)</p>
<pre><code class="lang-javascript">var name = "Bob", time = "today";

var multiLine = `This

Line

Spans Multiple

Lines`


console.log(`Hello ${name},how are you ${time}?`)
console.log(multiLine)
</code></pre>
<h2 id="destructuring">Destructuring</h2>
<pre><code class="lang-javascript">// list "matching"
var [a, , b] = [1,2,3];
console.log(a)
console.log(b)
</code></pre>
<p> Objects can be destructured as well. </p>
<pre><code class="lang-javascript">nodes = () =&gt; { return {op: "a", lhs: "b", rhs: "c"}}
var { op: a, lhs: b , rhs: c } = nodes()
console.log(a)
console.log(b)
console.log(c)
</code></pre>
<p> Using Shorthand notation.</p>
<pre><code class="lang-javascript">nodes = () =&gt; { return {lhs: "a", op: "b", rhs: "c"}}

// binds `op`, `lhs` and `rhs` in scope
var {op, lhs, rhs} = nodes()

console.log(op)
console.log(lhs)
console.log(rhs)
</code></pre>
<p>Can be used in parameter position</p>
<pre><code class="lang-javascript">
function g({name: x}) {
  return x
}

function m({name}) {
  return name
}

console.log(g({name: 5}))
console.log(m({name: 5}))
</code></pre>
<p>Fail-soft destructuring</p>
<pre><code class="lang-javascript">var [a] = []
var [b = 1] = []
var c = [];
console.log(a)
console.log(b);
console.log(c);
</code></pre>
<h2 id="default">Default</h2>
<pre><code class="lang-javascript">function f(x, y=12) {
  return x + y;
}

console.log(f(3))
</code></pre>
<h2 id="spread">Spread</h2>
<p>In functions</p>
<pre><code class="lang-javascript">function f(x, y, z) {
  return x + y + z;
}
// Pass each elem of array as argument
console.log(f(...[1,2,3]))
</code></pre>
<p>In arrays</p>
<pre><code class="lang-javascript">var parts = ["shoulders", "knees"];
var lyrics = ["head", ...parts, "and", "toes"]; 

console.log(lyrics)
</code></pre>
<h2 id="spread-object-literals">Spread + Object Literals</h2>
<p>We can do cool stuff with this in object creations.</p>
<pre><code class="lang-javascript">no-eval
let { x, y, ...z } = { x: 1, y: 2, a: 3, b: 4 };
console.log(x); // 1
console.log(y); // 2
console.log(z); // { a: 3, b: 4 }

// Spread properties
let n = { x, y, ...z };
console.log(n); // { x: 1, y: 2, a: 3, b: 4 }
console.log(obj)
</code></pre>
<p>Sadly it is not support yet</p>
<p><code>npm install --save-dev babel-plugin-transform-object-rest-spread</code></p>
<h2 id="rest">Rest</h2>
<pre><code class="lang-javascript">function demo(part1, ...part2) {
    return ({part1, part2})
}

console.log(demo(1,2,3,4,5,6))
</code></pre>
<h2 id="let">Let</h2>
<p><code>Let</code> is the new <code>var</code>. As it has "sane" bindings.</p>
<pre><code class="lang-javascript">{
   var globalVar = "from demo1"
}

{
   let globalLet = "from demo2";
}

console.log(globalVar)
console.log(globalLet)
</code></pre>
<p>However, it does not assigne anything to <code>window</code></p>
<pre><code class="lang-javascript">let me = "go";  // globally scoped
var i = "able"; // globally scoped

console.log(window.me); 
console.log(window.i);
</code></pre>
<p>It is not possible to redeclare a variable using <code>let</code></p>
<pre><code class="lang-javascript">
let me = "foo";
let me = "bar"; 
console.log(me);
</code></pre>
<pre><code class="lang-javascript">
var me = "foo";
var me = "bar"; 
console.log(me)
</code></pre>
<h2 id="const">Const</h2>
<p><code>Const</code> is for read only variables</p>
<pre><code class="lang-javascript">const a = "b"
a = "a"
</code></pre>
<h2 id="for-of">For..of</h2>
<p>New type of iterators with an alternative to the <code>for..in</code>. It returns the value instead of the <code>keys</code>.</p>
<pre><code class="lang-javascript">let list = [4, 5, 6];

console.log(list)

for (let i in list) {
   console.log(i);
}
</code></pre>
<pre><code class="lang-javascript">let list = [4, 5, 6];

console.log(list)


for (let i of list) {
   console.log(i); 
}
</code></pre>
<h3 id="iterators">Iterators</h3>
<p>The iterator is a more dynamic type than arrays. </p>
<pre><code class="lang-javascript">let infinite = {
  [Symbol.iterator]() {
    let c = 0;
    return {
      next() {
        c++;
        return { done: false, value: c }
      }
    }
  }
}

console.log("start");

for (var n of infinite) {
  // truncate the sequence at 1000
  if (n &gt; 10)
    break;
  console.log(n);
}
</code></pre>
<p>Using Typescript interfaces we can see how it looks</p>
<pre><code class="lang-javascript">no-eval
interface IteratorResult {
  done: boolean;
  value: any;
}
interface Iterator {
  next(): IteratorResult;
}
interface Iterable {
  [Symbol.iterator](): Iterator
}
</code></pre>
<h3 id="generators">Generators</h3>
<p>Generators create iterators, and are more dynamic than iterators. They do not have to keep track of state in the same manner and does not support the concept of done. </p>
<pre><code class="lang-javascript">var infinity = {
  [Symbol.iterator]: function*() {
    var c = 1;
    for (;;) {   
      yield c++;
    }
  }
}

console.log("start")
for (var n of infinity) {
  // truncate the sequence at 1000
  if (n &gt; 10)
    break;
  console.log(n);
}
</code></pre>
<p>Using typescript again to show the interfaces. </p>
<pre><code class="lang-javascript">no-eval
interface Generator extends Iterator {
    next(value?: any): IteratorResult;
    throw(exception: any);
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*">function*</a>
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Guide/Iterators_and_Generators">Iterators and generator</a></p>
<p>An example of yield* </p>
<pre><code class="lang-javascript">function* anotherGenerator(i) {
  yield i + 1;
  yield i + 2;
  yield i + 3;
}

function* generator(i) {
  yield i;
  yield* anotherGenerator(i);
  yield i + 10;
}

var gen = generator(10);

console.log(gen.next().value); 
console.log(gen.next().value); 
console.log(gen.next().value); 
console.log(gen.next().value); 
console.log(gen.next().value);
</code></pre>
<h2 id="unicode">Unicode</h2>
<p>ES6 provides better support for Unicode. </p>
<pre><code class="lang-javascript">var regex = new RegExp('\u{61}', 'u');

console.log(regex.unicode)
console.log("\uD842\uDFD7")
console.log("\uD842\uDFD7".codePointAt())
</code></pre>
<h2 id="modules-module-loaders">Modules &amp; Module Loaders</h2>
<p>Native support for modules.</p>
<pre><code class="lang-javascript">no-eval
import defaultMember from "module-name";
import * as name from "module-name";
import { member } from "module-name";
import { member as alias } from "module-name";
import { member1 , member2 } from "module-name";
import { member1 , member2 as alias2 , [...] } from "module-name";
import defaultMember, { member [ , [...] ] } from "module-name";
import defaultMember, * as name from "module-name";
import "module-name";
</code></pre>
<pre><code class="lang-javascript">no-eval
export { name1, name2, …, nameN };
export { variable1 as name1, variable2 as name2, …, nameN };
export let name1, name2, …, nameN; // also var
export let name1 = …, name2 = …, …, nameN; // also var, const

export expression;
export default expression;
export default function (…) { … } // also class, function*
export default function name1(…) { … } // also class, function*
export { name1 as default, … };

export * from …;
export { name1, name2, …, nameN } from …;
export { import1 as name1, import2 as name2, …, nameN } from …;
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">Import</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export">Export</a></p>
<h2 id="set">Set</h2>
<p>Sets as in the mathematical counterpart where all items are unique. </p>
<pre><code class="lang-javascript">var set = new Set();
set.add("Potato").add("Tomato").add("Tomato");
console.log(set.size)
console.log(set.has("Tomato"))

for(var item of set) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a></p>
<h2 id="weakset">WeakSet</h2>
<p>The <code>WeakSet</code> object lets you store weakly held objects in a collection. Objects without an reference will be garbage collected. </p>
<pre><code class="lang-javascript">var item = { a:"Potato"}
var set = new WeakSet();
set.add({ a:"Potato"}).add(item).add({ a:"Tomato"}).add({ a:"Tomato"});
console.log(set.size)
console.log(set.has({a:"Tomato"}))
console.log(set.has(item))

for(let item of set) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet">WeakSet</a></p>
<h2 id="map">Map</h2>
<p>Maps, also known as dictonary. </p>
<pre><code class="lang-javascript">var map = new Map();
map.set("Potato", 12);
map.set("Tomato", 34);

console.log(map.get("Potato"))


for(let item of map) {
   console.log(item)
}


for(let item in map) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a></p>
<h2 id="weakmap">WeakMap</h2>
<p>Uses objects for keys, and only keeps weak reference to the keys.</p>
<pre><code class="lang-javascript">var wm = new WeakMap();

var o1  = {}
var o2  = {}
var o3  = {}


wm.set(o1, 1);
wm.set(o2, 2);
wm.set(o3, {a: "a"});
wm.set({}, 4);

console.log(wm.get(o2));
console.log(wm.has({}))

delete o2;

console.log(wm.get(o3));

for(let item in wm) {
   console.log(item)
}


for(let item of wm) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a></p>
<h2 id="proxies">Proxies</h2>
<p>Proxies can be used to alter objects behavoir. It allows us to define traps.</p>
<pre><code class="lang-javascript">
var obj = function ProfanityGenerator() {
    return {
       words: "Horrible words"    
    }
}()

var handler = function CensoringHandler() {
        return {
        get: function (target, key) {
            return target[key].replace("Horrible", "Nice");
        },
    }

}()

var proxy = new Proxy(obj, handler);

console.log(proxy.words);
</code></pre>
<p>The following traps are available</p>
<pre><code class="lang-javascript">no-eval
var handler =
{
  get:...,
  set:...,
  has:...,
  deleteProperty:...,
  apply:...,
  construct:...,
  getOwnPropertyDescriptor:...,
  defineProperty:...,
  getPrototypeOf:...,
  setPrototypeOf:...,
  enumerate:...,
  ownKeys:...,
  preventExtensions:...,
  isExtensible:...
}
</code></pre>
<p><a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxies</a></p>
<h2 id="symbols">Symbols</h2>
<p>Symbols are a new type. Can be used to create anomymous properties.</p>
<pre><code class="lang-javascript">var typeSymbol = Symbol("type");

class Pet {

  constructor(type) {

    this[typeSymbol] = type;

  }
  getType() {
     return this[typeSymbol];
  }

}


var a = new Pet("dog");
console.log(a.getType());
console.log(Object.getOwnPropertyNames(a))


console.log(Symbol("a") === Symbol("a"))
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">More info</a></p>
<h2 id="inheritable-built-ins">Inheritable Built-ins</h2>
<p>We can now inherit from native classes. </p>
<pre><code class="lang-javascript">
class CustomArray extends Array {

}

var a = new CustomArray();

a[0] = 2
console.log(a[0])
</code></pre>
<p>It is not possible to override the getter function without using Proxies of arrays.</p>
<h2 id="new-library">New Library</h2>
<p>Various new methods and constants.</p>
<pre><code class="lang-javascript">console.log(Number.EPSILON)
console.log(Number.isInteger(Infinity))
console.log(Number.isNaN("NaN"))

console.log(Math.acosh(3))
console.log(Math.hypot(3, 4))
console.log(Math.imul(Math.pow(2, 32) - 1, Math.pow(2, 32) - 2))

console.log("abcde".includes("cd") )
console.log("abc".repeat(3) )


console.log(Array.of(1, 2, 3) )
console.log([0, 0, 0].fill(7, 1) )
console.log([1, 2, 3].find(x =&gt; x == 3) )
console.log([1, 2, 3].findIndex(x =&gt; x == 2)) 
console.log([1, 2, 3, 4, 5].copyWithin(3, 0)) 
console.log(["a", "b", "c"].entries() )
console.log(["a", "b", "c"].keys() )
console.log(["a", "b", "c"].values() )

console.log(Object.assign({}, { origin: new Point(0,0) }))
</code></pre>
<p>Documentation: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Number</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math">Math</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from">Array.from</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/of">Array.of</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/copyWithin">Array.prototype.copyWithin</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a></p>
<h2 id="binary-and-octal">Binary and Octal</h2>
<p>Literals for binary and octal numbering.</p>
<pre><code class="lang-javascript">console.log(0b11111)
console.log(0o2342)

console.log(0xff); // also in es5
</code></pre>
<h2 id="promises">Promises</h2>
<p>The bread and butter for async programing. </p>
<pre><code class="lang-javascript">var p1 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; resolve("1"), 101)
})
var p2 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; resolve("2"), 100)
})

Promise.race([p1, p2]).then((res) =&gt; {
   console.log(res)
})

Promise.all([p1, p2]).then((res) =&gt; {
   console.log(res)
})
</code></pre>
<h3 id="quick-promise">Quick Promise</h3>
<p>Need a quick always resolved promise?</p>
<pre><code class="lang-javascript">
var p1 = Promise.resolve("1")
var p2 = Promise.reject("2")

Promise.race([p1, p2]).then((res) =&gt; {
   console.log(res)
})
</code></pre>
<h3 id="fail-fast">Fail fast</h3>
<p>If a promise fails <code>all</code> and <code>race</code> will reject as well. </p>
<pre><code class="lang-javascript">var p1 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; resolve("1"), 1001)
})
var p2 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; reject("2"), 1)
})

Promise.race([p1, p2]).then((res) =&gt; {
   console.log("success" + res)
}, res =&gt; {
   console.log("error " + res)
})

Promise.all([p1, p2]).then((res) =&gt; {
   console.log("success" + res)
}, res =&gt; {
   console.log("error " + res)
})
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">More Info</a></p>
<h2 id="reflect">Reflect</h2>
<p>New type of meta programming with new API for existing and also few new methods. </p>
<pre><code class="lang-javascript">
var z = {w: "Super Hello"}
var y = {x: "hello", __proto__: z};

console.log(Reflect.getOwnPropertyDescriptor(y, "x"));
console.log(Reflect.has(y, "w"));
console.log(Reflect.ownKeys(y, "w"));

console.log(Reflect.has(y, "x"));
console.log(Reflect.deleteProperty(y,"x"))
console.log(Reflect.has(y, "x"));
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect">More Info</a></p>
<h2 id="tail-call-optimization">Tail Call Optimization</h2>
<p>ES6 should fix ensure tail calls does not generate stack overflow. (Not all implementations work).</p>
<pre><code class="lang-javascript">
function factorial(n, acc = 1) {
    if (n &lt;= 1) return acc; 
    return factorial(n - 1, n * acc);
}
console.log(factorial(10))
console.log(factorial(100))
console.log(factorial(1000))
console.log(factorial(10000))
console.log(factorial(100000))
console.log(factorial(1000000))
</code></pre>

<!--================= ENDinject -->

					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-12" name="t-12"></a><h1>12 : "What's the typeof null?", and other confusing JavaScript Types</h1>
					<div class="tutorial__content">
						<p>The <code>typeof</code> operator in JavaScript evaluates and returns a string with the data type of an operand. For example, to find the type of <code>123</code>, we would write -</p>

<pre><code class="language-javascript">typeof 123  
</code></pre>

<p>This will return a string with the type of <code>123</code>, which, in this case, will be "number". In addition to "number", the <code>typeof</code> operator can return one of 6 potential results -</p>

<pre><code class="language-javascript">typeof 123 // "number"  
typeof "abc" // "string"  
typeof true // "boolean"  
typeof {a: 1} // "object"  
typeof function foo() {} // "function"  
typeof undefined // "undefined"  
typeof Symbol('foo') // "symbol"  
</code></pre>

<p>In the above examples, it's pretty straightforward what the type of the operands will be. However, there are a few cases where it is unclear or misunderstood what the type of the operand should be. </p>

<h2 id="whatsthetypeoftypeof123">What's the <code>typeof typeof 123</code>?</h2>

<pre><code class="language-javascript">typeof typeof 123 // "string"  
</code></pre>

<p>What is the type of a <code>typeof</code> expression? Well, the <code>typeof</code> operator always returns a string with the type of the operand passed to it. If the resultant type of the expression is, for example, a number, what will be returned is <code>"number"</code>. This means that, regardless of resultant type, the type of a <code>typeof [any operand]</code>, will always be a string. </p>

<h2 id="whatsthetypeofnan">What's the <code>typeof NaN</code>?</h2>

<pre><code class="language-javascript">typeof NaN // "number"  
</code></pre>

<p>The type of <code>NaN</code>, which stands for Not a Number is, surprisingly, a number. The reason for this is, in computing, <code>NaN</code> is actually technically a numeric data type. However, it is a numeric data type whose value cannot be represented using actual numbers. So, the name "Not a Number", doesn't mean that the value is not numeric. It instead means that the value cannot be expressed with numbers. </p>

<p>This also explains why not all <code>NaN</code> values are equal. For example - </p>

<pre><code class="language-javascript">const NaN1 = 2 * "abc";  
const NaN2 = 2 * "abc";

NaN1 === NaN2 // false  
</code></pre>

<p>Those two <code>NaN</code> values are not equal because they are not necessarily the same unrepresentable number. </p>

<h2 id="whatsthetypeof123">What's the <code>typeof [1,2,3]</code>?</h2>

<pre><code class="language-javascript">typeof [1,2,3] // "object"  
</code></pre>

<p>The <code>typeof</code> an array is an object. In JavaScript, arrays are technically objects; just with special behaviours and abilities. For example, arrays have a <code>Array.prototype.length</code> property, which will return the number of elements in the array. Arrays also have special methods, e.g. <code>Array.prototype.push()</code> or <code>Array.prototype.unshift()</code> (See <a href="https://bitsofco.de/javascript-array-methods-mutator-methods/">JavaScript Array Methods - Mutator Methods</a>).</p>

<p>To differentiate an Array object from an Object object, we can use the <code>Array.isArray()</code> method.</p>

<pre><code class="language-javascript">Array.isArray( [1,2,3] ) // true  
Array.isArray( { a: 1 } ) // false  
</code></pre>

<h2 id="whatsthetypeofnull">What's the <code>typeof null</code>?</h2>

<pre><code class="language-javascript">typeof null // "object"  
</code></pre>

<p>The <code>null</code> value is technically a primitive, the way "object" or "number" are primitives. This would typically mean that the type of null should also be "null". However, this is not the case because of a peculiarity with the way JavaScript was first defined.</p>

<p>In the first implementation of JavaScript, values were represented in two parts - a type tag and the actual value. There were 5 type tags that could be used, and the tag for referencing an object was <code>0</code>. The <code>null</code> value, however, was represented as the <code>NULL</code> pointer, which was <code>0x00</code> for most platforms. As a result of this similarity, null has the <code>0</code> type tag, which corresponds to an object.</p>

<h2 id="whatsthetypeofclassfoo">What's the <code>typeof class Foo {}</code>?</h2>

<pre><code class="language-javascript">typeof class Foo {} // "function"  
</code></pre>

<p>Finally, we have Classes. Classes were introduced in ES2015 (ES6) as a better syntax for prototype-based inheritance. Before Classes, to make an inheritable object, we would have to use a function. </p>

<pre><code class="language-javascript">function Dog() { }  
Dog.prototype.bark = function() {  
    alert("woof!");
}

const snoopy = new Dog();  
snoopy.bark() // alert("woof!")  
</code></pre>

<p>With Classes, we can create the same object this way - </p>

<pre><code class="language-javascript">class Dog {  
    bark() {
        alert("woof!");
    }
}

const snoopy = new Dog();  
snoopy.bark() // alert("woof!")  
</code></pre>

<p>However, Classes have always just been a syntactical wrapper around the function method. The same function is actually being created, but just with the author writing it in a different, cleaner way. This is why the <code>typeof</code> a Class, is still just a Function.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-13" name="t-13"></a><h1>13 : Asynchronous vs Deferred JavaScript</h1>
					<span>https://bitsofco.de/understanding-the-critical-rendering-path/</span>
					<div class="tutorial__content">
						  <p>In my article on <a href="https://bitsofco.de/understanding-the-critical-rendering-path/">Understanding the Critical Rendering Path</a>, I wrote about the effect JavaScript files have on the Critical Rendering Path.  </p>

<blockquote>
  <p>JavaScript is considered a "parser blocking resource". This means that the parsing of the HTML document itself is blocked by JavaScript. When the parser reaches a <code>&lt;script&gt;</code> tag, whether that be internal or external, it stops to fetch (if it is external) and run it. </p>
</blockquote>

<p>This behaviour can be problematic if we are loading several JavaScript files on a page, as this will interfere with the time to first paint even if the document is not actually dependent on those files. </p>

<p>Fortunately, the <code>&lt;script&gt;</code> element has two attributes, <code>async</code> and <code>defer</code>, that can give us more control over how and when external files are fetched and executed. </p>

<h2 id="normalexecution">Normal Execution</h2>

<p>Before looking into the effect of the two attributes, we must first look at what occurs in their absence. By default, as mentioned above, JavaScript files will interrupt the parsing of the HTML document in order for them to be fetched (if not inline) and executed. </p>

<p>Take, for example, this script element located somewhere in the middle of the page - </p>

<pre><code class="language-html">&lt;html&gt;  
&lt;head&gt; ... &lt;/head&gt;  
&lt;body&gt;  
    ...
    &lt;script src="script.js"&gt;
    ....
&lt;/body&gt;  
&lt;/html&gt;  
</code></pre>

<p>As the document parser goes through the page, this is what occurs - </p>

<p><img src="https://bitsofco.de/content/images/2017/02/Normal-Execution.png" alt="Normal JavaScript Execution. HTML Parsing paused for script fetching and execution"></p>

<p>The HTML parsing is paused for the script to be fetched and executed, thereby extending the amount of time it takes to get to first paint.</p>

<h2 id="theasyncattribute">The <code>async</code> Attribute</h2>

<p>The <code>async</code> attribute is used to indicate to the browser that the script file <em>can</em> be executed asynchronously. The HTML parser does not need to pause at the point it reaches the script tag to fetch and execute, the execution can happen whenever the script becomes ready after being fetched in parallel with the document parsing.</p>

<pre><code class="language-html">&lt;script async src="script.js"&gt;  
</code></pre>

<p>This attribute is only available for externally located script files. When an external script has this attribute, the file can be downloaded while the HTML document is still parsing. Once it has been downloaded, the parsing is paused for the script to be executed. </p>

<p><img src="https://bitsofco.de/content/images/2017/02/Async-Execution.png" alt="Asynchronous JavaScript Execution. HTML parsing is paused only for the script execution"></p>

<h2 id="thedeferattribute">The <code>defer</code> Attribute</h2>

<p>The <code>defer</code> attribute tells the browser to only execute the script file once the HTML document has been fully parsed.</p>

<pre><code class="language-html">&lt;script defer src="script.js"&gt;  
</code></pre>

<p>Like an asynchronously loaded script, the file can be downloaded while the HTML document is still parsing. However, even if the file is fully downloaded long before the document is finished parsing, the script is not executed until the parsing is complete.</p>

<p><img src="https://bitsofco.de/content/images/2017/02/Defer-Execution.png" alt="Deferred JavaScript Execution. HTML parsing is never paused. Script execution happens after parsing is complete"></p>

<h2 id="asynchronousdeferredornormalexecution">Asynchronous, Deferred or Normal Execution?</h2>

<p>So, when should we use asynchronous, deferred, or normal JavaScript execution? As always, it depends on the situation, and there are a few questions to consider.</p>

<h3 id="whereisthescriptelementlocated">Where is the <code>&lt;script&gt;</code> element located?</h3>

<p>Asynchronous and deferred execution of scripts are more important when the <code>&lt;script&gt;</code> element is not located at the very end of the document. HTML documents are parsed in order, from the first opening <code>&lt;html&gt;</code> element to it's close. If an externally sourced JavaScript file is placed right before the closing <code>&lt;/body&gt;</code> element, it becomes much less pertinent to use an <code>async</code> or <code>defer</code> attribute. Since the parser will have finished the vast majority of the document by that point, JavaScript files don't have much parsing left to block.</p>

<h3 id="isthescriptselfcontained">Is the script self-contained?</h3>

<p>For script files that are not dependent on other files and/or do not have any dependencies themselves, the <code>async</code> attribute is particularly useful. Since we do not care exactly at which point the file is executed, asynchronous loading is the most suitable option.</p>

<h3 id="doesthescriptrelyonafullyparseddom">Does the script rely on a fully parsed DOM?</h3>

<p>In many cases, the script file contains functionality that requires interaction with the DOM. Or, it may have a dependency on another file included on the page. In these cases, the DOM must be fully parsed before the script should be executed. Typically, such a file will be placed at the bottom of the page to ensure everything before it has been parsed. However, in situation where, for whatever reason, the file in question needs to be placed elsewhere, the <code>defer</code> attribute can be used. </p>

<h3 id="isthescriptasmalldependency">Is the script a (small) dependency?</h3>

<p>Finally, if the script is relatively small, and/or is depended on by other files, it may be more useful to have it defined inline. Although having it inline will block the parsing of the HTML document, it should not be a significant interference if it's a small size. Additionally, if it is depended on by other files, the minor blocking may be necessary. </p>

<h2 id="supportandmodernbrowserengines">Support and Modern Browser Engines</h2>

<p>It is worth noting that the behaviour of these attributes may be slightly different across different JavaScript engines. For example, in V8 (used in Chromium), an attempt is made to parse all scripts, regardless of their attributes, on a separate dedicated thread for script execution. This way, the "parser blocking" nature of JavaScript files should be minimised as a default. </p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-14" name="t-14"></a><h1>14 : An Overview of Client-Side Storage</h1>
					<div class="tutorial__content">
						 <p>Storing data directly within the browser has a lot of benefits, the main one being quick and network-independent access to a "database". There are currently four active methods (plus one deprecated), for storing data on the client side - </p>

<ol>
<li>Cookies  </li>
<li>Local Storage  </li>
<li>Session Storage  </li>
<li>IndexedDB  </li>
<li>WebSQL (deprecated)</li>
</ol>

<h2 id="cookies">Cookies</h2>

<p>Cookies are the classic way of storing simple string data within a document. Typically, cookies are sent from the server to the client, which can then store it, and send it back to the server on subsequent requests. This can be used for things like managing account sessions and tracking user information. </p>

<p>Additionally, cookies can be used for storing data purely on the client-side. Because of this, they have also been used for storing general data, such as user preferences. </p>

<h3 id="basiccrudwithcookies">Basic CRUD with Cookies</h3>

<p>We can create, read, update, and delete cookies using the following syntax -</p>

<pre><code class="language-javascript">// Create
document.cookie = "user_name=Ire Aderinokun";  
document.cookie = "user_age=25;max-age=31536000;secure";

// Read (All)
console.log( document.cookie );

// Update
document.cookie = "user_age=24;max-age=31536000;secure"; 

// Delete
document.cookie = "user_name=Ire Aderinokun;expires=Thu, 01 Jan 1970 00:00:01 GMT";  
</code></pre>

<h3 id="advantagesofcookies">Advantages of Cookies</h3>

<ul>
<li>They can be used for communication with the server</li>
<li>We can set when we want the cookie to expire automatically, instead of having to manually delete</li>
</ul>

<h3 id="disadvantagesofcookies">Disadvantages of Cookies</h3>

<ul>
<li>They add to the page load of the document</li>
<li>They can only store a small amount of data</li>
<li>They can only store Strings</li>
<li>Potential <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie#Security">security issues</a></li>
<li>It is not the recommended method for client-side storage anymore since the introduction of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API">Web Storage API</a> (Local and Session Storage)</li>
</ul>

<h3 id="support">Support</h3>

<p>Cookies have basic support in all major browsers.</p>

<h2 id="localstorage">Local Storage</h2>

<p>Local Storage is one type of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API">Web Storage API</a>, which is an API for storing key-value pairs of data within the browser. It arose as a solution to the issues with Cookies, by offering a more intuitive and secure API for storing simple data within the browser. </p>

<p>Although technically we can only store strings in Local Storage, this can be worked around by storing stringified JSON. This allows us to store a bit more complex data in Local Storage than we can with Cookies. </p>

<h3 id="basiccrudwithlocalstorage">Basic CRUD with Local Storage</h3>

<p>We can create, read, update, and delete data to Local Storage using the following syntax -</p>

<pre><code class="language-javascript">// Create
const user = { name: 'Ire Aderinokun', age: 25 }  
localStorage.setItem('user', JSON.stringify(user));

// Read (Single)
console.log( JSON.parse(localStorage.getItem('user')) ) 

// Update
const updatedUser = { name: 'Ire Aderinokun', age: 24 }  
localStorage.setItem('user', JSON.stringify(updatedUser));

// Delete
localStorage.removeItem('user');  
</code></pre>

<h3 id="advantagesoflocalstorage">Advantages of Local Storage</h3>

<ul>
<li>Offers a more simple intuitive interface to storing data (than Cookies)</li>
<li>More secure for client-side storage (than Cookies)</li>
<li>Allows for the storage of more data (than Cookies)</li>
</ul>

<h3 id="disadvantagesoflocalstorage">Disadvantages of Local Storage</h3>

<ul>
<li>Only allows the storage of Strings</li>
</ul>

<h3 id="support">Support</h3>

<h2 id="sessionstorage">Session Storage</h2>

<p>Session Storage is the second type  of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API">Web Storage API</a>. It is exactly the same as Local Storage, except that the data is only stored for the browser tab session. Once the user closes that browser tab, the data is cleared.</p>

<h3 id="basiccrudwithsessionstorage">Basic CRUD with Session Storage</h3>

<p>We can create, read, update, and delete data to Session Storage using the following syntax -</p>

<pre><code class="language-javascript">// Create
const user = { name: 'Ire Aderinokun', age: 25 }  
sessionStorage.setItem('user', JSON.stringify(user));

// Read (Single)
console.log( JSON.parse(sessionStorage.getItem('user')) ) 

// Update
const updatedUser = { name: 'Ire Aderinokun', age: 24 }  
sessionStorage.setItem('user', JSON.stringify(updatedUser));

// Delete
sessionStorage.removeItem('user');  
</code></pre>

<h3 id="advantagesdisadvantagesandsupportforsessionstorage">Advantages, Disadvantages, and Support for Session Storage</h3>

<p>Same as for Local Storage.</p>

<h2 id="indexeddb">IndexedDB</h2>

<p>IndexedDB is a much more complex and well-rounded solution for storing data in the browser. It is a "low-level API for client-side storage of significant amounts of structured data" (Mozilla). It is a JavaScript-based, object-oriented, database that allows us to easily store and retrieve data that has been indexed with a key.</p>

<p>In my article on <a href="https://bitsofco.de/bitsofcode-pwa-part-2-instant-loading-with-indexeddb/">Building a Progressive Web Application</a>, I went over in more detail how you can use IndexedDB to create an offline-first application.  </p>

<h3 id="basiccrudwithindexeddb">Basic CRUD with IndexedDB</h3>

<p><small> <br>
Note: In all my examples, I uses Jake Archibald's <a href="https://github.com/jakearchibald/idb">IndexedDB Promised library</a> which offers a Promise-ified version of the IndexedDB methods. <br>
</small></p>

<p>Using IndexedDB is more complicated than the other browser storage methods. Before we can create/read/update/delete any data, we need to first open up the database, creating any stores (which are like tables in a database) we need. </p>

<pre><code class="language-javascript">function OpenIDB() {  
    return idb.open('SampleDB', 1, function(upgradeDb) {
        const users = upgradeDb.createObjectStore('users', {
            keyPath: 'name'
        });
    });
}
</code></pre>

<p>To create (or update) data within a store, we need to go through the following steps - </p>

<pre><code class="language-javascript">// 1. Open up the database
OpenIDB().then((db) =&gt; {  
    const dbStore = 'users';

    // 2. Open a new read/write transaction with the store within the database
    const transaction = db.transaction(dbStore, 'readwrite');
    const store = transaction.objectStore(dbStore);

    // 3. Add the data to the store
    store.put({
        name: 'Ire Aderinokun',
        age: 25
    });

    // 4. Complete the transaction
    return transaction.complete;
});
</code></pre>

<p>To retrieve data, we need to go through the following - </p>

<pre><code class="language-javascript">// 1. Open up the database
OpenIDB().then((db) =&gt; {  
    const dbStore = 'users';

    // 2. Open a new read-only transaction with the store within the database
    const transaction = db.transaction(dbStore);
    const store = transaction.objectStore(dbStore);

    // 3. Return the data
    return store.get('Ire Aderinokun');
}).then((item) =&gt; {
    console.log(item);
})
</code></pre>

<p>Finally, to delete data, we need to do the following - </p>

<pre><code class="language-javascript">// 1. Open up the database
OpenIDB().then((db) =&gt; {  
    const dbStore = 'users';

    // 2. Open a new read/write transaction with the store within the database
    const transaction = db.transaction(dbStore, 'readwrite');
    const store = transaction.objectStore(dbStore);

    // 3. Delete the data corresponding to the passed key
    store.delete('Ire Aderinokun');

    // 4. Complete the transaction
    return transaction.complete;
})
</code></pre>

<p>If you're interested in learning more about how to use IndexedDB, you can read my <a href="https://bitsofco.de/bitsofcode-pwa-part-2-instant-loading-with-indexeddb/">article</a> showing how I used it in a Progressive Web Application.</p>

<h3 id="advantagesofindexeddb">Advantages of IndexedDB</h3>

<ul>
<li>Can handle more complex, structured, data</li>
<li>Can have multiple "databases" and "tables" within each "database"</li>
<li>More allowance for storage</li>
<li>More control over how we interact with it</li>
</ul>

<h3 id="disadvantagesofindexeddb">Disadvantages of IndexedDB</h3>

<ul>
<li>More complex to use than the Web Storage API</li>
</ul>

<h3 id="support">Support</h3>


<h2 id="websql">WebSQL</h2>

<p>WebSQL is an API for a relational database on the client, similar to SQLite. Since 2010, the W3C Web Applications Working Group has ceased working on the specification. <strong>It is no longer a part of HTML specification, and should not be used</strong>.</p>

<h2 id="acomparison">A Comparison</h2>

<table>  
<thead>  
<tr class="header">  
<th>Feature</th>  
<th>Cookies</th>  
<th>Local Storage</th>  
<th>Session Storage</th>  
<th>IndexedDB</th>  
</tr>  
</thead>  
<tbody>  
<tr>  
<td>Storage Limit</td>  
<td><a href="http://browsercookielimits.squawky.net/">~4KB</a></td>  
<td><a href="http://dev-test.nemikor.com/web-storage/support-test/">~5MB</a></td>  
<td><a href="http://dev-test.nemikor.com/web-storage/support-test/">~5MB</a></td>  
<td><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria">Up to half of hard drive</a></td>  
</tr>  
<tr>  
<td>Persistent Data?</td>  
<td>Yes</td>  
<td>Yes</td>  
<td>No</td>  
<td>Yes</td>  
</tr>

<tr>  
<td>Data Value Type</td>  
<td>String</td>  
<td>String</td>  
<td>String</td>  
<td>Any structured data</td>  
</tr>  
<tr>  
<td>Indexable?</td>  
<td>No</td>  
<td>No</td>  
<td>No</td>  
<td>Yes</td>  
</tr>

</tbody>  
</table>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-15" name="t-15"></a><h1>15 : Back to JavaScript Basics: VARIABLES!</h1>
					<div class="tutorial__content">

<p>So, let's talk about variables. First, a definition:</p>

<p><strong>Variable</strong>: A label that points to a value that is stored in memory. Once a variable is assigned, you can refer to it later in your code. </p>

<p>OK, that's nice, you might think. But what's the big? There are TWO big reasons why we care about this property of variables that I'll go over real quick. </p>

<h3 id="buildingefficientprograms">Building efficient programs</h3>

<pre data-preserve-html-node="true"><code data-preserve-html-node="true">var storedNum = (1+1)*2;
console.log(result); // 4
console.log(result); // 4</code></pre>

In this example, the variable <code data-preserve-html-node="true">storedNum</code> is computed only once, and the computed result is logged twice. 

If you ran <code data-preserve-html-node="true">console.log((1+1)*2);</code> each time you needed to access the stored number, the computer would have to compute the result each time. Maybe that's fine for this super simple example, but you can imagine how this would be meaningfully inefficient if you had a  complex computation that required a non-trivial amount of memory. 

What else should you know about variables? You can use them to point to the values stored in other variables! 

<pre data-preserve-html-node="true">var storedNum = (1+1)*2;
console.log(storedNum); // 4
var other = storedNum; 
storedNum = 5;
console.log(other); // 4
</pre>

<p>If you're wondering why <code data-preserve-html-node="true">other</code> still evaluates to 4, even after <code data-preserve-html-node="true">storedNum</code> is set to 5, it might help to think of variables as physical labels, or nametags. </p>

<p>Let's say you have a "cookie" nametag on a box of Oreos, and then you stick a "milk" nametag on the same box. Now imagine you peel off the "cookie" nametag and put it on a box of Teddy Grahams. What happens to the "milk" nametag? It's still on the box of Oreos. Just because you moved the "cookie" nametag to the Teddy Grahams box, it doesn't mean that the "milk" nametag moves to the Teddy Grahams. The "milk" nametag stays on the Oreos until it's moved and affixed to something else.</p>

<p>Man. Now I really want Oreos. </p>

<p>Here's another way to think about variables pointing to other variables:</p>

<pre data-preserve-html-node="true">var storedNum = (1+1)*2;
console.log(storedNum); // 4
var other = storedNum + 0; 
storedNum = 5;
console.log(other); // 4
</pre>

<p>One helpful trick is to assign <code data-preserve-html-node="true">other</code> a value of <code data-preserve-html-node="true">storedNum + 0</code>. This the exact same thing as before, but makes it clearer that <code data-preserve-html-node="true">other</code> is independent of the <code data-preserve-html-node="true">storedNum</code> variable. </p>

<p><em>* But, seriously, why do we care? *</em></p>

<h3 id="accessingcertainvalues">Accessing certain values</h3>

<p>The second major reason that we care about variables is because sometimes it's not possible to type out a literal that represents a value in your program. For example, let's say you need a random number: </p>

<pre data-preserve-html-node="true">var randomNum = Math.random();
console.log(randomNum);
</pre>

<p>Since you don't know what the random number will be, you have to store the value in a variable if you want to access that random number value later. </p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-16" name="t-16"></a><h1>16 : Quick Tip: How to Sort an Array of Objects in JavaScript</h1>
					<div class="tutorial__content">
<p class="wp-special">If you have an array of objects that you need to sort into a certain order, the temptation might be to reach for a JavaScript library. Before you do however, rember that you can do some pretty neat sorting with the native <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">Array.sort</a> function. In this article I'll show you how to sort an array of objects in JavaScript with no fuss or bother.</p>
<p><em>To follow along with this article, you will need a knowledge of basic JavaScript concepts, such as  declaring variables, writing functions, and conditional statements. I'll also be using ES6 syntax. You can get a refresher on that here: <a href="https://www.sitepoint.com/tag/es6/">https://www.sitepoint.com/tag/es6/</a> </em></p>

<h2 id="basicarraysorting">Basic Array Sorting</h2>
<p>By default, the JavaScript <code>Array.sort</code> function converts each element in the array to be sorted, into a string, and compares them in <a href="https://en.wikipedia.org/wiki/Code_point">Unicode code point</a> order.</p>
<pre><code class="javascript language-javascript">const foo = [9, 2, 3, 'random', 'panda'];
foo.sort(); // returns [ 2, 3, 9, 'panda', 'random' ]

const bar = [4, 19, 30, function(){}, {key: 'value'}];
bar.sort(); // returns [ 19, 30, 4, { key: 'value' }, [Function] ]
</code></pre>
<p>You may be wondering why 30 comes before 4… not logical huh? Well, actually it is. This happens because each element in the array is first converted to a string, and <code>"30"</code> comes before <code>"4"</code> in Unicode order.</p>
<p>It is also worth noting that unlike many other JavaScript array functions, <code>Array.sort</code> actually changes, or mutates the array it sorts.</p>
<pre><code class="javascript language-javascript">const baz = ['hello world', 31, 5, 9, 12];
baz.sort(); // baz array is modified
console.log(baz); // shows [12, 31, 5, 9, "hello world"]
</code></pre>
<p>To avoid this, you can create a new instance of the array to be sorted and modify that instead.</p>
<pre><code class="javascript language-javascript">const baz = ['hello world', 31, 5, 9, 12];
const newBaz = baz.slice().sort(); // new instance of baz array is created and sorted
console.log(baz); // "hello world", 31, 5, 9, 12]
console.log(newBaz); // [12, 31, 5, 9, "hello world"]
</code></pre>
<p>Using <code>Array.sort</code> alone would not be very useful for sorting an array of objects, thankfully the function takes an optional <code>compareFunction</code> parameter which causes the array elements to be sorted according to the return value of the compare function.</p>
<h2 id="usingcomparefunctionstosort">Using Compare Functions to Sort</h2>
<p>Lets say that <code>a</code> and <code>b</code> are the two elements being compared by the compare function. If the return value of the compare function is:</p>
<ol><li>less than 0 — <code>a</code> comes before <code>b</code></li>
<li>greater than 0  — <code>b</code> comes before <code>a</code></li>
<li>equal to 0  — <code>a</code> and <code>b</code> are left unchanged with respect to each other</li>
</ol><p>Let's look at a simple example with an array of numbers:</p>
<pre><code class="javascript language-javascript">const arr = [1,2,30,4];

function compare(a, b){
  let comparison = 0;

  if (a &gt; b) {
    comparison = 1;
  } else if (b &gt; a) {
    comparison = -1;
  }

  return comparison;
}

arr.sort(compare);
// =&gt; 1, 2, 4, 30
</code></pre>
<p>This can be refactored somewhat to obtain the return value by subtracting <code>a</code> from <code>b</code>;</p>
<pre><code class="javascript language-javascript">function compare(a, b){
  return a - b;
}
</code></pre>
<p>Which now makes a good candidate for an arrow function:</p>
<pre><code class="javascript language-javascript">arr.sort((a, b) =&gt; a - b));
</code></pre>
<h2 id="sortanarrayofobjectsinjavascript">Sort an Array of Objects in JavaScript</h2>
<p>Now let's look at sorting an array of objects. Let's take an array of band objects:</p>
<pre><code class="javascript language-javascript">const bands = [ 
  { genre: 'Rap', band: 'Migos', albums: 2},
  { genre: 'Pop', band: 'Coldplay', albums: 4},
  { genre: 'Rock', band: 'Breaking Benjamins', albums: 1}
];
</code></pre>
<p>We can use the following compare function to sort this array of objects according to genre:</p>
<pre><code class="javascript language-javascript">function compare(a, b) {
  // Use toUpperCase() to ignore character casing
  const genreA = a.genre.toUpperCase();
  const genreB = b.genre.toUpperCase();

  let comparison = 0;
  if (genreA &gt; genreB) {
    comparison = 1;
  } else if (genreA &lt; genreB) {
    comparison = -1;
  }
  return comparison;
}

bands.sort(compare);

/* returns [ 
{ genre: 'Pop', band: 'Coldplay', albums: 4 }, 
{ genre: 'Rap', band: 'Migos', albums: 2 }, 
{ genre: 'Rock', band: 'Breaking Benjamins', albums: 1 } 
] */
</code></pre>
<p>To reverse the sorting order, you can simply invert the return value of the compare function:</p>
<pre><code class="javascript language-javascript">function compare(a, b) {
  ...

  //invert return value by multiplying by -1
  return comparison * -1; 
}
</code></pre>

<h2 id="creatingadynamicsortingfunction">Creating a Dynamic Sorting Function</h2>
<p>Let's finish up by making this more dynamic. Let's create a sorting function, which you can use to sort an array of objects, whose values are either strings or numbers. This function has two parameters — the key we want to sort by and the order of the results (i.e. ascending or descending).</p>
<pre><code class="javascript language-javascript">const bands = [ 
  { genre: 'Rap', band: 'Migos', albums: 2},
  { genre: 'Pop', band: 'Coldplay', albums: 4, awards: 13},
  { genre: 'Rock', band: 'Breaking Benjamins', albums: 1}
];

// function for dynamic sorting
function compareValues(key, order='asc') {
  return function(a, b) {
    if(!a.hasOwnProperty(key) || !b.hasOwnProperty(key)) {
      // property doesn't exist on either object
        return 0; 
    }

    const varA = (typeof a[key] === 'string') ? 
      a[key].toUpperCase() : a[key];
    const varB = (typeof b[key] === 'string') ? 
      b[key].toUpperCase() : b[key];

    let comparison = 0;
    if (varA &gt; varB) {
      comparison = 1;
    } else if (varA &lt; varB) {
      comparison = -1;
    }
    return (
      (order == 'desc') ? (comparison * -1) : comparison
    );
  };
}
</code></pre>
<p>And this is how you'd use it:</p>
<pre><code class="javascript language-javascript">// array is sorted by band, in ascending order by default
bands.sort(compareValues('band')); 

// array is sorted by band in descending order
bands.sort(compareValues('band', 'desc')); 

// array is sorted by albums in ascending order
bands.sort(compareValues('albums')); 
</code></pre>

<p>In the code above, the <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty">hasOwnProperty method</a> is used to check if the specified property is defined on each object and has not been <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty#Direct_versus_inherited_properties">inherited via the prototype chain</a>. If it is not defined on the objects, the function returns <code>0</code>, which causes the sort order to remain as is (i.e the objects remain unchanged with respect to each other).</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/typeof">typeof operator</a> is also used to check the data type of the value of the property. This allows the function to determine the proper way to sort the array. For example, if the value of the specified property is a <code>string</code>, a <code>toUpperCase</code>  method is used to convert all its characters to uppercase, so character casing is ignored when sorting.</p>
<p>You can adjust the above function to accommodate other data types, and any other peculiarity your script needs. </p>
<h2 id="conclusion">Conclusion</h2>
<p>So there you have it — a short introduction to sorting an array of objects. Although many JavaScript libraries offer this kind of dynamic sorting ability (e.g. <a href="http://underscorejs.org/#sortBy">Underscore.js</a>, <a href="https://lodash.com/docs/4.17.4#sortBy">Lodash</a> and <a href="https://sugarjs.com/docs/#/Array/sortBy">Sugar</a>), as demonstrated, it's not all that hard to implement this kind of functionality yourself.</p>
<p>If you have any questions or comments, I'd be glad to hear them in the comments.</p>
<p><em>This article was peer reviewed by <a href="https://www.sitepoint.com/author/morkro">Moritz Kröger</a>, <a href="https://www.sitepoint.com/author/gmainardi">Giulio Mainardi</a>, <a href="https://www.sitepoint.com/author/vildansoftic">Vildan Softic</a> and <a href="https://github.com/pertrai1">Rob Simpson</a>. Thanks to all of SitePoint's peer reviewers for making SitePoint content the best it can be!</em></p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-17" name="t-17"></a><h1>17 : Effective Functional JavaScript: First-class and Higher Order Functions</h1>
					<div class="tutorial__content">
					<span>https://hackernoon.com/effective-functional-javascript-first-class-and-higher-order-functions-713fde8df50a</span>
<div class="section-inner sectionLayout--insetColumn"><h4 name="3f90" id="3f90" class="graf graf--h4 graf-after--figure">Functions: the killer JavaScript feature we never talk&nbsp;about.</h4><p name="56b7" id="56b7" class="graf graf--p graf-after--h4">JavaScript is a very in-demand language today. It runs in a lot of places from the browser to embedded systems and it brings a non-blocking I/O model that is faster than others for some types of applications. What really sets JavaScript apart from the rest of scripting languages is its highly functional nature.</p><blockquote name="ddf1" id="ddf1" class="graf graf--pullquote graf-after--p"><span class="markup--quote markup--pullquote-quote is-other" name="anon_db2141fc3f36" data-creator-ids="anon">JavaScript has more in common with functional languages like <a href="http://javascript.crockford.com/little.html" data-href="http://javascript.crockford.com/little.html" class="markup--anchor markup--pullquote-anchor" rel="noopener" target="_blank">Lisp or Scheme</a> than with C or Java. — Douglas Crockford in <a href="http://javascript.crockford.com/javascript.html" data-href="http://javascript.crockford.com/javascript.html" class="markup--anchor markup--pullquote-anchor" rel="noopener" target="_blank">JavaScript: the World's Most Misunderstood Language</a></span></blockquote><p name="c456" id="c456" class="graf graf--p graf-after--pullquote">It's a widely publicised fact that Brendan Eich, when creating the first version of JavaScript, was actually told he would be able to build a <a href="https://en.wikipedia.org/wiki/Lisp_%28programming_language%29" data-href="https://en.wikipedia.org/wiki/Lisp_(programming_language)" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Lisp, a list processing language like Scheme or common Lisp</a>. It turns out that Sun Microsystems had other ideas and this programming language needed to wear a coat of procedural syntax inherited from a C or Java-like language. Despite all the semicolons, at its heart JavaScript remains a functional language with features such as first-class functions and closures.</p><p name="6a8f" id="6a8f" class="graf graf--p graf-after--p">This post will focus on first-class functions and higher order functions. To read more about closures and how to leverage them to wield JavaScript's functional powers, I've written the<a href="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a" data-href="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a" class="markup--anchor markup--p-anchor" target="_blank"> following post</a>:</p><div name="aae9" id="aae9" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a" data-href="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a"><strong class="markup--strong markup--mixtapeEmbed-strong">Ingredients of Effective Functional JavaScript: Closures, Partial Application and Currying</strong><br><em class="markup--em markup--mixtapeEmbed-em">To use JavaScript to its full potential you have to embrace its strong functional programming base.</em>hackernoon.com</a><a href="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="3c22d9ea980a3c9a013e6e355746235a" data-thumbnail-img-id="1*6JWjrAzwchgcr823H9g8Og.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*6JWjrAzwchgcr823H9g8Og.jpeg);"></a></div><h3 name="5f60" id="5f60" class="graf graf--h3 graf-after--mixtapeEmbed">First-class functions</h3><p name="7533" id="7533" class="graf graf--p graf-after--h3">A language with first-class functions means that it treats functions like expressions of any other type. Functions are like any other object.</p><p name="a88c" id="a88c" class="graf graf--p graf-after--p">You can pass them into other functions as parameters:</p><pre name="6550" id="6550" class="graf graf--pre graf-after--p">function runFunction(fn, data) {<br>  return fn(data);<br>}</pre><p name="ea30" id="ea30" class="graf graf--p graf-after--pre">You can assign a function as a value to a variable:</p><pre name="147d" id="147d" class="graf graf--pre graf-after--p">var myFunc = function() {<br>  // do something<br>};</pre><pre name="fb31" id="fb31" class="graf graf--pre graf-after--pre">const myNewGenFunc = someParam =&gt; someParam;</pre><p name="cb50" id="cb50" class="graf graf--p graf-after--pre">You can return a function:</p><pre name="15f2" id="15f2" class="graf graf--pre graf-after--p">function takeFirst(f, g) {<br>   return f;<br>}</pre><h3 name="79b9" id="79b9" class="graf graf--h3 graf-after--pre">First-class functions in&nbsp;practice</h3><h4 name="3e9a" id="3e9a" class="graf graf--h4 graf-after--h3">Cheap dependency injection</h4><p name="08d0" id="08d0" class="graf graf--p graf-after--h4">In languages without first-class functions to pass a dependency in means passing an object. Here we can just pass functions around, which is great.</p><p name="2043" id="2043" class="graf graf--p graf-after--p">For example in Java to run a custom sort on an ArrayList, we have to use <code class="markup--code markup--p-code">ArrayList#sort</code> which expects a <code class="markup--code markup--p-code">Comparator</code> object as a parameter (see <a href="http://docs.oracle.com/javase/8/docs/api/java/util/ArrayList.html#sort-java.util.Comparator-" data-href="http://docs.oracle.com/javase/8/docs/api/java/util/ArrayList.html#sort-java.util.Comparator-" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">the Java API docs here</a>). In JavaScript we use <code class="markup--code markup--p-code">Array#sort</code> (<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/sort" data-href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/sort" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">MDN reference here</a>) which expects a function. This is a bit less verbose since in this case we're just going to be implementing one method of the <code class="markup--code markup--p-code">Comparator</code> interface</p><p name="5cab" id="5cab" class="graf graf--p graf-after--p">It gets even better with ES6 default parameter syntax.</p><pre name="bb88" id="bb88" class="graf graf--pre graf-after--p">// in fetch.js<br>import axios from 'axios';</pre><pre name="bdbf" id="bdbf" class="graf graf--pre graf-after--pre">export function fetchSomething(fetch = axios) {<br>  return fetch('/get/some/resource');<br>}</pre><pre name="86e2" id="86e2" class="graf graf--pre graf-after--pre">// in someModule.js<br>import axios from 'axios';</pre><pre name="5604" id="5604" class="graf graf--pre graf-after--pre">import { fetchSomething } from './fetch';</pre><pre name="dbe6" id="dbe6" class="graf graf--pre graf-after--pre">const fetcherWithHeaders = axios({<br>  // pass some custom configs<br>});</pre><pre name="320e" id="320e" class="graf graf--pre graf-after--pre">fetchSomething(fetcherWithHeaders)<br>.then(/* do something */)<br>.catch(/* handle error */);</pre><pre name="d8d9" id="d8d9" class="graf graf--pre graf-after--pre">// in someOtherModule.js</pre><pre name="634d" id="634d" class="graf graf--pre graf-after--pre">import { fetchSomething } from './fetch';</pre><pre name="5b64" id="5b64" class="graf graf--pre graf-after--pre">fetchSomething()<br>.then(/* do something */)<br>.catch(/* handle error */);</pre><h4 name="1774" id="1774" class="graf graf--h4 graf-after--pre">Callbacks and non-blocking IO</h4><p name="8690" id="8690" class="graf graf--p graf-after--h4">JavaScript's default behaviour on IO is non-blocking. This means we tend to pass a lot of callbacks (until Promises came along at least). Being able to pass a function as a callback instead of an object on which we will run a method (like we would in say Java) means we can have terseness in callback-based code.</p><p name="31b4" id="31b4" class="graf graf--p graf-after--p">For example in Node:</p><pre name="df9a" id="df9a" class="graf graf--pre graf-after--p">const fs = require('fs');</pre><pre name="1829" id="1829" class="graf graf--pre graf-after--pre">fs.readFile('./myFile.txt', 'utf-8', function(err, data) {<br>  // this is a callback, it gets executed<br>  // once the file has been read<br>});</pre><h4 name="3da8" id="3da8" class="graf graf--h4 graf-after--pre">More functional programming primitives that require first-class functions</h4><p name="7620" id="7620" class="graf graf--p graf-after--h4">Being able to return a function and closures means we have access to things like partial application and currying. <a href="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a" data-href="https://hackernoon.com/ingredients-of-effective-functional-javascript-closures-partial-application-and-currying-66afe055102a" class="markup--anchor markup--p-anchor" target="_blank">Read more about those FP superpowers here</a>.</p><p name="a4a9" id="a4a9" class="graf graf--p graf-after--p">It also means we can start creating higher order functions.</p><h3 name="8ee5" id="8ee5" class="graf graf--h3 graf-after--p">Higher order functions</h3><p name="bb71" id="bb71" class="graf graf--p graf-after--h3">A function is a higher order function if it takes a function as a parameter, or returns a function as its result. Both of these requirements rely on functions being first-class objects in a language.</p><p name="4dc1" id="4dc1" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">map</code>, <code class="markup--code markup--p-code">filter</code> and <code class="markup--code markup--p-code">reduce</code>/<code class="markup--code markup--p-code">reduceRight</code>are the functions present in JavaScript that map to classic higher order functions in other functional languages.</p><p name="3119" id="3119" class="graf graf--p graf-after--p">In other languages:</p><ul class="postList"><li name="5975" id="5975" class="graf graf--li graf-after--p">map tends to be called map or transform</li><li name="2998" id="2998" class="graf graf--li graf-after--li">filter is called select in some languages</li><li name="2b28" id="2b28" class="graf graf--li graf-after--li">reduce and reduceRight are the fold left and right functions (also called accumulate, aggregate, compress or inject in different languages)</li></ul><p name="7d1f" id="7d1f" class="graf graf--p graf-after--li">In functional programming languages, there are no loops. When you need to do an operation like traversing a list or a tree, there are two predominant styles: recursion and higher order functions.</p><p name="9828" id="9828" class="graf graf--p graf-after--p">Recursion relies on a function calling itself, usually on a different part of the parameter (list being traversed for example). That's a topic for <a href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa#.i4kfpmmfr" data-href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa#.i4kfpmmfr" class="markup--anchor markup--p-anchor" target="_blank">another post</a>.</p><p name="31c8" id="31c8" class="graf graf--p graf-after--p">Higher order functions are usually provided by the language. In ES6 JavaScript these functions are defined on the Array prototype.</p><h4 name="ac48" id="ac48" class="graf graf--h4 graf-after--p">Array#map</h4><p name="761c" id="761c" class="graf graf--p graf-after--h4"><code class="markup--code markup--p-code">map</code> is used if we want to perform the same change on each member of the array. It takes the function that should be applied to each element of the array as a parameter. That function is passed <code class="markup--code markup--p-code">(element, index, wholeArray)</code> as parameters.</p><pre name="ec48" id="ec48" class="graf graf--pre graf-after--p">const myArr = [ 'some text', 'more text', 'final text' ];</pre><pre name="5a7c" id="5a7c" class="graf graf--pre graf-after--pre">const mappedArr = myArr.map( function(str) {<br>  return str.split(' ');<br>});</pre><pre name="232f" id="232f" class="graf graf--pre graf-after--pre">console.log(mappedArr);<br>// [ [ 'some', 'text' ], [ 'more', 'text' ], [ 'final', 'text' ] ]</pre><h4 name="4aee" id="4aee" class="graf graf--h4 graf-after--pre">Array#filter</h4><p name="6519" id="6519" class="graf graf--p graf-after--h4"><code class="markup--code markup--p-code">filter</code> allows us to pick which elements of the array should remain in the transformed list by passing a filtering function that returns a Boolean value (true/false). As for <code class="markup--code markup--p-code">map</code> this functions is passed <code class="markup--code markup--p-code">(element, index, wholeArray)</code>.</p><pre name="1855" id="1855" class="graf graf--pre graf-after--p">const myArr = [ 5, 10, 4, 50, 3 ];</pre><pre name="efdc" id="efdc" class="graf graf--pre graf-after--pre">const multiplesOfFive = myArr.filter( function(num) {<br>  return num % 5 === 0;<br>});</pre><pre name="d74a" id="d74a" class="graf graf--pre graf-after--pre">console.log(multiplesOfFive);<br>// [ 5, 10, 50 ]</pre><h4 name="1c68" id="1c68" class="graf graf--h4 graf-after--pre">Array#reduce</h4><p name="7145" id="7145" class="graf graf--p graf-after--h4"><code class="markup--code markup--p-code">reduce</code> is used to change the shape of the array. We provide more than 1 parameter to this function (in addition to the array we're reducing). We pass a reducing function and optionally the initial value of to reduce with. The function is passed <code class="markup--code markup--p-code">(prev, curr, index, wholeArray)</code>&nbsp;. <code class="markup--code markup--p-code">prev</code> is the value returned by the previous reduction, for the first iteration that means it's either the initial value of the first element of the array. <code class="markup--code markup--p-code">curr</code> is the value in the array at which we're at.</p><p name="4e8c" id="4e8c" class="graf graf--p graf-after--p">The classic example is summing or concatenating.</p><pre name="0205" id="0205" class="graf graf--pre graf-after--p">const myNumbers = [ 1, 2, 5 ];<br>const myWords = [ 'These', 'all', 'form', 'a', 'sentence' ];</pre><pre name="8d91" id="8d91" class="graf graf--pre graf-after--pre">const sum = myNumbers.reduce( function(prev, curr) {<br>  return prev + curr;<br>}, 0);</pre><pre name="3500" id="3500" class="graf graf--pre graf-after--pre">console.log(sum); // 8</pre><pre name="38e3" id="38e3" class="graf graf--pre graf-after--pre">const sentence = myWords.reduce( (prev, curr) =&gt; {<br> return prev + ' ' + curr;<br>}); // the initial value is optional</pre><pre name="4b6f" id="4b6f" class="graf graf--pre graf-after--pre">console.log(sentence);<br>// 'These all form a sentence'</pre><p name="32d7" id="32d7" class="graf graf--p graf-after--pre">If you want to learn more about the internal of <code class="markup--code markup--p-code">map</code>, <code class="markup--code markup--p-code">filter</code> and <code class="markup--code markup--p-code">reduce</code> or recursion, I've reimplemented them in a recursive style using ES6 destructuring in the following post:</p><div name="8038" id="8038" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa" data-href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa"><strong class="markup--strong markup--mixtapeEmbed-strong">Recursion in JavaScript with ES6, destructuring and rest/spread</strong><br><em class="markup--em markup--mixtapeEmbed-em">The latest ECMA standard for JavaScript (ECMAScript 6) makes JavaScript more readable by encouraging a more declarative…</em>hackernoon.com</a><a href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="e868c4b4a1e1d2250407a43c2ea53c65"></a></div><h3 name="f4b5" id="f4b5" class="graf graf--h3 graf-after--mixtapeEmbed">Higher order functions in&nbsp;practice</h3><h4 name="1349" id="1349" class="graf graf--h4 graf-after--h3">No more&nbsp;loops</h4><p name="661b" id="661b" class="graf graf--p graf-after--h4">Higher order functions allow us to get rid of the imperative loops that seem to be spread everywhere.</p><pre name="fd7b" id="fd7b" class="graf graf--pre graf-after--p">var newArr = [];<br>var myArr = [ 1, 2, 3 ];</pre><pre name="fafc" id="fafc" class="graf graf--pre graf-after--pre">for(var i = 0; i &lt; myArr.length; i++) {<br>  newArr.push(myArr[i] * 2);<br>}</pre><pre name="fbfc" id="fbfc" class="graf graf--pre graf-after--pre">console.log(newArr); // [ 2, 4, 6 ]</pre><pre name="3ab5" id="3ab5" class="graf graf--pre graf-after--pre">// nicer with `map`<br>const doubled = myArr.map( x =&gt; x * 2 );<br>console.log(doubled); // [ 2, 4, 6 ]</pre><p name="8d50" id="8d50" class="graf graf--p graf-after--pre">The intent is just clearer with map. We can also extract the <code class="markup--code markup--p-code">double</code> function so we're making our code more readable and modular.</p><pre name="3058" id="3058" class="graf graf--pre graf-after--p">const double = x =&gt; x * 2;<br>const doubled = arr.map(double);</pre><p name="8bac" id="8bac" class="graf graf--p graf-after--pre">It reads like a book and that's important because we write for humans not machines.</p><h4 name="8b6c" id="8b6c" class="graf graf--h4 graf-after--p">Side-effect free programming</h4><p name="f796" id="f796" class="graf graf--p graf-after--h4"><code class="markup--code markup--p-code">Array</code> higher order functions do not mutate the variable they are called on. This is good, because the loop-based approach using&nbsp;<code class="markup--code markup--p-code">.push</code> and&nbsp;<code class="markup--code markup--p-code">.pop</code> changes it. It means if you pass a variable as a parameter, it's not suddenly going to get changed by a function down the call stack.</p><pre name="1bb7" id="1bb7" class="graf graf--pre graf-after--p">// some random module<br>// obviously no one actually does this<br>function doesBadSideEffect(arr) {<br>  return arr.pop();<br>}</pre><pre name="2ec7" id="2ec7" class="graf graf--pre graf-after--pre"><br>// somewhere quite important<br>var arr = [ 'a', 'b', 'c' ];</pre><pre name="627c" id="627c" class="graf graf--pre graf-after--pre">var joinedLetters = '';</pre><pre name="351e" id="351e" class="graf graf--pre graf-after--pre">for(var i = 0; i &lt; arr.length; i++) {<br>  joinedLetters += arr[i];<br>  doesBadSideEffect(arr)<br>}</pre><pre name="1fdb" id="1fdb" class="graf graf--pre graf-after--pre">console.log(joinedLetters);<br>// whoops 'ab'<br>// even though the naming makes us<br>// expect 'abc'</pre><h4 name="dea8" id="dea8" class="graf graf--h4 graf-after--pre">Declarative Code Optimisations</h4><p name="1d2e" id="1d2e" class="graf graf--p graf-after--h4">In some languages functions like <code class="markup--code markup--p-code">map</code> are parallelised. That's because we don't actually need to know what's in the rest of the array to compute this particular element's new value. If we're doing complex things in the mapping function then this sort of optimisation could be very useful.</p><h3 name="c669" id="c669" class="graf graf--h3 graf-after--p">Effective Functional JavaScript</h3><p name="b091" id="b091" class="graf graf--p graf-after--h3">Use first-class and higher order functions to write nicer code more easily. It's nice and declarative instead of imperative, say what you want done not how to do it</p><p name="7a1c" id="7a1c" class="graf graf--p graf-after--p">This will enable you to compose your functions and write code that is extremely terse without losing readability.</p><p name="e431" id="e431" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Remember to give this post some 💚 if you liked it. Follow me </em><a href="https://medium.com/@hugo__df" data-href="https://medium.com/@hugo__df" data-anchor-type="2" data-user-id="8d547401ba90" data-action-value="8d547401ba90" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank"><em class="markup--em markup--p-em">Hugo Di Francesco</em></a><em class="markup--em markup--p-em"> or </em><a href="https://twitter.com/hugo__df" data-href="https://twitter.com/hugo__df" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">@hugo__df</em></a><em class="markup--em markup--p-em"> for more JavaScript content&nbsp;:).</em></p><p name="381a" id="381a" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Edit: 24/01/2017, rephrased "Callbacks and non-blocking IO" following </em><a href="https://medium.com/@spyke" data-href="https://medium.com/@spyke" data-anchor-type="2" data-user-id="deb598440c0d" data-action-value="deb598440c0d" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank"><em class="markup--em markup--p-em">Anton Alexandrenok</em></a><em class="markup--em markup--p-em">'s comments</em></p></div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-18" name="t-18"></a><h1>18 : Ingredients of Effective Functional JavaScript: Closures, Partial Application and Currying</h1>
					<div class="tutorial__content">
<div class="section-inner sectionLayout--insetColumn"><h1 name="ea83" id="ea83" class="graf graf--h3 graf--leading graf--title">Ingredients of Effective Functional JavaScript: Closures, Partial Application and&nbsp;Currying</h1><p name="0d10" id="0d10" class="graf graf--p graf-after--figure">To use JavaScript to its full potential you have to embrace its strong functional programming base. We're going to explore some crucial and powerful functional constructs: closures, partial application and currying that make JavaScript terse yet understandable.</p><h3 name="ddf1" id="ddf1" class="graf graf--h3 graf-after--p">The basics</h3><p name="0ea7" id="0ea7" class="graf graf--p graf-after--h3"><a href="https://en.wikipedia.org/wiki/Functional_programming" data-href="https://en.wikipedia.org/wiki/Functional_programming" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Functional programming</a> is a programming paradigm that follows a more mathematical computation model. Let's go through some basics to make your JavaScript more functional.</p><h4 name="3514" id="3514" class="graf graf--h4 graf-after--p">Declarative programming</h4><p name="7f9c" id="7f9c" class="graf graf--p graf-after--h4">Functional programs tend to be declarative (as opposed to imperative), that's a case of telling the compiler <em class="markup--em markup--p-em">what</em> you want instead of <em class="markup--em markup--p-em">how</em> you want it.</p><pre name="b7ef" id="b7ef" class="graf graf--pre graf-after--p">const list = [ 1, 2, 3 ];</pre><pre name="c08b" id="c08b" class="graf graf--pre graf-after--pre">// imperative style<br>const imperative = list[0];</pre><pre name="2b4f" id="2b4f" class="graf graf--pre graf-after--pre">// declarative style<br>const declarative = firstElement(list);</pre><p name="3948" id="3948" class="graf graf--p graf-after--pre">In the above code snippet we're trying to get the first element of <code class="markup--code markup--p-code">list</code>, the declarative example says what we want, firstElement can do whatever it likes as long as it returns the first element of the passed parameter. Whereas in the imperative style, we say I want index 0 of <code class="markup--code markup--p-code">list</code> explicitly. In JavaScript and at this program size, this doesn't make a massive difference.</p><p name="501f" id="501f" class="graf graf--p graf-after--p">To build functional programs, we should prefer the declarative style and avoid mutation.</p><h4 name="07ac" id="07ac" class="graf graf--h4 graf-after--p">Recursion and higher order functions</h4><p name="d9d8" id="d9d8" class="graf graf--p graf-after--h4">There are no loops in functional programming, just recursion and higher order functions.</p><p name="2aae" id="2aae" class="graf graf--p graf-after--p">Mechanisms such as <a href="https://en.wikipedia.org/wiki/Pattern_matching" data-href="https://en.wikipedia.org/wiki/Pattern_matching" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">pattern matching</a> allow for easier recursive function declarations. In ECMAScript 6 (the 2015 edition of the standard JavaScript is based on) we've added destructuring to the toolbox, which is a basic pattern matching that works for lists. You can read more about it <a href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa#.i8rek71hd" data-href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa#.i8rek71hd" class="markup--anchor markup--p-anchor" target="_blank">here</a>.</p><div name="703e" id="703e" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa" data-href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa"><strong class="markup--strong markup--mixtapeEmbed-strong">Recursion in JavaScript with ES6, destructuring and rest/spread</strong><br><em class="markup--em markup--mixtapeEmbed-em">The latest ECMA standard for JavaScript (ECMAScript 6) makes JavaScript more readable by encouraging a more declarative…</em>hackernoon.com</a><a href="https://hackernoon.com/recursion-in-javascript-with-es6-destructuring-and-rest-spread-4b22ae5998fa" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="9760a4702a5815c06b2d30f90465999c"></a></div><p name="274a" id="274a" class="graf graf--p graf-after--mixtapeEmbed">Higher order functions allow you to traverse iterable collections (Arrays). In JavaScript we have Array#map, Array#filter and Array#reduce. Each of these takes a function as an argument. This is possible because we have first-class functions in JavaScript, which means you can pass them around like any other type of variable&nbsp;:).</p><h4 name="ce04" id="ce04" class="graf graf--h4 graf-after--p">Lambdas (anonymous functions)</h4><p name="469c" id="469c" class="graf graf--p graf-after--h4">In JavaScript we can declare lambas (anonymous functions), which is quite handy considering the API of a lot of libraries expects a function as a parameter. We can just declare the function inline. It might mean a bit of a indentation/bracketing problem but inlining until you can generalise or refactor is actually great.</p><pre name="dbed" id="dbed" class="graf graf--pre graf-after--p">[ 1, 2, 3 ].map(function(el) {<br>  return el * 2;<br>});</pre><h4 name="9b20" id="9b20" class="graf graf--h4 graf-after--pre">Closures</h4><p name="02d4" id="02d4" class="graf graf--p graf-after--figure"><span class="markup--quote markup--p-quote is-other" name="86f9c3e924c5 anon_53868edda612" data-creator-ids="8d547401ba90 anon">Here are some &gt;140 character explanations of closures, thanks to <a href="https://medium.com/u/b0affb225289" data-href="https://medium.com/u/b0affb225289" data-anchor-type="2" data-user-id="b0affb225289" data-action-value="b0affb225289" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank">Mateusz Zatorski</a> for asking and his esteemed followers for answering&nbsp;:).</span></p><p name="8275" id="8275" class="graf graf--p graf-after--figure">We can use closures to put state inside an outer function while having access to that state in an inner function. That state is not global but still accessible to child functions.</p><pre name="e6c6" id="e6c6" class="graf graf--pre graf-after--p">function outerFunction() {<br>  const someState = { count: 0 };<br>  return {<br>    increment: function() {<br>      someState.count++;<br>    },<br>    getCount: function() {<br>      return someState.count;<br>    }<br>  }<br>}</pre><pre name="4461" id="4461" class="graf graf--pre graf-after--pre">const counter = outerFunction();</pre><pre name="5c6a" id="5c6a" class="graf graf--pre graf-after--pre">counter.increment();<br>counter.increment();<br>counter.getCount(); // 2<br>counter.increment();<br>counter.increment(); <br>counter.getCount(); // 4</pre><pre name="fd00" id="fd00" class="graf graf--pre graf-after--pre">someState; // ReferenceError: someState is not defined</pre><p name="584e" id="584e" class="graf graf--p graf-after--pre">The state (<code class="markup--code markup--p-code">someState</code>)isn't global since the last statement returns an error. It is however available to the functions it returned, because they can "see" <code class="markup--code markup--p-code">someState</code>, it's in their lexical scope.</p><h4 name="a87a" id="a87a" class="graf graf--h4 graf-after--p">Function application</h4><p name="7df5" id="7df5" class="graf graf--p graf-after--h4">Function application is the first "hardcore" functional programming concept we're going to introduce today. It's a concept that comes from the mathematics world.</p><p name="3a6a" id="3a6a" class="graf graf--p graf-after--p">A function application, in JavaScript, can look like a function call but doesn't have to be.</p><pre name="aa35" id="aa35" class="graf graf--pre graf-after--p">function someFunc(arg1, arg2) {<br>  return arg1 + arg2;<br>}</pre><pre name="6950" id="6950" class="graf graf--pre graf-after--pre">// function call<br>someFunc(1, 2); // 3</pre><pre name="a860" id="a860" class="graf graf--pre graf-after--pre">// different ways to apply a function<br>someFunc(1, 2); // 3<br>someFunc.apply(this, [ 1, 2 ]); // 3<br>someFunc.call(this, 1, 2); // 3</pre><p name="86f1" id="86f1" class="graf graf--p graf-after--pre">A function call is an imperative construct whereas a function application belongs to the realm of functional programming and mathematics.</p><p name="06d7" id="06d7" class="graf graf--p graf-after--p">In JavaScript you can even use <code class="markup--code markup--p-code">apply</code> and <code class="markup--code markup--p-code">call</code> to define what <code class="markup--code markup--p-code">this</code> will be set to during the application.</p><h3 name="1877" id="1877" class="graf graf--h3 graf-after--p">Partial application</h3><p name="a1ba" id="a1ba" class="graf graf--p graf-after--h3">Partial application is when you apply some of the required parameters of a function and return a function that takes the rest of the parameters.</p><p name="3b06" id="3b06" class="graf graf--p graf-after--p">We're going to flip the parameters to the <code class="markup--code markup--p-code">map</code> function. Instead of taking parameters <code class="markup--code markup--p-code">(list, fn)</code> it's going to take <code class="markup--code markup--p-code">(fn, list)</code>. This is to illustrate the value of partial application.</p><pre name="d78f" id="d78f" class="graf graf--pre graf-after--p">function functionalMap(fn, list) {<br>   return list.map(fn);<br>}</pre><pre name="11d5" id="11d5" class="graf graf--pre graf-after--pre">function partialFunctionalMap(fn) {<br>  return function(list) {<br>    return functionalMap(fn, list);<br>  }<br>}</pre><pre name="e24f" id="e24f" class="graf graf--pre graf-after--pre">// Example 1<br>// Let's apply all the arguments at once<br>functionalMap(x =&gt; x * 2, [ 1, 2, 3 ]);<br>functionalMap(x =&gt; x * 2, [ 2, 3, 5 ]);</pre><pre name="81d2" id="81d2" class="graf graf--pre graf-after--pre">// Example 2<br>// Let's apply them one at a time<br>const doubleListItems = partialFunctionalMap(x =&gt; x * 2);<br>doubleListItems([ 1, 2, 3 ]);<br>doubleListItems([ 2, 3, 5 ]);</pre><p name="ffb2" id="ffb2" class="graf graf--p graf-after--pre">What the code does in example 1 is less obvious than in example 2. You have to read what the lamba does instead of being told by the variable function name.</p><p name="7758" id="7758" class="graf graf--p graf-after--p">This is something we can use in places like React event handlers.</p><p name="6733" id="6733" class="graf graf--p graf-after--figure">Now if we went the Object-oriented route, we would use&nbsp;<code class="markup--code markup--p-code">.bind</code> <code class="markup--code markup--p-code">partialHandleClick</code> function to the component instance (<code class="markup--code markup--p-code">this</code>) and to be able to access <code class="markup--code markup--p-code">this.props.activeType</code> from inside <code class="markup--code markup--p-code">partialHandleClick</code>. We're trying to leverage functional programming, so no accessing <code class="markup--code markup--p-code">this</code> from all the way inside an event handler. We get to store some information that we can get at&nbsp;<code class="markup--code markup--p-code">.map</code> time (which type is this handler for). When the event triggers, we get the final parameter we need <code class="markup--code markup--p-code">e</code> (the event object) and the handler can finish applying.</p><h3 name="75fa" id="75fa" class="graf graf--h3 graf-after--p">Currying</h3><p name="05c1" id="05c1" class="graf graf--p graf-after--h3">A curried function is a function that you apply 1 parameter at a time.</p><pre name="900a" id="900a" class="graf graf--pre graf-after--p">function partialFunctionalMap(fn) {<br>  return function(list) {<br>    return functionalMap(fn, list);<br>  }<br>}</pre><p name="5332" id="5332" class="graf graf--p graf-after--pre"><code class="markup--code markup--p-code">partialFunctionalMap</code> is curried. In the event handler example <code class="markup--code markup--p-code">partialHandleLinkClick</code> isn't, since the first application provided 2 parameters.</p><p name="d4eb" id="d4eb" class="graf graf--p graf-after--p">We could rewrite it though.</p><pre name="cb40" id="cb40" class="graf graf--pre graf-after--p">function curriedHandleLinkClick(type){<br>  return function(activeType) {<br>    return function(e) {<br>      const hasKeyboardModifier = e.ctrlKey || e.shiftKey || e.altKey || e.metaKey;<br>      updateType(type, activeType, hasKeyboardModifier);<br>    };<br>  };<br>}</pre><p name="d7b5" id="d7b5" class="graf graf--p graf-after--pre">And we would use <code class="markup--code markup--p-code">this.curriedHandleLinkClick(type)(this.props.activeType)</code> instead of <code class="markup--code markup--p-code">this.partialHandleLinkClick(type, this.props.activeType)</code>.</p><p name="4925" id="4925" class="graf graf--p graf-after--p">This isn't as pretty in JavaScript as in other languages since we're replacing <code class="markup--code markup--p-code">(arg1, arg2, arg3)</code> with <code class="markup--code markup--p-code">(arg1)(arg2)(arg3)</code>.</p><h3 name="5a7e" id="5a7e" class="graf graf--h3 graf-after--p">Currying and partial application</h3><p name="c2b6" id="c2b6" class="graf graf--p graf-after--h3">Currying is strict: a curried function <strong class="markup--strong markup--p-strong">always</strong> applied 1 parameter at a time. Partial application is not this strict.</p><p name="0c98" id="0c98" class="graf graf--p graf-after--p">A curried function tends to be partially applied but a partially applied function does <strong class="markup--strong markup--p-strong">not</strong> have to be curried.</p><p name="8e17" id="8e17" class="graf graf--p graf-after--p">This means we can automate the currying process.</p><p name="5be0" id="5be0" class="graf graf--p graf-after--p">In JavaScript we can use libraries to curry functions with multiple arguments. <a href="https://lodash.com/docs#curry" data-href="https://lodash.com/docs#curry" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Lodash has a curry function</a> and <a href="http://ramdajs.com/docs/#curry" data-href="http://ramdajs.com/docs/#curry" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">so does Ramda</a>. They take a function and when applied with a parameter either returns if all required arguments are present or returns a curried function that accepts the rest of the arguments.</p><p name="26f3" id="26f3" class="graf graf--p graf-after--p">You can also write your own by accessing the <code class="markup--code markup--p-code">arguments</code> object of the function and using Function#apply. Here are a couple of tutorials that take you through this process.</p><div name="fdcc" id="fdcc" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe" data-href="https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe"><strong class="markup--strong markup--mixtapeEmbed-strong">Currying in JavaScript</strong><br><em class="markup--em markup--mixtapeEmbed-em">A technique using partial evaluation</em>medium.com</a><a href="https://medium.com/@kbrainwave/currying-in-javascript-ce6da2d324fe" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="fdaa89e96cd2c38ce71f2966341a8167" data-thumbnail-img-id="0*PQAXDSSDNR2rddzL.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*PQAXDSSDNR2rddzL.png);"></a></div><div name="722e" id="722e" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="http://kevvv.in/currying-in-javascript/" data-href="http://kevvv.in/currying-in-javascript/" class="markup--anchor markup--mixtapeEmbed-anchor" title="http://kevvv.in/currying-in-javascript/"><strong class="markup--strong markup--mixtapeEmbed-strong">Currying in JavaScript</strong><br><em class="markup--em markup--mixtapeEmbed-em">I've been thinking a lot lately about functional programming, and I thought it might be kind of fun to walk through the…</em>kevvv.in</a><a href="http://kevvv.in/currying-in-javascript/" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="a9d6b7b1aae20a91360cfe4a47c0dbcd"></a></div><p name="35cd" id="35cd" class="graf graf--p graf-after--mixtapeEmbed">Some languages like Haskell are auto-curried. This means that if the function application does not provide the required number of parameters, it will return a function which will accept the rest of the parameters one at a time, just like the <a href="https://lodash.com/" data-href="https://lodash.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Lodash</a> and <a href="http://ramdajs.com/" data-href="http://ramdajs.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Ramda</a> curry functions do. Another cool thing in Haskell is that partial application looks like non-partial application and curried function calls aren't ugly, since the separator for parameters is a space.</p><pre name="559a" id="559a" class="graf graf--pre graf-after--p">times a b = a * b</pre><pre name="7c33" id="7c33" class="graf graf--pre graf-after--pre">times 1 2</pre><pre name="04f8" id="04f8" class="graf graf--pre graf-after--pre">double = times 2</pre><h3 name="cf31" id="cf31" class="graf graf--h3 graf-after--pre">Effective Functional JavaScript Recipe</h3><p name="b091" id="b091" class="graf graf--p graf-after--h3">Use and abuse closures, partial application and currying.</p><p name="7a1c" id="7a1c" class="graf graf--p graf-after--p">This will enable you to compose your functions and write code that is extremely terse without losing readability.</p><p name="e431" id="e431" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Remember to give this post some 💚 if you liked it. Follow me </em><a href="https://medium.com/@hugo__df" data-href="https://medium.com/@hugo__df" data-anchor-type="2" data-user-id="8d547401ba90" data-action-value="8d547401ba90" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank"><em class="markup--em markup--p-em">Hugo Di Francesco</em></a><em class="markup--em markup--p-em"> or </em><a href="https://twitter.com/hugo__df" data-href="https://twitter.com/hugo__df" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">@hugo__df</em></a><em class="markup--em markup--p-em"> for more JavaScript content&nbsp;:).</em></p></div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-19" name="t-19"></a><h1>19 : Pub-Sub Event Manager</h1>
					<div class="tutorial__content">
<pre>/**
 * MicroEvent - to make any js object an event emitter (server or browser)
 * 
 * - pure javascript - server compatible, browser compatible
 * - dont rely on the browser doms
 * - super simple - you get it immediatly, no mistery, no magic involved
 *
 * - create a MicroEventDebug with goodies to debug
 *   - make it safer to use
*/

var MicroEvent	= function(){};
MicroEvent.prototype	= {
	bind	: function(event, fct){
		this._events = this._events || {};
		this._events[event] = this._events[event]	|| [];
		this._events[event].push(fct);
	},
	unbind	: function(event, fct){
		this._events = this._events || {};
		if( event in this._events === false  )	return;
		this._events[event].splice(this._events[event].indexOf(fct), 1);
	},
	trigger	: function(event /* , args... */){
		this._events = this._events || {};
		if( event in this._events === false  )	return;
		for(var i = 0; i &lt; this._events[event].length; i++){
			this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1));
		}
	}
};

/**
 * mixin will delegate all MicroEvent.js function in the destination object
 *
 * - require('MicroEvent').mixin(Foobar) will make Foobar able to use MicroEvent
 *
 * @param {Object} the object which will support MicroEvent
*/
MicroEvent.mixin	= function(destObject){
	var props	= ['bind', 'unbind', 'trigger'];
	for(var i = 0; i &lt; props.length; i ++){
		if( typeof destObject === 'function' ){
			destObject.prototype[props[i]]	= MicroEvent.prototype[props[i]];
		}else{
			destObject[props[i]] = MicroEvent.prototype[props[i]];
		}
	}
	return destObject;
}

// export in common js
if( typeof module !== "undefined" &amp;&amp; ('exports' in module)){
	module.exports	= MicroEvent;
}</pre>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-20" name="t-20"></a><h1>20 : Currying in JavaScript</h1>
					<h3>A technique using partial evaluation</h3>
					<div class="tutorial__content">
<div class="section-inner sectionLayout--insetColumn">
	
	<p name="4d38" id="4d38" class="graf graf--p graf-after--h4">Currying refers to the process of transforming a function with multiple arity into the same function with less arity. The curried effect is achieved by binding some of the arguments to the first function invoke, so that those values are fixed for the next invocation. Here's an example of what a curried function looks like:</p><figure name="0d07" id="0d07" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill"></div>
	<img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/0*PQAXDSSDNR2rddzL.png" src="https://cdn-images-1.medium.com/max/800/0*PQAXDSSDNR2rddzL.png">
	
	</div></figure><p name="425a" id="425a" class="graf graf--p graf-after--figure">babyAnimals is a curried function; it is designed for the first argument to be 'prefilled' before the function itself is fully executed. With this pattern, 'koala' can be bound to babyAnimals, and my love for animals other than elephants can easily be expressed.</p><p name="f3fa" id="f3fa" class="graf graf--p graf-after--p">Currying can be integrated with callbacks to create higher-order 'factory' functions. This pattern is extremely useful in event handling, and can also replace the callback pattern that is utilized in node.js (Brun Jouhie has an excellent <a href="http://bjouhier.wordpress.com/2011/04/04/currying-the-callback-or-the-essence-of-futures/" data-href="http://bjouhier.wordpress.com/2011/04/04/currying-the-callback-or-the-essence-of-futures/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">blog post</a> on this pattern). Here is an example of combining currying with node.js to process a file:</p>
	
	<img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/0*wtp1yNVjD6HGbtpE.png" src="https://cdn-images-1.medium.com/max/800/0*wtp1yNVjD6HGbtpE.png">
	
	<p name="353e" id="353e" class="graf graf--p graf-after--figure">At first it may not seem like much happened here, but this pattern is actually quite powerful. Integrating node with curried functions allows for the read data to be passed around to other bits of code as the file is getting processed. We can defer invoking the read function's callback until the result is needed. Currying node.js functions can allow for sequential and parallel I/O processing of multiple files, much like the async library for node.js.</p>
	
	<img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/0*zgqcgVckSHW43z57.png" src="https://cdn-images-1.medium.com/max/800/0*zgqcgVckSHW43z57.png">
	
	<p name="6374" id="6374" class="graf graf--p graf-after--figure">Currying is not a pattern that is native to javascript, so it is often handy to write a (currier) utility function that can transform any given function into a curried version of itself.</p>
	
	<img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/0*G5Y40u9uFsnYLOen.png" src="https://cdn-images-1.medium.com/max/800/0*G5Y40u9uFsnYLOen.png">
	
	<p name="021d" id="021d" class="graf graf--p graf-after--figure">Now we can apply currying to any function by passing the function as the first argument to currier.</p>
	
	<img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/0*U6MoKHcpHNC9pj-r.png" src="https://cdn-images-1.medium.com/max/800/0*U6MoKHcpHNC9pj-r.png">
	
	<p name="5a02" id="5a02" class="graf graf--p graf-after--figure">And that's it for currying. I hope you have learned something new about this powerful technique! Do you have an example of currying that you'd like to share? If so, please leave it as a gist in the comments.</p>
	
	<img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/0*rxk19yLmkWES3MQB.png" src="https://cdn-images-1.medium.com/max/800/0*rxk19yLmkWES3MQB.png">
	</div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-21" name="t-21"></a><h1>21 : Currying the callback, or the essence of futures...</h1>
					<div class="tutorial__content">
<p>Wow, this one is not for dummies!!!</p>
<p>I decided to play it pedantic this time because I posted a layman explanation of this thing on the node.js forum and nobody reacted. Maybe it will get more attention if I use powerful words like <em>currying</em> in the title. We'll see…</p>
<h2>Currying</h2>
<p>I'll start with a quick explanation of what <em>currying</em> means so that Javascript programmers who don't know it can catch up. After all, it is a bit of a scary word for something rather simple, and many Javascript programmers have probably already eaten the curry some day without knowing what it was.</p>
<p>The idea behind currying is to take a function like</p>
<pre>function multiply(x, y) { return x * y; }</pre>
<p>and derive the following function from it:</p>
<pre>function curriedMultiply(x) {
  return function(y) { return x * y; }
}</pre>
<p>This function does something simple: it returns specialized multiplier functions. For example, <tt>curriedMultiply(3)</tt> is nothing else than a function which multiplies by 3:</p>
<pre>function(y) {
  return 3 * y;
}</pre>
<p>Attention: <tt>curriedMultiply</tt> does not multiply because it does not return numbers. Instead, it returns functions that multiply.</p>
<p>It is also interesting to note that <tt>multiply(x, y)</tt> is equivalent to <tt>curriedMultiply(x)(y)</tt>.</p>
<h2>Currying the callback</h2>
<p>Now, what happens if we apply this <em>currying</em> principle to node APIs, to single out the callback parameter?</p>
<p>For example, by applying it to node's <tt>fs.readFile(path, encoding, callback)</tt> function, we obtain a function like the following:</p>
<pre>fs.curriedReadFile(path, encoding)</pre>
<p>The same way our <tt>curriedMultiply</tt> gave us specialized <em>multiplier</em> functions, <tt>curriedReadFile</tt> gives us specialized <em>reader</em> functions. For example, if we write:</p>
<pre>var reader = fs.curriedReadFile("hello.txt", "utf8");</pre>
<p>we get a specialized reader function that only knows how to read <tt>hello.txt</tt>. This function is an asynchronous function with a single callback parameter. You would call it as follows to obtain the contents of the file:</p>
<pre>reader(function(err, data) {
  // do something with data
});</pre>
<p>Of course, we have the same equivalence as we did before with <tt>multiply</tt>: <tt>fs.readFile(path, encoding, callback)</tt> and <tt>fs.curriedReadFile(path, encoding)(callback)</tt> are equivalent.</p>
<p>This may sound silly, and you may actually think that this whole currying business is just pointless intellectual masturbation. But it is not! The interesting part is that if we are smart, we can implement <tt>curriedReadFile</tt> so that it starts the asynchronous read operation. And we are not forced to use the reader right away. We can keep it around, pass it to other functions and have our program do other things while the I/O operation progresses. When we need the result, we will call the reader with a callback.</p>
<p>By currying, we have separated the initiation of the asynchronous operation from the retrieval of the result. This is very powerful because now we can initiate several operations in a close sequence, let them do their I/O in parallel, and retrieve their results afterwards. Here is an example:</p>
<pre>var reader1 = curriedReadFile(path1, "utf8");
var reader2 = curriedReadFile(path2, "utf8");
// I/O is parallelized and we can do other things while it runs

// further down the line:
reader1(function(err, data1) {
  reader2(function(err, data2) {
    // do something with data1 and data2
  });
});</pre>
<h2>Futures</h2>
<p><em>Futures</em> is a powerful programming abstraction that does more or less what I just described: it encapsulates an asynchronous operation and allows you to obtain the result later. Futures usually come with some API around them and a bit of runtime to support them.</p>
<p>My claim here is that we can probably capture the <em>essence</em> of futures with the simple <em>currying</em> principle that I just described. The <tt>reader1</tt> and <tt>reader2</tt> of the previous example are just <em>futures</em>, in their simplest form.</p>
<h2>Implementation</h2>
<p>This looks good but how hard is it to implement?</p>
<p>Fortunately, all it takes is a few lines of Javascript. Here is our curried <tt>readFile</tt> function:</p>
<pre>function curriedReadFile(path, encoding) {
  var done, err, result;
  var cb = function(e, r) { done = true; err = e, result = r; };
  fs.readFile(path, encoding, function(e, r) { cb(e, r); });
  return function(_) { if (done) _(err, result); else cb = _; };
}</pre>
<p>I won't go into a detailed explanation of how it works.</p>
<h2><a id="further"></a>Going one step further</h2>
<p>Now, we can go one step further and create a generic utility that will help us <em>currify</em> any asynchronous function. Here is a simplified version of this utility (the complete source is on <a href="https://github.com/Sage/streamlinejs/blob/master/lib/util/future.js">streamline's GitHub site</a>):</p>
<pre>function future(fn, args, i) {
  var done, err, result;
  var cb = function(e, r) { done = true; err = e, result = r; };
  args = Array.prototype.slice.call(args);
  args[i] = function(e, r) { cb(e, r); };
  fn.apply(this, args);
  return function(_) { if (done) _(err, result); else cb = _; };
}</pre>
<p>With this utility we can rewrite <tt>curriedReadFile</tt> as:</p>
<pre>function curriedReadFile(path, encoding) {
  return future(fs.readFile, arguments, 2);
}</pre>
<p>And then, we could even get one step further, and tweak the code of the original <tt>fs.readFile</tt> in the following way:</p>
<pre>var original = fs.readFile;
fs.readFile = function(path, encoding, callback) {
  // note: assumes always called with encoding arg
  if (!callback) return future(readFile, arguments, 2);
  // delegate implementation to original function
  original.apply(this, arguments);
}</pre>
<p>With this tweak we obtain a handy API that can be used in two ways:</p>
<ul>
<li>directly, as a normal asynchronous call:
<pre>fs.readFile("hello.txt", "utf8", function(err, data) { ... }</pre>
</li>
<li>indirectly, as a synchronous call that returns a future:
<pre>// somewhere:
var reader = fs.readFile("hello.txt", "utf8");

// elsewhere:
reader(function(err, data) { ... });</pre>
</li>
</ul>
<h2>Blending it with streamline.js</h2>
<p>I have integrated this into streamline.js. The transformation engine adds the little <tt>if (!callback) return future(...)</tt> test in every function it generates. Then, every <em>streamlined</em> function can be used either directly, as an asynchronous call, or indirectly, to obtain a future.</p>
<p>Moreover, obtaining a value from a future does not require any hairy callback code any more because the streamline engine generates the callbacks for you. Everything falls down very nicely into place as the following example demonstrates:</p>
<pre>function countLines(path, _) {
  return fs.readFile(path, "utf8", _).split('\n').length;
}

function compareLineCounts(path1, path2, _) {
  // parallelize the two countLines operations
  // with two futures.
  var n1 = countLines(path1);
  var n2 = countLines(path2);
  // get the results and combine them
  return n1(_) - n2(_);
}</pre>
<h2>Wrapping it up</h2>
<p>I was looking for an elegant way to implement futures in streamline.js and I'm rather happy with this design. I don't know if it will get wider adoption but I think that it would be nice if node's API could behave this way and return futures when called without callback. Performance should not be an issue because all that is required is a simple test upon function entry.</p>
<p>I also find it cute that a future would just be the curried version of an asynchronous function.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-22" name="t-22"></a><h1>22 : Rethinking JavaScript: Eliminate the switch statement for better code</h1>
					<div class="tutorial__content">
<div class="section-inner sectionLayout--insetColumn">
	
	<p name="ef3d" id="ef3d" class="graf graf--p graf-after--figure">In my last 3 articles I convinced you to <a href="https://medium.com/p/rethinking-javascript-the-if-statement-b158a61cd6cb" data-href="https://medium.com/p/rethinking-javascript-the-if-statement-b158a61cd6cb" class="markup--anchor markup--p-anchor" target="_blank">remove the if statement</a>, <a href="https://hackernoon.com/rethinking-javascript-death-of-the-for-loop-c431564c84a8" data-href="https://hackernoon.com/rethinking-javascript-death-of-the-for-loop-c431564c84a8" class="markup--anchor markup--p-anchor" target="_blank">kill the for loop</a>, and <a href="https://hackernoon.com/rethinking-javascript-break-is-the-goto-of-loops-51b27b1c85f8" data-href="https://hackernoon.com/rethinking-javascript-break-is-the-goto-of-loops-51b27b1c85f8" class="markup--anchor markup--p-anchor" target="_blank">never use break</a>. Now I'm going try to convince you to eliminate the switch statement.</p><p name="81d3" id="81d3" class="graf graf--p graf-after--p">While the switch statement is useful, it doesn't quite fit in with the rest of our functional code. It's not Immutable, it can't be composed with other functions, and it's a little side effecty.</p><p name="fb02" id="fb02" class="graf graf--p graf-after--p">Switch also uses <code class="markup--code markup--p-code">break</code>, which is also anti-functional. (Find out why <code class="markup--code markup--p-code">break</code> is so horrible in the article below)</p><div name="824d" id="824d" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://hackernoon.com/rethinking-javascript-break-is-the-goto-of-loops-51b27b1c85f8" data-href="https://hackernoon.com/rethinking-javascript-break-is-the-goto-of-loops-51b27b1c85f8" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/rethinking-javascript-break-is-the-goto-of-loops-51b27b1c85f8"><strong class="markup--strong markup--mixtapeEmbed-strong">Rethinking JavaScript: Replace break by going functional</strong><br><em class="markup--em markup--mixtapeEmbed-em">In my last article, Death of the for Loop, I tried to convince you to abandon the for loop for a more functional…</em>hackernoon.com</a><a href="https://hackernoon.com/rethinking-javascript-break-is-the-goto-of-loops-51b27b1c85f8" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="1f66deb50df6dc35d3f28407bcdf4596" data-thumbnail-img-id="1*10ZLeqFussrnUE7n1ZX2CA.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*10ZLeqFussrnUE7n1ZX2CA.png);"></a></div><p name="f585" id="f585" class="graf graf--p graf-after--mixtapeEmbed">What I really want is something immutable and free of side effects. Something I can pass one value in and get one value out. You know, something functional!</p><p name="77e7" id="77e7" class="graf graf--p graf-after--p">Let's dig right in and take a look at an example straight from the <a href="https://github.com/reactjs/redux" data-href="https://github.com/reactjs/redux" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">redux website</a>.</p><pre name="ecf4" id="ecf4" class="graf graf--pre graf-after--p">function counter(state = 0, action) {<br>  switch (action.type) {<br>    case 'INCREMENT':<br>      return state + 1<br>    case 'DECREMENT':<br>      return state - 1<br>    default:<br>      return state<br>  }<br>}</pre><p name="990c" id="990c" class="graf graf--p graf-after--pre">I tried playing with this a bit and ended up converting it to a nested ternary.</p><pre name="e295" id="e295" class="graf graf--pre graf-after--p">const counter (state = 0, action) =&gt;<br>  action.type === 'INCREMENT' ? state + 1 :<br>  action.type === 'DECREMENT' ? state -1 :<br>                              : state</pre><p name="9ade" id="9ade" class="graf graf--p graf-after--pre">(If you find this syntax confusing, then check out this article, it will explain <code class="markup--code markup--p-code">if</code>'s and nested ternary.)</p><div name="df53" id="df53" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" data-href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb"><strong class="markup--strong markup--mixtapeEmbed-strong">Rethinking JavaScript: The if statement</strong><br><em class="markup--em markup--mixtapeEmbed-em">Thinking functionally has opened my mind about programming.</em>medium.com</a><a href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="0ffbc7ede379784261df7f1b20b5d5ce" data-thumbnail-img-id="1*TlipICpRe1h4EZf-8J5utA.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*TlipICpRe1h4EZf-8J5utA.png);"></a></div><p name="7b80" id="7b80" class="graf graf--p graf-after--mixtapeEmbed">This is better, but one thing I didn't like was repetition of <code class="markup--code markup--p-code">action.type ===</code>. So then I thought I could probably use an object literal. I could also create a function to wrap the object literal and at the same time add support for a default case.</p><pre name="cb19" id="cb19" class="graf graf--pre graf-after--p">function switchcase (cases, defaultCase, key) =&gt; {<br>  if (key in cases) {<br>    return cases[key]<br>  } else {<br>    return defaultCase<br>  }<br>}</pre><p name="a609" id="a609" class="graf graf--p graf-after--pre">Now let's curry this bad boy, convert the <code class="markup--code markup--p-code">if</code> to a ternary and ES6 it up a bit!</p><pre name="4c84" id="4c84" class="graf graf--pre graf-after--p">const switchcase = cases =&gt; defaultCase =&gt; key =&gt;<br>  key in cases ? cases[key] : defaultCase</pre><p name="1d70" id="1d70" class="graf graf--p graf-after--pre">Sexy!</p><p name="f1f4" id="f1f4" class="graf graf--p graf-after--p">Now our reducer would look like this…</p><pre name="bffd" id="bffd" class="graf graf--pre graf-after--p">const counter (state = 0, action) =&gt;<br>  switchcase({<br>    'INCREMENT': state + 1,<br>    'DECREMENT': state -1<br>  })(state)(action.type)</pre><p name="963b" id="963b" class="graf graf--p graf-after--pre">The problem with this early version of <code class="markup--code markup--p-code">switchcase</code> is the entire object literal is evaluated before being passed to the <code class="markup--code markup--p-code">switchcase</code> function. This means <code class="markup--code markup--p-code">state +1</code> and <code class="markup--code markup--p-code">state -1</code> are both evaluated. This can be very dangerous… No bueno.</p><p name="bfbd" id="bfbd" class="graf graf--p graf-after--p">Hmm… if the values in the object literal were functions, then they could be executed only when there is a matching case.</p><p name="dc37" id="dc37" class="graf graf--p graf-after--p">So let's create a companion function called <code class="markup--code markup--p-code">switchcaseF</code> (F is for function), which is just like <code class="markup--code markup--p-code">switchcase</code> except it's values are functions.</p><pre name="e821" id="e821" class="graf graf--pre graf-after--p">const switchcaseF = cases =&gt; defaultCase =&gt; key =&gt;<br>  switchcase(cases)(defaultCase)(key)<strong class="markup--strong markup--pre-strong">()</strong></pre><p name="a80e" id="a80e" class="graf graf--p graf-after--pre">Now the reducer's values can be changed to functions and only the matching case will be evaluated.</p><pre name="97ed" id="97ed" class="graf graf--pre graf-after--p">const counter (state = 0, action) =&gt;<br>  switchcase({<br>    'INCREMENT': <strong class="markup--strong markup--pre-strong">() =&gt;</strong> state + 1,<br>    'DECREMENT': <strong class="markup--strong markup--pre-strong">() =&gt;</strong> state -1<br>  })(<strong class="markup--strong markup--pre-strong">() =&gt;</strong> state)(action.type)</pre><p name="def6" id="def6" class="graf graf--p graf-after--pre">…but I kinda want these functions to be <em class="markup--em markup--p-em">optional</em>. So let's try adding this…</p><pre name="3422" id="3422" class="graf graf--pre graf-after--p">const executeIfFunction = f =&gt;<br>  f instanceof Function ? f() : f</pre><pre name="14b0" id="14b0" class="graf graf--pre graf-after--pre">const switchcaseF = cases =&gt; defaultCase =&gt; key =&gt;<br>  executeIfFunction(switchcase(cases)(defaultCase)(key))</pre><p name="ed45" id="ed45" class="graf graf--p graf-after--pre">Now our redux reducer can look like this (notice the default value)…</p><pre name="110a" id="110a" class="graf graf--pre graf-after--p">const counter (state = 0, action) =&gt;<br>  switchcase({<br>    'INCREMENT': () =&gt; state + 1,<br>    'DECREMENT': () =&gt; state -1<br>  })<strong class="markup--strong markup--pre-strong">(state)</strong>(action.type)</pre><p name="39cc" id="39cc" class="graf graf--p graf-after--pre">OK, not vastly different, but we could do stuff like this. (added a RESET)</p><pre name="083f" id="083f" class="graf graf--pre graf-after--p">const counter (state = 0, action) =&gt;<br>  switchcase({<br>    <strong class="markup--strong markup--pre-strong">'RESET': 0,</strong><br>    'INCREMENT': () =&gt; state + 1,<br>    'DECREMENT': () =&gt; state -1<br>  })(state)(action.type)</pre><h3 name="7190" id="7190" class="graf graf--h3 graf-after--pre">Another Example</h3><p name="5b79" id="5b79" class="graf graf--p graf-after--h3">This example is taken from <a href="http://www.w3schools.com/js/js_switch.asp" data-href="http://www.w3schools.com/js/js_switch.asp" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">http://www.w3schools.com/js/js_switch.asp</a></p><pre name="8480" id="8480" class="graf graf--pre graf-after--p">var day;</pre><pre name="904c" id="904c" class="graf graf--pre graf-after--pre">switch (new Date().getDay()) {<br>    case 0:<br>        day = "Sunday";<br>        break;<br>    case 1:<br>        day = "Monday";<br>        break;<br>    case 2:<br>        day = "Tuesday";<br>        break;<br>    case 3:<br>        day = "Wednesday";<br>        break;<br>    case 4:<br>        day = "Thursday";<br>        break;<br>    case 5:<br>        day = "Friday";<br>        break;<br>    case 6:<br>        day = "Saturday";<br>}</pre><p name="39e1" id="39e1" class="graf graf--p graf-after--pre">Because we have properly curried <code class="markup--code markup--p-code">switchcase</code> like good boys and girls we can decompose this switch to multiple reusable methods, and we all know…</p><blockquote name="4a70" id="4a70" class="graf graf--pullquote graf-after--p">making our code reusable should always be one of our&nbsp;goals.</blockquote><pre name="b5bf" id="b5bf" class="graf graf--pre graf-after--pullquote">const getDay = switchcase({<br>    0: 'Sunday',<br>    1: 'Monday',<br>    2: 'Tuesday',<br>    3: 'Wednesday',<br>    4: 'Thursday',<br>    5: 'Friday',<br>    6: 'Saturday'<br>  })('Unknown')</pre><pre name="36f3" id="36f3" class="graf graf--pre graf-after--pre">const getCurrentDay = () =&gt;<br>  getDay(new Date().getDay())</pre><pre name="bebb" id="bebb" class="graf graf--pre graf-after--pre">const day = getCurrentDay()</pre><p name="0fd0" id="0fd0" class="graf graf--p graf-after--pre">Here we have separated out all the logic from our impure <code class="markup--code markup--p-code">getCurrentDay</code> function into a pure <code class="markup--code markup--p-code">getDay</code> function. This will make testing and <strong class="markup--strong markup--p-strong">function composition</strong> much easier.</p><div name="bc8f" id="bc8f" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://hackernoon.com/javascript-functional-composition-for-every-day-use-22421ef65a10" data-href="https://hackernoon.com/javascript-functional-composition-for-every-day-use-22421ef65a10" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/javascript-functional-composition-for-every-day-use-22421ef65a10"><strong class="markup--strong markup--mixtapeEmbed-strong">Functional JavaScript: Function Composition For Every Day Use.</strong><br><em class="markup--em markup--mixtapeEmbed-em">Function composition has got to be my favorite part of functional programming. I hope to provide you with a good real…</em>hackernoon.com</a><a href="https://hackernoon.com/javascript-functional-composition-for-every-day-use-22421ef65a10" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="97823b68fe799c57684da5a5fd1564a7" data-thumbnail-img-id="1*3sCt4oZw74j4RlTH39NskQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*3sCt4oZw74j4RlTH39NskQ.jpeg);"></a></div><h3 name="feaa" id="feaa" class="graf graf--h3 graf-after--mixtapeEmbed">Extra Credit</h3><p name="d574" id="d574" class="graf graf--p graf-after--h3">Now we can do cool things like create a <code class="markup--code markup--p-code">switchcase</code> programatically!</p><pre name="6ce8" id="6ce8" class="graf graf--pre graf-after--p">const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']</pre><pre name="c779" id="c779" class="graf graf--pre graf-after--pre">const getDay = switchcase(<br>  days.reduce((acc, value) =&gt;<br>    (acc[value] = `The day is ${value}.`, acc), {})<br>  )("I don't know what day it is.")</pre><pre name="9ebd" id="9ebd" class="graf graf--pre graf-after--pre">console.log(getDay('Monday'))</pre><pre name="147b" id="147b" class="graf graf--pre graf-after--pre">// 'The day is Monday.</pre><p name="ed87" id="ed87" class="graf graf--p graf-after--pre">This isn't the greatest example. There are obvious and better ways to generate this sentence, I'm just trying to demo what the <code class="markup--code markup--p-code">switchcase</code> can do, so cut me some slack!</p><h3 name="b26b" id="b26b" class="graf graf--h3 graf-after--p">The Code</h3><p name="ac2b" id="ac2b" class="graf graf--p graf-after--h3">Here's our final, pure, immutable and functional <code class="markup--code markup--p-code">switchcase</code> code.</p><h3 name="7307" id="7307" class="graf graf--h3 graf-after--figure">3rd Party Libraries</h3><p name="3b59" id="3b59" class="graf graf--p graf-after--h3">For those interested in digging deeper into the functional world, there are some great libraries out there I would like to recommend.</p><p name="8bce" id="8bce" class="graf graf--p graf-after--p"><a href="http://ramdajs.com/" data-href="http://ramdajs.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Ramda</strong> </a>— Ramda is a functional library similar to lodash and underscore. Check out Ramda's <code class="markup--code markup--p-code">cond</code> function. The functionality if similar to this <code class="markup--code markup--p-code">switchcase</code> and a great alternative!</p><p name="5220" id="5220" class="graf graf--p graf-after--p"><a href="https://github.com/lodash/lodash/wiki/FP-Guide" data-href="https://github.com/lodash/lodash/wiki/FP-Guide" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">lodash/fp</strong></a> — lodash/fp is the functional version of lodash. It's worth taking a look.</p><p name="9e7e" id="9e7e" class="graf graf--p graf-after--p"><a href="https://github.com/fantasyland/fantasy-land" data-href="https://github.com/fantasyland/fantasy-land" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Fantasy Land</strong></a> — One of the more popular functional libraries for JavaScript.</p><h3 name="199a" id="199a" class="graf graf--h3 graf-after--p">Summary</h3><p name="1a16" id="1a16" class="graf graf--p graf-after--h3">The switch statement doesn't fit into our functional paradigm, but we can create a function that has similar characteristics. Doing so let's us decompose the switch into smaller and reusable pieces. We can even generate one programatically!</p><p name="99e2" id="99e2" class="graf graf--p graf-after--p">I know it's a small thing, but it makes my day when I get those follow notifications on Medium and Twitter (<a href="https://twitter.com/joelnet" data-href="https://twitter.com/joelnet" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@joelnet</a>). Or if you think I'm full of shit, tell me in the comments below.</p><p name="56ae" id="56ae" class="graf graf--p graf-after--p">Cheers!</p><p name="aa4b" id="aa4b" class="graf graf--p graf-after--p">note: before you flip out about <code class="markup--code markup--p-code">switchcase</code> not supporting 'fall-through', this is because I didn't have a need for it in my project. It's not meant to be an exact replica of <code class="markup--code markup--p-code">switch</code>. <a href="https://martinfowler.com/bliki/Yagni.html" data-href="https://martinfowler.com/bliki/Yagni.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">YAGNI</a> or something.</p></div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-23" name="t-23"></a><h1>23 : Functional JavaScript: Function Composition For Every Day Use.</h1>
					<span>https://hackernoon.com/javascript-functional-composition-for-every-day-use-22421ef65a10#.v2ffc1h30</span>
					<div class="tutorial__content">
					
<div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="5ee5" id="5ee5" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Function composition</strong> has got to be my favorite part of functional programming. I hope to provide you with a good real world example so not only do you understand function composition, but so you can begin using today! In this article will learn how to write as well as <em class="markup--em markup--p-em">organize your files</em>, so you can write short, clean and <strong class="markup--strong markup--p-strong">functional</strong> code like this…</p><pre>import { listGroupPanel } from './lib/html'
import { setInnerHtml }   from './lib/dom'

const content = document.getElementById('content')
const main = e =&gt; compose(setInnerHtml(e), listGroupPanel)

const list = [
  'Cras justo odio',
  'Dapibus ac facilisis in',
  'Morbi leo risus',
  'Porta ac consectetur ac',
  'Vestibulum at eros'
]

main(content)(list)</pre><p name="d6ea" id="d6ea" class="graf graf--p graf-after--figure">…that will produce output like this…</p><pre>&lt;div class="panel panel-default"&gt;
  &lt;div class="panel-body"&gt;
    &lt;ul class="list-group"&gt;
      &lt;li class="list-group-item"&gt;Cras justo odio&lt;/li&gt;
      &lt;li class="list-group-item"&gt;Dapibus ac facilisis in&lt;/li&gt;
      &lt;li class="list-group-item"&gt;Morbi leo risus&lt;/li&gt;
      &lt;li class="list-group-item"&gt;Porta ac consectetur ac&lt;/li&gt;
      &lt;li class="list-group-item"&gt;Vestibulum at eros&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre><p name="ad3e" id="ad3e" class="graf graf--p graf-after--figure">Head straight to the <a href="http://codepen.io/joelnet/pen/QdVpwB" data-href="http://codepen.io/joelnet/pen/QdVpwB" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">codepen</a> if you want to tinker. Continue reading to start learning&nbsp;:)</p><h3 name="6504" id="6504" class="graf graf--h3 graf-after--p">The Basics</h3><p name="3540" id="3540" class="graf graf--p graf-after--h3">We have to walk before we can run, so let's start with the boring stuff that you need to know.</p><blockquote name="d292" id="d292" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">Function composition</strong> is a mathematical concept that allows you to combine two or more functions into a new function.</blockquote><p name="9b73" id="9b73" class="graf graf--p graf-after--blockquote">You have probably stumbled across this example when googling function composition. If you haven't yet, I assure you, you will.</p><pre>const add = x =&gt; y =&gt; x + y
const multiply = x =&gt; y =&gt; x * y
const add2Multiply3 = compose(multiply(3), add(2))</pre><p name="93f5" id="93f5" class="graf graf--p graf-after--figure">I myself am guilty of using this example and what I failed to realize is that the student is not yet able to see how this can be practically applied in their codebase <em class="markup--em markup--p-em">today</em>. Instead they are comparing that example with something like this:</p><pre name="bdb4" id="bdb4" class="graf graf--pre graf-after--p">const value = (x + 2) * 3</pre><p name="eb07" id="eb07" class="graf graf--p graf-after--pre"><em class="markup--em markup--p-em">It is hard to see why</em> you would prefer the functional example.</p><blockquote name="deff" id="deff" class="graf graf--pullquote graf-after--p"><span class="markup--quote markup--pullquote-quote is-other" name="anon_f0a632de594e" data-creator-ids="anon">A teacher's failure to properly provide good real world examples will result in a student's failure to understand why.</span></blockquote><p name="0076" id="0076" class="graf graf--p graf-after--pullquote">Hopefully I can do a better job of demonstrating the power of function composition.</p><h3 name="cc34" id="cc34" class="graf graf--h3 graf-after--p">Back to&nbsp;Basics</h3><p name="95d9" id="95d9" class="graf graf--p graf-after--h3">A key to function composition is having functions that are composable. A composable function should have 1 input argument and 1 output value.</p><p name="4f7e" id="4f7e" class="graf graf--p graf-after--p">You can turn any function into a composable function by currying the function. I'll expand on currying in another article, but you should still be able to follow along without knowing what currying is.</p><p name="c09f" id="c09f" class="graf graf--p graf-after--p">You might do html stuff, so that's a good point to start. Let's make a <code class="markup--code markup--p-code">tag</code>. (I'm going to be working with strings here, but you could also do this with React).</p><pre name="662b" id="662b" class="graf graf--pre graf-after--p">const tag = t =&gt; contents =&gt; `&lt;${t}&gt;${contents}&lt;/${t}&gt;`</pre><pre name="c5f7" id="c5f7" class="graf graf--pre graf-after--pre">tag('b')('this is bold!') </pre><pre name="0f0c" id="0f0c" class="graf graf--pre graf-after--pre">&gt; &lt;b&gt;this is bold!&lt;/b&gt;</pre><p name="f7b0" id="f7b0" class="graf graf--p graf-after--pre">I also want a function to handle tags with attributes like <code class="markup--code markup--p-code">&lt;div class="title"&gt;...&lt;/div&gt;</code>. So I'll add another function to handle this use case.</p><pre>const encodeAttribute = (x = '') =&gt;
  x.replace(/"/g, '"')

const toAttributeString = (x = {}) =&gt;
  Object.keys(x)
    .map(attr =&gt; `${encodeAttribute(attr)}="${encodeAttribute(x[attr])}"`) 
    .join(' ')

const tagAttributes = x =&gt; c =&gt;
  `&lt;${x.tag}${x.attr?' ':''}${toAttributeString(x.attr)}&gt;${c}&lt;/${x.tag}&gt;` </pre><p name="da79" id="da79" class="graf graf--p graf-after--figure">Sprinkle in a little refactoring to combine it all into these four functions…</p><pre>const encodeAttribute = (x = '') =&gt;
  x.replace(/"/g, '"')

const toAttributeString = (x = {}) =&gt;
  Object.keys(x)
    .map(attr =&gt; `${encodeAttribute(attr)}="${encodeAttribute(x[attr])}"`) 
    .join(' ')

const tagAttributes = x =&gt; (c = '') =&gt;
  `&lt;${x.tag}${x.attr?' ':''}${toAttributeString(x.attr)}&gt;${c}&lt;/${x.tag}&gt;`

const tag = x =&gt;
  typeof x === 'string'
    ? tagAttributes({ tag: x })
    : tagAttributes(x)</pre><p name="78ac" id="78ac" class="graf graf--p graf-after--figure">Now we can call <code class="markup--code markup--p-code">tag</code> with a <code class="markup--code markup--p-code">string</code> or an <code class="markup--code markup--p-code">object</code>.</p><pre>const bold = tag('b')

bold('this is bold!')
// &lt;b&gt;this is bold!&lt;/b&gt;

tag('b')('this is bold!')
// &lt;b&gt;this is bold!&lt;/b&gt;

tag({ tag: 'div', attr: { 'class': 'title' }})('this is a title!') 
// &lt;div class="title"&gt;this is a title!&lt;/div&gt;</pre><h3 name="5cfe" id="5cfe" class="graf graf--h3 graf-after--figure">Making Something Real</h3><p name="47dc" id="47dc" class="graf graf--p graf-after--h3">Now that you've made it through that boring stuff, you deserve some fun code.</p><p name="282e" id="282e" class="graf graf--p graf-after--p">Let's use that fancy new <code class="markup--code markup--p-code">tag</code> function to create something tangible. We can use something easy and something familiar, <a href="https://getbootstrap.com/components/#list-group" data-href="https://getbootstrap.com/components/#list-group" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">bootstrap's list group</a>.</p><pre>&lt;ul class="list-group"&gt;
  &lt;li class="list-group-item"&gt;Cras justo odio&lt;/li&gt;
  &lt;li class="list-group-item"&gt;Dapibus ac facilisis in&lt;/li&gt;
  &lt;li class="list-group-item"&gt;Morbi leo risus&lt;/li&gt;
  &lt;li class="list-group-item"&gt;Porta ac consectetur ac&lt;/li&gt;
  &lt;li class="list-group-item"&gt;Vestibulum at eros&lt;/li&gt;
&lt;/ul&gt;</pre><p name="3f0f" id="3f0f" class="graf graf--p graf-after--figure">First, let's create a function for each of these tags and <code class="markup--code markup--p-code">listGroupItems</code> to support multiple <code class="markup--code markup--p-code">listGroupItem</code>s.</p><pre>const listGroup = tag({ tag: 'ul', attr: { class: 'list-group' }})
const listGroupItem = tag({ tag: 'li', attr: { class: 'list-group-item' }})
const listGroupItems = items =&gt;
  items.map(listGroupItem)
    .join('')

listGroup()
// &lt;ul class="list-group"&gt;&lt;/ul&gt;

listGroupItem('Cras justo')
// &lt;li class="list-group-item"&gt;Cras justo&lt;/li&gt;

listGroupItems(['Cras justo', 'Dapibus ac'])
// &lt;li class='list-group-item'&gt;Cras justo&lt;/li&gt;
// &lt;li class='list-group-item'&gt;Dapibus ac&lt;/li&gt;

listGroup(listGroupItems(['Cras justo', 'Dapibus ac']))
// &lt;ul class='list-group'&gt;
//   &lt;li class='list-group-item'&gt;Cras justo&lt;/li&gt;
//   &lt;li class='list-group-item'&gt;Dapibus ac&lt;/li&gt;
// &lt;/ul&gt;</pre><p name="2505" id="2505" class="graf graf--p graf-after--figure">If we look at the structure of the list-group html we can see that there is one outer element that contains multiple children. Since it will <em class="markup--em markup--p-em">always</em> be created this way, it seems a little verbose to call <code class="markup--code markup--p-code">listGroup(listGroupItems(['Cras justo', 'Dapibus ac']))</code> to render the list every time.</p><p name="9cef" id="9cef" class="graf graf--p graf-after--p">I should just be able to call <code class="markup--code markup--p-code">listGroup(['Cras justo', 'Dapibus ac'])</code>. The function should know what I want to do.</p><p name="73fc" id="73fc" class="graf graf--p graf-after--p">To do this I'll start by renaming <code class="markup--code markup--p-code">listGroup</code> to <code class="markup--code markup--p-code">listGroupTag</code>. That way I can create a new <code class="markup--code markup--p-code">listGroup</code> function that will encapsulate the call to <code class="markup--code markup--p-code">listGroupTag(listGroupItems([]))</code>.</p><pre>const listGroupTag = tag({ tag: 'ul', attr: { class: 'list-group' }})
const listGroup = items =&gt;
  listGroupTag(listGroupItems(items))</pre><h3 name="0173" id="0173" class="graf graf--h3 graf-after--figure">Function Composition</h3><p name="6c68" id="6c68" class="graf graf--p graf-after--figure">For those of you that skipped the whole article and scrolled all the way down to this section, you might be disappointed. Composing the functions is actually the easiest part of the whole process. After you have created your functions to be composable, they just kind of snap together.</p><p name="715a" id="715a" class="graf graf--p graf-after--p">Take a look at the code below. Any time you recognize this pattern, the functions can be easily composed.</p><pre name="9cdb" id="9cdb" class="graf graf--pre graf-after--p">const listGroup = items =&gt;<br>  listGroupTag(listGroupItems(items))</pre><p name="789c" id="789c" class="graf graf--p graf-after--pre">When composed together, the result will look similar to the original, <code class="markup--code markup--p-code">listGroupTag</code> on the left, followed by <code class="markup--code markup--p-code">listGroupItems,</code> and then <code class="markup--code markup--p-code">items</code> on the right.</p><pre name="1963" id="1963" class="graf graf--pre graf-after--p">const listGroup = items =&gt;<br>  compose(listGroupTag, listGroupItems)(items)</pre><p name="6238" id="6238" class="graf graf--p graf-after--pre">Let's look at them side-by-side so we can see the similarities and differences.</p><pre>        listGroupTag (listGroupItems (items))
compose(listGroupTag, listGroupItems)(items)</pre><p name="2565" id="2565" class="graf graf--p graf-after--figure">When functions are composed together, they are read from right to left just like regular functions.</p><p name="9338" id="9338" class="graf graf--p graf-after--p">Because <code class="markup--code markup--p-code">compose</code> returns a function that takes a <code class="markup--code markup--p-code">list</code> and our <code class="markup--code markup--p-code">listGroup</code> function also takes a <code class="markup--code markup--p-code">list</code>, we can simplify <code class="markup--code markup--p-code">listGroup</code> to equal our composition and remove <code class="markup--code markup--p-code">list</code>.</p><pre name="e986" id="e986" class="graf graf--pre graf-after--p">const listGroup =<br>  compose(listGroupTag, listGroupItems)</pre><p name="f9dc" id="f9dc" class="graf graf--p graf-after--pre">By now your mind is probably not blown and I understand. Out of all this code we have written, function composition helped us simplify only a single line of code.</p><blockquote name="2126" id="2126" class="graf graf--pullquote graf-after--p">The power of function composition is realized as your codebase grows, allowing you to create numerous compositions.</blockquote><p name="651a" id="651a" class="graf graf--p graf-after--pullquote">So let's add a bootstrap panel.</p><pre>const panelTag = tag({ tag: 'div', attr: { class: 'panel panel-default' }})
const panelBody = tag({ tag: 'div', attr: { class: 'panel-body' }})
const basicPanel =
  compose(panelTag, panelBody)</pre><p name="a86c" id="a86c" class="graf graf--p graf-after--figure">Now if we want to create an element that is a <code class="markup--code markup--p-code">list-group</code> inside of a <code class="markup--code markup--p-code">panel</code>, all we have to do is this:</p><pre name="9698" id="9698" class="graf graf--pre graf-after--p">const listGroupPanel =<br>  compose(basicPanel, listGroup)</pre><p name="c7a4" id="c7a4" class="graf graf--p graf-after--pre">The (above) function is also equivelant to this (below). You can compose any amount of functions!</p><pre name="17d0" id="17d0" class="graf graf--pre graf-after--p">const listGroupPanel =<br>  compose(basicPanel, listGroupTag, listGroupItems)</pre><h3 name="1a23" id="1a23" class="graf graf--h3 graf-after--pre">Organizing Your&nbsp;Code</h3><p name="470d" id="470d" class="graf graf--p graf-after--h3">Organizing your code is also very important. This involves separating your functions into multiple files.</p><p name="2652" id="2652" class="graf graf--p graf-after--p">I like to create a file called <code class="markup--code markup--p-code">functional.js</code> and this is where I put <code class="markup--code markup--p-code">compose</code> and related functional functions.</p><p name="8f6e" id="8f6e" class="graf graf--p graf-after--p">All of the functions we created above I would put in <code class="markup--code markup--p-code">html.js</code>.</p><p name="4256" id="4256" class="graf graf--p graf-after--p">I am also creating a <code class="markup--code markup--p-code">dom.js</code> for DOM manipulation (you will see in the codepen.)</p><p name="4af1" id="4af1" class="graf graf--p graf-after--p">Breaking our code out into multiple library files&nbsp;allows&nbsp;us&nbsp;to&nbsp;reuse&nbsp;these&nbsp;functions&nbsp;in&nbsp;other&nbsp;projects.</p><p name="24f6" id="24f6" class="graf graf--p graf-after--p">Now when we write the main program in <code class="markup--code markup--p-code">main.js</code>, there will be very little code.</p><h3 name="62f0" id="62f0" class="graf graf--h3 graf-after--p">The Example</h3><p name="0a5c" id="0a5c" class="graf graf--p graf-after--h3">I can't break up the codepen example into multiple files, so I have separated them using comments so you can see how to properly layout your files.</p><p name="34fd" id="34fd" class="graf graf--p graf-after--p">I put the final app up on codepen&nbsp;, so you can tinker with it.<br><a href="https://codepen.io/joelnet/pen/QdVpwB" data-href="https://codepen.io/joelnet/pen/QdVpwB" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener" target="_blank">https://codepen.io/joelnet/pen/QdVpwB</a></p></div><div class="section-inner sectionLayout--insetColumn"><h3 name="172b" id="172b" class="graf graf--h3 graf-after--figure">The Math</h3><p name="e6da" id="e6da" class="graf graf--p graf-after--h3">Originally I had some stuff here, but you don't need to know gravity's equation to know objects attract.</p><h3 name="6dba" id="6dba" class="graf graf--h3 graf-after--p">Compose and&nbsp;Pipe</h3><p name="85dc" id="85dc" class="graf graf--p graf-after--h3">It is also worth mentioning, <code class="markup--code markup--p-code">compose</code> has a companion function <code class="markup--code markup--p-code">pipe</code>. <code class="markup--code markup--p-code">pipe</code> also composes functions, but in reverse order. In some situations, it can be easier to understand when it's written left to write.</p><pre name="baf8" id="baf8" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">// pseudo code</code></pre><pre name="59ee" id="59ee" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">const login = pipe(<br>  validateInput,<br>  getCustomer,<br>  getAuthToken<br>  loginResponse)</code></pre><p name="7863" id="7863" class="graf graf--p graf-after--pre">Here are the functions, I would recommend putting these in a <code class="markup--code markup--p-code">functional.js</code> library that you can include in all your projects.</p><pre>const compose = (...functions) =&gt; data =&gt;
  functions.reduceRight((value, func) =&gt; func(value), data)

const pipe = (...functions) =&gt; data =&gt;
  functions.reduce((value, func) =&gt; func(value), data)</pre><h3 name="b8c9" id="b8c9" class="graf graf--h3 graf-after--figure">Summary</h3><p name="d7a9" id="d7a9" class="graf graf--p graf-after--h3">Function composition requires you to write your functions in a composable way. This means your functions must have 1 input and 1 output. Functions with multiple inputs must be curried.</p><p name="a994" id="a994" class="graf graf--p graf-after--p">Composing functions is not only easy but fun too.</p><p name="1255" id="1255" class="graf graf--p graf-after--p">You will achieve the highest level of code reuse with function composition.</p><blockquote name="39fa" id="39fa" class="graf graf--pullquote graf-after--p"><em class="markup--em markup--pullquote-em">making our code reusable should always be one of our&nbsp;goals.</em></blockquote><p name="669e" id="669e" class="graf graf--p graf-after--pullquote">My next article will be about composing <strong class="markup--strong markup--p-strong">asynchronous functions</strong>. I thought I could fit it all into a single article, but this page got long quickly. So let's just stop it here. Subscribe so you do not miss out on Part 2!</p><p name="1db9" id="1db9" class="graf graf--p graf-after--p">I know it's a small thing, but it makes my day when I get those follow notifications on Medium and Twitter (<a href="https://twitter.com/joelnet" data-href="https://twitter.com/joelnet" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@joelnet</a>). Or if you think I'm full of shit, tell me in the comments below.</p><p name="56ae" id="56ae" class="graf graf--p graf-after--p">Cheers!</p></div></div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-24" name="t-24"></a><h1>24 : Currying in JavaScript</h1>
					<div class="tutorial__content">
<section class="post-content">
		<p>I've been thinking a lot lately about functional programming, and I thought it might be kind of fun to walk through the process of writing a <code>curry</code> function.</p>

<p>For the uninitiated, currying refers to the process of taking a function with <code>n</code> arguments and transforming it into <code>n</code> functions that each take a single argument. It essentially creates a chain of partially applied functions that eventually resolves with a value.</p>

<p>Here's a basic example of how you'd use it:</p>

<pre><code>function volume( l, w, h ) {  
  return l * w * h;
}

var curried = curry( volume );

curried( 1 )( 2 )( 3 ); // 6  
</code></pre>

<h6 id="disclaimer">Disclaimer</h6>

<p>This post assumes basic familiarity with closures and higher-order functions, as well as stuff like <code>Function#apply()</code>. If you're not comfortable with those concepts, you might want to brush up before reading further.</p>

<h6 id="writingourcurryfunction">Writing our curry function</h6>

<p>The first thing you'll notice is that <code>curry</code> expects a function as its argument, so we'll start there.</p>

<pre><code>function curry( fn ) {

}
</code></pre>

<p>Next, we need to know how many arguments our function expects (called its "arity"). Otherwise, we won't know when to stop returning new functions and give back a value instead.</p>

<p>We can tell how many arguments a function expects by accessing its <code>length</code> property.</p>

<pre><code>function curry( fn ) {  
  var arity = fn.length;
}
</code></pre>

<p>From there, things get a little bit trickier. </p>

<p>Essentially, every time a curried function is called, we add any new arguments to an array that's saved in a closure. If the number of arguments in that array is equal to the number of arguments that our original function expects, then we call it. Otherwise, we return a new function.</p>

<p>To do that, we need (1) a closure that can retain that list of arguments and (2) a function that can check the total number of arguments and either return another partially applied function <em>or</em> the return value of the original function with all of the arguments applied.</p>

<p>I usually do this with an immediately invoked function called <code>resolver</code>.</p>

<pre><code>function curry( fn ) {  
  var arity = fn.length;

  return (function resolver() {

  }());
}
</code></pre>

<p>Now, the first thing we need to do in <code>resolver</code> is make a copy of any arguments it received. We'll do that by creating a variable called <code>memory</code> that uses <code>Array#slice</code> to make a copy of the <code>arguments</code> object.</p>

<pre><code>function curry( fn ) {  
  var arity = fn.length;

  return (function resolver() {
    var memory = Array.prototype.slice.call( arguments );
  }());
}
</code></pre>

<p>Next, <code>resolver</code> needs to return a function. This is what the outside world sees when it calls a curried function.</p>

<pre><code>function curry( fn ) {  
  var arity = fn.length;

  return (function resolver() {
    var memory = Array.prototype.slice.call( arguments );
    return function() {

    };
  }());
}
</code></pre>

<p>Since this internal function is the one that ends up actually being called, it needs to accept arguments. But it also needs to <em>add</em> those to any arguments that might be stored in <code>memory</code>. So first, we'll make a copy of <code>memory</code> by calling <code>slice()</code> on it.</p>

<pre><code>function curry( fn ) {  
  var arity = fn.length;

  return (function resolver() {
    var memory = Array.prototype.slice.call( arguments );
    return function() {
      var local = memory.slice();
    };
  }());
}
</code></pre>

<p>Now, lets add our new arguments by using <code>Array#push</code>.</p>

<pre><code>function curry( fn ) {  
  var arity = fn.length;

  return (function resolver() {
    var memory = Array.prototype.slice.call( arguments );
    return function() {
      var local = memory.slice();
      Array.prototype.push.apply( local, arguments );
    };
  }());
}
</code></pre>

<p>Good. Now we have a new array containing all the arguments we've received so far in this chain of partially applied functions.</p>

<p>The last thing to do is to compare the length of arguments we've received with the arity of our curried function. If the lengths match, we'll call the original function. If not, we'll use <code>resolver</code> to return yet another function that has all of our current arguments stored in memory.</p>

<pre><code>function curry( fn ) {  
  var arity = fn.length;

  return (function resolver() {
    var memory = Array.prototype.slice.call( arguments );
    return function() {
      var local = memory.slice(), next;
      Array.prototype.push.apply( local, arguments );
      next = local.length &gt;= arity ? fn : resolver;
      return next.apply( null, local );
    };
  }());
}
</code></pre>

<p>This can be a little bit difficult to wrap your head around, so let's take it step by step in an example.</p>

<pre><code>function volume( l, w, h ) {  
  return l * w * h;
}

var curried = curry( volume );  
</code></pre>

<p>Okay, so <code>curried</code> is the result of passing <code>volume</code> into our <code>curry</code> function.</p>

<p>If you look back, what's happening here is:</p>

<ol>
<li>We store the arity of <code>volume</code>, which is <code>3</code>.  </li>
<li>We immediately invoke <code>resolver</code> with no arguments, which means that for now, its <code>memory</code> array is empty.  </li>
<li><code>resolver</code> returns an anonymous function.</li>
</ol>

<p>Still with me? Now let's call our <code>curried</code> function and pass in a length.</p>

<pre><code>function volume( l, w, h ) {  
  return l * w * h;
}

var curried = curry( volume );  
var length = curried( 2 );  
</code></pre>

<p>Again, here are the steps:</p>

<ol>
<li>What we actually called here was the anonymous function being returned by <code>resolver</code>.  </li>
<li>We made a copy of <code>memory</code> (which was empty) and called it <code>local</code>.  </li>
<li>We added our argument (<code>2</code>) to the <code>local</code> array.  </li>
<li>Since the length of <code>local</code> is less than the arity of <code>volume</code>, we call <code>resolver</code> again with the list of arguments we have so far. That creates a new closure with a new <code>memory</code> array, which contains our first argument of <code>2</code>.  </li>
<li>Finally, <code>resolver</code> returns a new function that has access to an outer closure with our new <code>memory</code> array.</li>
</ol>

<p>So what we get back is that inner anonymous function again. But this time, it has access to a <code>memory</code> array that isn't empty. It has our first argument (a <code>2</code>) inside of it.</p>

<p>If we call our <code>length</code> function, the process repeats.</p>

<pre><code>function volume( l, w, h ) {  
  return l * w * h;
}

var curried = curry( volume );  
var length = curried( 2 );  
var lengthAndWidth = length( 3 );  
</code></pre>

<ol>
<li>Again, what we actually called was the anonymous function being returned by <code>resolver</code>.  </li>
<li>This time, <code>resolver</code> had been primed with some previous arguments. So we make a copy of that array <code>[ 2 ]</code>.  </li>
<li>We add our new argument, <code>3</code>, to the <code>local</code> array.  </li>
<li>Since the length of <code>local</code> is still less than the arity of <code>volume</code>, we call <code>resolver</code> again with the list of arguments we have so far -- and that returns a new function.</li>
</ol>

<p>Now it's time to call our <code>lengthAndWidth</code> function and get back a value.</p>

<pre><code>function volume( l, w, h ) {  
  return l * w * h;
}

var curried = curry( volume );  
var length = curried( 2 );  
var lengthAndWidth = length( 3 );

console.log( lengthAndWidth( 4 ) ); // 24  
</code></pre>

<p>This time, the steps are a little bit different at the end:</p>

<ol>
<li>Once again, what we actually called was the anonymous function being returned by <code>resolver</code>.  </li>
<li>This time, <code>resolver</code> had been primed with two previous arguments. So we make a copy of that array <code>[ 2, 3 ]</code>.  </li>
<li>We add our new argument, <code>4</code>, to the <code>local</code> array.  </li>
<li>Now the length of <code>local</code> is <code>3</code>, which is the arity of <code>volume</code>. So instead of returning a new function, we return the result of calling <code>volume</code> with all of the arguments we've been saving up, and that gives us a value of <code>24</code>.</li>
</ol>

<h6 id="wrappingup">Wrapping up</h6>

<p>Admittedly, I have yet to find a super compelling use-case for currying in my day-to-day work. But I still think that going through the process of writing functions like this is a great way to improve your understanding of functional programming, and it helps reinforce concepts like closures and first-class functions.</p>

<p>By the way, if you like nerdy JavaScript things and live in the Boston area, I'm hiring at <a href="http://projectdecibel.com">Project Decibel</a>. Shoot me an <a href="mailto:kennis84@gmail.com">email</a>.</p>
	</section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-25" name="t-25"></a><h1>25 : [object Object] Things You Didn't Know About valueOf</h1>
					<div class="tutorial__content">
<section class="post-content">
		<p>Okay, fine. That title is horrible. But we're all competing with BuzzFeed for readers now, and I needed something catchy, so here we are.</p>

<p>Right, then. </p>

<p>So, what is <code>Object#valueOf</code> and why should you care?</p>

<p>More or less, it's a method that JavaScript calls automatically any time it sees an object in a situation where a primitive value is expected.</p>

<p>Let's look at a quick example.</p>

<pre><code>var obj = {};

console.log( 7 + obj ); // "7[object Object]"  
</code></pre>

<p>Plenty has been written about the insanity of implicit type conversion in JavaScript, so I'm really not interested in going down that road. Hopefully, your takeaway from the example is that we used the addition operator with a number on one side and an object on the other, and we got back a value that doesn't really make a ton of sense.</p>

<p>You can hardly blame JavaScript here, though. It has no way to know <em>how</em> to convert our object into a number.</p>

<p>But as luck would have it, we can actually define that behavior.</p>

<pre><code>var obj = {  
  valueOf: function() {
    return 42;
  }
};

console.log( 7 + obj ); // 49  
</code></pre>

<p>See? I wasn't lying earlier. The EcmaScript specification dictates that whenever an object is encountered in a situation where a primitive is expected, that object's <code>valueOf</code> method will be called*.</p>

<p>* <em>Actually, sometimes <strong>toString()</strong> will be called instead -- but I'm not gonna get into it here. You can assume that any time a <strong>Number</strong> is expected, <strong>valueOf</strong> will be called. If you're super interested in this stuff, look up the <strong>ToPrimitive</strong> abstract operation in the ES spec.</em></p>

<h6 id="whocares">Who cares?</h6>

<p>Look, I'm not gonna lie to you here (I feel like we're becoming friends, and I have a pathological need to be trusted). Knowing about <code>valueOf</code> is not going to materially change the way you write code on a day-to-day basis. This post is really about surfacing an interesting little JS feature that a lot of people don't know about. But that being said, there <em>are</em> some practical applications.</p>

<p>Let's write a little <code>Integer</code> class. I won't go into much detail here, since I will assume that you, esteemed reader, are already intimately familiar with the concept of integers.</p>

<p>You can actually just skip this part if you want...</p>

<pre><code>function Int( val ) {  
  if ( !( this instanceof Int ) ) {
    return new Int( val );
  }
  if ( isNaN( val ) ) {
    throw new TypeError('Int value must be a number');
  }
  if ( val % 1 !== 0 ) {
    throw new TypeError('Int value must be an integer');
  }
  if ( val instanceof Int ) {
    return Int( val._value );
  }
  this._value = Math.floor( val );
}

Int.prototype.add = function( n ) {  
  return Int( this._value + Int( n )._value );
};

Int.prototype.subtract = function( n ) {  
  return Int( this._value — Int( n )._value );
};

Int.prototype.multiply = function( n ) {  
  return Int( this._value * Int( n )._value );
};

Int.prototype.divide = function( n ) {  
  try {
    return Int( this._value / Int( n )._value );
  } catch ( e ) {
    throw new Error('Division resulted in non-integer quotient');
  }
};
</code></pre>

<p>Okay. Now we've got an <code>Int</code> class.</p>

<p>It does some type checking. It makes sure you don't pass it a float. And it has some basic arithmetic methods.</p>

<p>Here are a couple quick examples, just to give you a better idea of what this thing looks like:</p>

<pre><code>Int( 6 ).multiply( 2 );        // { _value: 12 }  
Int( 4 ).divide( 2 ).add( 3 ); // { _value: 5 }  
</code></pre>

<p>Simple enough. But what if I need to do something like this?</p>

<pre><code>var a = Int( 6 );  
var b = Int( 11 );

Math.min( a, b ); // NaN  
</code></pre>

<p>It basically blows up. I mean, it doesn't throw an exception, but it gives me <code>NaN</code>, which is <em>almost</em> as useless.</p>

<p>I trust at this point that you see where we're headed.</p>

<pre><code>Int.prototype.valueOf = function() {  
  return this._value;
};
</code></pre>

<p>Easy as that. Now, we'll try that same example -- but this time, our <code>Int</code> class has a <code>valueOf</code> method on its prototype.</p>

<pre><code>var a = Int( 6 );  
var b = Int( 11 );

Math.min( a, b ); // 6  
</code></pre>

<p>Not bad, right? We can also use instances of <code>Int</code> in other places where a primitive value is expected:</p>

<pre><code>Math.pow( Int( 9 ), 0.5 ); // 3  
</code></pre>

<p><em>The More You Know™</em></p>

<hr>

<p>If you liked this post, follow me on <a href="https://medium.com/@kevincennis">Medium</a> or <a href="http://twitter.com/kevincennis">Twitter</a> for more. I'm challenging myself to write every day for the next month. </p>

<p>And if you live in the Boston area and want to work on crazy, top-secret things with me at <a href="http://projectdecibel.com">Project Decibel</a>, shoot me an <a href="mailto:kennis84@gmail.com">email</a>. I'm hiring.</p>
	</section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-26" name="t-26"></a><h1>26 : Prototypal Inheritance</h1>
					<div class="tutorial__content">
<section class="post-content">
		<p>Last year I wrote a post called "How to impress me in an interview", and in it, I mentioned that I run across a lot of candidates (the vast majority, actually) who don't really understand how prototypes work.</p>

<p>In a way, that's kind of an amazing testament to how flexible JavaScript is, and how user-friendly many of today's popular libraries are. I can't think of many other object-oriented languages where an engineer can be reasonably productive without being at least vaguely aware of classes.</p>

<p>But here's the thing: if you write JavaScript even semi-regularly, you really <em>should</em> understand how prototypal inheritance works. And that's why I'm writing this post.</p>

<h6 id="disclaimer">Disclaimer</h6>

<p>There will be some things in this article that I over-simplify a little bit.</p>

<p>My goal here is to help someone who's never used prototypal inheritance to become comfortable with it. In order to do that, I'll cut a few small corners here and there if I think it helps eliminate a bit of confusion.</p>

<h6 id="objectsinheritfromobjects">Objects Inherit from Objects</h6>

<p>If you've ever read <strong>anything</strong> about inheritance in JS, then you've almost certainly heard that objects inherit from other objects.</p>

<p>This is true, and <em>once you already understand it</em>, it's a good way to think about things. But my experience has been that this explanation alone isn't really sufficient.</p>

<p>So I'm going to break from tradition here and not actually try to explain how inheritance works right up front. Instead, we'll start with some simpler stuff that will hopefully provide a bit of context later on.</p>

<h6 id="functionprototypes">Function prototypes</h6>

<p>Here's a fun fact: In JavaScript, all functions are also objects, which means that they can have properties. And as it so happens, they all have a property called <code>prototype</code>, which is also an object.</p>

<pre><code>function foo() {

}

typeof foo.prototype // 'object'  
</code></pre>

<p>That's pretty simple, right? Any time you create a function, it will <em>automatically</em> have a property called <code>prototype</code>, which will be initialized to an empty object.</p>

<h6 id="constructors">Constructors</h6>

<p>In JavaScript, there's really no difference between a "regular" function and a constructor function. They're actually all the same. But as a convention, functions that are <em>meant to be used</em> as constructors are generally capitalized.</p>

<p>By the way, if you don't know what I mean when I say "constructor", that's totally okay. We'll get there.</p>

<p>So let's say that we want to make a constructor function called <code>Dog</code>, because explaining inheritance using animals is a time-honored tradition and I'm kind of a nostalgic dude.</p>

<pre><code>function Dog() {

}
</code></pre>

<p>If I want to make an instance of <code>Dog</code>, I use the <code>new</code> keyword. That's really what I mean when I talk about constructors -- I'm using the function to <em>construct</em> a new object. Any time you see the <code>new</code> keyword, it means that the following function is being used as a constructor.</p>

<pre><code>var fido = new Dog();  
</code></pre>

<p>So now we have <code>fido</code>, who's a <code>Dog</code>. But he doesn't really do anything. </p>

<p>He's kind of like my dog, actually.</p>

<h6 id="methods">Methods</h6>

<p>It's time to make our <code>Dog</code> a little more dog-like. Bear with me here, because I'm going to explain this in just a minute.</p>

<pre><code>function Dog() {

}

Dog.prototype.bark = function() {  
  console.log('woof!');
};
</code></pre>

<p>You should remember from earlier that all functions automatically get initialized with a <code>prototype</code> object. In the example above, we tacked a function onto it called <code>bark</code>.</p>

<p>Now let's make ourselves a new <code>fido</code>.</p>

<pre><code>function Dog() {

}

Dog.prototype.bark = function() {  
  console.log('woof!');
};

var fido = new Dog();

fido.bark(); // 'woof!'  
</code></pre>

<p>I'm going to explain this in more detail a little later on. But the important thing to take away right now is that by placing <code>bark</code> on <code>Dog.prototype</code>, we made it available to all instances of <code>Dog</code>.</p>

<p>Don't worry yet about <em>how</em> this works. Just keep in mind that it works.</p>

<h6 id="differentialinheritance">Differential Inheritance</h6>

<p>JavaScript uses an inheritance model called "differential inheritance". What that means is that methods aren't copied from parent to child. Instead, children have an "invisible link" back to their parent object.</p>

<p>For example, <code>fido</code> doesn't actually have its own method called <code>bark()</code> (in other words, <code>fido.hasOwnProperty('bark') === false</code>).</p>

<p>What actually happens when I write <code>fido.bark()</code> is this:</p>

<ol>
<li>The JS engine looks for a property called <code>bark</code> on our <code>fido</code> object.  </li>
<li>It doesn't find one, so it looks "up the prototype chain" to <code>fido</code>'s parent, which is <code>Dog.prototype</code>.  </li>
<li>It finds <code>Dog.prototype.bark</code>, and calls it with <code>this</code> bound to <code>fido</code>.</li>
</ol>

<p>That part is really important, so I'm going to repeat it:</p>

<p>There's really no such property as <code>fido.bark</code>. It doesn't exist. Instead, <code>fido</code> has <em>access</em> to the <code>bark()</code> method on <code>Dog.prototype</code> because it's an instance of <code>Dog</code>. This is the "invisible link" I mentioned. More commonly, it's referred to as the "prototype chain".</p>

<h6 id="objectcreate">Object.create()</h6>

<p>Okay. We talked a little bit about differential inheritance and the prototype chain. Now it's time to put that into action.</p>

<p>Since ES5, JavaScript has had a cool little function called <code>Object.create()</code>.</p>

<p>Here's how it works.</p>

<pre><code>var parent = {  
  foo: function() {
    console.log('bar');
  }
};

var child = Object.create( parent );

child.hasOwnProperty('foo'); // false  
child.foo(); // 'bar'  
</code></pre>

<p>So what is it doing?</p>

<p>Essentially, it creates a new, empty object that has <code>parent</code> in its prototype chain. That means that even though <code>child</code> doesn't have its own <code>foo()</code> method, it has access to the <code>foo()</code> method from <code>parent</code>.</p>

<h6 id="tryit">Try It</h6>

<p>We've covered a lot of ground so far, and we still have a bit more to go. To make sure everything we learned so far sinks in, I'd encourage you to open up your dev tools and try a quick little example.</p>

<p>Create a constructor function called <code>Car</code>. Add a <code>drive()</code> method to its prototype that just logs to the console. Now create an instance of <code>Car</code> and call <code>drive()</code>.</p>

<p>I really mean it. You should take 30 seconds and go do it. I'll wait here. And no cheating...</p>

<p>Good, you're back. Hopefully you wrote something that looks like this.</p>

<pre><code>function Car() {

}

Car.prototype.drive = function() {  
  console.log('vroom');
};

var benz = new Car();

benz.drive(); // vroom  
</code></pre>

<p>If not, consider re-reading some of the earlier sections. It's important that you're somewhat comfortable with that stuff before you move on.</p>

<h6 id="puttingitalltogether">Putting It All Together</h6>

<p>It's time to look at a (slightly) more real-world example that takes everything in this post and puts it all together.</p>

<p>Let's start by creating a <code>Rectangle</code> constructor.</p>

<pre><code>function Rectangle( width, height ) {  
  this.width = width;
  this.height = height;
}
</code></pre>

<p>At this point, we'll take a tiny detour to talk about <code>this</code>.</p>

<p>When a function is used as a constructor, <code>this</code> refers to the <em>new object that you're creating</em>. So in our <code>Rectangle</code> constructor, we're taking <code>width</code> and <code>height</code> as arguments, and assigning those values to the <code>width</code> and <code>height</code> properties of our new <code>Rectangle</code> instance.</p>

<pre><code>var rect = new Rectangle( 3, 4 );

rect.width;  // 3  
rect.height; // 4  
</code></pre>

<p>Now it's time to give our <code>Rectangle</code> a method. Let's call it <code>area</code>.</p>

<pre><code>Rectangle.prototype.area = function() {  
  return this.width * this.height;
};
</code></pre>

<p>There's that <code>this</code> keyword again. Just like in the constructor, <code>this</code> inside of a method refers to the instance.</p>

<pre><code>var rect = new Rectangle( 3, 4 );

rect.area(); // 12  
</code></pre>

<h6 id="subclassing">Subclassing</h6>

<p>What if we want to make a new class of object that inherits from <code>Rectangle</code>?</p>

<p>Let's say we need a class called <code>Square</code>. Hopefully you remember from elementary school that a square is just a specific type of rectangle.</p>

<p>We'll start by creating its constructor.</p>

<pre><code>function Square( length ) {  
  this.width = this.height = length;
}
</code></pre>

<p>So, that's all well and good, but how do we make <code>Square</code> inherit from <code>Rectangle</code>? It's all about setting up the prototype chain.</p>

<p>If you remember from earlier, we can use <code>Object.create()</code> to create an empty object that inherits from another object. In the case of <code>Square</code>, that means all we need to do is this:</p>

<pre><code>Square.prototype = Object.create( Rectangle.prototype );  
</code></pre>

<p>All instances of <code>Square</code> will automatically have <code>Square.prototype</code> in their prototype chain, and because <code>Square.prototype</code> has <code>Rectangle.prototype</code> in <em>its</em> prototype chain, every <code>Square</code> will have access to the methods of <code>Rectangle</code>.</p>

<p>In other words, we can do this:</p>

<pre><code>var square = new Square( 4 );

square.area(); // 16  
</code></pre>

<p>We can also add new methods that are specific to <code>Square</code>. Remember, <code>Square.prototype</code> is just an empty object right now (albeit with a link back to <code>Rectangle.prototype</code>).</p>

<pre><code>Square.prototype.diagonal = function() {  
  return Math.sqrt( this.area() * 2 );
};
</code></pre>

<h6 id="timetravel">Time travel</h6>

<p>One of the really cool (and potentially dangerous) things about inheritance in JavaScript is that you can modify or extend the capabilities of a class <em>after</em> you've defined it.</p>

<p>Because JavaScript will look up the prototype when trying to access properties on an object, to you can alter your classes at runtime.</p>

<p>Here's an example (for illustrative purposes only. Don't ever do this):</p>

<pre><code>var arr = [ 1, 2, 3, 4, 5 ];

Array.prototype.shuffle = function() {  
  return this.sort(function() {
    return Math.round( Math.random() * 2 ) - 1;
  });
};

arr.shuffle(); // [ 3, 1, 4, 5, 2 ]  
</code></pre>

<p>The important thing to notice in this example is that <code>arr</code> was created <em>before</em> <code>Array.prototype.shuffle</code> existed. But because property lookups are done at runtime, our array got access to the new method anyway. It's like we went back in time and gave <code>Array</code> a (stupid) new method.</p>

<p>To get a sense of how powerful (and potentially dangerous) this is, go open the JS console on a page like Facebook, paste in the following code, and watch the log as you click around:</p>

<pre><code>Array.prototype.push = function() {  
  throw new Error('lolnope');
};
</code></pre>

<hr>

<p>If you live in the Boston area, love JavaScript, and want to work on some really exciting problems at <a href="https://starry.com">Starry</a>, shoot me an <a href="mailto:kennis84@gmail.com">email</a>. I'm hiring.</p>
	</section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-27" name="t-27"></a><h1>27 : How to impress me in an interview</h1>
					<div class="tutorial__content">
<section class="post-content">
		<p>In the past few years, I've interviewed dozens of candidates for JavaScript-heavy roles. Over that time, I've identified a few key areas that seem to be pretty good indicators of overall proficiency -- and I focus on these pretty much exclusively in my technical interviews.</p>

<p>First and foremost, this post is about what to expect if you're interviewing with me. But it's also about how to conduct a technical interview of JS candidates, and which areas offer the best signal-to-noise ratios.</p>

<h6 id="thisisnotatest">This is Not a Test</h6>

<p>The most important thing that I try to stress in any technical interview is that I'm not administering a test. What I'm really interested in is using questions as a tool for facilitating a conversation about code.</p>

<p>So if I ask you to write a <code>memoize()</code> function, what I really want is to give us a starting point to talk about higher-order functions and closures. I don't really care if you can write that function off the top of your head. Instead, what I'm really looking for is whether or not you can arrive at a solution with a little bit of guidance, and if you understand the underlying concepts.</p>

<p>If you get stuck along the way, ask for some help. And if you flat out don't know an answer, that's okay too. I'll do my best to explain it, and we'll work on another example together.</p>

<p>One of the most impressive things you can do in an interview is learn something new and then apply it. It lets me see how you think about problems and assimilate new information.</p>

<p>Anyway, the point is: not knowing things is totally okay.</p>

<h6 id="whiteboards">Whiteboards</h6>

<p>There seems to be a lot of anxiety these days about whiteboarding during interviews. Every couple weeks, I see an article on Hacker News about what a terrible, outmoded practice this is. </p>

<p>And for the most part, I agree.</p>

<p>That said, if you interview with me, you should expect to walk in to a room with a whiteboard on the wall. And you should expect that we'll use it.</p>

<p>Whiteboards are great for quick examples. If I ask you what an IIFE is, or how to write a ternary expression, I expect you to be able to jot that down on a whiteboard. Or maybe I'll write a function on the board and ask you what its return value is given a certain set of arguments.</p>

<p>What I won't <em>ever</em> do -- and what I think is the primary cause of apprehension about whiteboarding -- is ask you to write some big, 20-line function on a whiteboard. It's unnatural, it's slow, and frankly, it's pretty hard for me to read your code that way anyway.</p>

<h6 id="frameworkslibraries">Frameworks &amp; Libraries</h6>

<p>Don't care.</p>

<p>As JavaScript engineers, we use third-party code all day, every day. On the front-end, there's jQuery, Underscore, Backbone, Ember, Angular, React, Moment, D3, Bluebird, THREE, and a million others. With Node, there are currently something like 166,000 packages on npm.</p>

<p>We're all learning new APIs constantly, and it's totally unreasonable to expect that you happen to know the same ones that I do. I will almost never ask specific questions about libraries or frameworks.</p>

<p>If you've got a strong understanding of fundamental JS concepts, you'll learn the libraries we're using pretty quickly. </p>

<p>I'm just not that worried about it.</p>

<h6 id="closuresandfirstclassfunctions">Closures and First-Class Functions</h6>

<p>Super important. I expect everyone I interview to be very comfortable with these concepts.</p>

<p>Here's a typical example that I might present to a candidate:</p>

<pre><code>// write a function called `partial` that makes 
// the following snippet work

function add( a, b ) {  
  return a + b;
}

var add5 = partial( add, 5 );

add5( 4 ); // 9  
</code></pre>

<p>If that elicits a deer-in-the-headlights look, I might steer the discussion like this:</p>

<p>"Okay, so it looks like <code>partial</code> accepts two arguments. One is a function, and the other is a number."</p>

<p>That'll usually get us at least to this point:</p>

<pre><code>function partial( fn, num ) {

}
</code></pre>

<p>"Great. And <code>partial</code> must return a function, because we're assigning its return value to <code>add5</code> and then calling <code>add5()</code>".</p>

<pre><code>partial( fn, num ) {  
  return function() {

  };
}
</code></pre>

<p>"Cool. That's the basic idea. So, if <code>add5</code> is the function that <code>partial</code> returns and it expects a number as an argument, where does that go?"</p>

<p>Usually, this is the point where a light bulb turns on.</p>

<pre><code>partial( fn, a ) {  
  return function( b ) {
    return fn( a, b );
  };
}
</code></pre>

<p>Again, the point here is not necessarily that you can do this without any help (although that's great, and it's what I'd expect from a more senior candidate). What I'm really hoping is that you can get there with a little bit of direction.</p>

<h6 id="prototypalinheritance">Prototypal Inheritance</h6>

<p>This is definitely an area that tends to separate junior devs from more senior ones, although in my mind, it's something <em>everyone</em> applying for a JS role should know.</p>

<p>Here's a problem that I might give to a candidate:</p>

<pre><code>// make a class called `Square` that inherits from 
// `Rectangle` and satisfies the following snippet

function Rectangle( width, height ) {  
  this.width = width;
  this.height = height;
}

Rectangle.prototype.area = function() {  
  return this.width * this.height;
};

// your code here

var square = new Square( 4 );

square.area(); // 16  
Square.prototype.area === Rectangle.prototype.area; // true  
</code></pre>

<p>If this looks foreign to you, I would strongly recommend brushing up on prototypal inheritance. It's really not very hard once you get the hang of it, and it's an extremely powerful and important feature of JavaScript.</p>

<p>Oh, and here's the answer:</p>

<pre><code>function Square( length ) {  
  Rectangle.call( this, length, length );
}

Square.prototype = Object.create( Rectangle.prototype );  
</code></pre>

<h6 id="whatsthis">What's <code>this</code>?</h6>

<p>There's probably no other feature in JS with a worse simplicity-to-confusion ratio than the <code>this</code> keyword. You can basically learn everything about it in an hour, but so many JS developers never do.</p>

<p>You should know how <code>Function#call()</code> and <code>Function#apply()</code> work. They are absolutely essential to writing JS at a high level, and they're super easy to wrap your head around.</p>

<p>This is low-hanging fruit.</p>

<h6 id="async">Async</h6>

<p>Another big one, especially if you're applying for a job where you'll be using Node.</p>

<p>Here's a question I might ask:</p>

<pre><code>// write a function called `shout` that accepts
// a string and a callback function, and uses
// `exclaim` and `yell` to transform its input

function exclaim( value, fn ) {  
  setTimeout(function() {
    fn( value + '!' );
  }, 100 );
}

function yell( value, fn ) {  
  setTimeout(function() {
    fn( value.toUpperCase() );
  }, 100 );
}

shout( 'hello', function( shouted ) {  
  console.log( shouted ); // 'HELLO!'
});
</code></pre>

<p>Again, this is really something that I expect every JS candidate to be comfortable with. If you're about to interview for a JS gig and you're not familiar with this stuff, drop what you're doing and spend some time practicing.  It's that important.</p>

<p>Oh, and the solution to that problem:</p>

<pre><code>function shout( value, fn ) {  
  exclaim( value, function( exclaimed ) {
    yell( exclaimed, fn );
  }); 
}
</code></pre>

<h6 id="trickquestions">Trick Questions</h6>

<p>Personally, not a fan.</p>

<p>In the rare occasion that I <em>do</em> ask a trick question, I'll call it out beforehand, and I won't really care if you miss the "trick". What I'm really trying to accomplish in cases like this is to start a conversation.</p>

<p>"Not quite. Remember, variables get hoisted in JavaScript..."</p>

<p>"That's actually a <code>ReferenceError</code>. Can you see why?"</p>

<p>Questions like this can be really useful, but I use them pretty sparingly because nobody likes to feel like they've been set up for failure.</p>

<h6 id="advancedstuff">Advanced Stuff</h6>

<p>Okay, so you were able to breeze through closures, prototypal inheritance, and async functions. Now what?</p>

<p>At this point in an interview, I'm usually pretty confident that a candidate has an intermediate to advanced understanding of the language, and my goals for the interview start to shift a little.</p>

<p>What I really want to know now is <em>how much</em> you know. I'm trying to get a sense of the shape and depth of your JavaScript knowledge.</p>

<p>This is where we start to move away from core concepts and I might start asking about specific language features or more advanced functional programming.</p>

<p>I might ask you to use <code>Object.defineProperty</code> or to write a <code>curry</code> function. Maybe we'll talk about promises or recursion.</p>

<p>These are things that you don't really <em>have</em> to know, per se, but since you've got the basic stuff down, I need to ask these types of questions to get a better sense of how advanced you are.</p>

<p>Think of this as extra credit. It's an opportunity to impress me. Anything we talk about at this point is essentially just bonus material.</p>

<h6 id="memorization">Memorization</h6>

<p>This is sort of a tricky area, and I'm a little bit conflicted.</p>

<p>I expect a senior level JS person to know the argument signatures for <code>Array#splice()</code> or <code>Function#bind()</code>.</p>

<p>At the same time, I have never worked in an office without an Internet connection -- and looking something up on MDN takes about 20 seconds.</p>

<p>I never explicitly quiz candidates on stuff like this, because it just doesn't strike me as being particularly important. That said, if I realize during the course of our interview that you don't know how to use a common method like <code>Array#push()</code>, that's a pretty good indicator that you haven't been writing JS for very long.</p>

<p>In short: Learn the most commonly used stuff, but don't feel like you need to memorize the entire EcmaScript spec.</p>

<h6 id="askquestions">Ask Questions</h6>

<p>If you only take one thing away from this post, let it be this:</p>

<p><strong>If you don't know something, or you aren't sure, ask me.</strong></p>

<p>Not knowing something is a problem with a very simple solution. Lacking intellectual curiosity is much harder to fix.</p>

<p>I love hiring candidates who need a bit of mentoring. It's fun for me, and it's great for the team. One of the best ways to crystalize your own understanding of a concept is to explain it to someone else, and fostering a team environment where we're all teachers <em>and</em> students is the best way I know to continually raise the bar for everyone.</p>

<p>We all have plenty more to learn, myself included. My goal has always been to hire people who embrace that fact, and who are genuinely excited about learning new things and becoming stronger engineers.</p>

<h6 id="imhiring">I'm Hiring</h6>

<p>Is this hypothetical interview sounding pretty fun to you? Are you in the Boston area?</p>

<p>Shoot me an <a href="kennis84@gmail.com">email</a>, and come work on <strong>crazy</strong>, top-secret things at <a href="http://projectdecibel.com">Project Decibel</a>.</p>
	</section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-28" name="t-28"></a><h1>28 : A 10 minute primer to JavaScript modules, module formats, module loaders and module bundlers</h1>
					<span class="ref-site">http://www.jvandemo.com/a-10-minute-primer-to-javascript-modules-module-formats-module-loaders-and-module-bundlers/</span>
					<div class="tutorial__content">
<section class="postbody">

<p>Modern JavaScript development can be overwhelming.</p>

<p>When working on a project, you may wonder why all the modern machinery and tooling is needed.</p>

<p>What are tools like Webpack and SystemJS doing? Or what do AMD, UMD or CommonJS mean? How do they relate to each other? And why do you need them at all?</p>

<p>In this article you will learn the difference between JavaScript modules, module formats, module loaders and module bundlers.</p>

<p>This not an in-depth guide into any of the individual tools or patterns, but a primer to quickly understand the concepts of modern JavaScript development.</p>

<p>So let's get started.</p>

<h2 id="whatisamodule">What is a module?</h2>

<p>A module is a reusable piece of code that encapsulates implementation details and exposes a public API so it can be easily loaded and used by other code.</p>

<h2 id="whydoweneedmodules">Why do we need modules?</h2>

<p>Technically we can write code without modules.</p>

<p>Modules are a pattern that developers have been using in many different forms and programming languages since the 60's and 70's.</p>

<p>In JavaScript, modules should ideally allow us to:</p>

<ul>
<li><em>abstract code</em>: to delegate functionality to specialised libraries so that we don't have to understand the complexity of their actual implementation</li>
<li><em>encapsulate code</em>: to hide code inside the module if we don't want the code to be changed</li>
<li><em>reuse code</em>: to avoid writing the same code over and over again</li>
<li><em>manage dependencies</em>: to easily change dependencies without rewriting our code</li>
</ul>

<h2 id="modulepatternsines5">Module patterns in ES5</h2>

<p>EcmaScript 5 and earlier editions were not designed with modules in mind. Over time, developers came up with different patterns to simulate modular design in JavaScript.</p>

<p>To give you an idea of what some of these patterns look like, let's quickly look at 2 easy ones: <em>Immediately Invoked Function Expressions</em> and <em>Revealing Module</em>.</p>

<h3 id="immediatelyinvokedfunctionexpressioniife">Immediately Invoked Function Expression (IIFE)</h3>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="pun">(</span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">
  </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">})()</span></code></pre>

<p>An Immediately Invoked Function Expression (IIFE) is an anonymous function that is invoked when it is declared. </p>

<p>Notice how the function is surrounded by parentheses. In JavaScript, a line starting with the word <code>function</code> is considered as a function declaration:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// Function declaration</span><span class="pln">
</span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">  
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>Immediately invoking a function declaration throws an error:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// Immediately Invoked Function Declaration</span><span class="pln">
</span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">  
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}()</span><span class="pln">

</span><span class="com">// =&gt; Uncaught SyntaxError: Unexpected token )</span></code></pre>

<p>Putting parentheses around the function makes it a function expression:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// Function expression</span><span class="pln">
</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">})</span><span class="pln">

</span><span class="com">// =&gt; returns function test(){ console.log('test') }</span></code></pre>

<p>The function expression returns the function, so we can immediately call it:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// Immediately Invoked Function Expression</span><span class="pln">
</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">})()</span><span class="pln">

</span><span class="com">// =&gt; writes 'test' to the console and returns undefined</span></code></pre>

<p>Immediately Invoked Function Expressions allow us to:</p>

<ul>
<li>encapsulate code complexity inside IIFE so we don't have to understand what the IIFE code does</li>
<li>define variables inside the IIFE so they don't pollute the global scope (<code>var</code> statements inside the IIFE remain within the IIFE's closure)</li>
</ul>

<p>but they don't provide a mechanism for dependency management.</p>

<h3 id="revealingmodulepattern">Revealing Module pattern</h3>

<p>The Revealing Module pattern is similar to an IIFE, but we assign the return value to a variable:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// Expose module as global variable</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> singleton </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">

  </span><span class="com">// Inner logic</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> sayHello</span><span class="pun">(){</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Hello'</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// Expose API</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    sayHello</span><span class="pun">:</span><span class="pln"> sayHello
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}()</span></code></pre>

<p>Notice that we don't need the surrounding parentheses here because the word <code>function</code> is not at the beginning of the line.</p>

<p>We can now access the module's API through the variable:</p>

<pre class="prettyprint prettyprinted"><code><span class="com">// Access module functionality</span><span class="pln">
singleton</span><span class="pun">.</span><span class="pln">sayHello</span><span class="pun">();</span><span class="pln">  
</span><span class="com">// =&gt; Hello</span></code></pre>

<p>Instead of a singleton, a module can also expose a constructor function:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// Expose module as global variable</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> </span><span class="typ">Module</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">

  </span><span class="com">// Inner logic</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> sayHello</span><span class="pun">(){</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Hello'</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// Expose API</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    sayHello</span><span class="pun">:</span><span class="pln"> sayHello
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>Notice how we don't execute the function at declaration time.</p>

<p>Instead, we instantiate a module using the <code>Module</code> constructor function:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">var</span><span class="pln"> </span><span class="kwd">module</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Module</span><span class="pun">();</span><span class="pln">  </span></code></pre>

<p>to access its public API:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">module</span><span class="pun">.</span><span class="pln">sayHello</span><span class="pun">();</span><span class="pln">  
</span><span class="com">// =&gt; Hello</span></code></pre>

<p>The Revealing Module pattern offers similar benefits as an IIFE, but again does not offer a mechanism for dependency management.</p>

<p>As JavaScript evolved, many more different syntaxes were invented for defining modules, each with their own benefits and downsides.</p>

<p>We call them module formats.</p>

<h2 id="moduleformats">Module formats</h2>

<p>A module format is the syntax we can use to define a module.</p>

<p>Before EcmaScript 6 or ES2015, JavaScript did not have an official syntax to define modules. Therefore, smart developers came up with various formats to define modules in JavaScript.</p>

<p>Some of the most widely adapted and well known formats are:</p>

<ul>
<li>Asynchronous Module Definition (AMD)</li>
<li>CommonJS</li>
<li>Universal Module Definition (UMD)</li>
<li>System.register</li>
<li>ES6 module format</li>
</ul>

<p>Let's have a quick look at each one of them so you can recognize their syntax.</p>

<h3 id="asynchronousmoduledefinitionamd">Asynchronous Module Definition (AMD)</h3>

<p>The <a href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD</a> format is used in browsers and uses a <code>define</code> function to define modules:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">//Calling define with a dependency array and a factory function</span><span class="pln">
define</span><span class="pun">([</span><span class="str">'dep1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'dep2'</span><span class="pun">],</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dep1</span><span class="pun">,</span><span class="pln"> dep2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="com">//Define the module value by returning a value.</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
</span><span class="pun">});</span></code></pre>

<h3 id="commonjsformat">CommonJS format</h3>

<p>The <a href="http://www.commonjs.org">CommonJS</a> format is used in Node.js and uses <code>require</code> and <code>module.exports</code> to define dependencies and modules:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">var</span><span class="pln"> dep1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./dep1'</span><span class="pun">);</span><span class="pln">  
</span><span class="kwd">var</span><span class="pln"> dep2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./dep2'</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">  
  </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<h3 id="universalmoduledefinitionumd">Universal Module Definition (UMD)</h3>

<p>The <a href="https://github.com/umdjs/umd">UMD</a> format can be used both in the browser and in Node.js.</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> factory</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> define </span><span class="pun">===</span><span class="pln"> </span><span class="str">'function'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> define</span><span class="pun">.</span><span class="pln">amd</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// AMD. Register as an anonymous module.</span><span class="pln">
      define</span><span class="pun">([</span><span class="str">'b'</span><span class="pun">],</span><span class="pln"> factory</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> </span><span class="kwd">module</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="str">'object'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// Node. Does not work with strict CommonJS, but</span><span class="pln">
    </span><span class="com">// only CommonJS-like environments that support module.exports,</span><span class="pln">
    </span><span class="com">// like Node.</span><span class="pln">
    </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">(</span><span class="kwd">require</span><span class="pun">(</span><span class="str">'b'</span><span class="pun">));</span><span class="pln">
  </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// Browser globals (root is window)</span><span class="pln">
    root</span><span class="pun">.</span><span class="pln">returnExports </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="pln">b</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">//use b in some fashion.</span><span class="pln">

  </span><span class="com">// Just return a value to define the module export.</span><span class="pln">
  </span><span class="com">// This example returns an object, but the module</span><span class="pln">
  </span><span class="com">// can return a function as the exported value.</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
</span><span class="pun">}));</span></code></pre>

<h3 id="systemregister">System.register</h3>

<p>The <a href="https://github.com/ModuleLoader/es-module-loader/blob/master/docs/system-register.md">System.register format</a> was designed to support the ES6 module syntax in ES5:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">import</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> p </span><span class="kwd">as</span><span class="pln"> q </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'./dep'</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="str">'local'</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> func</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  
  </span><span class="kwd">return</span><span class="pln"> q</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> C </span><span class="pun">{</span><span class="pln">  
</span><span class="pun">}</span></code></pre>

<h3 id="es6moduleformat">ES6 module format</h3>

<p>As of ES6, JavaScript also supports a native module format.</p>

<p>It uses an <code>export</code> token to export a module's public API:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// lib.js</span><span class="pln">

</span><span class="com">// Export the function</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> sayHello</span><span class="pun">(){</span><span class="pln">  
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Hello'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Do not export the function</span><span class="pln">
</span><span class="kwd">function</span><span class="pln"> somePrivateFunction</span><span class="pun">(){</span><span class="pln">  
  </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>and an <code>import</code> token to import parts that a module exports:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">import</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sayHello </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'./lib'</span><span class="pun">;</span><span class="pln">

sayHello</span><span class="pun">();</span><span class="pln">  
</span><span class="com">// =&gt; Hello</span></code></pre>

<p>We can even give imports an alias using <code>as</code>:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">import</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sayHello </span><span class="kwd">as</span><span class="pln"> say </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'./lib'</span><span class="pun">;</span><span class="pln">

say</span><span class="pun">();</span><span class="pln">  
</span><span class="com">// =&gt; Hello</span></code></pre>

<p>or load an entire module at once:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">import</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> lib </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'./lib'</span><span class="pun">;</span><span class="pln">

lib</span><span class="pun">.</span><span class="pln">sayHello</span><span class="pun">();</span><span class="pln">  
</span><span class="com">// =&gt; Hello</span></code></pre>

<p>The format also supports default exports:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// lib.js</span><span class="pln">

</span><span class="com">// Export default function</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> sayHello</span><span class="pun">(){</span><span class="pln">  
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Hello'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Export non-default function</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> sayGoodbye</span><span class="pun">(){</span><span class="pln">  
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Goodbye'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>which you can import like this:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="kwd">import</span><span class="pln"> sayHello</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sayGoodbye </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'./lib'</span><span class="pun">;</span><span class="pln">

sayHello</span><span class="pun">();</span><span class="pln">  
</span><span class="com">// =&gt; Hello</span><span class="pln">

sayGoodbye</span><span class="pun">();</span><span class="pln">  
</span><span class="com">// =&gt; Goodbye</span></code></pre>

<p>You can export not only functions, but anything you like:</p>

<pre class="prettyprint prettyprinted"><code class="javascript"><span class="com">// lib.js</span><span class="pln">

</span><span class="com">// Export default function</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> sayHello</span><span class="pun">(){</span><span class="pln">  
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Hello'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Export non-default function</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> sayGoodbye</span><span class="pun">(){</span><span class="pln">  
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Goodbye'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Export simple value</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> apiUrl </span><span class="pun">=</span><span class="pln"> </span><span class="str">'...'</span><span class="pun">;</span><span class="pln">

</span><span class="com">// Export object</span><span class="pln">
</span><span class="kwd">export</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> settings </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  
  debug</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>Unfortunately, the native module format is not yet supported by all browsers.</p>

<p>We can already use the ES6 module format today, but we need a transpiler like Babel to transpile our code to an ES5 module format such as AMD or CommonJS before we can actually run our code in the browser.</p>

<h2 id="moduleloaders">Module loaders</h2>

<p>A module loader interprets and loads a module written in a certain module format.</p>

<p>A module loader runs at runtime:</p>

<ul>
<li>you load the module loader in the browser</li>
<li>you tell the module loader which main app file to load</li>
<li>the module loader downloads and interprets the main app file</li>
<li>the module loader downloads files as needed</li>
</ul>

<p>If you open the network tab in your browser's developer console, you will see that many files are loaded on demand by the module loader.</p>

<p>A few examples of popular module loaders are:</p>

<ul>
<li><em><a href="http://requirejs.org/">RequireJS</a></em>: loader for modules in AMD format</li>
<li><em><a href="https://github.com/systemjs/systemjs">SystemJS</a></em>: loader for modules in AMD, CommonJS, UMD or System.register format</li>
</ul>

<h2 id="modulebundlers">Module bundlers</h2>

<p>A module bundler replaces a module loader.</p>

<p>But, in contrast to a module loader, a module bundler runs at build time:</p>

<ul>
<li>you run the module bundler to generate a bundle file at build time (e.g. bundle.js)</li>
<li>you load the bundle in the browser</li>
</ul>

<p>If you open the network tab in your browser's developer console, you will see that only 1 file is loaded. No module loader is needed in the browser. All code is included in the bundle.</p>

<p>Examples of popular module bundlers are:</p>

<ul>
<li><em><a href="http://browserify.org/">Browserify</a></em>: bundler for CommonJS modules</li>
<li><em><a href="https://webpack.github.io/">Webpack</a></em>: bundler for AMD, CommonJS, ES6 modules</li>
</ul>

<h2 id="summary">Summary</h2>

<p>To better understand tooling in modern JavaScript development environments, it is important to understand the differences between modules, module formats, module loaders and module bundlers.</p>

<p>A <em>module</em> is a reusable piece of code that encapsulates implementation details and exposes a public API so it can be easily loaded and used by other code.</p>

<p>A <em>module format</em> is the syntax we use to define a module. Different module formats such <a href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD</a>, <a href="http://www.commonjs.org">CommonJS</a>, <a href="https://github.com/umdjs/umd">UMD</a> and <a href="https://github.com/ModuleLoader/es-module-loader/blob/master/docs/system-register.md">System.register</a> have emerged in the past and a native module format is now available since ES6.</p>

<p>A <em>module loader</em> interprets and loads a module written in a certain module format at runtime. Popular examples are <a href="http://requirejs.org/">RequireJS</a> and <a href="https://github.com/systemjs/systemjs">SystemJS</a>.</p>

<p>A <em>module bundler</em> replaces a module loader and generates a bundle of all code at build time. Popular examples are <a href="http://browserify.org/">Browserify</a> and <a href="https://webpack.github.io/">Webpack</a>.</p>

<p>There you have it—you are now armed with the knowledge to better understand modern JavaScript development.</p>

<p>Next time the TypeScript compiler asks you what module format you wish to compile your TypeScript in, you should fully understand why. If you don't, don't worry and just re-read this primer.</p>

<p>Have a wonderful day and develop with passion.</p>
        </section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-29" name="t-29"></a><h1>29 : Rethinking JavaScript: Replace break by going functional</h1>
					<div class="tutorial__content">
<div class="section-inner sectionLayout--insetColumn"><h1 name="5be4" id="5be4" class="graf graf--h3 graf--leading graf--title">Rethinking JavaScript: Replace break by going functional</h1><p name="ad55" id="ad55" class="graf graf--p graf-after--figure">In my last article, <a href="https://hackernoon.com/rethinking-javascript-death-of-the-for-loop-c431564c84a8" data-href="https://hackernoon.com/rethinking-javascript-death-of-the-for-loop-c431564c84a8" class="markup--anchor markup--p-anchor" target="_blank">Death of the for Loop</a>, I tried to convince you to abandon the <code class="markup--code markup--p-code">for</code> loop for a more functional solution. In return, you raised a great question, "What about <code class="markup--code markup--p-code">break</code>?"</p><blockquote name="bb2d" id="bb2d" class="graf graf--pullquote graf-after--p">break is the <code class="markup--code markup--pullquote-code">GOTO</code> of loops and should be&nbsp;avoided.</blockquote><p name="ad41" id="ad41" class="graf graf--p graf-after--pullquote"><code class="markup--code markup--p-code">break</code> should be placed in the rubbish bin in the same exact way <code class="markup--code markup--p-code">GOTO</code> has.</p><p name="8f53" id="8f53" class="graf graf--p graf-after--p">You may be thinking, "Come on Joel, surely you are just being sensational. How is break like <code class="markup--code markup--p-code">GOTO</code>?"</p><pre name="47cb" id="47cb" class="graf graf--pre graf-after--p">// bad code. no copy paste.</pre><pre name="e309" id="e309" class="graf graf--pre graf-after--pre">outer:<br>  for (var i in outerList) {<br>inner:<br>    for (var j in innerList) {<br>      break outer;<br>    }<br>  }</pre><p name="b94d" id="b94d" class="graf graf--p graf-after--pre">I am offering labels as the proof. In other languages, labels were the counterpart to <code class="markup--code markup--p-code">GOTO</code>. In JavaScript, label is the counterpart of <code class="markup--code markup--p-code">break</code> and <code class="markup--code markup--p-code">continue</code>. Because <code class="markup--code markup--p-code">break</code> and <code class="markup--code markup--p-code">continue</code> come from the same label family, this also makes them very close relatives of <code class="markup--code markup--p-code">GOTO</code>.</p><blockquote name="396b" id="396b" class="graf graf--pullquote graf-after--p">JavaScript's label, break and continue are leftover legacy from the days of GOTO and unstructured programming.</blockquote><p name="afd7" id="afd7" class="graf graf--p graf--startsWithDoubleQuote graf-after--figure">"But It's not hurting anyone, so why not leave it in the language so that we have <em class="markup--em markup--p-em">options</em>?"</p><h3 name="fba2" id="fba2" class="graf graf--h3 graf-after--p">Why should we place limits on how we write software?</h3><p name="ef9a" id="ef9a" class="graf graf--p graf-after--h3">It sounds counter-intuitive, but limits are a good thing. The removal of <code class="markup--code markup--p-code">GOTO</code> is a perfect example of this. We also welcomed the limitation <code class="markup--code markup--p-code">"use strict"</code> with open arms and even lecture those who don't use it!</p><blockquote name="3e5b" id="3e5b" class="graf graf--pullquote graf--startsWithDoubleQuote graf-after--p">"limitations can make things better. A lot better. "— Charles&nbsp;Scalfani</blockquote><p name="5783" id="5783" class="graf graf--p graf-after--pullquote">Limits make us write better software.</p><div name="cf41" id="cf41" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/@cscalfani/why-programmers-need-limits-3d96e1a0a6db" data-href="https://medium.com/@cscalfani/why-programmers-need-limits-3d96e1a0a6db" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/@cscalfani/why-programmers-need-limits-3d96e1a0a6db"><strong class="markup--strong markup--mixtapeEmbed-strong">Why Programmers Need Limits</strong><br><em class="markup--em markup--mixtapeEmbed-em">Limits make for better Art, Design and Life.</em>medium.com</a><a href="https://medium.com/@cscalfani/why-programmers-need-limits-3d96e1a0a6db" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="840412066f5ba9a1c1670abfbc18930a" data-thumbnail-img-id="1*bGF0M3KV7FbxEVxRzbExrQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*bGF0M3KV7FbxEVxRzbExrQ.jpeg);"></a></div><h3 name="353a" id="353a" class="graf graf--h3 graf-after--mixtapeEmbed">What are our alternatives to&nbsp;break?</h3><p name="318d" id="318d" class="graf graf--p graf-after--h3">I'm not gonna sugar coat this, there is no one size fits all quick and easy replacement. It's a completely different way of programming. A completely different way of thinking. <em class="markup--em markup--p-em">A functional way of thinking.</em></p><p name="b358" id="b358" class="graf graf--p graf-after--p">The good news is there are <em class="markup--em markup--p-em">many</em> libraries and tools out there to help us like <a href="https://lodash.com/" data-href="https://lodash.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Lodash</a>, <a href="http://ramdajs.com/" data-href="http://ramdajs.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Ramda</a>, <a href="http://danieltao.com/lazy.js/" data-href="http://danieltao.com/lazy.js/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">lazy.js</a>, recursion, etc.</p><p name="27cd" id="27cd" class="graf graf--p graf-after--p">We'll start with a simple collection of cats and a function called <code class="markup--code markup--p-code">isKitten</code>. These will be used in all of the examples to follow.</p><pre name="8a55" id="8a55" class="graf graf--pre graf-after--p">const cats = [<br>  { name: 'Mojo',    months: 84 },<br>  { name: 'Mao-Mao', months: 34 },<br>  { name: 'Waffles', months: 4 },<br>  { name: 'Pickles', months: 6 }<br>]</pre><pre name="efa3" id="efa3" class="graf graf--pre graf-after--pre">const isKitten = cat =&gt; cat.months &lt; 7</pre><p name="56e6" id="56e6" class="graf graf--p graf-after--pre">Let's start out with a familiar old-school <code class="markup--code markup--p-code">for</code> loop example. This will loop through our cats and break when it finds the first kitten.</p><pre name="09b9" id="09b9" class="graf graf--pre graf-after--p">var firstKitten</pre><pre name="8a73" id="8a73" class="graf graf--pre graf-after--pre">for (var i = 0; i &lt; cats.length; i++) {<br>  if (isKitten(cats[i])) {<br>    firstKitten = cats[i]<br>    break<br>  }<br>}</pre><p name="ec42" id="ec42" class="graf graf--p graf-after--pre">Now let's comparable that to the lodash equivalent.</p><pre name="1fb7" id="1fb7" class="graf graf--pre graf-after--p">const firstKitten = _.find(cats, isKitten)</pre><p name="3787" id="3787" class="graf graf--p graf-after--pre">OK, so that example is fairly simple. Let's kick it up a notch and try something a little more <em class="markup--em markup--p-em">edge case</em>. Let's enumerate our cats and break after we have found 5 kittens.</p><pre name="5108" id="5108" class="graf graf--pre graf-after--p">var first5Kittens = []</pre><pre name="faf4" id="faf4" class="graf graf--pre graf-after--pre">// old-school edge case kitty loop<br>for (var i = 0; i &lt; cats.length; i++) {<br>  if (isKitten(cats[i])) {<br>    first5Kittens.push(cats[i])</pre><pre name="c8e9" id="c8e9" class="graf graf--pre graf-after--pre">    if (first4Kittens.length &gt;= 5) {<br>      break<br>    }<br>  }<br>}</pre><h3 name="993a" id="993a" class="graf graf--h3 graf-after--pre">The easy&nbsp;way</h3><p name="1872" id="1872" class="graf graf--p graf-after--h3">lodash is amazing and does tons of great things, but sometimes you need something more specialized. <strong class="markup--strong markup--p-strong">This is where we bring in a new friend, </strong><a href="http://danieltao.com/lazy.js/" data-href="http://danieltao.com/lazy.js/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">lazy.js</strong></a><strong class="markup--strong markup--p-strong">. It's "Like Underscore, but lazier"</strong>. And lazy is what we want.</p><pre name="dda4" id="dda4" class="graf graf--pre graf-after--p">const result = Lazy(cats)<br>  .filter(isKitten)<br>  .take(5)</pre><h3 name="1a80" id="1a80" class="graf graf--h3 graf-after--pre">The hard&nbsp;way</h3><p name="b908" id="b908" class="graf graf--p graf-after--h3">Libraries are all fun and games, but <strong class="markup--strong markup--p-strong">sometimes what's <em class="markup--em markup--p-em">really fun</em> is to create something from scratch!</strong></p><p name="7870" id="7870" class="graf graf--p graf-after--p">So how about we create a generic function that will act like <code class="markup--code markup--p-code">filter</code> and also add the limit functionality.</p><p name="7c9f" id="7c9f" class="graf graf--p graf-after--p">The first step is to encapsulate our old-school edge case kitty loop in a function.</p><figure name="33d8" id="33d8" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/d358bda8bf81fc9a42b8f1a178de51e6?postId=51b27b1c85f8" data-media-id="d358bda8bf81fc9a42b8f1a178de51e6" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&amp;lt;div class="iframeContainer"&amp;gt;&amp;lt;IFRAME width="700" height="250" src="/media/d358bda8bf81fc9a42b8f1a178de51e6?postId=51b27b1c85f8" data-media-id="d358bda8bf81fc9a42b8f1a178de51e6" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&amp;gt;&amp;lt;/IFRAME&amp;gt;&amp;lt;/div&amp;gt;</noscript></div></div></figure><p name="963e" id="963e" class="graf graf--p graf-after--figure">Next, let's generalize the function and extract out all the cat specific stuff. Replace <code class="markup--code markup--p-code">5</code> with <code class="markup--code markup--p-code">limit</code>, <code class="markup--code markup--p-code">isKitten</code> with <code class="markup--code markup--p-code">predicate</code> and <code class="markup--code markup--p-code">cats</code> with <code class="markup--code markup--p-code">list</code>. Then add those as parameters to the function.</p><figure name="abf6" id="abf6" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/0e55afc54986fca284582892270a39a7?postId=51b27b1c85f8" data-media-id="0e55afc54986fca284582892270a39a7" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&amp;lt;div class="iframeContainer"&amp;gt;&amp;lt;IFRAME width="700" height="250" src="/media/0e55afc54986fca284582892270a39a7?postId=51b27b1c85f8" data-media-id="0e55afc54986fca284582892270a39a7" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&amp;gt;&amp;lt;/IFRAME&amp;gt;&amp;lt;/div&amp;gt;</noscript></div></div></figure><p name="b709" id="b709" class="graf graf--p graf-after--figure">Now we have a working and reusable <code class="markup--code markup--p-code">takeFirst</code> function that has been completely separated from our cat business logic!</p><p name="67b1" id="67b1" class="graf graf--p graf-after--p">Our function is now also a <strong class="markup--strong markup--p-strong">pure function</strong>. This means the output is derived solely from the inputs. Given the same inputs, it will produce the same output 100% of the time.</p><p name="4b6f" id="4b6f" class="graf graf--p graf-after--p">We still have that nasty <code class="markup--code markup--p-code">for</code> loop in there, so let's keep refactoring. The next step is to move <code class="markup--code markup--p-code">i</code> and <code class="markup--code markup--p-code">newList</code> to the argument list.</p><figure name="c9a2" id="c9a2" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/a930e8693907704cc7804a58fef4cfbe?postId=51b27b1c85f8" data-media-id="a930e8693907704cc7804a58fef4cfbe" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&amp;lt;div class="iframeContainer"&amp;gt;&amp;lt;IFRAME width="700" height="250" src="/media/a930e8693907704cc7804a58fef4cfbe?postId=51b27b1c85f8" data-media-id="a930e8693907704cc7804a58fef4cfbe" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&amp;gt;&amp;lt;/IFRAME&amp;gt;&amp;lt;/div&amp;gt;</noscript></div></div></figure><p name="e09b" id="e09b" class="graf graf--p graf-after--figure">We want to break the recursion (<code class="markup--code markup--p-code">isDone</code>) when the <code class="markup--code markup--p-code">limit</code> reaches <code class="markup--code markup--p-code">0</code> (<code class="markup--code markup--p-code">limit</code> will count down during the recursive process) or when we reach the end of the list.</p><p name="4642" id="4642" class="graf graf--p graf-after--p">If we are not done, then we check to see if our filter <code class="markup--code markup--p-code">predicate</code> has a match. If we get a match then we'll call <code class="markup--code markup--p-code">takeFirst</code>, decrement <code class="markup--code markup--p-code">limit</code> and append to our <code class="markup--code markup--p-code">newList</code>. Otherwise, move onto the next item in the list.</p><figure name="57ac" id="57ac" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/9ab3d96a3493431270d96a752df2295f?postId=51b27b1c85f8" data-media-id="9ab3d96a3493431270d96a752df2295f" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&amp;lt;div class="iframeContainer"&amp;gt;&amp;lt;IFRAME width="700" height="250" src="/media/9ab3d96a3493431270d96a752df2295f?postId=51b27b1c85f8" data-media-id="9ab3d96a3493431270d96a752df2295f" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&amp;gt;&amp;lt;/IFRAME&amp;gt;&amp;lt;/div&amp;gt;</noscript></div></div></figure><p name="310a" id="310a" class="graf graf--p graf-after--figure">If you have yet to read <a href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" data-href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" class="markup--anchor markup--p-anchor" target="_blank">Rethinking JavaScript: The if statement</a>, it will explain this final step of replacing the <code class="markup--code markup--p-code">if</code>'s with a ternary operator.</p><div name="22ff" id="22ff" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" data-href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb"><strong class="markup--strong markup--mixtapeEmbed-strong">Rethinking JavaScript: The if statement</strong><br><em class="markup--em markup--mixtapeEmbed-em">Thinking functionally has opened my mind about programming.</em>medium.com</a><a href="https://medium.com/@joelthoms/rethinking-javascript-the-if-statement-b158a61cd6cb" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="3480fb7d4f5f43384e3ba07f774eeeaa" data-thumbnail-img-id="1*TlipICpRe1h4EZf-8J5utA.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*TlipICpRe1h4EZf-8J5utA.png);"></a></div><figure name="066d" id="066d" class="graf graf--figure graf--iframe graf-after--mixtapeEmbed"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/09bf17800b5fb08823f91761f5819212?postId=51b27b1c85f8" data-media-id="09bf17800b5fb08823f91761f5819212" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&amp;lt;div class="iframeContainer"&amp;gt;&amp;lt;IFRAME width="700" height="250" src="/media/09bf17800b5fb08823f91761f5819212?postId=51b27b1c85f8" data-media-id="09bf17800b5fb08823f91761f5819212" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F742630%3Fv%3D3%26s%3D400&amp;amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&amp;gt;&amp;lt;/IFRAME&amp;gt;&amp;lt;/div&amp;gt;</noscript></div></div></figure><p name="e3bb" id="e3bb" class="graf graf--p graf-after--figure">Now we can call our new method like this:</p><pre name="f948" id="f948" class="graf graf--pre graf-after--p">const first5Kittens = takeFirst(5, isKitten, cats)</pre><p name="3b65" id="3b65" class="graf graf--p graf-after--pre">For extra credit we could curry <code class="markup--code markup--p-code">takeFirst</code> and use it to create other functions. (more on currying in another article)</p><pre name="ddb5" id="ddb5" class="graf graf--pre graf-after--p">const first5 = takeFirst(5)<br>const getFirst5Kittens = first5(isKitten)</pre><pre name="9bf1" id="9bf1" class="graf graf--pre graf-after--pre">const first5Kittens = getFirst5Kittens(cats)</pre><h3 name="3ca2" id="3ca2" class="graf graf--h3 graf-after--pre">Summary</h3><p name="a120" id="a120" class="graf graf--p graf-after--h3">There are many great libraries we can use like lodash, ramda or lazy.js. If we are so daring, we can even create our own methods using recursion!</p><p name="efb7" id="efb7" class="graf graf--p graf-after--p">I must warn that while <code class="markup--code markup--p-code">takeFirst</code> is super awesome, <strong class="markup--strong markup--p-strong">recursion comes from a monkey's paw wish</strong>. Recursion in JavaScript-land can be very dangerous and it's easy to get the infamous <code class="markup--code markup--p-code">Maximum call stack size exceeded</code> error message.</p><p name="6014" id="6014" class="graf graf--p graf-after--p">I'll be covering recursion in JavaScript in my next article. Stay tuned.</p><p name="cf83" id="cf83" class="graf graf--p graf-after--p">I know it's a small thing, but it makes my day when I get those follow notifications on Medium and Twitter (<a href="https://twitter.com/joelnet" data-href="https://twitter.com/joelnet" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@joelnet</a>). Or if you think I'm full of shit, tell me in the comments below.</p><p name="56ae" id="56ae" class="graf graf--p graf-after--p">Cheers!</p></div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-30" name="t-30"></a><h1>30 : An Introduction to Functional JavaScript</h1>
					<div class="tutorial__content">

					<span>https://www.sitepoint.com/introduction-functional-javascript/</span>

<p>You've heard that JavaScript is a functional language, or at least that it's capable of supporting functional programming. But what is functional programming? And for that matter, if you're going to start comparing programming paradigms in general, how is a functional approach different from the JavaScript that you've always written?</p>
<p>Well, the good news is that JavaScript isn't picky when it comes to paradigms. You can mix your imperative, object-oriented, prototypal, and functional code as you see fit, and still get the job done. But the bad news is what that means for your code. JavaScript can support a wide range of programming styles simultaneously within the same codebase, so it's up to you to make the right choices for maintainability, readability, and performance.</p>

<p>Functional JavaScript doesn't have to take over an entire project in order to add value. Learning a little about the functional approach can help guide some of the decisions you make as you build your projects, regardless of the way you prefer to structure your code. Learning some functional patterns and techniques can put you well on your way to writing cleaner and more elegant JavaScript regardless of your preferred approach.</p>
<h2 id="imperative-javascript">Imperative JavaScript</h2>
<p>JavaScript first gained popularity as an in-browser language, used primarily for adding simple hover and click effects to elements on a web page. For years, that's most of what people knew about it, and that contributed to the bad reputation JavaScript earned early on.</p>
<p>As developers struggled to match the flexibility of JavaScript against the intricacy of the browser document object model (DOM), actual JavaScript code often looked something like this in the real world:</p>
<pre><code class="language-javascript">var result;
function getText() {
  var someText = prompt("Give me something to capitalize");
  capWords(someText);
  alert(result.join(" "));
};
function capWords(input) {
  var counter;
  var inputArray = input.split(" ");
  var transformed = "";
  result = [];
  for (counter = 0; counter &lt; inputArray.length; counter++) {
    transformed = [
      inputArray[counter].charAt(0).toUpperCase(), 
      inputArray[counter].substring(1)
    ].join("");
    result.push(transformed);
  }
};
document.getElementById("main_button").onclick = getText;</code></pre>
<p>So many things are going on in this little snippet of code. Variables are being defined on the global scope. Values are being passed around and modified by functions. DOM methods are being mixed with native JavaScript. The function names are not very descriptive, and that's due in part to the fact that the whole thing relies on a context that may or may not exist. But if you happened to run this in a browser inside an HTML document that defined a <code>&lt;button id="main_button"&gt;</code>, you might get prompted for some text to work with, and then see the an <code>alert</code> with first letter of each of the words in that text capitalized.</p>
<p>Imperative code like this is written to be read and executed from top to bottom (give or take a little <a href="http://www.sitepoint.com/demystifying-javascript-variable-scope-hoisting/">variable hoisting</a>). But there are some improvements we could make to clean it up and make it more readable by taking advantage of JavaScript's object-oriented nature.</p>
<h2 id="object-oriented-javascript">Object-Oriented JavaScript</h2>
<p>After a few years, developers started to notice the problems with imperative coding in a shared environment like the browser. Global variables from one snippet of JavaScript clobbered global variables set by another. The order in which the code was called affected the results in ways that could be unpredictable, especially given the delays introduced by network connections and rendering times.</p>
<p>Eventually, some better practices emerged to help encapsulate JavaScript code and make it play better with the DOM. An updated variation of the same code above, written to an object-oriented standard, might look something like this:</p>
<pre><code class="language-javascript">(function() {
  "use strict";
  var SomeText = function(text) {
    this.text = text;
  };
  SomeText.prototype.capify = function(str) {
    var firstLetter = str.charAt(0);
    var remainder = str.substring(1);
    return [firstLetter.toUpperCase(), remainder].join("");
  };
  SomeText.prototype.capifyWords = function() {
    var result = [];
    var textArray = this.text.split(" ");
    for (var counter = 0; counter &lt; textArray.length; counter++) {
      result.push(this.capify(textArray[counter]));
    }
    return result.join(" ");
  };

  document.getElementById("main_button").addEventListener("click", function(e) {
    var something = prompt("Give me something to capitalize");
    var newText = new SomeText(something);
    alert(newText.capifyWords());
  });
}());</code></pre>
<p>In this object-oriented version, the constructor function simulates a class to model the object we want. Methods live on the new object's prototype to keep memory use low. And all of the code is isolated in an anonymous immediately-invoked function expression so it doesn't litter the global scope. There's even a <code>"use strict"</code> directive to take advantage of the latest JavaScript engine, and the old-fashioned <code>onclick</code> method has been replaced with a shiny new <code>addEventListener</code>, because who uses IE8 or earlier anymore? A script like this would likely be inserted at the end of the <code>&lt;body&gt;</code> element on an HTML document, to make sure all the DOM had been loaded before it was processed so the <code>&lt;button&gt;</code> it relies on would be available. </p>
<p>But despite all this reconfiguration, there are still many artifacts of the same imperative style that led us here. The methods in the constructor function rely on variables that are scoped to the parent object. There's a looping construct for iterating across all the members of the array of strings. There's a <code>counter</code> variable that serves no purpose other than to increment the progress through the <code>for</code> loop. And there are methods that produce the side effect of modifying variables that exist outside of their own definitions. All of this makes the code more brittle, less portable, and makes it harder to test the methods outside of this narrow context.</p>
<h2 id="functional-javascript">Functional JavaScript</h2>
<p>The object-oriented approach is much cleaner and more modular than the imperative approach we started with, but let's see if we can improve it by addressing some of the drawbacks we discussed. It would be great if we could find ways to take advantage of JavaScript's built-in ability to treat functions as first-class objects so that our code could be cleaner, more stable, and easier to repurpose.</p>
<pre><code class="language-javascript">(function() {
  "use strict";
  var capify = function(str) {
    return [str.charAt(0).toUpperCase(), str.substring(1)].join("");
  };
  var processWords = function(fn, str) {
    return str.split(" ").map(fn).join(" ");
  };
  document.getElementById("main_button").addEventListener("click", function(e) {
    var something = prompt("Give me something to capitalize");
    alert(processWords(capify, something));
  });
}());</code></pre>
<p>Did you notice how much shorter this version is? We're only defining two functions: <code>capify</code> and <code>processWords</code>. Each of these functions is pure, meaning that they don't rely on the state of the code they're called from. The functions don't create side effects that alter variables outside of themselves. There is one and only one result a function returns for any given set of arguments. Because of these improvements, the new functions are very easy to test, and could be snipped right out of this code and used elsewhere without any modifications. </p>
<p>There might have been one keyword in there that you wouldn't recognize unless you've peeked at some functional code before. We took advantage of the new <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map method</a> on <code>Array</code> to apply a function to each element of the temporary array we created when we split our string. <code>Map</code> is just one of a handful of convenience methods we were given when modern browsers and server-side JavaScript interpreters implemented the ECMAscript 5 standards. Just using <code>map</code> here, in place of a <code>for</code> loop, eliminated the <code>counter</code> variable and helped make our code much cleaner and easier to read.</p>
<h2 id="start-thinking-functionally">Start Thinking Functionally</h2>
<p>You don't have to abandon everything you know to take advantage of the functional paradigm. You can get started thinking about your JavaScript in a functional way by considering a few questions when you write your next program:</p>
<ul><li>Are my functions dependent on the context in which they are called, or are they pure and independent? </li>
<li>Can I write these functions in such a way that I could depend on them always returning the same result for a given input?</li>
<li>Am I sure that my functions don't modify anything outside of themselves?</li>
<li>If I wanted to use these functions in another program, would I need to make changes to them?</li>
</ul><p>This introduction barely scratches the surface of functional JavaScript, but I hope it whets your appetite to learn more.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-31" name="t-31"></a><h1>31 : Filtering and Chaining in Functional JavaScript</h1>
					<div class="tutorial__content">
<p class="wp-special">One of the things I appreciate about JavaScript is its versatility. JavaScript gives you the opportunity to use object oriented programming, imperative programming, and even functional programming. And you can go back and forth among them depending on your current needs and the preferences and expectations of your team.</p>

<p>Although JavaScript supports functional techniques, it's not optimized for pure functional programming the way a language such as Haskell or Scala is. While I don't usually structure my JavaScript programs to be 100 percent functional, I enjoy using functional programming concepts to help me keep my code clean and focus on designing code that can be reused easily and tested cleanly.</p>
<h2 id="filteringtolimitadataset">Filtering to Limit a Data Set</h2>
<p>With the advent of ES5, JavaScript Arrays inherited a few methods that make functional programming even more convenient. JavaScript Arrays can now <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a>, <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce">reduce</a>, and <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a> natively. Each of these methods goes through every one of the items in an array, and without the need for a loop or local state changes, performs an analysis that can return a result that's ready to use immediately or pass-through to be operated on further.</p>
<p>In this article I want to introduce you to filtering. Filtering allows you to evaluate every item of an array, and based on a test condition you pass in, determine whether to return a new array that contains that element. When you use the <code>filter</code> method of Array, what you get back as another array that is either the same length as the original array or smaller, containing a subset of the items in the original that match the condition you set.</p>
<h2 id="usingalooptodemonstratefiltering">Using a Loop to Demonstrate Filtering</h2>
<p>A simple example of the sort of problem that might benefit from filtering is limiting an array of strings to only the strings that have three characters. That's not a complicated problem to solve, and we can do it pretty handily using vanilla JavaScript <code>for</code> loops without the <code>filter</code> method. It might look something like this:</p>
<pre><code class="javascript language-javascript">var animals = ["cat","dog","fish"];
var threeLetterAnimals = [];
for (let count = 0; count &lt; animals.length; count++){
  if (animals[count].length === 3) {
    threeLetterAnimals.push(animals[count]);
  }
}
console.log(threeLetterAnimals); // ["cat", "dog"]
</code></pre>
<p>What we're doing here is defining an array containing three strings, and creating an empty array where we can store just the strings that only have three characters. We're defining a count variable to use in the <code>for</code> loop as we iterate through the array. Every time that we come across a string that has exactly three characters, we push it into our new empty array. And once were done, we just log the result.</p>
<p>There's nothing stopping us from modifying the original array in our loop, but by doing that we would permanently lose the original values. It's much cleaner to create a new array and leave the original untouched.</p>
<h2 id="usingthefiltermethod">Using the Filter Method</h2>
<p>There's nothing technically wrong with the way that we did that,  but the availability of the <code>filter</code> method on Array allows us to make our code much cleaner and straightforward. Here's an example of how we might've done the exact same thing using the <code>filter</code> method:</p>
<pre><code class="javascript language-javascript">var animals = ["cat","dog","fish"];
var threeLetterAnimals = animals.filter(function(animal) {
  return animal.length === 3;
});
console.log(threeLetterAnimals); // ["cat", "dog"]
</code></pre>
<p>As before, we started with a variable that contains our original array, and we defined a new variable for the array that's going to contain just the strings that have three characters. But in this case, when we defined our second array, we assigned it directly to the result of applying the <code>filter</code> method to the original animals array. We passed <code>filter</code> an anonymous in-line function that only returned <code>true</code> if the value it was operating on had a length of three.</p>
<p>The way the <code>filter</code> method works, it goes through every element in the array and applies the test function to that element. If the test function returns <code>true</code> for that element, the array returned by the <code>filter</code> method will include that element. Other elements will be skipped.</p>
<p>You can see how much cleaner the code looks. Without even understanding ahead of time what <code>filter</code> does, you could probably look at this code and figure out the intention.</p>
<p>One of the happy by-products of functional programming is the cleanliness that results from reducing the amount of local state being stored, and limiting modification of external variables from within functions. In this case, the <code>count</code> variable and the various states that our <code>threeLetterAnimals</code> array was taking while we looped through the original array were simply more state to keep track of. Using <code>filter</code>, we've managed to eliminate the <code>for</code> loop as well as the <code>count</code> variable. And we're not altering the value of our new array multiple times the way we were doing before. We're defining it once, and assigning it the value that comes from applying our <code>filter</code> condition to the original array.</p>
<h2 id="otherwaystoformatafilter">Other Ways to Format a Filter</h2>
<p>Our code can be even more concise if we take advantage of <code>const</code> declarations and anonymous inline arrow functions. These are EcmaScript 6 (ES6) features that are supported now in most browsers and JavaScript engines natively.</p>
<pre><code class="javascript language-javascript">const animals = ["cat","dog","fish"];
const threeLetterAnimals = animals.filter(item =&gt; item.length === 3);
console.log(threeLetterAnimals); // ["cat", "dog"]
</code></pre>
<p>While it's probably a good idea to move beyond the older syntax in most cases, unless you need to make your code match an existing codebase, it's important to be selective about it. As we get more concise, each line of our code gets more complex.</p>
<p>Part of what makes JavaScript so much fun is how you can play with so many ways to design the same code to optimize for size, efficiency, clarity, or maintainability to suit your team's preferences. But that also puts a greater burden on teams to create shared style guides and discuss the pros and cons of each choice.</p>
<p>In this case, to make our code more readable and more versatile, we might want to take that anonymous in-line arrow function and turn it into a traditional named function, passing that named function right into the <code>filter</code> method. The code might look like this:</p>
<pre><code class="javascript language-javascript">const animals = ["cat","dog","fish"];
function exactlyThree(word) {
  return word.length === 3;
}
const threeLetterAnimals = animals.filter(exactlyThree);
console.log(threeLetterAnimals); // ["cat", "dog"]
</code></pre>
<p>All we've done here is extract the anonymous in-line arrow function we defined above and turn it into a separate named function. As we can see, we have defined <a href="https://www.sitepoint.com/an-introduction-to-reasonably-pure-functional-programming/">a pure function</a> that takes the appropriate value type for the elements of the array, and returns the same type. We can just pass the name of that function directly to the <code>filter</code> method as a condition.</p>
<h2 id="quickreviewofmapandreduce">Quick Review of Map and Reduce</h2>
<p>Filtering works hand-in-hand with two other functional Array methods from ES5, <code>map</code> and <code>reduce</code>. And thanks to the ability to chain methods in JavaScript, you can use this combination to craft very clean code that performs some pretty complex functions.</p>
<p>As a quick reminder,  the <code>map</code> method goes through every element in an array and modifies it according to a function, returning a new array of the same length with modified values.</p>
<pre><code class="javascript language-javascript">const animals = ["cat","dog","fish"];
const lengths = animals.map(getLength);
function getLength(word) {
  return word.length;
}
console.log(lengths); //[3, 3, 4]
</code></pre>
<p>The <code>reduce</code> method goes through an array and performs a series of operations, carrying the running result of those operations forward in an accumulator. When it's done, it returns a final result. In this case we're using the second argument to set the initial accumulator to 0.</p>
<pre><code class="javascript language-javascript">const animals = ["cat","dog","fish"];
const total = animals.reduce(addLength, 0);
function addLength(sum, word) {
  return sum + word.length;
}
console.log(total); //10
</code></pre>
<p>All three of these methods leave the original array untouched, as they should for proper functional programming practice. If you want a reminder about how <code>map</code> and <code>reduce</code> work, you can check out my earlier article on <a href="https://www.sitepoint.com/map-reduce-functional-javascript/">using map and reduce in functional JavaScript</a>.</p>
<h2 id="chainingmapreduceandfilter">Chaining Map, Reduce, and Filter</h2>
<p>As a very simple example of what's possible, let's imagine that you wanted to take an array of strings, and return a single string containing only the three letter strings from the original, but you wanted to format the resulting string in <a href="https://en.wikipedia.org/wiki/Studly_caps">StudlyCaps</a>. Without using <code>map</code>, <code>reduce</code>, and <code>filter</code>, you might try do it something like this:</p>
<pre><code class="javascript language-javascript">const animals = ["cat","dog","fish"];
let threeLetterAnimalsArray = [];
let threeLetterAnimals;
let item;
for (let count = 0; count &lt; animals.length; count++){
  item = animals[count];
  if (item.length === 3) {
    item = item.charAt(0).toUpperCase() + item.slice(1);
    threeLetterAnimalsArray.push(item);
  }
}
threeLetterAnimals = threeLetterAnimalsArray.join("");
console.log(threeLetterAnimals); // "CatDog"
</code></pre>
<p>Of course this works, but as you can see were creating a bunch of extra variables that we don't need, and maintaining the state of an array that's being changed as we go through our different loops. We can do better.</p>
<p>And in case you're wondering about the logic behind the variable declarations, I prefer to use <code>let</code> to declare an empty target array, although technically it could be declared as a <code>const</code>. Using <code>let</code> reminds me that the content of the array is going to be altered. Some teams may prefer to use <code>const</code> in cases like these, and it's a good discussion to have.</p>
<p>Let's create some pure functions that take strings and return strings. Then we can use those in a chain of <code>map</code>, <code>reduce</code>, and <code>filter</code> methods, passing the result from one onto the next this way:</p>
<pre><code class="javascript language-javascript">const animals = ["cat","dog","fish"];
function studlyCaps(words, word) {
  return words + word;
}
function exactlyThree(word) {
  return (word.length === 3);
}
function capitalize(word) {
  return word.charAt(0).toUpperCase() + word.slice(1);
}
const threeLetterAnimals = animals
  .filter(exactlyThree)
  .map(capitalize)
  .reduce(studlyCaps);
console.log(threeLetterAnimals); // "CatDog"
</code></pre>
<p>In this case we define three pure functions, <code>studlyCaps</code>, <code>exactlyThree</code>, and <code>capitalize</code>. We can pass these functions directly to <code>map</code>, <code>reduce</code>, and <code>filter</code> in a single unbroken chain. First we filter our original array with <code>exactlyThree</code>, then we map the result to <code>capitalize</code>, and finally we reduce the result of that with <code>studlyCaps</code>. And we're assigning the final result of that chain of operations directly to our new <code>threeLetterAnimals</code> variable with no loops and no intermediate state and leaving our original array untouched.</p>
<p>The resulting code is very clean and easy to test, and provides us with pure functions that we could easily use in other contexts or modify as requirements change.</p>
<h2 id="filteringandperformance">Filtering and Performance</h2>
<p>It's good to be aware that the <code>filter</code> method is likely to perform just a tiny bit slower than using a <code>for</code> loop until browsers and JavaScript engines optimize for the new Array methods (<a href="https://jsperf.com/array-loop-vs-filter">jsPerf</a>).</p>
<p>As I've argued before, I recommend using these functional Array methods anyway, rather than using loops, even though they currently tend to be a little bit slower in performance. I favor them because they produce cleaner code. I always recommend writing code in the way that's the cleanest and most maintainable, and then optimizing only when real-world situations prove that you need better performance. For most use cases I can foresee, I wouldn't expect filter performance to be a significant bottleneck in a typical web application, but the only way you can be sure is to try it and find out.</p>
<p>The fact that filtering can be slightly slower than using a <code>for</code> loop is very unlikely to cause a noticeable performance issue in the real world. But if it does, and if your users are negatively impacted, you'll know exactly where and how to optimize. And the performance will only get better as the JavaScript engines optimize for these new methods.</p>
<p>Don't be afraid to start filtering today. The functionality is native in ES5, which is almost universally supported.  The code you produce will be cleaner and easier to maintain. Using the <code>filter</code> method you can be confident that you won't alter the state of the array that you're evaluating. You will be returning a new array each time, and your original array will remain unchanged.</p>
<p>Agree? Disagree? Comments are welcome below.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-32" name="t-32"></a><h1>32 : A Beginner's Guide to Currying in Functional JavaScript</h1>
					<div class="tutorial__content">
					<span>https://www.sitepoint.com/currying-in-functional-javascript/</span>
<p>Currying, or partial application, is one of the functional techniques that can sound confusing to people familiar with more traditional ways of writing JavaScript. But when applied properly, it can actually make your functional JavaScript more readable.</p>
<h2>More Readable And More Flexible</h2>
<p>One of the advantages touted for functional JavaScript is shorter, tighter code that gets right to the point in the fewest lines possible, and with less repetition. Sometimes this can come at the expense of readability; until you're familiar with the way the functional programming works, code written in this way can be harder to read and understand.</p>
<p>If you've come across the term currying before, but never knew what it meant, you can be forgiven for thinking of it as some exotic, spicy technique that you didn't need to bother about. But currying is actually a very simple concept, and it addresses some familiar problems when dealing with function arguments, while opening up a range of flexible options for the developer.</p>
<h2 id="what-is-currying">What Is Currying?</h2>

<p>Briefly, currying is a way of constructing functions that allows partial application of a function's arguments. What this means is that you can pass all of the arguments a function is expecting and get the result, or pass a subset of those arguments and get a function back that's waiting for the rest of the arguments. It really is that simple.</p>
<p>Currying is elemental in languages such as Haskell and Scala, which are built around functional concepts. JavaScript has functional capabilities, but currying isn't built in by default (at least not in current versions of the language). But we already know some functional tricks, and we can make currying work for us in JavaScript, too.</p>
<p>To give you a sense of how this could work, let's create our first curried function in JavaScript, using familiar syntax to build up the currying functionality that we want. As an example, let's imagine a function that greets somebody by name. We all know how to create a simple greet function that takes a name and a greeting, and logs the greeting with the name to the console:</p>
<pre><code>var greet = function(greeting, name) {
  console.log(greeting + ", " + name);
};
greet("Hello", "Heidi"); //"Hello, Heidi"
</code></pre>
<p>This function requires both the name and the greeting to be passed as arguments in order to work properly. But we could rewrite this function using simple nested currying, so that the basic function only requires a greeting, and it returns another function that takes the name of the person we want to greet. </p>
<h2 id="our-first-curry">Our First Curry</h2>
<pre><code>var greetCurried = function(greeting) {
  return function(name) {
    console.log(greeting + ", " + name);
  };
};
</code></pre>
<p>This tiny adjustment to the way we wrote the function lets us create a new function for any type of greeting, and pass that new function the name of the person that we want to greet:</p>
<pre><code>var greetHello = greetCurried("Hello");
greetHello("Heidi"); //"Hello, Heidi"
greetHello("Eddie"); //"Hello, Eddie"
</code></pre>
<p>We can also call the original curried function directly, just by passing each of the parameters in a separate set of parentheses, one right after the other:</p>
<pre><code>greetCurried("Hi there")("Howard"); //"Hi there, Howard"
</code></pre>
<p>Why not try this out in your browser?</p>

<h2 id="curry-all-the-things">Curry All the Things!</h2>
<p>The cool thing is, now that we have learned how to modify our traditional function to use this approach for dealing with arguments, we can do this with as many arguments as we want:</p>
<pre><code>var greetDeeplyCurried = function(greeting) {
  return function(separator) {
    return function(emphasis) {
      return function(name) {
        console.log(greeting + separator + name + emphasis);
      };
    };
  };
};
</code></pre>
<p>We have the same flexibility with four arguments as we have with two. No matter how far the nesting goes, we can create new custom functions to greet as many people as we choose in as many ways as suits our purposes:</p>
<pre><code>var greetAwkwardly = greetDeeplyCurried("Hello")("...")("?");
greetAwkwardly("Heidi"); //"Hello...Heidi?"
greetAwkwardly("Eddie"); //"Hello...Eddie?"
</code></pre>
<p>What's more, we can pass as many parameters as we like when creating custom variations on our original curried function, creating new functions that are able to take the appropriate number of additional parameters, each passed separately in its own set of parentheses:</p>
<pre><code>var sayHello = greetDeeplyCurried("Hello")(", ");
sayHello(".")("Heidi"); //"Hello, Heidi."
sayHello(".")("Eddie"); //"Hello, Eddie."
</code></pre>
<p>And we can define subordinate variations just as easily:</p>
<pre><code>var askHello = sayHello("?");
askHello("Heidi"); //"Hello, Heidi?"
askHello("Eddie"); //"Hello, Eddie?"
</code></pre>

<h2 id="currying-traditional-functions">Currying Traditional Functions</h2>
<p>You can see how powerful this approach is, especially if you need to create a lot of very detailed custom functions. The only problem is the syntax. As you build these curried functions up, you need to keep nesting returned functions, and call them with new functions that require multiple sets of parentheses, each containing its own isolated argument. It can get messy.</p>
<p>To address that problem, one approach is to create a quick and dirty currying function that will take the name of an existing function that was written without all the nested returns. A currying function would need to pull out the list of  arguments for that function, and use those to return a curried version of the original function:</p>
<pre><code>var curryIt = function(uncurried) {
  var parameters = Array.prototype.slice.call(arguments, 1);
  return function() {
    return uncurried.apply(this, parameters.concat(
      Array.prototype.slice.call(arguments, 0)
    ));
  };
};
</code></pre>
<p>To use this, we pass it the name of a function that takes any number of arguments, along with as many of the arguments as we want to pre-populate. What we get back is a function that's waiting for the remaining arguments:</p>
<pre><code>var greeter = function(greeting, separator, emphasis, name) {
  console.log(greeting + separator + name + emphasis);
};
var greetHello = curryIt(greeter, "Hello", ", ", ".");
greetHello("Heidi"); //"Hello, Heidi."
greetHello("Eddie"); //"Hello, Eddie."
</code></pre>
<p>And just as before, we're not limited in terms of the number of arguments we want to use when building derivative functions from our curried original function:</p>
<pre><code>var greetGoodbye = curryIt(greeter, "Goodbye", ", ");
greetGoodbye(".", "Joe"); //"Goodbye, Joe."
</code></pre>

<h2 id="getting-serious-about-currying">Getting Serious about Currying</h2>
<p>Our little currying function may not handle all of the edge cases, such as missing or optional parameters, but it does a reasonable job as long as we stay strict about the syntax for passing arguments. </p>
<p>Some functional JavaScript libraries such as <a href="http://ramdajs.com/">Ramda</a> have more flexible currying functions that can break out the parameters required for a function, and allow you to pass them individually or in groups to create custom curried variations. If you want to use currying extensively, this is probably the way to go.</p>
<p>Regardless of how you choose to add currying to your programming, whether you just want to use nested parentheses or you prefer to include a more robust carrying function, coming up with a consistent naming convention for your curried functions will help make your code more readable. Each derived variation of a function should have a name that makes it clear how it behaves, and what arguments it's expecting.</p>
<h2 id="argument-order">Argument Order</h2>
<p>One thing that's important to keep in mind when currying is the order of the arguments. Using the approach we've described, you obviously want the argument that you're most likely to replace from one variation to the next to be the last argument passed to the original function. </p>
<p>Thinking ahead about argument order will make it easier to plan for currying, and apply it to your work. And considering the order of your arguments in terms of least to most likely to change is not a bad habit to get into anyway when designing functions.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Currying is an incredibly useful technique from functional JavaScript. It allows you to generate a library of small, easily configured functions that behave consistently, are quick to use, and that can be understood when reading your code. Adding currying to your coding practice will encourage the use of partially applied functions throughout your code, avoiding a lot of potential repetition, and may help get you into better habits about naming and dealing with function arguments.</p>
<p>If you enjoyed, this post, you might also like some of the others from the series:</p>
<ul><li><a href="http://www.sitepoint.com/introduction-functional-javascript/">An Introduction to Functional JavaScript</a></li>
<li><a href="http://www.sitepoint.com/higher-order-functions-javascript/">Higher-Order Functions in JavaScript</a></li>
<li><a href="http://www.sitepoint.com/recursion-functional-javascript/">Recursion in Functional JavaScript</a></li>
</ul>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-33" name="t-33"></a><h1>33 : Higher-Order Functions in JavaScript</h1>
					<div class="tutorial__content">
					<span>https://www.sitepoint.com/higher-order-functions-javascript/</span>
<p>One of the characteristics of JavaScript that makes it well-suited for functional programming is the fact that it can accept higher-order functions. A higher-order function is a function that can take another function as an argument, or that returns a function as a result. </p>
<h2 id="first-class-functions">First Class Functions</h2>
<p>You may have heard it said that JavaScript treats functions as first-class citizens. What this means is that functions in JavaScript are treated as objects. They have the type <code>Object</code>, they can be assigned as the value of a variable, and they can be passed and returned just like any other reference variable. </p>
<p>This native ability gives JavaScript special powers when it comes to functional programming. Because functions are objects, the language supports a very natural approach to functional programming. In fact, it's so natural, that I'll bet you've been using it without even thinking about it.</p>
<h2 id="taking-functions-as-arguments">Taking Functions as Arguments</h2>
<p>If you've done much web-based JavaScript programming or front-end development, you've probably come across functions that use a callback. A callback is a function that gets executed at the end of an operation, once all of the other operations of been completed. Usually this callback function is passed in as the last argument in the function. Frequently, it's defined inline as an anonymous function.</p>

<p>Since JavaScript is single-threaded, meaning that only one operation happens at a time,  each operation that's going to happen is queued along this single thread. The strategy of passing in a function to be executed after the rest of the parent function's operations are complete is one of the basic characteristics of languages that support higher-order functions. It allows for asynchronous behavior, so a script can continue executing while waiting for a result. The ability to pass a callback function is critical when dealing with resources that may return a result after an undetermined period of time. </p>
<p>This is very useful in a web programming environment, where a script may send an Ajax request off to a server, and then need to handle the response whenever it arrives, with no knowledge in advance of network latency or processing time on the server. Node.js frequently uses callbacks to make the most efficient use of server resources. This approach is also useful in the case of an app that waits for user input before performing a function.</p>
<p>For example, consider this snippet of simple JavaScript that adds an event listener to a button. </p>
<pre><code class="language-javascript">&lt;button id="clicker"&gt;So Clickable&lt;/button&gt;

document.getElementById("clicker").addEventListener("click", function() {
  alert("you triggered " + this.id);
});</code></pre>
<p>This script uses an anonymous inline function to display an alert. But it could just as easily have used a separately defined function, and passed that named function to the <code>addEventListener</code> method</p>
<pre><code class="language-javascript">var proveIt = function() {
  alert("you triggered " + this.id);
};

document.getElementById("clicker").addEventListener("click", proveIt);</code></pre>
<p>Note that we passed <code>proveIt</code> and not <code>proveIt()</code> to our <code>addEventListener</code> function. When you pass a function by name without parentheses, you are passing the function object itself. When you pass it with parentheses, you are passing the result of executing that function.</p>
<p>Our little <code>proveIt()</code> function is structurally independent of the code around it, always returning the <code>id</code> of whatever element was triggered. This bit of code could exist in any context in which you wanted to display an alert with the <code>id</code> of an element, and could be called with any event listener.</p>
<p>The ability to replace an inline function with a separately defined and named function opens up a world of possibilities. As we try to develop pure functions that don't alter external data, and return the same result for the same input every time, we now have one of the essential tools to help us develop a library of small, targeted functions that can be used generically in any application. </p>
<h2 id="returning-functions-as-results">Returning Functions as Results</h2>
<p>In addition to taking functions as arguments, JavaScript allows functions to return other functions as a result. This makes perfect sense, since functions are simply objects, they can be returned the same as any other value.</p>
<p>But what does it mean to return a function as a result? Defining a function as the return value of another function allows you to create functions that can be used as templates to create new functions. That opens the door to another world of functional JavaScript magic. </p>
<p>For example, imagine you've gotten tired of reading all of these articles about the specialness of <em>Millennials</em>, and you decide you want to replace the word <em>Millennials</em> with the phrase <em>Snake People</em> every time it occurs. Your impulse might be simply to write a function that performed that text replacement on any text you passed to it:</p>
<pre><code class="language-javascript">var snakify = function(text) {
  return text.replace(/millenials/ig, "Snake People");
};
console.log(snakify("The Millenials are always up to something."));
// The Snake People are always up to something.</code></pre>
<p>That works, but it's pretty specific to this one situation. You're also tired of hearing about the <em>Baby Boomers</em>. You'd like to make a custom function for them as well. But even with such a simple function, you don't want to have to repeat the code that you've written:</p>
<pre><code class="language-javascript">var hippify = function(text) {
  return text.replace(/baby boomers/ig, "Aging Hippies");
};
console.log(hippify("The Baby Boomers just look the other way."));
// The Aging Hippies just look the other way.</code></pre>
<p>But what if a you decided that you wanted to do something fancier to preserve case in the original string? You would have to modify both of your new functions to do this. That's a hassle, and it makes your code more brittle and harder to read. </p>
<p>What you really want is the flexibility to be able to replace any term with any other term in a template function, and define that behavior as a foundational function from which you could spawn a whole race of custom functions. </p>
<p>With the ability to return functions instead of values, JavaScript offers up ways to make that scenario much more convenient:</p>
<pre><code class="language-javascript">var attitude = function(original, replacement, source) {
  return function(source) {
    return source.replace(original, replacement);
  };
};

var snakify = attitude(/millenials/ig, "Snake People");
var hippify = attitude(/baby boomers/ig, "Aging Hippies");

console.log(snakify("The Millenials are always up to something."));
// The Snake People are always up to something.
console.log(hippify("The Baby Boomers just look the other way."));
// The Aging Hippies just look the other way.</code></pre>
<p>What we've done is isolate the code that does the actual work into a versatile and extensible <code>attitude</code> function that encapsulates all of the work needed to modify any input string using an original phrase and a replacement phrase with some attitude. </p>
<p>Defining a new function as a reference to the <code>attitude</code> function, pre-populated with the first two arguments it takes, allows the new function to take whatever argument you pass it and use that as the source text in the internal function returned by the <code>attutide</code> function.</p>
<p>We're taking advantage here of the fact that JavaScript functions don't care whether they are passed the same number of arguments as they were originally defined to take. If an argument is missing, the function will just treat the missing arguments as undefined. </p>
<p>On the other hand, that additional argument can be passed in later when the function being called has been defined in the way we just demonstrated, as a reference to a function returned from another function with an argument (or more) left undefined.</p>
<p>Go over that a few times if you need to, so you fully understand what's happening. We're creating a template function that returns another function. Then we're defining that newly returned function, minus one attribute, as a custom implementation of the template function.  All the functions created this way will inherit the same working code from the template function, but can be predefined with different default arguments.  </p>
<h2 id="its-what-youre-already-doing">It's What You're Already Doing</h2>
<p>Higher-order functions are so basic to the way JavaScript works, you're already using them. Every time you pass an anonymous function or a callback, you're actually taking the value that the passed function returns, and using that as an argument for another function. </p>
<p>The ability of functions to return other functions extends the convenience of JavaScript, allowing us to create custom named functions to perform specialized tasks with shared template code. Each of these little functions can inherit any improvements made in the original code down the road, which helps us avoid code duplication, and keeps our source clean and readable. </p>
<p>As an added bonus, if you make sure your functions are pure, so that they don't alter external values and they always return the same value for any given input, you put yourself in a good position to create test suites to verify that your code changes don't break anything you're relying on when you update your template functions.</p>
<p>Start thinking about ways you can take advantage of this approach in your own projects. One of the great things about JavaScript is that you can mix functional techniques right in with the code you're already familiar with. Try some experiments. You may be surprised how easily a little work with higher-order functions can improve your code.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-34" name="t-34"></a><h1>34 : Recursion in Functional JavaScript</h1>
					<div class="tutorial__content">
<p>You may have come across references to recursive functions while programming in JavaScript. You may even have tried to construct (or deconstruct) a few yourself. But you probably haven't seen a lot of examples of effective recursion in the wild. In fact, other than the exotic nature of this approach, you may not have considered when and where recursion is useful, or how dangerous it can be if used carelessly.</p>
<h2 id="what-is-recursion-good-for">What is Recursion Good For?</h2>
<p>Recursion is a technique for iterating over an operation by having a function call itself repeatedly until it arrives at a result. Most loops can be rewritten in a recursive style, and in some functional languages this approach to looping is the default.</p>

<p>However, while JavaScript's functional coding style does support recursive functions, we need to be aware that most JavaScript compilers are not currently optimized to support them safely.</p>
<p>Recursion is best applied when you need to call the same function repeatedly with different parameters from within a loop. While it can be used in many situations, it is most effective for solving problems involving iterative branching, such as fractal math, sorting, or traversing the nodes of complex or non-linear data structures.</p>
<p>One reason that recursion is favored in functional programming languages is that it allows for the construction of code that doesn't require setting and maintaining state with local variables. Recursive functions are also naturally easy to test because they are easy to write in a pure manner, with a specific and consistent return value for any given input, and no side effects on external variable states.</p>
<h2 id="looping">Looping</h2>
<p>The classic example of a function where recursion can be applied is the factorial. This is a function that returns the value of multiplying a number again and again by each preceding integer, all the way down to one.</p>
<p>For example, the factorial of three is:</p>
<pre><code class="language-bash">3 × 2 × 1 = 6</code></pre>
<p>The factorial of six is:</p>
<pre><code class="language-bash">6 × 5 × 4 × 3 × 2 × 1 = 720</code></pre>
<p>You can see how quickly these results get big. You can also see that we're repeating the same behavior over and over. We take the result of one multiplication operation and multiply it again by one less than the second value. Then we do that again and again until we reach one.</p>
<p>Using a for loop, it's not difficult to create a function that will perform this operation iteratively until it returns the correct result:</p>
<pre><code class="language-javascript">var factor = function(number) {
  var result = 1;
  var count;
  for (count = number; count &gt; 1; count--) {
    result *= count;
  }
  return result;
};
console.log(factor(6));
// 720</code></pre>
<p>This works, but it isn't very elegant from a functional programming perspective. We have to use a couple of local variables that maintain and track state in order to support that for loop and then return a result. Wouldn't it be cleaner if we could ditch that for loop, and take a more functional JavaScript approach?</p>
<h2 id="recursion">Recursion</h2>
<p>We know <a href="http://www.sitepoint.com/higher-order-functions-javascript/">JavaScript will let us write functions that take functions as arguments</a>. So what if we want to  use the actual function we're writing and execute it in the context of running it.</p>
<p>Is that even possible? You bet it is! For example, take the case of a simple <code>while</code> loop like this:</p>
<pre><code class="language-javascript">var counter = 10;
	while(counter &gt; 0) {
    console.log(counter--);
}</code></pre>
<p>When this is done, the value of  <code>counter</code> has been changed, but the loop has done its job of printing out each value it held as we slowly sucked the state out of it.</p>
<p>A recursive version of the same loop might look more like this:</p>
<pre><code class="language-javascript">var countdown = function(value) {
    if (value &gt; 0) {
        console.log(value);
        return countdown(value - 1);
    } else {
        return value;
    }
};
countdown(10);</code></pre>
<p>Do you see how we're calling the <code>countdown</code> function right inside the definition of the <code>countdown</code> function? JavaScript handles that like a boss, and just does what you would hope. Every time <code>countdown</code> is executed, JavaScript keeps track of where it was called from, and then works backward through that stack of function calls until it's finished. Our  function has also avoided modifying the state of any variables, but has still taken advantage of a passed in value to control the recursion.</p>
<p>Getting back to our factorial case, we could rewrite our earlier function like this to use recursion:</p>
<pre><code class="language-javascript">var factorial = function(number) {
  if (number &lt;= 0) { // terminal case
    return 1;
  } else { // block to execute
    return (number * factorial(number - 1));
  }
};
console.log(factorial(6));
// 720</code></pre>
<p>Writing code this way allows us to describe the whole process in a stateless way with no side effects. Also worth noticing is the way we test the value of the argument being passed in to the function first thing, before doing any calculations. We want any functions that are going to call themselves to exit quickly and cleanly when they get to their terminal case. For a factorial calculated this way, the terminal case comes when the number passed in is zero or negative (we could also test for negative values and return a different message, if we so desired).</p>
<h2 id="tail-call-optimization">Tail Call Optimization</h2>
<p>One problem with contemporary implementations of JavaScript is that they don't have a standard way to prevent recursive functions from stacking up on themselves indefinitely, and eating away at memory until they exceed the capacity of the engine. JavaScript recursive functions need to keep track of where they were called from each time, so they can resume at the correct point.</p>
<p>In many functional languages, such as Haskell and Scheme, this is managed using a technique called tail call optimization. With tail call optimization, each successive cycle in a recursive function would take place immediately, instead of stacking up in memory.</p>
<p>Theoretically, tail call optimization is part of the standard for ECMAScript 6, currently the next version of JavaScript, however it has <a href="https://kangax.github.io/compat-table/es6/">yet to be fully implemented</a> by most platforms.</p>
<h2 id="trampoline-functions">Trampoline Functions</h2>
<p>There are ways to force JavaScript to perform recursive functions in a safe manner when necessary. For example, it's possible to construct a custom trampoline function to manage recursive execution iteratively, keeping only one operation on the stack at a time. Trampoline functions used this way can take advantage of JavaScript's ability to bind a function to a specific context, so as to bounce a recursive function up against itself, building up results one at a time until the cycle is complete. This will avoid creating a deep stack of operations waiting to be performed.</p>
<p>In practice, making use of trampoline functions usually slows down performance in favor of safety. Additionally, much of the elegance and readability we obtain by writing our functions in a recursive manner gets lost in the code convolutions necessary to make this approach work in JavaScript.</p>
<p>If you're curious, I encourage you to read  more about this concept, and share your thoughts in the discussion below. You might start with a short <a href="http://stackoverflow.com/questions/25228871/how-to-understand-trampoline-in-javascript">thread on StackOverflow</a>, then explore some essays by <a href="https://taylodl.wordpress.com/2013/06/07/functional-javascript-tail-call-optimization-and-trampolines/">Don Taylor</a> and <a href="http://www.integralist.co.uk/posts/js-recursion.html">Mark McDonnell</a> that dig deeper into the ups and downs of trampolines in JavaScript.</p>
<h2 id="were-not-there-yet">We're Not There Yet</h2>
<p>Recursion is a powerful technique that's worth knowing about. In many cases, recursion is the most direct way to solve a complex problem. But until ECMAScript 6 is implemented everywhere we need it with tail call optimization, we will need to be very careful about how and where we apply recursion.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-35" name="t-35"></a><h1>35 : How to Build and Structure a Node.js MVC Application</h1>
					<div class="tutorial__content">
<p class="wp-special">In a non-trivial application, the architecture is as important as the quality of the code itself. We can have well-written pieces of code, but if we don't have a good organization, we will have a hard time as the complexity increases. There is no need to wait until the project is half-way done to start thinking about the architecture; the best time is before starting, using our goals as beacons for our choices.</p>

<p>Node.js doesn't have a de facto framework with strong opinions on architecture and code organization in the same way that Ruby has the Rails framework, for example. As such, it can be difficult to get started with building full web applications with Node.</p>
<p>In this article, we are going to build the basic functionality of a note-taking app using the MVC architecture. To accomplish this we are going to employ the <a href="https://hapijs.com/">Hapi.js</a> framework for <a href="https://nodejs.org/en/">Node.js</a> and <a href="http://www.sqlite.org/">SQLite</a> as a database, using <a href="http://docs.sequelizejs.com/en/v3/">Sequelize.js</a>, plus other small utilities to speed up our development. We are going to build the views using <a href="https://pugjs.org/api/getting-started.html">Pug</a>, the templating language.</p>
<h2 id="whatismvc">What is MVC?</h2>
<p>Model-View-Controller (or MVC) is probably one of the most popular architectures for applications. As with a lot of other <a href="https://youtu.be/NdSD07U5uBs?t=29m2s">cool things</a> in computer history, the MVC model was conceived at <a href="https://en.wikipedia.org/wiki/PARC_(company)">PARC</a> for the Smalltalk language as a solution to the problem of organizing applications with graphical user interfaces. It was created for desktop applications, but since then, the idea has been adapted to other mediums including the web.</p>
<p>We can describe the MVC architecture in simple words:</p>
<p><strong>Model</strong>: The part of our application that will deal with the database or any data-related functionality.</p>
<p><strong>View</strong>: Everything the user will see. Basically the pages that we are going to send to the client.</p>
<p><strong>Controller</strong>: The logic of our site, and the glue between models and views. Here we call our models to get the data, then we put that data on our views to be sent to the users.</p>
<p>Our application will allow us to publish, see, edit and delete plain-text notes. It won't have other functionality, but because we will have a solid architecture already defined we won't have big trouble adding things later.</p>
<p>You can check out the final application in the <a href="https://github.com/sitepoint-editors/notes-board">accompanying GitHub repository</a>, so you get a general overview of the application structure.</p>
<h2 id="layingoutthefoundation">Laying out the Foundation</h2>
<p>The first step when building any Node.js application is to create a <code>package.json</code> file, which is going to contain all of our dependencies and scripts. Instead of creating this file manually, NPM can do the job for us using the <code>init</code> command:</p>
<pre><code class="bash language-bash">npm init -y
</code></pre>
<p>After the process is complete will get a <code>package.json</code> file ready to use.</p>
<blockquote>
<p><strong>Note:</strong> If you're not familiar with these commands, checkout our <a href="https://www.sitepoint.com/beginners-guide-node-package-manager/">Beginner's Guide to npm</a>.</p>
</blockquote>
<p>We are going to proceed to install Hapi.js—the framework of choice for this tutorial. It provides a good balance between simplicity, stability and feature availability that will work well for our use case (although there are other options that would also work just fine).</p>
<pre><code class="bash language-bash">npm install --save hapi hoek
</code></pre>
<p>This command will download the latest version of Hapi.js and add it to our package.json file as a dependency. It will also download the <a href="https://github.com/hapijs/hoek">Hoek</a> utility library that will help us write shorter error handlers, among <a href="https://github.com/hapijs/hoek/blob/master/API.md">other things</a>.</p>
<p>Now we can create our entry file; the web server that will start everything. Go ahead and create a <code>server.js</code> file in your application directory and all the following code to it:</p>
<pre><code class="javascript language-javascript">'use strict';

const Hapi = require('hapi');
const Hoek = require('hoek');
const Settings = require('./settings');

const server = new Hapi.Server();
server.connection({ port: Settings.port });

server.route({
  method: 'GET',
  path: '/',
  handler: (request, reply) =&gt; {
    reply('Hello, world!');
  }
});

server.start((err) =&gt; {
  Hoek.assert(!err, err);

  console.log(`Server running at: ${server.info.uri}`);
});
</code></pre>
<p>This is going to be the foundation of our application. </p>
<p>First, we indicate that we are going to use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">strict mode</a>, which is a <a href="https://hapijs.com/styleguide#strict-mode">common practice</a> when using the Hapi.js framework.</p>
<p>Next, we include our dependencies and instantiate a new server object where we set the connection port to <code>3000</code> (the port can be any number <a href="http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xml">above 1023 and below 65535</a>.)</p>
<p>Our first route for our server will work as a test to see if everything is working, so a 'Hello, world!' message is enough for us. In each route, we have to define the HTTP method and path (URL) that it will respond to, and a handler, which is a function that will process the HTTP request. The handler function can take two arguments: <code>request</code> and <code>reply</code>. The first one contains information about the HTTP call, and the second will provide us with methods to handle our response to that call.</p>
<p>Finally, we start our server with the <code>server.start</code> method. As you can see, we can use Hoek to improve our error handling, making it shorter. This is completely optional, so feel free to omit it in your code, just be sure to handle any errors.</p>
<h2 id="storingoursettings">Storing Our Settings</h2>
<p>It is good practice to store our configuration variables in a dedicated file. This file exports a JSON object containing our data, where each key is assigned from an environment variable—but without forgetting a fallback value.</p>
<p>In this file, we can also have different settings depending on our environment (e.g. development or production). For example, we can have an in-memory instance of SQLite for development purposes, but a real SQLite database file on production.</p>
<p>Selecting the settings depending on the current environment is quite simple. Since we also have an <code>env</code> variable in our file which will contain either <code>development</code> or <code>production</code>, we can do something like the following to get the database settings (for example):</p>
<pre><code class="javascript language-javascript">const dbSettings = Settings[Settings.env].db;
</code></pre>
<p>So <code>dbSettings</code> will contain the setting of an in-memory database when the <code>env</code> variable is <code>development</code>, or will contain the path of a database file when the <code>env</code> variable is <code>production</code>.</p>
<p>Also, we can add support for a <code>.env</code> file, where we can store our environment variables locally for development purposes; this is accomplished using a package like <a href="https://github.com/motdotla/dotenv">dotenv</a> for Node.js, which will read a <code>.env</code> file from the root of our project and automatically add the found values to the environment. You can find an example in the <a href="https://github.com/motdotla/dotenv/tree/master/examples/basic">dotenv repository</a>.</p>
<blockquote>
<p><strong>Note:</strong> If you decide to also use a <code>.env</code> file, make sure you install the package with <code>npm install -s dotenv</code> and add it to <code>.gitignore</code> so you don't publish any sensitive information.</p>
</blockquote>
<p>Our <code>settings.js</code> file will look like this:</p>
<pre><code class="javascript language-javascript">// This will load our .env file and add the values to process.env,
// IMPORTANT: Omit this line if you don't want to use this functionality
require('dotenv').config({silent: true});

module.exports = {
  port: process.env.PORT || 3000,
  env: process.env.ENV || 'development',

  // Environment-dependent settings
  development: {
    db: {
      dialect: 'sqlite',
      storage: ':memory:'
    }
  },
  production: {
    db: {
      dialect: 'sqlite',
      storage: 'db/database.sqlite'
    }
  }
};
</code></pre>
<p>Now we can start our application by executing the following command and navigating to <code>localhost:3000</code> in our web browser.</p>
<pre><code class="bash language-bash">node server.js
</code></pre>
<blockquote>
<p><strong>Note</strong>: This project was tested on Node v6. If you get any errors, ensure you have an updated installation.</p>
</blockquote>
<h2 id="definingtheroutes">Defining the Routes</h2>
<p>The definition of routes gives us an overview of the functionality supported by our application. To create our additional routes, we just have to replicate the structure of the route that we already have in our <code>server.js</code> file, changing the content of each one.</p>
<p>Let's start by creating a new directory called <code>lib</code> in our project. Here we are going to include all the JS components. Inside <code>lib</code>, let's create a <code>routes.js</code> file and add the following content:</p>
<pre><code class="javascript language-javascript">'use strict';

module.exports = [
  // We are going to define our routes here
];
</code></pre>
<p>In this file, we will export an array of objects that contain each route of our application. To define the first route, add the following object to the array:</p>
<pre><code class="javascript language-javascript">{
  method: 'GET',
  path: '/',
  handler: (request, reply) =&gt; {
    reply('All the notes will appear here');
  },
  config: {
    description: 'Gets all the notes available'
  }
},
</code></pre>
<p>Our first route is for the home page (<code>/</code>) and since it will only return information we assign it a <code>GET</code> method. For now, it will only give us the message <code>All the notes will appear here</code>, which we are going to change later for a controller function. The <code>description</code> field in the <code>config</code> section is only for documentation purposes.</p>
<p>Then, we create the four routes for our notes under the <code>/note/</code> path. Since we are building a <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> application, we will need one route for each action with the corresponding <a href="http://www.w3schools.com/tags/ref_httpmethods.asp">HTTP method</a>. </p>
<p>Add the following definitions next to the previous route:</p>
<pre><code class="javascript language-javascript">{
  method: 'POST',
  path: '/note',
  handler: (request, reply) =&gt; {
    reply('New note');
  },
  config: {
    description: 'Adds a new note'
  }
},
{
  method: 'GET',
  path: '/note/{slug}',
  handler: (request, reply) =&gt; {
    reply('This is a note');
  },
  config: {
    description: 'Gets the content of a note'
  }
},
{
  method: 'PUT',
  path: '/note/{slug}',
  handler: (request, reply) =&gt; {
    reply('Edit a note');
  },
  config: {
    description: 'Updates the selected note'
  }
},
{
  method: 'GET',
  path: '/note/{slug}/delete',
  handler: (request, reply) =&gt; {
    reply('This note no longer exists');
  },
  config: {
    description: 'Deletes the selected note'
  }
},
</code></pre>
<p>We have done the same as in the previous route definition, but this time we have changed the method to match the action we want to execute.</p>
<p>The only exception is the delete route. In this case, we are going to define it with the <code>GET</code> method rather than <code>DELETE</code> and add an extra <code>/delete</code> in the path. This way, we can call the delete action just by visiting the corresponding URL. </p>
<blockquote>
<p><strong>Note</strong>: If you plan to implement a strict REST interface, then you would have to use the <code>DELETE</code> method and remove the <code>/delete</code> part of the path.</p>
</blockquote>
<p>We can name parameters in the path by surrounding the word in brackets (<strong>{</strong> … <strong>}</strong>). Since we are going to identify notes by a slug, we add <code>{slug}</code> to each path, with the exception of the PUT route; we don't need it there because we are not going to interact with a specific note, but to create one. </p>
<p>You can read more about Hapi.js routes on the <a href="https://hapijs.com/tutorials/routing?lang=en_US">official documentation</a>.</p>
<p>Now, we have to add our new routes to the <code>server.js</code> file. Let's import the routes file at the top of the file:</p>
<pre><code class="javascript language-javascript">const Routes = require('./lib/routes');
</code></pre>
<p>and replace our current test route with the following:</p>
<pre><code class="javascript language-javascript">server.route(Routes);
</code></pre>
<h2 id="buildingthemodels">Building the Models</h2>
<p>Models allow us to define the structure of the data and all the functions to work with it. </p>
<p>In this example, we are going to use the <a href="http://www.sqlite.org/">SQLite</a> database with <a href="http://docs.sequelizejs.com/en/v3/">Sequelize.js</a> which is going to provide us with a better interface using the ORM (<a href="https://en.wikipedia.org/wiki/Object-relational_mapping">Object-Relational Mapping</a>) technique. It will also provide us a database-independent interface.</p>
<h3 id="settingupthedatabase">Setting up the database</h3>
<p>For this section we are going to use <a href="https://www.npmjs.com/package/sequelize">Sequelize.js</a> and <a href="https://www.npmjs.com/package/sqlite3">SQlite</a>. You can install and include them as dependencies by executing the following command:</p>
<pre><code class="bash language-bash">npm install -s sequelize sqlite3
</code></pre>
<p>Now create a <code>models</code> directory inside <code>lib/</code> with a file called <code>index.js</code> which is going to contain the database and Sequelize.js setup, and include the following content:</p>
<pre><code class="javascript language-javascript">'use strict';

const Fs = require('fs');
const Path = require('path');
const Sequelize = require('sequelize');
const Settings = require('../../settings');

// Database settings for the current environment
const dbSettings = Settings[Settings.env].db;

const sequelize = new Sequelize(dbSettings.database, dbSettings.user, dbSettings.password, dbSettings);
const db = {};

// Read all the files in this directory and import them as models
Fs.readdirSync(__dirname)
  .filter((file) =&gt; (file.indexOf('.') !== 0) &amp;&amp; (file !== 'index.js'))
  .forEach((file) =&gt; {
    const model = sequelize.import(Path.join(__dirname, file));
    db[model.name] = model;
  });

db.sequelize = sequelize;
db.Sequelize = Sequelize;

module.exports = db;
</code></pre>
<p>First, we include the modules that we are going to use: </p>
<ul><li><code>Fs</code>, to read the files inside the <em>models</em> folder, which is going to contain all the models.</li>
<li><code>Path</code>, to join the path of each file in the current directory.</li>
<li><code>Sequelize</code>, that will allow us to create a new Sequelize instance.</li>
<li><code>Settings</code>, which contains the data of our <em>settings.js</em> file from the root of our project.</li>
</ul><p>Next, we create a new <code>sequelize</code> variable that will contain a <code>Sequelize</code> instance with our database settings for the current environment. We are going to use <code>sequelize</code> to import all the models and make them available in our <code>db</code> object.</p>
<p>The <code>db</code> object is going to be exported and will contain our database methods for each model; it will be available in our application when we need to do something with our data.</p>
<p>To load all the models, instead of defining them manually, we look for all the files inside the <code>models</code> directory (with the exception of the <code>index.js</code>file) and load them using the <code>import</code> function. The returned object will provide us with the CRUD methods, which we then add to the <code>db</code> object.</p>
<p>At the end, we add <code>sequelize</code> and <code>Sequelize</code> as part of our <code>db</code> object, the first one is going to be used in our <code>server.js</code> file to connect to the database before starting the server, and the second one is included for convenience if you need it in other files too.</p>
<h3 id="creatingournotemodel">Creating our Note model</h3>
<p>In this section we are going to use the <a href="http://momentjs.com/">Moment.js</a> package to help with Date formatting. You can install it and include it as a dependency with the following command:</p>
<pre><code class="bash language-bash">npm install -s moment
</code></pre>
<p>Now, we are going to create a <code>note.js</code> file inside the <code>models</code> directory, which is going to be the only model in our application; it will provide us with all the functionality we need.</p>
<p>Add the following content to that file:</p>
<pre><code class="javascript language-javascript">'use strict';

const Moment = require('moment');

module.exports = (sequelize, DataTypes) =&gt; {
  let Note = sequelize.define('Note', {
    date: {
      type: DataTypes.DATE,
      get: function () {
        return Moment(this.getDataValue('date')).format('MMMM Do, YYYY');
      }
    },
    title: DataTypes.STRING,
    slug: DataTypes.STRING,
    description: DataTypes.STRING,
    content: DataTypes.STRING
  });

  return Note;
};
</code></pre>
<p>We export a function that accepts a <code>sequelize</code> instance, to define the model, and a <code>DataTypes</code> object with all the types available in our database.</p>
<p>Next, we define the structure of our data using an object where each key corresponds to a database column and the value of the key defines the type of data that we are going to store. You can see the list of data types in the <a href="http://docs.sequelizejs.com/en/latest/api/datatypes/">Sequelize.js documentation</a>. The tables in the database are going to be created automatically based on this information.</p>
<p>In the case of the date column, we also define a how Sequelize should return the value using a <a href="http://docs.sequelizejs.com/en/latest/docs/models-definition/#getters-setters">getter</a> function (<code>get</code> key). We indicate that before returning the information it should be first passed through the Moment utility to be formatted in a more readable way (<code>MMMM Do, YYYY</code>).</p>
<blockquote>
<p><strong>Note:</strong> Although we are getting a simple and easy to read date string, it is stored as a precise date string product of the <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a> object of JavaScript. So this is not a destructive operation.</p>
</blockquote>
<p>Finally, we return our model.</p>
<h3 id="synchronizingthedatabase">Synchronizing the Database</h3>
<p>Now, we have to synchronize our database before we are able to use it in our application. In <code>server.js</code>, import the models at the top of the file:</p>
<pre><code class="javascript language-javascript">// Import the index.js file inside the models directory
const Models = require('./lib/models/');
</code></pre>
<p>Next, replace the following code block:</p>
<pre><code class="javascript language-javascript">server.start((err) =&gt; {
  Hoek.assert(!err, err);
  console.log(`Server running at: ${server.info.uri}`);
});
</code></pre>
<p>with this one:</p>
<pre><code class="javascript language-javascript">Models.sequelize.sync().then(() =&gt; {
  server.start((err) =&gt; {
    Hoek.assert(!err, err);
    console.log(`Server running at: ${server.info.uri}`);
  });
});
</code></pre>
<p>This code is going to synchronize the models to our database and, once that is done, the server will be started.</p>
<h2 id="buildingthecontrollers">Building the controllers</h2>
<p>Controllers are functions that accept the <a href="https://hapijs.com/api#request-object">request</a> and <a href="https://hapijs.com/api#reply-interface">reply</a> objects from Hapi.js. The <code>request</code> object contains information about the requested resource and we use <code>reply</code> to return information to the client.</p>
<p>In our application, we are going to return only a JSON object for now, but we will add the views once we build them.</p>
<p>We can think of controllers as functions that will join our models with our views; they will communicate with our models to get the data, and then return that data inside a view.</p>
<h3 id="thehomecontroller">The Home Controller</h3>
<p>The first controller that we are going to build will handle the home page of our site. Create a <code>home.js</code> file inside the <code>lib/controllers</code> directory with the following content:</p>
<pre><code class="javascript language-javascript">'use strict';

const Models = require('../models/');

module.exports = (request, reply) =&gt; {
  Models.Note
    .findAll({
      order: [['date', 'DESC']]
    })
    .then((result) =&gt; {
      reply({
        data: {
          notes: result
        },
        page: 'Home—Notes Board',
        description: 'Welcome to my Notes Board'
      });
    });
};
</code></pre>
<p>First, we get all the notes in our database using the <a href="http://docs.sequelizejs.com/en/latest/api/model/#findalloptions-promisearrayinstance"><code>findAll</code></a> method of our model. This function will return a promise and, if it resolves, we will get an array containing all the notes in our database.</p>
<p>We can arrange the results in descending order, using the <code>order</code> parameter in the options object passed to the <code>findAll</code> method, so the last item will appear first. You can check all the available options in the <a href="http://docs.sequelizejs.com/en/latest/api/model/#findalloptions-promisearrayinstance">Sequelize.js documentation</a>.</p>
<p>Once we have the home controller, we can edit our <code>routes.js</code> file. First, we import the module at the top of the file, next to the <code>Path</code> module import:</p>
<pre><code class="javascript language-javascript">const Home = require('./controllers/home');
</code></pre>
<p>Then we add the controller we just made to the array:</p>
<pre><code class="javascript language-javascript">{
  method: 'GET',
  path: '/',
  handler: Home,
  config: {
    description: 'Gets all the notes available'
  }
},
</code></pre>
<h3 id="boilerplateofthenotecontroller">Boilerplate of the Note Controller</h3>
<p>Since we are going to identify our notes with a slug, we can generate one using the title of the note and the <a href="https://github.com/dodo/node-slug">slug</a> library, so let's install it and include it as a dependency with the following command:</p>
<pre><code class="bash language-bash">npm install -s slug
</code></pre>
<p>The last controller that we have to define in our application will allow us to create, read, update, and delete notes.</p>
<p>We can proceed to create a <code>note.js</code> file inside the <code>lib/controllers</code> directory and add the following content:</p>
<pre><code class="javascript language-javascript">'use strict';

const Models = require('../models/');
const Slugify = require('slug');
const Path = require('path');

module.exports = {
  // Here we are going to include our functions that will handle each request in the routes.js file.
};
</code></pre>
<h3 id="thecreatefunction">The "create" function</h3>
<p>To add a note to our database, we are going to write a <code>create</code> function that is going to wrap the <code>create</code> method on our model using the data contained in the payload object. </p>
<p>Add the following inside the object that we are exporting:</p>
<pre><code class="javascript language-javascript">create: (request, reply) =&gt; {
  Models.Note
    .create({
      date: new Date(),
      title: request.payload.noteTitle,
      slug: Slugify(request.payload.noteTitle, {lower: true}),
      description: request.payload.noteDescription,
      content: request.payload.noteContent
    })
    .then((result) =&gt; {
      // We are going to generate a view later, but for now lets just return the result.
      reply(result);
    });
},
</code></pre>
<p>Once the note is created, we will get back the note data and send it to the client as JSON using the <code>reply</code> function.</p>
<p>For now, we just return the result, but once we build the views in the next section, we will be able to generate the HTML with the new note and add it dynamically on the client. Although this is not completely necessary and will depend on how you are going to handle your front-end logic, we are going to return an HTML block to simplify the logic on the client.</p>
<p>Also, note that the date is being generated on the fly when we execute the function, using <code>new Date()</code>.</p>
<h3 id="thereadfunction">The "read" function</h3>
<p>To search just one element we use the <code>findOne</code> method on our model. Since we identify notes by their slug, the <code>where</code> filter must contain the slug provided by the client in the URL (<code>http://localhost:3000/note/:slug:</code>).</p>
<pre><code class="javascript language-javascript">read: (request, reply) =&gt; {
  Models.Note
    .findOne({
      where: {
        slug: request.params.slug
      }
    })
    .then((result) =&gt; {
      reply(result);
    });
},
</code></pre>
<p>As in the previous function, we will just return the result, which is going to be an object containing the note information. The views are going to be used once we build them in the <a href="#buildingtheviews"><em>Building the Views</em></a> section.</p>
<h3 id="theupdatefunction">The "update" function</h3>
<p>To update a note, we use the <code>update</code> method on our model. It takes two objects, the new values that we are going to replace and the options containing a <code>where</code> filter with the note slug, which is the note that we are going to update.</p>
<pre><code class="javascript language-javascript">update: (request, reply) =&gt; {
  const values = {
    title: request.payload.noteTitle,
    description: request.payload.noteDescription,
    content: request.payload.noteContent
  };

  const options = {
    where: {
      slug: request.params.slug
    }
  };

  Models.Note
    .update(values, options)
    .then(() =&gt; {
      Models.Note
        .findOne(options)
        .then((result) =&gt; {
          reply(result);
        });
    });
},
</code></pre>
<p>After updating our data, since our database won't return the updated note, we can find the modified note again to return it to the client, so we can show the updated version as soon as the changes are made.</p>
<h3 id="thedeletefunction">The "delete" function</h3>
<p>The delete controller will remove the note by providing the slug to the <code>destroy</code> function of our model. Then, once the note is deleted, we redirect to the home page. To accomplish this, we use the <a href="https://hapijs.com/api#replyredirecturi">redirect</a> function of the Hapi.js reply object.</p>
<pre><code class="javascript language-javascript">delete: (request, reply) =&gt; {
  Models.Note
    .destroy({
      where: {
        slug: request.params.slug
      }
    })
    .then(() =&gt; reply.redirect('/'));
}
</code></pre>
<h3 id="usingthenotecontrollerinourroutes">Using the Note controller in our routes</h3>
<p>At this point, we should have our note controller file ready with all the CRUD actions. But to use them, we have to include it in our routes file. </p>
<p>First, let's import our controller at the top of the <code>routes.js</code> file:</p>
<pre><code class="javascript language-javascript">const Note = require('./controllers/note');
</code></pre>
<p>We have to replace each hander with our new functions, so we should have our routes file as follows:</p>
<pre><code class="javascript language-javascript">{
  method: 'POST',
  path: '/note',
  handler: Note.create,
  config: {
    description: 'Adds a new note'
  }
},
{
  method: 'GET',
  path: '/note/{slug}',
  handler: Note.read,
  config: {
    description: 'Gets the content of a note'
  }
},
{
  method: 'PUT',
  path: '/note/{slug}',
  handler: Note.update,
  config: {
    description: 'Updates the selected note'
  }
},
{
  method: 'GET',
  path: '/note/{slug}/delete',
  handler: Note.delete,
  config: {
    description: 'Deletes the selected note'
  }
},
</code></pre>
<blockquote>
<p><strong>Note:</strong> we are including our functions without <code>()</code> at the end, that is because we are referencing our functions without calling them.</p>
</blockquote>
<h2 id="buildingtheviews">Building the Views</h2>
<p>At this point, our site is receiving HTTP calls and responding with JSON objects. To make it useful to everybody we have to create the pages that render our information in a nice way.</p>
<p>In this example, we are going to use the Pug templating language, although this is not mandatory and we can use <a href="https://hapijs.com/tutorials/views">other languages</a> with Hapi.js. Also, we are going to use the <a href="https://github.com/hapijs/vision">Vision</a> plugin to enable the view functionality in our server. </p>
<blockquote>
<p><strong>Note:</strong> If you're not familiar with Pug (formerly Jade), see our <a href="https://www.sitepoint.com/jade-tutorial-for-beginners/">Jade Tutorial for Beginners</a>.</p>
</blockquote>
<p>You can install the packages with the following command:</p>
<pre><code class="bash language-bash">npm install -s vision pug
</code></pre>
<h3 id="thenotecomponent">The note component</h3>
<p>First, we are going to build our note component that is going to be reused across our views. Also, we are going to use this component in some of our controller functions to build a note on the fly in the back-end to simplify the logic on the client.</p>
<p>Create a file in <code>lib/views/components</code> called <code>note.pug</code> with the following content:</p>
<pre><code class="pug language-pug">article
  h2: a(href=`/note/${note.slug}`)= note.title
  small Published on #{note.date}
  p= note.content
</code></pre>
<p>It is composed of the title of the note, the publication date and the content of the note.</p>
<h3 id="thebaselayout">The base layout</h3>
<p>The base layout contains the common elements of our pages; or in other words, for our example, everything that is not content. Create a file in <code>lib/views/</code> called <code>layout.pug</code> with the following content:</p>
<pre><code class="pug language-pug">doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='x-ua-compatible' content='ie=edge')
    title= page
    meta(name='description' content=description)
    meta(name='viewport' content='width=device-width, initial-scale=1')

    link(href='https://fonts.googleapis.com/css?family=Gentium+Book+Basic:400,400i,700,700i|Ubuntu:500' rel='stylesheet')
    link(rel='stylesheet' href='/styles/main.css')
  body
    block content

    script(src='https://code.jquery.com/jquery-3.1.1.min.js' integrity='sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=' crossorigin='anonymous')
    script(src='/scripts/jquery.modal.js')
    script(src='/scripts/main.js')
</code></pre>
<p>The content of the other pages will be loaded in place of <code>block content</code>. Also, note that we will display a page variable in the <code>title</code> element, and a <code>description</code> variable in the <code>meta(name='description')</code> element. We will create those variables in our routes later.</p>
<p>We also include, at the bottom of the page, three JS files, <a href="https://jquery.com/">jQuery</a>, <a href="https://github.com/kylefox/jquery-modal">jQuery Modal</a> and a main.js file which will contain all of our custom JS code for the front-end. Be sure to download those packages and put them in a <code>static/public/scripts/</code> directory. We are going to make them public in the <a href="#servingstaticfiles"><em>Serving Static Files</em></a> section.</p>
<h3 id="thehomeview">The home view</h3>
<p>On our home page, we will show a list containing all the notes in our database and a button that will show a modal window with a form that allows us to create a new note via Ajax.</p>
<p>Create a file in <code>lib/views</code> called <code>home.pug</code> with the following content:</p>
<pre><code class="pug language-pug">extends layout

block content
  header(container)
    h1 Notes Board

    nav
      ul
        // This will show a modal window with a form to send new notes
        li: a(href='#note-form' rel='modal:open') Publish

  main(container).notes-list
    // We loop over all the notes received from our controller rendering our note component with each entry
    each note in data.notes
      include components/note

  // Form to add a new note, this is used by our controller `create` function.
  form(action='/note' method='POST').note-form#note-form
    p: input(name='noteTitle' type='text' placeholder='Title…')
    p: input(name='noteDescription' type='text' placeholder='Short description…')
    p: textarea(name='noteContent') Write here the content of the new note…
    p._text-right: input(type='submit' value='Submit')
</code></pre>
<h3 id="thenoteview">The note view</h3>
<p>The note page is pretty similar to the home page, but in this case, we show a menu with options specific to the current note, the content of the note and the same form as in the home page but with the current note information already filled, so it's there when we update it.</p>
<p>Create a file in <code>lib/views</code> called <code>note.pug</code> with the following content:</p>
<pre><code class="pug language-pug">extends layout

block content
  header(container)
    h1 Notes Board

    nav
      ul
        li: a(href='/') Home
        li: a(href='#note-form' rel='modal:open') Update
        li: a(href=`/note/${note.slug}/delete`) Delete

  main(container).note-content
    include components/note

  form(action=`/note/${note.slug}` method='PUT').note-form#note-form
    p: input(name='noteTitle' type='text' value=note.title)
    p: input(name='noteDescription' type='text' value=note.description)
    p: textarea(name='noteContent')= note.content
    p._text-right: input(type='submit' value='Update')
</code></pre>
<h3 id="thejavascriptontheclient">The JavaScript on the client</h3>
<p>To create and update notes we use the Ajax functionality of jQuery. Although this is not strictly necessary, I feel it provides a better experience for the user.</p>
<p>This is the content of our <code>main.js</code> file in the <code>static/public/scripts/</code> directory:</p>
<pre><code class="javascript language-javascript">$('#note-form').submit(function (e) {
  e.preventDefault();

  var form = {
    url: $(this).attr('action'),
    type: $(this).attr('method')
  };

  $.ajax({
    url: form.url,
    type: form.type,
    data: $(this).serialize(),
    success: function (result) {
      $.modal.close();

      if (form.type === 'POST') {
        $('.notes-list').prepend(result);
      } else if (form.type === 'PUT') {
        $('.note-content').html(result);
      }
    }
  });
});
</code></pre>
<p>Every time the user submits the form in the modal window, we get the information from the form elements and send it to our back-end, depending on the action URL and the method (<code>POST</code> or <code>PUT</code>). Then, we will get the result as a block of HTML containing our new note data. When we add a note, we will just add it on top of the list on the home page, and when we update a note we replace the content for the new one in the note view.</p>
<h3 id="addingsupportforviewsontheserver">Adding support for views on the server</h3>
<p>To make use of our views, we have to include them in our controllers and add the required settings.</p>
<p>In our <code>server.js</code> file, let's import the Node <a href="https://nodejs.org/api/path.html">Path</a> utility at the top of the file, since we are using it in our code to indicate the path of our views.</p>
<pre><code class="javascript language-javascript">const Path = require('path');
</code></pre>
<p>Now, replace the <code>server.route(Routes);</code> line with the following code block:</p>
<pre><code class="javascript language-javascript">server.register([
  require('vision')
], (err) =&gt; {
  Hoek.assert(!err, err);

  // View settings
  server.views({
    engines: { pug: require('pug') },
    path: Path.join(__dirname, 'lib/views'),
    compileOptions: {
      pretty: false
    },
    isCached: Settings.env === 'production'
  });

  // Add routes
  server.route(Routes);
});
</code></pre>
<p>In the code we have added, we first register the <a href="https://github.com/hapijs/vision">Vision</a> plugin with our Hapi.js server, which is going to provide the view functionality. Then, we add the settings for our views—like the engine that we are going to use and the path where the views are located. At the end of the code block, we add again our routes.</p>
<p>This will make work our views on the server, but we still have to declare the view that we are going to use for each route.</p>
<h3 id="settingthehomeview">Setting the home view</h3>
<p>Open the <code>lib/controllers/home.js</code> file and replace the <code>reply(result);</code> line with the following:</p>
<pre><code class="javascript language-javascript">reply.view('home', {
  data: {
    notes: result
  },
  page: 'Home—Notes Board',
  description: 'Welcome to my Notes Board'
});
</code></pre>
<p>After registering the Vision plugin, we now have a <code>view</code> method available on the reply object, we are going to use it to select the <code>home</code> view in our <code>views</code> directory and to send the data that is going to be used when rendering the views. </p>
<p>In the data that we provide to the view, we also include the page title and a meta description for search engines.</p>
<h3 id="settingthenoteviewcreatefunction">Setting the note view: create function</h3>
<p>Right now, every time we create a note we get a JSON object from the server to the client. But since we are doing this process with Ajax, we can send the new note as HTML ready to be added to the page. To do this, we render the <em>note</em> component with the data we have. Replace the line <code>reply(result);</code> with the following code block:</p>
<pre><code class="javascript language-javascript">// Generate a new note with the 'result' data
const newNote = Pug.renderFile(
  Path.join(__dirname, '../views/components/note.pug'),
  {
    note: result
  }
);

reply(newNote);
</code></pre>
<p>We use the <code>renderFile</code> method from Pug to render the note template with the data we just received from our model.</p>
<h3 id="settingthenoteviewreadfunction">Setting the note view: read function</h3>
<p>When we enter a note page, we should get the note template with the content of our note. To do this, we have to replace the <code>reply(result);</code> line with this:</p>
<pre><code class="javascript language-javascript">reply.view('note', {
  note: result,
  page: `${result.title}—Notes Board`,
  description: result.description
});
</code></pre>
<p>As with the home page, we select a view as the first parameter and the data that we are going to use as the second one.</p>
<h3 id="settingthenoteviewupdatefunction">Setting the note view: update function</h3>
<p>Every time we update a note, we will reply similarly to when we create new notes. Replace the <code>reply(result);</code> line with the following code:</p>
<pre><code class="javascript language-javascript">// Generate a new note with the updated data
const updatedNote = Pug.renderFile(
  Path.join(__dirname, '../views/components/note.pug'),
  {
    note: result
  }
);

reply(updatedNote);
</code></pre>
<blockquote>
<p><strong>Note:</strong> The delete function doesn't need a view, since it will just redirect to the home page once the note is deleted.</p>
</blockquote>
<h2 id="servingstaticfiles">Serving Static Files</h2>
<p>The JavaScript and CSS files that we are using on the client side are provided by Hapi.js from the <code>static/public/</code> directory. But it won't happen automatically; we have to indicate to the server that we want to define this folder as public. This is done using the <a href="https://github.com/hapijs/inert">Inert</a> package, which you can install with the following command:</p>
<pre><code class="bash language-bash">npm install -s inert
</code></pre>
<p>In the <code>server.register</code> function inside the <code>server.js</code> file, import the Inert plugin and register it with Hapi like this:</p>
<pre><code class="javascript language-javascript">server.register([
  require('vision'),
  require('inert')
], (err) =&gt; {
</code></pre>
<p>Now we have to define the route where we are going to provide the static files, and their location on our server's filesystem. Add the following entry at the end of the exported object in <code>routes.js</code>:</p>
<pre><code class="javascript language-javascript">{
  // Static files
  method: 'GET',
  path: '/{param*}',
  handler: {
    directory: {
      path: Path.join(__dirname, '../static/public')
    }
  },
  config: {
    description: 'Provides static resources'
  }
}
</code></pre>
<p>This route will use the <code>GET</code> method and we have replaced the handler function with an object containing the directory that we want to make public. </p>
<p>You can find more information about serving static content in the <a href="https://hapijs.com/tutorials/serving-files?lang=en_US#directory-handler">Hapi.js documentation</a>.</p>
<blockquote>
<p><strong>Note:</strong> Check the <a href="https://github.com/sitepoint-editors/notes-board">Github repository</a> for the rest of the <a href="https://github.com/sitepoint-editors/notes-board/tree/master/static">static files</a>, like the <a href="https://github.com/sitepoint-editors/notes-board/blob/master/static/public/styles/main.css">main stylesheet</a>.</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>At this point, we have a very basic Hapi.js application using the MVC architecture. Although there are still things that we should take care of before putting our application in production (e.g. input validation, error handling, error pages, etc.) this should work as a foundation to learn and build your own applications.</p>
<p>If you would like to take this example a bit further, after finishing all the small details (not related the architecture) to make this a robust application, you could implement an authentication system so only registered users are able to publish and edit notes. But your imagination is the limit, so feel free to fork the <a href="https://github.com/sitepoint-editors/notes-board">application repository</a>, experiment with your ideas and let me know what you create in the comments below!</p>
<p><em>This article was peer reviewed by <a href="https://www.sitepoint.com/author/mbrown/">Mark Brown</a> and <a href="https://www.sitepoint.com/author/vildansoftic/">Vildan Softic</a>. Thanks to all of SitePoint's peer reviewers for making SitePoint content the best it can be!</em></p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-36" name="t-36"></a><h1>36 : A Beginner's Guide to JavaScript Variables and Datatypes</h1>
					<div class="tutorial__content">
 <p><em>A Beginner's Guide to JavaScript Variables and Datatypes was peer reviewed by <a href="https://www.sitepoint.com/author/smolinari">Scott Molinari</a> and <a href="https://www.sitepoint.com/author/vildansoftic/">Vildan Softic</a> and <a href="https://www.sitepoint.com/author/cperry/">Chris Perry</a>. Thanks to all of SitePoint's peer reviewers for making SitePoint content the best it can be!</em></p>

<p class="wp-special">So you've decided to learn JavaScript, the programming language of the web. If it seems like a daunting journey ahead and you don't know where to start, here's a little secret: it doesn't take any special skill to learn how to program, and everyone starts at zero. Take it one step at a time, and you'll get there.</p>

<h2 id="isthisguideforme">Is This Guide For Me?</h2>
<p>If any of these apply to you, you'll benefit from reading this guide:</p>
<ul><li>You've never used a programming language before.</li>
<li>You've never used JavaScript before.</li>
<li>You've tried learning JavaScript before but found the resources lacking or hard to follow.</li>
<li>You know a bit of JavaScript, but want to brush up on the basics.</li>
</ul><p>In this article, we're going to focus on the fundamentals: syntax, variables, comments, and datatypes. The beauty is that you can apply the concepts you learn about JavaScript here to learning another programming language in the future.</p>
<blockquote>
<p><strong>Disclaimer:</strong> This guide is intended for complete beginners to JavaScript and programming. As such, many concepts will be presented in a simplified manner, and strict ES5 syntax will be used.</p>
</blockquote>
<p>Ready? Let's get started!</p>
<h2 id="whatisjavascript">What is JavaScript?</h2>
<p>JavaScript is the programming language used to make websites dynamic and interactive. It's a <strong>client-side</strong> programming language, which means the code gets executed in the user's web browser. With the advent of <a href="https://nodejs.org/en/">Node.js</a> and other technologies, it can also be used as a <strong>server-side</strong> language, making it extremely versatile. JavaScript is used primarily for <strong>front-end web development</strong> and works closely with HTML and CSS.</p>
<blockquote>
<p><strong>Note:</strong> Java is not JavaScript. It's a different language with a confusingly similar name.</p>
</blockquote>
<h3 id="requirements">Requirements</h3>
<p>You already have the prerequisites to start writing and using JavaScript. All you need is a <strong>web browser</strong> to view the code, and a <strong>text editor</strong> to write it. The browser you're currently using is perfect (Chrome, Firefox, Safari, Edge, etc). Your computer comes preinstalled with Notepad (Windows) or TextEdit (Mac), but I would recommend installing <a href="https://atom.io/">Atom</a> or <a href="http://brackets.io/">Brackets</a>, which are free programs specifically designed for coding.</p>
<p><a href="http://codepen.io/">CodePen</a> is a website that allows you to write code and make live demos, and it will be the easiest way to start following along and practicing.</p>
<h3 id="basicterminology">Basic Terminology</h3>
<p>A programmer writes programs, just as an author writes a book. </p>
<p>A <strong>program</strong> is just a set of instructions that a computer can read and use to perform a task. Each individual instruction is a line of code known as a <strong>statement</strong>, which is similar to a sentence in a book. While a sentence in English ends with a period, a JavaScript statement usually ends with a semicolon. <strong>Syntax</strong> refers to the symbols and rules that define the structure of the language, similar to grammar and punctuation, and the semicolon that ends a JavaScript statement is part of the syntax.</p>
<h2 id="comments">Comments</h2>
<p>A <strong>comment</strong> is a human-readable note written in the code.</p>
<p>Comments are written in plain English with the purpose of explaining the code. Although comments don't technically perform any function in the program, it's crucial to get into the habit of proper documentation to help you or future collaborators understand the intent of your code.</p>
<p>There are two types of comment in JavaScript:</p>
<ul><li><strong>A single line comment</strong>, written as two forward slashes <code>//</code> followed by the comment.</li>
</ul><pre><code class="javascript language-javascript">// This is a single line comment.
</code></pre>
<ul><li><strong>A multi-line comment</strong>, which is sandwiched between <code>/*</code> and <code>*/</code> and can span many lines.</li>
</ul><pre><code class="javascript language-javascript">/* This is a comment.
It's a multi-line comment.
Also a haiku. */
</code></pre>
<h2 id="variables">Variables</h2>
<p>A <strong>variable</strong> is a container that stores data values.</p>
<p>You know a <a href="https://www.sitepoint.com/how-to-declare-variables-javascript/">variable</a> as something that can change. In basic algebra, it's a letter that represents a number. <code>x</code> is a common variable name, but it can just as easily be represented by <code>y</code>, <code>z</code>, or another name.</p>
<p>Initially <code>x</code> has no value or meaning, but you can apply a value to it.</p>
<pre><code class="javascript language-javascript">x = 5
</code></pre>
<p>Now, <code>x</code> represents <code>5</code>. You can think of <code>x</code> as a container that's storing <code>5</code>, which is a number.</p>
<p>In JavaScript, variables work the same, except they can contain more than just numbers as a value – they can contain all sorts of data values, which we'll learn by the end of this article.</p>
<p>Variables are created and declared using the <code>var</code> keyword. We can use our algebra example above to create a JavaScript statement.</p>
<pre><code class="javascript language-javascript">var x = 5; // the variable x contains the numeric value of 5.
</code></pre>
<p>Building on what we've learned so far, you can see that we have a JavaScript statement that declares a variable (<code>x</code>), assigns the number data type (<code>5</code>) with a single equals sign (<code>=</code>), and explains it in plain English with a comment (<code>//</code>). The statement ends with a semi-colon (<code>;</code>). </p>
<p>Variables only need to be declared with <code>var</code> the first time they're used, and as the name suggests, a variable can change.</p>
<pre><code class="javascript language-javascript">var x = 5; // x was worth 5
x = 6; // now it's worth 6
</code></pre>
<p>A variable can only contain one value at a time, and since the program is executed from top to bottom, the value of <code>x</code> is now <code>6</code>.</p>
<p>Here is an example of a variable with a different data type.</p>
<pre><code class="javascript language-javascript">var greeting = "Oh hi, Mark!";
</code></pre>
<p>Now the <code>greeting</code> variable contains the string <code>Oh hi, Mark!</code>.</p>
<p>A few important things to know about variables:</p>
<ul><li>A variable name can have letters, numbers, a dollar sign (<code>$</code>), and an underscore (<code>_</code>), but cannot begin with a number.</li>
<li>A variable cannot be any word on the list of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#Reserved_keywords_as_of_ECMAScript_2015">reserved keywords</a>.</li>
<li>Variables are case sensitive.</li>
<li>The naming convention is <strong>camelCase</strong>, in which a variable always starts in lowercase, but each subsequent word starts with an uppercase letter.</li>
</ul><blockquote>
<p><strong>Tip:</strong> Although a variable can have any name, it's important to choose names that are descriptive yet concise.</p>
</blockquote>
<h2 id="datatypes">Datatypes</h2>
<p>Now that we know about variables, we can learn about the types of data that a variable can hold. </p>
<p>A <strong>data type</strong> is a classification of data. Programming languages need to have different datatypes to interact properly with values. You can do math with a number, but not with a sentence, so the computer classifies them differently. There are six <strong>primitive</strong> (basic) datatypes: strings, numbers, Boolean, null, undefined, and Symbol (new in ES6). Primitives can only hold a single value. Anything that is not one of these primitives is an <strong>Object</strong>. Objects can contain multiple values.</p>
<p>JavaScript is known as a <strong>weakly-typed language</strong> (or <em>loosely-typed</em>), which means the language will automatically determine the data type based on the syntax you use. </p>
<h2 id="testing">Testing</h2>
<p><code>alert()</code> and <code>console.log()</code> are two easy ways to print a value in JavaScript.</p>
<pre><code class="javascript language-javascript">var x = 5;

alert(x);
console.log(x);
</code></pre>
<p><a href="https://codepen.io/taniarascia/pen/yVgYvx">Here</a> is a demo of these methods. An <code>alert</code> is a popup window and <code>console.log</code> will print to the Inspector, which you can find by right-clicking in the browser and selecting <strong>Inspect</strong>. I won't reference these again throughout the article, so you can choose whichever works best for you to practice. I would recommend avoiding the <code>alert</code>, as it's very annoying.</p>
<p>You can always find out the type of a variable using <code>typeof</code>.</p>
<pre><code class="javascript language-javascript">var answer = 42;

typeof answer // returns number
</code></pre>
<h3 id="strings">Strings</h3>
<p>A <strong>string</strong> is a series of characters.</p>
<p>Any data that contains text will be represented by a string. The name <em>string</em> likely originated from early programmers who were reminded of beads on a string.</p>
<ul><li>
<p>A string can be wrapped in <strong>double quotes</strong> (<code>" "</code>):</p>
<pre><code class="javascript language-javascript">"Pull the string, and it will follow wherever you wish."; // double   quoted string
</code></pre>
</li>
<li>
<p>or <strong>single quotes</strong> (<code>' '</code>):</p>
<pre><code class="javascript language-javascript">'Push it, and it will go nowhere at all.'; // single quoted string
</code></pre>
</li>
</ul><blockquote>
<p><strong>Note:</strong> Single quotes are what you would usually call an apostrophe, not to be confused with a backtick, which is located all the way on the left of the keyboard.</p>
</blockquote>
<p>Both ends of the string must match, but otherwise, there is no difference between the two – they're just different ways of writing a string.</p>
<p>But what if I want to write <em>I'm</em> in a single quoted string, or quote someone in a double-quoted string? Won't that break the string?</p>
<p>It will, and there are two options to combat that. You can safely use the opposite type of quotes:</p>
<pre><code class="javascript language-javascript">"Damn it, man, I'm a doctor, not a torpedo technician!"; // using single quotes within a double quoted string
'"Do. Or do not. There is no try." - Yoda'; // using double quotes in a single quoted string
</code></pre>
<p>It's important throughout a project to choose one style for strings for consistency. You can use a backslash (<code>\</code>) to <em>escape</em> the string.</p>
<pre><code class="javascript language-javascript">'Damn it, man, I\'m a doctor, not a torpedo technician!'; 
"\"Do. Or do not. There is no try.\" - Yoda";
</code></pre>
<p>We can apply strings to variables. Let's use my <code>greeting</code> example.</p>
<pre><code class="javascript language-javascript">var greeting = "Oh hi, Mark!";
</code></pre>
<p>Strings can also be linked together in a process known as <strong>concatenation</strong>. Variables and strings can be joined together using the plus (<code>+</code>) symbol.</p>
<pre><code class="javascript language-javascript">var greeting = "Oh hi, " + "Mark" + "!"; // returns Oh hi, Mark!
</code></pre>
<p>Note that an empty space is also a character in a string. In the below example, we'll see how concatenation can be useful.</p>
<pre><code class="javascript language-javascript">var message = "Oh hi, ";
var firstName = "Mark";
var bam = "!";

var greeting = message + firstName + bam; // returns Oh hi, Mark!
</code></pre>
<p>Now all the strings are represented by variables which can change. If you've ever logged into an app (such as your email) and were greeted with your name, you can see how your name is just a string in a variable in their system.</p>
<h3 id="numbers">Numbers</h3>
<p>A <strong>number</strong> is a numerical value.</p>
<p>Numbers do not have any special syntax associated with them like strings do. If you were to place a number in quotes (<code>"5"</code>), it wouldn't be considered a number, but a character in a string. A number can be whole or a decimal (known as a float) and can have a positive or negative value.</p>
<pre><code class="javascript language-javascript">var x = 5; // whole integer
var y = 1.2; // float
var z = -76; // negative whole integer
</code></pre>
<p>A number can be up to 15 digits.</p>
<pre><code class="javascript language-javascript">var largeNumber = 999999999999999; // a valid number
</code></pre>
<p>You can do regular math with numbers – addition (<code>+</code>), subtraction (<code>-</code>), division (<code>/</code>) and multiplication (<code>+</code>).</p>
<pre><code class="javascript language-javascript">var sum = 2 + 5; // returns 7
var difference = 6 - 4; // returns 2
</code></pre>
<p>You can do math with variables.</p>
<pre><code class="javascript language-javascript">var elves = 3;
var dwarves = 7;
var men = 9;
var sauron = 1;

var ringsOfPower = elves + dwarves + men + sauron; // returns 20
</code></pre>
<p>There are two other special number types.</p>
<h4 id="nan">NaN</h4>
<p><code>NaN</code> means Not a Number, even though it's technically a number type. <code>NaN</code> is the result of attempting to do impossible math with other datatypes.</p>
<pre><code class="javascript language-javascript">var nope = 1 / "One"; // returns NaN
</code></pre>
<p>Attempting to divide a number by a string, for example, results in <code>NaN</code>.</p>
<h4 id="infinity">Infinity</h4>
<p><code>Infinity</code> is also technically a number, either the product of dividing by <code>0</code> or calculating a number too large.</p>
<pre><code class="javascript language-javascript">var beyond = 1 / 0; // returns Infinity
</code></pre>
<h3 id="boolean">Boolean</h3>
<p>A <strong>Boolean</strong> is a value that is either true or false.</p>
<p>Boolean values are very commonly used in programming for when a value might switch between yes and no, on and off, or true and false. Booleans can represent the current state of something that is likely to change.</p>
<p>For example, we'd use a Boolean to indicate whether a checkbox is checked or not.</p>
<pre><code class="javascript language-javascript">var isChecked = true;
</code></pre>
<p>Often, Booleans are used to check if two things are equal, or if the result of a math equation is true or false.</p>
<pre><code class="javascript language-javascript">/* Check if 7 is greater than 8 */
7 &gt; 8; // returns false

/* Check if a variable is equal to a string */
var color = "Blue";

color === "Blue"; // returns true
</code></pre>
<blockquote>
<p><strong>Note:</strong> A single equals sign (<code>=</code>) applies one value to another. A double (<code>==</code>) or triple equals sign (<code>===</code>) checks if two things are equal.</p>
</blockquote>
<h3 id="undefined">Undefined</h3>
<p>An <strong>undefined</strong> variable has no value. </p>
<p>With the <code>var</code> keyword, we're <em>declaring</em> a variable, but until a value is assigned to it, it's undefined.</p>
<pre><code class="javascript language-javascript">var thing; // returns undefined
</code></pre>
<p>If you don't declare the variable with <code>var</code>, it's still undefined.</p>
<pre><code class="javascript language-javascript">typeof anotherThing; // returns undefined
</code></pre>
<h3 id="null">Null</h3>
<p><strong>Null</strong> is a value that represents nothing.</p>
<p>Null is the <em>intentional</em> absence of any value. It represents something that doesn't exist and is not any of the other datatypes. </p>
<pre><code class="javascript language-javascript">var empty = null;
</code></pre>
<p>The difference between null and undefined is rather subtle, but the main distinction is that null is an intentionally empty value.</p>
<h3 id="symbol">Symbol</h3>
<p>A <strong>Symbol</strong> is a unique and immutable data type.</p>
<p>A Symbol is a new primitive data type that emerged with the latest JavaScript release (<a href="http://www.ecma-international.org/ecma-262/6.0/">ES6</a>). Its main feature is that each Symbol is a completely unique token, unlike other datatypes which can be overwritten. </p>
<p>As it is an advanced and little-used data type, I won't go into further detail. It is useful to know that it exists, and you can <a href="https://www.sitepoint.com/preparing-ecmascript-6-symbols-uses/">read more about it here</a>.</p>
<pre><code class="javascript language-javascript">var sym = Symbol();
</code></pre>
<h3 id="objects">Objects</h3>
<p>An <strong>object</strong> is a collection of name/value pairs.</p>
<p>Any value that isn't simply a string, number, Boolean, null, undefined, or Symbol is an <a href="https://www.sitepoint.com/javascript-object-creation-patterns-best-practises/">object</a>.</p>
<p>You can create an object with a pair of curly braces (<code>{}</code>).</p>
<pre><code class="javascript language-javascript">var batman = {};
</code></pre>
<p>Objects consist of <strong>properties</strong> and <strong>methods</strong>. Properties are what the object <em>is</em>, and methods are what the object <em>does</em>. Returning to the book analogy, properties are like nouns and adjectives, and methods are like verbs.</p>
<table><thead><tr><th><strong>Property</strong></th>
<th><strong>Method</strong></th>
</tr></thead><tbody><tr><td>batman.firstName</td>
<td>batman.fight()</td>
</tr><tr><td>batman.location</td>
<td>batman.jump()</td>
</tr></tbody></table><p>We can apply some properties to the <code>batman</code> object using name/value pairs (sometimes referred to as <em>key/value</em> pairs). They will be comma-separated and written as <code>propertyName: propertyValue</code>.</p>
<pre><code class="javascript language-javascript">var batman {
  firstName: "Bruce", // string
  lastName: "Wayne", 
  location: "Gotham", 
  introduced: 1939, // number
  billionaire: true, // Boolean
  weakness: null // null
};
</code></pre>
<blockquote>
<p><strong>Note:</strong> the last item in a list of object properties does not end in a trailing comma. </p>
</blockquote>
<p>As you can see, we can apply any primitive data type as a value in an object. We can retrieve an individual value with a dot (<code>.</code>).</p>
<pre><code class="javascript language-javascript">batman.firstName; // returns Bruce, a string
</code></pre>
<p>We can also retrieve the value with bracket notation.</p>
<pre><code class="javascript language-javascript">batman["firstName"]; // returns Bruce
</code></pre>
<p>A JavaScript property name must be a valid JavaScript string or numeric literal. If the name begins with a number or contains a space, it must be accessed using the bracket notation. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Working_with_Objects#Objects_and_properties">Read: MDN</a></p>
<pre><code class="javascript language-javascript">batman.secret identity; // invalid
batman["Secret Identity"]; // valid
</code></pre>
<p>A method performs an action. Here is a simple example. </p>
<pre><code class="javascript language-javascript">var batman {
  firstName: "Bruce",
  lastName: "Wayne", 
  secretIdentity: function() { // method
    return this.firstName + " " + this.lastName;
  }
};
</code></pre>
<p>Instead of a simple data type as the value, I have a <code>function</code>. The <code>function</code> is concatenating <code>firstName</code> and <code>lastName</code> for <code>this</code> object and returning the result. In the example, <code>this</code> is the same as <code>batman</code> because it's inside the object (<code>{}</code>).</p>
<pre><code class="javascript language-javascript">batman.secretIdentity(); // returns Bruce Wayne, a concatenation of two properties
</code></pre>
<p>A method is indicated by parentheses. (<code>()</code>).</p>
<h3 id="arrays">Arrays</h3>
<p>An <strong>array</strong> stores a list into a single variable.</p>
<p>Since an <a href="https://www.sitepoint.com/quick-tip-create-manipulate-arrays-in-javascript/">array</a> contains more than one value, it's a type of object. </p>
<p>You can create an array with a pair of straight braces (<code>[]</code>).</p>
<pre><code class="javascript language-javascript">var ninjaTurtles = [];
</code></pre>
<p>Arrays do not contain name/value pairs.</p>
<pre><code class="javascript language-javascript">var ninjaTurtles = [
  "Leonardo",
  "Michelangelo",
  "Raphael",
  "Donatello"
];
</code></pre>
<p>You can get an individual value by referencing the <code>index</code> of the array. In programming, counting starts at zero, so the first item in a list will always be <code>[0]</code>.</p>
<pre><code class="javascript language-javascript">var leader = ninjaTurtles[0]; // assigns Leonardo to the leader variable
</code></pre>
<p>You can see how many items are in an array with the <code>length</code> property.</p>
<pre><code class="javascript language-javascript">ninjaTurtles.length; // returns 4
</code></pre>
<h2 id="recap">Recap</h2>
<p>We covered a lot in this article. You should now have a better understanding of common programming concepts, terminology, syntax, and fundamentals. By this point, you've learned all about JavaScript variables and datatypes, and now you're ready to move on to manipulating that data and building programs! </p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-37" name="t-37"></a><h1>37 : 10 Node.js Best Practices: Enlightenment from the Node Gurus</h1>
					<div class="tutorial__content">
<p class="wp-special">10 Node.js Best Practices: Enlightenment from the Node Gurus is by guest author <strong>Azat Mardan</strong>. SitePoint guest posts aim to bring you engaging content from prominent writers and speakers of the Web community.</p>
<div class="ArticleBox u-inline"><h3 class="ArticleBox_header t-bg">
                    <span class="ArticleBox_icon fa fa-pencil"></span> More from this author
                 </h3><div class="m-border ArticleBox_content"><ul class="ArticleBox_list"><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/work-with-forms-in-react/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">React Quickly: How to Work with Forms in React</a></li><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/work-with-and-manipulate-state-in-react/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">How to Work with and Manipulate State in React</a></li></ul></div></div>
<p>In my previous article <a href="https://www.sitepoint.com/10-tips-to-become-a-better-node-developer">10 Tips to Become a Better Node Developer in 2017</a>, I introduced 10 Node.js tips, tricks and techniques you could apply to your code today. This post continues in that vein with a further 10 best practices to help you take your Node skills to the next level. This is what we're going to cover:</p>
<ol><li><a href="#usenpmscripts">Use npm scripts</a> — Stop writing bash scripts when you can organize them better with npm scripts and Node. E.g., <code>npm run build</code>, <code>start</code> and <code>test</code>. npm scripts are like the single source of truth when Node developers look at a new project.</li>
<li><a href="#useenvvars">Use env vars</a> — Utilize <code>process.env.NODE_ENV</code> by setting it to <code>development</code>, or <code>production</code>. Some frameworks will use this variable too, so play by the convention.</li>
<li><a href="#understandtheeventloop">Understand the event loop</a> — <code>setImmediate()</code> is not immediate while <code>nextTick()</code> is not next. Use <code>setImmediate()</code> or <code>setTimeout()</code> to offload CPU-intensive tasks to the next event loop cycle.</li>
<li><a href="#usefunctionalinheritance">Use functional inheritance</a> — Avoid getting into mindless debates and a brain-draining trap of debugging and understanding prototypal inheritance or classes by just using functional inheritance like some of the most prolific Node contributors do.</li>
<li><a href="#namethingsappropriately">Name things appropriately</a> — Give meaningful names which will serve as a documentation. Also, please no uppercase filenames, use a dash if needed. Uppercase in filenames not just look strange but <a href="http://stackoverflow.com/a/1594041/1136887">can cause cross-platform issues</a>.</li>
<li><a href="#considernotusingjavascript">Consider NOT Using JavaScript</a> — ES6/7 is pathetic addition which was born out of 6 years of meetings when we already had a better JavaScript called CoffeeScript. Use it if you want ship code faster and stop wasting time debating <code>var</code>/<code>const</code>/<code>let</code>, semi-colons, <code>class</code> and other arguments.</li>
<li><a href="#considernotusingjavascript">Provide native code</a> — When using transpilers, commit native JS code (result of the builds) so your projects can run without the builds</li>
<li><a href="#knowexpressmiddleware">Use gzip</a> — Duh! <code>npm i compression -S</code> and sane logging — not too much not to little depending on the environment. <code>npm i morgan -S</code></li>
<li><a href="#scaleup">Scale up</a> — Start thinking about clustering and having stateless services from day one of your Node development. Use pm2 or strongloop's cluster control</li>
<li><a href="#cacherequests">Cache requests</a> — Get maximum juice out of your Node servers by hiding them behind a static file server such as nginx and/or request level cache like Varnish Cache and CDN caching.</li>
</ol><p>So let's bisect and take a look at each one of them individually. Shall we?</p>

<h2 id="usenpmscripts">Use npm Scripts</h2>
<p>It's almost a standard now to create npm scripts for builds, tests, and most importantly to start the app. This is the first place Node developers look at when they encounter a new Node project. Some people (<a href="https://www.keithcirkel.co.uk/how-to-use-npm-as-a-build-tool/">1</a>, <a href="https://medium.com/@dabit3/introduction-to-using-npm-as-a-build-tool-b41076f488b0#.uxgz421r0">2</a>, <a href="https://medium.freecodecamp.com/why-i-left-gulp-and-grunt-for-npm-scripts-3d6853dd22b8#.xsxz0txdq">3</a>, <a href="https://www.sitepoint.com/guide-to-npm-as-a-build-tool/">4</a>) have even ditched Grunt, Gulp and the likes for the more low-level but more dependable npm script. I can totally understand their argument. Considering that npm scripts have pre and post hooks, you can get to a very sophisticated level of automation:</p>
<pre><code class="javascript language-javascript">"scripts": {
  "preinstall": "node prepare.js",
  "postintall": "node clean.js",
  "build": "webpack",
  "postbuild": "node index.js",
  "postversion": "npm publish"
}
</code></pre>
<p>Often times when developing for the front-end, you want to run two or more watch processes to re-build your code. For example, one for webpack and another for nodemon. You can do this with <code>&amp;&amp;</code> since the first command won't release the prompt. However, there's a handy module called <a href="https://www.npmjs.com/package/concurrently">concurrently</a> which can spawn multiple processes and run them at the same time.</p>
<p>Also, install dev command line tools such as webpack, nodemon, gulp, Mocha, etc. <em>locally</em> to avoid conflicts. You can point to <code>./node_modules/.bin/mocha</code> for example or add this line to your bash/zsh profile (PATH!):</p>
<pre><code class="bash language-bash">export PATH="./node_modules/.bin:$PATH"
</code></pre>
<h2 id="useenvvars">Use Env Vars</h2>
<p>Utilize environment variables even for the early stages of a project to ensure there's no leakage of sensitive info, and just to build the code properly from the beginning. Moreover, some libraries and frameworks (I know Express does it for sure) will pull in info like <code>NODE_ENV</code> to modify their behavior. Set it to <code>production</code>. Set your <code>MONGO_URI</code> and <code>API_KEY</code> values as well. You can create a shell file (e.g. <code>start.sh</code>) and add it to <code>.gitignore</code>:</p>
<pre><code class="bash language-bash">NODE_ENV=production MONGO_URL=mongo://localhost:27017/accounts API_KEY=lolz nodemon index.js
</code></pre>
<p>Nodemon also has a config file where you can put your env vars (<a href="https://github.com/remy/nodemon/blob/master/doc/sample-nodemon.md">example</a>):</p>
<pre><code class="javascript language-javascript">{
  "env": {
    "NODE_ENV": "production",
    "MONGO_URL": "mongo://localhost:27017/accounts"
  }
}
</code></pre>
<h2 id="understandtheeventloop">Understand the Event Loop</h2>
<p>The mighty and clever <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">event loop</a> is what makes Node so fast and brilliant by utilizing all the time which would have been wasted waiting for input and output tasks to complete. Thus, Node is great at optimizing I/O-bound systems.</p>
<p>If you need to perform something CPU-intensive (e.g., computation, hashing of passwords, or compressing), then in addition to spawning new processes for those CPU-tasks, you might want to explore the deferring of the task with <code>setImmediate()</code> or <code>setTimeout()</code> — the code in their callbacks will continue on the next event loop cycle. <code>nextTick()</code> works on the same cycle contrary to the name. Argh!</p>
<p>Here's a diagram from Bert Belder who worked on the event loop. He clearly knows how the event  loop works!</p>

<h2 id="usefunctionalinheritance">Use Functional Inheritance</h2>
<p>JavaScript support prototypal inheritance which is when objects inherit from other objects. The <code>class</code> operator was also added to the language with ES6. However, it's overtly complex compared to functional inheritance. Most Node gurus prefer the simplicity of the latter. It's implemented by a simple function factory pattern, and does NOT require the use of <code>prototype</code>, <code>new</code> or <code>this</code>. There are no implicit effects when you update the prototype (causing all the instances to change as well) since in functional inheritance each object uses its own copy of methods.</p>
<p>Consider code from TJ Holowaychuk, the prolific genius behind Express, Mocha, Connect, Superagent and dozens of other Node modules. Express uses functional inheritance (<a href="https://github.com/expressjs/express/blob/master/lib/express.js">full source code</a>):</p>
<pre><code class="javascript language-javascript">exports = module.exports = createApplication;
// ...
function createApplication() {
  var app = function(req, res, next) {
    app.handle(req, res, next);
  };

  mixin(app, EventEmitter.prototype, false);
  mixin(app, proto, false);

  app.request = { __proto__: req, app: app };
  app.response = { __proto__: res, app: app };
  app.init();
  return app;
}
</code></pre>
<p>To be objective, core Node modules use prototypal inheritance a lot. If you follow that pattern, make sure you know how it works. You can read more about <a href="http://davidshariff.com/blog/javascript-inheritance-patterns/">JavaScript inheritance patterns</a> here.</p>
<h2 id="namethingsappropriately">Name Things Appropriately</h2>
<p>This one is obvious. Good names serve as a documentation. Which one would you prefer?</p>
<pre><code class="javascript language-javascript">const dexter = require('morgan')
// ...
app.use(dexter('dev')) // When is the next season?
</code></pre>
<p>I have no idea what <code>dexter</code> is doing when I only look at <code>app.use()</code>. How about a different more meaningfulname:</p>
<pre><code class="javascript language-javascript">const logger = require('morgan')
// ...
app.use(logger('dev')) // Aha!
</code></pre>
<p>In the same fashion, file names must correctly reflect what is the purpose of the code inside. If you take a look at the <code>lib</code> folder of Node (<a href="https://github.com/nodejs/node/tree/master/lib">GitHub link</a>) which has all the core modules bundled with the platform, then you will see clear naming of the files/modules (even if you are not very familiar with <em>all</em> the core modules):</p>
<pre><code class="bash language-bash">events.js
fs.js
http.js
https.js
module.js
net.js
os.js
path.js
process.js
punycode.js
querystring.js
</code></pre>
<p>The internal modules are marked with an underscore (<code>_debugger.js</code>, <code>_http_agent.js</code>, <code>_http_client.js</code>) just like methods and variable in the code. This helps to warn developers that this is an internal interface and if you are using it, you are on your own — don't complain if it gets refactored or even removed.</p>
<h2 id="considernotusingjavascript">Consider NOT Using JavaScript</h2>
<p>Huh? Did you just read it correctly? But what the heck? Yes. That's correct. Even with ES6 and the two features added by ES2016/ES7, JavaScript still has its quirks. There are other options besides JavaScript which you or your team can benefit from with very little setup. Depending on the expertise level and the nature of the app, you might be better off with <a href="https://www.typescriptlang.org/">TypeScript</a> or <a href="https://flowtype.org/">Flow</a> which provide strong typing. On the other end of the spectrum, there's <a href="http://elm-lang.org/">Elm</a> or <a href="https://clojurescript.org/">ClojureScript</a> which are purely functional. <a href="http://coffeescript.org/">CoffeeScript</a> is another great and battle-tested option. You might take a look at <a href="https://www.dartlang.org/">Dart 2.0</a> as well.</p>
<p>When all you need is just a few macros (macros allow you to <em>build</em> exactly the language you want), not an entire new language, then consider <a href="http://sweetjs.org">Sweet.js</a> which will do exactly that — allow you to write code which generates code.</p>
<p>If you go the non-JavaScript route, please still include your compiled code because some developers might not understand your language well enough to build it properly. For example, VS Code is one of the largest TypeScript projects, maybe after Angular 2, and Code uses TypeScript to patch Node's core module with types. In the <code>vscode/src/vs/base/node/</code> of VS Code repo (<a href="https://github.com/Microsoft/vscode/tree/master/src/vs/base/node">link</a>), you can see familiar module names like <code>crypto</code>, <code>process</code>, etc. but with the <code>ts</code> extension. There are other <code>ts</code> files in the repo. However, they also included <code>vscode/build</code> with native JavaScript code.</p>
<h2 id="knowexpressmiddleware">Know Express Middleware</h2>
<p>Express is a great and very mature framework. It's brilliance comes from allowing myriads of other modules to configure its behavior. Thus, you need to know the most used middleware and you need to know <em>how to use it</em>. So why not grab <a href="https://github.com/azat-co/cheatsheets/tree/master/express4">my Express cheat sheet</a>. I have the main middleware modules listed there. For example, <code>npm i compression -S</code> will give reduce the download speed by deflating the responses. <code>logger('tiny')</code> or <code>logger('common')</code> will provide less (dev) or more (prod) logs respectively.</p>
<h2 id="scaleup">Scale up</h2>
<p>Node is great at async due to its non-blocking I/O and it keeps this async way of coding simple because there's just one thread. This is an opportunity to start scaling early on, maybe even with the first lines of code. There's the core <code>cluster</code> module which will allow you to scale vertically without too many problems. However, an even better way would be is to use a tool such as <a href="http://pm2.keymetrics.io/">pm2</a> or <a href="https://apidocs.strongloop.com/strong-cluster-control/">StrongLoop's cluster control</a>.</p>
<p>For example, this is how you can get started with pm2:</p>
<pre><code class="bash language-bash">npm i -g pm2
</code></pre>
<p>Then you can start four instances of the same server:</p>
<pre><code class="bash language-bash">pm2 start server.js -i 4
</code></pre>
<p>For Docker, pm2 version 2+ has <code>pm2-docker</code>. So your Dockerfile can look like this:</p>
<pre><code class="bash language-bash"># ...

RUN npm install pm2 -g

CMD ["pm2-docker", "app.js"]
</code></pre>
<p>The official Alpine Linux pm2 image is in the <a href="https://hub.docker.com/r/keymetrics/pm2-docker-alpine/">Docker Hub</a>.</p>
<h2 id="cacherequests">Cache Requests</h2>
<p>This is a DevOps best practice which will allow you to get more juice out of your Node instances (you get more than one with pm2 or the like, see above). The way to go is to let Node servers do app stuff like making requests, processing data and executing business logic and offload the traffic to static files to another web server such as Apache httpd or Nginx. Again, you probably should use Docker for the set up:</p>
<pre><code class="bash language-bash">FROM nginx

COPY nginx.conf /etc/nginx/nginx.conf
</code></pre>
<p>I like to use Docker compose to make multiple containers (nginx, Node, Redis, MongoDB) work with each other. For example:</p>
<pre><code class="bash language-bash">web:
  build: ./app
  volumes:
    - "./app:/src/app"
  ports:
    - "3030:3000"
  links:
    - "db:redis"
  command: pm2-docker app/server.js

nginx:
  restart: always
  build: ./nginx/
  ports:
    - "80:80"
  volumes:
    - /www/public
  volumes_from:
    - web
  links:
    - web:web

db:
  image: redis
</code></pre>
<h2 id="summary">Summary</h2>
<p>In this day and age of open-source software, there are no excuses not to learn from the trusted and tested code which is out in the open. You don't need to be in the inner circle to get in. Learning never stops and I'm sure soon we will have different best practices based on the failures and successes which we will experience. They are guaranteed.</p>
<p>Finally, I wanted to write about how software is eating the world and how JavaScript is eating the software… there are great things like yearly standard releases, lots and lots of npm modules, tools and conferences… but instead I'll finish with a word of caution.</p>
<p>I see how more and more people chase the next new framework or language. It's the shiny object syndrome. They learn a new library every week and a new framework every month. They compulsively check Twitter, Reddit, Hacker News and JS Weekly. They use the overwhelming level of activity in the JavaScript world to procrastinate. They have empty public GitHub histories.</p>
<p>Learning new things is good but don't confuse it for actually building stuff.  What matters and what pays your salary is actually building things. <strong>Stop over engineering</strong>. You're not building the next Facebook. Promises vs. generators vs. async await is a moot for me, because by the time someone replied to a thread in a discussion, I already wrote my callback (and used CoffeeScript to do it 2x faster than in plain ES5/6/7!).</p>
<p>The final best practice is to use best practices and the best of the best is to master fundamentals. Read source code, try new things in code and most importantly write tons of code yourself. Now, at this point, stop reading and go ship code that matters!</p>

					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-38" name="t-38"></a><h1>38 : 10 Tips to Become a Better Node Developer in 2017</h1>
					<div class="tutorial__content">
<p class="wp-special">10 Tips to Become a Better Node Developer in 2017 is by guest author <strong>Azat Mardan</strong>. SitePoint guest posts aim to bring you engaging content from prominent writers and speakers of the Web community.</p>
<p><em><strong>Note:</strong> The original title of this article was The Best Node Practices from Gurus of The Platform. The article covers true, tried and tested patterns, not the new and best of 2017. Although, some of the good old practices from Node gurus will still apply in 2017 and 2018 and even in 2019, the new cutting-edge features like async/await, promises are not covered here. That's because these new features are not in the code of Node core, or popular projects like npm, Express, etc. The second part of the essay will reflect the proper nature of the content.</em></p>
<div class="ArticleBox u-inline"><h3 class="ArticleBox_header t-bg">
                    <span class="ArticleBox_icon fa fa-pencil"></span> More from this author
                 </h3><div class="m-border ArticleBox_content"><ul class="ArticleBox_list"><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/work-with-forms-in-react/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">React Quickly: How to Work with Forms in React</a></li><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/work-with-and-manipulate-state-in-react/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">How to Work with and Manipulate State in React</a></li><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/node-js-best-practices-from-the-node-gurus/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">10 Node.js Best Practices: Enlightenment from the Node Gurus</a></li></ul></div></div>
<p>I started working with Node full-time in 2012 when I joined Storify. Since then, I have never looked back or felt that I missed Python, Ruby, Java or PHP — languages with which I had worked during my previous decade of web development.</p>
<p>Storify was an interesting job for me, because unlike many other companies, Storify ran (and maybe still does) everything on JavaScript. You see, most companies, especially large ones such as PayPal, Walmart, or Capital One, only use Node for certain parts of their stack. Usually they use it as an API gateway or an orchestration layer. That's great. But for a software engineer, nothing compares with full immersion into a Node environment.</p>
<p>In this post I'll outline ten tips to help you become a better Node developer in 2017. These tips come from me, who saw and learned them in the trenches, as well as people who have written the most popular Node and npm modules. Here's what we'll be covering:</p>
<ol><li><a href="#avoidcomplexity">Avoid complexity</a> — Organize your code into the smallest chunks possible until they look too small and then make them even smaller.</li>
<li><a href="#useasynchronouscode">Use asynchronous code</a> — Avoid synchronous code like the plague.</li>
<li><a href="#avoidblockingrequire">Avoid blocking require</a> — Put ALL your require statements at the top of the file because they are synchronous and will block the execution.</li>
<li><a href="#knowthatrequireiscached">Know that require is cached</a> — This could be a feature or a bug in your code.</li>
<li><a href="#alwayscheckforerrors">Always check for errors</a> — Errors are not footballs. Never throw errors and never skip the error check.</li>
<li><a href="#alwayscheckforerrors">Use try…catch only in sync code</a> — <code>try...catch</code> is useless for async code, plus V8 can't optimize code in <code>try...catch</code> as well as plain code.</li>
<li><a href="#returncallbacksoruseifelse">Return callbacks or use if … else</a> — Just to be sure, return a callback to prevent execution from continuing.</li>
<li><a href="#listentotheerrorevents">Listen to the error events</a> — Almost all Node classes/objects extend the event emitter (observer pattern) and emit the <code>error</code> event. Be sure to listen to that.</li>
<li><a href="#knowyournpm">Know your npm</a> — Install modules with <code>-S</code> or <code>-D</code> instead of <code>--save</code> or <code>--save-dev</code></li>
<li><a href="#knowyournpm">Use exact versions in package.json</a>: npm stupidly adds a caret by default when you use <code>-S</code>, so get rid of them manually to lock the versions. Never trust semver in your apps, but do so in open-source modules.</li>
<li><em>Bonus</em> — Use different dependencies. Put things your project needs only in development in <code>devDependencies</code> and then use <code>npm i --production</code>. The more un-required dependencies you have, the greater the risk of vulnerability.</li>
</ol><p>So let's bisect and take a look at each one of them individually. Shall we?</p>
<p>And don't forget: as mentioned above, this is part one. You can find <a href="https://www.sitepoint.com/node-js-best-practices-from-the-node-gurus/">a further ten tips in part two</a>.</p>


<h2 id="avoidcomplexity">Avoid Complexity</h2>
<p>Take a look at some of the modules written by Isaac Z. Schlueter, the creator of npm. For example, <a href="https://www.npmjs.com/package/use-strict">use-strict</a> enforces JavaScript strict mode for modules, and it's just <em>three</em> lines of code:</p>
<pre><code class="javascript language-javascript">var module = require('module')
module.wrapper[0] += '"use strict";'
Object.freeze(module.wrap)
</code></pre>
<p>So why avoid complexity? A famous phrase which originated in the US Navy according to one of the legends proclaims: KEEP IT SIMPLE STUPID (or is it <em>"Keep it simple, stupid"</em>?). That's for a reason. The human brain can hold only five to seven items in its working memory at any one time. This is just a fact.</p>
<p>By keeping your code modularized into smaller parts, you and other developers can understand and reason about it better. You can also test it better. Consider this example,</p>
<pre><code class="javascript language-javascript">app.use(function(req, res, next) {
  if (req.session.admin === true) return next()
  else return next(new Error('Not authorized'))
}, function(req, res, next) {
  req.db = db
  next()
})
</code></pre>
<p>Or this code:</p>
<pre><code class="javascript language-javascript">const auth = require('./middleware/auth.js')
const db = require('./middleware/db.js')(db)

app.use(auth, db)
</code></pre>
<p>I'm sure most of you will prefer the second example, especially when the names are self-explanatory. Of course, when you write the code you might think that you understand how it works. Maybe you even want to show off how smart you are by chaining several methods together in one line. Please, code for the dumber version of you. Code for the you who hasn't looked at this code for six months, or a tried or drunk version of you. If you write code at the peak of your mental capacity, then it will be harder for you to understand it later, not to even mention your colleagues who are not even familiar with the intricacies of the algorithm. Keeping things simple is especially true for Node which uses the asynchronous way.</p>
<p>And yes, there was the <a href="http://www.theregister.co.uk/2016/03/23/npm_left_pad_chaos/">left-pad incident</a> but that only affected projects dependent on the public registry and the replacement was published in 11 minutes. The benefits of going small far outweigh the downsides. Also, npm has <a href="http://blog.npmjs.org/post/141905368000/changes-to-npms-unpublish-policy">changed its unpublish policy</a>, and any serious project should be using a caching strategy or a private registry (as a temporary solution).</p>
<h2 id="useasynchronouscode">Use Asynchronous Code</h2>
<p>Synchronous code <em>does</em> have a (small) place in Node. It's mostly for writing CLI commands or other scripts not related to web apps. Node developers mostly build web apps, hence they use async code to avoid blocking threads.</p>
<p>For example, this might be okay if we are just building a database script, and not a system to handle parallel/concurrent tasks:</p>
<pre><code class="javascript language-javascript">let data = fs.readFileSync('./acconts.json')
db.collection('accounts').insert(data, (results))=&gt;{
  fs.writeFileSync('./accountIDs.json', results, ()=&gt;{process.exit(1)})
})
</code></pre>
<p>But this would be better when building a web app:</p>
<pre><code class="javascript language-javascript">app.use('/seed/:name', (req, res) =&gt; {
  let data = fs.readFile(`./${req.params.name}.json`, ()=&gt;{
    db.collection(req.params.name).insert(data, (results))=&gt;{
      fs.writeFile(`./${req.params.name}IDs.json`, results, ()={res.status(201).send()})
    })
  })
})
</code></pre>
<p>The difference is whether you are writing concurrent (typically long running) or non-concurrent (short running) systems. As a rule of thumb, always write async code in Node.</p>
<h2 id="avoidblockingrequire">Avoid Blocking require</h2>
<p>Node has a simple module loading system which uses the CommonJS module format. Its built-in <code>require</code> function is an easy way to include modules that exist in separate files. Unlike AMD/requirejs, the Node/CommonJS way of module loading is synchronous. The way <code>require</code> works is: <em>you import what was exported in a module, or a file</em>.</p>
<pre><code class="javascript language-javascript">const react = require('react')
</code></pre>
<p>What most developers don't know is that <code>require</code> is cached. So, as long as there are no drastic changes to the resolved filename (and in the case of npm modules there are none), then the code from the module will be executed and loaded into the variable just once (for that process). This is a nice optimization. However, even with caching, you are better off putting your require statements first. Consider this code which only loads the <code>axios</code> module on the route which actually uses it. The <code>/connect</code> route will be slower than needed because the module import is happening when the request is made:</p>
<pre><code class="javascript language-javascript">app.post('/connect', (req, res) =&gt; {
  const axios = require('axios')
  axios.post('/api/authorize', req.body.auth)
    .then((response)=&gt;res.send(response))
})
</code></pre>
<p>A better, more performant way is to load the modules before the server is even defined, not in the route:</p>
<pre><code class="javascript language-javascript">const axios = require('axios')
const express = require('express')
app = express()
app.post('/connect', (req, res) =&gt; {
  axios.post('/api/authorize', req.body.auth)
    .then((response)=&gt;res.send(response))
})
</code></pre>
<h2 id="knowthatrequireiscached">Know That require Is Cached</h2>
<p>I mentioned that <code>require</code> is cached in the previous section, but what's interesting is that we can have code <em>outside</em> of the <code>module.exports</code>. For example,</p>
<pre><code class="javascript language-javascript">console.log('I will not be cached and only run once, the first time')

module.exports = () =&gt; {
  console.log('I will be cached and will run every time this module is invoked')
}
</code></pre>
<p>Knowing that some code might run only once, you can use this feature to your advantage.</p>
<h2 id="alwayscheckforerrors">Always Check for Errors</h2>
<p>Node is not Java. In Java, you throw errors because most of the time if there's an error you don't want the application to continue. In Java, you can handle <em>multiple</em> errors at a higher levels with a single <code>try...catch</code>.</p>
<p>Not so with Node. Since Node uses the <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">event loop</a> and executes asynchronously, any errors are separated from the context of any error handler (such as <code>try...catch</code>) when they occur. This is useless in Node:</p>
<pre><code class="javascript language-javascript">try {
  request.get('/accounts', (error, response)=&gt;{
    data = JSON.parse(response)
  })
} catch(error) {
  // Will NOT be called
  console.error(error)
}
</code></pre>
<p>But <code>try...catch</code> still can be used in synchronous Node code. So this is a better refactoring of the previous snippet:</p>
<pre><code class="javascript language-javascript">request.get('/accounts', (error, response)=&gt;{
  try {
    data = JSON.parse(response)
  } catch(error) {
    // Will be called
    console.error(error)
  }
})
</code></pre>
<p>If we cannot wrap the <code>request</code> call in a <code>try...catch</code> block, that leaves us with errors coming from request unhandled. Node developers solve this by providing you with <code>error</code> as a callback argument. Thus, you need to always manually handle the <code>error</code> in each and every callback. You do so by checking for an error (make sure it's not <code>null</code>) and then either displaying the error message to the user or a client and logging it, or passing it back up the call stack by calling the callback with <code>error</code> (if you have the callback and another function up the call stack).</p>
<pre><code class="javascript language-javascript">request.get('/accounts', (error, response)=&gt;{
  if (error) return console.error(error)
  try {
    data = JSON.parse(response)
  } catch(error) {
    console.error(error)
  }
})
</code></pre>
<p>A little trick you can use is the <a href="https://www.npmjs.com/package/okay">okay</a> library. You can apply it like this to avoid manual error check on myriads of nested callbacks (Hello, <a href="https://www.sitepoint.com/saved-from-callback-hell/">callback hell</a>).</p>
<pre><code class="javascript language-javascript">var ok = require('okay')

request.get('/accounts', ok(console.error, (response)=&gt;{
  try {
    data = JSON.parse(response)
  } catch(error) {
    console.error(error)
  }
}))
</code></pre>
<h2 id="returncallbacksoruseifelse">Return Callbacks or Use if … else</h2>
<p>Node is concurrent. So it's a feature which can turn into a bug if you are not careful. To be on the safe side terminate the execution with a return statement:</p>
<pre><code class="javascript language-javascript">let error = true
if (error) return callback(error)
console.log('I will never run - good.')
</code></pre>
<p>Avoid some unintended concurrency (and failures) due to mishandled control flow.</p>
<pre><code class="javascript language-javascript">let error = true
if (error) callback(error)
console.log('I will run. Not good!')
</code></pre>
<p>Just to be sure, <code>return</code> a callback to prevent execution from continuing.</p>
<h2 id="listentotheerrorevents">Listen to the <code>error</code> Events</h2>
<p>Almost all Node classes/objects extend the event emitter (observer pattern) and emit the <code>error</code> event. This is an opportunity for developers to catch those pesky errors and handle them before they wreak havoc.</p>
<p>Make it a good habit to create event listeners for <code>error</code> by using <code>.on()</code>:</p>
<pre><code class="javascript language-javascript">var req = http.request(options, (res) =&gt; {
  if (('' + res.statusCode).match(/^2\d\d$/)) {
    // Success, process response
  } else if (('' + res.statusCode).match(/^5\d\d$/))
    // Server error, not the same as req error. Req was ok.
  }
})

req.on('error', (error) =&gt; {
  // Can't even make a request: general error, e.g. ECONNRESET, ECONNREFUSED, HPE_INVALID_VERSION
  console.log(error)
})
</code></pre>
<h2 id="knowyournpm">Know Your npm</h2>
<p>Many Node and event front-end developers know that there is <code>--save</code> (for <code>npm install</code>) which will not only install a module but create an entry in <code>package.json</code> with the version of the module. Well, there's also <code>--save-dev</code>, for <code>devDependencies</code> (stuff you don't need in production). But did you know you can just use <code>-S</code> and <code>-D</code> instead of <code>--save</code> and <code>--save-dev</code>? Yes, you can.</p>
<p>And while you're in the module installation mode, go ahead and remove those <code>^</code> signs which <code>-S</code> and <code>-D</code> will create for you. They are dangerous because they'll allow <code>npm install</code> (or its shortcut <code>npm i</code>) to pull the latest minor (second digit in the semantic versioning) version from npm. For example, v6.1.0 to v6.2.0 is a minor release.</p>
<p>npm team believes in <a href="http://semver.org/">semver</a>, but you should not. What I mean is that they put caret <code>^</code> because they trust open source developers to not introduce breaking changes in minor releases. No one sane should trust it. Lock your versions. Even better, use <a href="https://nodejs.org/en/blog/npm/managing-node-js-dependencies-with-shrinkwrap/">shrinkwrap</a>: <code>npm shrinkwrap</code> which will create a new file with exact versions of dependencies of dependencies.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This post was part one of two. We've already covered a lot of ground, from working with callbacks and asynchronous code, to checking for errors and locking down dependencies. I hope you've found something new or useful here. If you liked it, be sure to check out part two: <a href="https://www.sitepoint.com/node-js-best-practices-from-the-node-gurus/">10 Node.js Best Practices: Enlightenment from the Node Gurus</a>.</p>
<p>And tell me what you think. Did I miss anything out? Are you doing it differently? Let me know in the comments below.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-39" name="t-39"></a><h1>39 : Function Composition: Building Blocks for Maintainable Code</h1>
					<div class="tutorial__content">
					<span>https://www.sitepoint.com/function-composition-building-blocks-for-maintainable-code/</span>
<p>One of the advantages of thinking about JavaScript in a functional way is the ability to build complex functionality using small, easy to understand individual functions. But sometimes that involves looking at a problem backwards instead of forwards in order to figure out how to create the most elegant solution.</p>
<p>In this article I'm going to employ a step-by-step approach to examine functional composition in JavaScript and demonstrate how it can result in code which is easier to reason about and which has fewer bugs.</p>
<h2 id="nestingfunctions">Nesting Functions</h2>
<div class="ArticleBox u-inline"><h3 class="ArticleBox_header t-bg">
                    <span class="ArticleBox_icon fa fa-pencil"></span> More from this author
                 </h3><div class="m-border ArticleBox_content"><ul class="ArticleBox_list"><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/functional-javascript-for-lazy-developers-like-me/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">Functional JavaScript for Lazy Developers (Like Me)</a></li><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/scrum-artifacts-product-increment/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">Scrum Artifacts: Product Increment</a></li><li class="ArticleBox_listItem"><a class="f-c-grey-500 l-b-n" href="https://www.sitepoint.com/scrum-artifacts-velocity-and-burndown-charts/?utm_source=sitepoint&amp;utm_medium=relatedinline&amp;utm_term=&amp;utm_campaign=relatedauthor">Scrum Artifacts: Velocity and Burndown Charts</a></li></ul></div></div>
<p>Composition is a technique that allows you to take two or more simple functions, and combine them into a single, more complex function that performs each of the sub functions in a logical sequence on whatever data you pass in.</p>
<p>To get this result, you nest one function inside the other, and perform the operation of the outer function on the result of the inner function repeatedly until you produce a result.  And the result can be different depending on the order in which the functions are applied.</p>
<p>This can be easily demonstrated using programming techniques we're already familiar with in JavaScript by passing a function call as an argument to another function:</p>
<pre><code class="javascript language-javascript">function addOne(x) {
  return x + 1;
}
function timesTwo(x) {
  return x * 2;
}
console.log(addOne(timesTwo(3))); //7
console.log(timesTwo(addOne(3))); //8
</code></pre>
<p>In this case we defined a function <code>addOne()</code> to add one to a value, and a <code>timesTwo()</code> function that multiplies a value by two. By passing the result of one function in as the argument for the other function, we can see how nesting one of these inside the other can produce different results, even with the same initial value. The inner function is performed first, and then the result is passed to the outer function.</p>
<h2 id="imperativecomposition">Imperative Composition</h2>
<p>If you wanted to perform the same sequence of operations repeatedly, it might be convenient to define a new function that automatically applied first one and then the other of the smaller functions. That might look something like this:</p>
<pre><code class="javascript language-javascript">// ...previous function definitions from above
function addOneTimesTwo(x) {
  var holder = x;
  holder = addOne(holder);
  holder = timesTwo(holder);
  return holder;
}
console.log(addOneTimesTwo(3)); //8
console.log(addOneTimesTwo(4)); //10
</code></pre>
<p>What we've done in this case is manually compose these two functions together in a particular order. We created a new function that first assigns the value being passed to a holder variable, then updates the value of that variable by executing the first function, and then the second function, and finally returns the value of that holder.</p>
<p>(Note that we're using a variable called <code>holder</code> to hold the value we're passing in temporarily. With such a simple function, the extra local variable may seem redundant, but even in imperative JavaScript it's a good practice to treat the value of arguments passed into a function as if they were constants. Modifying them is possible locally, but it introduces confusion about what the value of the argument is when it's called at different stages within a function.)</p>
<p>Similarly, if we wanted to create another new function that applies these two smaller functions in the opposite order, we can do something like this:</p>
<pre><code class="javascript language-javascript">// ...previous function definitions from above
function timesTwoAddOne(x) {
  var holder = x;
  holder = timesTwo(holder);
  holder = addOne(holder);
  return holder;
}
console.log(timesTwoAddOne(3)); //7
console.log(timesTwoAddOne(4)); //9
</code></pre>
<p>Of course, this code is starting to look pretty repetitive.  Our two new composed functions are almost exactly the same, except for the order in which the two smaller functions they call are executed. We need to DRY that up (as in Don't Repeat Yourself). Also, using temporary variables that change their value like this isn't very functional, even if it is being hidden inside of the composed functions we're creating.</p>
<p>Bottom line: we can do better.</p>
<h2 id="creatingafunctionalcompose">Creating a Functional Compose</h2>
<p>Let's craft a compose function that can take existing functions and compose them together in the order that we want. To do that in a consistent way without having to play with the internals every time, we have to decide on the order that we want to pass the functions in as arguments.</p>
<p>We have two choices. The arguments will each be functions, and they can either be executed left to right, or right to left. That is to say that using our proposed new function, <code>compose(timesTwo, addOne)</code> could either mean <code>timesTwo(addOne())</code> reading the arguments right to left, or <code>addOne(timesTwo())</code> reading the arguments left to right.</p>
<p>The advantage of executing the arguments left to right is that they will read the same way that English reads, much the way that we named our composed function <code>timesTwoAddOne()</code> in order to imply that the multiplication should happen before the addition. We all know the importance of logical naming to clean  readable code.</p>
<p>The disadvantage of executing the arguments from left to right is that the the values to be operated upon would have to come first. But putting the values  first makes it less convenient to  compose the resulting function with other functions in the future. For a good explanation of the thinking behind this logic, you can't beat Brian Lonsdorf's classic video <a href="https://www.youtube.com/watch?v=m3svKOdZijA">Hey Underscore, You're Doing it Wrong</a>. (Although it should be noted that there is now <a href="https://github.com/stoeffel/underscore.string.fp">an fp option for Underscore</a> that helps to address the functional programming issue Brian discusses when using Underscore in concert with a functional programming library such as <a href="https://github.com/lodash/lodash-fp">lodash-fp</a> or <a href="http://ramdajs.com/">Ramda</a>.)</p>
<p>In any event, what we really want to do is pass in all of the configuration data first, and pass the value(s) to be operated on last. Because of this, it makes the most sense to define our compose function to read in its arguments and apply them from right to left.</p>
<p>So we can create a rudimentary <code>compose</code> function that looks something like this:</p>
<pre><code class="javascript language-javascript">function compose(f1, f2) {
  return function(value) {
    return f1(f2(value));
  };
}
</code></pre>
<p>Using this very simple <code>compose</code> function, we can construct both of our previous complex functions much more simply, and see that the results are the same:</p>
<pre><code class="javascript language-javascript">function addOne(x) {
  return x + 1;
}
function timesTwo(x) {
  return x * 2;
}
function compose(f1, f2) {
  return function(value) {
    return f1(f2(value));
  };
}
var addOneTimesTwo = compose(timesTwo, addOne);
console.log(addOneTimesTwo(3)); //8
console.log(addOneTimesTwo(4)); //10
var timesTwoAddOne = compose(addOne, timesTwo);
console.log(timesTwoAddOne(3)); //7
console.log(timesTwoAddOne(4)); //9
</code></pre>
<p>While this simple <code>compose</code> function works, it doesn't take into account a number of issues that limit its flexibility and applicability. For example, we might want to compose more than two functions. Also, we lose track of <code>this</code> along the way.</p>
<p>We could fix these problems, but it's not necessary in order to grasp how composition works. Rather than roll our own, it's probably more productive to inherit a more robust <code>compose</code> from one of the functional libraries out there, such as <a href="http://ramdajs.com/docs/#compose">Ramda</a>, which does account for right to left ordering of arguments by default.</p>
<h2 id="typesareyourresponsibility">Types Are Your Responsibility</h2>
<p>It's important to keep in mind that it is the responsibility of the programmer to know the type returned by each of the functions being composed, so it can be handled correctly by the next function. Unlike purely functional programming languages that do strict type checking, JavaScript won't prevent you from trying to compose functions that return values of inappropriate types.</p>
<p>You're not limited to passing numbers, and you're not even limited to maintaining the same type of variable from one function to the next. But you are responsible for making sure that the functions you are composing are prepared to deal with whatever value the previous function returns.</p>
<h2 id="consideryouraudience">Consider Your Audience</h2>
<p>Always remember that someone else may need to use or modify your code in the future. Using composition inside traditional JavaScript code can appear complicated to programmers not familiar with functional paradigms. the goal is cleaner code that's easier to read and maintain.</p>
<p>But with the advent of ES2015 syntax, the creation of a simple composed function as a one-line call can even be done without a special <code>compose</code> method using arrow functions:</p>
<pre><code class="javascript language-javascript">function addOne(x) {
  return x + 1;
}
function timesTwo(x) {
  return x * 2;
}
var addOneTimesTwo = x =&gt; timesTwo(addOne(x));
console.log(addOneTimesTwo(3)); //8
console.log(addOneTimesTwo(4)); //10
</code></pre>
<h2 id="startcomposingtoday">Start Composing Today</h2>
<p>As with all functional programming techniques, it's important to keep in mind that your composed functions should be pure. In a nutshell this means that every time a specific value is passed into a function, the function should return the same result, and the function should not produce side effects that alter values outside of itself.</p>
<p>Compositional nesting can be very convenient when you have a set of related functionality that you want to apply to your data, and you can break down the components of that functionality into reusable and easily composed functions.</p>
<p>As with all functional programming techniques, I recommend sprinkling composition judiciously into your existing code to get familiar with it. If you're doing it right, the result will be cleaner, dryer, and more readable code. And isn't that what we all want?</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-40" name="t-40"></a><h1>40 : Creating Unwritable Properties with Object.defineProperty</h1>
					<div class="tutorial__content">
					<span>http://adripofjavascript.com/blog/drips/creating-unwritable-properties-with-object-defineproperty.html</span>
<div class="post">
        <h1 class="post-title">Creating Unwritable Properties with Object.defineProperty</h1>
        
            <p><i>
                Originally published in the 
                <a href="/">A Drip of JavaScript newsletter</a>.
            </i></p>
        

        <p>JavaScript has a reputation as a language where the developer can redefine just about anything. While that has been largely true in past versions of JavaScript, with ECMAScript 5 the situation has begun to change. For instance, thanks to <code>Object.defineProperty</code> it is now possible to create object properties that cannot be modified.</p>

<p>Why would you want to do that? Imagine that you are building a mathematics library.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">principia</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">constants</span><span class="o">:</span> <span class="p">{</span>
	<span class="c1">// Pi is used here for convenience of illustration.</span>
        <span class="c1">// For real applications, you'd want to use Math.PI</span>
        <span class="nx">pi</span><span class="o">:</span> <span class="mf">3.14</span>
    <span class="p">},</span>
    <span class="nx">areaOfCircle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">radius</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">pi</span> <span class="o">*</span> <span class="nx">radius</span> <span class="o">*</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>Your library provides a collection of common equations, but for convenience also defines a set of mathematical constants. Of course, the thing about constants is that they should remain constant and shouldn't be redefined. But suppose a user of your library accidentally does something like this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Accidental assignment</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">principia</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">pi</span> <span class="o">=</span> <span class="nx">myval</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something</span>
<span class="p">}</span>
</code></pre></div>
<p>The user has accidentally assigned a value to <code>pi</code>. Suddenly every equation in your library that depends on <code>pi</code> will return incorrect results. This will likely lead the user to believe your library is defective rather than discovering the error in their code. While there are multiple ways to avoid this issue, the simplest solution is just to make <code>pi</code> unwritable. Let's take a look at how to do that.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">principia</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">constants</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">areaOfCircle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">radius</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">pi</span> <span class="o">*</span> <span class="nx">radius</span> <span class="o">*</span> <span class="nx">radius</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">principia</span><span class="p">.</span><span class="nx">constants</span><span class="p">,</span> <span class="s2">"pi"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mf">3.14</span><span class="p">,</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">});</span>
</code></pre></div>
<p>The <code>defineProperty</code> method takes three arguments: the object whose property you are creating or modifying, the name of the property, and an options object. The options object itself allows us to set several options, but for the moment we are only interested in <code>value</code> and <code>writable</code>.</p>

<p>The <code>value</code> option defines what the actual value of our property will be, while <code>writable</code> specifies whether we can assign a new value to it. So let's see how it works.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Try to assign a new value to pi</span>
<span class="nx">principia</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">pi</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// Outputs: 3.14</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">principia</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">pi</span><span class="p">);</span>
</code></pre></div>
<p>As you can see, attempting to assign a new value to <code>pi</code> fails silently and <code>pi</code> retains its original value. So now a mistake by a careless library user won't cause problems with the library itself.</p>

<p>And if the user of your library is in strict mode, it gets better.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Turn on strict mode</span>
<span class="s2">"use strict"</span><span class="p">;</span>

<span class="c1">// TypeError: Cannot assign to read only property 'pi' of principia.constants</span>
<span class="nx">principia</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">pi</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div>
<p>Strict mode will throw an error if you attempt to assign a new value to unwritable properties, which means that errors like the one illustrated above would get flagged immediately.</p>

<p>There are two more aspects of <code>defineProperty</code> that you'll need to understand to use it effectively.</p>

<p>While in our example above, we explicity set <code>writable</code>, it turns out that <code>writable</code> defaults to false, so our earlier example can be rewritten like so.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">principia</span><span class="p">.</span><span class="nx">constants</span><span class="p">,</span> <span class="s2">"pi"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mf">3.14</span>
<span class="p">});</span>
</code></pre></div>
<p>In addition there is another option called <code>configurable</code> which specifies whether you can use <code>defineProperty</code> and similar methods to reconfigure things like <code>writable</code> to a different state. The <code>configurable</code> option defaults to <code>false</code>, so if you want to let users of your library override <code>pi</code> intentionally, but not through accidental assignment, you would need to explicitly set it to <code>true</code>, like so:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">principia</span><span class="p">.</span><span class="nx">constants</span><span class="p">,</span> <span class="s2">"pi"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="mf">3.14</span><span class="p">,</span>
    <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>
</code></pre></div>
<p>There is one rather large "gotcha" to be aware of when using <code>defineProperty</code>. While setting <code>writable</code> prevents assignment to the property, it does not make the property's value immutable. Consider the case of an array:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="s2">"arr"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">writable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span>
<span class="p">});</span>

<span class="nx">container</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"new array"</span><span class="p">];</span>

<span class="c1">// Outputs: ["a", "b"]</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">arr</span><span class="p">);</span>

<span class="nx">container</span><span class="p">.</span><span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">"new value"</span><span class="p">);</span>

<span class="c1">// Outputs: ["a", "b", "new value"]</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">arr</span><span class="p">);</span>
</code></pre></div>
<p>The <code>arr</code> property is unwritable, so it will always point to the same array. But the array itself may be changed. Unless you use a value that is intrinsically immutable (like a string primitive), the property's value is still subject to change. We'll consider a way of locking down arrays and other objects in a future issue.</p>

<p>Unfortunately, because <code>Object.defineProperty</code> is part of ES5, it is only fully supported in IE9 and newer. IE8 has a partial implementation which only works on DOM objects, and would be useless for the examples considered above. Even more unfortunately, there is no compatibility shim for IE8. However, if you don't need to deal with older browsers, <code>defineProperty</code> might be just what you are looking for.</p>

<p>Thanks for reading!</p>

<p>Joshua Clanton</p>

    </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-41" name="t-41"></a><h1>41 : Advanced objects in JavaScript</h1>
					<div class="tutorial__content">
					<span>http://bjorn.tipling.com/advanced-objects-in-javascript</span>
<p>This posts looks beyond everyday usage of JavaScript's objects.  The fundamentals of JavaScripts objects are for the most part about as simple as using JSON notation. However, JavaScript also provides sophisticated tools to create objects in interesting and useful ways, many of which are now available in the latest versions of modern browsers.</p>

<p>The last two topics I talk about, <code class="prettyprint">Proxy</code> and <code class="prettyprint">Symbol</code>, are based on the ECMAScript 6 specification and are only partially implemented and of limited availability across browsers.</p>
<h2 id="getters-and-setters_2"><a class="head_anchor" href="#getters-and-setters_2">&nbsp;</a>getters and setters</h2>
<p>Getters and setters have been available in JavaScript for some time now but I have not found myself using them much. I often fallback to writing regular functions to get properties. I usually end up writing something like this:</p>

<pre><code class="prettyprint">/**
 * @param {string} prefix
 * @constructor
 */
function Product(prefix) {
  /**
   * @private
   * @type {string}
   */
  this.prefix_ = prefix;
  /**
   * @private
   * @type {string}
   */
  this.type_ = "";
}

/**
 * @param {string} newType
 */
Product.prototype.setType = function (newType) {
  this.type_ = newType;
};

/**
 * @return {string}
 */
Product.prototype.type = function () {
  return this.prefix_ + ": " + this.type_;
}

var product = new Product("fruit");
product.setType("apple");
console.log(product.type());  //logs fruit: apple
</code></pre>



<p>Using a getter I could simplify this code.</p>

<pre><code class="prettyprint">/**
 * @param {string} prefix
 * @constructor
 */
function Product(prefix) {
  /**
   * @private
   * @type {number}
   */
  this.prefix_ = prefix;
  /**
   * @private
   * @type {string}
   */
  this.type_ = "";
}

/**
 * @param {string} newType
 */
Product.prototype = {
    /**
     * @return {string}
     */
    get type () {
      return this.prefix_ + ": " + this.type_;
    },
    /**
     * @param {string}
     */
    set type (newType) {
      this.type_ = newType;
    }
};

var product = new Product("fruit");

product.type = "apple";
console.log(product.type); //logs "fruit: apple"

console.log(product.type = "orange");  //logs "orange"
console.log(product.type); //logs "fruit: orange"
</code></pre>



<p>The code is still a bit verbose and the syntax is a bit unusual but the benefit of <code class="prettyprint">get</code> and <code class="prettyprint">set</code> is realized in using the property. Personally I find something like</p>

<pre><code class="prettyprint">product.type = "apple";
console.log(product.type);
</code></pre>

<p>a lot more readable and accessible than </p>

<pre><code class="prettyprint">product.setType("apple");
console.log(product.type());
</code></pre>

<p>Although directly accessing and setting properties on instances still sets off my internal <em>bad-javascript</em> buzzer. Over time I have been trained by bugs and technical debt to avoid arbitrarily setting values on instances as a means to pass information around. Also, a particular caveat is in order for the return value of an assignment. Note this bit of code in the example above:</p>

<pre><code class="prettyprint">console.log(product.type = "orange");  //logs "orange"
console.log(product.type); //logs "fruit: orange"
</code></pre>

<p>Notice that "orange" is logged at first and then "fruit: orange" on the next line. The getter isn't executed on the return value from assigning to a property, so this kind of shortcut where you return the value from an assignment could get you into trouble here. Return statements on a <code class="prettyprint">set</code> are ignored. Adding <code class="prettyprint">return this.type;</code> to the <code class="prettyprint">set</code> wont fix this problem. Usually reusing the value of an assignment would work, but you may have problems with a property that has a getter.</p>

<hr>
<h2 id="defineproperty_2"><a class="head_anchor" href="#defineproperty_2">&nbsp;</a>defineProperty</h2>
<p>The <code class="prettyprint">get propertyname ()</code> syntax works on object literals and in the previous example I assigned an object literal to <code class="prettyprint">Product.prototype</code>. This is OK, but using object literals like this makes it harder to chain prototypes to get inheritance. You can create getters and setters on a <code class="prettyprint">prototype</code> without an object literal using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"><code class="prettyprint">defineProperty</code></a>.</p>

<pre><code class="prettyprint">/**
 * @param {string} prefix
 * @constructor
 */
function Product(prefix) {
  /**
   * @private
   * @type {number}
   */
  this.prefix_ = prefix;
  /**
   * @private
   * @type {string}
   */
  this.type_ = "";
}

/**
 * @param {string} newType
 */
Object.defineProperty(Product.prototype, "type", {
  /**
   * @return {string}
     */
  get: function () {
      return this.prefix_ + ": " + this.type_;
  },
  /**
   * @param {string}
  */
  set: function (newType) {
    this.type_ = newType;
  }
});
</code></pre>



<p>This code behaves the same as the previous example.  There's more to <code class="prettyprint">defineProperty</code> than adding getters or setters. The third argument to <code class="prettyprint">defineProperty</code> is called the descriptor and in addition to <code class="prettyprint">set</code> and <code class="prettyprint">get</code> it allows you to customize the property's accessibility and set a value. You could use the descriptor argument to <code class="prettyprint">defineProperty</code> to create something like a constant that can never be modified or removed.</p>

<pre><code class="prettyprint">var obj = {
    foo: "bar",
};


//A normal object property
console.log(obj.foo); //logs "bar"

obj.foo = "foobar";
console.log(obj.foo); //logs "foobar"

delete obj.foo;
console.log(obj.foo); //logs undefined


Object.defineProperty(obj, "foo", {
    value: "bar",
});

console.log(obj.foo); //logs "bar", we were able to modify foo

obj.foo = "foobar";
console.log(obj.foo); //logs "bar", write failed silently

delete obj.foo;
console.log(obj.foo); //logs bar, delete failed silently
</code></pre>

<p><a href="http://jsfiddle.net/btipling/mohb4fx2/46/">jsfiddle</a></p>

<p>The result is:</p>

<pre><code class="prettyprint">bar
foobar
undefined
bar 
bar
bar 
</code></pre>

<p>The last 2 attempts to modify <code class="prettyprint">foo.bar</code> in the example failed silently as the default behavior of <code class="prettyprint">defineProperty</code> is to prevent further changes. You can use <code class="prettyprint">configurable</code> and <code class="prettyprint">writable</code> to change this behavior. If you are using strict mode the failures are not silent, <a href="http://jsfiddle.net/btipling/mohb4fx2/27/">they are JavaScript errors</a>. </p>

<pre><code class="prettyprint">var obj = {};

Object.defineProperty(obj, "foo", {
    value: "bar",
    configurable: true,
    writable: true,
});

console.log(obj.foo); //logs "bar"
obj.foo = "foobar";
console.log(obj.foo); //logs "foobar"
delete obj.foo;
console.log(obj.foo); //logs undefined
</code></pre>


<p>The <code class="prettyprint">configurable</code> key allows you to prevent the property from being deleted from the object.  It also allows you to prevent the property from being modified in the future with another call to<code class="prettyprint">defineProperty</code> later. The <code class="prettyprint">writable</code> key enables you to write to the property and change its value.</p>

<p>If <code class="prettyprint">configurable</code> is <code class="prettyprint">false</code> as is the default case, attempting to call <code class="prettyprint">defineProperty</code> a second time will result in a JavaScript error, it does not fail silently. </p>

<pre><code class="prettyprint">var obj = {};

Object.defineProperty(obj, "foo", {
    value: "bar",
});


Object.defineProperty(obj, "foo", {
    value: "foobar",
});

// Uncaught TypeError: Cannot redefine property: foo 
</code></pre>



<p>If <code class="prettyprint">configurable</code> is set to <code class="prettyprint">true</code> you can modify the property again later. You might use that to change the value on a non-writable property.</p>

<pre><code class="prettyprint">var obj = {};

Object.defineProperty(obj, "foo", {
    value: "bar",
    configurable: true,
});

obj.foo = "foobar";

console.log(obj.foo); // logs "bar", write failed

Object.defineProperty(obj, "foo", {
    value: "foobar",
    configurable: true,
});

console.log(obj.foo); // logs "foobar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/mohb4fx2/12/">jsfilddle</a>;</p>

<p>Also note that values defined by <code class="prettyprint">defineProperty</code> are by default not iterated over in a <code class="prettyprint">for in</code> loop:</p>

<pre><code class="prettyprint">var i, inventory;

inventory = {
    "apples": 10,
    "oranges": 13,
};

Object.defineProperty(inventory, "strawberries", {
    value: 3,
});

for (i in inventory) {
    console.log(i, inventory[i]);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/mohb4fx2/13/">jsfiddle</a></p>

<pre><code class="prettyprint">apples 10 
oranges 13 
</code></pre>

<p>Use the <code class="prettyprint">enumerable</code> key to allow this:</p>

<pre><code class="prettyprint">var i, inventory;

inventory = {
    "apples": 10,
    "oranges": 13,
};

Object.defineProperty(inventory, "strawberries", {
    value: 3,
    enumerable: true,
});

for (i in inventory) {
    console.log(i, inventory[i]);
}
</code></pre>


<p>Outcome:</p>

<pre><code class="prettyprint">apples 10
oranges 13
strawberries 3 
</code></pre>

<p>You can use <code class="prettyprint">isPropertyEnumerable</code> to test whether a property will appear in a <code class="prettyprint">for in</code> loop:</p>

<pre><code class="prettyprint">var i, inventory;

inventory = {
    "apples": 10,
    "oranges": 13,
};

Object.defineProperty(inventory, "strawberries", {
    value: 3,
});

console.log(inventory.propertyIsEnumerable("apples")); //console logs true
console.log(inventory.propertyIsEnumerable("strawberries")); //console logs false
</code></pre>

<p><a href="http://jsfiddle.net/btipling/mohb4fx2/21/">jsfilddle</a></p>

<p><code class="prettyprint">propertyIsEnumerable</code> will also return false for properties defined further up an object's <code class="prettyprint">prototype</code> chain or for properties that aren't otherwise defined on the object, obviously.</p>

<p>Finally, a last couple points about using <code class="prettyprint">defineProperty</code>: <a href="http://jsfiddle.net/btipling/mohb4fx2/17/">It is an error</a> to combine the accessors <code class="prettyprint">set</code> and <code class="prettyprint">get</code> with <code class="prettyprint">writable</code> set to true or to combine them with a <code class="prettyprint">value</code>. Defining a property as a number simply <a href="http://jsfiddle.net/btipling/mohb4fx2/23/">converts the number into a string</a> just as it would in any other circumstance. You can also use <code class="prettyprint">defineProperty</code> to <a href="http://jsfiddle.net/vcqjrcnc/2/">set <code class="prettyprint">value</code> to be a function</a>.</p>

<hr>
<h2 id="defineproperties_2"><a class="head_anchor" href="#defineproperties_2">&nbsp;</a>defineProperties</h2>
<p>Also <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties"><code class="prettyprint">Object.defineProperties</code></a> exists. It allows you to define multiple properties in a single go. I found <a href="http://jsperf.com/defineproperty-vs-defineproperties">a jsperf that compared the performance of  <code class="prettyprint">defineProperty</code> versus <code class="prettyprint">defineProperties</code></a> and in Chrome at least it didn't seem to matter much which was used.</p>

<pre><code class="prettyprint">var foo = {}

Object.defineProperties(foo, {
    bar: {
        value: "foo",
        writable: true,
    },
    foo: {
        value: function() {
           console.log(this.bar);
        }
    },
});

foo.bar = "foobar";
foo.foo();  //logs "foobar"
</code></pre>

<hr>
<h2 id="objectcreate_2"><a class="head_anchor" href="#objectcreate_2">&nbsp;</a>Object.create</h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create"><code class="prettyprint">Object.create</code></a> is an alternative to <code class="prettyprint">new</code> that lets you create an object with a given prototype. This function has two arguments, the first is the prototype you want use for the newly created object, the second argument is a property descriptor and it takes the same form as you would give to <code class="prettyprint">Object.defineProperties</code>.</p>

<pre><code class="prettyprint">var prototypeDef = {
    protoBar: "protoBar",
    protoLog: function () {
        console.log(this.protoBar);
    }
};
var propertiesDef = {
    instanceBar: {
        value: "instanceBar"
    },
    instanceLog: {
        value: function () {
            console.log(this.instanceBar);
        }
    }
}

var foo = Object.create(prototypeDef, propertiesDef);
foo.protoLog(); //logs "protoBar"
foo.instanceLog(); //logs "instanceBar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/pqdcxnep/">jsfiddle</a></p>

<p>Properties created in the properties descriptor argument to <code class="prettyprint">Object.create</code> overwrite the values in the prototype argument:</p>

<pre><code class="prettyprint">var prototypeDef = {
    bar: "protoBar",
};
var propertiesDef = {
    bar: {
        value: "instanceBar",
    },
    log: {
        value: function () {
            console.log(this.bar);
        }
    }
}

var foo = Object.create(prototypeDef, propertiesDef);
foo.log(); //logs "instanceBar"
</code></pre>


<p>Setting a non-primitive type like an Array or Object as a defined properties value in <code class="prettyprint">Object.create</code> is probably a mistake since you will create a single instance shared by all created objects:</p>

<pre><code class="prettyprint">var prototypeDef = {
    protoArray: [],
};
var propertiesDef = {
    propertyArray: {
        value: [],
    }
}

var foo = Object.create(prototypeDef, propertiesDef);
var bar = Object.create(prototypeDef, propertiesDef);

foo.protoArray.push("foobar");
console.log(bar.protoArray); //logs ["foobar"] 
foo.propertyArray.push("foobar");
console.log(bar.propertyArray); //also logs ["foobar"] 
</code></pre>

<p><a href="http://jsfiddle.net/btipling/pqdcxnep/4/">jsfiddle</a></p>

<p>You could fix this problem by initialize the value of <code class="prettyprint">propertyArray</code> with <code class="prettyprint">null</code> and then add the array when you needed, or you could do something fancy like this using a getter:</p>

<pre><code class="prettyprint">var prototypeDef = {
    protoArray: [],
};
var propertiesDef = {
    propertyArrayValue_: {
        value: null,
        writable: true
    },
    propertyArray: {
        get: function () {
            if (!this.propertyArrayValue_) {
                this.propertyArrayValue_ = [];
            }
            return this.propertyArrayValue_;
        }
    }
}

var foo = Object.create(prototypeDef, propertiesDef);
var bar = Object.create(prototypeDef, propertiesDef);

foo.protoArray.push("foobar");
console.log(bar.protoArray); //logs ["foobar"] 
foo.propertyArray.push("foobar");
console.log(bar.propertyArray); //logs [] 
</code></pre>



<p>This is a neat way to combine initialization of properties with their definitions. I think I prefer keeping property definitions with initialization together a great deal over doing this work in a constructor. In the past I often ended up writing a giant constructor method full of such initialization code. </p>

<p>The previous example demonstrates that you have to remember that the expressions provided to any <code class="prettyprint">value</code>  in an <code class="prettyprint">Object.create</code> property descriptor is evaluated when the property descriptor object is defined. That is why the array was shared across instances. I also recommend never depending on a fixed order for when multiple properties are evaluated in a single call. If you really wanted to initialize one property before the other perhaps just use <code class="prettyprint">Object.defineProperty</code> in that instance.</p>

<p>Since using <code class="prettyprint">Object.create</code> does not involve a constructor function you lose the ability to use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/instanceof"><code class="prettyprint">instanceof</code></a> to test Object identity. Instead use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isPrototypeOf"><code class="prettyprint">isPrototypeOf</code></a> which is checked against the <code class="prettyprint">prototype</code> object. This would be MyFunction.prototype in the case of a constructor, or the object provided to the first argument of <code class="prettyprint">Object.create</code>.  </p>

<pre><code class="prettyprint">function Foo() {
}

var prototypeDef = {
    protoArray: [],
};
var propertiesDef = {
    propertyArrayValue_: {
        value: null,
        writable: true
    },
    propertyArray: {
        get: function () {
            if (!this.propertyArrayValue_) {
                this.propertyArrayValue_ = [];
            }
            return this.propertyArrayValue_;
        }
    }
}

var foo1 = new Foo();

//old way using instanceof works with constructors
console.log(foo1 instanceof Foo); //logs true

//You check against the prototype object, not the constructor function
console.log(Foo.prototype.isPrototypeOf(foo1)); //true

var foo2 = Object.create(prototypeDef, propertiesDef);

//can't use instanceof with Object.create, test against prototype object...
//...given as first agument to Object.create
console.log(prototypeDef.isPrototypeOf(foo2)); //true
</code></pre>

<p><a href="http://jsfiddle.net/btipling/pqdcxnep/6/">jsfiddle</a></p>

<p><code class="prettyprint">isPrototypeOf</code> will walk down the prototype chain and return <code class="prettyprint">true</code> if any prototype matches the prototype object tested against.</p>

<pre><code class="prettyprint">var foo1Proto = {
    foo: "foo",
};

var foo2Proto = Object.create(foo1Proto);
foo2Proto.bar = "bar";

var foo = Object.create(foo2Proto);

console.log(foo.foo, foo.bar); //logs "foo bar"
console.log(foo1Proto.isPrototypeOf(foo)); // logs true
console.log(foo2Proto.isPrototypeOf(foo)); // logs true
</code></pre>

<h2 id="sealing-objects-freezing-them-and-preventing_2"><a class="head_anchor" href="#sealing-objects-freezing-them-and-preventing_2">&nbsp;</a>sealing objects, freezing them and preventing extensibility</h2>
<p>Adding arbitrary properties to random objects and instances, just because you can, has always been at the very least a code smell. With modern browsers and in node.js it is possible to restrict changes to an entire object in addition to restricting individual properties of an object via <code class="prettyprint">defineProperty</code>. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions"><code class="prettyprint">Object.preventExtensions</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/seal"><code class="prettyprint">Object.seal</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze"><code class="prettyprint">Object.freeze</code></a> each in turn add increasingly stricter restrictions on an object. In strict mode violating restrictions placed by these methods will result in JavaScript errors, otherwise they fail silently.</p>

<p><code class="prettyprint">Object.preventExtensions</code> will prevent new properties from being added to an object. It will not prevent changes to existing writable properties, and it will not prevent deletion of configurable properties. <code class="prettyprint">Object.preventExtensions</code> will also not remove the ability to call <code class="prettyprint">Object.defineProperty</code> to modify existing properties.</p>

<pre><code class="prettyprint">var obj = {
    foo: "foo",
};

obj.bar = "bar";
console.log(obj); // logs Object {foo: "foo", bar: "bar"} 

Object.preventExtensions(obj);

delete obj.bar;
console.log(obj); // logs Object {foo: "foo"} 

obj.bar = "bar";
console.log(obj); // still logs Object {foo: "foo"} 

obj.foo = "foobar"
console.log(obj); // logs {foo: "foobar"} can still change values
</code></pre>


<p><em>(note you should run the previous jsfiddle with web inspector open at the start or refresh because logging objects with it closed may result in the console showing only the final form the object takes)</em></p>

<p><code class="prettyprint">Object.seal</code> goes further than <code class="prettyprint">Object. preventExtensions</code>. In addition to preventing new properties from being added to an object, this function also prevents further configurability and removes the ability to delete properties.  Once an object has been sealed, you can no longer modify existing properties with <code class="prettyprint">defineProperty</code>. As previously mentioned if you try to violate restrictions in strict mode the result will be a JavaScript error.</p>

<pre><code class="prettyprint">"use strict"; 

var obj = {};

Object.defineProperty(obj, "foo", {
    value: "foo"
});

Object.seal(obj);

//Uncaught TypeError: Cannot redefine property: foo 
Object.defineProperty(obj, "foo", {
    value: "bar"
});
</code></pre>

<p><a href="http://jsfiddle.net/btipling/dwyuz997/6/">jsfiddle</a></p>

<p>You can also not remove properties anymore, even if they were initially configurable. You can still change the values of properties.</p>

<pre><code class="prettyprint">"use strict"; 

var obj = {};

Object.defineProperty(obj, "foo", {
    value: "foo",
    writable: true,
    configurable: true,
});

Object.seal(obj);

console.log(obj.foo); //logs "foo"
obj.foo = "bar";
console.log(obj.foo); //logs "bar"
delete obj.foo; //TypeError, cannot delete
</code></pre>

<p><a href="http://jsfiddle.net/btipling/dwyuz997/9/">jsfiddle</a></p>

<p>Finally, <code class="prettyprint">Object.freeze</code> makes an object entirely immutable. You cannot add, remove, or change the values of properties on frozen objects. You can also no longer use <code class="prettyprint">Object.defineProperty</code> on the object to change the values of existing properties.</p>

<pre><code class="prettyprint">"use strict"; 

var obj = {
    foo: "foo1"
};

Object.freeze(obj);

//All of the following will fail, and result in errors in strict mode
obj.foo = "foo2"; //cannot change values
obj.bar = "bar"; //cannot add a property
delete obj.bar; //cannot delete a property
//cannot call defineProperty on a frozen object
Object.defineProperty(obj, "foo", {
    value: "foo2"
});
</code></pre>


<p>Methods are provided to allow you to test if objects are frozen, sealed or not extensible: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isFrozen"><code class="prettyprint">Object.isFrozen</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isSealed"><code class="prettyprint">Object.isSealed</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/isExtensible"><code class="prettyprint">Object.isExtensible</code></a>.</p>

<hr>
<h2 id="valueof-and-tostring_2"><a class="head_anchor" href="#valueof-and-tostring_2">&nbsp;</a>valueOf and toString</h2>
<p>You can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf"><code class="prettyprint">valueOf</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString"><code class="prettyprint">toString</code></a> to customize how an object you have defined behaves in contexts where JavaScripts expects a primitive value.</p>

<p>Here's an example using <code class="prettyprint">toString</code>:</p>

<pre><code class="prettyprint">function Foo (stuff) {
    this.stuff = stuff;
}

Foo.prototype.toString = function () {
    return this.stuff;
}


var f = new Foo("foo");
console.log(f + "bar"); //logs "foobar"
</code></pre>


<p>And here's an example using <code class="prettyprint">valueOf</code>:</p>

<pre><code class="prettyprint">function Foo (stuff) {
    this.stuff = stuff;
}

Foo.prototype.valueOf = function () {
    return this.stuff.length;
}

var f = new Foo("foo");
console.log(1 + f); //logs 4 (length of "foo" + 1);
</code></pre>


<p>If you combine both <code class="prettyprint">toString</code> and <code class="prettyprint">valueOf</code> you may get unexpected results.</p>

<pre><code class="prettyprint">function Foo (stuff) {
    this.stuff = stuff;
}

Foo.prototype.valueOf = function () {
    return this.stuff.length;
}

Foo.prototype.toString = function () {
    return this.stuff;
}

var f = new Foo("foo");
console.log(f + "bar"); //logs "3bar" instead of "foobar"
console.log(1 + f); //logs 4 (length of "foo" + 1);
</code></pre>


<p>A neat way to use toString might be to make your object hashable:</p>

<pre><code class="prettyprint">function Foo (stuff) {
    this.stuff = stuff;
}

Foo.prototype.toString = function () {
    return this.stuff;
}

var f = new Foo("foo");

var obj = {};
obj[f] = true;
console.log(obj); //logs {foo: true}
</code></pre>


<hr>
<h1 id="getownpropertynames-and-keys_1"><a class="head_anchor" href="#getownpropertynames-and-keys_1">&nbsp;</a>getOwnPropertyNames and keys</h1>
<p>You can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames"><code class="prettyprint">Object.getOwnPropertyNames</code></a> to get all the properties defined on an object.  If you're familiar with Python, it is basically analogous to a Python dictionary's <code class="prettyprint">keys</code> method, and there actually is an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys"><code class="prettyprint">Object.keys</code></a> method as well. The difference between <code class="prettyprint">Object.keys</code> and <code class="prettyprint">Object.getOwnPropertyNames</code> is that the latter also iterates over property names that are not enumberable, that is <code class="prettyprint">Object.getOwnPropertyNames</code> will also return property names that are not iterated over in a <code class="prettyprint">for in</code> loop.</p>

<pre><code class="prettyprint">var obj = {
    foo: "foo",
};

Object.defineProperty(obj, "bar", {
    value: "bar"
});

console.log(Object.getOwnPropertyNames(obj)); //logs ["foo", "bar"]
console.log(Object.keys(obj));  //logs ["foo"]
</code></pre>


<h2 id="symbol_2"><a class="head_anchor" href="#symbol_2">&nbsp;</a>Symbol</h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol"><code class="prettyprint">Symbol</code></a> is a special new primitive type defined in ECMAScrpt 6 harmony and will be available in the next iteration of JavaScript. You can already start using it in <a href="http://www.google.com/intl/en/chrome/browser/canary.html">Chrome Canary</a> and <a href="https://nightly.mozilla.org/">Firefox Nightly</a> and the following jsfiddle examples will only work in these two browsers, at least at the time of writing this post, August 2014.</p>

<p>Symbols can be used as way to create and reference properties on objects. </p>

<pre><code class="prettyprint">var obj = {};

var foo = Symbol("foo");

obj[foo] = "foobar";

console.log(obj[foo]); //logs "foobar"
</code></pre>



<p>Symbols are unique and immutable.</p>

<pre><code class="prettyprint">//console logs false, symbols are unique:
console.log(Symbol("foo") === Symbol("foo"));
</code></pre>



<p>You can also use symbols with <code class="prettyprint">Object.defineProperty</code>:</p>

<pre><code class="prettyprint">var obj = {};

var foo = Symbol("foo");

Object.defineProperty(obj, foo, {
    value: "foobar",
});

console.log(obj[foo]); //logs "foobar"
</code></pre>


<p>Properties added to objects with symbols will not be iterated over in a <code class="prettyprint">for in</code> loop, but calling <code class="prettyprint">hasOwnProperty</code> will work fine:</p>

<pre><code class="prettyprint">var obj = {};

var foo = Symbol("foo");

Object.defineProperty(obj, foo, {
    value: "foobar",
});

console.log(obj.hasOwnProperty(foo)); //logs true
</code></pre>



<p>Symbols will not appear in the returned array from a call to <code class="prettyprint">Object.getOwnPropertyNames</code> but there is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols"><code class="prettyprint">Object. getOwnPropertySymbols</code></a>.</p>

<pre><code class="prettyprint">var obj = {};

var foo = Symbol("foo");

Object.defineProperty(obj, foo, {
    value: "foobar",
});

//console logs []
console.log(Object.getOwnPropertyNames(obj));

//console logs [Symbol(foo)]
console.log(Object.getOwnPropertySymbols(obj));
</code></pre>


<p>Symbols could be handy in the case where you want to not only prevent a property from being accidentally modified, but you don't  even want it to show up in the normal course of business. I haven't really thought through all the potential use cases, but I think I can think of more.</p>

<hr>
<h2 id="proxy_2"><a class="head_anchor" href="#proxy_2">&nbsp;</a>Proxy</h2>
<p>Another new ECMAScript 6 addition is <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"><code class="prettyprint">Proxy</code></a>. As of August 2014, proxies only work in Firefox. The following jsfiddle example will only work in Firefox, and I actually tested it using Firefox beta because that is what I have installed.</p>

<p>Proxies are exciting to me because it allows for the creation of catch all properties.  Check out the following example:</p>

<pre><code class="prettyprint">var obj = {
    foo: "foo",
};
var handler = {
    get: function (target, name) {
        if (target.hasOwnProperty(name)) {
            return target[name];
        }
        return "foobar";
    },
};
var p = new Proxy(obj, handler);
console.log(p.foo); //logs "foo"
console.log(p.bar);  //logs "foobar"
console.log(p.asdf); //logs "foobar"
</code></pre>


<p><a href="http://jsfiddle.net/btipling/d4he6u4t/4/">jsfiddle</a> <em>(Firefox only)</em></p>

<p>In this example we are proxying object <code class="prettyprint">obj</code>. We define a <code class="prettyprint">handler</code> object that handles interaction with the proxy object we end up creating. The <code class="prettyprint">get</code> method on <code class="prettyprint">handler</code> should be pretty simple to understand. It gets the <code class="prettyprint">target</code> object as an argument as well as the name of the property that was accessed. We can use this information to return whatever we want, but in this case I return the object's actual value if it has one and if not I return "foobar". I love this, there are so many interesting use cases for this, maybe one could even use this for a kind of type switch as it exists in Scala or use your own imagination. </p>

<p>Another great place where <code class="prettyprint">Proxy</code> would come in handy is in testing. Beyond just <code class="prettyprint">get</code> there are other handlers you can add including <code class="prettyprint">set</code>, <code class="prettyprint">has</code> and more. Once <code class="prettyprint">Proxy</code> becomes better supported and more stable I would not mind writing an entire blog post just about <code class="prettyprint">Proxy</code>. I recommend reading the MDN documentation on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"><code class="prettyprint">Proxy</code></a> in full and checking out the provided examples. There's also a jsconf talk about the many ways that <code class="prettyprint">Proxy</code> is awesome that I recommend checking out: <a href="https://www.youtube.com/watch?v=sClk6aB_CPk">video</a> <a href="http://jsconf.eu/2010/speaker/be_proxy_objects.html">slides</a>.</p>

<hr>

<p>So there is way more to JavaScript objects than simply using them as glorified bags of arbitrary data. Even now powerful property definitions are possible, and the future has even more in store as you can see when you think about all the ways that <code class="prettyprint">Proxy</code> can change the way that JavaScript will be written. If you have any questions or corrections, pretty please let me know on Twitter, you can find me there as <a href="http://twitter.com/bjorntipling">@bjorntipling</a>.</p>

<p><em>I have updated this blog post to clarify the difference between <code class="prettyprint">Object.keys</code> and <code class="prettyprint">Object. getOwnPropertyNames</code> <a href="https://news.ycombinator.com/item?id=8219991">thanks wging and TazeTSchnitzel</a></em></p>

<p><em>I also updated this post to clarify that Firefox Nightly has <code class="prettyprint">Symbol</code> <a href="https://news.ycombinator.com/item?id=8219793">thanks Excavator</a></em></p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-42" name="t-42"></a><h1>42 : JavaScript: Function Invocation Patterns</h1>
					<div class="tutorial__content">
<div class="article-content">
		<p>JavaScript has been described as a <em>Functional Oriented Language</em> (this as opposed to Object Oriented Language). The reason is because functions in JavaScript do more than just separate logic into execution units, functions are first class citizens that also provide <a href="http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html" target="_blank">scope</a><sup class="print">L1</sup> and the ability to create objects. Having such a heavy reliance upon functions is both a blessing and a curse: It's a blessing because it makes the language light weight and fast (the main goal of its original development), but it is a curse because you can very easily shoot yourself in the foot if you don't know what you are doing.</p>
<p>One concern with JavaScript functions is how different invocation patterns can produce vastly different results. This post explains the four patterns, how to use them and what to watch out for. The four invocation patterns are:</p>
<ol>
<li><strong>Method Invocation</strong></li>
<li><strong>Function Invocation</strong></li>
<li><strong>Constructor Invocation</strong></li>
<li><strong>Apply And Call Invocation</strong></li>
</ol>
<h1 id="function-execution">Function Execution<a href="#function-execution" title="Permanent link" class="headerlink"></a></h1>
<p>JavaScript (like all languages these days) has the ability to modularise logic in <code>functions</code> which can be invoked at any point within the execution. Invoking a function suspends execution of the current function, passing controls and parameters to the invoked function. In addition, a parameter called <code>this</code> is also passed to the function. The invocation operator is a pair of round brackets <code>()</code>, that can contain zero or more expressions separated by a comma.</p>
<p>Unfortunately, there is more than one pattern that can be used to invoke functions. These patterns are not <em>nice-to-know</em>: They are absolutely essential to know. This is because invoking a function with a different pattern can produce a vastly different result. I believe that this is a language design error in JavaScript, and had the language been designed with more thought (and less haste), this would not have been such a big issue.</p>
<h1 id="the-four-invocation-patterns">The Four Invocation Patterns<a href="#t-he-four-invocation-patterns" title="Permanent link" class="headerlink"></a></h1>
<p>Even though there are is only one <em>invocation operator</em> <code>()</code>, there are four <em>invocation patterns</em>. Each pattern differs in how the <code>this</code> parameter is initialised. </p>
<h2 id="method-invocation">Method Invocation<a href="#method-invocation" title="Permanent link" class="headerlink"></a></h2>
<p>When a function is part of an object, it is called a <em>method</em>. Method invocation is the pattern of invoking a function that is part of an object. For example:</p>
<pre>var obj = {
    value: 0,
    increment: function() {
        this.value+=1;
    }
};

obj.increment(); //Method invocation
</pre>

<p>Method invocation is identified when a function is preceded by <code>object.</code>, where <code>object</code> is the name of some object. JavaScript will set the <code>this</code> parameter to the object where the method was invoked on. In the example above, <code>this</code> would be set to <code>obj</code>. JavaScript binds <code>this</code> at execution (also known as <em>late binding</em>).</p>
<h2 id="function-invocation">Function Invocation <a id="fi"></a><a href="#function-invocation" title="Permanent link" class="headerlink"></a></h2>
<p>Function invocation is performed by invoking a function using <code>()</code>:</p>
<pre>add(2,3); //5
</pre>

<p>When using the function invocation pattern, <code>this</code> is set to the global object. This was a mistake in the JavaScript language! Blindly binding <code>this</code> to the global object can destroy its current context. It is noticable when using an <em>inner function</em> within a method function. An example should explain things better: </p>
<pre>var value = 500; //Global variable
var obj = {
    value: 0,
    increment: function() {
        this.value++;

        var innerFunction = function() {
            alert(this.value);
        }

        innerFunction(); //Function invocation pattern
    }
}
obj.increment(); //Method invocation pattern
</pre>

<p>What do you think will be printed to screen? For those that answered <em>1</em>, you are wrong (but don't be too hard on yourselves, this is because JavaScript does not do things very well). The real answer is <em>500</em>. Note that <code>innerFunction</code> is called using the function invocation pattern, therefore <code>this</code> is set to the global object. The result is that <em>innerFunction</em> (again, it is important to note that it is invoked with function pattern) will not have <code>this</code> set to current object. Instead, it is set to the global object, where <code>value</code> is defined as <em>500</em>. I stress that this is bad language design; the increment function was invoked with the method invocation pattern, and so it is natural to assume the <code>this</code> should always point to the current function when used inside it.</p>
<p><a id="standardfix"></a>There is an easy way to get round this problem, but it is in my opinion a hack. One gets around this problem by assigning a variable (by convention, it is named <code>that</code>) to <code>this</code> inside the function (aside: This works because functions in JavaScript are <a href="http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html#closures" target="_blank">closures</a><sup class="print">L2</sup>):</p>
<pre>var value = 500; //Global variable
var obj = {
    value: 0,
    increment: function() {
        var that = this;
        that.value++;

        var innerFunction = function() {
            alert(that.value);
        }

        innerFunction(); //Function invocation pattern
    }
}
obj.increment();
</pre>

<p>If <code>this</code> could be bound to the current object whose scope it is called in, function and method invocations would be identical.</p>
<h2 id="constructor-invocation">Constructor Invocation <a id="ci"></a><a href="#constructor-invocation" title="Permanent link" class="headerlink"></a></h2>
<p><em>Warning</em>: This is another JavaScript peculiarity! JavaScript is not a classical object oriented language. Instead, it is a prototypical object oriented language, but the creators of JavaScript felt that people with classical object orientation experience (the vast majority) may be unhappy with a purely prototype aproach. This resulted in JavaScript being unsure of its prototypical nature and the worst thing happened: It mixed classical object orientation syntax with its prototypical nature. The result: A mess!</p>
<p>In classical object orientation, an object is an instantiation of a class. In C++ and Java, this instantiation is performed by using the <code>new</code> operator. This seems to be the inspiration behind the constructor invocation pattern...</p>
<p>The constructor invocation pattern involves putting the <code>new</code> operator just before the function is invoked. For example:</p>
<pre>var Cheese = function(type) {
    var cheeseType = type;
    return cheeseType;
}

cheddar = new Cheese("cheddar"); //new object returned, not the type.
</pre>

<p>Even though <code>Cheese</code> is a function object (and intuitively, one thinks of functions as running modularised pieces of code), we have created a new object by invoking the function with <code>new</code> in front of it. The <code>this</code> parameter will be set to the newly created object and the <code>return</code> operator of the function will have its behaviour altered. Regarding the behaviour of the <code>return</code> operator in constructor invocation, there are two cases: </p>
<ol>
<li>If the function returns a simple type (number, string, boolean, null or undefined), the return will be ignored and instead <code>this</code> will be returned (which is set to the new object).</li>
<li>If the function returns an instance of <code>Object</code> (anything other than a simple type), then that object will be returned instead of returning <code>this</code>. This pattern is not used that often, but it may have utility when used with <a href="http://doctrina.org/JavaScript:Why-Understanding-Scope-And-Closures-Matter.html#closures" target="_blank">closures</a><sup class="print">L2</sup>.</li>
</ol>
<p>For example:</p>
<pre>var obj = {
    data : "Hello World"
}

var Func1 = function() {
    return obj;
}

var Func2 = function() {
    return "I am a simple type";
}

var f1 = new Func1(); //f1 is set to obj
var f2 = new Func2(); //f2 is set to a new object
</pre>

<p>We might ignore the constructor invocation pattern, and just use <a href="http://doctrina.org/Javascript-Objects-Prototypes.html#cofl" target="_blank">object literals</a><sup class="print">L3</sup> to make objects, except that the makers of JavaScript have enabled a key feature of their language by using this pattern: Object creation with an arbitrary prototype link (see <a href="http://doctrina.org/Javascript-Objects-Prototypes.html" target="_blank">previous post</a><sup class="print">L4</sup> for more details). This pattern is unintuitive and also <a href="http://doctrina.org/Javascript-Objects-Prototypes.html#pcip" target="_blank">potentially problematic</a><sup class="print">L5</sup>. There is a <a href="http://doctrina.org/Javascript-Objects-Prototypes.html#remedy" target="_blank">remedy</a><sup class="print">L6</sup> which was championed by Douglas Crockford: Augment <code>Object</code> with a create method that accomplishes what the constructor invocation pattern tries to do. I am happy to note that as of JavaScript 1.8.5, <code>Object.create</code> is a reality and can be used. Due to legacy, the constructor invocation is still used often, and for backward compatability, will crop up quite frequently.</p>
<h2 id="apply-and-call-invocation">Apply And Call Invocation<a href="#apply-and-call-invocation" title="Permanent link" class="headerlink"></a></h2>
<p>The apply pattern is not as badly thought out as the two preceding patterns. The <code>apply</code> method allows manual invocation of a function with a means to pass the function an array of parameters and explicitly set the <code>this</code> parameter. Because functions are first class citizens, they are also objects and hence can have methods (functions) run on it. In fact, every function is linked to <code>Function.prototype</code> (see <a href="http://doctrina.org/Javascript-Objects-Prototypes.html#cfo" target="_blank">here</a><sup class="print">L7</sup> for more details), and so methods can very easily be augmented to any function. The apply method is just an augmentation to every function as - I presume - it is defined on <code>Function.prototype</code>. </p>
<p>Apply takes two parameters: the first parameter is an object to bind the <code>this</code> parameter to, the second is an array which is mapped to the parameters:</p>
<pre>var add = function(num1, num2) {
        return num1+num2;
}

array = [3,4];
add.apply(null,array); //7
</pre>

<p>In the example above, <code>this</code> is bound to null (the function is not an object, so it is not needed) and array is bound to <code>num1</code> and <code>num2</code>. More interesting things can be done with the first parameter:</p>
<pre>var obj = {
    data:'Hello World'
}

var displayData = function() {
    alert(this.data);
}

displayData(); //undefined
displayData.apply(obj); //Hello World
</pre>

<p>The example above uses <code>apply</code> to bind <code>this</code> to <code>obj</code>. This results in being able to produce a value for <code>this.data</code>. Being able to expicitly assign a value to <code>this</code> is where the real value of apply comes about. Without this feature, we might as well use <code>()</code> to invoke functions.</p>
<p>JavaScript also has another invoker called <code>call</code>, that is identical to <code>apply</code> except that instead of taking an array of parameters, it takes an argument list. If JavaScript would implement function overriding, I think that <code>call</code> would be an overridden variant of <code>apply</code>. Therefore one talks about <code>apply</code> and <code>call</code> in the same vein.</p>
<h1 id="conclusion">Conclusion<a href="#conclusion" title="Permanent link" class="headerlink"></a></h1>
<p>For better or worse, JavaScript is about to take over the world. It is therefore very important that the peculiarities of the language be known and avoided. Learning how the four function invocation methods differ and how to avoid their pitfalls is fundamental to anyone who wants to use JavaScript. I hope this post has helped people when it comes to invoking functions.</p>
<h2 id="update">Update<a href="#update" title="Permanent link" class="headerlink"></a></h2>

	</div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-43" name="t-43"></a><h1>43 : Javascript: Object Prototypes</h1>
					<div class="tutorial__content">
					<span>http://doctrina.org/Javascript-Objects-Prototypes.html#cfo</span>
<div class="article-content">
		<p>This post discusses JavaScript objects with emphasis on its prototype linkings. After reading this post, you should understand the following:</p>
<ul>
<li>Object creation in JavaScript.</li>
<li>Prototype linkings.</li>
<li>What <code>Object.prototype</code> and <code>Function.prototype</code> are used for.</li>
</ul>
<p><a href="http://en.wikipedia.org/wiki/Douglas_Crockford" target="_blank">Douglas Crockford's</a><sup class="print">L1</sup> wonderful book <a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742/ref=sr_1_1?ie=UTF8&amp;qid=1346978272&amp;sr=8-1&amp;keywords=javascript+the+good+parts" target="_blank">JavaScript: The Good Parts</a><sup class="print">L2</sup> does a fanastic job of explaining this topic, and I urge the interested reader to buy his book.</p>
<h1 id="javascript-objects">JavaScript Objects<a href="#javascript-objects" title="Permanent link" class="headerlink"></a></h1>
<p>In JavaScript the simple types are <em>numbers</em>, <em>strings</em>, <em>booleans</em> (<em>true</em> and <em>false</em>), <em>null</em> and <em>undefined</em>. All other values are objects. Even though there are multiple ways to create objects, there are really only two <em>atomic</em> mechanisms that are used:</p>
<ol>
<li>Literals. </li>
<li>Functions.</li>
</ol>
<h2 id="creating-objects-from-literals">Creating Objects From Literals <a id="cofl"></a><a href="#creating-objects-from-literals" title="Permanent link" class="headerlink"></a></h2>
<p>Creating objects from literals is very simple. The following is an <em>object literal</em>:</p>
<pre>var person = {  
    "First_Name": "Barry",  
    "Last_Name": "Steyn",
    "do_Something": function() { alert('something'); }
}
</pre>

<p>Object Literals do not look like traditional objects. In fact, Object Literals look more like a structure that can hold things.  There is however one difference between a JavaScript object and a structure that can hold things: All JavaScript objects have a <em>prototype</em> linking.</p>
<h2 id="the-prototype-link">The Prototype Link<a href="#t-he-prototype-link" title="Permanent link" class="headerlink"></a></h2>
<p>Every Object has a <em>hidden</em> link to another object called a <em>prototype link</em>. Objects by default are linked to the object <code>Object.prototype</code>. The prototype link is only used when retrieving property values from an object (it is not touched when updating an object). When retrieving a property value from an object, if it cannot be found, it will look for it in the prototype object that it is linked to. For example:</p>
<pre>person.age; // undefined - property age does not exist
</pre>

<p>JavaScript tried to find the property age on person, and it could not. So then it tried to find it on <code>Object.prototype</code> and it could not find it either. So it returned "<em>undefined</em>".</p>
<pre>Object.prototype.age = 56; // Every object is linked to Object.prototype by default
person.age; // 56
</pre>

<p>JavaScript could not find age on person, but it did find it on <code>Object.prototype</code>, which is linked to person. Therefore the prototype linkage is used to <em>augment</em> an object with additional properties. In a classical object oriented language like Java or C++, augmentation is performed using inheritance. And so a prototype link can be considered as providing the property augmentation feature of object inheritance.</p>
<h2 id="creating-function-objects">Creating Function Objects <a id="cfo"></a><a href="#creating-function-objects" title="Permanent link" class="headerlink"></a></h2>
<p>Functions in JavaScript are objects and are <a href="http://en.wikipedia.org/wiki/First-class_citizen" target="_blank">first class citizens</a><sup class="print">L3</sup>. A variable can be assigned a function object like so:</p>
<pre>var addNum = function(num1, num2) {
        return num1 + num2;
}

typeof addNum; //function - which is an object in JavaScript
</pre>

<p>Since functions are objects, they too have a prototype link. But where object literals are by default linked to <code>Object.prototype</code>, function objects are linked to <code>Function.prototype</code>. There is one other difference that function objects have (and this is where it starts get confusing); function objects have in addition to a prototype link a <em>property</em> called <em>prototype</em>. This property (again, the <em>prototype</em> property <strong>is not</strong> the prototype link) can be manipulated (its use will be explained in the next section).</p>
<p>Just like <code>Object.prototype</code> is used to augment objects with properties, so <code>Function.prototype</code> is used to augment functions with properties.</p>
<pre>var result = addNum(3,4); // 7

//Add a function to Function.prototype
Function.prototype.substract = function(num1, num2) {
        return num1 - num2;
}

//We can now use subtract on any function object
result = addNum.subtract(5,2); //3
</pre>

<p><code>Function.prototype</code> is itself an object (big surprise there), and therefore it is linked to <code>Object.prototype</code>. If something cannot be found in <code>Function.prototype</code>, it will be searched for on <code>Function.prototype</code>'s linked prototype object, which is <code>Object.prototype</code>.</p>
<pre>Object.prototype.denominator = 10;
Object.prototype.divide = function(num1) {
        return num1 / denominator;
}

var result = addNum.divide(50); // 5
</pre>

<p>In the above example, <em>addNum</em> was searched for <em>divide</em>. Then <code>Function.prototype</code> was searched, after which, <code>Object.prototype</code> was searched, where it was eventually found. Therefore prototype links are chained together, whereby if a property is not found in the current object, it then searches for it in its linked prototype object. And if that object does not have the property, it is then searched for in that object's linked prototype object, and so on, until the process ends with <code>Object.prototype</code>.</p>
<p>The process described above is the mainstay of <a href="http://en.wikipedia.org/wiki/Prototype-based_programming" target="_blank">Prototype Based Programming</a><sup class="print">L4</sup>, and it is called <em>prototype chaining</em>.</p>
<h2 id="creating-objects-from-functions">Creating Objects From Functions <a id="coff"></a><a href="#creating-objects-from-functions" title="Permanent link" class="headerlink"></a></h2>
<p>This section should not be confused with the previous section. Their titles share similar wording, but in this section, we are going to talk about how to create a new object using a function, and last section we talked about creating function objects.</p>
<p>To recap from the last section, this is how a <em>function object</em> is created:</p>
<pre>var Animal = function(name) {
        this.name = name;
}
</pre>

<p>The variable <code>Animal</code>:</p>
<ul>
<li>Is a function and an object (remember, everything is an object in JavaScript).  </li>
<li>It has a <em>prototype property</em>, and its prototype link is to set to <code>Function.prototype</code> by default.</li>
</ul>
<p>But something special happens here if the function is invoked with the reserved word <code>new</code> (called the <a href="http://doctrina.org/Javascript-Function-Invocation-Patterns.html#ci" target="_blank">constructor invocation pattern</a><sup class="print">L5</sup>):</p>
<pre>var cat = new Animal('fluffy'); //Using new to invoke the function
</pre>

<p>What happens here is that <code>new</code> creates an object from the function object <code>Animal</code>. Its power comes in because it will use <code>Animal</code>'s <em>prototype property</em> as the <em>prototype link</em> for the new object. And since <code>Animal</code> can set the value of its prototype property, objects constructed in this way do not have to be linked to <code>Object.prototype</code>. Got that? If not, here is an example which should explain things:</p>
<pre>var species = {
        "species":"human"
}

var Entity = function(name) {
    this.name = name;
}

var alien = new Entity("Yoda");

Entity.prototype = species;
var human = new Entity("Jason");
</pre>

<p>In the above, the <code>alien</code> and <code>human</code> objects are constructed from the function <code>Entity</code> via the <em>constructor invocation pattern</em> that is initiated by putting the <code>new</code> keyword in front of the function name. When <code>alien</code> is constructed, <code>Entity</code>'s prototype property has not been altered, and so <code>alien</code> is linked to <code>Object.prototype</code>. But when constructing <code>human</code>, <code>Entity</code>'s prototype property was altered to species, and so the prototype object linked to <code>human</code> is <code>species</code>, which in turn is itself linked to <code>Object.prototype</code>:</p>
<pre>alien.species; // undefined
human.species; // human
</pre>

<h3 id="the-problem-with-using-the-constructor-invocation-pattern">The problem with using the "constructor invocation pattern" <a id="pcip"></a><a href="#t-he-problem-with-using-the-constructor-invocation-pattern" title="Permanent link" class="headerlink"></a></h3>
<p>Using <code>new</code> is one of four ways in which to invoke a function, the most popular way being to call the function. For example:</p>
<pre>var Vehicle = function(type) {
        this.type = type;
        return type;
}

var car = Vehicle("Toyota"); // Normal function call
var plane = new Vehicle("Boeing");
</pre>

<p>In the example above, <code>car</code> was assigned the result of invoking <code>Vehicle</code> as a normal function, which in this case was <em>Toyota</em>. But <code>plane</code> on the other was assigned the result of using the <em>constructor invocation pattern</em> which is an object (the return is ignored). This is terrible, and it is very easy to make a mistake.</p>
<p>One recommended approach is to always start functions that are to be invoked with <code>new</code> with <em>capital letters</em>. This should help for readability, but when someone is spending days trying to hunt for a bug, this will be little compensation. <a id="remedy"></a>Instead, a much better way would be to augment <code>Object</code> with a create method if it does not exist:</p>
<pre>if (typeof Object.create !== 'function') { //If working with a version of JavaScript prior to 1.8.5
    Object.create = function(o) {
        var F = function() {};
        F.prototype = o;
        return new F();
    }
}
</pre>

<p>Objects can now be created with a chosen prototype link by doing the following:</p>
<pre>var animal = {
    "type":"cat",
    "make_sound":function() {
        return "purrrr";
    }
}

var cat = Object.create(animal);
cat.make_sound(); //purrrr
cat.type; //cat
</pre>

<h1 id="conclusion">Conclusion<a href="#conclusion" title="Permanent link" class="headerlink"></a></h1>
<p>Object orientation in JavaScript is a bit of a mess. This is because JavaScript is quite unsure about what it is, and ends up being a mix of a classical object oriented language and a prototype based language. Hence we get the <code>new</code> keyword, which makes JavaScript look like a classical object oriented language, even though it is not.</p>
<p>To summarise, here are the three objects this blog discusses:</p>
<pre>//Object Literal
var objectLiteral = {
        "property1":"value1"
};

//Function Object
var functionObject = function() {
}

//Object From Function
var objectFromFunction = new functionObject();
</pre>

<p>And to summarise, the prototype linkings and properties available to each object:
</p><center>
    <table style="border-style: solid; border-width:1px; border-color: #000000;">
        <tbody><tr>
            <td><b>Object Literal</b></td>
            <td><b>Function Object</b></td>
            <td><b>Object From Function</b></td>
        </tr>
        <tr>
            <td>
                <ul>
                    <li> <em>Construction</em> - via curly braces <code>{}</code></li>
                    <li> <em>Prototype Link</em> - Object.prototype</li>
                    <li> <em>Prototype Property</em> - does not exist</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li> <em>Construction</em> - via the <code>function</code> keyword </li>
                    <li> <em>Prototype Link</em> - Function.prototype</li>
                    <li> <em>Prototype Property</em> - exists</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li> <em>Construction</em> - via <code>new</code> keyword with function object</li>
                    <li> <em>Prototype Link</em> - Whatever the function's (that was invoked by <code>new</code>) prototype property is set to (<code>Object.prototype</code> by default)</li>
                    <li> <em>Prototype Property</em> - does not exist</li>
                </ul>
            </td>
        </tr>
    </tbody></table>
</center>

	</div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-44" name="t-44"></a><h1>44 : Maps, Sets and Iterators in JavaScript</h1>
					<div class="tutorial__content">
					<span>http://bjorn.tipling.com/maps-sets-and-iterators-in-javascript</span>
<p>In my last JavaScript post I wrote about about how to make <a href="http://bjorn.tipling.com/advanced-objects-in-javascript">advanced usage of objects in JavaScript</a>. Continuing in a similar direction, in this post I want look at some new kinds of objects in JavaScript. I will look at <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">maps</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">sets</a>, including their "weak" counterparts, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">weakmaps</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet">weaksets</a>, also the new <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of"><code class="prettyprint">for...of</code></a> iterator and the new type <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/The_Iterator_protocol"><code class="prettyprint">Array Iterator</code></a>. </p>

<p>As of September 2014, these new features are not fully implemented across all browsers yet, so most of these examples will only work in Firefox and <a href="http://www.google.com/intl/en/chrome/browser/canary.html">Chrome Canary</a>. I am using <a href="https://nightly.mozilla.org/">Firefox Nightly</a> and Chrome Canary to create and test the jsfiddle examples. It may be the case that the examples also work in some of the beta versions, but I haven't checked.</p>

<p>I am going to begin by looking at the new <code class="prettyprint">Map</code> type in ECMAScript6. </p>
<h2 id="maps_2"><a class="head_anchor" href="#maps_2">&nbsp;</a>Maps</h2>
<p>Developers usually just use regular JavaScript objects when they want maps. Stuff is mapped in an object by using strings as a key and this is possible with any kind of Object in Javascript.</p>

<pre><code class="prettyprint">var obj = {};
obj.foo = "bar";
console.log(obj.foo); //logs "bar"
</code></pre>

<p>In ECMAScript 6, the new type <code class="prettyprint">Map</code> can be used very similar to a regular object.</p>

<pre><code class="prettyprint">var map = new Map();
map.set("foo", "bar");
console.log(map.get("foo")); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hy1tu83s/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>You will immediately notice that a map isn't created with the literal object syntax, and that one uses <code class="prettyprint">set</code> and <code class="prettyprint">get</code> methods to store and access data. Map constructors can also take an argument, something we'll look at that later. Since maps are just objects it is possible to store arbitrary data on a map using the <code class="prettyprint">.</code> notation but then you are not going to get to make use of the benefits of maps and you probably never want to do such a thing with a Map type. Map instances can be queried and manipulated with more than just <code class="prettyprint">set</code> and <code class="prettyprint">get</code>.</p>

<pre><code class="prettyprint">var animalSounds = new Map();

animalSounds.set("dog", "woof");
animalSounds.set("cat", "meow");
animalSounds.set("frog", "ribbit");

console.log(animalSounds.size); //logs 3
console.log(animalSounds.has("dog")); //logs true

animalSounds.delete("dog");

console.log(animalSounds.size); //logs 2
console.log(animalSounds.has("dog")); //logs false

animalSounds.clear();
console.log(animalSounds.size); //logs 0
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hy1tu83s/1/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>In this example you can see that the <code class="prettyprint">size</code> property on a map instance gives you the count of keys and values stored in a Map. If you were using regular Objects you'd have to keep track of the number of things in the Object yourself or iterate and count. With map this isn't necessary. Also available is a <code class="prettyprint">has</code> method to test if a key is stored in the <code class="prettyprint">map</code>, a <code class="prettyprint">delete</code> method to delete a key from a map and a <code class="prettyprint">clear</code> to clear all keys and values in a map. </p>

<p>The Map type, unlike regular objects in JavaScript, allow you to use any type as a key to refer to data, not just strings. This is a big improvement, especially if you have been storing data in objects using numbers. Consider the following:</p>

<pre><code class="prettyprint">var userId, usersObj, usersMap;

usersObj = {
    1: "sally",
    2: "bob",
    3: "jane"
};


console.log(usersObj[1]); //logs "sally", toString called on 1

for (userId in usersObj) {
   console.log(userId, typeof userId); //logs 1..3, "string"
   if (userId === 1) {
     console.log("This is never logged because userId is a string.");
   }
}
</code></pre>

<p>With objects, developers have been able to use numbers as property names,  or keys as it were, but when this is done the number is actually being turned into a string.</p>

<pre><code class="prettyprint">console.log(usersObj[1]); //logs "sally", toString called on 1
</code></pre>

<pre><code class="prettyprint">"sally"
</code></pre>

<p>A number as a key actually works here <a href="http://www.ecma-international.org/ecma-262/5.1/#sec-8.12.8">because <code class="prettyprint">toString</code> is being called on the number</a> given to the object.  However when you iterate over <code class="prettyprint">usersObj</code> it becomes clear that something is amiss.</p>

<pre><code class="prettyprint">for (userId in usersObj) {
   console.log(userId, typeof userId); //logs 1..3, "string"
   if (userId === 1) {
     console.log("This is never logged because userId is a string.");
   }
}
</code></pre>

<p>Here we see <code class="prettyprint">userId</code> is a string and the <code class="prettyprint">console.log</code> statement inside the <code class="prettyprint">if</code> statement is never executed because we mistakenly expected  <code class="prettyprint">userId</code> to be a number.</p>

<pre><code class="prettyprint">"1" "string"
"2" "string"
"3" "string"
</code></pre>

<p>If you have been using numbers as primary keys, as many databases will do by default, you can run into trouble if you want to iterate over your JavaScript object to look for an id. You will not find your id unless you know that the key for an Object is always of type string. Numbers are simply being converted to strings.</p>

<p>With maps however, the type of the key stays whatever it was when you set it.</p>

<pre><code class="prettyprint">usersMap = new Map();
usersMap.set(1, "sally");
usersMap.set(2, "bob");
usersMap.set(3, "jane");

console.log(usersMap.get(1)); //logs "sally"
usersMap.forEach(function (username, userId) {
  console.log(userId, typeof userId); //logs 1..3, "number"
  if (userId === 1) {
     console.log("We found sally.");
  }
});
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hy1tu83s/2/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<pre><code class="prettyprint">1 "number"
"We found sally."
2 "number"
3 "number"
</code></pre>

<p>The number stays as type number. You never need convert your id to a string or convert the Object's key to a number when you're using a map.</p>

<p>In addition to strings and numbers, you can use other primitive types as keys. Here is an example using a boolean as a key.</p>

<pre><code class="prettyprint">var map;

map = new Map();
map.set(true, [
    "1 + 1 = 2",
    "cows are animals",
    "grass is green",
]);
map.set(false, [
    "the moon is made from cheese",
    "the earth is flat",
    "pyramids were made by aliens",
]);


map.forEach(function (value, key) {
    console.log(typeof key, key);
});
</code></pre>

<p><a href="http://jsfiddle.net/btipling/gustdaqp/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>This logs:</p>

<pre><code class="prettyprint">"boolean" true
"boolean" false
</code></pre>

<p>You can even use Objects as a key,  here is an example of such a map:</p>

<pre><code class="prettyprint">var obj, map;

map = new Map();
obj = {foo: "bar"};

map.set(obj, "foobar");

obj.newProp = "stuff";

console.log(map.has(obj)); //logs true

console.log(map.get(obj)); //logs "foobar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/27btou03/2/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>Even <code class="prettyprint">NaN</code> can be a key.</p>

<pre><code class="prettyprint">var map, errors, result;
errors = new Map();
errors.set(NaN, "That was not a number!");
errors.set(Infinity, "That was infinity!");
[
    1 + 2,
    1/0,
    1/"foo",
].forEach(function (result) {
    if (errors.has(result)) {
        console.log(errors.get(result));
    } else {
        console.log("The result was", result);
    }
});
</code></pre>

<p><a href="http://jsfiddle.net/btipling/415w0oqz/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>Result:</p>

<pre><code class="prettyprint">"The result was" 3 
"That was infinity!"
"That was not a number!"
</code></pre>

<p>Even though <code class="prettyprint">NaN !== NaN</code> you can use <code class="prettyprint">NaN</code> this way with Maps. </p>

<pre><code class="prettyprint">var errors;
errors = new Map();
errors.set(NaN, "Not a number!");

console.log(NaN === NaN); //logs false
console.log(errors.has(NaN)); //logs true
</code></pre>

<p><a href="http://jsfiddle.net/btipling/415w0oqz/3/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>It is totally possible to mix and match types in a map, here is a pretty silly example:</p>

<pre><code class="prettyprint">var map = new Map();

map.set(1, "one");
map.set("two", 2);
map.set(true, false);
map.set({foo: "bar"}, ["foo", "bar"]);

console.log(map.size); //logs "4"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/p07vjjyx/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>There are multiple ways to iterate over a <code class="prettyprint">Map</code>, some of which we will look at in just a bit, but a very straight forward way is to use a map instance's <code class="prettyprint">forEach</code> method. </p>

<pre><code class="prettyprint">var map = new Map();

map.set(1, "one");
map.set("two", 2);
map.set(true, false);
map.set({foo: "bar"}, ["foo", "bar"]);

map.forEach(function (value, key, mapObj) {
    console.log("value:", value, "key:", key, "map", mapObj === map);
});
</code></pre>

<p><a href="http://jsfiddle.net/btipling/qnhzxdzp/">jsfiddle</a></p>

<p>Result:</p>

<pre><code class="prettyprint">"value:" "one" "key:" 1 "map" true
"value:" 2 "key:" "two" "map" true
"value:" false "key:" true "map" true
"value:" Array [ "foo", "bar" ] "key:" Object { foo: "bar" } "map" true
</code></pre>

<p>Much like the <code class="prettyprint">Array.prototype.forEach</code>, a map's <code class="prettyprint">forEach</code> is given a function that is called for each value set on the map. This function is given three parameters: the value, they key, and a reference to the map object itself as the final argument.</p>

<hr>
<h2 id="forof_2"><a class="head_anchor" href="#forof_2">&nbsp;</a>for…of</h2>
<p>We are not just yet done talking about maps, but we need to diverge for a bit because before I can go on I need to introduce iterators. ECMAScript 6 introduces some new ways to iterate over data and I will only mention two of them in this post, <code class="prettyprint">for...of</code> and the new <code class="prettyprint">Array Iterator</code> type.</p>

<p><code class="prettyprint">for...of</code> is a new type of iteration statement that differs from <code class="prettyprint">for...in</code> in that it iterates over the values instead of indexes or keys, and that it can be used with maps and sets. Before we switch back to maps let's take a look at iterating over arrays.</p>

<pre><code class="prettyprint">var i, value, a;

a = ["a", "b", "c"];
a.foo = "bar";
for (i in a) {
    console.log(i);
}


for (value of a) {
    console.log(value);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/jag87v1a/">jsfiddle</a>  <em>(created and tested with Firefox Nightly)</em></p>

<p>Usually you would iterate over an array with a <code class="prettyprint">for(i = 0; i &lt; a.length; i++)</code> or use its <code class="prettyprint">forEach</code> but you could also iterate via <code class="prettyprint">for...in</code> but this example demonstrates a problem with that as <code class="prettyprint">for...in</code> also iterates over properties of the array object.</p>

<pre><code class="prettyprint">a = ["a", "b", "c"];
a.foo = "bar";
for (i in a) {
    console.log(i);
}
</code></pre>

<pre><code class="prettyprint">0
1
2
foo
</code></pre>

<p>Notice the "foo".  Instead of iterating over the indexes and property names, <code class="prettyprint">for...of</code> iterates over its values.</p>

<pre><code class="prettyprint">for (value of a) {
    console.log(value);
}
</code></pre>

<pre><code class="prettyprint">a
b
c
</code></pre>

<p>Notice the lack of "foo".  Only array values are iterated over, not object values. As a quick aside I should also note that  my experience has been that I have found <code class="prettyprint">for...in</code> to be considerably slower in the past than the available alternatives. I will avoid looking at the performance of <code class="prettyprint">for...of</code> until it has made it into stable versions of Chrome and other browsers.</p>

<p>You cannot use <code class="prettyprint">for...of</code> with just any object, it will result in a JavaScript error.</p>

<pre><code class="prettyprint">var value, obj = {foo1: "bar1", foo2: "bar2"};

//This will result in a JavaScript error:
for (value of obj) {
    console.log(value);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/qnhzxdzp/1/">jsfiddle</a>  <em>(created and tested with Firefox Nightly)</em></p>

<p>You can use <code class="prettyprint">for...of</code> on arrays, array like types like <code class="prettyprint">arguments</code> and node lists, generators, maps and sets.  Sets we'll take a look later and generators are beyond the scope of this blog post. Here is <code class="prettyprint">for...of</code> with a map:</p>

<pre><code class="prettyprint">var data, map = new Map();

map.set("dog", "woof");
map.set("cow", "moo");

for (data of map) {
    console.log(data);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/qnhzxdzp/3/">jsfiddle</a>  <em>(created and tested with Firefox Nightly)</em></p>

<p>Each iteration of a map with <code class="prettyprint">for...of</code> is given an array with two values.</p>

<pre><code class="prettyprint">Array [ "dog", "woof" ]
Array [ "cow", "moo" ]
</code></pre>

<p>Each pair has the key at index 0 and its value at index 1. </p>

<p>I find maps to be preferable to Objects for several reasons, but not the least is the simple iteration. <code class="prettyprint">for...of</code> is superior than a <code class="prettyprint">for...in</code> as object values are not iterated over, no more need for checking <code class="prettyprint">hasOwnProperty</code>, and you get the index and the value. When to use <code class="prettyprint">for...of</code> or the maps <code class="prettyprint">forEach</code> depends what is simpler., <code class="prettyprint">for...of</code> avoids the extra function call for each iteration, avoids the need to binding a <code class="prettyprint">thisArg</code> and is simply easier to look at.</p>

<hr>
<h2 id="array-iterator_2"><a class="head_anchor" href="#array-iterator_2">&nbsp;</a>Array Iterator</h2>
<p>Continuing on, the other new method of iteration is the <code class="prettyprint">Array Iterator</code> type which is also applicable to maps, sets and arrays. An array iterator is an object that has a <code class="prettyprint">next</code> method which when called returns an object with  <code class="prettyprint">value</code> and <code class="prettyprint">done</code> properties. The <code class="prettyprint">next</code> method is used to iterate, the <code class="prettyprint">value</code> of the returned object is the value obviously, and <code class="prettyprint">done</code> will tell you when iteration has finished. There are new array and map methods that return array iterators.</p>

<pre><code class="prettyprint">function logIterator(iterator) {
    var current;
    while(true) {
        current = iterator.next();
        if (current.done) {
            break;
        }
        console.log(current.value);
    }
}

logIterator(["a","b", "c", "d"].entries());
logIterator(["a","b", "c", "d"].keys());


var map = new Map();
map.set(0, "a");
map.set(1, "b");
map.set(2, "c");
map.set(3, "d");
logIterator(map.entries());
logIterator(map.keys());
logIterator(map.values());
</code></pre>

<p><a href="http://jsfiddle.net/btipling/utxgdcw2/1/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>The function <code class="prettyprint">logIterator</code> takes an <code class="prettyprint">Array Iterator</code> as an argument and iterates over it with a <code class="prettyprint">while</code> loop. It calls <code class="prettyprint">next</code> to iterate and logs the return value. It checks <code class="prettyprint">done</code> to break out of the <code class="prettyprint">while</code>.</p>

<p>Here we use the array's <code class="prettyprint">entries</code> and <code class="prettyprint">keys</code> methods to get <code class="prettyprint">Array Iterators</code> and log their values.</p>

<pre><code class="prettyprint">logIterator(["a","b", "c", "d"].entries());
logIterator(["a","b", "c", "d"].keys());
</code></pre>

<p>Result:</p>

<pre><code class="prettyprint">[0, "a"]
[1, "b"]
[2, "c"]
[3, "d"]
0
1
2
3
</code></pre>

<p>The <code class="prettyprint">entries</code> method returns an <code class="prettyprint">Array Iterator</code> the value of which will be an Array pair, much like you get for a <code class="prettyprint">for...of</code> when iterating over a map. At index 0 you get the current iteration's index, at index 1 you get the value for the current iteration.</p>

<p>The <code class="prettyprint">keys</code> method creates an <code class="prettyprint">Array Iterator</code> that simply returns an index, or key as it were, for the Array at each iteration.</p>

<p>The map methods <code class="prettyprint">entries</code> and <code class="prettyprint">keys</code> behaves like an Array, the additional <code class="prettyprint">values</code> method iterates over the map's values:</p>

<pre><code class="prettyprint">var map = new Map();
map.set(0, "a");
map.set(1, "b");
map.set(2, "c");
map.set(3, "d");
logIterator(map.entries());
logIterator(map.keys());
logIterator(map.values());
</code></pre>

<p>Result:</p>

<pre><code class="prettyprint">[0, "a"]
[1, "b"]
[2, "c"]
[3, "d"]
0
1
2
3
"a"
"b"
"c"
"d"
</code></pre>

<p>Very much the same output. Note the Map returned data in the order it was given but there is absolutely nothing said in the specification of Maps being sorted nor of any order guarantee. If you want that, use an Array or a Set.</p>

<p>Unless you are doing something special with an <code class="prettyprint">Array Iterator</code> you don't need to manually write a function that calls <code class="prettyprint">next</code> and checks <code class="prettyprint">done</code>. You can just use <code class="prettyprint">for...of</code>:</p>

<pre><code class="prettyprint">var map = new Map();
map.set(0, "a");
map.set(1, "b");
map.set(2, "c");
map.set(3, "d");

for (data of map.entries()) {
    console.log(data);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/octqdm2r/">jsfiddle</a></p>

<p>This prints exactly as what it did when we used <code class="prettyprint">logIterator</code> before.</p>

<p>Now that we know what <code class="prettyprint">Array Iterator</code> is, we can look at the constructor arguments for maps. You can create a map based of an Array Iterator.</p>

<pre><code class="prettyprint">var map = new Map(["a","b", "c", "d"].entries());

console.log(map); //logs Map { 0: "a", 1: "b", 2: "c", 3: "d" }
console.log(map.get(0)); //logs "a"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/v4eyc48m/1/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>You can also just use arrays of pairs:</p>

<pre><code class="prettyprint">var map = new Map([["dog", "woof"],["cow", "moo"]]);

console.log(map); //logs Map { dog: "woof", cow: "moo" }
console.log(map.get("dog")); //logs "woof"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/v4eyc48m/2/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<p>Duplicate keys in this case seem to override previous values in both Chrome Canary and Firefox Nightly.</p>

<pre><code class="prettyprint">var map = new Map([["dog", "woof"],["cow", "moo"], ["dog", "ribbit"]]);

console.log(map); //logs Map { dog: "ribbit", cow: "moo" }
console.log(map.get("dog")); //logs "ribbit"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/yewdtged/">jsfiddle</a> <em>(created and tested with Firefox Nightly)</em></p>

<hr>
<h2 id="weakmaps_2"><a class="head_anchor" href="#weakmaps_2">&nbsp;</a>Weakmaps</h2>
<p><a href="https://svbtleusercontent.com/qiqdm1xgyri6sq.png"><img src="https://svbtleusercontent.com/qiqdm1xgyri6sq.png" alt="weakmap.png"></a></p>

<p>WeakMaps are much like Maps except for some important differences. The first important difference is that you can only use objects as keys for a <code class="prettyprint">WeakMap</code>. You cannot use numbers, strings or other primitive types as keys. The second difference is that these keys are weakly held. Objects used as keys by a <code class="prettyprint">WeakMap</code> can be garbage collected if there are no other references to the object elsewhere in your application. Another important difference is that WeakMaps only have a subset of the methods maps have and cannot be iterated over in a <code class="prettyprint">for...of</code> loop.</p>

<pre><code class="prettyprint">var data, wmap = new WeakMap();
wmap.set({foo: "bar"}, "foobar");

//This is a JavaScript error:
for (data of wmap) {
    console.log(data);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/gqh20xv7/">jsfiddle</a></p>

<p>The methods a <code class="prettyprint">WeakMap</code> has are limited, to <code class="prettyprint">get</code>, <code class="prettyprint">set</code>, <code class="prettyprint">has</code>, <code class="prettyprint">delete</code> and <code class="prettyprint">clear</code>.</p>

<p>One use case for a <code class="prettyprint">WeakMap</code> could be to store metadata for an object. You do not have to manually clean up a WeakMap's references when you want to remove references to objects. For example, in the browser it is possible to create unintentional memory leaks by keeping references to HTML elements around in your JavaScript. Even though you may have removed HTML elements from the DOM, if you still have references to them somewhere in your JavaScript they may not be garbage collected. If you use a <code class="prettyprint">WeakMap</code> you don't have to worry about this. I am not saying that maintaining state in the DOM is a good idea, in fact I think it is probably a bad idea that I have seen lead to a lot of problems, but you could do it with a <code class="prettyprint">WeakMap</code> and not have it lead to memory leaks. A great example for a good use case might be an SVG based line chart. You could store the details for a point in a <code class="prettyprint">WeakMap</code>  to show in a tooltip. When the user hovers over the point, the tooltip uses the SVG element hovered over to query the <code class="prettyprint">WeakMap</code> for information for the tooltip. When the line chart updates and the point goes away, the reference in the WeakMap should be cleared up and not present a problem.</p>

<p>For the purpose of this blog post I will use a less ideal example. I will use a shopping cart that maintains state using elements. Again, this is only for demonstration purposes, it is probably best to store state not using elements. </p>

<p><em>As of September 2014 the following example only works in Firefox Nightly, only because I used ES6 string templates, sorry</em>.</p>

<pre><code class="prettyprint">var prices, shoppingCart = new WeakMap();

prices = new Map([
    ["smartphone", new Map([
        ["iPhone6", 610],
        ["galaxyS5", 650],
        ["motoX", 179],
    ])],
    ["accessory", new Map([
        ["stylus", 20],
        ["case", 40],
    ])],
]);


function getProductFromShelf(type) {
    var productEl, clone, price;
    productEl = document.getElementById("shelf").querySelector(`.${type}`);
    price = prices.get(productEl.classList[1]).get(type);
    clone = productEl.cloneNode(true);
    document.getElementById("shoppingCart").appendChild(clone);
    shoppingCart.set(clone, price);
}

function printTotal() {
     var products, total = 0;
     products = document.getElementById("shoppingCart")
         .querySelectorAll("div");
     for (product of products) {
         total += shoppingCart.get(product);
     }
     document.getElementById("total").textContent = `$${total}`;
}

getProductFromShelf("iPhone6");
getProductFromShelf("motoX");
getProductFromShelf("case");

printTotal();
</code></pre>

<p><a href="http://jsfiddle.net/btipling/jLracts7/">jsfiddle</a> <em>(works in Firefox Nightly only)</em></p>

<p>This code clones HTML elements from the shelf and puts them into the shopping cart HTML element. When this is done an instance of <code class="prettyprint">WeakMap</code>, <code class="prettyprint">shoppingCart</code>, maintains metadata associated with the product put into the shopping cart. When this code wants to calculate the total it iterates over all the elements in the shopping cart and grabs the products associated price in <code class="prettyprint">shoppingCart</code> and adds it up. In this example the total ends up being $829. When we want to remove items from the shopping cart, we need only remove the element from the DOM, we don't have to remove any metadata from <code class="prettyprint">shoppingCart</code>. </p>

<p>As a quick note I made use of  ECMAScript 6 string templates:</p>

<pre><code class="prettyprint">    productEl = document.getElementById("shelf").querySelector(`.${type}`);
</code></pre>

<p>Note the:</p>

<pre><code class="prettyprint">`.${type}`
</code></pre>

<p>This is new in Firefox Nightly and I wanted to try it out. It references the <code class="prettyprint">type</code> variable so this string will become <code class="prettyprint">".iphone6"</code> or <code class="prettyprint">".motoX"</code> for example, depending on the value in <code class="prettyprint">type</code>. I don't have to use the ugly string concatenation <code class="prettyprint">+</code> operator to make hard to read strings.</p>

<hr>
<h2 id="sets_2"><a class="head_anchor" href="#sets_2">&nbsp;</a>Sets</h2>
<p>New in JavaScript is the <code class="prettyprint">Set</code> type which is a unique list of values enumerable in insertion order. Unlike Python's set it does not provide set operation functionality like finding differences, intersections and unions. It's simply a unique list.</p>

<pre><code class="prettyprint">var set = new Set(["a", "a","e", "b", "c", "b", "b", "b", "d"]);
console.log(set);
</code></pre>

<p><a href="http://jsfiddle.net/btipling/q1q9m640/">jsfiddle</a></p>

<p>Result:</p>

<pre><code class="prettyprint">Set [ "a", "e", "b", "c", "d" ]
</code></pre>

<p>And when iterated over it maintains insertion order:</p>

<pre><code class="prettyprint">var value, set = new Set(["a", "a","e", "b", "c", "b", "b", "b", "d"]);

for (value of set) {
    console.log(value);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/q1q9m640/1/">jsfiddle</a></p>

<pre><code class="prettyprint">"a"
"e"
"b"
"c"
"d"
</code></pre>

<p>Sets can't be accessed like an array.</p>

<pre><code class="prettyprint">var set = new Set(["a", "a","e", "b", "c", "b", "b", "b", "d"]);
console.log(set[0]); //Logs undefined
</code></pre>

<p><a href="http://jsfiddle.net/btipling/cd0bLn7v/">jsfiddle</a></p>

<p>Sets provide the same methods as a <code class="prettyprint">Map</code>. </p>

<pre><code class="prettyprint">var set = new Set(["a", "a","e", "b", "c", "b", "b", "b", "d"]);

console.log(set.size); //Logs 5
console.log(set.has("a")); //Logs true
console.log(set.delete("a")); //Logs true, was deleted
console.log(set.has("a")); //Logs false
console.log(set.delete("a")); //Logs false, wasn't deleted, wasn't there.

set.forEach(function (value, key, setObj) {
    console.log(value, key, key === value, set === setObj);
});

set.clear();

console.log(set.size); //Logs 0

set.add("a")
   .add("b")
   .add("c");

console.log(set.has("a")); //Logs true
console.log(set.size); //Logs 3
</code></pre>

<p><a href="http://jsfiddle.net/btipling/84tup3hv/">jsfiddle</a></p>

<p>Of interest is that delete lets you delete something from a set by value, whereas with an array you would probably do a splice using the value's index. I like this about <code class="prettyprint">Set</code>. Also weird, but interesting is that function for the <code class="prettyprint">forEach</code> on a <code class="prettyprint">Set</code> gets a value and a key even though there are only values in a set and thus you are given the same value for both arguments. </p>

<p>Sets also have the <code class="prettyprint">entries</code>, <code class="prettyprint">keys</code> and <code class="prettyprint">values</code> methods that a <code class="prettyprint">Map</code> has and they give you the same kind of <code class="prettyprint">Array Iterator</code> type but in the same vein as the Set's <code class="prettyprint">forEach</code> the entries pair is <code class="prettyprint">[value, value]</code>, that is you get an array of identical pair values. In addition a Set's <code class="prettyprint">keys</code> and <code class="prettyprint">values</code> are identical operations, they both return the same kind of iterator with the same values.</p>

<pre><code class="prettyprint">var data, set = new Set(["a", "a","e", "b", "c", "b", "b", "b", "d"]);

for (data of set.entries()) {
    console.log(data); //Logs ["a", "a"]...
}
for (value of set.values()) {
    console.log(value);
}
//Logs the same thing as values() above
for (key of set.keys()) {
    console.log(key);
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/rd873y3f/">jsfiddle</a></p>

<hr>
<h2 id="weakset_2"><a class="head_anchor" href="#weakset_2">&nbsp;</a>WeakSet</h2>
<p><code class="prettyprint">WeakSet</code> is similar to <code class="prettyprint">WeakMap</code>. You can only store objects, no primitives and you cannot iterate over a <code class="prettyprint">WeakSet</code>. The available methods are <code class="prettyprint">add</code>, <code class="prettyprint">has</code>, <code class="prettyprint">delete</code> and <code class="prettyprint">clear</code>. There is no <code class="prettyprint">size</code> property. Objects are weakly held, if an object held is garbage collected it will not lead to a memory leak. Items held in a <code class="prettyprint">WeakSet</code> like a <code class="prettyprint">Set</code> are unique, only one of each will be held. The use case for a <code class="prettyprint">WeakSet</code> is limited. You could use it to see if you have seen an Object before. For example you could check to see if a user clicked an element before.</p>

<p><em>As of September 2014, this example does not work in Chrome Canary</em>.</p>

<pre><code class="prettyprint">var button, wset = new WeakSet();

for (button of document.querySelectorAll("button")) {
    button.addEventListener("click", function (event) {
        if (wset.has(event.target)) {
            alert("You have clicked this button before!");
        } else {
            alert("First time clicking this button");
        }
        wset.add(event.target);
    });
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/0f1sooqL/">jsfiddle</a></p>

<p>Perhaps this can be used to prevent double clicking. It wont leak memory so it's safe to use the HTML element as a key.</p>

<hr>

<p>I am really excited about Maps and Sets and the new <code class="prettyprint">for...of</code> iterator. I can't wait until they are more widely available. Once they are a lot of ugly anti-patterns necessary to get things done can be thrown in the delete bin. JavaScript is really getting better every day. You should thank a browser developer whenever you meet one for all they have done to make such a great platform. If you notice any mistakes or have questions please don't hesitate to let me know, I'm <a href="https://twitter.com/bjorntipling">@bjorntipling</a> on Twitter.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-45" name="t-45"></a><h1>45 : ES6 Iterators and Generators in Practice</h1>
					<div class="tutorial__content">
<section class="entry-content ">
              <p><i>This article is a section from the course ES6 in Practice. I created this course during the last couple of months, because there is an evident need for a resource that helps JavaScript developers put theory into practice.</i></p><i>
<p>This course won't waste your time with long hours of video, or long pages of theory that you will never use in practice. We will instead focus on learning just enough theory to solve some exercises. Once you are done with the exercises, you can check the reference solutions, and conclude some lessons. In fact, some of the theory are sometimes placed in the reference solutions.</p>
</i><p><i>If you like this article, check out the course <a href="https://leanpub.com/es6-in-practice" target="_blank">here</a>.</i></p>
<p>This section is about iterators and generators.</p>
<p>It is worth for you to learn about iterators, especially if you are a fan of lazy evaluation, or you want to be able to describe infinite sequences. Understanding iterators also helps you understand generators, promises, sets, and maps better.</p>
<p>Once we cover the fundamentals of iterators, we will use our knowledge to understand how generators work.</p>
<h3>Iterables and Iterators</h3>
<p>ES6 comes with the <em>iterable</em> protocol. The protocol defines iterating behavior of JavaScript objects.</p>
<p>An <em>iterable object</em> has an iterator method with the key <code>Symbol.iterator</code>. This method returns an <em>iterator object</em>.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let iterableObject = {
&nbsp;&nbsp;[Symbol.iterator]() { return iteratorObject; }&nbsp;&nbsp;
};
&nbsp;
</pre>
<!-- [Format Time: 0.0059 seconds] -->

<p><code>Symbol.iterator</code> is a <em>well known symbol</em>. If you don't know what well known symbols are, <a href="http://www.zsoltnagy.eu/es6-symbols-and-its-use-cases/">read the lesson about symbols</a>.</p>
<p>We will now use <code>Symbol.iterator</code> to describe an iterable object. Note that we are using this construct for the sake of understanding how iterators work. Technically, you will hardly ever need <code>Symbol.iterator</code> in your code. You will soon learn another way to define iterables.</p>
<p>An <em>iterator object</em> is a data structure that has a <code>next</code> method. When calling this method on the iterator, it returns the next element, and a boolean signalling whether we reached the end of the iteration.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
// Place this before iterableObject
let iteratorObject = {
&nbsp;&nbsp;&nbsp;&nbsp;next() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done: true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value: null
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;
};
&nbsp;
</pre>
<!-- [Format Time: 0.0011 seconds] -->

<p>The return value of the <code>next</code> function is an object with two keys:</p>
<ul>
<li><code>done</code> is treated as a boolean. When <code>done</code> is truthy, the iteration ends, and <code>value</code> is not considered in the iteration</li>
<li><code>value</code> is the upcoming value of the iteration. It is considered in the iteration if and only if <code>done</code> is falsy. When <code>done</code> is truthy, <code>value</code> becomes the return value of the iterator</li>
</ul>
<p>Let's create a countdown object as an example:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let countdownIterator = {
&nbsp;&nbsp;&nbsp;&nbsp;countdown: 10,
&nbsp;&nbsp;&nbsp;&nbsp;next() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.countdown -= 1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;done: this.countdown === 0,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value: this.countdown
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;
};&nbsp;&nbsp;
&nbsp;
let countdownIterable = {
&nbsp;&nbsp;&nbsp;&nbsp;[Symbol.iterator]() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Object.assign( {}, countdownIterator ) 
&nbsp;&nbsp;&nbsp;&nbsp;}
};
&nbsp;
let iterator = countdownIterable[Symbol.iterator]();
&nbsp;
iterator.next();
&gt; Object {done: false, value: 9}
&nbsp;
iterator.next();
&gt; Object {done: false, value: 8}
&nbsp;
</pre>
<!-- [Format Time: 0.0059 seconds] -->

<p>Note that the state of the iteration is preserved.</p>
<p>The role of <code>Object.assign</code> is that we create a shallow copy of the iterator object each time the iterable returns an iterator. This allows us to have multiple iterators on the same iterable object, storing their own internal state. Without <code>Object.assign</code>, we would just have multiple references to the same iterator object:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let secondIterator = countdownIterable[Symbol.iterator]();
let thirdIterator = countdownIterable[Symbol.iterator]();
&nbsp;
console.log( secondIterator.next() );
&gt; Object {done: false, value: 9}
&nbsp;
console.log( thirdIterator.next() );
&gt; Object {done: false, value: 9}
&nbsp;
console.log( secondIterator.next() );
&gt; Object {done: false, value: 8}
&nbsp;
</pre>
<!-- [Format Time: 0.0047 seconds] -->

<p>We will now learn how to make use of iterators and iterable objects.</p>
<h3>Consuming iterables</h3>
<p>Both the <code>for-of</code> loop and the spread operator can be used to perform the iteration on an iterable object.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
for ( let element of iterableObject ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( element );
}
&nbsp;
console.log( [...iterableObject] );
&nbsp;
</pre>
<!-- [Format Time: 0.0017 seconds] -->

<p>Using the countdown example, we can print out the result of the countdown in an array:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
[...countdownIterable]
&gt; [9, 8, 7, 6, 5, 4, 3, 2, 1]
&nbsp;
</pre>
<!-- [Format Time: 0.0015 seconds] -->

<p>Language constructs that consume iterable data are called <em>data consumers</em>. We will learn about other data consumers soon.</p>
<h3>Built-in Iterables</h3>
<p>Some JavaScript types are iterables:</p>
<ul>
<li>Arrays are iterables, and work well with the <code>for-of</code> loop</li>
<li>Strings are iterables as arrays of 2 to 4 byte characters</li>
<li>DOM data structures are also iterables. If you want  proof, just open a random website, and execute <code>[...document.querySelectorAll('p')]</code> in the console</li>
<li>Maps and Sets are iterables. See the next section for more details</li>
</ul>
<p>Let's experiment with built-in iterables a bit.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let message = 'ok';
&nbsp;
let stringIterator = message[Symbol.iterator]();
let secondStringIterator = message[Symbol.iterator]();
&nbsp;
stringIterator.next();
&gt; Object {value: "o", done: false}
&nbsp;
secondStringIterator.next();
&gt; Object {value: "o", done: false}
&nbsp;
stringIterator.next();
&gt; Object {value: "k", done: false}
&nbsp;
stringIterator.next();
&gt; Object {value: undefined, done: true}
&nbsp;
secondStringIterator.next();
&gt; Object {value: "k", done: false}
&nbsp;
</pre>
<!-- [Format Time: 0.0056 seconds] -->

<p>Before you think how cool it is to use <code>Symbol.iterator</code> to get the iterator of built-in datatypes, I would like to emphasize that using <code>Symbol.iterator</code> is generally not cool. There is an easier way to get the iterator of built-in data structures using the public interface of built-in iterables.</p>
<p>You can create an <code>ArrayIterator</code> by calling the <code>entries</code> method of an array. <code>ArrayIterator</code> objects yield an array of <code>[key, value]</code> in each iteration.</p>
<p>Strings can be handled as arrays using the spread operator:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let message = [...'ok'];
&nbsp;
let pairs = message.entries();
&nbsp;
for( let pair of pairs ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( pair );
}
&nbsp;
&gt; [0, "o"]
&gt; [1, "k"]
&nbsp;
</pre>
<!-- [Format Time: 0.0014 seconds] -->

<h3>Iterables with Sets and Maps</h3>
<p>The <code>entries</code> method is defined on sets and maps. You can also use the <code>keys</code> and <code>values</code> method on a set or map to create an iterator/iterable of the keys or values. Example:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let colors = new Set( [ 'red', 'yellow', 'green' ] );
let horses = new Map( [[5, 'QuickBucks'], [8, 'Chocolate'], [3, 'Filippone']] );
&nbsp;
console.log( colors.entries() );
&gt; SetIterator {["red", "red"], ["yellow", "yellow"], ["green", "green"]}
&nbsp;
console.log( colors.keys() );
&gt; SetIterator {"red", "yellow", "green"}
&nbsp;
console.log( colors.values() );
&gt; SetIterator {"red", "yellow", "green"}
&nbsp;
console.log( horses.entries() );
&gt; MapIterator {[5, "QuickBucks"], [8, "Chocolate"], [3, "Filippone"]}
&nbsp;
console.log( horses.keys() );
&gt; MapIterator {5, 8, 3}
&nbsp;
console.log( horses.values() );
&gt; MapIterator {"QuickBucks", "Chocolate", "Filippone"}
&nbsp;
</pre>
<!-- [Format Time: 0.0054 seconds] -->

<p>You don't need these iterators though to perform the iteration. Sets and maps are iterable themselves, therfore, they can be used in for-of loops.</p>
<blockquote><p>
  A common destructuring pattern is to iterate the keys and values of a map using destructuring in a for-of loop:
</p></blockquote>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
for ( let [key, value] of horses ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( key, value );
}
&gt; 5 "QuickBucks"
&gt; 8 "Chocolate"
&gt; 3 "Filippone"
&nbsp;
</pre>
<!-- [Format Time: 0.0015 seconds] -->

<p>When creating a set or a map, you can pass any iterable as an argument, provided that the results of the iteration can form a set or a map:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let s = new Set( countdownIterable );
&gt; Set {9, 8, 7, 6, 5, 4, 3, 2, 1}
&nbsp;
</pre>
<!-- [Format Time: 0.0010 seconds] -->

<h3>The role of the iterable interface</h3>
<p>We can understand iterables a bit better by concentrating on data flow:</p>
<ul>
<li>The <code>for-of</code> loop, the <code>...</code> operator, and some other language constructs are <em>data consumers</em>. They consume iterable data</li>
<li>Iterable data structures such as arrays, strings, dom data structures, maps, and sets are <em>data sources</em></li>
<li>The <em>iterable interface</em> specifies how to connect data consumers with data sources</li>
<li><em>Iterable objects</em> are created according to the iterable interface specification. Iterable objects can create iterator objects that facilitate the iteration on their data source, and prepare the result for a data consumer</li>
</ul>
<p>We can create independent iterator objects on the same iterable. Each iterator acts like a pointer to the upcoming element the linked data source can consume.</p>
<p>In the lesson on sets and maps, we have learned that it is possible to convert sets to arrays using the spread operator:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let arr = [...set];
&nbsp;
</pre>
<!-- [Format Time: 0.0004 seconds] -->

<p>You now know that a set is an iterable object, and the spread operator is a data consumer. The formation of the array is based on the iterable interface. ES6 makes a lot of sense once you start connecting the dots.</p>
<h3>Generators</h3>
<p>There is a relationship between <em>iterators</em> and <em>generators</em>: a generator is a special function that returns an iterator. There are some differences between generator functions and regular functions:</p>
<ul>
<li>There is an <code>*</code> after the <code>function</code> keyword,</li>
<li>Generator functions create iterators</li>
<li>We use the <code>yield</code> keyword in the created iterator function. By writing <code>yield v</code>, the iterator returns <code>{ value: v, done: false }</code> as a value</li>
<li>We can also use the return keyword to end the iteration. Similarly to iterators, the returned value won't be a enumerated by a data consumer</li>
<li>The yielded result is the next value of the iteration process. Execution of the generator function is stopped at the point of yielding. Once a data consumer asks for another value, execution of the generator function is resumed, by executing the statement after the last yield</li>
</ul>
<p>Example:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
function *getLampIterator() {
&nbsp;&nbsp;&nbsp;&nbsp;yield 'red';
&nbsp;&nbsp;&nbsp;&nbsp;yield 'green';
&nbsp;&nbsp;&nbsp;&nbsp;return 'lastValue';
&nbsp;&nbsp;&nbsp;&nbsp;// implicit: return undefined;
}
&nbsp;
let lampIterator = getLampIterator();
&nbsp;
console.log( lampIterator.next() );
&gt; Object {value: "red", done: false}
&nbsp;
console.log( lampIterator.next() );
&gt; Object {value: "green", done: false}
&nbsp;
console.log( lampIterator.next() );
&gt; Object {value: "lastValue", done: true}
&nbsp;
</pre>
<!-- [Format Time: 0.0046 seconds] -->

<p>When we reach the end of a function, it automatically returns <code>undefined</code>. In the above example, we never reached the end, as we returned <code>'lastValue'</code> instead.</p>
<p>If the return value was missing, the function would return <code>{value: undefined, done: true}</code>.</p>
<blockquote><p>
  Use generators to define custom iterables to avoid using the well known symbol <code>Symbol.iterator</code>.
</p></blockquote>
<h3>Generators return iterators that are also iterables</h3>
<p>Recall our string iterator example to refresh what iterable objects and iterators are:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let message = 'ok';
&nbsp;
let stringIterator = message[Symbol.iterator]();
&nbsp;
</pre>
<!-- [Format Time: 0.0005 seconds] -->

<p>We call the <code>next</code> method of <code>stringIterator</code> to get the next element:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
console.log( stringIterator.next() );
&gt; Object {value: "o", done: false}
&nbsp;
</pre>
<!-- [Format Time: 0.0006 seconds] -->

<p>However, in a <code>for-of</code> loop, we normally use the <em>iterable object</em>, not the iterator:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
for ( let ch of message ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( ch );
}
&gt; o
&gt; k
&nbsp;
</pre>
<!-- [Format Time: 0.0006 seconds] -->

<p>Iterable objects have a <code>[Symbol.iterator]</code> method that returns an iterator.</p>
<p>Iterator objects have a <code>next</code> method that returns an object with keys <code>value</code> and <code>done</code>.</p>
<p>Generator functions return an object that is both an iterable and an iterator. Generator functions have:</p>
<ul>
<li>a <code>[Symbol.iterator]</code> method to return their iterator,</li>
<li>a <code>next</code> method to perform the iteration</li>
</ul>
<p>As a consequence, the return value of generator functions can be used in <code>for-of</code> loops, after the spread operator, and in all places where iterables are consumed.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
function *getLampIterator() {
&nbsp;&nbsp;&nbsp;&nbsp;yield 'red';
&nbsp;&nbsp;&nbsp;&nbsp;yield 'green';
&nbsp;&nbsp;&nbsp;&nbsp;return 'lastValue';
&nbsp;&nbsp;&nbsp;&nbsp;// implicit: return undefined;
}
&nbsp;
let lampIterator = getLampIterator();
&nbsp;
console.log( lampIterator.next() );
&gt; Object {value: "red", done: false}
&nbsp;
console.log( [...lampIterator] );
&gt; ["green"]
&nbsp;
</pre>
<!-- [Format Time: 0.0014 seconds] -->

<p>In the above example, <code>[...lampIterator]</code> contains the remaining values of the iteration in an array.</p>
<h3>Iterators and destructuring</h3>
<p>When equating an array to an iterable, iteration takes place.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let lampIterator = getLampIterator();
&nbsp;
let [head,] = lampIterator;
&nbsp;
console.log( head, [...lampIterator] );
&gt; red []
&nbsp;
</pre>
<!-- [Format Time: 0.0009 seconds] -->

<p>The destructuring assignment is executed as follows:</p>
<ul>
<li>first, <code>lampIterator</code> is substituted by an array of form <code>[...lampIterator]</code></li>
<li>then the array is destructured, and <code>head</code> is assigned to the first element of the array</li>
<li>the rest of the values are thrown away</li>
<li>as <code>lampIterator</code> was used to build an array with all elements on the right hand side, <code>[...lampIterator]</code> is empty in the console log</li>
</ul>
<h3>Combining generators</h3>
<p>It is possible to combine two sequences in one iterable. All you need to do is use  <code>yield *</code> to include an iterable, which will enumerate all of its values one by one.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let countdownGenerator = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;let i = 10;
&nbsp;&nbsp;&nbsp;&nbsp;while ( i &gt; 0 ) yield --i;
}
&nbsp;
let lampGenerator = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;yield 'red';
&nbsp;&nbsp;&nbsp;&nbsp;yield 'green';
}
&nbsp;
let countdownThenLampGenerator = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;yield *countdownGenerator();
&nbsp;&nbsp;&nbsp;&nbsp;yield *lampGenerator();
}
&nbsp;
console.log( [...countdownThenLampGenerator()] );
&gt; [9, 8, 7, 6, 5, 4, 3, 2, 1, 0, "red", "green"]
&nbsp;
</pre>
<!-- [Format Time: 0.0023 seconds] -->

<h3>Passing parameters to iterables</h3>
<p>The <code>next</code> method of iterators can be used to pass a value that becomes the value of the previous yield statement.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let greetings = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;let name = yield 'Hi!';
&nbsp;&nbsp;&nbsp;&nbsp;yield `Hello, ${ name }!`;
}
&nbsp;
let greetingIterator = greetings();
&nbsp;
console.log( greetingIterator.next() );
&gt; Object {value: "Hi!", done: false}
&nbsp;
console.log( greetingIterator.next( 'Lewis' ) );
&gt; Object {value: "Hello, Lewis!", done: false}
&nbsp;
</pre>
<!-- [Format Time: 0.0019 seconds] -->

<p>The return value of a generator becomes the value of a <code>yield *</code> expression:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let sumSequence = function *( num ) {
&nbsp;&nbsp;&nbsp;&nbsp;let sum = 0;
&nbsp;&nbsp;&nbsp;&nbsp;for ( let i = 1; i &lt;= num; ++i ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum += i;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield i;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;return sum;
}
&nbsp;
let wrapSumSequence = function *( num ) {
&nbsp;&nbsp;&nbsp;&nbsp;let sum = yield *sumSequence( num );
&nbsp;&nbsp;&nbsp;&nbsp;yield `The sum is: ${ sum }.`;
}
&nbsp;
for ( let elem of wrapSumSequence( 3 ) ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( elem );
}
&gt; 1
&gt; 2
&gt; 3
&gt; The sum is: 6.
&nbsp;
</pre>
<!-- [Format Time: 0.0026 seconds] -->

<h3>Practical applications</h3>
<p>You now know everything to be able to write generator functions. This is one of the hardest topics in ES6, so you will get a chance to solve more exercises than usual.</p>
<p>After practicing the foundations, you will find out how to use generators in practice to:</p>
<ul>
<li>define infinite sequences (exercise 5),</li>
<li>create code that evaluates lazily (exercise 6).</li>
</ul>
<p>For the sake of completeness, it is worth mentioning that generators can be used for asynchronous programming. Running asynchronous code is outside the scope of this lesson. We will use promises for handling asynchronous code.</p>
<h3>Exercises</h3>
<p>These exercises help you explore in more depth how iterators and generators work. You will get a chance to play around with iterators and generators, which will result in a higher depth of learning experience for you than reading about the edge cases.</p>
<p>You can also find out if you already know enough to command these edge cases without learning more about iterators and generators.</p>
<p><i>I will post an article with the solutions of the exercises. I will hide the solutions for a couple of days so that you can try solving these exercises yourself.</i></p><i>
</i><p><i>If you liked this lesson, check out the course by clicking the book below, or <a href="https://leanpub.com/es6-in-practice" target="_blank">visiting this link</a>.</i></p>
<p><a href="https://leanpub.com/es6-in-practice" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://i2.wp.com/www.zsoltnagy.eu/wp-content/uploads/2016/11/es6_3d_grey.png?resize=298%2C345" class="grouped_elements" rel="tc-fancybox-group392" alt="es6_3d_grey" data-srcset="https://i2.wp.com/www.zsoltnagy.eu/wp-content/uploads/2016/11/es6_3d_grey.png?w=298 298w, https://i2.wp.com/www.zsoltnagy.eu/wp-content/uploads/2016/11/es6_3d_grey.png?resize=259%2C300 259w" sizes="(max-width: 298px) 100vw, 298px" data-tcjp-recalc-dims="1"></a></p>
<p><strong>Exercise 1.</strong> What happens if we use a string iterator in a <code>for-of</code> loop?</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let message = 'ok';
let messageIterator = message[Symbol.iterator]();
&nbsp;
messageIterator.next();
&nbsp;
for ( let item of messageIterator ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( item );
}
&nbsp;
</pre>
<!-- [Format Time: 0.0009 seconds] -->

<hr>
<p><strong>Exercise 2.</strong> Create a countdown iterator that counts from 9 to 1. Use generator functions!</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let getCountdownIterator = // Your code comes here
&nbsp;
console.log( [ ...getCountdownIterator() ] );
&gt; [9, 8, 7, 6, 5, 4, 3, 2, 1]
&nbsp;
</pre>
<!-- [Format Time: 0.0010 seconds] -->

<hr>
<p><strong>Exercise 3.</strong> Make the following object iterable:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let todoList = {
&nbsp;&nbsp;&nbsp;&nbsp;todoItems: [],
&nbsp;&nbsp;&nbsp;&nbsp;addItem( description ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems.push( { description, done: false } );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;crossOutItem( index ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( index &lt; this.todoItems.length ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems[index].done = true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;}
};
&nbsp;
todoList.addItem( 'task 1' ).addItem( 'task 2' ).crossOutItem( 0 );
&nbsp;
let iterableTodoList = // ???;
&nbsp;
for ( let item of iterableTodoList ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( item );
}
&nbsp;
// Without your code, you get the following error:
// Uncaught TypeError: todoList[Symbol.iterator] is not a function
&nbsp;
</pre>
<!-- [Format Time: 0.0025 seconds] -->

<hr>
<p><strong>Exercise 4.</strong> Determine the values logged to the console without running the code. Instead of just writing down the values, formulate your thought process and explain to yourself how the code runs line by line.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let errorDemo = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;yield 1;
&nbsp;&nbsp;&nbsp;&nbsp;throw 'Error yielding the next result';
&nbsp;&nbsp;&nbsp;&nbsp;yield 2;
}
&nbsp;
let it = errorDemo();
&nbsp;
// Execute one statement at a time to avoid
// skipping lines after the first thrown error.
&nbsp;
console.log( it.next() );
&nbsp;
console.log( it.next() );
&nbsp;
console.log( [...errorDemo()] );
&nbsp;
for ( let element of errorDemo() ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( element );
}
&nbsp;
</pre>
<!-- [Format Time: 0.0018 seconds] -->

<hr>
<p><strong>Exercise 5.</strong> Create an infinite sequence that generates the next value of the Fibonacci sequence.</p>
<p>The Fibonacci sequence is defined as follows:</p>
<ul>
<li><code>fib( 0 ) = 0</code></li>
<li><code>fib( 1 ) = 1</code></li>
<li>for <code>n &gt; 1</code>, <code>fib( n ) = fib( n - 1 ) + fib( n - 2 )</code></li>
</ul>
<hr>
<p><strong>Exercise 6.</strong> Create a lazy <code>filter</code> generator function. Filter the elements of the Fibonacci sequence by keeping the even values only.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
function *filter( iterable, filterFunction ) {
&nbsp;&nbsp;&nbsp;&nbsp;// insert code here
}
&nbsp;
</pre>
</section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-46" name="t-46"></a><h1>46 : ES6 Iterators and Generators -- 6 exercises and solutions</h1>
					<div class="tutorial__content">
					<span>http://www.zsoltnagy.eu/es6-iterators-and-generators-6-exercises-and-solutions/</span>
<section class="entry-content ">
              <p><i>This article is a section from the workbook of ES6 in Practice. I created this course during the last couple of months, because there is an evident need for a resource that helps JavaScript developers put theory into practice.</i></p><i>
<p>This course won't waste your time with long hours of video, or long pages of theory that you will never use in practice. We will instead focus on learning just enough theory to solve some exercises. Once you are done with the exercises, you can check the reference solutions, and conclude some lessons. In fact, some of the theory are sometimes placed in the reference solutions.</p>
</i><p><i>If you like this article, check out the course <a href="https://leanpub.com/es6-in-practice" target="_blank">here</a>.</i></p>
<p>In my <a href="http://www.zsoltnagy.eu/es6-iterators-and-generators-in-practice/">last article</a>, I gave you six exercises. In this article, you can check the reference solutions.</p>
<p><strong>Exercise 1.</strong> What happens if we use a string iterator instead of an iterable object in a <code>for-of</code> loop?</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let message = 'ok';
let messageIterator = message[Symbol.iterator]();
&nbsp;
messageIterator.next();
&nbsp;
for ( let item of messageIterator ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( item );
}
&nbsp;
</pre>
<!-- [Format Time: 0.0068 seconds] -->

<hr>
<p><strong>Solution:</strong> Similarly to generators, in case of strings, arrays, DOM elements, sets, and maps, an iterator object is also an iterable.</p>
<p>Therefore, in the <code>for-of</code> loop, the remaining <code>k</code> letter is printed out.</p>
<hr>
<p><strong>Exercise 2.</strong> Create a countdown iterator that counts from 9 to 1. Use generator functions!</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let getCountdownIterator = // Your code comes here
&nbsp;
console.log( [ ...getCountdownIterator() ] );
&gt; [9, 8, 7, 6, 5, 4, 3, 2, 1]
&nbsp;
</pre>
<!-- [Format Time: 0.0014 seconds] -->

<hr>
<p><strong>Solution:</strong></p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let getCountdownIterator = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;let i = 10;
&nbsp;&nbsp;&nbsp;&nbsp;while( i &gt; 1 ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield --i;
&nbsp;&nbsp;&nbsp;&nbsp;}
}
&nbsp;
console.log( [ ...getCountdownIterator() ] );
&gt; [9, 8, 7, 6, 5, 4, 3, 2, 1]
&nbsp;
</pre>
<!-- [Format Time: 0.0019 seconds] -->

<p>The generator function yields the numbers <code>9</code> to <code>1</code>. The spread (<code>...</code>) operator consumes all values. Then the generator function returns <code>undefined</code>, ending the iteration process.</p>
<hr>
<p><strong>Exercise 3.</strong> Make the following object iterable:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let todoList = {
&nbsp;&nbsp;&nbsp;&nbsp;todoItems: [],
&nbsp;&nbsp;&nbsp;&nbsp;addItem( description ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems.push( { description, done: false } );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;crossOutItem( index ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( index &lt; this.todoItems.length ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems[index].done = true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;}
};
&nbsp;
todoList.addItem( 'task 1' ).addItem( 'task 2' ).crossOutItem( 0 );
&nbsp;
let iterableTodoList = // ???;
&nbsp;
for ( let item of iterableTodoList ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( item );
}
&nbsp;
// Without your code, you get the following error:
// Uncaught TypeError: todoList[Symbol.iterator] is not a function
&nbsp;
</pre>
<!-- [Format Time: 0.0032 seconds] -->

<hr>
<p><strong>First Solution (well known symbol):</strong></p>
<p>We could use well known symbols to make <em>todoList</em> iterable. We can add a <code>*[Symbol.iterator]</code> generator function that yields the elements of the array. This will make the <code>todoList</code> object iterable, yielding the elements of <code>todoItems</code> one by one.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let todoList = {
&nbsp;&nbsp;&nbsp;&nbsp;todoItems: [],
&nbsp;&nbsp;&nbsp;&nbsp;*[Symbol.iterator]() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield* this.todoItems;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;addItem( description ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems.push( { description, done: false } );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;crossOutItem( index ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( index &lt; this.todoItems.length ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems[index].done = true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;}
};
&nbsp;
let iterableTodoList = todoList;
&nbsp;
</pre>
<!-- [Format Time: 0.0028 seconds] -->

<hr>
<p><strong>Second solution (generator function)</strong>: If you prefer staying away from well known symbols, it is possible to make your code more semantic:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let todoList = {
&nbsp;&nbsp;&nbsp;&nbsp;todoItems: [],
&nbsp;&nbsp;&nbsp;&nbsp;addItem( description ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems.push( { description, done: false } );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;crossOutItem( index ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( index &lt; this.todoItems.length ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.todoItems[index].done = true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
&nbsp;&nbsp;&nbsp;&nbsp;}
};
&nbsp;
todoList.addItem( 'task 1' ).addItem( 'task 2' ).crossOutItem( 0 );
&nbsp;
let todoListGenerator = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;yield* todoList.todoItems;
}
&nbsp;
let iterableTodoList = todoListGenerator();
&nbsp;
</pre>
<!-- [Format Time: 0.0032 seconds] -->

<p>The first solution reads a bit like a hack. The second solution looks cleaner even if you have to type more characters.</p>
<hr>
<p><strong>Exercise 4.</strong> Determine the values logged to the console without running the code. Instead of just writing down the values, formulate your thought process and explain to yourself how the code runs line by line.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
let errorDemo = function *() {
&nbsp;&nbsp;&nbsp;&nbsp;yield 1;
&nbsp;&nbsp;&nbsp;&nbsp;throw 'Error yielding the next result';
&nbsp;&nbsp;&nbsp;&nbsp;yield 2;
}
&nbsp;
let it = errorDemo();
&nbsp;
// Execute one statement at a time to avoid
// skipping lines after the first thrown error.
&nbsp;
console.log( it.next() );
&nbsp;
console.log( it.next() );
&nbsp;
console.log( [...errorDemo()] );
&nbsp;
for ( let element of errorDemo() ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( element );
}
&nbsp;
</pre>
<!-- [Format Time: 0.0024 seconds] -->

<hr>
<p><strong>Solution:</strong></p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
console.log( it.next() );
&gt; Object {value: 1, done: false}
&nbsp;
console.log( it.next() );
&gt; Uncaught Error yielding the next result
&nbsp;
console.log( [...errorDemo()] );
&gt; Uncaught Error yielding the next result
&nbsp;
for ( let element of errorDemo() ) {
&nbsp;&nbsp;&nbsp;&nbsp;console.log( element );
}
&gt; Object {value: 1, done: false}
&gt; Uncaught Error yielding the next result
&nbsp;
</pre>
<!-- [Format Time: 0.0025 seconds] -->

<p>We created three iterables in total: <code>it</code>, one in the statement in the spread operator, and one in the <code>for-of</code> loop.</p>
<p>In the example with the <code>next</code> calls, the second call results in a thrown error.</p>
<p>In the spread operator example, the expression cannot be evaluated, because an error is thrown.</p>
<p>In the <code>for-of</code> example, the first element is printed out, then the error stopped the execution of the loop.</p>
<hr>
<p><strong>Exercise 5.</strong> Create an infinite sequence that generates the next value of the Fibonacci sequence.</p>
<p>The Fibonacci sequence is defined as follows:</p>
<ul>
<li><code>fib( 0 ) = 0</code></li>
<li><code>fib( 1 ) = 1</code></li>
<li>for <code>n &gt; 1</code>, <code>fib( n ) = fib( n - 1 ) + fib( n - 2 )</code></li>
</ul>
<hr>
<p><strong>Solution:</strong></p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
function *fibonacci() {
&nbsp;&nbsp;&nbsp;&nbsp;let a = 0, b = 1;
&nbsp;&nbsp;&nbsp;&nbsp;yield a;
&nbsp;&nbsp;&nbsp;&nbsp;yield b;
&nbsp;&nbsp;&nbsp;&nbsp;while( true ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[a, b] = [b, a+b];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield b;
&nbsp;&nbsp;&nbsp;&nbsp;}
}
&nbsp;
</pre>
<!-- [Format Time: 0.0017 seconds] -->

<p>Note that you only want to get the <code>next()</code> element of an infinite sequence. Executing <code>[...fibonacci()]</code> will skyrocket your CPU usage, speed up your CPU fan, and then crash your browser.</p>
<hr>
<p><strong>Exercise 6.</strong> Create a lazy <code>filter</code> generator function. Filter the elements of the Fibonacci sequence by keeping the even values only.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
function *filter( iterable, filterFunction ) {
&nbsp;&nbsp;&nbsp;&nbsp;// insert code here
}
&nbsp;
</pre>
<!-- [Format Time: 0.0005 seconds] -->

<hr>
<p><strong>Solution:</strong></p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
function *filter( iterable, filterFunction ) {
&nbsp;&nbsp;&nbsp;&nbsp;for( let element of iterable ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( filterFunction( element ) ) yield element;
&nbsp;&nbsp;&nbsp;&nbsp;}
}
&nbsp;
let evenFibonacci = filter( fibonacci(), x =&gt; x%2 === 0 );
&nbsp;
</pre>
<!-- [Format Time: 0.0017 seconds] -->

<p>Notice how easy it is to combine generators and lazily evaluate them.</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<pre>&nbsp;
evenFibonacci.next()
&gt; {value: 0, done: false}
evenFibonacci.next()
&gt; {value: 2, done: false}
evenFibonacci.next()
&gt; {value: 8, done: false}
evenFibonacci.next()
&gt; {value: 34, done: false}
evenFibonacci.next()
&gt; {value: 144, done: false}
&nbsp;
</pre>
<!-- [Format Time: 0.0022 seconds] -->

<p>Lazy evaluation is essential when we work on a large set of data. For instance, if you have 1000 accounts, chances are that you don't want to transform all of them if you just want to render the first ten on screen. This is when lazy evaluation comes into play.</p>
<p><i>If you would like to get five more chapters of this book, click <code>YES</code> below, and sign up.</i></p>
	




            <!-- Share buttons by mashshare.net - Version: 3.3.6-->                                      </section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-47" name="t-47"></a><h1>47 : What you should know about JavaScript regular expressions</h1>
					<div class="tutorial__content">
						<span>http://bjorn.tipling.com/state-and-regular-expressions-in-javascript</span>
<p>Regular expressions in JavaScript may not always be intuitive. I aim to provide some clarity by providing examples about things I have found myself getting stuck on. This post covers a few topics including state in regular expressions, regular expression performance and various things that have tripped me up.</p>

<hr>
<h2 id="regular-expressions-are-stateful_2"><a class="head_anchor" href="#regular-expressions-are-stateful_2">&nbsp;</a>regular expressions are stateful</h2>
<p>Regular expression objects maintain state. For example, the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec"><code class="prettyprint">exec</code></a> method is not <a href="http://en.wikipedia.org/wiki/Idempotence">idempotent</a>, successive calls may return different results. Calls to <code class="prettyprint">exec</code> have this behavior because the regular expression object remembers the last position it searched from when the global flag is set to true.</p>

<p>As an example, examine the following code:</p>

<pre><code class="prettyprint">var res, text = "foo1 bar1 foo2 bar \n foo3 bar2",
    regexp = /foo\d (bar\d?)/g;


console.log("regexp.lastIndex:", regexp.lastIndex);
while (res = regexp.exec(text)) {
    console.log("regexp.lastIndex:", regexp.lastIndex, 
                "index:", res.index,
                "res[0]:", res[0],
                "res[1]:", res[1]);
}
console.log("regexp.lastIndex:", regexp.lastIndex);
</code></pre>

<p><a href="http://jsfiddle.net/btipling/zjnw73sj/8/">jsfiddle</a></p>

<p>The log prints:</p>

<pre><code class="prettyprint">regexp.lastIndex: 0
regexp.lastIndex: 9 index: 0 res[0]: foo1 bar1 res[1]: bar1
regexp.lastIndex: 18 index: 10 res[0]: foo2 bar res[1]: bar
regexp.lastIndex: 30 index: 21 res[0]: foo3 bar2 res[1]: bar2
regexp.lastIndex: 0 
</code></pre>

<p>The most important thing in this bit of code is that we are calling <code class="prettyprint">regexp.exec</code> in a <code class="prettyprint">while</code> loop multiple times, and on each call it returns a different result.</p>

<p>The variable <code class="prettyprint">text</code> contains a string that we want to search.  The variable <code class="prettyprint">regexp</code> contains a regular expression literal <code class="prettyprint">/foo\d (bar\d?)/g</code> that searches for strings that contain the characters <code class="prettyprint">foo</code> followed by a numeric digit <code class="prettyprint">\d</code>, a space and the characters <code class="prettyprint">bar</code> which may or may not be followed by a digit <code class="prettyprint">\d?</code>. Also note the parenthesis around the <code class="prettyprint">(bar\d?)</code> portion, this creates a substring match. Finally the regular expression is terminated by a <code class="prettyprint">g</code>, which is a global flag that enables us to continue searching for more results after we find the first.</p>

<p>The state in a regular expression is captured by the <code class="prettyprint">lastIndex</code> property, which is the index of the character where the search starts on the next call to <code class="prettyprint">exec</code>. The <code class="prettyprint">lastIndex</code> starts at <code class="prettyprint">0</code> and is reset to <code class="prettyprint">0</code> when <code class="prettyprint">exec</code> finishes searching the text, at which point <code class="prettyprint">exec</code> will return <code class="prettyprint">null</code>. As the log indicates, the returned result array <code class="prettyprint">res</code> contains important information about what was found or <code class="prettyprint">null</code> if nothing was found. The returned array is special because in addition to results, it contains the properties <code class="prettyprint">index</code> and <code class="prettyprint">input</code> which provide the position of the match and the search pattern used.</p>

<p>If a <code class="prettyprint">while</code> loop is used to search a regular expression that does not contain a global flag the while loop will never finish if a match is found. It will only return that first match, forever. If you are not sure if the regular expression you are searching is global you can check the regular expression's <code class="prettyprint">global</code> property:</p>

<pre><code class="prettyprint">while (res = regexp.exec(text)) {
  // do something with res
  if (!regexp.global) {
   break;
  }
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/zjnw73sj/9/">jsfiddle</a></p>

<p>Using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test"><code class="prettyprint">test</code></a> method on a global regular expression also makes use of state. It will advance <code class="prettyprint">lastIndex</code> the same as <code class="prettyprint">exec</code>. <code class="prettyprint">test</code> returns <code class="prettyprint">true</code> or <code class="prettyprint">false</code> depending on whether a match was found. </p>

<p>Using <code class="prettyprint">test</code> is faster than <code class="prettyprint">exec</code>, thus a use case might be to check a string with <code class="prettyprint">test</code> first and only if something is found use <code class="prettyprint">exec</code>. This could lead to a mistake for a global regular expression as <code class="prettyprint">test</code> will have advanced <code class="prettyprint">lastIndex</code>. </p>

<pre><code class="prettyprint">var res, text = "foo1 bar1 foo2 bar \n foo3 bar2",
    regexp = /foo\d (bar\d?)/g;


while (regexp.test(text)) {
    res = regexp.exec(text);
    console.log("regexp.lastIndex:", regexp.lastIndex, 
                "index:", res.index,
                "res[0]:", res[0],
                "res[1]:", res[1]);
}

</code></pre>

<p><a href="http://jsfiddle.net/btipling/zjnw73sj/14/">jsfiddle</a></p>

<p>The result is missed results and finally a JavaScript error because we attempted to access properties on a <code class="prettyprint">null</code> object:</p>

<pre><code class="prettyprint">regexp.lastIndex: 18 index: 10 res[0]: foo2 bar res[1]: bar
Uncaught TypeError: Cannot read property 'index' of null 
</code></pre>

<p>You could reset <code class="prettyprint">lastIndex</code> to avoid this issue:</p>

<pre><code class="prettyprint">var res, text = "foo1 bar1 foo2 bar \n foo3 bar2",
    regexp = /foo\d (bar\d?)/g,
    lastIndex = 0;


while (regexp.test(text)) {
    regexp.lastIndex = lastIndex;
    res = regexp.exec(text);
    console.log("regexp.lastIndex:", regexp.lastIndex, 
                "index:", res.index,
                "res[0]:", res[0],
                "res[1]:", res[1]);
    lastIndex = regexp.lastIndex;
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/zjnw73sj/15/">jsfiddle</a></p>

<p>The extra cost of calling <code class="prettyprint">test</code> is not worth it, as explained in the performance section at the end of this post.  I only meant to demonstrate that <code class="prettyprint">test</code> and <code class="prettyprint">exec</code> both advance <code class="prettyprint">lastIndex</code>.</p>

<p>In the following bit of code you might expect only one result for each search since I have set the <code class="prettyprint">lastIndex</code> to begin at 3, but on the second test it finds 2 because <code class="prettyprint">lastIndex</code> was reset to <code class="prettyprint">0</code> at the end of the while loop when <code class="prettyprint">res</code> returned <code class="prettyprint">null</code>. <code class="prettyprint">lastIndex</code> is not reset to <code class="prettyprint">0</code> when you test a new string.</p>

<pre><code class="prettyprint">var texts = [
    "foo foo",
    "foo foo"
];
var regex = /foo/g;
regex.lastIndex = 3;

texts.forEach(function (text) {
    var count, res;
    count = 0;
    while (res = regex.test(text)) {
        count += 1;
    } 
    console.log("number of results found:", count);
});
</code></pre>

<p><a href="http://jsfiddle.net/zjnw73sj/25/">jsfiddle</a></p>

<p>Result:</p>

<pre><code class="prettyprint">"number of results found:" 1 
"number of results found:" 2
</code></pre>

<p>To fix this put the <code class="prettyprint">regex.lastIndex = 3;</code> right before each use of <code class="prettyprint">test</code>:</p>

<pre><code class="prettyprint">var texts = [
    "foo foo",
    "foo foo"
];
var regex = /foo/g;

texts.forEach(function (text) {
    var count, res;   
    regex.lastIndex = 3;
    count = 0;
    while (res = regex.test(text)) {
        count += 1;
    } 
    console.log("number of results found:", count);
});
</code></pre>

<p><a href="http://jsfiddle.net/zjnw73sj/26/">jsfiddle</a></p>

<p>Result:</p>

<pre><code class="prettyprint">"number of results found:" 1 
"number of results found:" 1 
</code></pre>

<p>ECMAScript 6 (harmony) adds a new stateful flag for regular expressions, the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/sticky">sticky</a> flag. This flag is currently, as of August 2014, only implemented in Firefox. The sticky flag is provided by setting the <code class="prettyprint">y</code> flag in a regular expression like so: <code class="prettyprint">/foo/y</code>. The sticky flag advances lastIndex like <code class="prettyprint">g</code> but only if a match is found starting at <code class="prettyprint">lastIndex</code>, there is no forward search. The sticky flag was added to <a href="http://wiki.ecmascript.org/doku.php?id=harmony:regexp_y_flag">improve the performance</a> of writing lexical analyzers using JavaScript, but as the MDN documentation indicates, it could be used to require a regular expression match starting at position <em>n</em> where <em>n</em> is what <code class="prettyprint">lastIndex</code> is set to. In the case of a non-multiline regular expression, a <code class="prettyprint">lastIndex</code> value of 0 with the sticky flag would be in effect the same as starting the regular expression with <code class="prettyprint">^</code> which requires the match to start at the beginning of the text searched. </p>

<p>The following code demonstrates an example of using sticky, note it may only work in Firefox:</p>

<pre><code class="prettyprint">var searchStrings, stickyRegexp;

stickyRegexp = /foo/y;

searchStrings = [
    "foo",
    " foo",
    "  foo",
];
searchStrings.forEach(function(text, index) {
    stickyRegexp.lastIndex = 1;
    console.log("found a match at", index, ":", stickyRegexp.test(text));
});
</code></pre>

<p><a href="http://jsfiddle.net/zjnw73sj/28/">jsfiddle</a> <em>(firefox only)</em></p>

<p>Result:</p>

<pre><code class="prettyprint">"found a match at" 0 ":" false
"found a match at" 1 ":" true
"found a match at" 2 ":" false
</code></pre>

<hr>
<h2 id="multiline-and-global-search_2"><a class="head_anchor" href="#multiline-and-global-search_2">&nbsp;</a>multiline and global search</h2>
<p>The confusion between multiline and global might be just a thing that afflicted me, so if you already understand the difference feel free to skip this section, it's pretty straight forward.  Multiline searches affect the way that the special regular expression characters <code class="prettyprint">^</code> and <code class="prettyprint">$</code> behave when the search string includes new lines. Multiline searches are enabled with the <code class="prettyprint">m</code> flag like so: <code class="prettyprint">/foo/m</code>. I can't explain it better than <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Advanced_Searching_With_Flags">the MDN documentation</a>:</p>
<blockquote class="large"><p>The m flag is used to specify that a multiline input string should be treated as multiple lines. If the m flag is used, ^ and $ match at the start or end of any line within the input string instead of the start or end of the entire string.</p>
</blockquote>
<p>Global searches on the other hand allow you to continue searching the entire search string after you have found the first result, to find additional results. It has nothing to do with <code class="prettyprint">^</code> and <code class="prettyprint">$</code> and it does not treat newlines as special.</p>

<p>Consider the following example:</p>

<pre><code class="prettyprint">var text, searches;

text = "foo \nfoo \nfoo ";
searches = [
 /^foo $/g , // finds 0 results
 /^foo $/m,  // finds only 1 result and stops
 /^foo $/mg, // the only regexp that finds 3 
 /foo \n/g,  // finds 2, but not the last
 /^foo \n/g, // finds only 1, the first
];

searches.forEach(function (search) {
  printSearches(search);
});

function printSearches(regex) {
    var res;
    console.log("searching with", regex);
    while (res = regex.exec(text)) {
        console.log(regex, "-&gt;", res);
        if (!regex.global) {
            break;
        }
    }
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/c0w5xj51/4/">jsfiddle</a></p>

<p>The function <code class="prettyprint">printSearches</code> uses a <code class="prettyprint">while</code> loop to search <code class="prettyprint">text</code> with <code class="prettyprint">exec</code> and logs the result. The search string <code class="prettyprint">text</code> has multiple new lines.</p>

<p>The first search <code class="prettyprint">/^foo $/g</code> would only match the string <code class="prettyprint">"foo "</code> and so it finds no results. </p>

<pre><code class="prettyprint">searching with /^foo $/g
</code></pre>

<p><code class="prettyprint">/^foo $/m</code>  prints only one result as it is not a global search and thus the while loop breaks on <code class="prettyprint">!regex.global</code>. Otherwise it would loop forever, printing the first result again and again. </p>

<pre><code class="prettyprint">searching with /^foo $/m
/^foo $/m "-&gt;" ["foo ", index: 0, input: "foo ↵foo ↵foo "]
</code></pre>

<p><code class="prettyprint">/^foo $/gm</code> finds each instance of "foo " in the search string as it is a global search. It continues to search the search string until it can find no more results.</p>

<pre><code class="prettyprint">searching with /^foo $/gm
/^foo $/gm "-&gt;" ["foo ", index: 0, input: "foo ↵foo ↵foo "]
/^foo $/gm "-&gt;" ["foo ", index: 5, input: "foo ↵foo ↵foo "]
/^foo $/gm "-&gt;" ["foo ", index: 10, input: "foo ↵foo ↵foo "]
</code></pre>

<p><code class="prettyprint">/foo \n/g</code> is not a substitute for a multiline search. It assumes a particular form of new line missing out on <code class="prettyprint">\r\n</code>, doesn't find last "foo" at the end of the string and could lead to other problems because of the lack of a <code class="prettyprint">^</code>. </p>

<pre><code class="prettyprint">searching with /foo \n/g
/foo \n/g "-&gt;" ["foo ↵", index: 0, input: "foo ↵foo ↵foo "]
/foo \n/g "-&gt;" ["foo ↵", index: 5, input: "foo ↵foo ↵foo "]
</code></pre>

<p><code class="prettyprint">/^foo \n/</code> only finds the first foo as <code class="prettyprint">^</code> will only match the start of the string, not a line, in a non-multiline search.</p>

<pre><code class="prettyprint">searching with /^foo \n/g
/^foo \n/g "-&gt;" ["foo ↵", index: 0, input: "foo ↵foo ↵foo "] 
</code></pre>

<hr>
<h2 id="greedy-vs-nongreedy_2"><a class="head_anchor" href="#greedy-vs-nongreedy_2">&nbsp;</a>greedy vs non-greedy</h2>
<p>Greediness and regular expressions is not really a JavaScript specific topic but I thought I would mention it here anyway because knowing about greedy versus non-greedy is really useful. The greediness of a regular expression affects how "zero or more" <code class="prettyprint">*</code> or "one or more" <code class="prettyprint">+</code> qualifiers behave. The default behavior for these is greedy. To toggle non-greedy apply a question mark at the end as such: <code class="prettyprint">*?</code> or <code class="prettyprint">+?</code>. To understand how these behave look at this code which reuses the <code class="prettyprint">printSearches</code> function defined above:</p>

<pre><code class="prettyprint">var text = "foo bar foo bar foo bar",
    greedyRegexp = /foo.*bar/g,
    nonGreedyRegexp = /foo.*?bar/g;

printSearches(greedyRegexp);
printSearches(nonGreedyRegexp);
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hfnr210x/">jsfiddle</a></p>

<p>The <code class="prettyprint">text</code> we are searching has a repeated pattern for "foo bar". <code class="prettyprint">greedyRegexp</code> will find only a single result, the entire string as <code class="prettyprint">.*</code> will capture until the last "bar" is encountered.</p>

<pre><code class="prettyprint">searching with /foo.*bar/g
/foo.*bar/g "-&gt;" ["foo bar foo bar foo bar", index: 0, input: "foo bar foo bar foo bar"] 
</code></pre>

<p><code class="prettyprint">nonGreedyRegexp</code> instead finds each instance of "foo bar", non-greedy will end after it has found the first "bar" that satisfy the regular expression.</p>

<pre><code class="prettyprint">searching with /foo.*?bar/g
/foo.*?bar/g "-&gt;" ["foo bar", index: 0, input: "foo bar foo bar foo bar"] 
/foo.*?bar/g "-&gt;" ["foo bar", index: 8, input: "foo bar foo bar foo bar"] 
/foo.*?bar/g "-&gt;" ["foo bar", index: 16, input: "foo bar foo bar foo bar"] 
</code></pre>

<p>I think an image might help to demonstrate the difference between greedy and non-greedy:</p>

<p><a href="https://svbtleusercontent.com/d80xcghiim7qw.png"><img src="https://svbtleusercontent.com/d80xcghiim7qw_small.png" alt="/foo.*bar/ matches *foo bar foo bar foo bar* and /foo.*?bar/ matches *foo bar* foo bar foo bar"></a></p>

<p><code class="prettyprint">/foo.*bar/</code>  is greedy and matches "<strong>foo bar foo bar foo bar</strong>" while <code class="prettyprint">/foo.*?bar/</code> is not greedy and matches "<strong>foo bar</strong> foo bar foo bar".</p>

<p>This StackOverflow question has some pretty good answers with more information: <a href="http://stackoverflow.com/questions/2824302/how-to-make-regular-expression-into-non-greedy">how to make Regular expression into non-greedy?</a></p>

<hr>
<h2 id="constructors-versus-literals_2"><a class="head_anchor" href="#constructors-versus-literals_2">&nbsp;</a>constructors versus literals</h2>
<p>Regular expressions can be created with the literal syntax such as:</p>

<pre><code class="prettyprint">var regexp = /foo.*bar/gi`
</code></pre>

<p>Or you can create one with the constructor <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">RegExp</a>:</p>

<pre><code class="prettyprint">var regexp = new RegExp("foo.*bar", "gi");
</code></pre>

<p>Literal regular expressions are evaluated only once at evaluation time while the constructor is evaluated at runtime, thus unless you need to dynamically create a regular expression use the literal syntax. A dynamic regular expression can be useful, here's an example where I make use of a literal and a dynamic to pull out brands and heroes from a string with comic book heroes:</p>

<pre><code class="prettyprint">var text = "DC: Batgirl, Marvel: Rogue, Image: Spawn, Image: Celestine, Marvel: Iron Man, DC: Superman, Image: Ant",
    brandRegexp = /(^|, )(\S+):/g, 
    regexp, brands, res, heroes, brand;

brands = {};
while (res = brandRegexp.exec(text)) {
    brand = res[2];
    brands[brand] ? brands[brand]++ : brands[brand] = 1;
}
for (brand in brands) { 
    regexp = new RegExp(brand + ": ([\\S ]+?)(,|$)","g");
    heroes = [];
    while (res = regexp.exec(text)) {
        heroes.push(res[1]);
    }
    console.log("Found", brands[brand], "heroes for", brand, "comics:", heroes.join(", "));
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hfnr210x/13/">jsfiddle</a></p>

<p>Result:</p>

<pre><code class="prettyprint">Found 2 heroes for DC comics: Batgirl, Superman
Found 2 heroes for Marvel comics: Rogue, Iron Man
Found 3 heroes for Image comics: Spawn, Celestine, Ant
</code></pre>

<p>You could just use <a href="http://jsfiddle.net/btipling/hfnr210x/15/">a single literal regular expression</a> here and that would make the code cleaner and be more efficient but I wanted to demonstrate both ways of creating regular expressions.</p>

<hr>
<h2 id="split-search-match-and-replace_2"><a class="head_anchor" href="#split-search-match-and-replace_2">&nbsp;</a>split, search, match and replace</h2>
<p>Various methods are available on strings that can take regular expressions as arguments. For example the <code class="prettyprint">split</code> method can take a string or a regular expression as an argument. This might be useful if you wanted to split a string on any kind of whitespace:</p>

<pre><code class="prettyprint">var text = "apples oranges      bananas\n\n\nstrawberries \tplums";

console.log(text.split(/\s+/));
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hfnr210x/17/">jsfiddle</a></p>

<p>This finds all the fruit and trims the whitespace:</p>

<pre><code class="prettyprint">["apples", "oranges", "bananas", "strawberries", "plums"]
</code></pre>

<p>The <code class="prettyprint">search</code> string method finds the index for the first match or <code class="prettyprint">-1</code> if a match wasn't found. It's similar to <code class="prettyprint">indexOf</code> except you can use a regular expression for a more powerful search. </p>

<pre><code class="prettyprint">var text = "foo bar";

console.log(text.indexOf("bar")); //logs 4
console.log(text.search(/bar/));  //also logs 4
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hfnr210x/19/">jsfiddle</a></p>

<p>The <code class="prettyprint">match</code> string method returns an array with results. It can return all of the matches for a regular expression if you use the <code class="prettyprint">g</code> global flag. This might be an alternative to iterative calls with <code class="prettyprint">exec</code> .</p>

<pre><code class="prettyprint">var text = "foo bar foo bar foo bar";

console.log(text.match(/foo.*bar/));   //greedy
console.log(text.match(/foo.*?bar/));  //non-greedy, only 1 result
console.log(text.match(/foo.*?bar/g)); //non-greedy, all results
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hfnr210x/21/">jsfiddle</a></p>

<p>The results are:</p>

<pre><code class="prettyprint">["foo bar foo bar foo bar", index: 0, input: "foo bar foo bar foo bar"] 
["foo bar", index: 0, input: "foo bar foo bar foo bar"]
["foo bar", "foo bar", "foo bar"] 
</code></pre>

<p>Unlike the regular expression methods <code class="prettyprint">exec</code> and <code class="prettyprint">test</code>, the string methods <code class="prettyprint">match</code> and <code class="prettyprint">search</code> are not stateful and do not advance <code class="prettyprint">lastIndex</code> on the regular expression.</p>

<pre><code class="prettyprint">var text = "foo bar foo bar foo bar",
    globalRegexp = /foo.*?bar/g;

console.log(text.match(globalRegexp)); //non-greedy, all results
console.log(globalRegexp.lastIndex); //logs 0, lastIndex not advanced
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hfnr210x/24/">jsfiddle</a></p>

<p>The <code class="prettyprint">replace</code> method on strings takes a string or a regular expression as an argument. It returns a new string that has its text replaced, it does not modify the existing string. Use a global flag if you want all instances of the string replaced:</p>

<pre><code class="prettyprint">var text = "foo bar foo bar foo bar";

console.log(text.replace("bar", "BAR")); //only replaces first
console.log(text.replace(/bar/, "BAR")); //only replaces first
console.log(text.replace(/bar/g, "BAR")); //replaces all
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hfnr210x/25/">jsfiddle</a></p>

<p>Results:</p>

<pre><code class="prettyprint">foo BAR foo bar foo bar
foo BAR foo bar foo bar
foo BAR foo BAR foo BAR
</code></pre>

<p>Firefox's implementation of <code class="prettyprint">replace</code> allows specifying flags as an argument, but this will not work in other browsers. Set the flags on the regular expression instead.</p>

<hr>
<h2 id="regular-expressions-and-application-performan_2"><a class="head_anchor" href="#regular-expressions-and-application-performan_2">&nbsp;</a>regular expressions and application performance</h2>
<p>Creating a regular expression that is used multiple times once in the beginning is faster than creating the regular expression later, regardless whether a constructor or a regular expression literal was used. Using a literal regular expression is always faster than creating a regular expression with a constructor.</p>

<p><a href="http://jsperf.com/creating-regular-expressions">jsperf</a></p>

<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">MDN documentation</a> might lead one to assume that it is OK to define regular expressions in a loop since they're created at evaluation time and wont be recompiled:</p>
<blockquote class="large"><p>The literal notation provides compilation of the regular expression when the expression is evaluated. Use literal notation when the regular expression will remain constant. For example, if you use literal notation to construct a regular expression used in a loop, the regular expression won't be recompiled on each iteration.</p>
</blockquote>
<p>But defining the regular expression before the loop is much faster in Firefox and a little bit faster in Chrome.</p>

<p><a href="http://jsperf.com/creating-regular-expressions/2">jsperf</a></p>

<p>Using <code class="prettyprint">test</code> to check a string before <code class="prettyprint">exec</code> is probably not worth it.</p>

<p><a href="http://jsperf.com/testing-regular-expressions/2">jsperf</a></p>

<p><code class="prettyprint">test</code> is faster than <code class="prettyprint">exec</code> however.</p>

<p><a href="http://jsperf.com/regular-expressions-test-vs-exec">jsperf</a></p>

<p>Using <code class="prettyprint">search</code> to check a string before <code class="prettyprint">match</code> is also not worth it.</p>

<p><a href="http://jsperf.com/searching-regular-expressions">jsperf</a></p>

<p><code class="prettyprint">search</code> is faster than <code class="prettyprint">match</code></p>

<p><a href="http://jsperf.com/regular-expressions-search-vs-match">jsperf</a></p>

<p><code class="prettyprint">match</code> and <code class="prettyprint">exec</code> perform differently in different engines. In Chrome <code class="prettyprint">exec</code> seems to be faster than <code class="prettyprint">match</code> and in Firefox the reverse is true. If you wanted to get the number of results <code class="prettyprint">split</code> is your best bet in Firefox and <code class="prettyprint">exec</code> wins in Chrome.</p>

<p><a href="http://jsperf.com/regular-expressions-match-vs-exec">jsperf</a></p>

<p>If you want to replace text in a string <code class="prettyprint">replace</code> seems to be much faster than using <code class="prettyprint">split</code> and <code class="prettyprint">join</code> which make sense since <code class="prettyprint">split</code> creates a new array. This is true in both Firefox and Chrome.</p>

<p><a href="http://jsperf.com/replacing-with-regular-expressions">jsperf</a></p>

<hr>

<p>That rounds out an exploration of regular expressions in JavaScript. Some of these things never seemed intuitive to me. Ultimately in most scenarios it is probably best to avoid using regular expressions and solve the problem some other way, unless you want to replace text in a string that is.</p>

					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-48" name="t-48"></a><h1>48 : all this</h1>
					<div class="tutorial__content">
					<span>http://bjorn.tipling.com/all-this</span>
					
<p>Coming from a sane language you might think that <code class="prettyprint">this</code> in JavaScript is kind of like <code class="prettyprint">this</code> in an object oriented language like Java, something that refers to values stored in instance properties. Not so. In JavaScript it is best to think of the <code class="prettyprint">this</code> as a <a href="http://harrypotter.wikia.com/wiki/Boggart">boggart</a> carrying a bag of data with an <a href="http://harrypotter.wikia.com/wiki/Undetectable_Extension_Charm">undetectable extension charm</a>. </p>

<p>What follows is what I would want my co-workers to know about using <code class="prettyprint">this</code> in JavaScript. It's a lot and much of it took me years to learn.</p>

<hr>
<h2 id="global-this_2"><a class="head_anchor" href="#global-this_2">&nbsp;</a>global this</h2>
<p>In a browser, at the global scope, <code class="prettyprint">this</code> is the <code class="prettyprint">window</code> object.</p>

<pre><code class="prettyprint">&lt;script type="text/javascript"&gt;
console.log(this === window); //true
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/hL9emz4m/">jsfiddle</a>  </p>

<p>In a browser, using <code class="prettyprint">var</code> at the global scope is the same as assigning to <code class="prettyprint">this</code> or <code class="prettyprint">window</code>.</p>

<pre><code class="prettyprint">&lt;script type="text/javascript"&gt;
    var foo = "bar";
    console.log(this.foo); //logs "bar"
    console.log(window.foo); //logs "bar"
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/1/">jsfiddle</a></p>

<p>If you create a new variable without using <code class="prettyprint">var</code> or <code class="prettyprint">let</code> (ECMAScript 6) you are adding or changing a property on the global <code class="prettyprint">this</code>.</p>

<pre><code class="prettyprint">&lt;script type="text/javascript"&gt;
    foo = "bar";

    function testThis() {
      foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    testThis();
    console.log(this.foo); //logs "foo"
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/3/">jsfiddle</a></p>

<p>In node using the repl, <code class="prettyprint">this</code> is the top namespace. You can refer to it as <code class="prettyprint">global</code>.</p>

<pre><code class="prettyprint">&gt; this
{ ArrayBuffer: [Function: ArrayBuffer],
  Int8Array: { [Function: Int8Array] BYTES_PER_ELEMENT: 1 },
  Uint8Array: { [Function: Uint8Array] BYTES_PER_ELEMENT: 1 },
  ...
&gt; global === this
true
</code></pre>

<p>In node executing from a script, <code class="prettyprint">this</code> at the global scope starts as an empty object. It is not the same as <code class="prettyprint">global</code>.</p>

<p>test.js:</p>

<pre><code class="prettyprint">console.log(this);
console.log(this === global);
</code></pre>

<pre><code class="prettyprint">$ node test.js
{}
false
</code></pre>

<p>In node, <code class="prettyprint">var</code> at the global scope does not assign to <code class="prettyprint">this</code> like it does in a browser when you are executing it as a script from a file…</p>

<p>test.js:</p>

<pre><code class="prettyprint">var foo = "bar";
console.log(this.foo);
</code></pre>

<pre><code class="prettyprint">$ node test.js
undefined
</code></pre>

<p>…but it does if you're doing that from the node repl.</p>

<pre><code class="prettyprint">&gt; var foo = "bar";
&gt; this.foo
bar
&gt; global.foo
bar
</code></pre>

<p>In node, using a script, creating a variable without <code class="prettyprint">var</code> or <code class="prettyprint">let</code> will add that variable to <code class="prettyprint">global</code> but not to the <code class="prettyprint">this</code> at the top of the script's scope.</p>

<p>test.js:</p>

<pre><code class="prettyprint">foo = "bar";
console.log(this.foo);
console.log(global.foo);
</code></pre>

<pre><code class="prettyprint">$ node test.js
undefined
bar
</code></pre>

<p>In a node repl, it will assign it to both.</p>

<hr>
<h2 id="function-this_2"><a class="head_anchor" href="#function-this_2">&nbsp;</a>function this</h2>
<p>Except in the case of DOM event handlers or when a <code class="prettyprint">thisArg</code> is provided (see further down), both in node and in a browser using <code class="prettyprint">this</code> in a function that is not called with <code class="prettyprint">new</code> references the global scope…</p>

<pre><code class="prettyprint">&lt;script type="text/javascript"&gt;
    foo = "bar";

    function testThis() {
      this.foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    testThis();
    console.log(this.foo); //logs "foo"
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/4/">jsfiddle</a></p>

<p>test.js:</p>

<pre><code class="prettyprint">foo = "bar";

function testThis () {
  this.foo = "foo";
}

console.log(global.foo);
testThis();
console.log(global.foo);
</code></pre>

<pre><code class="prettyprint">$ node test.js
bar
foo
</code></pre>

<p>…unless you use <code class="prettyprint">"use strict";</code> in which case <code class="prettyprint">this</code> will be <code class="prettyprint">undefined</code>.</p>

<pre><code class="prettyprint">&lt;script type="text/javascript"&gt;
    foo = "bar";

    function testThis() {
      "use strict";
      this.foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    testThis();  //Uncaught TypeError: Cannot set property 'foo' of undefined 
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/51/">jsfiddle</a></p>

<p>If you call a function with <code class="prettyprint">new</code> the <code class="prettyprint">this</code> will be a new context, it will not reference the global <code class="prettyprint">this</code>.</p>

<pre><code class="prettyprint">&lt;script type="text/javascript"&gt;
    foo = "bar";

    function testThis() {
      this.foo = "foo";
    }

    console.log(this.foo); //logs "bar"
    new testThis();
    console.log(this.foo); //logs "bar"

    console.log(new testThis().foo); //logs "foo"
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/6/">jsfiddle</a></p>

<p>I like to call this new context an instance.</p>

<hr>
<h2 id="prototype-this_2"><a class="head_anchor" href="#prototype-this_2">&nbsp;</a>prototype this</h2>
<p>Functions you create become function objects. They automatically get a special <code class="prettyprint">prototype</code> property, which is something you can assign values to. When you create an instance by calling your function with <code class="prettyprint">new</code> you get access to the values you assigned to the <code class="prettyprint">prototype</code> property. You access those values using <code class="prettyprint">this</code>.</p>

<pre><code class="prettyprint">    function Thing() {
      console.log(this.foo);
    }

    Thing.prototype.foo = "bar";

    var thing = new Thing(); //logs "bar"
    console.log(thing.foo);  //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/8/">jsfiddle</a></p>

<p>If you create multiple new instances with <code class="prettyprint">new</code> each of these will all share the the same value for values defined on the <code class="prettyprint">prototype</code>. For example they will all return the same value when using <code class="prettyprint">this.foo</code> unless you override <code class="prettyprint">this.foo</code> inside the individual instances.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {
    console.log(this.foo);
}
Thing.prototype.setFoo = function (newFoo) {
    this.foo = newFoo;
}

var thing1 = new Thing();
var thing2 = new Thing();

thing1.logFoo(); //logs "bar"
thing2.logFoo(); //logs "bar"

thing1.setFoo("foo");
thing1.logFoo(); //logs "foo";
thing2.logFoo(); //logs "bar";

thing2.foo = "foobar";
thing1.logFoo(); //logs "foo";
thing2.logFoo(); //logs "foobar";
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/9/">jsfiddle</a></p>

<p>The <code class="prettyprint">this</code> in an instance is a special kind of object, <code class="prettyprint">this</code> is in fact a key word. You can think of <code class="prettyprint">this</code> as a way to access values defined on the <code class="prettyprint">prototype</code>, but assigning directly to <code class="prettyprint">this</code> inside an instance will hide the value on the <code class="prettyprint">prototype</code> from the instance. You can get access back to the <code class="prettyprint">prototype</code> value by deleting what you put on <code class="prettyprint">this</code> inside the instance…</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {
    console.log(this.foo);
}
Thing.prototype.setFoo = function (newFoo) {
    this.foo = newFoo;
}
Thing.prototype.deleteFoo = function () {
    delete this.foo;
}

var thing = new Thing();
thing.setFoo("foo");
thing.logFoo(); //logs "foo";
thing.deleteFoo();
thing.logFoo(); //logs "bar";
thing.foo = "foobar";
thing.logFoo(); //logs "foobar";
delete thing.foo;
thing.logFoo(); //logs "bar";
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/11/">jsfiddle</a></p>

<p>…or just reference the function object's prototype directly.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {
    console.log(this.foo, Thing.prototype.foo);
}

var thing = new Thing();
thing.foo = "foo";
thing.logFoo(); //logs "foo bar";
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/12/">jsfiddle</a></p>

<p>Instances created with the same function all share access to the same exact values on the <code class="prettyprint">prototype</code>. If you assign an array to the <code class="prettyprint">prototype</code> all instances are sharing access to that same array. Unless you override it inside the instance in which case you have hidden it.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.things = [];


var thing1 = new Thing();
var thing2 = new Thing();
thing1.things.push("foo");
console.log(thing2.things); //logs ["foo"]
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/13/">jsfiddle</a></p>

<p>It is usually a mistake to assign arrays or objects on the <code class="prettyprint">prototype</code>. If you want instances to each have their own arrays, create them in the function, not the prototype.</p>

<pre><code class="prettyprint">function Thing() {
    this.things = [];
}


var thing1 = new Thing();
var thing2 = new Thing();
thing1.things.push("foo");
console.log(thing1.things); //logs ["foo"]
console.log(thing2.things); //logs []
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/14/">jsfiddle</a></p>

<p>You can actually chain the <code class="prettyprint">prototype</code> of many functions together to form a <code class="prettyprint">prototype chain</code> so that the special magic of <code class="prettyprint">this</code> will walk up the <code class="prettyprint">prototype chain</code> until it has found a value you are trying to reference.</p>

<pre><code class="prettyprint">function Thing1() {
}
Thing1.prototype.foo = "bar";

function Thing2() {
}
Thing2.prototype = new Thing1();


var thing = new Thing2();
console.log(thing.foo); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/15/">jsfiddle</a></p>

<p>Some people use this to simulate classical object oriented inheritance in JavaScript.</p>

<p>Any assignments to <code class="prettyprint">this</code> in functions used to create the <code class="prettyprint">prototype chain</code> will hide values defined further up the <code class="prettyprint">prototype chain</code>.</p>

<pre><code class="prettyprint">function Thing1() {
}
Thing1.prototype.foo = "bar";

function Thing2() {
    this.foo = "foo";
}
Thing2.prototype = new Thing1();

function Thing3() {
}
Thing3.prototype = new Thing2();


var thing = new Thing3();
console.log(thing.foo); //logs "foo"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/16/">jsfiddle</a></p>

<p>I like to call functions assigned to the <code class="prettyprint">prototype</code> "methods". I used methods in some examples above, like <code class="prettyprint">logFoo</code>. These methods get the same magic <code class="prettyprint">this</code> prototype lookup as the original function used to create the instance. I usually refer to the original function as the constructor.</p>

<p>The use of <code class="prettyprint">this</code> in methods defined on a <code class="prettyprint">prototype</code> further up the <code class="prettyprint">prototype chain</code> refer to the <code class="prettyprint">this</code> of the current instance. This means if you have hidden a value on the <code class="prettyprint">prototype chain</code> by assigning to <code class="prettyprint">this</code> directly, any of the methods available to the instance will use this new value regardless of what <code class="prettyprint">prototype</code> that method was assigned to.</p>

<pre><code class="prettyprint">function Thing1() {
}
Thing1.prototype.foo = "bar";
Thing1.prototype.logFoo = function () {
    console.log(this.foo);
}

function Thing2() {
    this.foo = "foo";
}
Thing2.prototype = new Thing1();


var thing = new Thing2();
thing.logFoo(); //logs "foo";
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/17/">jsfiddle</a></p>

<p>In JavaScript you can nest functions, that is you can define functions inside functions. While nested functions capture variables defined in parent functions in a closure, they do not inherit the <code class="prettyprint">this</code>.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {
    var info = "attempting to log this.foo:";
    function doIt() {
        console.log(info, this.foo);
    }
    doIt();
}


var thing = new Thing();
thing.logFoo();  //logs "attempting to log this.foo: undefined"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/21/">jsfiddle</a></p>

<p>The <code class="prettyprint">this</code> in <code class="prettyprint">doIt</code> is the <code class="prettyprint">global</code> object or <code class="prettyprint">undefined</code> in the case of <code class="prettyprint">"use strict";</code> This is a source of much pain for many people not familiar with <code class="prettyprint">this</code> in JavaScript.</p>

<p>It gets worse. Assigning an instance's method as a value, like say you passed the method as an argument to a function, does not also pass its instance. The <code class="prettyprint">this</code> context in a method reverts to a reference to the <code class="prettyprint">global</code> object, or <code class="prettyprint">undefined</code> in the case of <code class="prettyprint">"use strict";</code>, when this happens.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {  
    console.log(this.foo);   
}

function doIt(method) {
    method();
}


var thing = new Thing();
thing.logFoo(); //logs "bar"
doIt(thing.logFoo); //logs undefined
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/22/">jsfiddle</a></p>

<p>Some people prefer to capture <code class="prettyprint">this</code> in a variable, usually called "self" and avoid <code class="prettyprint">this</code> altogether…</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {
    var self = this;
    var info = "attempting to log this.foo:";
    function doIt() {
        console.log(info, self.foo);
    }
    doIt();
}


var thing = new Thing();
thing.logFoo();  //logs "attempting to log this.foo: bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/23/">jsfiddle</a></p>

<p>…but this will not save you in the case you need to pass the method around as a value.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () { 
    var self = this;
    function doIt() {
        console.log(self.foo);
    }
    doIt();
}

function doItIndirectly(method) {
    method();
}


var thing = new Thing();
thing.logFoo(); //logs "bar"
doItIndirectly(thing.logFoo); //logs undefined
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/24/">jsfiddle</a></p>

<p>You can pass the instance with the method by using <code class="prettyprint">bind</code>, a function defined on the function object for all functions and methods.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () { 
    console.log(this.foo);
}

function doIt(method) {
    method();
}


var thing = new Thing();
doIt(thing.logFoo.bind(thing)); //logs bar
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/25/">jsfiddle</a></p>

<p>You can also use <code class="prettyprint">apply</code> and <code class="prettyprint">call</code> to call the method or function immediately with a new context.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () { 
    function doIt() {
        console.log(this.foo);
    }
    doIt.apply(this);
}

function doItIndirectly(method) {
    method();
}


var thing = new Thing();
doItIndirectly(thing.logFoo.bind(thing)); //logs bar
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/26/">jsfiddle</a></p>

<p>You can use <code class="prettyprint">bind</code> to replace the <code class="prettyprint">this</code> for any function or method, even if it was not assigned to instance's original prototype.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";


function logFoo(aStr) {
    console.log(aStr, this.foo);
}


var thing = new Thing();
logFoo.bind(thing)("using bind"); //logs "using bind bar"
logFoo.apply(thing, ["using apply"]); //logs "using apply bar"
logFoo.call(thing, "using call"); //logs "using call bar"
logFoo("using nothing"); //logs "using nothing undefined"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/27/">jsfiddle</a></p>

<p>You are going to want to avoid returning anything from your constructor, because it may replace what the resulting instance is.</p>

<pre><code class="prettyprint">function Thing() {
    return {};
}
Thing.prototype.foo = "bar";


Thing.prototype.logFoo = function () {
    console.log(this.foo);
}


var thing = new Thing();
thing.logFoo(); //Uncaught TypeError: undefined is not a function
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/28/">jsfiddle</a></p>

<p>Strangely, if you return a primitive value like a string or a number from a constructor this wont happen and the return statement is ignored. It is best to never return anything from a constructor you intend to call with <code class="prettyprint">new</code> even if you know what you are doing. If you want to create a factory pattern, use a function to create instances and don't call it with <code class="prettyprint">new</code>. This advice is only an opinion however.</p>

<p>You can avoid using <code class="prettyprint">new</code> and instead use <code class="prettyprint">Object.create</code>. This also creates an instance.</p>

<pre><code class="prettyprint">function Thing() {
}
Thing.prototype.foo = "bar";


Thing.prototype.logFoo = function () {
    console.log(this.foo);
}


var thing =  Object.create(Thing.prototype);
thing.logFoo(); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/29/">jsfiddle</a></p>

<p>This will not call the constructor however.</p>

<pre><code class="prettyprint">function Thing() {
    this.foo = "foo";
}
Thing.prototype.foo = "bar";


Thing.prototype.logFoo = function () {
    console.log(this.foo);
}


var thing =  Object.create(Thing.prototype);
thing.logFoo(); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/30/">jsfiddle</a></p>

<p>Because <code class="prettyprint">Object.create</code> does not call the constructor it is really useful for creating an inheritance pattern in which you want to override constructors further up the prototype chain.</p>

<pre><code class="prettyprint">function Thing1() {
    this.foo = "foo";
}
Thing1.prototype.foo = "bar";

function Thing2() {
    this.logFoo(); //logs "bar"
    Thing1.apply(this);
    this.logFoo(); //logs "foo"
}
Thing2.prototype = Object.create(Thing1.prototype);
Thing2.prototype.logFoo = function () {
    console.log(this.foo);
}

var thing = new Thing2();
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/32/">jsfiddle</a></p>

<hr>
<h2 id="object-this_2"><a class="head_anchor" href="#object-this_2">&nbsp;</a>object this</h2>
<p>You can use <code class="prettyprint">this</code> in any function on an object to refer to other properties on that object. This is not the same as an instance created with <code class="prettyprint">new</code>.</p>

<pre><code class="prettyprint">var obj = {
    foo: "bar",
    logFoo: function () {
        console.log(this.foo);
    }
};

obj.logFoo(); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/33/">jsfiddle</a></p>

<p>Note, there was no use of <code class="prettyprint">new</code> , no <code class="prettyprint">Object.create</code> and no function called to create <code class="prettyprint">obj</code>. You can also bind to objects as if they were an instance.</p>

<pre><code class="prettyprint">var obj = {
    foo: "bar"
};

function logFoo() {
    console.log(this.foo);
}

logFoo.apply(obj); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/34/">jsfiddle</a></p>

<p>There is no walking up the object hierarchy when you use <code class="prettyprint">this</code> like this. Only properties shared on the immediate parent object are available via <code class="prettyprint">this</code>.</p>

<pre><code class="prettyprint">var obj = {
    foo: "bar",
    deeper: {
        logFoo: function () {
            console.log(this.foo);
        }
    }
};

obj.deeper.logFoo(); //logs undefined
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/35/">jsfiddle</a></p>

<p>You can just refer to the property you want directly however:</p>

<pre><code class="prettyprint">var obj = {
    foo: "bar",
    deeper: {
        logFoo: function () {
            console.log(obj.foo);
        }
    }
};

obj.deeper.logFoo(); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/36/">jsfiddle</a></p>
<h2 id="dom-event-this_2"><a class="head_anchor" href="#dom-event-this_2">&nbsp;</a>DOM event this</h2>
<p>In an HTML DOM event handler, <code class="prettyprint">this</code> is always a reference to the DOM element the event was attached to…</p>

<pre><code class="prettyprint">function Listener() {
    document.getElementById("foo").addEventListener("click",
       this.handleClick);
}
Listener.prototype.handleClick = function (event) {
    console.log(this); //logs "&lt;div id="foo"&gt;&lt;/div&gt;"
}

var listener = new Listener();
document.getElementById("foo").click();
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/37/">jsfiddle</a></p>

<p>…unless you <code class="prettyprint">bind</code> the context.</p>

<pre><code class="prettyprint">function Listener() {
    document.getElementById("foo").addEventListener("click", 
        this.handleClick.bind(this));
}
Listener.prototype.handleClick = function (event) {
    console.log(this); //logs Listener {handleClick: function}
}

var listener = new Listener();
document.getElementById("foo").click();
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/38/">jsfiddle</a></p>

<hr>
<h2 id="html-this_2"><a class="head_anchor" href="#html-this_2">&nbsp;</a>HTML this</h2>
<p>Inside HTML attributes in which you can put JavaScript, <code class="prettyprint">this</code> is a reference to the element.</p>

<pre><code class="prettyprint">&lt;div id="foo" onclick="console.log(this);"&gt;&lt;/div&gt;
&lt;script type="text/javascript"&gt;
document.getElementById("foo").click(); //logs &lt;div id="foo"...
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/40/">jsfiddle</a></p>
<h2 id="override-this_2"><a class="head_anchor" href="#override-this_2">&nbsp;</a>override this</h2>
<p>You cannot override <code class="prettyprint">this</code> as it is a key word.</p>

<pre><code class="prettyprint">function test () {
    var this = {};  // Uncaught SyntaxError: Unexpected token this 
}
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/41/">jsfiddle</a></p>

<hr>
<h2 id="eval-this_2"><a class="head_anchor" href="#eval-this_2">&nbsp;</a>eval this</h2>
<p>You can use <code class="prettyprint">eval</code> to access <code class="prettyprint">this</code>.</p>

<pre><code class="prettyprint">function Thing () {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {
    eval("console.log(this.foo)"); //logs "bar"
}

var thing = new Thing();
thing.logFoo();
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/43/">jsfiddle</a></p>

<p>This can be a security concern. There is no way to prevent this other than to not use <code class="prettyprint">eval</code>.</p>

<p>Functions created with <code class="prettyprint">Function</code> also can access <code class="prettyprint">this</code>:</p>

<pre><code class="prettyprint">function Thing () {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = new Function("console.log(this.foo);");

var thing = new Thing();
thing.logFoo(); //logs "bar"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/44/">jsfiddle</a></p>

<hr>
<h2 id="with-this_2"><a class="head_anchor" href="#with-this_2">&nbsp;</a>with this</h2>
<p>You can use <code class="prettyprint">with</code> to add <code class="prettyprint">this</code> to the current scope to read and write to values on <code class="prettyprint">this</code> without referring to <code class="prettyprint">this</code> explicitly.</p>

<pre><code class="prettyprint">function Thing () {
}
Thing.prototype.foo = "bar";
Thing.prototype.logFoo = function () {
    with (this) {
        console.log(foo);
        foo = "foo";
    }
}

var thing = new Thing();
thing.logFoo(); // logs "bar"
console.log(thing.foo); // logs "foo"
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/45/">jsfiddle</a></p>

<p>Many people believe this is bad because of ambiguity problems with <code class="prettyprint">with</code>.</p>

<hr>
<h2 id="jquery-this_2"><a class="head_anchor" href="#jquery-this_2">&nbsp;</a>jQuery this</h2>
<p>Like event handlers for HTML DOM elements, the <a href="http://jquery.com/">jQuery JavaScript library</a> will in many places have <code class="prettyprint">this</code> refer to a DOM element. This is true for event handlers and convenience methods such as <code class="prettyprint">$.each</code>.</p>

<pre><code class="prettyprint">&lt;div class="foo bar1"&gt;&lt;/div&gt;
&lt;div class="foo bar2"&gt;&lt;/div&gt;
&lt;script type="text/javascript"&gt;
$(".foo").each(function () {
    console.log(this); //logs &lt;div class="foo...
});
$(".foo").on("click", function () {
    console.log(this); //logs &lt;div class="foo...
});
$(".foo").each(function () {
    this.click();
});
&lt;/script&gt;
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/47/">jsfiddle</a>;</p>
<h2 id="thisarg-this_2"><a class="head_anchor" href="#t-hisarg-this_2">&nbsp;</a>thisArg this</h2>
<p>If you use <a href="http://underscorejs.org/">underscore.js</a> or <a href="http://lodash.com/">lo-dash</a> you may know that in many of the library methods you can pass in an instance, via a <code class="prettyprint">thisArg</code> function argument that will be used as the context for <code class="prettyprint">this</code>. This is true for <code class="prettyprint">_.each</code>  for example. Native methods found in JavaScript since ECMAScript 5 also allow for a <code class="prettyprint">thisArg</code>, like <code class="prettyprint">forEach</code>.  In fact, the previously demonstrated use of <code class="prettyprint">bind</code>, <code class="prettyprint">apply</code> and <code class="prettyprint">call</code> give you the opportunity to provide a <code class="prettyprint">thisArg</code>  that when used binds <code class="prettyprint">this</code> to the object passed in as the argument.</p>

<pre><code class="prettyprint">function Thing(type) {
    this.type = type;
}
Thing.prototype.log = function (thing) {
    console.log(this.type, thing);
}
Thing.prototype.logThings = function (arr) {
   arr.forEach(this.log, this); // logs "fruit apples..."
   _.each(arr, this.log, this); //logs "fruit apples..."
}

var thing = new Thing("fruit");
thing.logThings(["apples", "oranges", "strawberries", "bananas"]);
</code></pre>

<p><a href="http://jsfiddle.net/btipling/25xkmho7/50/">jsfiddle</a></p>

<p>This enables code to be a little bit cleaner without many nested bind statements and having to resort to using a "self" variable.</p>

<hr>

<p>Some programming languages can be simple to learn, for example the specification for the <a href="http://golang.org/">go programming language</a> can be read in a short time. Once the specification has been read, one understands the language, and there are few tricks or gotchas to be troubled about, barring implementation details.</p>

<p>JavaScript is not such a language. The specification is not very readable. There are many "gotchas", so many in fact that people talk about "<a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742">The Good Parts</a>." The best documentation is found on the <a href="https://developer.mozilla.org/en-US/">Mozilla Developer Network</a>. I recommend reading the documentation there about <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a> and to always prefix your Google searches for JavaScript with "mdn" to always get the best documentation. Static code analysis is also great help, for that I use <a href="http://www.jshint.com/">jshint</a>.</p>

<p>If I have made any mistakes or if you have any questions, please let me know I am @bjorntipling on Twitter.</p>

<p>Update: <br>
@hicksyfern has a simpler take that I like in his blog post <a href="http://tomhicks.github.io/code/2014/08/11/some-of-this.html"><em>some of this</em></a>.</p>
						
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-49" name="t-49"></a><h1>49 : Everything you wanted to know about JavaScript scope</h1>
					<div class="tutorial__content">
					<span>https://toddmotto.com/everything-you-wanted-to-know-about-javascript-scope/</span>
<section class="post__content">

<p>The JavaScript language has a few concepts of "scope", none of which are straightforward or easy to understand as a new JavaScript developer (and even some experienced JavaScript developers). This post is aimed at those wanting to learn about the many depths of JavaScript after hearing words such as <code class="highlighter-rouge">scope</code>, <code class="highlighter-rouge">closure</code>, <code class="highlighter-rouge">this</code>, <code class="highlighter-rouge">namespace</code>, <code class="highlighter-rouge">function scope</code>, <code class="highlighter-rouge">global scope</code>, <code class="highlighter-rouge">lexical scope</code> and <code class="highlighter-rouge">public/private scope</code>. Hopefully by reading this post you'll know the answers to:</p>
<ul>
<li>What is Scope?</li>
<li>What is Global/Local Scope?</li>
<li>What is a Namespace and how does it differ to Scope?</li>
<li>What is the <code class="highlighter-rouge">this</code> keyword and how does Scope affect it?</li>
<li>What is Function/Lexical Scope?</li>
<li>What are Closures?</li>
<li>What is Public/Private Scope?</li>
<li>How can I understand/create/do all of the above?</li>
</ul>
<h3 id="what-is-scope">
      <a href="#what-is-scope" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        What is Scope?
      </a>
    </h3>
<p>In JavaScript, scope refers to the current context of your code. Scopes can be <em>globally</em> or <em>locally</em> defined. Understanding JavaScript scope is key to writing bulletproof code and being a better developer. You'll understand where variables/functions are accessible, be able to change the scope of your code's context and be able to write faster and more maintainable code, as well as debug much faster.</p>
<p>Thinking about scope is easy, are we inside <code class="highlighter-rouge">Scope A</code> or <code class="highlighter-rouge">Scope B</code>?</p>
<h3 id="what-is-global-scope">
      <a href="#what-is-global-scope" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        What is Global Scope?
      </a>
    </h3>
<p>Before you write a line of JavaScript, you're in what we call the <code class="highlighter-rouge">Global Scope</code>. If we declare a variable, it's defined globally:</p>
<pre>// global scope
var name = 'Todd';</pre>
<p>Global scope is your best friend and your worst nightmare, learning to control your scopes is easy and in doing so, you''ll run into no issues with global scope problems (usually namespace clashes). You'll often hear people saying "Global Scope is <em>bad</em>", but never really justifying as to <em>why</em>. Global scope isn't bad, you need it to create Modules/APIs that are accessible across scopes, you must use it to your advantage and not cause issues.</p>
<p>Everyone's used jQuery before, as soon as you do this…</p>
<pre>jQuery('.myClass');</pre>
<p>… we're accessing jQuery in <em>global</em> scope, we can refer to this access as the <code class="highlighter-rouge">namespace</code>. The namespace is sometimes an interchangeable word for scope, but usually the refers to the highest level scope. In this case, <code class="highlighter-rouge">jQuery</code> is in the global scope, and is also our namespace. The <code class="highlighter-rouge">jQuery</code> namespace is defined in the global scope, which acts as a namespace for the jQuery library as everything inside it becomes a descendent of that namespace.</p>
<h3 id="what-is-local-scope">
      <a href="#what-is-local-scope" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        What is Local Scope?
      </a>
    </h3>
<p>A local scope refers to any scope defined past the global scope. There is typically one global scope, and each function defined has its own (nested) local scope. Any function defined within another function has a local scope which is linked to the outer function.</p>
<p>If I define a function and create variables inside it, those variables becomes locally scoped. Take this example:</p>
<pre>// Scope A: Global scope out here
var myFunction = function () {
  // Scope B: Local scope in here
};</pre>
<p>Any locally scoped items are not visible in the global scope - <em>unless</em> exposed, meaning if I define functions or variables within a new scope, it's inaccessible <em>outside</em> of that current scope. A simple example of this is the following:</p>
<pre>var myFunction = function () {
  var name = 'Todd';
  console.log(name); // Todd
};
// Uncaught ReferenceError: name is not defined
console.log(name);</pre>
<p>The variable <code class="highlighter-rouge">name</code> is scoped locally, it isn't exposed to the parent scope and therefore undefined.</p>
<h3 id="function-scope">
      <a href="#function-scope" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        Function scope
      </a>
    </h3>
<p>All scopes in JavaScript are created with <code class="highlighter-rouge">Function Scope</code> <em>only</em>, they aren't created by <code class="highlighter-rouge">for</code> or <code class="highlighter-rouge">while</code> loops or expression statements like <code class="highlighter-rouge">if</code> or <code class="highlighter-rouge">switch</code>. New functions = new scope - that's the rule. A simple example to demonstrate this scope creation:</p>
<pre>// Scope A
var myFunction = function () {
  // Scope B
  var myOtherFunction = function () {
    // Scope C
  };
};</pre>
<p>It's easy to create new scope and create local variables/functions/objects.</p>
<h3 id="lexical-scope">
      <a href="#lexical-scope" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        Lexical Scope
      </a>
    </h3>
<p>Whenever you see a function within another function, the inner function has access to the scope in the outer function, this is called Lexical Scope or Closure - also referred to as Static Scope. The easiest way to demonstrate that again:</p>
<pre>// Scope A
var myFunction = function () {
  // Scope B
  var name = 'Todd'; // defined in Scope B
  var myOtherFunction = function () {
    // Scope C: `name` is accessible here!
  };
};</pre>
<p>You'll notice that <code class="highlighter-rouge">myOtherFunction</code> <em>isn't</em> being called here, it's simply defined. Its order of call also has effect on how the scoped variables react, here I've defined my function and called it <em>under</em> another <code class="highlighter-rouge">console</code> statement:</p>
<pre>var myFunction = function () {
  var name = 'Todd';
  var myOtherFunction = function () {
    console.log('My name is ' + name);
  };
  console.log(name);
  myOtherFunction(); // call function
};

// Will then log out:
// `Todd`
// `My name is Todd`</pre>
<p>Lexical scope is easy to work with, <em>any</em> variables/objects/functions defined in <em>its</em> parent scope, are available in the scope chain. For example:</p>
<pre>var name = 'Todd';
var scope1 = function () {
  // name is available here
  var scope2 = function () {
    // name is available here too
    var scope3 = function () {
      // name is also available here!
    };
  };
};</pre>
<p>The only important thing to remember is that Lexical scope does <em>not</em> work backwards. Here we can see how Lexical scope <em>doesn't</em> work:</p>
<pre>// name = undefined
var scope1 = function () {
  // name = undefined
  var scope2 = function () {
    // name = undefined
    var scope3 = function () {
      var name = 'Todd'; // locally scoped
    };
  };
};</pre>
<p>I can always return a reference to <code class="highlighter-rouge">name</code>, but never the variable itself.</p>
<h3 id="scope-chain">
      <a href="#scope-chain" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        Scope Chain
      </a>
    </h3>
<p>Scope chains establish the scope for a given function. Each function defined has its own nested scope as we know, and any function defined within another function has a local scope which is linked to the outer function - this link is called the chain. It's always the <em>position</em> in the code that defines the scope. When resolving a variable, JavaScript starts at the innermost scope and searches outwards until it finds the variable/object/function it was looking for.</p>
<h3 id="closures">
      <a href="#closures" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        Closures
      </a>
    </h3>
<p>Closures ties in very closely with Lexical Scope. A better example of how the <em>closure</em> side of things works, can be seen when returning a <em>function reference</em> - a more practical usage. Inside our scope, we can return things so that they're available in the parent scope:</p>
<pre>var sayHello = function (name) {
  var text = 'Hello, ' + name;
  return function () {
    console.log(text);
  };
};</pre>
<p>The <code class="highlighter-rouge">closure</code> concept we've used here makes our scope inside <code class="highlighter-rouge">sayHello</code> inaccessible to the public scope. Calling the function alone will do nothing as it <em>returns</em> a function:</p>
<pre>sayHello('Todd'); // nothing happens, no errors, just silence...</pre>
<p>The function returns a function, which means it needs assignment, and <em>then</em> calling:</p>
<pre>var helloTodd = sayHello('Todd');
helloTodd(); // will call the closure and log 'Hello, Todd'</pre>
<p>Okay, I lied, you <em>can</em> call it, and you may have seen functions like this, but this will call your closure:</p>
<pre>sayHello('Bob')(); // calls the returned function without assignment</pre>
<p>AngularJS uses the above technique for its <code class="highlighter-rouge">$compile</code> method, where you pass the current scope reference into the closure:</p>
<pre>$compile(template)(scope);</pre>
<p>Meaning we could guess that their code would (over-simplified) look like this:</p>
<pre>var $compile = function (template) {
  // some magic stuff here
  // scope is out of scope, though...
  return function (scope) {
    // access to `template` and `scope` to do magic with too
  };
};</pre>
<p>A function doesn't <em>have</em> to return in order to be called a closure though. Simply accessing variables outside of the immediate lexical scope creates a closure.</p>
<h3 id="scope-and-this">
      <a href="#scope-and-this" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        Scope and 'this'
      </a>
    </h3>
<p>Each scope binds a different value of <code class="highlighter-rouge">this</code> depending on how the function is invoked. We've all used the <code class="highlighter-rouge">this</code> keyword, but not all of us understand it and how it differs when invoked. By default <code class="highlighter-rouge">this</code> refers to the outer most global object, the <code class="highlighter-rouge">window</code>. We can easily show how invoking functions in different ways binds the <code class="highlighter-rouge">this</code> value differently:</p>
<pre>var myFunction = function () {
  console.log(this); // this = global, [object Window]
};
myFunction();

var myObject = {};
myObject.myMethod = function () {
  console.log(this); // this = Object { myObject }
};

var nav = document.querySelector('.nav'); // <nav class="nav">
var toggleNav = function () {
  console.log(this); // this = <nav> element
};
nav.addEventListener('click', toggleNav, false);</nav></nav></pre>
<p>There are also problems that we run into when dealing with the <code class="highlighter-rouge">this</code> value, for instance if I do this, even inside the same function the scope can be changed and the <code class="highlighter-rouge">this</code> value can be changed:</p>
<pre>var nav = document.querySelector('.nav'); // <nav class="nav">
var toggleNav = function () {
  console.log(this); // <nav> element
  setTimeout(function () {
    console.log(this); // [object Window]
  }, 1000);
};
nav.addEventListener('click', toggleNav, false);</nav></nav></pre>
<p>So what's happened here? We've created new scope which is not invoked from our event handler, so it defaults to the <code class="highlighter-rouge">window</code> Object as expected. There are several things we can do if we want to access the proper <code class="highlighter-rouge">this</code> value which isn't affected by the new scope. You might have seen this before, where we can cache a reference to the <code class="highlighter-rouge">this</code> value using a <code class="highlighter-rouge">that</code> variable and refer to the lexical binding:</p>
<pre>var nav = document.querySelector('.nav'); // <nav class="nav">
var toggleNav = function () {
  var that = this;
  console.log(that); // <nav> element
  setTimeout(function () {
    console.log(that); // <nav> element
  }, 1000);
};
nav.addEventListener('click', toggleNav, false);</nav></nav></nav></pre>
<p>This is a neat little trick to be able to use the proper <code class="highlighter-rouge">this</code> value and resolve problems with newly created scope.</p>
<h3 id="changing-scope-with-call-apply-and-bind">
      <a href="#changing-scope-with-call-apply-and-bind" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        Changing scope with .call(), .apply() and .bind()
      </a>
    </h3>
<p>Sometimes you need to manipulate the scopes of your JavaScript depending on what you're looking to do. A simple demonstration of how to change the scope when looping:</p>
<pre>var links = document.querySelectorAll('nav li');
for (var i = 0; i &lt; links.length; i++) {
  console.log(this); // [object Window]
}</pre>
<p>The <code class="highlighter-rouge">this</code> value here doesn't refer to our elements, we're not invoking anything or changing the scope. Let's look at how we can change scope (well, it looks like we change scope, but what we're really doing is changing the <em>context</em> of how the function is called).</p>
<h4 id="call-and-apply">
      <a href="#call-and-apply" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        .call() and .apply()
      </a>
    </h4>
<p>The <code class="highlighter-rouge">.call()</code> and <code class="highlighter-rouge">.apply()</code> methods are really sweet, they allows you to pass in a scope to a function, which binds the correct <code class="highlighter-rouge">this</code> value. Let's manipulate the above function to make it so that our <code class="highlighter-rouge">this</code> value is each element in the array:</p>
<pre>var links = document.querySelectorAll('nav li');
for (var i = 0; i &lt; links.length; i++) {
  (function () {
    console.log(this);
  }).call(links[i]);
}</pre>
<p>You can see I'm passing in the current element in the Array iteration, <code class="highlighter-rouge">links[i]</code>, which changes the scope of the function so that the <code class="highlighter-rouge">this</code> value becomes that iterated element. We can then use the <code class="highlighter-rouge">this</code> binding if we wanted. We can use either <code class="highlighter-rouge">.call()</code> or <code class="highlighter-rouge">.apply()</code> to change the scope, but any further arguments are where the two differ: <code class="highlighter-rouge">.call(scope, arg1, arg2, arg3)</code> takes individual arguments, comma separated, whereas <code class="highlighter-rouge">.apply(scope, [arg1, arg2])</code> takes an Array of arguments.</p>
<p>It's important to remember that using <code class="highlighter-rouge">.call()</code> or <code class="highlighter-rouge">.apply()</code> actually invokes your function, so instead of doing this:</p>
<pre>myFunction(); // invoke myFunction</pre>
<p>You'll let <code class="highlighter-rouge">.call()</code> handle it and chain the method:</p>
<pre>myFunction.call(scope); // invoke myFunction using .call()</pre>
<h4 id="bind">
      <a href="#bind" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        .bind()
      </a>
    </h4>
<p>Unlike the above, using <code class="highlighter-rouge">.bind()</code> does not <em>invoke</em> a function, it merely binds the values before the function is invoked. It's a real shame this was introduced in ECMAScript 5 and not earlier as this method is fantastic. As you know we can't pass parameters into function references, something like this:</p>
<pre>// works
nav.addEventListener('click', toggleNav, false);

// will invoke the function immediately
nav.addEventListener('click', toggleNav(arg1, arg2), false);</pre>
<p>We <em>can</em> fix this, by creating a new function inside it:</p>
<pre>nav.addEventListener('click', function () {
  toggleNav(arg1, arg2);
}, false);</pre>
<p>But again this changes scope and we're creating a needless function again, which will be costly on performance if we were inside a loop and binding event listeners. This is where <code class="highlighter-rouge">.bind()</code> shines through, as we can pass in arguments but the functions are not called:</p>
<pre>nav.addEventListener('click', toggleNav.bind(scope, arg1, arg2), false);</pre>
<p>The function isn't invoked, and the scope can be changed if needed, but arguments are sat waiting to be passed in.</p>
<h3 id="private-and-public-scope">
      <a href="#private-and-public-scope" class="linkjuice">
        <span class="linkjuice-icon">
          <i class="linkjuice__icon"></i>
        </span>
        Private and Public Scope
      </a>
    </h3>
<p>In many programming languages, you'll hear about <code class="highlighter-rouge">public</code> and <code class="highlighter-rouge">private</code> scope, in JavaScript there is no such thing. We can, however, emulate public and private scope through things like Closures.</p>
<p>By using JavaScript design patterns, such as the <code class="highlighter-rouge">Module</code> pattern for example, we can create <code class="highlighter-rouge">public</code> and <code class="highlighter-rouge">private</code> scope. A simple way to create private scope, is by wrapping our functions inside a function. As we've learned, functions create scope, which keeps things out of the global scope:</p>
<pre>(function () {
  // private scope inside here
})();</pre>
<p>We might then add a few functions for use in our app:</p>
<pre>(function () {
  var myFunction = function () {
    // do some stuff here
  };
})();</pre>
<p>But when we come to calling our function, it would be out of scope:</p>
<pre>(function () {
  var myFunction = function () {
    // do some stuff here
  };
})();

myFunction(); // Uncaught ReferenceError: myFunction is not defined</pre>
<p>Success! We've created private scope. But what if I want the function to be public? There's a great pattern (called the Module Pattern [and Revealing Module Pattern]) which allows us to scope our functions correctly, using private and public scope and an <code class="highlighter-rouge">Object</code>. Here I grab my global namespace, called <code class="highlighter-rouge">Module</code>, which contains all of my relevant code for that module:</p>
<pre>// define module
var Module = (function () {
  return {
    myMethod: function () {
      console.log('myMethod has been called.');
    }
  };
})();

// call module + methods
Module.myMethod();</pre>
<p>The <code class="highlighter-rouge">return</code> statement here is what returns our <code class="highlighter-rouge">public</code> methods, which are accessible in the global scope - <em>but</em> are <code class="highlighter-rouge">namespaced</code>. This means our Module takes care of our namespace, and can contain as many methods as we want. We can extend the Module as we wish:</p>
<pre>// define module
var Module = (function () {
  return {
    myMethod: function () {

    },
    someOtherMethod: function () {

    }
  };
})();

// call module + methods
Module.myMethod();
Module.someOtherMethod();</pre>
<p>So what about private methods? This is where a lot of developers go wrong and pollute the global namespace by dumping all their functions in the global scope. Functions that help our code <em>work</em> do not need to be in the global scope, only the API calls do - things that <em>need</em> to be accessed globally in order to work. Here's how we can create private scope, by <em>not</em> returning functions:</p>
<pre>var Module = (function () {
  var privateMethod = function () {

  };
  return {
    publicMethod: function () {

    }
  };
})();</pre>
<p>This means that <code class="highlighter-rouge">publicMethod</code> can be called, but <code class="highlighter-rouge">privateMethod</code> cannot, as it's privately scoped! These privately scoped functions are things like helpers, addClass, removeClass, Ajax/XHR calls, Arrays, Objects, anything you can think of.</p>
<p>Here's an interesting twist though, anything in the same scope has access to anything in the same scope, even <em>after</em> the function has been returned. Which means, our <code class="highlighter-rouge">public</code> methods have <em>access</em> to our <code class="highlighter-rouge">private</code> ones, so they can still interact but are unaccessible in the global scope.</p>
<pre>var Module = (function () {
  var privateMethod = function () {

  };
  return {
    publicMethod: function () {
      // has access to `privateMethod`, we can call it:
      // privateMethod();
    }
  };
})();</pre>
<p>This allows a very powerful level of interactivity, as well as code security. A very important part of JavaScript is ensuring security, which is exactly <em>why</em> we can't afford to put all functions in the global scope as they'll be publicly available, which makes them open to vulnerable attacks.</p>
<p>Here's an example of returning an Object, making use of <code class="highlighter-rouge">public</code> and <code class="highlighter-rouge">private</code> methods:</p>
<pre>var Module = (function () {
  var myModule = {};
  var privateMethod = function () {

  };
  myModule.publicMethod = function () {

  };
  myModule.anotherPublicMethod = function () {

  };
  return myModule; // returns the Object with public methods
})();

// usage
Module.publicMethod();</pre>
<p>One neat naming convention is to begin <code class="highlighter-rouge">private</code> methods with an underscore, which visually helps you differentiate between public and private:</p>
<pre>var Module = (function () {
  var _privateMethod = function () {

  };
  var publicMethod = function () {

  };
})();</pre>
<p>This helps us when returning an anonymous <code class="highlighter-rouge">Object</code>, which the Module can use in Object fashion as we can simply assign the function references:</p>
<pre>var Module = (function () {
  var _privateMethod = function () {

  };
  var publicMethod = function () {

  };
  return {
    publicMethod: publicMethod,
    anotherPublicMethod: anotherPublicMethod
  }
})();</pre>
<p>Happy scoping!</p>
</section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-50" name="t-50"></a><h1>50 : Advanced Javascript: Objects, Arrays, and Array-Like objects</h1>
					<div class="tutorial__content">
<main class="container">
<p>Javascript <code>objects</code> and <code>arrays</code> are both incredibly useful. They're also incredibly easy to confuse with each other. Mix in a few objects that look like arrays and you've got a recipe for confusion!</p>
<p>We're going to see what the differences between objects and arrays are, how to work with some of the common array-like objects, and how to get the most performance out of each.</p>
<!--more-->
<h2 id="what-objects-are">What Objects Are</h2>
<p>A javascript object is a basic data structure:</p>
<pre>var basicObj = {}; // an empty object - {} is a shortcut for "new Object()"

basicObj.suprise= "cake!";

basicObj['suprise']; // returns "cake!"
</pre>
<p>Using <code>{}</code> instead of <code>new Object();</code> is know as "Object Literal" syntax.</p>
<pre>var fancyObj = {
    favoriteFood: "pizza",
    add: function(a, b){
        return a + b;
    }
};

fancyObj.add(2,3); // returns 5

fancyObj['add'](2,3); // ditto.
</pre>
<p>As you can see, and probably already knew, properties can be accessed a couple of different ways. However, it's an important point that we'll come back to in a minute.</p>
<p>Everything in javascript is an <code>object</code>. Everything. <code>Arrays</code>, <code>functions</code>, even <code>numbers</code>! Because of this, you can do some really interesting things, such as modifying the <code>prototypes</code> of Objects, Arrays, etc.</p>
<pre>// an example of something you probably shouldn't do. Ever. Seriously.
Number.prototype.addto = function(x){
    return this + x;
}

(8).addto(9); // returns 17

// other variations:

8.addto(9);  // gives a syntax error, because the dot is assumed to be a decimal point

8['addto'](9);  // works but is kind of ugly compared to the first method

var eight = 8;
eight.addto(9);  // works
</pre>
<h2 id="what-arrays-are">What Arrays Are</h2>
<p>Javascript arrays are a type of <code>object</code> used for storing multiple values in a single variable. Each value gets numeric index and may be any data type.</p>
<pre>var arr = [];  // this is a shortcut for new Array();
arr[0] = "cat";
arr[1] = "mouse";
</pre>
<p>See how that syntax is so similar to the syntax used for setting object properties? In fact, the only difference is that objects use a string while arrays use a number. This is why arrays get confused with objects so often.</p>
<h3 id="length">Length</h3>
<p>Arrays have a <code>length</code> property that tells how many items are in the array and is automatically updated when you add or remove items to the array. </p>
<pre>var arr = [];
arr[0] = "cat"; // this adds to the array
arr[1] = "mouse"; // this adds to the array
arr.length; // returns 2

arr["favoriteFood"] = "pizza"; // this DOES NOT add to the array. Setting a string parameter adds to the underlying object
arr.length; // returns 2, not 3
</pre>
<p>The length property is only modified when you add an item to the array, not the underlying object.</p>
<p><strong>The <code>length</code> is always 1 higher than the highest index, even if there are actually fewer items in the array.</strong></p>
<pre>var arr = [];
arr.length; // returns 0;

arr[100] = "this is the only item in the array";
arr.length; // returns 101, even though there is only 1 object in the array
</pre>
<p>This is somewhat counter-intuitive. PHP does more what you would expect:</p>
<pre><!--?php
arr = array();
arr[100] = "php behaves differently";
sizeof(arr); // returns 1 in PHP
?-->
</pre>
<p>You can manually set the <code>length</code> also. Setting it to 0 is a simple way to empty an array.</p>
<p>In addition to this length property, arrays have lots of nifty built in functions such as <code>push()</code>, <code>pop()</code>, <code>sort()</code>, <code>slice()</code>, <code>splice()</code>, and more. This is what sets them apart from Array-Like Objects.</p>
<h2 id="array-like-objects-img-class-alignright-title-it-s-like-an-array-but-made-out-of-lego-src-http-farm4-static-flickr-com-3175-2645497916_386b9b75b8_m-jpg-alt-width-240-height-180-2-">Array-like Objects </h2>
<p>Array-like objects look like arrays. They have various numbered elements and a length property. But that's where the similarity stops. Array-like objects do not have any of Array's functions, and for-in loops don't even work!</p>
<p>You'll come across these more often than you might expect. A common one is the <code>arguments</code> variable that is present inside of every js function. </p>
<p>Also included in the category are the HTML node sets returned by <code>document.getElementsByTagName()</code>, <code>document.forms</code>, and basically every other DOM method and property that gives a list of items.</p>
<pre>document.forms.length; // returns 1;
document.forms[0]; // returns a form element.
document.forms.join(", "); // throws a type error. this is not an array.
typeof document.forms; // returns "object"
</pre>
<p>Did you know you can send any number of arguments you want to a javascript function? They're all stored in an array-like object named <code>arguments</code>.</p>
<pre>function takesTwoParams(a, b){
    // arguments is an array-like variable that is automatically created
    // arguments.length works great

    alert ("you gave me "+arguments.length+" arguments"); 

    for(i=0; i&lt; arguments.length; i++){
        alert("parameter " + i + " = " + arguments[i]); 
    }
}

takesTwoParams("one","two","three");
// alerts "you gave me 3 arguments",
// then "parameter 0 = one" 
// etc.
</pre>
<div class="alert alert-info">
<strong>Tip:</strong>
<em>Parameters</em> are the named variables in a function's signature: <code>a</code> and <code>b</code> in the previous example.<br>
<em>Arguments</em>, by contrast, are the expressions that are used when calling the function: <code>"one"</code>, <code>"two"</code>, and <code>"three"</code> in this case.
</div>

<p>This works great. But that's about as far as you can go with array-like objects. The flowing example does not work:</p>
<pre>function takesTwoParams(a, b){
    alert(" your parameters were " + arguments.join(", ")); 
    // throws a type error because arguments.join doesn't exist
}
</pre>
<h3 id="so-what-can-you-do-">So what can you do?</h3>
<p>Well you could make your own <code>join()</code> function, but that adds a lot of unnecessary overhead to your code because it has to loop over everything. If only there were a quick way to get an array out of an array like object…</p>
<p>It turns out there is.</p>
<p>The array functions can be called on non-array objects as long as you know where to find the function (usually they're attached to the array, but this isn't an array remember <img src="http://nfriedly.com/techblog/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley"> </p>
<p><code>Prototype</code> to the win:</p>
<pre>function takesTwoParams(a, b){
    var args = Array.prototype.slice.call(arguments);
    alert(" your parameters were " + args.join(", ")); 
    // yay, this works!
}
</pre>
<p>Let's take a look at that a bit more in-depth:</p>
<p><code>Array</code>: This object is the original array that all other arrays inherit their properties from.</p>
<p><code>Array.prototype</code>:This gives us access to all the methods properties that each array inherits</p>
<p><code>Array.prototype.slice</code>: The original slice method that is given to all arrays via the prototype chain. We can't call it directly though, because when it runs internally, it looks at the <code>this</code> keyword, and calling it here would make <code>this</code> point to <code>Array</code>, not our <code>arguments</code> variable.</p>
<p><code>Array.prototype.slice.call()</code>: <code>call()</code> and <code>apply()</code> are prototype methods of the <code>Function</code> object, meaning that they can be called on every function in javascript. These allow you to change what the <code>this</code> variable points to inside a given function.</p>
<p>And finally, you get a regular <code>array</code> back! This works because javascript returns a new object of type Array rather than whatever you gave it. This causes a lot of headaches for a <a href="http://dean.edwards.name/weblog/2006/11/hooray/">few</a> <a href="http://webreflection.blogspot.com/2008/03/sorry-dean-but-i-subclassed-array-again.html">people</a> who are trying to make subclasses of Array, but it's very handy in our case!</p>
<h2 id="-a-name-gotchas-a-gotchas"><a name="gotchas"></a>Gotchas</h2>
<p>First, in Internet Explorer, DOM <code>NodeLists</code> are not considered to be javascript objects, so you cannot call <code>Array.prototype.slice</code> on them. If you want an array, you'll have to loop through it the old fashioned way. Or use a hybrid function that tries it the fast way first, then the slow way if that doesn't work. </p>
<pre>function hybridToArray(nodes){
    try{
        // works in every browser except IE
        var arr = Array.prototype.slice.call(nodes);
        return arr;
    } catch(err){
        // slower, but works in IE
        var arr = [],
            length = nodes.length;
        for(var i=0; i &lt; length; i++){
            arr.push(nodes[i]);
        }
        return arr;
    }
}
</pre>
<p>See an example here: <a href="http://nfriedly.com/demos/ie-nodelist-to-array">http://nfriedly.com/demos/ie-nodelist-to-array</a>.</p>
<p>Second, arrays are objects, so you can do this, but it can get you some serious inconsistencies:</p>
<pre>arr = [];
arr[0] = "first element"; // adds item to the array
arr.length; // returns 1

arr.two = "second element"; // adds an item to the underlying object that array is built on top of.
arr.length; // still returns 1 !

// BUT...
for(i in arr){
    // this will hit both 0 and "two"
}
</pre>
<h3 id="another-solution-wrap-arrays-in-an-object-if-you-need-both-worlds">Another solution: wrap arrays in an object if you need both worlds</h3>
<p>This is basically a less efficient method of the array subclassing links I mentioned above. While less efficient, it has the advantage of being simple and reliable.</p>
<p>That said, I wouldn't recommend that you use this in most cases due to issues with speed and extra code requirements. It's provided here as an example.</p>
<pre>// an example of a wrapper for an array.
// not recommended for most situations.

var ArrayContainer = function(arr){
    this.arr = arr || [];
    this.length = this.arr.length;
};

ArrayContainer.prototype.add=  function(item){
    index = this.arr.length;
    this.arr[index] = item;
    this.length = this.arr.length;
    return index;
};

ArrayContainer.prototype.get=  function(index){
    return this.arr[index];
};

ArrayContainer.prototype.forEach=  function(fn){
    if (this.arr.forEach) this.arr.forEach(fn);// use native code if it's there
    else {
        for(i in this.arr){
            fn( i, this.arr[i], this.arr );
        }
    }
};

var mySuperDooperArray = new ArrayContainer();
</pre>
<p>Now that your array is (somewhat) protected on the inside, you can loop through it's items with <code>forEach()</code> and know that they will match it's length. You can also add arbitrary properties to <code>ArrayContainer</code> or <code>mySuperDooperArray</code> and they <strong>won't</strong> get pulled into your <code>forEach()</code> loop.</p>
<p>This example could be extended to completely protect the array if the need arose. </p>
<h2 id="an-even-better-solution-hire-a-javascript-expert-5-">An Even Better Solution: <a href="http://nfriedly.com/webdev">Hire a javascript expert</a>.</h2>
<p>nFriedly Web Development is a top ranked <a href="http://nfriedly.com/webdev/javascript">Javascript and AJAX ninja</a> with an extensive portfolio of proven results. I can bring your project to life and make it run faster than you ever imagined.  <a href="http://nfriedly.com/contact">Get in touch</a> with me or get a free <a href="http://nfriedly.com/estimate">instant estimate</a> for new projects.</p>



</main>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-51" name="t-51"></a><h1>51 : Advanced Javascript: Logical Operators and truthy / falsy</h1>
					<div class="tutorial__content">
					<span>http://www.nfriedly.com/techblog/2009/07/advanced-javascript-operators-and-truthy-falsy/</span>
<main class="container">
<p>Nearly every website on the internet uses javascript in some form or fashion. Yet very few people, even those who write it and teach it, have a clear understanding of how javascript works!</p>
<p>Logical Operators are a core part of the language. We're going to look at what logical operators are, what "truthy" and "falsy" mean, and <strong>how to use this to write cleaner, faster and more optimized javascript</strong>.</p>
<!--more-->
<h2 id="javascript-logical-operators">Javascript Logical Operators</h2>
<p>In traditional programming, operators such as <code>&amp;&amp;</code> and <code>||</code> returned a boolean value (<code>true</code> or <code>false</code>). This is not the case in javascript. Here it returns the actual <code>object</code>, not a <code>true</code> / <code>false</code>.  To really explain this, I first have to explain what is truthy and what is falsy.</p>
<h3 id="truthy-or-falsy">Truthy or Falsy</h3>
<p>When javascript is expecting a <code>boolean</code> and it's given something else, it decides whether the something else is "truthy" or "falsy".</p>
<p>An empty string (<code>''</code>), the number <code>0</code>, <code>null</code>, <code>NaN</code>, a boolean <code>false</code>, and <code>undefined</code> variables are all "falsy". Everything else is "truthy".</p>
<pre>var emptyString = ""; // falsy

var nonEmptyString = "this is text"; // truthy

var numberZero = 0; // falsy

var numberOne = 1; // truthy

var emptyArray = []; // truthy, BUT []==false is true. More below.

var emptyObject = {}; // truthy

// NaN is a special javascript object for "Not a Number".
var notANumber = 5 / "tree"; // falsy

function exampleFunction(){
    alert("Test");
}

// examleFunction is truthy
// BUT exampleFunction() is falsy because it has no return (undefined)
</pre>
<p>Gotchas to watch out for: the strings <code>"0"</code> and <code>"false"</code> are both considered truthy.  You can convert a string to a number with the <code>parseInt()</code> and <code>parseFloat()</code> functions, or by just multiplying it by <code>1</code>.</p>
<pre>var test = "0"; // this is a string, not a number

var a = (test == false); // a is false, meaning that test is truthy

var b = (test * 1 == false); // b is true, meaning that `test * 1` is falsy
</pre>
<p><code>Array</code>s are particularly weird. If you just test it for truthyness, an empty array is truthy. HOWEVER, if you compare an empty array to a boolean, it becomes falsy:</p>
<pre>if ( [] == false ) {
    // this code runs
}

if ( [] ) {
    // this code also runs
}

if ([] == true) {
    // this code doesn't run
}

if ( ![] ) {
    // this code also doesn't run
}
</pre>
<p>(This is because when you do a comparison, it's elements are turned to <code>String</code>s and joined. Since it's empty, it becomes <code>""</code> which is then falsy. Yea, <a href="https://www.destroyallsoftware.com/talks/wat">it's weird</a>.)</p>
<p>If you write any PHP, then there's an additional gotcha to watch out for: while javascript evaluates empty arrays as true, PHP evaluates them as false.</p>
<p>PHP also evaluates "0″ as falsy. (However the string "false" is evaluated as truthy by both PHP and javascript.)</p>
<pre><!--?php

$emptyArray = array(); // falsy in PHP

$stringZero = "0"; // falsy in PHP

?-->
</pre>
<h3 id="how-logical-operators-work">How Logical Operators Work</h3>
<h4 id="logical-or-">Logical OR, <code>||</code></h4>
<p>The logical OR operator, <code>||</code>,  is very simple after you understand what it is doing. If the first object is truthy, that gets returned. Otherwise, the second object gets returned.</p>
<pre>var a = ("test one" || "test two"); // a is "test one"

var b = ("test one" || ""); // b is "test one"

var c = (0 || "test two"); // c is "Test two"

var d = (0 || false); // d is false
</pre>
<p>Where would you ever use this? The OR operator allows you to easily specify default variables in a function.</p>
<pre>function sayHi(name){
    name = name || "Dave";
    alert("Hi " + name);
}

sayHi("Nathan"); // alerts "Hi Nathan";

sayHi(); // alerts "Hi Dave", name is set to null when the function is started
</pre>
<h4 id="logical-and-">Logical AND, <code>&amp;&amp;</code></h4>
<p>The logical AND operator, <code>&amp;&amp;</code>,  works similarly.  If the first object is falsy, it returns that object. If it is truthy, it returns the second object.</p>
<pre>var a = ("test one" &amp;&amp; "test two"); // a is "test two"

var b = ("test one" &amp;&amp; ""); // b is ""

var c = (0 &amp;&amp; "test two") // c is 0
</pre>
<p>The logical AND allows you to make one variable dependent on another.</p>
<pre>var checkbox = document.getElementById("agreeToTerms");

var name = checkbox.checked &amp;&amp; prompt("What is your name");

// name is either their name, or false if they haven't checked the AgreeToTerms checkbox
</pre>
<h4 id="logical-not-">Logical NOT, <code>!</code></h4>
<p>Unlike <code>&amp;&amp;</code> and <code>||</code>, the <code>!</code> operator DOES turn the value it receives into a boolean. If it receives a truthy value, it returns <code>false</code>, and if it receives a falsy value, it returns <code>true</code>.</p>
<pre>var a = (!"test one" || "test two"); // a is "test two"
// ("test one" gets converted to false and skipped)

var b = (!"test one" &amp;&amp; "test two"); // b is false
// ("test one" gets converted to false and returned)

var c = (!0 || !"test two"); // c is true
// (0 gets converted to true and returned)
</pre>
<p>Another useful way to use the <code>!</code> operator is to use two of them -- this way you always get a <code>true</code> or a <code>false</code> no matter what was given to it.</p>
<pre>var a = (!!"test"); // a is true
//  "test" is converted to false, then that is converted to true

var b = (!!""); // b is false
// "" is converted to true, and then that true is converted to false

var c = (!!variableThatDoesntExist); // c is false even though you're checking an undefined variable.
</pre>
<h2 id="-javascript-optimization-4-"><a href="http://nfriedly.com/portfolio">Javascript Optimization</a></h2>
<p>Need any help <a href="http://nfriedly.com/portfolio#javascript">optimizing the Javascript and AJAX on your website</a>? Get in touch with your friendly neighborhood <a href="http://nfriedly.com/portfolio">javascript expert</a> for ideas on how to optimize your site and a free quote.</p>



</main>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-52" name="t-52"></a><h1>52 : Design Patterns - Decorating in JavaScript</h1>
					<div class="tutorial__content">
					<span>http://dealwithjs.io/design-patterns-decorating-in-javascript/</span>
<p><a name="top"></a> <br>
Today we are going to talk about the decorator design pattern. More specifically, how to decorate functions in JavaScript.</p>

<h3 id="tldr">TL; DR</h3>

<p>Source code can be found on <a href="https://github.com/gergob">GitHub</a>, <a href="https://github.com/gergob/jsDecorator">jsDecorator</a> or <a href="https://jsfiddle.net/zord/8coed3p4/">jsFiddle</a></p>

<hr>

<h6 id="designpatterns">Design Patterns</h6>

<h3 id="decoratinginjavascript">Decorating in JavaScript</h3>

<blockquote>
  <p>The decorator design pattern is for extending the functionality or state of an object by repeatedly wrapping it. </p>
</blockquote>

<p>That's quite a broad definition, it can mean many different things. In JavaScript - and other languages with first class functions, like Python - there is a specific use case for this. Namely, to extend a function by wrapping it in an outer function.</p>

<p>This can be useful for temporarily augment functions while developing or debugging an application (logging, call counting, performance profiling, etc). But even production code can be greatly simplified and made more readable by adding frequently used extra functionality via decorators (authentication, caching, permission handling, analytics, etc).</p>

<p>Let's say we have a suspected bottleneck function:  </p>

<pre><code class="language-javascript">function isPrime(num) {  
    if (num === 2 || num === 3) { 
        return true; 
    }
    if (num % 2 === 0) { 
        return false; 
    }
    let max = Math.ceil(Math.sqrt(num));
    for (let i = 3; i &lt;= max; i += 2) {
        if (num % i === 0) {
            return false;
        }
    }
    return true;
}
</code></pre>

<p>We want to measure the time it takes to execute this function, but we don't really want to manually modify it's code, and revert it after the measurement. Not to mention this is a fairly common thing we do, so an ideal solution would be a write once - reuse any time. We can achieve that by a decorator function.  </p>

<pre><code class="language-javascript">function logDecorator(func) {  
    let decorated = function () {
        let start = performance.now(),
            result = func.apply(this, arguments),
            time = Math.round((performance.now() - start) * 1000);
        console.log(`${time} μs`);
        return result;
    };  
    return decorated;
}
</code></pre>

<p>As you can see, our decorator function gets a <code>func</code> function argument, creates and returns a <code>decorated</code> replacement function, which does the extra functionality we want (logging time in this case), and calls the original <code>func</code> function, much like we used to call <code>super</code> in overridden methods.</p>

<p>We can apply our decorator to any function like this:  </p>

<pre><code class="language-javascript">let isPrimeLog = logDecorator(isPrime);  
isPrimeLog(22586101147);    

// output:
// 4555 μs
</code></pre>

<p>I think it's easier to understand if we give it a separate name, also we will compare two differently decorated functions later, and in that case, they need different names anyway. But of course we could just as easily decorate the <code>isPrime</code> function in place:  </p>

<pre><code class="language-javascript">isPrime = logDecorator(isPrime);  
</code></pre>

<p>By adding two more things, we can make our log decorator more generic and useful:</p>

<ol>
<li>The anonymous <code>decorated</code> function should be a named one. I generally try not to use anonymous functions unless it's justifiable, because they lead to unreadable stack traces. Also, I would like to log the function name. So I derive a name from the original name of <code>func</code>.  </li>
<li>I compile a string from the arguments, so I can log that too. </li>
</ol>

<p>These functionalities will also be useful in our second example, so I've put them in separate utility functions (which I omitted for brevity - see the source code for details).</p>

<pre><code class="language-javascript">function logDecorator(func) {  
    let decorated = function () {
        let params = formatArguments(arguments),
            start = performance.now(),
            result = func.apply(this, arguments),
            time = Math.round((performance.now() - start) * 1000);
        console.log(`${decorated.name}(${params}) =&gt; ${result} (${time} μs)`);
        return result;
    };  
    return renameFunction(decorated, func.name + 'Log');
}

// output for the same call:
// isPrimeLog(22586101147) =&gt; true (4555 μs)
</code></pre>

<p>As you can see, the output became more rich and useful. And we can put this on any function we want. Now it's probably easier for you to imagine the things we can do with this. And we aren't limited to adding functionality, we can also add state via closure. </p>

<p>Consider the second example: we want to add caching to functions. If we call our function with a set of arguments, it calculates the result and stores it. Whenever we call it with the same set of arguments again, it will get the result from the cache instead of recalculating it every time. This is called <a href="https://en.wikipedia.org/wiki/Memoization">memoization</a>, and can be a massive performance increase in many situations. And if we have an easily applicable solution, we can try it on any function without messing with our code too much.  </p>

<pre><code class="language-javascript">function memoDecorator(func) {  
    let cache = {},
        decorated = function () {
            let params = formatArguments(arguments);
            if (params in cache) {
                return cache[params];
            } else {
                let result = func.apply(this, arguments);
                cache[params] = result;
                return result;
            }
        };
    return renameFunction(decorated, func.name + 'Memo');
}
</code></pre>

<p>Let's try it out:  </p>

<pre><code class="language-javascript">let num = 22586101147;

let isPrimeLog = logDecorator(isPrime);  
isPrimeLog(num);  
isPrimeLog(num);  
isPrimeLog(num);

// output
// isPrimeLog(22586101147) =&gt; true (4555 μs)
// isPrimeLog(22586101147) =&gt; true (5645 μs)
// isPrimeLog(22586101147) =&gt; true (3925 μs)

isPrimeMemoLog = logDecorator(memoDecorator(isPrime));  
isPrimeMemoLog(num);  
isPrimeMemoLog(num);  
isPrimeMemoLog(num);

// output
// isPrimeMemoLog(22586101147) =&gt; true (3485 μs)
// isPrimeMemoLog(22586101147) =&gt; true (5 μs)
// isPrimeMemoLog(22586101147) =&gt; true (5 μs)
</code></pre>

<p>Mostly we did the same thing as in the first example. One key difference to note is how we create the <code>cache</code> object in our decorator, so the <code>decorated</code> function can access it via closure. In other words, we gave a shared state to the different calls of the <code>decorated</code> function. </p>

<p>Also note how we double-decorated our second function.</p>

<p>As you can see <code>memoDecorator</code> makes subsequent calls return the cached result instantly.</p>

<p>When you wrap your head around it, using decorators in JavaScript is a simple, but very powerful design pattern. It can be used effectively and elegantly, but - as almost everything - can be abused too. I encourage you to try it, play with it, try to come up with use cases in your line of work, and see what you can build with it.</p>

<p>Finally, I want to mention that there are plans to include a special syntax for using decorators in ES7. You can read more about that <a href="https://medium.com/google-developers/exploring-es7-decorators-76ecb65fb841#.zhzguo5o8">here</a>.</p>

<hr>

<p>If you enjoyed reading this blog post, please share it or like the <a href="https://www.facebook.com/dealwithjs">Facebook page</a> of the website to get regular updates. You can also follow us <a href="https://twitter.com/dealwithjs">@dealwithjs</a>.</p>

<p>Happy decorating!</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-53" name="t-53"></a><h1>53 : Design Patterns - The Builder Pattern in JavaScript</h1>
					<div class="tutorial__content">
						<span>http://dealwithjs.io/design-patterns-the-builder-pattern-in-javascript/</span>
						
<h3 id="tldr">TL; DR</h3>

<p>Source code can be found on <a href="https://github.com/gergob">GitHub</a>, <a href="https://github.com/gergob/jsBuilder">jsBuilder repo</a></p>

<hr>

<h3 id="designpatternsthebuilder">Design Patterns - The Builder</h3>

<p>The Builder pattern is a creational design pattern, which should be applied when complex objects have to be created. When applying this pattern the goal is to separate the object creation (or initialization) logic from the representation.</p>

<blockquote>
  <p>This pattern should be used when object creation is complicated and involves a lot of code.</p>
</blockquote>

<p>UML diagram<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> with the Builder pattern:</p>

<p><img src="http://dealwithjs.io/content/images/2016/11/Builder_UML_class_diagram.svg" alt="Builder Pattern with UML diagram"></p>

<p>This pattern has three components, the <strong>Director</strong> which uses the Builder to create objects, the role of the Director is to coordinate the object creation in case there are multiple Builders involved. The Director also provides an extra abstraction layer when implementing this pattern. <br>
The <strong>Builder</strong> is an abstraction layer above all the Concrete Builders which create the objects. In JavaScript the <strong>Builder</strong> is not separated clearly and in some case it can be left out completely (<em>although I forced it to be in the sample code</em>). <br>
The <strong>Concrete Builder</strong>s implement the real object creation. Concrete Builders, internally, can use <a href="http://dealwithjs.io/design-patterns-the-factory-pattern-in-javascript/">Factories</a> for building parts of the final object (<em>I used factories in my implementation to demonstrate this</em>). </p>

<p>I present the Builder pattern using an analogy. </p>

<p>Lets imagine the process of "building" a cake. In this analogy a cake is considered a complex object, because it is hard to create. The cake object has three parts, the layers, the cream and the topping.</p>

<p>I modeled this scenario in code. Let's start from the Director implementation. In this scenario the Director or Coordinator is represented by the <code>PastryCook</code> function, this handles everything related to "building" the cake.</p>

<pre><code class="language-javascript">function PastryCook() {  
    var chocolateCakeBuilder = ChocolateCakeBuilder.getBuilder();
    var strawberryCakeBuilder = StrawberryCakeBuilder.getBuilder();
    var traditionalCakeBuilder = TraditionalCakeBuilder.getBuilder();

    return {
        buildCake: function(flavor) {
            var cake = null;
            switch (flavor) {
                case 'chocolate':
                    cake = chocolateCakeBuilder.buildCake();
                    break;
                case 'strawberry':
                    cake = strawberryCakeBuilder.buildCake();
                    break;
                default:
                    cake = traditionalCakeBuilder.buildCake();
                    break;
            }

            return cake;
        }
    };
}
</code></pre>

<p>The <code>PastryCook</code> has a <code>buildCake</code> function, which receives the <code>flavor</code> argument. Based on the value of the argument I used different <strong>Builders</strong> to build the cake. By adding the possibility to create different cake objects based on a parameter passed to the Director I could demonstrate how to use multiple builders.</p>

<p>The implementation of <code>ChocolateCakeBuilder</code> handles the steps of building a chocolate cake. In this Builder I used factories to simplify the implementation and to provide an extra layer of abstraction. </p>

<pre><code class="language-javascript">function ChocolateCakeBuilder() {  
    var layerFactory = LayerFactory.getInstance();
    var creamFactory = CreamFactory.getInstance();
    var toppingFactory = ToppingFactory.getInstance();

    return {
        buildCake: function() {
            return {
                layer: layerFactory.getStandard(),
                cream: creamFactory.getChocolate(),
                topping: toppingFactory.getChocolate()
            }
        }
    };
}
</code></pre>

<p>Every Builder implements the <code>buildCake</code> function, this is the method which delivers the Product (<em>referring to the UML diagram</em>).</p>

<p>The <code>StrawberryCakeBuilder</code> is very similar in implementation: </p>

<pre><code class="language-javascript">function StrawberryCakeBuilder() {  
    var layerFactory = LayerFactory.getInstance();
    var creamFactory = CreamFactory.getInstance();
    var toppingFactory = ToppingFactory.getInstance();

    return {
        buildCake: function() {
            return {
                layer: layerFactory.getLowCarb(),
                cream: creamFactory.getWhipped(),
                topping: toppingFactory.getStrawberry()
            }
        }
    };
}
</code></pre>

<p>For the Builders I used Factories, because these (<em>in general</em>) add more flexibility to the code and reduce the maintenance cost of the codebase.</p>

<p>The source code of <code>ToppingFactory</code> is below; all it does is return a <code>string</code> with the selected topping.</p>

<pre><code class="language-javascript">function ToppingFactory() {  
    return {
        getChocolate: function() {
            return 'Topping: [Chocolate]';
        },

        getVanilla: function() {
            return 'Topping: [Vanilla]';
        },

        getStrawberry: function() {
            return 'Topping: [Strawberry]';
        },
    };
}

module.exports = {  
    getInstance: ToppingFactory
};
</code></pre>

<p>Sample code was written for <code>node</code>, the <a href="https://github.com/gergob/jsBuilder/blob/master/index.js"><code>index.js</code></a> has the demo code:</p>

<pre><code class="language-javascript">var PastryCook = require('./PastryCook');

var cakeBuilder = PastryCook.getBuilder();

var chocolateCake = cakeBuilder.buildCake('chocolate');  
var strawberryCake = cakeBuilder.buildCake('strawberry');  
var cake = cakeBuilder.buildCake();

console.log("The Chocolate cake is compound of:");  
console.log(JSON.stringify(chocolateCake, null, 2));

console.log("The Strawberry cake is compound of:");  
console.log(JSON.stringify(strawberryCake, null, 2));

console.log("The cake is compound of:");  
console.log(JSON.stringify(cake, null, 2));
</code></pre>

<p>Once the code is executed the output should be:</p>

<pre><code>The Chocolate cake is compound of:  
{
  "layer": "Layer: [Standard]",
  "cream": "Cream: [Chocolate]",
  "topping": "Topping: [Chocolate]"
}
The Strawberry cake is compound of:  
{
  "layer": "Layer: [LowCarb]",
  "cream": "Cream: [Whipped]",
  "topping": "Topping: [Strawberry]"
}
The cake is compound of:  
{
  "layer": "Layer: [Standard]",
  "cream": "Cream: [Peanut Butter]",
  "topping": "Topping: [Strawberry]"
}
</code></pre>

<p>I tried to keep the implementation clean and developer friendly so the real use case of the Builder design pattern can be seen and understood.</p>

<p>If you enjoyed reading this blog post, please share it or <a href="https://www.facebook.com/dealwithjs">like</a> the Facebook page of the website to get regular updates.</p>

<p>Thank you for reading!</p>

					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-54" name="t-54"></a><h1>54 : Better JavaScript with ES6, Pt. II: A Deep Dive into Classes</h1>
					<div class="tutorial__content">
					<span>https://scotch.io/tutorials/better-javascript-with-es6-pt-ii-a-deep-dive-into-classes</span>
   <h2>Out with the Old, In with the <code>new</code></h2>
<p>Let's be clear about one thing from the start:</p>
<blockquote>
<p>Under the hood, ES6 classes are not something that is radically new: They mainly provide more convenient syntax to create old-school constructor functions. ~ Axel Rauschmayer</p>
</blockquote>
<p>Functionally, <code>class</code> is little more than syntactic sugar over the prototype-based behavior delegation capabilities we've had all along. This article will take a close look at the basic use of ES2015's <code>class</code> keyword, from the perspective of its relation to prototypes. We'll cover:</p>
<ul>
<li>Defining and instantiating classes;</li>
<li>Creating subclasses with <code>extends</code>;</li>
<li><code>super</code> calls from subclasses; and </li>
<li>Examples of important symbol methods.  </li>
</ul>
<p>Along the way, we'll pay special attention to how <code>class</code> maps to prototype-based code under the hood.  </p>
<p>Let's take it from the top.</p>
<h2>A Step Back: What Classes <em>Aren't</em></h2>
<p>JavaScript's "classes" aren't anything like classes in Java, Python, or . . . Really, any other object-oriented language you're likely to have used. Which, by the way, I'll refer to as <em>class</em>-oriented languages, as that's more accurate.</p>
<p>In traditional class-oriented languages, you create <em>classes</em>, which are templates for <em>objects</em>. When you want a new object, you <em>instantiate</em> the class, which tells the language engine to <em>copy</em> the methods and properties of the class into a new entity, called an <em>instance</em>. The <em>instance</em> is your object, and, after instantiation, has absolutely no active relation with the parent class. </p>
<p>JavaScript does <em>not</em> have such copy mechanics. "Instantiating" a <code>class</code> in JavaScript <em>does</em> create a new object, but <em>not</em> one that is  independent of its parent class.</p>
<p>Rather, it creates an object that is linked to a <em>prototype</em>. Changes to that prototype propagate to the new object, <em>even after</em> instantiation. </p>
<p>Prototypes are an immensely powerful design pattern in their own right. There are a number of techniques for using them to emulate something like traditional class mechanics, and it's these techniques that <code>class</code> provides compact syntax for.</p>
<p>To summarize:</p>
<ol>
<li>JavaScript <em>does not</em> have classes, the way that Java and other languages have classes; and</li>
<li>JavaScript's <code>class</code> is (mostly) just syntactical sugar for prototypes, which are <em>very</em> different from traditional classes.   </li>
</ol>
<p>With that out of the way, let's get our feet wet with <code>class</code>.</p>
<h2>Base Classes: Declarations &amp; Expressions</h2>
<p>You create classes with the <code>class</code> keyword, followed by an identifier, and finally, a code block, called the <em>class body</em>. These are called <strong>class declarations</strong>. Class declarations that don't use the <code>extends</code> keyword are called <em>base classes</em>:</p>
<pre><code class="language-javascript">"use strict";

// Food is a base class
class Food {

    constructor (name, protein, carbs, fat) {
        this.name = name;
        this.protein = protein;
        this.carbs = carbs;
        this.fat = fat;
    }

    toString () {
        return `${this.name} | ${this.protein}g P :: ${this.carbs}g C :: ${this.fat}g F`
    }

    print () {
      console.log( this.toString() );
    }
}

const chicken_breast = new Food('Chicken Breast', 26, 0, 3.5);

chicken_breast.print(); // 'Chicken Breast | 26g P :: 0g C :: 3.5g F'
console.log(chicken_breast.protein); // 26 (LINE A)</code></pre>
<p>A few things to note.</p>
<ul>
<li>Classes can <em>only</em> contain method definitions, <strong>not</strong> data properties;</li>
<li>When defining methods, you use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Method_definitions">shorthand method definitions</a>;</li>
<li>Unlike when creating objects, you do <em>not</em> separate method definitions in class bodies with commas; and</li>
<li>You <em>can</em> refer to properties on instances of the class directly (Line A).</li>
</ul>
<p>A distinctive feature of classes is the function called <strong>constructor</strong>. This is where you initialize your object's properties. </p>
<p>You don't  <em>have</em>  to define a constructor function. If you choose not to, the engine will insert an empty one for you:</p>
<pre><code class="language-javascript">"use strict";

class NoConstructor { 
    /* JavaScript inserts something like this:
     constructor () { }
    */
}

const nemo = new NoConstructor(); // Works, but pretty boring</code></pre>
<p>Assigning a class to a variable is called a <strong>class expression</strong>, and is an alternative to the above syntax:</p>
<pre><code class="language-javascript">"use strict";

// This is an anonymous class expression -- you can't refer to the it by name within the class body.
const Food = class {
    // Class definition is the same as before. . . 
}

// This is a named class expression -- you /can/ refer to this class by name within the class body . . . 
const Food = class FoodClass {
    // Class definition is the same as before . . . 

    //  Adding new method, to demonstrate we can refer to FoodClass by name
    //   within the class . . . 
    printMacronutrients () {
      console.log(`${FoodClass.name} | ${FoodClass.protein} g P :: ${FoodClass.carbs} g C :: ${FoodClass.fat} g F`)
    }
}

const chicken_breast = new Food('Chicken Breast', 26, 0, 3.5);
chicken_breast.printMacronutrients(); // 'Chicken Breast | 26g P :: 0g C :: 3.5g F'

// . . . But /not/ outside of it
try {
    console.log(FoodClass.protein); // ReferenceError 
} catch (err) { 
    // pass
}</code></pre>
<p>This behavior is analogous to that of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/function">anonymous and named function expressions</a>.</p>
<h2>Creating Subclasses with <code>extends</code> &amp; Calling with <code>super</code></h2>
<p>Classes created with <code>extends</code> are called <strong>subclasses</strong>, or <strong>derived classes</strong>. Using them is straightforward. Building on our Food example:</p>
<pre><code class="language-javascript">"use strict";

// FatFreeFood is a derived class
class FatFreeFood extends Food {

    constructor (name, protein, carbs) {
        super(name, protein, carbs, 0);
    }

    print () {
        super.print(); 
        console.log(`Would you look at that -- ${this.name} has no fat!`);
    }

}

const fat_free_yogurt = new FatFreeFood('Greek Yogurt', 16, 12);
fat_free_yogurt.print(); // 'Greek Yogurt | 26g P :: 16g C :: 0g F  /  Would you look at that -- Greek Yogurt has no fat!'</code></pre>
<p>Everything we discussed above regarding base classe holds true for derived classes, but with a few additional points.</p>
<ul>
<li>Subclasses are declared with the <code>class</code> keyword, followed by an identifier, and then the <code>extends</code> keyword, followed by an <em>arbitrary expression</em>. This will generally just be an identifier, <a href="https://gist.github.com/sebmarkbage/fac0830dbb13ccbff596">but could, in theory, be a function</a>.</li>
<li>If your derived class needs to refer to the class it extends, it can do so with the <code>super</code> keyword.</li>
<li>A derived class can't contain an empty constructor. Even if all the constructor does is call <code>super()</code>, you'll still have to do so explicitly. It can, however, contain <em>no</em> constructor.</li>
<li>You <em>must</em> call <code>super</code> in the constructor of a derived class before you use <code>this</code>.</li>
</ul>
<p>In JavaScript, there are precisely two use cases for the <code>super</code> keyword. </p>
<ol>
<li><strong>Within subclass constructor calls</strong>. If initializing your derived class requires you to use the parent class's constructor, you can call <code>super(parentConstructorParams[ )</code> within the subclass constructor, passing along any necessary parameters. </li>
<li><strong>To refer to methods in the superclass</strong>. Within normal method definitions, derived classes can refer to methods on the parent class with dot notation: <code>super.methodName</code>. </li>
</ol>
<p>Our <code>FatFreeFood</code> demonstrates both use cases:</p>
<ol>
<li>In the constructor, we simply call <code>super</code>, passing along <code>0</code> as our quantity of fat.</li>
<li>In our <code>print</code> method, we first call <code>super.print</code>, and add additional logic after.</li>
</ol>
<p>Believe it or not, that wraps up the basic syntactical overview of <code>class</code>; this is all you need to start experimenting.</p>
<h2>Prototypes: A Deep Dive</h2>
<p>It's time we turn our attention to how <code>class</code> maps to JavaScript's underlying prototype mechanisms. We'll look at:</p>
<ul>
<li>Creating objects with constructor calls;</li>
<li>The nature of prototype linkages;</li>
<li>Property &amp; method delegation; and</li>
<li>Emulating classes with prototypes</li>
</ul>
<h3>Creating Objects with Constructor Calls</h3>
<p>Constructors are nothing new. Calling <em>any</em> function with the <code>new</code> keyword causes it to return an object -- this is called making a <em>constructor call</em>, and such functions are generally called <em>constructors</em>:</p>
<pre><code class="language-javascript">"use strict";

function Food (name, protein, carbs, fat) {
    this.name    = name;
    this.protein = protein;
    this.carbs    = carbs;
    this.fat          = fat;
}

// Calling Food with 'new' is a "constructor call", and results in its returning an object 
const chicken_breast = new Food('Chicken Breast', 26, 0, 3.5);
console.log(chicken_breast.protein) // 26

// Failing to call Food with 'new' results in its returning 'undefined'
const fish = Food('Halibut', 26, 0, 2);
console.log(fish); // 'undefined'</code></pre>
<p>When you call a function with <code>new</code>, four things happen under the hood:</p>
<ol>
<li>A new object gets created (let's call it <strong>O</strong>);</li>
<li><strong>O</strong> gets linked to another object, called its <em>prototype</em>;</li>
<li>The function's <code>this</code> value is set to refer to <strong>O</strong>;</li>
<li>The function implicitly returns <strong>O</strong>.</li>
</ol>
<p>It's between steps three and four that the engine executes your function's specific logic.</p>
<p>Knowing this, we can rewrite our <code>Food</code> function to work <em>without</em> the <code>new</code> keyword:</p>
<pre><code class="language-javascript">"use strict";

// Eliminating the need for 'new' -- just for demonstration
function Food (name, protein, carbs, fat) {
       // Step One: Create a new Object
    const obj = { }; 

    // Step Two: Link prototypes -- we'll cover this in greater detail shortly
    Object.setPrototypeOf(obj, Food.prototype);

    // Step Three: Set 'this' to point to our new Object
    //    Since we can't reset `this` inside of a running execution context, 
    //      we simulate Step Three by using 'obj' instead of 'this'
    obj.name    = name;
    obj.protein = protein;
    obj.carbs    = carbs;
    obj.fat         = fat;

    // Step Four: Return the newly created object
    return obj;
}

const fish = Food('Halibut', 26, 0, 2);
console.log(fish.protein); // 26</code></pre>
<p>Three of these four steps are straightforward. Creating an object, assigning properties, and writing a <code>return</code> statement are unlikely to give most developers any conceptual trouble: It's the prototype weirdness that trips people up.</p>
<h3>Grokking the Prototype Chain</h3>
<p>Under normal circumstances, all objects in JavaScript -- including Functions -- are linked to another object, called its <em>prototype</em>. </p>
<p>If you request a property on an object that the object doesn't have, JavaScript checks the object's prototype for that property. In other words, if you ask for a property on an object that the object doesn't have, it says: "I don't know. Ask my prototype."</p>
<p>This process -- referring lookups for nonexistent properties to another object -- is called <em>delegation</em>.</p>
<pre><code class="language-javascript">"use strict";

// joe has no toString property . . . 
const joe    = { name : 'Joe' },
       sara  = { name : 'Sara' };

Object.hasOwnProperty(joe, toString); // false
Object.hasOwnProperty(sara, toString); // false

// . . . But we can call it anyway!
joe.toString(); // '[object Object]', instead of ReferenceError!
sara.toString(); // '[object Object]', instead of ReferenceError!</code></pre>
<p>The output from our <code>toString</code> calls is utterly useless, but note that this snippet doesn't raise a single <code>ReferenceError</code>! That's because, while neither <code>joe</code> or <code>sara</code> has a <code>toString</code> property, <em>their prototype does</em>.</p>
<p>When we look for <code>sara.toString()</code>, <code>sara</code> says, "I don't have a <code>toString</code> property. Ask my prototype." JavaScript, obligingly, does as told, and asks <code>Object.prototype</code> if <em>it</em> has a <code>toString</code> property. Since it does, it hands <code>Object.prototype</code>'s <code>toString</code> back to our program, which executes it. </p>
<p>It doesn't matter that <code>sara</code> didn't have the property herself -- <em>we just delegated the lookup to the prototype</em>.</p>
<p>In other words, we can access non-existent properties on an object <em>as long as that object's prototype <strong>does</strong> have those properties</em>. We can take advantage of this by assigning properties and methods to an object's prototype, so that we can use them as if they existed on the object itself. </p>
<p>Even better, if several objects share the same prototype -- as is the case with <code>joe</code> and <code>sara</code> above -- they can <em>all</em> access that prototype's properties, immediately after we assign them, <em>without</em> our having to copy those properties or methods to each individual object. </p>
<p>This is what people generally refer to as <em>prototypical/prototypal inheritance</em> -- if my object doesn't have it, but my object's prototype does, my object <em>inherits</em> the property. </p>
<p>In reality, there's no "inheritance" going on, here. In class-oriented languages, inheritance implies behavior is <em>copied</em> from a parent to a child. In JavaScript, no such copying takes place -- which is, in fact, one of the major benefits of prototypes over classes.</p>
<p>Here's a quick recap before we see precisely where these prototypes come from:</p>
<ul>
<li><code>joe</code> and <code>sara</code> do <em>not</em> "inherit" a <code>toString</code> property;</li>
<li><code>joe</code> and <code>sara</code>, as a matter of fact, do <em>not</em> "inherit" from <code>Object.prototype</code> <em>at all</em>;</li>
<li><code>joe</code> and <code>sara</code> <em>are</em> <strong>linked</strong> to <code>Object.prototype</code>;</li>
<li>Both <code>joe</code> and <code>sara</code> are linked to the <em>same</em> <code>Object.prototype</code>.</li>
<li>To find the prototype of an object -- let's call it <strong>O</strong> -- you use: <code>Object.getPrototypeOf(O)</code>.</li>
</ul>
<p>And, just to hammer it home: Objects do not "inherit from" their prototypes. They <em>delegate</em> to them.</p>
<p>Period.</p>
<p>Let's dig deeper.</p>
<h2>Setting an Object's Prototype</h2>
<p>We learned above that (almost) every object (<strong>O</strong>) has a <em>prototype</em> (<strong>P</strong>), and that, when you look for a property on <strong>O</strong> that <strong>O</strong> doesn't have, the JavaScript engine will look for that property on <strong>P</strong> instead.</p>
<p>From here, the questions are:</p>
<ol>
<li>How do <em>functions</em> play into all of this?</li>
<li>Where do these prototypes come from, anyway?</li>
</ol>
<h3>A Function Named Object</h3>
<p>Before the JavaScript engine executes a program, it builds an environment to run it in, in which it creates a function, called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>, and an associated object, called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/prototype">Object.prototype</a>. </p>
<p>In other words, <code>Object</code> and <code>Object.prototype</code> <em>always</em> exist, in <em>any</em> executing JavaScript program.</p>
<p>The <em>function</em>, <code>Object</code>, is like any other function. In particular, it's a <em>constructor</em> -- calling it returns a new object:</p>
<pre><code class="language-javascript">"use strict";

typeof new Object(); // "object"
typeof Object();         // A peculiarity of the Object function is that it does /not/ need to be called with new.</code></pre>
<p>The <em>object</em>, <code>Object.prototype</code>, is . . . Well, an object. And, like many objects, it has properties.</p>
<p><img src="https://i.imgsafe.org/ebbd5e3.png" alt="Properties on Object.prototype"></p>
<p>Here's what you need to know about <code>Object</code> and <code>Object.prototype</code>:</p>
<ol>
<li>The <em>function</em>, <code>Object</code>, has a property, called <code>.prototype</code>, which points to an object (<code>Object.prototype</code>);</li>
<li>The <em>object</em>, <code>Object.prototype</code>, has a property, called <code>.constructor</code>, which points to a function (<code>Object</code>).</li>
</ol>
<p>As it turns out, this general scheme is true for <em>all</em> functions in JavaScript. When you create a function -- <code>someFunction</code> -- it will have a property, <code>.prototype</code>, that points to an object, called <code>someFunction.prototype</code>.</p>
<p>Conversely, that object -- <code>someFunction.prototype</code> -- will have a property, called <code>.constructor</code>, which points <em>back</em> to the function <code>someFunction</code>.</p>
<pre><code class="language-javascript">"use strict";

function foo () {  console.log('Foo!');  }

console.log(foo.prototype); // Points to an object called 'foo'
console.log(foo.prototype.constructor); // Points to the function, 'foo'

foo.prototype.constructor(); // Prints 'Foo!' -- just proving that 'foo.prototype.constructor' does, in fact, point to our original function </code></pre>
<p>The major points to keep in mind are these:</p>
<ol>
<li>All functions have a property, called <code>.prototype</code>, which points to an object associated with that function.</li>
<li>All function prototypes have a property, called <code>.constructor</code>, which points back to the function.</li>
<li>A function prototype's <code>.constructor</code> does not necessarily point to the function that created the function prototype . . . Confusingly enough. We'll touch on this in greater detail soon.</li>
</ol>
<p>These are the rules for setting a <em>function's</em> prototype. With that out of the way, we can cover three rules for setting an object's prototype:</p>
<ol>
<li>The "default" rule;</li>
<li>Setting the prototype implicitly, with <code>new</code>;</li>
<li>Setting the prototype explicitly, with <code>Object.create</code>.</li>
</ol>
<h3>The Default Rule</h3>
<p>Consider this snippet:</p>
<pre><code class="language-javascript">"use strict";

const foo = { status : 'foobar' };</code></pre>
<p>Refreshingly simple. All we've done is create an object, called <code>foo</code>, and give it a property, called <code>status</code>.</p>
<p>Behind the scenes, however, JavaScript does a little extra work. When we create an object literal, JavaScript sets the object's prototype reference to <code>Object.prototype</code>, and sets its <code>.constructor</code> reference to <code>Object</code>:</p>
<pre><code class="language-javascript">"use strict";

const foo = { status : 'foobar' };

Object.getPrototypeOf(foo) === Object.prototype; // true
foo.constructor === Object; // true</code></pre>
<h3>Setting the Prototype Implicitly with <code>new</code></h3>
<p>Let's take another look at our modified <code>Food</code> example.</p>
<pre><code class="language-javascript">"use strict";

function Food (name, protein, carbs, fat) {
    this.name    = name;
    this.protein = protein;
    this.carbs    = carbs;
    this.fat          = fat;
}</code></pre>
<p>By now, we know that the <em>function</em> <code>Food</code> will be associated with an <em>object</em>, called <code>Food.prototype</code>. </p>
<p>When we create an object using the <code>new</code> keyword, JavaScript:</p>
<ol>
<li>Sets the object's prototype reference to the <code>.prototype</code> property of the function you called with <code>new</code>; and</li>
<li>Sets the object's <code>.constructor</code> reference to the function you called <code>new</code> with.</li>
</ol>
<pre><code class="language-javascript">const tootsie_roll = new Food('Tootsie Roll', 0, 26, 0);

Object.getPrototypeOf(tootsie_roll) === Food.prototype; // true
tootsie_roll.constructor === Food; // true</code></pre>
<p>This is what lets us do slick stuff like this:</p>
<pre><code class="language-javascript">"use strict";

Food.prototype.cook = function cook () {
    console.log(`${this.name} is cooking!`);
};

const dinner = new Food('Lamb Chops', 52, 8, 32);
dinner.cook(); // 'Lamb Chops are cooking!'</code></pre>
<h3>Setting the Prototype Explicitly with <code>Object.create</code></h3>
<p>Finally, we can set an object's prototype reference <em>manually</em>, using a utility called <code>Object.create</code>.</p>
<pre><code class="language-javascript">"use strict";

const foo = {
    speak () {
    console.log('Foo!');
    }
};

const bar = Object.create(foo);

bar.speak(); // 'Foo!'
Object.getPrototypeOf(bar) === foo; // true</code></pre>
<p>Remember the four things that JavaScript does under the hood when you call a function with <code>new</code>? <code>Object.create</code> does all but the third step:</p>
<ol>
<li>Create a new object;</li>
<li>Set its prototype reference; and</li>
<li>Return the new object.</li>
</ol>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">You can see this yourself if you take a look at the polyfill</a>.</p>
<h3>Emulating <code>class</code> Behavior</h3>
<p>Using prototypes directly, emulating class-oriented behavior required a bit of manual acrobatics.</p>
<pre><code class="language-javascript">"use strict";

function Food (name, protein, carbs, fat) {
    this.name    = name;
    this.protein = protein;
    this.carbs    = carbs;
    this.fat          = fat;
}

Food.prototype.toString = function () {
    return `${this.name} | ${this.protein}g P :: ${this.carbs}g C :: ${this.fat}g F`;
};

function FatFreeFood (name, protein, carbs) {
    Food.call(this, name, protein, carbs, 0);
}

// Setting up "subclass" relationships
// =====================
// LINE A :: Using Object.create to manually set FatFreeFood's "parent".
FatFreeFood.prototype = Object.create(Food.prototype);

// LINE B :: Manually (re)setting constructor reference (!)
Object.defineProperty(FatFreeFood.constructor, "constructor", {
    enumerable : false,
    writeable      : true,
    value             : FatFreeFood
});</code></pre>
<p>At Line A, we have to set <code>FatFreeFood.prototype</code> equal to a new object, whose prototype reference is to <code>Food.prototype</code>. If we fail to do this, our "child classes" won't have access to "superclass" methods. </p>
<p>Unfortunately, this results in the rather bizarre behavior that <code>FatFreeFood.constructor</code> is <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function">Function</a> . . . Not <code>FatFreeFood</code>. So, to keep everything sane, we have to manually set <code>FatFreeFood.constructor</code> by hand at Line B.</p>
<p>Sparing developers from the noise and unwieldliness of emulating class behavior with prototypes is one of the motives for the <code>class</code> keyword. It <em>does</em> provide a solution to the most common gotchas of prototype syntax.</p>
<p>Now that we've seen so much of JavaScript's prototype mechanics, it should be easier to appreciate just <em>how</em> much easier it can make things! </p>
<h2>A Closer Look at Methods</h2>
<p>Now that we've seen the essentials of JavaScript's prototype system, we'll wrap up by taking a closer look at three kinds of methods classes support, and a special case of the last sort:</p>
<ul>
<li>Constructors;</li>
<li>Static methods; </li>
<li>Prototype methods; and</li>
<li>"Symbol methods", a special case of <em>prototype methods</em></li>
</ul>
<p>I didn't come up with these groups -- credit goes to Dr Rauschmayer for identifying them in <a href="http://exploringjs.com/es6/ch_classes.html">Exploring ES6</a>.</p>
<h3>Class Constructors</h3>
<p>A class's <code>constructor</code> function is where you'll focus your initialization logic. The <code>constructor</code> is special in a few ways:</p>
<ol>
<li>It's the only method of a class from which you can make a superconstructor call;</li>
<li>It handles all the dirty work of setting up the prototype chain properly; and </li>
<li>It acts as the definition of the class.</li>
</ol>
<p>Point 2 is one of the principle benefits to using <code>class</code> in JavaScript. To quote heading 15.2.3.1 of Exploring ES6:</p>
<blockquote>
<p><strong>The prototype of a subclass is the superclass.</strong></p>
</blockquote>
<p>As we've seen, setting this up manually is tedious and error-prone. That the language takes care of it all behind the scenes if we use <code>class</code> is a major boon. </p>
<p>Point 3 is interesting. In JavaScript, a class is just a function -- it's equivalent to the <code>constructor</code> method in the class.</p>
<pre><code class="language-javascript">"use strict";

class Food {
    // Class definition is the same as before . . . 
}

typeof Food; // 'function'</code></pre>
<p>Unlike normal-functions-as-constructors, you can't call a class's constructor without the <code>new</code> keyword:</p>
<p><code>const burrito = Food('Heaven', 100, 100, 25); // TypeError</code></p>
<p>. . . Which raises another question: What happens when we call a function-as-constructor <em>without</em> new?</p>
<p>The short answer: It returns <code>undefined</code>, as does any function without an explicit return. You just have to trust your users will constructor-call your function. This is why the community has adopted the convention of only capitalizing constructor names: It's a reminder to call with <code>new</code>. </p>
<pre><code class="language-javascript">"use strict";

function Food (name, protein, carbs, fat) {
    this.name    = name;
    this.protein = protein;
    this.carbs    = carbs;
    this.fat          = fat;
}

const fish = Food('Halibut', 26, 0, 2); // D'oh . . .
console.log(fish); // 'undefined'</code></pre>
<p>The long answer: It returns <code>undefined</code>, <em>unless</em> you manually detect that it wasn't called with <code>new</code>, and then do something about it yourself. </p>
<p>ES2015 introdues a property that makes this check trivial: <code>[new.target]</code>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new.target">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new.target</a>).</p>
<p><code>new.target</code> is a property defined on all functions called with <code>new</code>, including class constructors. When you call a function with the <code>new</code> keyword, the value of <code>new.target</code> within the function body is the function itself. If the function wasn't called with <code>new</code>, its value is <code>undefined</code>.</p>
<pre><code class="language-javascript">"use strict";

// Enforcing constructor call
function Food (name, protein, carbs, fat) {
    // Manually call 'new' if user forgets
    if (!new.target)
        return new Food(name, protein, carbs, fat); 

    this.name    = name;
    this.protein = protein;
    this.carbs    = carbs;
    this.fat          = fat;
}

const fish = Food('Halibut', 26, 0, 2); // Oops -- but, no problem!
fish; // 'Food {name: "Halibut", protein: 20, carbs: 5, fat: 0}'</code></pre>
<p>This wasn't any worse in ES5:</p>
<pre><code class="language-javascript">"use strict";

function Food (name, protein, carbs, fat) {

    if (!(this instanceof Food))
        return new Food(name, protein, carbs, fat); 

    this.name    = name;
    this.protein = protein;
    this.carbs    = carbs;
    this.fat          = fat;
}</code></pre>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new.target">MDN documentation</a> has more details on <code>new.target</code>, and the <a href="https://tc39.github.io/ecma262/#sec-built-in-function-objects">spec is the definitive reference</a> for the truly curious. The  descriptions of [[Construct]] are particularly illuminating.</p>
<h3>Static Methods</h3>
<p><em>Static methods</em> are methods on the constructor function itself, which are <em>not</em> available on instances of the class. You define them by using the <code>static</code> keyword.</p>
<pre><code class="language-javascript">"use strict";

class Food {
     // Class definition is the same as before . . . 

     // Adding a static method
     static describe () {
       console.log('"Food" is a data type for storing macronutrient information.');
      }
}

Food.describe(); // '"Food" is a data type for storing macronutrient information.'</code></pre>
<p>Static methods are analogous to attaching properties directly to old-school functions-as-constructors:</p>
<pre><code class="language-javascript">"use strict";

function Food (name, protein, carbs, fat) {
    Food.count += 1;

    this.name    = name;
    this.protein = protein;
    this.carbs    = carbs;
    this.fat          = fat;
}

Food.count = 0;
Food.describe = function count () {
       console.log(`You've created ${Food.count} food(s).`);
};

const dummy = new Food();
Food.describe(); // "You've created 1 food."</code></pre>
<h3>Prototype Methods</h3>
<p>Any method that isn't a constructor or a static method is <em>prototype method</em>. The name comes from the fact that we used to achieve this functionality by attaching functions to the <code>.prototype</code> of functions-as-constructors:</p>
<pre><code class="language-javascript">"use strict";

// Using ES6:
class Food {

    constructor (name, protein, carbs, fat) {
        this.name = name;
        this.protein = protein;
        this.carbs = carbs;
        this.fat = fat;
    }

    toString () {  
    return `${this.name} | ${this.protein}g P :: ${this.carbs}g C :: ${this.fat}g F`; 
    }

    print () {  
    console.log( this.toString() );  
    }
}

// In ES5:
function Food  (name, protein, carbs, fat) {
    this.name = name;
    this.protein = protein;
    this.carbs = carbs;
    this.fat = fat;
}

// The name "prototype methods" presumably comes from the fact that we 
//    used to attach such methods to the '.prototype' old-school functions-as-constructors.
Food.prototype.toString = function toString () {
    return `${this.name} | ${this.protein}g P :: ${this.carbs}g C :: ${this.fat}g F`; 
};

Food.prototype.print = function print () {
    console.log( this.toString() ); 
};</code></pre>
<p>To be clear, it's perfectly fine to use generators in method definitions, as well:</p>
<pre><code class="language-javascript">"use strict";

class Range {

  constructor(from, to) {
    this.from = from;
    this.to   = to;
  }

  * generate () {
    let counter = this.from,
        to      = this.to;

    while (counter &lt; to) {
      if (counter == to)
        return counter++;
      else
        yield counter++;
    }
  }
}

const range = new Range(0, 3);
const gen = range.generate();
for (let val of range.generate()) {
  console.log(`Generator value is: ${ val }. `);
  //  Prints:
  //    Generator value is: 0.
  //    Generator value is: 1.
  //    Generator value is: 2.
}</code></pre>
<h3>Symbol Methods</h3>
<p>Finally, there are the <em>symbol methods</em>. These are functions whose names are <code>Symbol</code> values, and which the JavaScript engine recognizes and uses when you use certain built-in constructs with your custom objects.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">MDN docs</a> provide a succinct overview of what Symbols are in general:</p>
<blockquote>
<p>A symbol is a unique and immutable data type and may be used as an identifier for object properties.</p>
</blockquote>
<p>Creating a new symbol provides you with a value that is guaranteed to be unique within your program. This is what makes it useful for naming object properties: You're guaranteed never to accidentally shadow anything. Symbol-valued keys also aren't innumerable, so they're largely invisible to the outside world (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys">but not completely</a>).</p>
<pre><code class="language-javascript">"use strict";

const secureObject = {
    // This key is guaranteed to be unique.
    [new Symbol("name")] : 'Dr. Secure A. F.'
};

console.log( Object.getKeys(superSecureObject) ); // [] -- The symbol property is pretty hard to get at . . .  
console.log( Reflect.ownKeys(secureObject) ); // [Symbol("name")] -- . . . But, not /truly/ hidden.</code></pre>
<p>More interestingly for us, they give us a way to tell the JavaScript engine to use certain functions for special purposes.</p>
<p>The so-called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">Well-known Symbols</a> are special object keys that identify functions the JavaScript engine invokes when you use certain built-in constructs with custom objects.</p>
<p>This is a bit exotic for JavaScript, so let's see an example:</p>
<pre><code class="language-javascript">"use strict";

// Extending Array lets us use 'length' in an intuitive way,
//   and also gives us access to built-in array methods, like 
//   map, filter, reduce, push, pop, etc.
class FoodSet extends Array {

    // ...foods collects arbitrary number of arguments into an array
    //   https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator
    constructor(...foods) {
        super();
        this.foods = [];
        foods.forEach((food) =&gt; this.foods.push(food))
    }

     // Custom iterator behavior. This isn't very *useful* iterator behavior, mind you, but it's a fine example.
     // The asterisk *must* precede the name of the key.
     * [Symbol.iterator] () {
        let position = 0;
        while (position &lt; this.foods.length) {
          if (position === this.foods.length) {
              return "Done!"
          } else {
              yield `${this.foods[ position++ ]} is the food item at position ${position}`;
          }
         }
     }

      // Return an object of type Array, rather than type FoodSet, when users
      //   use built-in array methods. This makes our FoodSet interoperable
      //   with code expecting an array.
      static get [Symbol.species] () {
          return Array;
      }
}

const foodset = new FoodSet(new Food('Fish', 26, 0, 16), new Food('Hamburger', 26, 48, 24));

// When you use for . . . of with a FoodSet, JavaScript will iterate using the function you 
//    assoiated with the key [Symbol.iterator].
for (let food of foodset) {
  // Prints all of our foods
  console.log( food );
}

// JavaScript creates and returns a new object when you `filter` on an array, 
//    which it creates using the default constructor of the object you execute `filter` on.
//
//    Since most code would expect filter to return an Array, we can tell JavaScript
//       to use the Array constructor when implicitly creating a new instance by 
//       overriding [Symbol.species].
const healthy_foods = foodset.filter((food) =&gt; food.name !== 'Hamburger');

console.log( healthy_foods instanceof FoodSet ); // 
console.log( healthy_foods instanceof Array );</code></pre>
<p>When you use a <code>for...of</code> loop on an object, JavaScript will try to execute the object's <em>iterator</em> function, which is the function associated with the key, <code>Symbol.iterator</code>. If you provide your own definition, JavaScript will use that. If you don't, it'll use the default implementation, if there is one; or do nothing, if there isn't.</p>
<p><code>Symbol.species</code> is a bit more exotic. In a custom class, the default <code>Symbol.species</code> function is the constructor for your class. When you subclass built-in collections, like <code>Array</code> or <code>Set</code>, however, you'll often want to be able to use your subclass wherever you could use an instance of the parent class.</p>
<p>Returning instances of the parent class from methods on the class <em>instead</em> of instances of the derived class gets us closer to ensuring full interoperability of a subclass with more general code. This is  <code>Symbol.species</code> allows.</p>
<p>Don't sweat it if this bit doesn't make much sense. Using symbols this way -- or at all -- is still a niche case, and the point of these examples is to demonstrate:</p>
<ol>
<li>That you <em>can</em> use certain built-in JavaScript constructs with custom classes; and</li>
<li><em>How</em> you achieve that, in two common cases.</li>
</ol>
<h2>Conclusion</h2>
<p>ES2015's <code>class</code> keyword does <em>not</em> bring us "true classes", a là Java or SmallTalk. Rather, it simply provides a more convenient syntax for creating objects related via prototype linkage. Under the hood, there's nothing new here. </p>
<p>I covered enough of JavaScript's prototype mechanism for our discussion, but there's quite a bit more to say. Read Kyle Simpson's <a href="https://github.com/getify/You-Dont-Know-JS/tree/master/this%20%26%20object%20prototypes">this &amp; Object Prototypes</a> for fuller coverage on that front. <a href="https://github.com/getify/You-Dont-Know-JS/blob/master/this%20&amp;%20object%20prototypes/apA.md">Appendix A</a> is particularly relevant.</p>
<p>For the nitty-gritty on ES2015 classes, Dr Rauschmayer's <a href="http://exploringjs.com/es6/ch_classes.html">Exploring ES6: Classes</a> should be your go-to resource. It was the inspiration for much of what I've written here.</p>
<p>Finally, if you've got questions, drop a line in the comments, or <a href="https://twitter.com/PelekeS">hit me on Twitter</a>. I'll do my best to get back to everyone directly.</p>
<p>What do you think about <code>class</code>? Love it, hate it, no strong feelings? It seems like everyone's got an opinion -- let us know yours below!</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-55" name="t-55"></a><h1>55 : Recursion in JavaScript with ES6, destructuring and rest/spread</h1>
					<div class="tutorial__content">
<div class="section-inner sectionLayout--insetColumn"><p name="6315" id="6315" class="graf graf--p graf-after--h3">The latest ECMA standard for JavaScript (ECMAScript 6) makes JavaScript more readable by encouraging a more declarative style with functional constructs and new operators.</p><h3 name="2db3" id="2db3" class="graf graf--h3 graf-after--p">Destructuring</h3><p name="fd09" id="fd09" class="graf graf--p graf-after--h3">One of my favourite ES6 features is <strong class="markup--strong markup--p-strong">destructuring</strong>. It allows you to extract data from one variable to another by using <strong class="markup--strong markup--p-strong">structure</strong>. For arrays this means for example:</p><pre name="98df" id="98df" class="graf graf--pre graf-after--p">var [ first, second ] = [ 1, 2, 3, 4 ];<br>// first: 1<br>// second: 2</pre><p name="41ca" id="41ca" class="graf graf--p graf-after--pre">There's more you can do, like skip some members of the array on the right-hand side of the operation.</p><pre name="ced1" id="ced1" class="graf graf--pre graf-after--p">var [ first, , third, fourth ] = [ 1, 2, 3, 4 ];<br>// first: 1<br>// third: 3<br>// fourth: 4</pre><p name="657c" id="657c" class="graf graf--p graf-after--pre">This is actually quite easily back-ported to the equivalent ES5</p><pre name="c06d" id="c06d" class="graf graf--pre graf-after--p">var arr = [ 1, 2, 3, 4 ];<br>var first = arr[0];<br>var second = arr[1];<br>// etc ...</pre><h3 name="4654" id="4654" class="graf graf--h3 graf-after--pre">Rest</h3><p name="5302" id="5302" class="graf graf--p graf-after--h3">This is where ES6 features become more interesting. With destructuring we can also assign what is called the <strong class="markup--strong markup--p-strong">rest</strong> of the array. We indicate <strong class="markup--strong markup--p-strong">rest</strong> with the&nbsp;<code class="markup--code markup--p-code">...</code> notation.</p><pre name="846f" id="846f" class="graf graf--pre graf-after--p">var [ first, ...notFirst ] = [ 1, 2, 3, 4 ];<br>// first: 1<br>// notFirst: [ 2, 3, 4 ]</pre><p name="8744" id="8744" class="graf graf--p graf-after--pre">Naming conventions lead to code that is more akin to the following:</p><pre name="c414" id="c414" class="graf graf--pre graf-after--p">var [ first, second, ...rest ] = [ 1, 2, 3, 4 ]<br>// first: 1<br>// second: 2<br>// rest: [ 3, 4 ]</pre><p name="3005" id="3005" class="graf graf--p graf-after--pre">The <code class="markup--code markup--p-code">rest</code> operator has some interesting properties:</p><pre name="ccb7" id="ccb7" class="graf graf--pre graf-after--p">var [ first, ...rest ] = [ 1 ]<br>// first: 1<br>// rest: []</pre><p name="28a4" id="28a4" class="graf graf--p graf-after--pre">It always returns an array. Which means even in defensive JavaScript land, it's ok to do things like check&nbsp;<code class="markup--code markup--p-code">.length</code> of <code class="markup--code markup--p-code">rest</code> without guards.</p><p name="a16e" id="a16e" class="graf graf--p graf-after--p">The equivalent in ES5 (and below) is to use the<code class="markup--code markup--p-code">Array.slice</code> function.</p><pre name="ec67" id="ec67" class="graf graf--pre graf-after--p">var arr = [ 1, 2, 3, 4 ];<br>var first = arr[0];<br>var rest = arr.slice(1);<br>// first: 1<br>// rest: [ 2, 3, 4 ]</pre><p name="b865" id="b865" class="graf graf--p graf-after--pre">Two things to note here:</p><ul class="postList"><li name="074a" id="074a" class="graf graf--li graf-after--p">the ES5 version is more verbose</li><li name="b0e0" id="b0e0" class="graf graf--li graf-after--li">the ES5 version is more imperative, we tell JavaScript <strong class="markup--strong markup--li-strong">how</strong> to do something instead of telling it <strong class="markup--strong markup--li-strong">what</strong> we want.</li></ul><p name="50fa" id="50fa" class="graf graf--p graf-after--li">Now I also think that the structure-matching version (with rest) is more readable.</p><h3 name="94d5" id="94d5" class="graf graf--h3 graf-after--p">Parameter destructuring</h3><p name="3dd9" id="3dd9" class="graf graf--p graf-after--h3">We can use destructuring on the parameters of a function definition:</p><pre name="a3ae" id="a3ae" class="graf graf--pre graf-after--p">function something([ first, ...rest ]) {<br>  return {<br>    first: first,<br>    rest: rest<br>  };<br>}<br>var result = something([1, 2, 3]);<br>// result: { first: 1, rest: [ 2,3 ] }</pre><p name="8331" id="8331" class="graf graf--p graf-after--pre">Equivalent ES5:</p><pre name="c01e" id="c01e" class="graf graf--pre graf-after--p">function something(arr){<br>  var first = arr[0];<br>  var rest = arr.slice(1);<br>  return {<br>    first: first,<br>    rest: rest<br>  };<br>}</pre><p name="6d26" id="6d26" class="graf graf--p graf-after--pre">Again it's more verbose and more imperative.</p><h3 name="aaa0" id="aaa0" class="graf graf--h3 graf-after--p">Spread</h3><p name="a52a" id="a52a" class="graf graf--p graf-after--h3">Spread uses the same notation as rest:&nbsp;<code class="markup--code markup--p-code">...</code>. What it does is quite different.</p><pre name="c878" id="c878" class="graf graf--pre graf-after--p">var arr = [ 1, 2, 3 ];<br>var newArr = [ ...arr ];<br>// newArr: [ 1, 2, 3]</pre><p name="92ac" id="92ac" class="graf graf--p graf-after--pre">ES5 equivalent:</p><pre name="3641" id="3641" class="graf graf--pre graf-after--p">var arr = [ 1, 2, 3 ];<br>var newArr = [].concat(arr);</pre><p name="9094" id="9094" class="graf graf--p graf-after--pre">Things to note, the contents of the array are <strong class="markup--strong markup--p-strong">copied</strong>. So <code class="markup--code markup--p-code">newArr</code> is not a reference to <code class="markup--code markup--p-code">arr</code>.</p><p name="292b" id="292b" class="graf graf--p graf-after--p">We can also do things like appending or prepending an array.</p><pre name="ea78" id="ea78" class="graf graf--pre graf-after--p">var arr = [ 1, 2, 3] ;</pre><pre name="0710" id="0710" class="graf graf--pre graf-after--pre">var withPrepend = [ ...arr, 3, 2, 1];<br>var withAppend = [ 3, 2, 1, ...arr ];<br>// withPrepend: [ 1, 2, 3, 3, 2, 1]<br>// withAppend: [ 3, 2, 1, 1, 2, 3 ]</pre><h3 name="53d6" id="53d6" class="graf graf--h3 graf-after--pre">Functional Programming: lists &amp; recursion</h3><p name="3659" id="3659" class="graf graf--p graf-after--h3">In functional programming when we run functions recursively over lists we like to model the list as a <strong class="markup--strong markup--p-strong">head</strong> and a <strong class="markup--strong markup--p-strong">tail</strong>.</p><p name="0af1" id="0af1" class="graf graf--p graf-after--p">The head is the first element of the list, the tail is the list composed of the list minus the head.</p><pre name="b921" id="b921" class="graf graf--pre graf-after--p">arr = [ 1, 2, 3 ]<br>// head(arr): 1<br>// tail(arr): [ 2, 3 ]</pre><p name="61c7" id="61c7" class="graf graf--p graf-after--pre">In ES6 we can do this just by naming the variable appropriately with <strong class="markup--strong markup--p-strong">destructuring</strong> and <strong class="markup--strong markup--p-strong">rest:</strong></p><pre name="2706" id="2706" class="graf graf--pre graf-after--p">var [ head, ...tail ] = [ 1, 2, 3 ];<br>// head: 1<br>// tail: [ 2, 3 ]</pre><p name="9fd8" id="9fd8" class="graf graf--p graf-after--pre">We can also trivially implement the <code class="markup--code markup--p-code">head</code> and <code class="markup--code markup--p-code">tail</code> functions using ES6:</p><pre name="f0cb" id="f0cb" class="graf graf--pre graf-after--p">function head([ head, ...tail ]) { <br>  return head;<br>}<br>function tail([ head, ...tail ]) {<br>  return tail;<br>}<br>// or with arrow function syntax<br>var head = ([ head, ...tail ]) =&gt; head;<br>var tail = ([ head, ...tail ]) =&gt; tail;</pre><h4 name="aeb2" id="aeb2" class="graf graf--h4 graf-after--pre">(Tail) Recursion</h4><p name="0b05" id="0b05" class="graf graf--p graf-after--h4">We can implement functions that operate over arrays (or lists as they tend to be called in functional programming) using <strong class="markup--strong markup--p-strong">parameter destructuring</strong><em class="markup--em markup--p-em"> </em>and <strong class="markup--strong markup--p-strong">recursion</strong>.</p><p name="f729" id="f729" class="graf graf--p graf-after--p">For example, map can be implemented in the following manner:</p><p name="2ece" id="2ece" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Map is a function that takes a list and a function and returns a list containing the result of a function application to each element of the list.</em></p><pre name="2c51" id="2c51" class="graf graf--pre graf-after--p">function map([ head, ...tail ], fn) {<br>  if(head === undefined &amp;&amp; !tail.length) return [];<br>  if(tail.length === 0){<br>    return [ fn(head) ];<br>  }<br>  return [ fn(head) ].concat(map(tail, fn));<br>}</pre><p name="17f2" id="17f2" class="graf graf--p graf-after--pre">The <code class="markup--code markup--p-code">tail.length === 0</code> checks whether there is still a tail to recurse over. Otherwise, the recursion stops there.</p><p name="352e" id="352e" class="graf graf--p graf-after--p">This is not necessarily the most efficient version of map both in terms of memory usage and speed but it's a good illustration of ES6.</p><p name="e78a" id="e78a" class="graf graf--p graf-after--p">We can further simplify it by replacing <code class="markup--code markup--p-code">concat</code> with the <code class="markup--code markup--p-code">spread</code> operator and using a single return statement with a ternary operator.</p><h4 name="aabc" id="aabc" class="graf graf--h4 graf-after--p">Very ES6&nbsp;map</h4><p name="3e49" id="3e49" class="graf graf--p graf-after--h4">Our ES6 recursive/destructuring map can be simplified to:</p><pre>function map([ head, ...tail ], fn) {
  if (head === undefined &amp;&amp; !tail.length) return [];
  return tail.length ? [ fn(head), ...(map(tail, fn)) ] : [ fn(head) ];
}</pre><p name="eed7" id="eed7" class="graf graf--p graf-after--figure">Or if we want to abuse ES6 and allow ourselves to forget that we're actually doing JavaScript:</p><pre>var map = ([ head, ... tail ], fn) =&gt; 
  ( (head !== undefined &amp;&amp; tail.length) ? ( tail.length ? [ fn(head), ...(map(tail, fn)) ] : [ fn(head) ] ) : []);</pre><p name="8ddc" id="8ddc" class="graf graf--p graf-after--figure">ES5 equivalent</p><pre>function map(arr, fn) {
  var head = arr[0];
  var tail = arr.slice(1);
  if(head === undefined &amp;&amp; tail.length === 0) return [];
  if(tail.length === 0) {
    return [ fn(head) ];
  }
  return [].concat(fn(head), map(tail, fn));
}</pre><p name="a16a" id="a16a" class="graf graf--p graf-after--figure">All the features add up and while recursive map in ES6 is essentially a one-liner, in ES5 it's a clunky, long, hard to read function.</p><h4 name="f41f" id="f41f" class="graf graf--h4 graf-after--p">Reimplementing list manipulation functions</h4><p name="8276" id="8276" class="graf graf--p graf-after--h4">Now you can have a go at reimplementing <code class="markup--code markup--p-code">filter</code>, <code class="markup--code markup--p-code">reduce</code> and <code class="markup--code markup--p-code">join</code> using the above techniques.</p><p name="724c" id="724c" class="graf graf--p graf-after--p">Solutions below the fold&nbsp;:).</p><p name="c5e7" id="c5e7" class="graf graf--p graf-after--p">ES6 allows us to write code in a functional style more tersely and effectively.</p><p name="a1f5" id="a1f5" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Give some 💚 to this post if you liked it and to </em><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">follow</em></strong><em class="markup--em markup--p-em"> for more JavaScript-related things.</em></p><p name="7f8d" id="7f8d" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">You can find me on Twitter</em><a href="https://twitter.com/hugo__df" data-href="https://twitter.com/hugo__df" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">(at)hugo__df</em></a><em class="markup--em markup--p-em">, on GitHub as </em><a href="https://github.com/HugoDF" data-href="https://github.com/HugoDF" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">HugoDF</em></a><em class="markup--em markup--p-em">, there are more JavaScript gists </em><a href="https://gist.github.com/HugoDF" data-href="https://gist.github.com/HugoDF" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">here</em></a><em class="markup--em markup--p-em">.</em></p><h4 name="6054" id="6054" class="graf graf--h4 graf-after--p">Recursive list operations in ES6 with rest/spread and destructuring</h4><pre>function filter([ head, ...tail ], fn) {
  const newHead = fn(head) ? [ head ] : [];
  return tail.length ? [ ...newHead, ...(filter(tail, fn)) ] : newHead;
}</pre><pre>function reduce([ head, ...tail ], fn, initial) {
  if(head === undefined &amp;&amp; tail.length === 0) return initial;
  if(!initial) {
    const [ newHead, ...newTail] = tail;
    return reduce(newTail, fn, fn(head, newHead));
  }
  return tail.length ? reduce(tail, fn, fn(initial, head)) : [ fn(initial, head) ];
}</pre><pre>function join([ head, ...tail ], separator = ',') {
  if (head === undefined &amp;&amp; !tail.length) return '';
  return tail.length ? head + separator + join(tail, separator) : head;
}</pre></div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-56" name="t-56"></a><h1>56 : A Gentle Introduction to Composition in JavaScript</h1>
					<div class="tutorial__content">
<article class="post__content">
  <h5 id="why-functional-programming">Why Functional Programming?</h5>

<p>I've been shifting my programmer's mindset to use more <strong>Functional Programming</strong> in JavaScript, initially as a way to exercise my brain and to revamp my way of writing code. As it happens, ES2015 gives us a nice tool belt to work with in a functional manner, so there's really no excuse not to make use of it. What initially started as plain exercises quickly became my default way of thinking in terms of handling data now.</p>

<p>But there's a lot to functional programming in JavaScript, more than simply working with methods like <code class="highlighter-rouge">map</code> and <code class="highlighter-rouge">reduce</code> and all of the new ones ES2015 is introducing. It's not only "avoiding loops", and it can still get quite verbose when we look at things like currying, for example, so let's start simple.</p>

<p>This is my attempt at starting from scratch teaching the basics of FP in JavaScript. I thought I'd start from the very basics: making use of a functional mindset and using the basics of composition to perform some simple object queries and manipulations.</p>

<p>If you want to play directly with the source code, <a href="http://jsbin.com/dupeme/edit?js,console">you can find it on JSBin</a>.</p>

<h3 id="working-with-data">Working with Data</h3>

<p>There's mainly one required concept to know about, before jumping into a more functional mindset. It's important to remember what <strong>pure functions</strong> are and always keep their concept in mind when manipulating data. So what is a pure function?</p>

<p>From this <a href="http://www.sitepoint.com/functional-programming-pure-functions/">Sitepoint article</a>, we get a nice definition for a pure function:</p>

<blockquote>
  <p>A pure function is a function where the return value is only determined by its input values, without observable side effects. This is how functions in math work: Math.cos(x) will, for the same value of x , always return the same result.</p>
</blockquote>

<p>Nicolas Carlo wrote a <a href="http://www.nicoespeon.com/en/2015/01/pure-functions-javascript/">fantastic article</a> about pure functions in JavaScript that you should definitely have a look at if you want to know more about them.</p>

<h4 id="getting-practical">Getting Practical</h4>

<p>Let's say we have an object which contains some monthly expenses. They have a name, a price and their category. We'd later like to query this object for data analysis.</p>

<pre><code>const expenses = [
  {
    name: 'Rent',
    price: 500,
    type: 'Household'
  }, {
    name: 'Netflix',
    price: 5.99,
    type: 'Services'
  }, {
    name: 'Gym',
    price: 15,
    type: 'Health'
  }, {
    name: 'Bills',
    price: 100,
    type: 'Household'
  }
];</code></pre>

<h3 id="exercise-one-sum-up-all-the-expenses">Exercise one: Sum up all the expenses</h3>

<p>If you were told to sum all of the expenses in this object, how would you go about and do it? In traditional JS fashion, we would write a simple loop:</p>

<pre><code>var total = 0;

for (var i = 0; i &lt; expenses.length; i++) {
  total += expenses[i].price;
}

console.log(total); // 620.99</code></pre>

<p>Great, it works. But it's not exactly… functional. Firstly, it's <strong>dependent on an external variable</strong>: <code class="highlighter-rouge">total</code>. This variable might be overwritten somewhere else in the code, and it's impossible to keep track of its state. Plus, if we need to calculate the sum of all the expenses again for any other incoming data, we'll need to write another loop, since the original Array is hardcoded inside it.</p>

<p>So zero points for reusability, predictability and encapsulation for this method.</p>

<p>We could turn this into its own function, and make it a pure one. Pure functions depend on their inputs alone, and their output should be the exact same for the same input, but it would still lack the functional approach to it.</p>

<h4 id="a-more-functional-way">A more functional way</h4>

<p>Let's make use of <code class="highlighter-rouge">map</code> and <code class="highlighter-rouge">reduce</code> to create a generic function that calculates the total costs. Keep in mind that we would like to reuse this method with possible other objects; so in order to keep function purity in check, it will accept an argument (here defined as <code class="highlighter-rouge">arr</code>) to work on.</p>

<pre><code>const sumAll = (arr) =&gt; arr
  .map((item) =&gt; item.price)
  .reduce((acc, price) =&gt; acc + price, 0);</code></pre>

<h4 id="whats-happening-here">What's happening here?</h4>

<p><strong>Break it down!</strong></p>

<p>We're creating a method that accepts an Array <code class="highlighter-rouge">arr</code>. For this Array, we'll <code class="highlighter-rouge">map</code> over every element (as <code class="highlighter-rouge">item</code>) and <em>only return</em> its price property. For this <code class="highlighter-rouge">price</code> property, we then use the <code class="highlighter-rouge">reduce</code> method to continuously increment <code class="highlighter-rouge">acc</code> (the accumulator, with an initial value of zero) with the price returned.</p>

<p>And we use it like so:</p>

<pre><code>let total = sumAll(expenses); // 620.99</code></pre>

<p>Now this is much better. If there were more Expenses objects, we could simply throw them at this function, like bottles on a wall. Notice that there are no side effects here; no dependencies on external state either. <code class="highlighter-rouge">sumAll</code> takes one argument and acts upon it, purity is preserved.</p>

<h3 id="composing-things">Composing things</h3>

<p>So we want to be able to do some data analysis. How much am I spending on the 'Household' category, for example? It would be nice to easily retrieve all items in this category and quickly sum them up.</p>

<p>Given what we've learned already, let's do this without resorting to loops and creating side effects. For now, let's explicitly create a function that gives us all household expenses:</p>

<pre><code>var getHousehold = (src) =&gt; {
  return src.filter((item) =&gt; {
    return item.type === 'Household';
  });
};</code></pre>

<p>Written in (semi) ES5 for a better understanding: here, we're accepting our expenses as <code class="highlighter-rouge">src</code> and using <code class="highlighter-rouge">filter</code>, which takes a function, to let through only the items that match the type as being <code class="highlighter-rouge">Household</code>.</p>

<p>But because we like ES2015 so much, let's write the exact same function in a more compact flavour:</p>

<pre><code>const getHousehold = (src) =&gt;
	src.filter((item) =&gt; item.type === 'Household');</code></pre>

<p>So, calling this method on our expenses:</p>

<pre><code>getHousehold(expenses); // object with only items with the type of 'Household'</code></pre>

<p>Great! We're getting somewhere.</p>

<h4 id="functional--functional">Functional + Functional</h4>

<p>Now that we have a method to grab all household expenses and another one that sums all prices of a given source, we can easily pair these two together. If we wanted to log out the sum of household expenses, we could simply now use;</p>

<pre><code>let householdExpenses = sumAll(getHousehold(expenses)); // 600</code></pre>

<p>This is great already! <code class="highlighter-rouge">sumAll</code> is receiving a filtered down version of the original expenses, provided by calling <code class="highlighter-rouge">getHousehold</code> on the expenses Array.</p>

<p>But we can do better with <strong>composition</strong>.</p>

<h3 id="composition-you-say">Composition, you say?</h3>

<p>Composition, according to Wikipedia:</p>

<blockquote>
  <p>object composition (not to be confused with function composition) is a way to combine simple objects or data types into more complex ones.</p>
</blockquote>

<p>In this case, we want to combine two methods to form a composite  that we can refer to directly. But let's examine what's happening under the hood ourselves, first.</p>

<p>Here's an example of composition:</p>

<pre><code>var angryAndMad = compose(getMad, getAngry);
var johnIsAngryAndMad = angryAndMad('John');
var aliceIsAngryAndMad = angryAndMad('Alice');</code></pre>

<p>With composition, we're thinking in definitions. Breaking everything down to atoms. We define our concept of <code class="highlighter-rouge">angryAndMad</code>, which is <strong>composed</strong> of a combination of <code class="highlighter-rouge">getMad</code> and <code class="highlighter-rouge">getAngry</code>. Then, we apply the concept to two entities, and unfortunately John and Alice are our chosen victims here. We're <strong>applying</strong> John and Alice to the composer of angry and mad.</p>

<p><em>Back to our expenses application.</em></p>

<p>Noticed that <code class="highlighter-rouge">compose</code> method written? Let's assume that magical method for now, and use it to compose ourselves a method that does two things: gets our household expenses and sums up all of them.</p>

<p>Something in the means of:</p>

<pre><code>const sumOfHousehold = compose(getHousehold, sumAll);</code></pre>

<p>And then applying our <code class="highlighter-rouge">expenses</code> source to it, like so;</p>

<pre><code>let householdPrices = sumOfHousehold(expenses);</code></pre>

<p>Notice that if any particular stage we had more sources of data to work with, we would be on the clear. <code class="highlighter-rouge">sumOfHousehold</code> is not dependent on anything external, apart from the internal methods that it combines; we could easily apply it to a potential <code class="highlighter-rouge">expenses2</code> and <code class="highlighter-rouge">expenses3</code> Arrays if this kind of complexity raised.</p>

<h3 id="how-does-compose-work">How does compose work?</h3>

<p>In this case, the <code class="highlighter-rouge">compose</code> method accepts two arguments, both functions, and returns another function. This new function will return another function that contains the result of both arguments applied. Sounds confusing? Let's look at a possible implementation of it, first in ES5 form:</p>

<pre><code>var compose = function(f, g) {
  return function(x) {
    return g(f(x));
  }
};</code></pre>

<p>It returns the value of g applied on f, as a function. In ES2015 form, it looks much more concise:</p>

<pre><code>const _compose = (f,g) =&gt; (x) =&gt; g(f(x));</code></pre>

<p>If you're having trouble understanding what compose is actually doing, try and log out our composite function without calling it with arguments:</p>

<pre><code>const sumOfHousehold = compose(getHousehold, sumAll);
console.log(sumHouseholdExpenses);</code></pre>

<p>It returns:</p>

<pre><code>function (x) {
  return g(f(x));
}</code></pre>

<p>And of course it does! That <code class="highlighter-rouge">x</code> argument is what's ready to receive our <code class="highlighter-rouge">expenses</code> source, or any other source for that matter. <code class="highlighter-rouge">g</code> and <code class="highlighter-rouge">f</code> are internally stored ready to act upon this argument.</p>

<h3 id="another-example">Another example</h3>

<p>At this point, our code isn't very useful. Let's keep writing a couple more methods to allow us to work with the data we have. For our purposes, we want to grab a list of all possible categories in our list of expenses. Using traditional functional programming in JavaScript, this is easy:</p>

<pre><code>const getCategories = (arr) =&gt; arr
  .map((item) =&gt; item.type);</code></pre>

<p>Grab our source, and for each one return their type.
This gives us:</p>

<pre><code>["Household", "Services", "Health", "Household"]</code></pre>

<p>Ops. It works, but we're getting "Household" twice, because there are two household expenses. We want to filter duplicates out. Let's write a (very naive) function that does this!</p>

<pre><code>const uniqueElements = (arr) =&gt; arr.filter((item, pos) =&gt; arr.indexOf(item) == pos);</code></pre>

<p>So now we can easily compose a function that displays all of our unique categories:</p>

<pre><code>const uniqueCategories = compose(getCategories, uniqueElements);
uniqueCategories(expenses); // ["Household", "Services", "Health"]</code></pre>

<p>It works! And just like this, we're now slowly building a solid base with a lot of helper methods, all with a decent level of abstraction (although not point-free, that's a topic for another post) and without any side-effects to their sources.</p>

<h3 id="where-to-go-next">Where to go next?</h3>

<p>Be on the lookout for the next series on Functional Programming, and in the meantime feel free to check out the following great resources, which I found to be the most useful so far:</p>

<ul>
  <li><a href="http://reactivex.io/learnrx/">Learning FP using Rx</a></li>
  <li><a href="https://medium.com/@chetcorcos/functional-programming-for-javascript-people-1915d8775504#.e2zqfd8df">FP for JavaScript People</a></li>
  <li><a href="https://medium.com/javascript-scene/the-two-pillars-of-javascript-pt-2-functional-programming-a63aa53a41a4#.kedjszosc">The 2 Pillars of JS: Functional Programming</a></li>
</ul>

<p>Once again, you can find the source code for this tutorial <a href="http://jsbin.com/dupeme/edit?js,console">on JSBin</a></p>

<p>That's it for this lesson, I hope you've enjoyed it,
and be on the lookout for part two. If you spot any typos or have any suggestions, don't be afraid to ping me on <a href="http://twitter.com/magalhini">Twitter</a>.</p>

</article>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-57" name="t-57"></a><h1>57 : Enhancing Mixins with Decorator Functions</h1>
					<div class="tutorial__content">
					<span>http://justinfagnani.com/2016/01/07/enhancing-mixins-with-decorator-functions/
 <p>Last time, in <a href="http://justinfagnani.com/2015/12/21/real-mixins-with-javascript-classes/">"Real" Mixins with JavaScript Classes</a>, we saw how we can create powerful ES6 mixins by using class expressions as subclass factories.</p>

<p>Now, let's look at some enhancements that make our mixins more powerful, in a way still requires no framework for mixin users, and is still easy to use for mixin authors.</p>

<p>First, we'll look at how subclass-factory-style mixins can be wrapped, or decorated, to add aditional features. Then we'll enable the caching of mixin applications, so that the same mixin definition applied to the same superclass multiple times reuses the same mixin application, and implement ES2015's <code>@@hasInstance</code><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> method so that <code>instanceof</code> works with mixins!</p>

<h2 id="thetechniqueandsomegroundwork">The Technique and Some Groundwork</h2>

<p>We're going to add these enhancements at the mixin definition site, so that only the mixin author needs to do anything to get them.</p>

<p>Recall a mixin definition from the last post:</p>

<pre><code class="language-javascript">const MyMixin = (superclass) =&gt; class extends superclass {  
  /* ... */
};
</code></pre>

<p>Our new enhancements are built as functions that wrap the mixin function. Mixin declaration will now look like this:</p>

<pre><code class="language-javascript">const MyMixin = BaseMixin((superclass) =&gt; class extends superclass {  
  /* ... */
});
</code></pre>

<p><code>BaseMixin</code> wraps the author's subclass factory in a function that does a little extra work before calling the factory. This is very much like <a href="https://github.com/wycats/javascript-decorators">ES.next decorators</a>, just without the special <code>@BaseMixin</code> syntax, so I'll call them decorator functions.</p>

<p>All kinds of behaviors can be added to mixins by adding more wrappers. Since we're going to implement caching and <code>@@hasInstance</code> support, our mixin definitions might end up looking like this:</p>

<pre><code class="language-javascript">const MyMixin = Cached(HasInstance(BaseMixin((superclass) =&gt; class extends superclass {  
  /* ... */
})));
</code></pre>

<p>This should be fairly easy for authors to use, and mixin users don't need to do anything different. Mixin application still just works as function invocation:</p>

<pre><code class="language-javascript">class A extends MyMixin(MyBaseClass) {}

class B extends MyMixin(MyBaseClass) {}  
</code></pre>

<p>Or we can use <code>mix().with()</code>:</p>

<pre><code class="language-javascript">class A extends mix(MyBaseClass).with(MyMixin) {}

class B extends mix(MyBaseClass).with(MyMixin) {}  
</code></pre>

<p><code>mix().with()</code> is still just plain and optional sugar around function invocation.</p>

<p>If we implement <code>Cached</code> and <code>HasInstance</code> correctly, the mixins and classes suddenly have new powers:</p>

<pre><code class="language-javascript">let a = new A();  
let b = new B();

a instanceof A; // true  
b instanceof B; // true  
Object.getPrototypeOf(a) === Object.prototypeOf(b); // true  
</code></pre>

<p>We can use standard function composition to create a convenience decorator for the common behaviors:</p>

<pre><code class="language-javascript">const Mixin = (mixin) =&gt; Cached(HasInstance(BaseMixin(mixin)));

const MyMixin = Mixin((superclass) =&gt; class extends superclass {  
  /* ... */
});
</code></pre>

<h3 id="wrappingwithcare">Wrapping with Care</h3>

<p>We have to be a little more careful with wrapping mixin functions than usual because we want the final result of calling the decorators to be an object with certain properties, like <code>@@hasInstance</code>. We don't know what decorators might be applied to our mixin, and we'd like to avoid requiring a specific ordering of decorators, so we don't want to obscure properties added by one wrapper with a subsequent wrapper.</p>

<p>To solve this we'll create a <code>wrap</code> utility that sets the prototype of the wrappers, and stores a property pointing to the original mixin function so that we have a canonical identity for a mixin:</p>

<pre><code class="language-javascript">const _originalMixin = Symbol('_originalMixin');

const wrap = (mixin, wrapper) =&gt; {  
  Object.setPrototypeOf(wrapper, mixin);
  if (!mixin[_originalMixin]) {
    mixin[_originalMixin] = mixin;
  }
  return wrapper;
};
</code></pre>

<p>This makes our function wrapping behave a lot more like inheritance.</p>

<p>Next, we'll create a base mixin decorator that applies the mixin and stores a reference from the mixin application back to the mixin definition for later use in caching:</p>

<pre><code class="language-javascript">const BaseMixin = (mixin) =&gt; wrap(mixin, (superclass) =&gt; {  
  let application = mixin(superclass);
  application.prototype[_mixinRef] = mixin[_originalMixin];
  return application;
});
</code></pre>

<p>Notice the call to <code>wrap</code>. This sets things up so that other mixin decorators can add properties to the mixin and have them be visible after wrapping.</p>

<h2 id="cachingmixinapplications">Caching Mixin Applications</h2>

<p>The whole purpose of mixins is to apply them to different superclasses so that using a mixin doesn't require a specific inheritance hierarchy. However, mixins may still be repeatedly applied to the same superclass.</p>

<p>Consider two classes, <em>B</em> and <em>C</em> which both extend <em>A</em> and mixin <em>M1</em> and <em>M2</em>:</p>

<pre><code class="language-javascript">class B extends mix(A).with(M1, M2) {}

class C extends mix(A).with(M1, M2) {}  
</code></pre>

<p>The simplest mixin implementation will produce two identical <em>A-with-M1</em> and two identical <em>A-with-M1-with-M2</em> prototypes.</p>


<p>Instead we would like to share identical applications:</p>

<p><img src="http://justinfagnani.com/content/images/2015/06/class-hierarchy-5.svg" alt=""></p>

<p>We can do this by caching mixin applications on classes:</p>

<pre><code class="language-javascript">const _mixinRef = Symbol('_mixinRef');

const Cached = (mixin) =&gt; wrap(mixin, (superclass) =&gt; {  
  // Create a symbol used to reference a cached application from a superclass
  let applicationRef = mixin[_cachedApplicationRef];
  if (!applicationRef) {
    applicationRef = mixin[_cachedApplicationRef] = Symbol(mixin.name);
  }

  // Look up an cached application of `mixin` to `superclass`
  if (superclass.hasOwnProperty(applicationRef)) {
    return superclass[applicationRef];
  }

  // Apply the mixin
  let application = mixin(superclass);

  // Cache the mixin application on the superclass
  superclass[applicationRef] = application;

  return application;
});
</code></pre>

<p>Hopefully the comments are easy to follow. The approach is to create a unique symbol per mixin, then store mixin applications in a property keyed by that symbol on the superclass of a mixin application. That allows us to look up and reuse previous applications of a mixin to a superclass.</p>

<p>If this seems like overkill, consider cases where you must extend a certain class, yet libraries would like to offer help in customizing those subclasses.</p>

<p>I'm thinking of custom elements here, and specifically, libraries like Polymer. Custom elements need to extend one of the built-in elements - at the very least <em>HTMLElement</em> - but Polymer does a lot of work by being on the prototype chain. Mixins make this easy to express:</p>

<pre><code class="language-javascript">class MyElement extends mix(HTMLElement).with(Polymer) {  
  // ...
}
</code></pre>

<p>But with naive mixins a new identical superclass of <em>HTMLElement-With-Polymer</em> is created for every custom element class, wasting time and memory. With mixin application caching this can be easy <em>and</em> efficient.</p>

<h2 id="addinginstanceofsupport">Adding instanceof Support</h2>

<p>ES2015 has support for <a href="http://people.mozilla.org/~jorendorff/es6-draft.html#sec-instanceofoperator">overriding the <code>instanceof</code> operator</a> via the <code>@@hasInstance</code> method, which should be implemented by objects that appear of the <em>righthand</em> side of an <code>instanceof</code> operator<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.</p>

<p>Ideally an expression like <code>o instanceof MyMixin</code> would work as expected: if <code>o</code> is an instance of a class that has mixed in <code>MyMixin</code>, the expression should return true.</p>

<p>With mixins, the "type" is one of our subclass factory functions, so we need to patch the <code>@@hasInstance</code> method into the mixin. The prototype setting we did in the groundwork section will ensure that this method is available even after subsequent wrapping.</p>

<p>Out patch looks like this:</p>

<pre><code class="language-javascript">const HasInstance = (mixin) =&gt; {  
  if (!Symbol.hasInstance) {
    return mixin;
  }
  mixin[Symbol.hasInstance] = function(o) {
    const originalMixin = this[_originalMixin];
    while (o != null) {
      if (o.hasOwnProperty(_mixinRef) &amp;&amp; o[_mixinRef] === originalMixin) {
        return true;
      }
      o = Object.getPrototypeOf(o);
    }
    return false;
  }
  return mixin;
};
</code></pre>

<p>I can't find that this is actually implemented in any production VM yet, but it looks like Webkit has initial support, along with Babel under a flag.</p>

<h2 id="writingyourownmixindecorators">Writing Your Own Mixin Decorators</h2>

<p><a href="https://github.com/justinfagnani/mixwith.js">mixwith.js</a> includes the <code>wrap</code> utility and some common symbols that help with writing mixin decorators. You can use these to write decorators that play well with each other. What kind of decorators might you want to write? Maybe a de-duplication, so that a mixin applied twice to a prototype chain only appears once in the chain, or a traits-like system that disallows overriding.</p>

<p>There are probably two main types of mixin decorators: those that need to wrap the mixin function, and those that just need to patch it.</p>

<p>If you need to wrap the mixin function, make sure you call <code>wrap</code> and usually you want to invoke the mixin function. Sometimes you may want to conditionally invoke the mixin, like with de-duplication:</p>

<pre><code class="language-javascript">import { wrap } from 'mixwith';

const DeDupe = (mixin) =&gt; wrap(mixin, (superclass) =&gt; {  
  if (mixinAlreadyApplied(superclass)) {
    return superclass;
  }
  return mixin(superclass);
});
</code></pre>

<p>If you only need to patch the mixin function, just patch and return it:</p>

<pre><code class="language-javascript">const Fooify = (mixin) =&gt; {  
  mixin.foo = "Foo";
  return mixin;
};
</code></pre>

<h2 id="followtheconversation">Follow the conversation</h2>

<ul>
<li><a href="https://www.reddit.com/r/javascript/comments/3zw60e/enhancing_subclassfactorystyle_javascript_mixins/">reddit.com/r/javascript</a></li>
</ul>

<h3 id="footnotes">Footnotes</h3>

<div class="footnotes"><ol><li class="footnote" id="fn:1"><p>@@foo is shorthand for Symbol.foo in the <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-well-known-symbols">JavaScript specification</a> <a href="#fnref:1" title="return to article">↩</a></p></li>

<li class="footnote" id="fn:2"><p>This is fabulous for extensibility, since new types can accept an instance without having to modify the instance. You can implement any kind of type checking you want, say structural typing. It's terrible for static type checking, however. <a href="#fnref:2" title="return to article">↩</a></p></li></ol></div>
					</span></div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-58" name="t-58"></a><h1>58 : Currying - the Underrated Concept in Javascript</h1>
					<div class="tutorial__content">
						<div class="section-inner sectionLayout--insetColumn"><h1 name="af3a" id="af3a" class="graf graf--h3 graf--leading graf--title">Currying - the Underrated Concept in Javascript</h1><p name="c051" id="c051" class="graf graf--p graf-after--h3">This is the first article of a series on functional programming in dynamically typed languages such as Javascript. This series will explore various aspects of the functional paradigm, its concepts and underlying mechanisms.</p><h3 name="94a9" id="94a9" class="graf graf--h3 graf-after--p">Definition and distinction of partial application</h3><p name="8679" id="8679" class="graf graf--p graf-after--h3">Currying is a technique related to declaration of functions. In its original mathematical sense it is the transformation of a function with <strong class="markup--strong markup--p-strong">n</strong> parameters into a sequence of <strong class="markup--strong markup--p-strong">n</strong> functions, which each return an unary, anonymous function. More precisely, the arity is transformed from <strong class="markup--strong markup--p-strong">n-ary</strong> to <strong class="markup--strong markup--p-strong">n * 1-ary</strong>. Why exactly one argument? Because the benefits of <strong class="markup--strong markup--p-strong">n-ary</strong> functions bear no relation to their greater complexity.</p><pre name="0c65" id="0c65" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">// declaration of a manually curried function<br><br>const add = x =&gt; y =&gt; x + y;<br><br><br>// and its procedural application<br><br>const inc = add(1);<br><br>inc(2); // 3<br>add(1) (2); // 3</code></pre><p name="c3df" id="c3df" class="graf graf--p graf-after--pre">Currying is right-associative, that is, <strong class="markup--strong markup--p-strong">add = x =&gt; y =&gt; x + y</strong> is equivalent with <strong class="markup--strong markup--p-strong">add = x =&gt; (y =&gt; x + y)</strong>. Since each anonymous function is only evaluated once the required argument is provided, currying introduces a notion of laziness to function application.</p><p name="55ec" id="55ec" class="graf graf--p graf-after--p">Partial application on the other hand deals with the application of functions, not with their declaration. In contrast to multi-argument functions a curried function is invoked procedurally in a uniform manner. Actually, unary functions can not be partially applied anymore. However, if you consider the sequence of anonymous functions as a single one, it somehow makes sense to think about a partially applied function in curried form. I guess that is the reason why both concepts are constantly mixed up.</p><h3 name="f8e0" id="f8e0" class="graf graf--h3 graf-after--p">What is the purpose of currying?</h3><p name="6a28" id="6a28" class="graf graf--p graf-after--h3">It's difficult to illustrate the benefits of currying, because the technique has essentially a <strong class="markup--strong markup--p-strong">systemic effect</strong>. Systemic means that a technique needs to interact with other basic techniques to fully develop its advantages. There is a mutual dependency between the components involved.</p><p name="af33" id="af33" class="graf graf--p graf-after--p">Currying is closely connected to higher order functions, which derive from first class functions. Higher order functions are such a fundamental concept in functional programming that they are literally omnipresent. The composition operator function, for example, is a well known one. Currying makes working with higher order functions much more effective, provided the involved functions respect a particular parameter order, optimized for&nbsp;…well, currying. More on that later.</p><p name="43aa" id="43aa" class="graf graf--p graf-after--p">The most significant advantage of currying along with higher order functions is <strong class="markup--strong markup--p-strong">abstraction over arity</strong>. Whenever a higher order function both receives and returns a function, some (but not all) of the passed functions can be of any arity. They lose their arity so to speak:</p><pre name="7166" id="7166" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">// evaluated from right to left</code></pre><pre name="8517" id="8517" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">const comp = f =&gt; g =&gt; x =&gt; f(g(x));<br><br>const inc = x =&gt; x + 1; // unary function<br>const mul = y =&gt; x =&gt; x * y; // binary function<br>const sqr = x =&gt; mul(x) (x); // unary function<br><br><br>// abstraction over arity<br><br>comp(sqr) (inc) (2); // 9 (A)<br>comp(mul) (inc) (2) (3); // 9 (B)<br>comp(inc) (mul) (2) (3); // TypeError (C)</code></pre><p name="12cb" id="12cb" class="graf graf--p graf-after--pre">It is not surprising that (A) works as expected, since <strong class="markup--strong markup--p-strong">sqr</strong> and <strong class="markup--strong markup--p-strong">inc</strong> have the right arity. We also expect (C) to fail, because the arity of <strong class="markup--strong markup--p-strong">inc</strong> and <strong class="markup--strong markup--p-strong">mul</strong> doesn't match. But why does (B) produce a conclusive result, even though <strong class="markup--strong markup--p-strong">mul</strong> apparently is a binary function? This is abstraction over arity in action: <strong class="markup--strong markup--p-strong">comp</strong> does not care about <strong class="markup--strong markup--p-strong">f</strong>'s arity. Te reason for this behavior is <strong class="markup--strong markup--p-strong">comp</strong>'s type:</p><pre name="5491" id="5491" class="graf graf--pre graf-after--p">comp :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c      )<br>         f       =&gt;  g       =&gt; (x =&gt; f(g(x)));<br><br></pre><pre name="9d89" id="9d89" class="graf graf--pre graf-after--pre">comp :: (b -&gt; c -&gt; d) -&gt; (a -&gt; b) -&gt; (a -&gt; d           )<br>         f            =&gt;  g       =&gt; (x =&gt; y =&gt; f(g(x)));</pre><p name="c58a" id="c58a" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">comp</strong> returns the anonymous function that is itself returned by <strong class="markup--strong markup--p-strong">f</strong>. The arity of this anonymous function just does not matter.</p><h4 name="2aee" id="2aee" class="graf graf--h4 graf-after--p">Conclusion</h4><p name="0f44" id="0f44" class="graf graf--p graf-after--h4">To understand the advantages of currying the concept can not be considered on its own. It facilitates function composition and establishes a unified and predictable interface, which abstracts function arity away.</p><h3 name="f479" id="f479" class="graf graf--h3 graf-after--p">Implementation in Javascript/Ecmascript 2015</h3><p name="dcfe" id="dcfe" class="graf graf--p graf-after--h3">Javascript doesn't have pre-curried functions. However, the new arrow syntax of EcmaScript 2015 allows us to write manually curried functions with little syntactic overhead:</p><pre name="c6d6" id="c6d6" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">// classic, nested syntax<br><br>function map(f) {<br>  return function (xs) {<br>    function next(acc, [head, ...tail]) {<br>      return head === undefined<br>       ? acc<br>       : next([...acc, f(head)], tail);<br>    }<br><br>    return next([], xs);<br>  }<br>}<br><br><br>// ES2015 arrow syntax<br><br>const map = f =&gt; xs =&gt; {<br>  const next = (acc, [head, ...tail]) =&gt; head === undefined<br>   ? acc<br>   : next([...acc, f(head)], tail);<br>   <br>  return next([], xs);<br>};</code></pre><p name="cb01" id="cb01" class="graf graf--p graf-after--pre">However, for all functions that are out of our control, we need a programmatic curry solution:</p><pre name="83e5" id="83e5" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const curryn = n =&gt; f =&gt; {<br>  const next = (n, args) =&gt; n === 0<br>   ? f(...args)<br>   : x =&gt; next(n - 1, [...args, x]);<br>  <br>  return next(n, []);<br>};<br><br><br>const add = (x, y) =&gt; x + y;<br>const addc = curryn(2) (add);<br>const inc = addc(1);<br><br><br>addc(2) (3); // 5<br>inc(3); // 4<br><br><br>const map = (f, xs) =&gt; xs.map(x =&gt; f(x));<br>const mul = y =&gt; x =&gt; x * y;<br>const sqr = x =&gt; mul(x) (x);<br>const mapc = curryn(2) (map);</code></pre><pre name="b0e1" id="b0e1" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><br>const xs = [1, 2, 3];<br><br><br>mapc(sqr) (xs); // [1, 4, 9]</code></pre><p name="897a" id="897a" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">curryn</strong> is just a wrapper to hide the accumulator <strong class="markup--strong markup--p-strong">args</strong>, which is part of the internal API. The actual curry mechanism is implemented within <strong class="markup--strong markup--p-strong">next</strong>, a recursive function that lazily collects <strong class="markup--strong markup--p-strong">n</strong> arguments.</p><p name="a62a" id="a62a" class="graf graf--p graf-after--p">Please note that there is not the one right solution. Alternative, non-recursive approaches might look like this:</p><pre name="c33c" id="c33c" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">curryn = n =&gt; f =&gt;<br> a =&gt; n &lt; 2 ? f(a) :<br>  b =&gt; n &lt; 3 ? f(a, b) :<br>   c =&gt; n &lt; 4 ? f(a, b, c) :<br>    d =&gt; n &lt; 5 ? f(a, b, c, d) :<br>     e =&gt; n &lt; 6 ? f(a, b, c, d, e) :<br>      (() =&gt; {throw "unsupported arity"})();<br><br><br>curry2 =&gt; f =&gt; a =&gt; b =&gt; f(a, b);<br>curry3 =&gt; f =&gt; a =&gt; b =&gt; c =&gt; f(a, b, c);<br>curry4 =&gt; f =&gt; a =&gt; b =&gt; c =&gt; d =&gt; f(a, b, c, d);<br>curry5 =&gt; f =&gt; a =&gt; b =&gt; c =&gt; d =&gt; e =&gt; f(a, b, c, d, e);</code></pre><p name="b257" id="b257" class="graf graf--p graf-after--pre">Provided that we agree to rely on <strong class="markup--strong markup--p-strong">Function.length</strong>, the following auxiliary helper can be used as well:</p><pre name="847b" id="847b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const curry = f =&gt; curryn(f.length)(f);</code></pre><pre name="cf88" id="cf88" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><br>const add_ = curry((x, y) =&gt; x + y);<br>const inc = add(1);<br><br><br>add(2) (3); // 5<br>inc(3); // 4</code></pre><p name="5682" id="5682" class="graf graf--p graf-after--pre">However, please keep in mind that one of the key benefits of currying consists precisely in abstracting over arity. <strong class="markup--strong markup--p-strong">curry</strong> counteracts this idea somehow.</p><h3 name="f943" id="f943" class="graf graf--h3 graf-after--p">Variadic functions and optional parameters</h3><p name="e0c6" id="e0c6" class="graf graf--p graf-after--h3">Since our <strong class="markup--strong markup--p-strong">curryn</strong> function does not rely on the length property of functions, we have no problem with transforming variadic functions or those with optional arguments:</p><pre name="6c1b" id="6c1b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const sum = (...args) =&gt; args.reduce((acc, x) =&gt; acc + x, 0);</code></pre><pre name="c8de" id="c8de" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><br>sum(1, 2, 3, 4, 5); // 15<br>curry(sum) (1) (2) (3) (4) (5); // yields another function<br>curryn(5)(sum) (1) (2) (3) (4) (5); // 15</code></pre><p name="c156" id="c156" class="graf graf--p graf-after--pre">Anyway, I want to emphasize that variadic functions create more problems than they solve and should be avoided anyway. Either use a <strong class="markup--strong markup--p-strong">fold</strong> (aka reduce) or semi-variadic functions, where the variadic argument is provided as an <strong class="markup--strong markup--p-strong">Iterable</strong>.</p><p name="bc8d" id="bc8d" class="graf graf--p graf-after--p">Optional arguments are a strong indicator that a function has either an ineffective parameter order or should be divided into two separate functions from the beginning.</p><h3 name="76ef" id="76ef" class="graf graf--h3 graf-after--p">Currying methods</h3><p name="1fd3" id="1fd3" class="graf graf--p graf-after--h3">Instead of programmatically transforming methods into curried form, just use curried function wrappers. A programmatic solution isn't worth the effort:</p><pre name="1a92" id="1a92" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const concat = ys =&gt; xs =&gt; xs.concat(ys);<br>const apply = f =&gt; xs =&gt; f.apply(null, xs);<br>const split = y =&gt; x =&gt; x.split(y);</code></pre><h3 name="b475" id="b475" class="graf graf--h3 graf-after--pre">Non-commutative operators</h3><p name="24d1" id="24d1" class="graf graf--p graf-after--h3">So far we haven't paid attention to the commutative law. The problem is that some operators are non-commutative, that is, the evaluation order of their operands is crucial:</p><pre name="98f4" id="98f4" class="graf graf--pre graf-after--p">1 + 2 === 2 + 1; // true, commutative<br>1 - 2 === 2 - 1; // false, non-commutative</pre><p name="a07e" id="a07e" class="graf graf--p graf-after--pre">In order to be able to pass operators around like normal data, we have to re-define them as operator functions:</p><pre name="a338" id="a338" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const add = x =&gt; y =&gt; x + y;<br>const sub = x =&gt; y =&gt; x - y;</code></pre><pre name="faa9" id="faa9" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code"><br>add(2) (3) === add(3) (2); // true, commutative<br>sub(2) (3) === sub(3) (2); // false, non-commutative</code></pre><p name="b6d1" id="b6d1" class="graf graf--p graf-after--pre">Unfortunately, functions are always in prefix position in Javascript, while operators are in infix notation:</p><pre name="b047" id="b047" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">sub(2)(3); // prefix notation<br>2 - 3; // infix notation</code></pre><p name="2ff8" id="2ff8" class="graf graf--p graf-after--pre">While the infix notation can be read only in one way, the prefix form allows to different interpretations:</p><pre name="791d" id="791d" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">// reads either as "subtract 2 from 3" or as "subtract from 2 3"</code></pre><pre name="d9a4" id="d9a4" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">sub(2)(3);<br><br></code></pre><pre name="6015" id="6015" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">// reads simply as 2 subtract 3</code></pre><pre name="2dcf" id="2dcf" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">2 - 3;</code></pre><p name="ac89" id="ac89" class="graf graf--p graf-after--pre">This ambiguity arises from two opposed parameter orders each binary operator function can be defined with:</p><pre name="52e3" id="52e3" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const sub = x =&gt; y =&gt; x - y;<br>const sub_ = y =&gt; x =&gt; x - y;<br><br></code></pre><pre name="f2ae" id="f2ae" class="graf graf--pre graf-after--pre">sub(2);  // yields x =&gt; 2 - x (left section)<br>sub_(2); // yields x =&gt; x - 2 (right section)</pre><p name="3d86" id="3d86" class="graf graf--p graf-after--pre">It turns out that we usually want to use the right section, when we partially apply the curried function sequence</p><pre name="c441" id="c441" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const sub_ = y =&gt; x =&gt; x - y;<br>const sub2 = sub(2);<br><br></code></pre><pre name="ae06" id="ae06" class="graf graf--pre graf-after--pre">sub2(10); // 8</pre><p name="8332" id="8332" class="graf graf--p graf-after--pre">and the left section, when we fully apply it</p><pre name="72c0" id="72c0" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const sub = x =&gt; y =&gt; x - y;<br><br></code></pre><pre name="c638" id="c638" class="graf graf--pre graf-after--pre">sub(2) (10); // -8</pre><p name="907b" id="907b" class="graf graf--p graf-after--pre">By the way, you do not have to define each operator function twice, but can utilize a simple, programmatic solution:</p><pre name="076f" id="076f" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const flip = f =&gt; x =&gt; y =&gt; f(y) (x);<br>const sub = x =&gt; y =&gt; x - y;<br>const sub_ = flip(sub);</code></pre><p name="840b" id="840b" class="graf graf--p graf-after--pre">If you are really concerned about a performance penalty in certain scenarios, you can also do this:</p><pre name="fb6c" id="fb6c" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">const sub = (x, y) =&gt; x - y;<br>const sub_ = y =&gt; x =&gt; x - y;</code></pre><h3 name="0d09" id="0d09" class="graf graf--h3 graf-after--pre">What you should not&nbsp;do</h3><p name="ae66" id="ae66" class="graf graf--p graf-after--h3">Your code should not rely on</p><ul class="postList"><li name="c117" id="c117" class="graf graf--li graf-after--p">the <strong class="markup--strong markup--li-strong">length</strong> or <strong class="markup--strong markup--li-strong">name</strong> property of the <strong class="markup--strong markup--li-strong">Function</strong> prototype</li><li name="3920" id="3920" class="graf graf--li graf-after--li">auto currying, because it introduces an unnecessary complexity</li><li name="97a0" id="97a0" class="graf graf--li graf-after--li">a programmatic curry solution that supports "gaps" or "holes" for individual arguments, because this is not currying anymore</li></ul><h3 name="83cc" id="83cc" class="graf graf--h3 graf-after--li">Why parameter order&nbsp;matters</h3><p name="c6b5" id="c6b5" class="graf graf--p graf-after--h3">Currying has a great impact on parameter orders, because the procedural invocation of function sequences becomes a common operation. This has two consequences for the argument list:</p><ul class="postList"><li name="ae3a" id="ae3a" class="graf graf--li graf-after--p">the primary parameter should be placed at the end to facilitate function composition</li><li name="a5d9" id="a5d9" class="graf graf--li graf-after--li">parameters that are least likely to change should be placed leftmost to facilitate partially applied functions</li></ul><p name="72a3" id="72a3" class="graf graf--p graf-after--li">The primary parameter represents the argument, that is shared between the involved functions of a composition. That is exactly the last argument, which is fed with the return value of the nested function. The primary argument is the functional equivalent of the receiving object, which enables method chaining in Javascript.</p><h3 name="19a5" id="19a5" class="graf graf--h3 graf-after--p">Up next: Function composition</h3><p name="2404" id="2404" class="graf graf--p graf-after--h3">If you have enjoyed this article, please don't forget to ♥️ or to <strong class="markup--strong markup--p-strong">share</strong> it - thanks! Comments and questions are appreciated as well. The next article illustrates the advantages of functional composition and combinatorics.</p><p name="bcac" id="bcac" class="graf graf--p graf-after--p graf--trailing">Next part: <a href="https://medium.com/@iquardt/function-composition-in-javascript-the-whole-symphony-9aacb21baf42" data-href="https://medium.com/@iquardt/function-composition-in-javascript-the-whole-symphony-9aacb21baf42" class="markup--anchor markup--p-anchor" target="_blank">function composition</a></p></div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-59" name="t-59"></a><h1>59 : An Introduction to Functional Programming in JavaScript</h1>
					<div class="tutorial__content">
<span>http://srirangan.net/2011-12-functional-programming-in-javascript</span>
<div>
<p>For me, in many ways, 2011 has been the year of the rediscovery of JavaScript. I have been programming in JavaScript
  for many years (like most other programmers) but now I've come to appreciate JavaScript the language a little
  better.</p>
<p>2011 was also when I had to dig into Scala. Thus I was compelled to implement more solutions in a functional
  manner. </p>
<p>Like many programmers unfamiliar with Functional Programming or others familiar with Functional Programming but more
  comfortable with Object Oriented Programming, it was daunting at first. </p>
<p>But persist through and one starts to see the benefits of Functional Programming (or at least understand it enough
  and execute your projects).</p>
<p>If you're looking for a quick start in Functional Programming, JavaScript is the perfect language for you. Here's
  why:</p>
<ul>
  <li>Almost all programmers have tweaked and / or written JavaScript code at some point of time — hence there should be
    a certain familiarity
  </li>
  <li>JavaScript comes as close to a standardized programming language we'll get — it's the only programming language
    available across all web browsers
  </li>
  <li>JavaScript comes with a very familiar C like syntax and should be readable to most programmers</li>
  <li>Functions have always been first class members in JavaScript, support for Functional Programming is very good and
    in many ways JavaScript has been ahead of its time
  </li>
  <li>JavaScript doesn't have Java like Class based Object Oriented Programming support so in many ways you're forced to
    be Functional in JavaScript
  </li>
</ul>
<p>These should be enough reasons, so without meandering any further in the introduction, I present <em>Functional
  Programming with JavaScript</em>:</p>
<hr>
<h2>Functions in JavaScript</h2>
<p>Almost everyone reading would have seen <strong>function declarations</strong> in JavaScript. However JavaScript lets
  you explicitly express functions as objects.</p>
<p>In fact, all <strong>function declarations</strong> are automatically converted to <strong>function
  expressions</strong> and hoisted. </p>
<p>By <strong>hoisting</strong>, the converted function expression is automatically placed in the beginning and thus is
  available in lines before it has been declared.</p>
<pre><code>function justAFunction() {
  console.log("functions can be declared");
}

var justAnotherFunction = function () {
  console.log("functions can be expressed as objects");
};

console.log("All functions are objects of type 'function'");
console.log(typeof justAFunction);
console.log(typeof justAnotherFunction);

// This function is available through hoisting
// although it will be declared later
console.log(typeof justAFunctionThatWillBeHoisted); 

function justAFunctionThatWillBeHoisted() {
  console.log("Function declarations are automatically hoisted to the top");
}</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>function justAFunction() {
  console.log("functions can be declared");
}

var justAnotherFunction = function () {
  console.log("functions can be expressed as objects");
};

console.log("All functions are objects of type 'function'");
console.log(typeof justAFunction);
console.log(typeof justAnotherFunction);

// This function is available through hoisting
// although it will be declared later
console.log(typeof justAFunctionThatWillBeHoisted); 

function justAFunctionThatWillBeHoisted() {
  console.log("Function declarations are automatically hoisted to the top");
}</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<hr>
<p>JavaScript functions are also different in the sense that each function, regardless of how it is defined, has dynamic
  arguments and a dynamic context.</p>
<p>A JavaScript function can, of course, access its arguments by their variable names. </p>
<p>By dynamic arguments, I mean, in the function body, we are provided an <strong>arguments</strong> array which contain
  all the arguments sequentially in the order they were passed. This means any function can be called with any set of
  arguments, thus giving us a lot of flexibility.</p>
<p>By dynamic context, I am refering to the <strong>this</strong> object. Typically the <strong>this</strong> object
  defaults sensibly to the context of the function. However it is possible to explicitly call a function with a user
  defined <strong>this</strong> / context object.</p>
<pre><code>var logArguments = function () {
  console.log(arguments);
};

console.log("All functions can have dynamic arguments");
logArguments("hello", "world");
logArguments("hello", "world", 42, ["huh", "wtf!"], {hello:"world"});

var logThis = function () {
  console.log(this);
};

console.log("All functions can have dynamic contexts / 'this' objects");
logThis();
logThis.apply({yo:"baby!"});</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>var logArguments = function () {
  console.log(arguments);
};

console.log("All functions can have dynamic arguments");
logArguments("hello", "world");
logArguments("hello", "world", 42, ["huh", "wtf!"], {hello:"world"});

var logThis = function () {
  console.log(this);
};

console.log("All functions can have dynamic contexts / 'this' objects");
logThis();
logThis.apply({yo:"baby!"});</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<p>Notice how <code>functionName.apply()</code> allows us to explicitly set the context and pass arguments.</p>
<hr>
<p>I must point out that JavaScript presents us with <strong>functional scoping</strong> instead of <strong>block
  scoping</strong> (C, C++ etc.). This usually becomes more relevant when you need to implement Object Oriented patterns
  in JavaScript but more on that in a later blog post.</p>
<p>Another trick for you is the capability to define <strong>self-executing anonymous function</strong>. These can be
  creatively used to implement modular namespaces / packages. Here are some examples:</p>
<pre><code>(function (name) {
  console.log(name + " functions can be auto-executed on definition")
})("Anonymous");

console.log("JavaScript provides functional scoping instead of block scoping");
(function () {
  if (true) {
    var x = true;
    console.log("Is 'x' available inside the block? " + x);
  }
  console.log("Is 'x' available outside the block? " + x);
})();</code></pre>

<pre><code>(function (name) {
  console.log(name + " functions can be auto-executed on definition")
})("Anonymous");

console.log("JavaScript provides functional scoping instead of block scoping");
(function () {
  if (true) {
    var x = true;
    console.log("Is 'x' available inside the block? " + x);
  }
  console.log("Is 'x' available outside the block? " + x);
})();</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<hr>
<h2>Higher Order Functions</h2>
<p>We know functions in JavaScript are nothing but objects. Does this mean functions can be passed around as arguments
  to other functions? And can one function return another function?</p>
<p>The answer to both questions is "Yes". And such functions which taking in other functions are arguments and / or
  return functions are typically called <strong>higher order functions</strong>.</p>
<p>In the example below, we will define a higher order function <code>forEach</code>. This function takes in two
  arguments: a <code>list</code> and an <code>action</code>. The first argument list is an array containing containing
  objects and the second argument action is a function that will be invoked for each item in list.</p>
<pre><code>var forEach = function (list, action) {
  for (var i = 0; i &lt; list.length; i++) {
    action(list[i]);
  }
};

var logItem = function (item) {
  console.log(item);
};

var listOfThings = ["soap", "candle", "deer", "wine", "bread"];
var anotherListOfThings = ["grapes", "apples", "beer", "pizza"];

forEach(listOfThings, logItem);

forEach(anotherListOfThings, function (item) {
  console.log(item + "'s length is " + item.length);
});</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>var forEach = function (list, action) {
  for (var i = 0; i &lt; list.length; i++) {
    action(list[i]);
  }
};

var logItem = function (item) {
  console.log(item);
};

var listOfThings = ["soap", "candle", "deer", "wine", "bread"];
var anotherListOfThings = ["grapes", "apples", "beer", "pizza"];

forEach(listOfThings, logItem);

forEach(anotherListOfThings, function (item) {
  console.log(item + "'s length is " + item.length);
});</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<p>The simple example above shows how a named function <code>logItem</code> and an <code>anonymous function</code> are
  being passed as arguments to the higher order function <code>forEach</code>.</p>
<hr>
<h2>Map / Reduce Implementations</h2>
<p>In the example above, we saw how the <code>forEach</code> algorithm was expressed as a function and reused multiple
  times as an when required. We avoided repeating loops and thus made the code more readable.</p>
<p>This is one of the prime reasons to write functional code. If done correctly, you'll be able to abstract out complex
  algorithms, replace it with a nice function call and keep code condensed and readable.</p>
<p>To further stress this idea, we need a better example. For each was too simple an algorithm to abstract. Let's try
  implementing higher order functions for <strong>Map and Reduce algorithms</strong>.</p>
<p>We start with the Map function. What is the map function? Our <code>map</code> function should allow the user to
  perform a particular action over each item of a <code>list</code>, and then return a <code>result</code> list
  containing results of actions performed on each list item.</p>
<p>Simple enough, show me the code!</p>
<pre><code>var forEach = function (list, action) {
  for (var i = 0; i &lt; list.length; i++) {
    action(list[i]);
  }
};

var map = function (mappingFunction, list) {
  var result = [];
  forEach(list, function (item) {
    result.push(mappingFunction(item));
  });
  return result;
};

var doubleIt = function (item) {
  if (typeof item === "number") {
    return item * 2;
  }
};

console.log(map(doubleIt, [1, 2, 3, 4, "WTF"]));</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>var forEach = function (list, action) {
  for (var i = 0; i &lt; list.length; i++) {
    action(list[i]);
  }
};

var map = function (mappingFunction, list) {
  var result = [];
  forEach(list, function (item) {
    result.push(mappingFunction(item));
  });
  return result;
};

var doubleIt = function (item) {
  if (typeof item === "number") {
    return item * 2;
  }
};

console.log(map(doubleIt, [1, 2, 3, 4, "WTF"]));</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<p>Notice we reuse the <code>forEach</code> function from the previous example. Our <code>map</code> function takes in
  two arguments, the first one being the <code>mappingFunction</code> that is to be applied on every item of the second
  argument <code>list</code>.</p>
<p>The implementation for <code>map</code> is straightforward. We prepare an array result, iterate through the list,
  call the <code>mappingFunction</code> for each item in <code>list</code>, push the result in the result array return
  it when all done.</p>
<p>As an example, we are calling map function and passing the function <code>doubleIt</code> as the
  <code>mapperFunction</code> on each item of an anonymous list.</p>
<p>Time for the <code>reduce</code> function. What is the reduce algorithm? The <code>reduce</code> function will be
  given a <code>combine</code> function, a <code>base</code> value and a <code>list</code>. We need to apply the <code>combine</code>
  function on the base value and each value in the list and finally return the result. In short, Reduce function takes
  in a list, combines it and gives us a single result.</p>
<pre><code>var forEach = function (list, action) {
  for (var i = 0; i &lt; list.length; i++) {
    action(list[i]);
  }
};

var reduce = function (combine, base, list) {
  forEach(list, function (item) {
    base = combine(base, item);
  });
  return base;
};

var countNegativeNumbers = function (negativeNumbersTillNow, currentNumber) {
  if (typeof currentNumber === "number" &amp;&amp; currentNumber &lt; 0) {
    negativeNumbersTillNow += 1;
  }
  return negativeNumbersTillNow;
};

var initialCount = 0;

console.log(reduce(countNegativeNumbers, initialCount, [1, -1, 0, 45, "-42", -42]));</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>var forEach = function (list, action) {
  for (var i = 0; i &lt; list.length; i++) {
    action(list[i]);
  }
};

var reduce = function (combine, base, list) {
  forEach(list, function (item) {
    base = combine(base, item);
  });
  return base;
};

var countNegativeNumbers = function (negativeNumbersTillNow, currentNumber) {
  if (typeof currentNumber === "number" &amp;&amp; currentNumber &lt; 0) {
    negativeNumbersTillNow += 1;
  }
  return negativeNumbersTillNow;
};

var initialCount = 0;

console.log(reduce(countNegativeNumbers, initialCount, [1, -1, 0, 45, "-42", -42]));</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<p>This solution again makes use of the previous create <code>forEach</code> function. Our <code>reduce</code> function
  is simple, it iterates through the <code>list</code>, applies <code>combine</code> on <code>base</code> and each list
  item, stores the result in base and returns it after completion.</p>
<p>As a usage example, we use <code>reduce</code> to get a count of the negative numbers in a list.</p>
<p>These two examples are fairly simple and still show us how, with functional programming, we can effectively abstract
  out algorithms as functions, use them as and when required and still retain simplicility and readability in the
  code.</p>
<hr>
<h2>Closures in JavaScript</h2>
<p>If you've heard of Functional Programming, there's a very good chance you've also heard about
  <strong>closures</strong>. They are often mentioned in the same breath.</p>
<p>But what are closures? Think of closures as a composite of two things:</p>
<ol>
  <li>A function being returned by another function</li>
  <li>A closed environment in which this returned function is forced to execute</li>
</ol>
<p>This is what a closure is.</p>
<p>In our first example of a closure implementation, we have <code>getAreaFunction</code> which reads the shape argument
  and returns an appropriate area function.</p>
<pre><code>const CIRCLE = "circle";
const SQUARE = "square";
const RECTANGLE = "rectangle";

var getAreaFunction = function (shape) {
  return function () {
    switch (shape) {
      case CIRCLE:
        return Math.PI * arguments[0] * arguments[0];
        break;
      case SQUARE:
        return arguments[0] * arguments[0];
        break;
      case RECTANGLE:
        return arguments[0] * arguments[1];
        break;
    }
  };
};

var getAreaOfCircle = getAreaFunction(CIRCLE);
var getAreaOfSquare = getAreaFunction(SQUARE);
var getAreaOfRectangle = getAreaFunction(RECTANGLE);

console.log(getAreaOfCircle(50));
console.log(getAreaOfSquare(50));
console.log(getAreaOfRectangle(50, 20));</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>const CIRCLE = "circle";
const SQUARE = "square";
const RECTANGLE = "rectangle";

var getAreaFunction = function (shape) {
  return function () {
    switch (shape) {
      case CIRCLE:
        return Math.PI * arguments[0] * arguments[0];
        break;
      case SQUARE:
        return arguments[0] * arguments[0];
        break;
      case RECTANGLE:
        return arguments[0] * arguments[1];
        break;
    }
  };
};

var getAreaOfCircle = getAreaFunction(CIRCLE);
var getAreaOfSquare = getAreaFunction(SQUARE);
var getAreaOfRectangle = getAreaFunction(RECTANGLE);

console.log(getAreaOfCircle(50));
console.log(getAreaOfSquare(50));
console.log(getAreaOfRectangle(50, 20));</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<p>Notice how <code>getAreaFunction</code> returns an anonymous function. This returned function contains a switch case
  on shape which is available in the <em>environment</em>.</p>
<p>Finally, of course, we see how to use the closure as a <em>function factory</em> to get area functions for different
  types of shapes.</p>
<hr>
<p>In our second closure example, we see how closures are used to implement private class members in JavaScript.</p>
<pre><code>const CIRCLE = "circle";
const SQUARE = "square";
const RECTANGLE = "rectangle";

var getAreaFunction = function (shape) {
  return function () {
    switch (shape) {
      case CIRCLE:
        return Math.PI * arguments[0] * arguments[0];
        break;
      case SQUARE:
        return arguments[0] * arguments[0];
        break;
      case RECTANGLE:
        return arguments[0] * arguments[1];
        break;
    }
  };
};

var Shape = function (type) {
  var area = getAreaFunction(type);
  return {
    getArea:function () {
      return Math.round(Number(area.apply(this, arguments)));
    }
  };
};

var aCircle = new Shape(CIRCLE);
var aSquare = new Shape(SQUARE);
var aRectangle = new Shape(RECTANGLE);

console.log(aCircle.getArea(50));
console.log(aSquare.getArea(50));
console.log(aRectangle.getArea(50, 20));</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>const CIRCLE = "circle";
const SQUARE = "square";
const RECTANGLE = "rectangle";

var getAreaFunction = function (shape) {
  return function () {
    switch (shape) {
      case CIRCLE:
        return Math.PI * arguments[0] * arguments[0];
        break;
      case SQUARE:
        return arguments[0] * arguments[0];
        break;
      case RECTANGLE:
        return arguments[0] * arguments[1];
        break;
    }
  };
};

var Shape = function (type) {
  var area = getAreaFunction(type);
  return {
    getArea:function () {
      return Math.round(Number(area.apply(this, arguments)));
    }
  };
};

var aCircle = new Shape(CIRCLE);
var aSquare = new Shape(SQUARE);
var aRectangle = new Shape(RECTANGLE);

console.log(aCircle.getArea(50));
console.log(aSquare.getArea(50));
console.log(aRectangle.getArea(50, 20));</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<p>I'll not explain Object Oriented Programming implementations in JavaScript as part of this post. They aren't complex
  but are different, surely worthy of a dedicated post.</p>
<p>If you're already familiar with OOP concepts and their implementations in JavaScript, note how the class
  <code>Shape</code> (which is, yes, expressed as a function) contains a private function <code>area</code> and isn't
  exposed.</p>
<p>Instead an instance function <code>getArea</code> is available which does internally make use of the private function
  <code>area</code>.</p>
<p>This is one of the most common use-cases of closures in JavaScript.</p>
<hr>
<p>Another classic use-case for closures in JavaScript is to avoid the annoying problem that crops up every time you try
  to set event handlers within a loop.</p>
<p>Consider the following example:</p>
<pre><code>&lt;div id="redBox1" class="redBox">&lt;/div>
&lt;div id="redBox2" class="redBox">&lt;/div>
&lt;div id="redBox3" class="redBox">&lt;/div>

&lt;div id="greenBox1" class="greenBox">&lt;/div>
&lt;div id="greenBox2" class="greenBox">&lt;/div>
&lt;div id="greenBox3" class="greenBox">&lt;/div>

&lt;script>
  (function () {
    for (var i = 1; i <= 3; i++) {
      var redBoxId = "redBox" + i;
      document.getElementById(redBoxId).onclick = function () {
        console.log(redBoxId + " was clicked");
      };
      var greenBoxId = "greenBox" + i;
      document.getElementById(greenBoxId).onclick = (function (greenBoxId) {
        return function () {
          console.log(greenBoxId + " was clicked");
        }
      })(greenBoxId);
    }
  })();
&lt;/script></code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>&lt;div id="redBox1" class="redBox"&gt;&lt;/div&gt;
&lt;div id="redBox2" class="redBox"&gt;&lt;/div&gt;
&lt;div id="redBox3" class="redBox"&gt;&lt;/div&gt;

&lt;div id="greenBox1" class="greenBox"&gt;&lt;/div&gt;
&lt;div id="greenBox2" class="greenBox"&gt;&lt;/div&gt;
&lt;div id="greenBox3" class="greenBox"&gt;&lt;/div&gt;

&lt;script&gt;
  (function () {
    for (var i = 1; i &lt;= 3; i++) {
      var redBoxId = "redBox" + i;
      document.getElementById(redBoxId).onclick = function () {
        console.log(redBoxId + " was clicked");
      };
      var greenBoxId = "greenBox" + i;
      document.getElementById(greenBoxId).onclick = (function (greenBoxId) {
        return function () {
          console.log(greenBoxId + " was clicked");
        }
      })(greenBoxId);
    }
  })();
&lt;/script&gt;</code></pre>

  <link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css">


<p>In the for loop, we first assign an <code>onclick</code> handler to all the red boxes. However, thanks to functional
  scoping, all three red boxes have onclick handlers with <code>redBoxId</code> value 3.</p>
<p>However for green boxes we assign <code>onclick</code> handlers in a slightly different manner. We have a self
  executing anonymous function which returns another function which then is assigned as the onclick handler.</p>
<p>Due to functional scopes, each <code>onclick</code> handler for the green boxes have correct values for <code>greenBoxId</code>.
</p>
<hr>
<p>I realize this has been a fairly lengthy post. Will end it now. Hopefully this would have served as a good enough
  introduction to Functional Programming concepts and their corresponding implementations in JavaScript.</p>
<p>All code available on <a href="https://github.com/Srirangan/javascript-playground/tree/master/functional-javascript">GitHub</a>.
</p>
</div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-60" name="t-60"></a><h1>60 : Don't Be Scared Of Functional Programming</h1>
					<div class="tutorial__content">

	<p>Functional programming is the mustachioed hipster of programming paradigms. Originally relegated to the annals of computer science academia, functional programming has had a recent renaissance that is due largely to its utility in distributed systems (and probably also because "pure" functional languages like Haskell are difficult to grasp, which gives them a certain cachet).</p>
<p>Stricter functional programming languages are typically used when a system's performance and integrity are both critical — i.e. your program needs to do exactly what you expect every time and needs to operate in an environment where its tasks can be shared across hundreds or thousands of networked computers.</p>
<h3 id="further-reading-on-smashingmag"><span class="rh">Further Reading</span> on SmashingMag: <a href="#further-reading-on-smashingmag" aria-label="Link to section 'Further Reading on SmashingMag:'" class="sr hsl">Link</a></h3>
<ul>
<li><a title="Read 'An Introduction To Programming Type Systems'" href="https://www.smashingmagazine.com/2013/04/introduction-to-programming-type-systems/" rel="bookmark"><span class="headline">An Introduction To Programming Type Systems</span></a><sup class="po" id="note-1"><a href="#1">1</a></sup></li>
<li><a title="Read 'An Introduction To Redux'" href="https://www.smashingmagazine.com/2016/06/an-introduction-to-redux/" rel="bookmark">An Introduction To Redux</a><sup class="po" id="note-2"><a href="#2">2</a></sup></li>
<li><a title="Read 'An Introduction To Full-Stack JavaScript'" href="https://www.smashingmagazine.com/2013/11/introduction-to-full-stack-javascript/" rel="bookmark">An Introduction To Full-Stack JavaScript</a><sup class="po" id="note-3"><a href="#3">3</a></sup></li>
<li><a title="Read 'Declarative Programming And The Web'" href="https://www.smashingmagazine.com/2014/07/declarative-programming/" rel="bookmark">Declarative Programming And The Web</a><sup class="po" id="note-4"><a href="#4">4</a></sup></li>
</ul>
<p><a title="Clojure" href="http://clojure.org/">Clojure</a><sup class="po" id="note-5"><a href="#5">5</a></sup>, for example, powers <a title="Akamai" href="http://www.akamai.com/">Akamai</a><sup class="po" id="note-6"><a href="#6">6</a></sup>, the massive content delivery network utilized by companies such as Facebook, while <a title="Twitter uses Scala" href="http://www.infoq.com/articles/twitter-java-use">Twitter famously adopted</a><sup class="po" id="note-7"><a href="#7">7</a></sup> <a href="http://www.scala-lang.org/">Scala</a><sup class="po" id="note-8"><a href="#8">8</a></sup> for its most performance-intensive components, and <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a><sup class="po" id="note-9"><a href="#9">9</a></sup> is used by AT&amp;T for its network security systems.</p>
<p>These languages have a steep learning curve for most front-end web developers; however, many more approachable languages incorporate features of functional programming, most notably Python, both in its core library, with functions like <code>map</code> and <code>reduce</code> (which we'll talk about in a bit), and with libraries such as <a title="fn.py" href="https://github.com/kachayev/fn.py">Fn.py</a><sup class="po" id="note-10"><a href="#10">10</a></sup>, along with JavaScript, again using collection methods, but also with libraries such as <a title="Backbone.js" href="http://underscorejs.org/">Underscore.js</a><sup class="po" id="note-11"><a href="#11">11</a></sup> and <a title="Bacon.js" href="http://baconjs.github.io/">Bacon.js</a><sup class="po" id="note-12"><a href="#12">12</a></sup>.</p>
<figure><img class="at" src="https://www.smashingmagazine.com/wp-content/uploads/2014/06/fp-preview.png" alt="" width="500" height="493"></figure>
<p>Functional programming can be daunting, but remember that it isn't only for PhDs, data scientists and architecture astronauts. For most of us, the real benefit of adopting a functional style is that our programs can be broken down into smaller, simpler pieces that are both more reliable and easier to understand. If you're a front-end developer working with data, especially if you're formatting that data for visualization using D3, Raphael or the like, then functional programming will be an essential weapon in your arsenal.</p>
<p>Finding a consistent definition of functional programming is tough, and most of the literature relies on somewhat foreboding statements like "functions as first-class objects," and "eliminating side effects." Just in case that doesn't bend your brain into knots, at a more theoretical level, functional programming is often explained in terms of <a title="Lambda Calculus" href="http://en.wikipedia.org/wiki/Lambda_calculus">lambda calculus</a><sup class="po" id="note-13"><a href="#13">13</a></sup> (some <a href="http://mathoverflow.net/questions/11916/is-functional-programming-a-branch-of-mathematics">actually argue</a><sup class="po" id="note-14"><a href="#14">14</a></sup> that functional programming is basically math) — but you can relax. From a more pragmatic perspective, a beginner needs to understand only two concepts in order to use it for everyday applications (no calculus required!).</p>
<p>First, data in functional programs should be <strong>immutable</strong>, which sounds serious but just means that it should never change. At first, this might seem odd (after all, who needs a program that never changes anything?), but in practice, you would simply create new data structures instead of modifying ones that already exist. For example, if you need to manipulate some data in an array, then you'd make a new array with the updated values, rather than revise the original array. Easy!</p>
<p>Secondly, functional programs should be <strong>stateless</strong>, which basically means they should perform every task as if for the first time, with no knowledge of what may or may not have happened earlier in the program's execution (you might say that a stateless program is ignorant of the past). Combined with immutability, this helps us think of each function as if it were operating in a vacuum, blissfully ignorant of anything else in the application besides other functions. In more concrete terms, this means that your functions will operate only on data passed in as arguments and will never rely on outside values to perform their calculations.</p>
<p>Immutability and statelessness are core to functional programming and are important to understand, but don't worry if they don't quite make sense yet. You'll be familiar with these principles by the end of the article, and I promise that the beauty, precision and power of functional programming will turn your applications into bright, shiny, data-chomping rainbows. For now, start with simple functions that return data (or other functions), and then combine those basic building blocks to perform more complex tasks.</p>
<p>For example, let's say we have an API response:</p>
<pre><code class="language-javascript">var data = [
  { 
    name: "Jamestown",
    population: 2047,
    temperatures: [-34, 67, 101, 87]
  },
  {
    name: "Awesome Town",
    population: 3568,
    temperatures: [-3, 4, 9, 12]
  }
  {
    name: "Funky Town",
    population: 1000000,
    temperatures: [75, 75, 75, 75, 75]
  }
];
</code></pre>
<p>If we want to use a chart or graphing library to compare the average temperature to population size, we'd need to write some JavaScript that makes a few changes to the data before it's formatted correctly for our visualization. Our graphing library wants an array of x and y coordinates, like so:</p>
<pre><code class="language-javascript">[
  [x, y],
  [x, y]
  …etc
]
</code></pre>
<p>Here, <code>x</code> is the average temperature, and <code>y</code> is the population size.</p>
<p>Without functional programming (or without using what's called an "imperative" style), our program might look like this:</p>
<pre><code class="language-javascript">var coords = [],
    totalTemperature = 0,
    averageTemperature = 0;

for (var i=0; i &lt; data.length; i++) {
  totalTemperature = 0;
  
  for (var j=0; j &lt; data[i].temperatures.length; j++) {
    totalTemperature += data[i].temperatures[j];
  }

  averageTemperature = totalTemperature / data[i].temperatures.length;

  coords.push([averageTemperature, data[i].population]);
}
</code></pre>
<p>Even in a contrived example, this is already becoming difficult to follow. Let's see if we can do better.</p>
<p>When programming in a functional style, you're always looking for simple, repeatable actions that can be abstracted out into a function. We can then build more complex features by calling these functions in sequence (also known as "composing" functions) — more on that in a second. In the meantime, let's look at the steps we'd take in the process of transforming the initial API response to the structure required by our visualization library. At a basic level, we'll perform the following actions on our data:</p>
<ul>
<li>add every number in a list,</li>
<li>calculate an average,</li>
<li>retrieve a single property from a list of objects.</li>
</ul>
<p>We'll write a function for each of these three basic actions, then compose our program from those functions. Functional programming can be a little confusing at first, and you'll probably be tempted to slip into old imperative habits. To avoid that, here are some simple ground rules to ensure that you're following best practices:</p>
<ol>
<li>All of your functions must accept at least one argument.</li>
<li>All of your functions must return data or another function.</li>
<li>No loops!</li>
</ol>
<p>OK, let's add every number in a list. Remembering the rules, let's make sure that our function accepts an argument (the array of numbers to add) and returns some data.</p>
<pre><code class="language-javascript">function totalForArray(arr) {
  // add everything
  return total;  
}
</code></pre>
<p>So far so good. But how are we going to access every item in the list if we don't loop over it? Say hello to your new friend, recursion! This is a bit tricky, but basically, when you use recursion, you create a function that calls itself unless a specific condition has been met — in which case, a value is returned. Just looking at an example is probably easiest:</p>
<pre><code class="language-javascript">// Notice we're accepting two values, the list and the current total
function totalForArray(currentTotal, arr) {
  
  currentTotal += arr[0]; 

  // Note to experienced JavaScript programmers, I'm not using Array.shift on 
  // purpose because we're treating arrays as if they are immutable.
  var remainingList = arr.slice(1);

  // This function calls itself with the remainder of the list, and the 
  // current value of the currentTotal variable
  if(remainingList.length &gt; 0) {
    return totalForArray(currentTotal, remainingList); 
  }
  
  // Unless of course the list is empty, in which case we can just return
  // the currentTotal value.
  else {
    return currentTotal;
  }
}
</code></pre>
<p><strong>A word of caution:</strong> Recursion will make your programs more readable, and it is essential to programming in a functional style. However, in some languages (including JavaScript), you'll run into problems when your program makes a large number of recursive calls in a single operation (at the time of writing, "large" is about <a href="http://www.2ality.com/2014/04/call-stack-size.html">10,000 calls in Chrome, 50,000 in Firefox and 11,000 in Node.js</a><sup class="po" id="note-15"><a href="#15">15</a></sup>). The details are beyond the scope of this article, but the gist is that, at least <a href="https://people.mozilla.org/~jorendorff/es6-draft.html#sec-tail-position-calls">until ECMAScript 6 is released</a><sup class="po" id="note-16"><a href="#16">16</a></sup>, JavaScript doesn't support something called "tail recursion," which is a more efficient form of recursion. This is an advanced topic and won't come up very often, but it's worth knowing.</p>
<p>With that out of the way, remember that we needed to calculate the total temperature from an array of temperatures in order to then calculate the average. Now, instead of looping over each item in the <code>temperatures</code> array, we can simply write this:</p>
<pre><code class="language-javascript">var totalTemp = totalForArray(0, temperatures);
</code></pre>
<p>If you're purist, you might say that our <code>totalForArray</code> function could be broken down even further. For example, the task of adding two numbers together will probably come up in other parts of your application and subsequently should really be its own function.</p>
<pre><code class="language-javascript">function addNumbers(a, b) {
  return a + b;
}
</code></pre>
<p>Now, our <code>totalForArray</code> function looks like this:</p>
<pre><code class="language-javascript">function totalForArray(currentTotal, arr) {
  currentTotal = addNumbers(currentTotal, arr[0]);

  var remainingArr = arr.slice(1);
  
  if(remainingArr.length &gt; 0) {
    return totalForArray(currentTotal, remainingArr);
  }
  else {
    return currentTotal;
  }
}
</code></pre>
<p>Excellent! Returning a single value from an array is fairly common in functional programming, so much so that it has a special name, "reduction," which you'll more commonly hear as a verb, like when you "reduce an array to a single value." JavaScript has a special method just for performing this common task. Mozilla Developer Network provides a <a title="JavaScript reduce method" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">full explanation</a><sup class="po" id="note-17"><a href="#17">17</a></sup>, but for our purposes it's as simple as this:</p>
<pre><code class="language-javascript">// The reduce method takes a function as its first argument, and that function 
// accepts both the current item in the list and the current total result from 
// whatever calculation you're performing.
var totalTemp = temperatures.reduce(function(previousValue, currentValue){
  // After this calculation is returned, the next currentValue will be 
  // previousValue + currentValue, and the next previousValue will be the 
  // next item in the array.
  return previousValue + currentValue;
});
</code></pre>
<p>But, hey, since we've already defined an <code>addNumber</code> function, we can just use that instead.</p>
<pre><code class="language-javascript">var totalTemp = temperatures.reduce(addNumbers);
</code></pre>
<p>In fact, because totalling up an array is so cool, let's put that into its own function so that we can use it again without having to remember all of that confusing stuff about reduction and recursion.</p>
<pre><code class="language-javascript">function totalForArray(arr) {
  return arr.reduce(addNumbers);
}

var totalTemp = totalForArray(temperatures);
</code></pre>
<p>Ah, now <em>that</em> is some readable code! Just so you know, methods such as <code>reduce</code> are common in most functional programming languages. These helper methods that perform actions on arrays in lieu of looping are often called "higher-order functions."</p>
<p>Moving right along, the second task we listed was calculating an average. This is pretty easy.</p>
<pre><code class="language-javascript">function average(total, count) {
  return total / count;
}
</code></pre>
<p>How might we go about getting the average for an entire array?</p>
<pre><code class="language-javascript">function averageForArray(arr) {
  return average(totalForArray(arr), arr.length);
}

var averageTemp = averageForArray(temperatures);
</code></pre>
<p>Hopefully, you're starting to see how to combine functions to perform more complex tasks. This is possible because we're following the rules set out at the beginning of this article — namely, that our functions must always accept arguments and return data. Pretty awesome.</p>
<p>Lastly, we wanted to retrieve a single property from an array of objects. Instead of showing you more examples of recursion, I'll cut to the chase and clue you in on another built-in JavaScript method: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a><sup class="po" id="note-18"><a href="#18">18</a></sup>. This method is for when you have an array with one structure and need to map it to another structure, like so:</p>
<pre><code class="language-javascript">// The map method takes a single argument, the current item in the list. Check
// out the link above for more complete examples.
var allTemperatures = data.map(function(item) {
  return item.temperatures;
});
</code></pre>
<p>That's pretty cool, but pulling a single property from a collection of objects is something you'll be doing all the time, so let's make a function just for that.</p>
<pre><code class="language-javascript">// Pass in the name of the property that you'd like to retrieve
function getItem(propertyName) {
  // Return a function that retrieves that item, but don't execute the function.
  // We'll leave that up to the method that is taking action on items in our 
  // array.
  return function(item) {
    return item[propertyName];
  }
}
</code></pre>
<p>Check it out: We've made a function that returns a function! Now we can pass it to the <code>map</code> method like this:</p>
<pre><code class="language-javascript">var temperatures = data.map(getItem('temperature'));
</code></pre>
<p>In case you like details, the reason we can do this is because, in JavaScript, functions are "first-class objects," which basically means that you can pass around functions just like any other value. While this is a feature of many programming languages, it's a requirement of any language that can be used in a functional style. Incidentally, this is also the reason you can do stuff like <code>$('#my-element').on('click', function(e) … )</code>. The second argument in the <code>on</code> method is a <code>function</code>, and when you pass functions as arguments, you're using them just like you would use values in imperative languages. Pretty neat.</p>
<p>Finally, let's wrap the call to <code>map</code> in its own function to make things a little more readable.</p>
<pre><code class="language-javascript">function pluck(arr, propertyName) {
  return arr.map(getItem(propertyName));
} 

var allTemperatures = pluck(data, 'temperatures');
</code></pre>
<p>All right, now we have a toolkit of generic functions that we can use anywhere in our application, even in other projects. We can tally up the items in an array, get the average value of an array, and make new arrays by plucking properties from lists of objects. Last but not least, let's return to our original problem:</p>
<pre><code class="language-javascript">var data = [
  { 
    name: "Jamestown",
    population: 2047,
    temperatures: [-34, 67, 101, 87]
  },
  …
];
</code></pre>
<p>We need to transform an array of objects like the one above into an array of <code>x, y</code> pairs, like this:</p>
<pre><code class="language-javascript">[
  [75, 1000000],
  …
];
</code></pre>
<p>Here, <code>x</code> is the average temperature, and <code>y</code> is the total population. First, let's isolate the data that we need.</p>
<pre><code class="language-javascript">var populations = pluck(data, 'population');
var allTemperatures = pluck(data, 'temperatures');
</code></pre>
<p>Now, let's make an array of averages. Remember that the function we pass to <code>map</code> will be called on each item in the array; so, the returned value of that passed function will be added to a new array, and that new array will ultimately be assigned to our <code>averageTemps</code> variable.</p>
<pre><code class="language-javascript">var averageTemps = allTemperatures.map(averageForArray);
</code></pre>
<p>So far so good. But now we have two arrays:</p>
<pre><code class="language-javascript">// populations
[2047, 3568, 1000000]

// averageTemps
[55.25, 5.5, 75]
</code></pre>
<p>Obviously, we want only one array, so let's write a function to combine them. Our function should make sure that the item at index <code>0</code> in the first array is paired with the item at index <code>0</code> in the second array, and so on for indexes <code>1</code> to <code>n</code> (where <code>n</code> is the total number of items in the array).</p>
<pre><code class="language-javascript">function combineArrays(arr1, arr2, finalArr) {
  // Just so we don't have to remember to pass an empty array as the third
  // argument when calling this function, we'll set a default.
  finalArr = finalArr || [];

  // Push the current element in each array into what we'll eventually return
  finalArr.push([arr1[0], arr2[0]]);

  var remainingArr1 = arr1.slice(1),
      remainingArr2 = arr2.slice(1);

  // If both arrays are empty, then we're done
  if(remainingArr1.length === 0 &amp;&amp; remainingArr2.length === 0) {
    return finalArr;
  }
  else {
    // Recursion!
    return combineArrays(remainingArr1, remainingArr2, finalArr);
  }
};

var processed = combineArrays(averageTemps, populations);
</code></pre>
<p>Or, because one-liners are fun:</p>
<pre><code class="language-javascript">var processed = combineArrays(pluck(data, 'temperatures').map(averageForArray), pluck(data, 'population'));

// [
//  [ 55.25, 2047 ],
//  [ 5.5, 3568 ],
//  [ 75, 1000000 ]
// ]
</code></pre>
<h3 id="lets-get-real">Let's Get Real <a href="#lets-get-real" aria-label="Link to section 'Let's Get Real'" class="sr hsl">Link</a></h3>
<p>Last but not least, let's look at one more real-world example, this time adding to our functional toolbelt with <a href="http://underscorejs.org/">Underscore.js</a><sup class="po" id="note-19"><a href="#19">19</a></sup>, a JavaScript library that provides a number of great functional programming helpers. We'll pull data from a platform for conflict and disaster information that I've been working on named <a title="CrisisNET from Ushahidi" href="http://crisis.net">CrisisNET</a><sup class="po" id="note-20"><a href="#20">20</a></sup>, and we'll use the fantastic <a title="D3 JavaScript library" href="http://d3js.org">D3</a><sup class="po" id="note-21"><a href="#21">21</a></sup> library to visualize that data.</p>
<p>The goal is to give people coming to CrisisNET's home page a quick snapshot of the types of information in the system. To demonstrate this, we could count the number of documents from the API that are assigned to a particular category, like "physical violence" or "armed conflict." This way, the user can see how much information is available on the topics they find most interesting.</p>
<p>A bubble chart might be a good fit, because they are often used to represent the relative sizes of large groups of people. Fortunately, D3 has a built-in visualization named <code>pack</code> for just this purpose. So, let's create a graph with <code>pack</code> that shows the number of times that a given category's name appears in a response from CrisisNET's API.</p>
<p>Before we go on, note that D3 is a complex library that warrants its own tutorial (or many tutorials, for that matter). Because this article is focused on functional programming, we won't spend a lot of time on how D3 works. But don't worry — if you're not already familiar with the library, you should be able to copy and paste the code snippets specific to D3 and dig into the details another time. <a title="D3 tutorials" href="http://alignedleft.com/tutorials/d3">Scott Murray's D3 tutorials</a><sup class="po" id="note-22"><a href="#22">22</a></sup> are a great resource if you're interested in learning more.</p>
<p>Moving along, let's first make sure we have a DOM element, so that D3 has some place to put the chart it will generate with our data.</p>
<pre><code class="language-markup">&lt;div id="bubble-graph"&gt;&lt;/div&gt;
</code></pre>
<p>Now, let's create our chart and add it to the DOM.</p>
<pre><code class="language-javascript">// width of chart
var diameter = 960, 
    format = d3.format(",d"),
    // creates an ordinal scale with 20 colors. See D3 docs for hex values
    color = d3.scale.category20c(),

// chart object to which we'll be adding data
var bubble = d3.layout.pack()
  .sort(null)
  .size([diameter, diameter])
  .padding(1.5);

// Add an SVG to the DOM that our pack object will use to draw the 
// visualization.
var svg = d3.select("#bubble-graph").append("svg")
  .attr("width", diameter)
  .attr("height", diameter)
  .attr("class", "bubble");
</code></pre>
<p>The <code>pack</code> object takes an array of objects in this format:</p>
<pre><code class="language-javascript">{
  children: [
    {
      className: ,
      package: "cluster",
      value: 
    }
  ]
}
</code></pre>
<p>CrisisNET's data API returns information in this format:</p>
<pre><code class="language-javascript">{
  data: [
    {
      summary: "Example summary",
      content: "Example content",
      …
      tags: [
        {
          name: "physical-violence",
          confidence: 1
        }
      ]
    }
  ]
}
</code></pre>
<p>We see that each document has a <code>tags</code> property, and that property contains an array of items. Each tag item has a <code>name</code> property, which is what we're after. We need to find each unique tag name in CrisisNET's API response and count the number of times that tag name appears. Let's start by isolating the information we need using the <code>pluck</code> function that we created earlier.</p>
<pre><code class="language-javascript">var tagArrays = pluck(data, 'tags');
</code></pre>
<p>This gives us an array of arrays, like this:</p>
<pre><code class="language-javascript">[
  [
    {
      name: "physical-violence",
      confidence: 1
    }
  ],
  [
    {
      name: "conflict",
      confidence: 1
    }
  ]
]
</code></pre>
<p>However, what we really want is one array with every tag in it. So, let's use a handy function from Underscore.js named <a title="flatten method Underscore.js" href="http://underscorejs.org/#flatten">flatten</a><sup class="po" id="note-23"><a href="#23">23</a></sup>. This will take values from any nested arrays and give us an array that is one level deep.</p>
<pre><code class="language-javascript">var tags = _.flatten(tagArrays);
</code></pre>
<p>Now, our array is a little easier to deal with:</p>
<pre><code class="language-javascript">[
  {
    name: "physical-violence",
    confidence: 1
  },
  {
    name: "conflict",
    confidence: 1
  }
]
</code></pre>
<p>We can use <code>pluck</code> again to get the thing we really want, which is a simple list of only the tag names.</p>
<pre><code class="language-javascript">var tagNames = pluck(tags, 'name');

[
  "physical-violence",
  "conflict"
]
</code></pre>
<p>Ah, that's better.</p>
<p>Now we're down to the relatively straightforward tasks of counting the number of times each tag name appears in our list and then transforming that list into the structure required by the D3 <code>pack</code> layout that we created earlier. As you've probably noticed, arrays are a pretty popular data structure in functional programming — most of the tools are designed with arrays in mind. As a first step, then, we'll create an array like this:</p>
<pre><code class="language-javascript">[
  [ "physical-violence", 10 ],
  [ "conflict", 27 ]
]
</code></pre>
<p>Here, each item in the array has the tag name at index <code>0</code> and that tag's total count at index <code>1</code>. We want only one array for each unique tag name, so let's start by creating an array in which each tag name appears only once. Fortunately, an Underscore.js method exists just for this purpose.</p>
<pre><code class="language-javascript">var tagNamesUnique = _.uniq(tagNames);
</code></pre>
<p>Let's also get rid of any <code>false-y</code> (<code>false</code>, <code>null</code>, <code>""</code>, etc.) values using another handy Underscore.js function.</p>
<pre><code class="language-javascript">tagNamesUnique = _.compact(tagNamesUnique);
</code></pre>
<p>From here, we can write a function that generates our arrays using another built-in JavaScript collection method, named <a title="JavaScript filter method" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a><sup class="po" id="note-24"><a href="#24">24</a></sup>, that filters an array based on a condition.</p>
<pre><code class="language-javascript">function makeArrayCount(keys, arr) {
  
  // for each of the unique tagNames
  return keys.map(function(key) {
    return [
      key,
      // Find all the elements in the full list of tag names that match this key
      // and count the size of the returned array.
      arr.filter(function(item) { return item === key; }).length
    ]
  });

}
</code></pre>
<p>We can now easily create the data structure that <code>pack</code> requires by mapping our list of arrays.</p>
<pre><code class="language-javascript">var packData = makeArrayCount(tagNamesUnique, tagNames).map(function(tagArray) {
  return {
    className: tagArray[0],
    package: "cluster",
    value: tagArray[1]
  }
});
</code></pre>
<p>Finally, we can pass our data to D3 and generate DOM nodes in our SVG, one circle for each unique tag name, sized relative to the total number of times that tag name appeared in CrisisNET's API response.</p>
<pre><code class="language-javascript">function setGraphData(data) {
  var node = svg.selectAll(".node")
    // Here's where we pass our data to the pack object.
    .data(bubble.nodes(data)
    .filter(function(d) { return !d.children; }))
    .enter().append("g")
    .attr("class", "node")
    .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  // Append a circle for each tag name.
  node.append("circle")
    .attr("r", function(d) { return d.r; })
    .style("fill", function(d) { return color(d.className); });

  // Add a label to each circle, using the tag name as the label's text
  node.append("text")
    .attr("dy", ".3em")
    .style("text-anchor", "middle")
    .style("font-size", "10px")
    .text(function(d) { return d.className } ); 
}
</code></pre>
<p>Putting it all together, here's the <code>setGraphData</code> and <code>makeArray</code> functions in context, including a call to CrisisNET's API using jQuery (you'll need to <a href="http://api.crisis.net">get an API key</a><sup class="po" id="note-25"><a href="#25">25</a></sup>). I've also posted a <a href="https://github.com/gati/lilfunc/blob/master/smashing.html">fully working example on GitHub</a><sup class="po" id="note-26"><a href="#26">26</a></sup>.</p>
<pre><code class="language-javascript">function processData(dataResponse) {
  var tagNames = pluck(_.flatten(pluck(dataResponse.data, 'tags')), 'name');
  var tagNamesUnique = _.uniq(tagNames);

  var packData = makeArrayCount(tagNamesUnique, tagNames).map(function(tagArray) {
    return {
      className: tagArray[0],
      package: "cluster",
      value: tagArray[1]
    }
  });

  return packData;
}

function updateGraph(dataResponse) {
  setGraphData(processData(dataResponse));
}

var apikey = // Get an API key here: http://api.crisis.net
var dataRequest = $.get('http://api.crisis.net/item?limit=100&amp;apikey=' + apikey);

dataRequest.done( updateGraph );
</code></pre>
<p>That was a pretty deep dive, so congratulations on sticking with it! As I mentioned, these concepts can be challenging at first, but resist the temptation to hammer out <code>for</code> loops for the rest of your life.</p>
<p>Within a few weeks of using functional programming techniques, you'll quickly build up a set of simple, reusable functions that will dramatically improve the readability of your applications. Plus, you'll be able to manipulate data structures significantly more quickly, knocking out what used to be 30 minutes of frustrating debugging in a couple lines of code. Once your data has been formatted correctly, you'll get to spend more time on the fun part: making the visualization look awesome!</p>
<p><em>(al, il)</em></p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-61" name="t-61"></a><h1>61 : Classes, Inheritance And Mixins In JavaScript</h1>
					<div class="tutorial__content">
<div class="post">
    
    <p>JavaScript doesn't have native support for classes.  Functions can be used to simulate classes (somewhat), but in general JavaScript is a class-less language.  Everything is an object.  This makes inheritance particularly strange, since objects inherit from objects, not classes from classes as in languages like Ruby or Java.</p>

<p>CoffeeScript does have support for classes though - that is to say, <code>class</code> is a keyword.  So how does that work, if JavaScript doesn't have classes?  (CoffeeScript just compiles down to JavaScript, so it's not a superset of the language - it merely adds some syntactical sugar)</p>

<h4 id="classes-in-coffeescript-and-javascript">Classes in CoffeeScript and JavaScript</h4>

<p>This CoffeeScript 'class'</p>

<pre><code>class Person
  constructor: (@name, @birthday) -&gt;

  age: -&gt;
    moment().diff(@birthday, 'years')</code></pre>

<p>is equivalent to this JavaScript:</p>

<pre><code>Person = (function() {
  function Person(name1, birthday1) {
    this.name = name1;
    this.birthday = birthday1;
  }

  Person.prototype.age = function() {
    return moment().diff(this.birthday, 'years');
  };

  return Person;
})();</code></pre>

<p>This is one pattern for defining classes in JavaScript - creating a named function and adding methods to the prototype of the function.  (The other two common patterns are using an object literal and declaring a singleton function)</p>

<p>When defining a class with this pattern (either in CoffeeScript or JavaScript) the function actually behaves very similar to classes in other languages.</p>

<pre><code>bob = new Person("Bob", new Date(1980,4,1))
bob.name   # Bob
bob.age()  # 34</code></pre>

<p>(The JavaScript for this code looks exactly the same, just add some semicolons!)</p>

<p>CoffeeScript also allows us to have inheritance between classes.  So how does <strong>that</strong> work, if we just said that JavaScript doesn't really have classes (just functions) and that objects inherit from objects, not classes from classes?</p>

<h4 id="class-inheritance-in-coffeescript-and-javascript">Class Inheritance in CoffeeScript and JavaScript</h4>

<p>Let's add some inheritance to our CoffeeScript 'class'.</p>

<pre><code>class Person
  constructor: (@name, @birthday) -&gt;

  age: -&gt;
    moment().diff(@birthday, 'years')

class Employee extends Person
  constructor: (name, birthday, @company) -&gt;
    super(name, birthday)

  email: -&gt;
    "#{@name}@#{@company.replace(/ /g,"")}.com".toLowerCase()</code></pre>

<p>Here is the equivalent JavaScript (I have reformatted the output from the CoffeeScript compiler to make it a bit more readable).</p>

<pre><code>var extend = function(child, parent) {
  for (var key in parent) {
    if (hasProp.call(parent, key)) child[key] = parent[key];
  }

  function ctor() {
    this.constructor = child;
  }

  ctor.prototype = parent.prototype;
  child.prototype = new ctor();
  child.__super__ = parent.prototype;
  return child;
}
var hasProp = {}.hasOwnProperty;

var Person = (function() {
  function Person(name1, birthday1) {
    this.name = name1;
    this.birthday = birthday1;
  }

  Person.prototype.age = function() {
    return moment().diff(this.birthday, 'years');
  };

  return Person;

})();

var Employee = (function(superClass) {
  extend(Employee, superClass);

  function Employee(name, birthday, company) {
    this.company = company;
    Employee.__super__.constructor.call(this, name, birthday);
  }

  Employee.prototype.email = function() {
    return (this.name + "@" + (this.company.replace(/ /g, "")) + ".com").toLowerCase();
  };

  return Employee;

})(Person);</code></pre>

<p>That is some pretty intense JavaScript, but the magic is happening in the <code>extend</code> function.  There are 2 types of methods that need to be inherited from the parent - methods defined on the parent itself (we can think of these as class methods) and methods defined on the prototype of the parent (we can think of these as instance methods).</p>

<p>The first thing that happens is that all the class methods on the parent are added to the child (note - <strong>not</strong> to the prototype of the child).  This concept is pretty simple - since functions in JavaScript are objects, we can effectively loop through all the functions of the parent class (function) and add them to the child class (function).</p>

<pre><code>for (var key in parent) {
  if (hasProp.call(parent, key)) child[key] = parent[key];
}</code></pre>

<p>A special constructor function (called <code>ctor</code>) is then created to act as the prototype of the child class.  CoffeeScript does a lot of work here just to enable us to call <code>super</code> when we override parent methods in the child.  (<code>super</code> is treated as a keyword and CoffeeScript does some additional magic in order to make it all work)</p>

<pre><code>function ctor() {
  this.constructor = child;
}

ctor.prototype = parent.prototype;
child.prototype = new ctor();
child.__super__ = parent.prototype;</code></pre>

<p>As I mentioned earlier, in JavaScript objects inherit from objects (instead of classes from classes).  We can therefore set the prototype for the child class (function) to an instance of the <code>ctor</code> function - because they're both just objects.  Any new instances of the child class will also have the same prototype and because the <code>ctor</code> function has the parent class as a prototype we are effectively using normal prototypal inheritance with an additional level of indirection - all to enable calls to <code>super</code> (which is actually really useful).</p>

<pre><code>employee = new Employee("Steve", new Date(1975,7,15), "JavaScript Inc")
employee.name     # Steve
employee.age()    # 39
employee.email()  # steve@javascriptinc.com</code></pre>

<p>So if CoffeeScript (and as a result, JavaScript) can fake classes with functions and inheritance with functions, could it fake <a href="https://en.wikipedia.org/wiki/Mixin">mixins</a>?</p>

<h4 id="mixins-in-coffeescript-and-javascript">Mixins in CoffeeScript and JavaScript</h4>

<p>In order to implement mixins in CoffeeScript (or JavaScript), we would effectively need to copy the functions from one class (function) into another.  As we have seen with the <code>extend</code> function that CoffeeScript uses for inheritance, copying functions between classes is actually rather easy.</p>

<p>I'm referring to the first part of the <code>extend</code> function:</p>

<pre><code>for (var key in parent) {
  if (hasProp.call(parent, key)) child[key] = parent[key];
}</code></pre>

<p>Let's look at how we might implement mixins in CoffeeScript:</p>

<pre><code>class Person
  constructor: (@name, @birthday) -&gt;

  age: -&gt;
    moment().diff(@birthday, 'years')

class Manager
  @title: -&gt;
    "Mr. #{@name}"

class Employee extends Person
  for key of Manager
    @::[key] = Manager[key] if Manager.hasOwnProperty(key)

  constructor: (name, birthday, @company) -&gt;
    super(name, birthday)

  email: -&gt;
    "#{@name}@#{@company.replace(/ /g,"")}.com".toLowerCase()</code></pre>

<p>Within the Employee class (function) I am simply looping through all the properties on the Manager class (function) and assigning them to the prototype of the Employee class.</p>

<p>This might seem strange until you consider that this is exactly how we have been declaring methods on classes all along!</p>

<pre><code>class Person
  constructor: (@name, @birthday) -&gt;

  age: -&gt;
    moment().diff(@birthday, 'years')</code></pre>

<p>In this example the <code>age</code> method compiles down to this JavaScript:</p>

<pre><code>Person.prototype.age = function() {
  return moment().diff(this.birthday, 'years');
};</code></pre>

<p>This is equivalent to how I am assigning the mixin methods - this piece of CoffeeScript:</p>

<pre><code>Person::age = -&gt;
  moment().diff(@birthday, 'years')</code></pre>

<p>Is again equivalent to the same JavaScript:</p>

<pre><code>Person.prototype.age = function() {
  return moment().diff(this.birthday, 'years');
};</code></pre>

<p>So this pattern really allows us to assign methods to our 'class' in exactly the same way as we did before.  The only difference is that our Manager 'class' (in Ruby we would call this a module) assigns functions directly to the Manager 'class', instead of to the propotype.  This makes perfect sense, since we don't necessarily want to have to create an instance of the Manager 'class' in order to use it as a mixin in the Employee 'class'.</p>

<p>There is a very strong similarity to how mixins behave in Ruby, except this is actually a bit cleaner.  In Ruby a mixin is actually injected in the inheritance chain, where in JavaScript the function is directly assigned to the class.</p>

<h4 id="why-do-we-need-mixins">Why do we need Mixins?</h4>

<p>I started playing around with mixins in CoffeeScript because I became frustrated with sharing code via inheritance.  When the only way to share code between classes is inheritance, you can easily end up with inheritance where it doesn't really make sense.  (When all you have is a hammer, everything looks like a nail!)</p>

<p>This pattern would at the very least provide an alternative to inheritance - which is clearly not always the best solution.  You can find all the <a href="http://plnkr.co/edit/XwN6RPidyOhe9ZcEV5mN?p=preview">code on Plunker</a>.  Happy coding.</p>

  </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-62" name="t-62"></a><h1>62 : JavaScript Mixins: Beyond Simple Object Extension</h1>
					<div class="tutorial__content">
<div class="entry-content">
						<p>Mixins are generally easy in JavaScript, though they are semantically different than <a href="http://www.ruby-doc.org/docs/ProgrammingRuby/html/tut_modules.html">what Ruby calls a Mixin</a> which are facilitated through inheritance behind the scenes. If you need a good place to start to understand how to build mixins with JavaScript, Chris Missal has been writing up a series on different ways of <a href="http://lostechies.com/chrismissal/2012/09/27/extending-objects-with-javascript/">extending objects in JavaScript</a>. I highly recommend reading his series. It's full of great tips.&nbsp;</p>
<h2>Object Extension Is A Poor Man's Mixin</h2>
<p>I love the "extend" methods of <a href="http://api.jquery.com/jQuery.extend/">jQuery</a> and <a href="http://underscorejs.org/#extend">Underscore</a>. I use them a lot. They're powerful and simple and make it easy to transfer data and behavior from one object to another -- the essence of a mixin. But in spite of my love of underscore.js and jQuery's "extend" methods, there's a problem with them in that they apply every attribute from one or more source objects to a target objects.&nbsp;</p>
<p>You can see the effect of this in <a href="http://lostechies.com/chrismissal/2012/10/05/extending-objects-in-underscore/">Chris' underscore example</a>:</p>
<pre><code>var start = {
    id: 123,
    count: 41,
    desc: 'this is information',
    title: 'Base Object',
    tag: 'uncategorized',
    values: [1,1,2,3,5,8,13]
};
var more = {
    name: 'Los Techies',
    tag: 'javascript'
};
var extra = {
    count: 42,
    title: null,
    desc: undefined,
    values: [1,3,6,10]
};

var extended = _.extend(start, more, extra);
console.log(JSON.stringify(extended));</code></pre>
<noscript>
&amp;lt;pre&amp;gt;&amp;lt;code class="language-javascript javascript"&amp;gt;var start = {
    id: 123,
    count: 41,
    desc: 'this is information',
    title: 'Base Object',
    tag: 'uncategorized',
    values: [1,1,2,3,5,8,13]
};
var more = {
    name: 'Los Techies',
    tag: 'javascript'
};
var extra = {
    count: 42,
    title: null,
    desc: undefined,
    values: [1,3,6,10]
};

var extended = _.extend(start, more, extra);
console.log(JSON.stringify(extended));&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
&amp;lt;pre&amp;gt;&amp;lt;code class="language-javascript javascript"&amp;gt;{
    &amp;amp;quot;id&amp;amp;quot;: 123,
    &amp;amp;quot;count&amp;amp;quot;: 42,
    &amp;amp;quot;title&amp;amp;quot;: null,
    &amp;amp;quot;tag&amp;amp;quot;: &amp;amp;quot;javascript&amp;amp;quot;,
    &amp;amp;quot;values&amp;amp;quot;: [1,3,6,10],
    &amp;amp;quot;name&amp;amp;quot;: &amp;amp;quot;Los Techies&amp;amp;quot;
}&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
&amp;lt;p&amp;gt;</noscript>
<p>In this example, the first object contains a key named "values" and the third object also contains a key named "values". When the extend method is called, the last one in wins. This means that the "values" from the third object end up being the values on the final target object.</p>
<p>So, what happens if we want to mix two behavioral sets in to one target object, but both of those behavior sets use the same underlying "values", or "config", or "bindings" (as reported in <a href="https://github.com/marionettejs/backbone.marionette/issues/269">this Marionette issue</a>)? One or both of them will break, and that's definitely not a good thing.</p>
<h2>A Problem Of Context</h2>
<p>The good news is there's an easy way to solve the mixin problem with JavaScript: only copy the methods you need from the behavior set in to the target.</p>
<p>That is, if the object you want to mix in to another has a method called "doSomething", you shouldn't be forced to copy the "config" and "_whatever" and "foo" and all the other methods and attributes off this object just to get access to the "doSomething" method. Instead, you should only have to copy the "doSomething" method from the behavior source to your target.</p>
<pre><code>var foo = {
  doSomething: function(){
    // ...
  }
}

var bar = {};
bar.doSomething = foo.doSomething;</code></pre>
<pre><code>var foo = {
  doSomething: function(){
    // ...
  }
}

var bar = {};
bar.doSomething = foo.doSomething;</code></pre>
<noscript>
&amp;lt;pre&amp;gt;&amp;lt;code class="language-javascript javascript"&amp;gt;var foo = {
  doSomething: function(){
    // ...
  }
}

var bar = {};
bar.doSomething = foo.doSomething;&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
&amp;lt;p&amp;gt;</noscript>
<p>But this poses it's own challenge: the source of the behavior likely calls "this.config" and "this._whatever()" and other context-based methods and attributes to do it's work. Simply copying the "doSomething" function from one object to another won't work because the context of the function will change and the support methods / data won't be found.</p>
<p>[Note: For more detail on context and how it changes, check out my <a href="http://www.watchmecode.net/javascript-context">JavaScript Context screencast</a>.]</p>
<h2>Solving The Mixin Problem</h2>
<p>To fix the mixin problem then, we need to do two things:&nbsp;</p>
<ol>
<li>Only copy the methods we need to the target</li>
<li>Ensure the copied methods retain their original context when executing</li>
</ol>
<p>This is easier than it sounds. We've already seen how requirement #1 can be solved, and requirement #2 can be handled in a number of ways, including the raw <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind">ECMAScript 5 "bind"</a> method, the use of <a href="http://underscorejs.org/#bind">Underscore's "bind"</a> method, writing our own, or by using one of a number of other shims and plugins.</p>
<p>The way to facilitate a mixin from one object to another, then, looks something like this:</p>
<pre><code>var foo = {
  baz: function(){ 
    // ...
  },

  config: [ ... ]
}

var bar = {
  config: { ... }
};

// ECMAScript "bind"
bar.baz = foo.baz.bind(foo);

// Undescore "bind"
bar.baz = _.bind(foo.baz, foo);

// ... many more options</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>var foo = {
  baz: function(){ 
    // ...
  },

  config: [ ... ]
}

var bar = {
  config: { ... }
};

// ECMAScript "bind"
bar.baz = foo.baz.bind(foo);

// Undescore "bind"
bar.baz = _.bind(foo.baz, foo);

// ... many more options</code></pre>
<noscript>
&amp;lt;pre&amp;gt;&amp;lt;code class="language-javascript javascript"&amp;gt;var foo = {
  baz: function(){ 
    // ...
  },

  config: [ ... ]
}

var bar = {
  config: { ... }
};

// ECMAScript &amp;amp;quot;bind&amp;amp;quot;
bar.baz = foo.baz.bind(foo);

// Undescore &amp;amp;quot;bind&amp;amp;quot;
bar.baz = _.bind(foo.baz, foo);

// ... many more options&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
&amp;lt;p&amp;gt;</noscript>
<p>In this example, both the source object and the target object have a "config" attribute. Each object needs to use that config attribute to store and retrieve certain bits of data without clobbering each the other one, but I still want the "baz" function to be available directly on the "foo" object. To make this all work, I assign a bound version of the "baz" function to foo where the binding is set to to the bar object. That way whenever the baz function is called from foo, it will always run in the context of the original source -- bar.&nbsp;</p>
<h2>A Real Example</h2>
<p>Ok, enough "foo, bar, baz" nonsense. Let's look at a real example of where I'm doing this: Marionette's use of Backbone.EventBinder. I want to bring the "bindTo", "unbindFrom" and "unbindAll" methods from the EventBinder in to Marionette's Application object, as one example. To do this while allowing the EventBinder to manage it's own internal state and implementation details, I use the above technique of assigning the methods as bound functions:</p>
<pre><code>Marionette.addEventBinder = function(target){

  // create the "source" of the functionality i need
  var eventBinder = new Marionette.EventBinder();

  // add the methods i need to the target object, binding them correctly
  target.bindTo = _.bind(eventBinder.bindTo, eventBinder);
  target.unbindFrom = _.bind(eventBinder.unbindFrom, eventBinder);
  target.unbindAll = _.bind(eventBinder.unbindAll, eventBinder);
};



// use the mixin method
var myApp = new Marionette.Application();
Marionette.addEventBinder(myApp);</code></pre>
<link rel="stylesheet" href="https://assets-cdn.github.com/assets/gist-embed-9f0a4ad9c85ca776e669003688baa9d55f9db315562ce4d231d37dab2714c70a.css"><pre><code>Marionette.addEventBinder = function(target){

  // create the "source" of the functionality i need
  var eventBinder = new Marionette.EventBinder();

  // add the methods i need to the target object, binding them correctly
  target.bindTo = _.bind(eventBinder.bindTo, eventBinder);
  target.unbindFrom = _.bind(eventBinder.unbindFrom, eventBinder);
  target.unbindAll = _.bind(eventBinder.unbindAll, eventBinder);
};



// use the mixin method
var myApp = new Marionette.Application();
Marionette.addEventBinder(myApp);</code></pre>
<noscript>
&amp;lt;pre&amp;gt;&amp;lt;code class="language-javascript javascript"&amp;gt;Marionette.addEventBinder = function(target){

  // create the &amp;amp;quot;source&amp;amp;quot; of the functionality i need
  var eventBinder = new Marionette.EventBinder();

  // add the methods i need to the target object, binding them correctly
  target.bindTo = _.bind(eventBinder.bindTo, eventBinder);
  target.unbindFrom = _.bind(eventBinder.unbindFrom, eventBinder);
  target.unbindAll = _.bind(eventBinder.unbindAll, eventBinder);
};



// use the mixin method
var myApp = new Marionette.Application();
Marionette.addEventBinder(myApp);&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
&amp;lt;p&amp;gt;</noscript>
<p>Now when I call any of those three methods from my application instance, they still run in the context of my eventBinder object instance and they can access all of their internal state, configuration and behavior. But at the same time, I can worry less about whether or not the implementation details of the EventBinder are going to clobber the implementation details of the Application object. Since I'm being very explicit about which methods and attributes are brought over from the EventBinder, I can spend the small amount of cognitive energy that I need to determine whether or not the method I'm creating on the Application instance already exists. I don't have to worry about the internal details like "_eventBindings" and other bits because they are not going to be copied over.</p>
<h2>Simplifying Mixins</h2>
<p>Given the repetition of creating mixins like this, it should be pretty easy to create a function that can handle the grunt work for you. All you need to supply is a target object, a source object and a list of methods to copy. The mixin function can handle the rest:</p>

<pre><code>// build a mixin function to take a target that receives the mixin, 
// a source that is the mixin, and a list of methods / attributes to
// copy over to the target

function mixInto(target, source, methodNames){

  // ignore the actual args list and build from arguments so we can
  // be sure to get all of the method names
  var args = Array.prototype.slice.apply(arguments);
  target = args.shift();
  source = args.shift();
  methodNames = args;

  var method;
  var length = methodNames.length;
  for(var i = 0; i &lt; length; i++){
    method = methodNames[i];

    // bind the function from the source and assign the
    // bound function to the target
    target[method] = _.bind(source[method], source);
  }

}


// make use of the mixin function
var myApp = new Marionette.Application();
mixInto(myApp, Marionette.EventBinder, "bindTo", "unbindFrom", "unbindAll");</code></pre>
<noscript>
&amp;lt;pre&amp;gt;&amp;lt;code class="language-javascript javascript"&amp;gt;// build a mixin function to take a target that receives the mixin, 
// a source that is the mixin, and a list of methods / attributes to
// copy over to the target

function mixInto(target, source, methodNames){

  // ignore the actual args list and build from arguments so we can
  // be sure to get all of the method names
  var args = Array.prototype.slice.apply(arguments);
  target = args.shift();
  source = args.shift();
  methodNames = args;

  var method;
  var length = methodNames.length;
  for(var i = 0; i &amp;amp;lt; length; i++){
    method = methodNames[i];

    // bind the function from the source and assign the
    // bound function to the target
    target[method] = _.bind(source[method], source);
  }

}


// make use of the mixin function
var myApp = new Marionette.Application();
mixInto(myApp, Marionette.EventBinder, &amp;amp;quot;bindTo&amp;amp;quot;, &amp;amp;quot;unbindFrom&amp;amp;quot;, &amp;amp;quot;unbindAll&amp;amp;quot;);&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
&amp;lt;p&amp;gt;</noscript>
<p>This should be functionally equivalent to the previous code that was manually binding and assigning the methods. But keep in mind that this code is not robust at all. Bad things will happen if you get the source's method names wrong, for example. These little details should be handled in a more complete mixin function.</p>
<h2>An Alternate Implementation: Closures</h2>
<p>An alternate implementation for this can be facilitated without the use of a "bind" function. Instead, a simple closure can be set up around the source object, with a wrapper function that simply forwards calls to the source:</p>
<pre><code>// build a mixin function to take a target that receives the mixin, 
// a source that is the mixin, and a list of methods / attributes to
// copy over to the target

function mixInto(target, source, methodNames){

  // ignore the actual args list and build from arguments so we can
  // be sure to get all of the method names
  var args = Array.prototype.slice.apply(arguments);
  target = args.shift();
  source = args.shift();
  methodNames = args;

  var method;
  var length = methodNames.length;
  for(var i = 0; i &lt; length; i++){
    method = methodNames[i];

    // build a function with a closure around the source
    // and forward the method call to the source, passing
    // along the method parameters and setting the context
    target[method] = function(){
      var args = Array.prototype.slice(arguments);
      source[method].apply(source, args);
    }

  }

}


// make use of the mixin function
var myApp = new Marionette.Application();
mixInto(myApp, Marionette.EventBinder, "bindTo", "unbindFrom", "unbindAll");</code></pre>
<noscript>
&amp;lt;pre&amp;gt;&amp;lt;code class="language-javascript javascript"&amp;gt;// build a mixin function to take a target that receives the mixin, 
// a source that is the mixin, and a list of methods / attributes to
// copy over to the target

function mixInto(target, source, methodNames){

  // ignore the actual args list and build from arguments so we can
  // be sure to get all of the method names
  var args = Array.prototype.slice.apply(arguments);
  target = args.shift();
  source = args.shift();
  methodNames = args;

  var method;
  var length = methodNames.length;
  for(var i = 0; i &amp;amp;lt; length; i++){
    method = methodNames[i];

    // build a function with a closure around the source
    // and forward the method call to the source, passing
    // along the method parameters and setting the context
    target[method] = function(){
      var args = Array.prototype.slice(arguments);
      source[method].apply(source, args);
    }

  }

}


// make use of the mixin function
var myApp = new Marionette.Application();
mixInto(myApp, Marionette.EventBinder, &amp;amp;quot;bindTo&amp;amp;quot;, &amp;amp;quot;unbindFrom&amp;amp;quot;, &amp;amp;quot;unbindAll&amp;amp;quot;);&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;
&amp;lt;p&amp;gt;</noscript>
<p>I'm not sure if this version is really "better" or not, but it would at least provide more backward compatibility support and fewer requirements. You wouldn't need to patch 'Function.prototype.bind' or use a third party shim or library for older browsers. It should work with any browser that supports JavaScript, though I'm not sure how far back it would go. Chances are, though, that any browser people are still using would be able to handle this, including -- dare I say it? -- IE6 (maybe… I think… I'm not going to test that, though :P )</p>
<h2>Potential Drawbacks</h2>
<p>As great as all this looks and sounds, there are some limitations and drawbacks -- and probably more than I'm even aware of right now.&nbsp;</p>
<p>We're directly manipulating the context of the functions with this solution. While this has certainly provided a measured benefit, it can be dangerous. There may be (are likely) times that you just don't want to mess with context -- namely when you aren't in control of the function context in the first place. Think about a jQuery function callback, for example. Typically, jQuery sets the context of a callback to the DOM element that was being manipulated and you might not want to mess with that.</p>
<p>In the case of my EventBinder with Marionette, I did run in to a small problem with the context binding. The original version of the code would default the context of callback functions to the object that "bindTo" was called from. This meant the callback for "myView.bindTo(…)" would be run with "myView" as the context. When I switched over to the above code that creates the bound functions, the default context changed. Instead of being the view, the context was set to the EventBinder instance itself, just like our code told it to. This had an effect on how my Marionette views were behaving and I had to work around that problem in another way.</p>
<p>There certainly some potential drawbacks to this, as noted. But if you understand that danger and you don't try to abuse this for absolutely everything, I think this idea could work out pretty well as a way to produce a mixin system that really does favor composition over inheritance, and avoids the pitfalls of simple object extension.</p>
											</div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-63" name="t-63"></a><h1>63 : Beautiful Mixins</h1>
					<div class="tutorial__content">
<section data-type="chapter" epub:type="chapter" class="pagenumrestart" data-pdf-bookmark="CHAPTER ONEBeautiful Mixins"><div class="chapter" id="idm169456">
<h2 class="label">CHAPTER ONE</h2>
<h2>Beautiful Mixins</h2>


<p class="byline">Angus Croll</p>
<blockquote>
<p>Developers love to create overly complex solutions to things that aren't really problems.</p>
<p data-type="attribution">Thomas Fuchs</p>
</blockquote>

<p><a data-type="indexterm" data-primary="Fuchs, Thomas" id="idm157616"></a>In the beginning there was code, and the code was verbose, so we invented functions that the code might be reused. But after a while there were also too many functions, so we looked for a way to reuse those too. Developers often go to great lengths to apply "proper" reuse techniques to JavaScript. But sometimes when we try too hard to do the right thing, we miss the beautiful thing right in front of our eyes.</p>






<section data-type="sect1" data-pdf-bookmark="Classical Inheritance"><div class="sect1" id="idp39264">
<h2>Classical Inheritance</h2>

<p><a data-type="indexterm" data-primary="classical inheritance" id="idp40400"></a>Many developers schooled in Java, C++, Objective-C, and Smalltalk arrive at JavaScript with an almost religious belief in the necessity of the class hierarchy as an organizational tool. Yet humans are not good at classification. Working backward from an abstract superclass toward real types and behaviors is unnatural and restrictive—a superclass must be created before it can be extended, yet classes closer to the root are by nature more generic and abstract and are more easily defined <em>after</em> we have more knowledge of their concrete subclasses. Moreover, the need to tightly couple types <em>a priori</em> such that one type is always defined solely in terms of another tends to lead to an overly rigid, brittle, and often ludicrous model ("Is a button a rectangle or is it a control? Tell you what, let's make <code>Button</code> inherit from <code>Rectangle</code>, and <code>Rectangle</code> can inherit from <code>Control</code>…no, wait a minute…"). If we don't get it right early on, our system is forever burdened with a flawed set of relationships—and on those rare occasions that, by chance or genius, we do get it right, anything but a minimal tree structure usually represents too complex a mental model for us to readily visualize.</p>

<p>Classical inheritance is appropriate for modeling existing, well-understood <span class="keep-together">hierarchies—</span>it's okay to unequivocally declare that a <code>FileStream</code> is a type of <code>InputStream</code>. But if the primary motivation is function reuse (and it usually is), classical hierarchies can quickly become gnarly labyrinths of meaningless subtypes, frustrating redundancies, and unmanageable logic.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Prototypes"><div class="sect1" id="idp47584">
<h2>Prototypes</h2>

<p><a data-type="indexterm" data-primary="prototypes" id="idp49184"></a>It's questionable whether the majority of behaviors can ever be mapped to objectively "right" classifications. And indeed, the classical inheritance lobby is countered by an equally fervent band of JavaScript <em>loyalists</em> who proclaim that JavaScript is a prototypal, not classical, language and is deeply unsuited to any approach that includes the word <em>class</em>. But what does "prototypal" mean, and how do prototypes differ from classes?</p>

<p><a data-type="indexterm" data-primary="differential inheritance" id="idp51472"></a>In generic programming terms, a prototype is an object that supplies base behavior to a second object. The second object can then extend this base behavior to form its own specialization. This process, also known as <em>differential inheritance</em>, differs from classical inheritance in that it doesn't require explicit typing (static or dynamic) or attempt to formally define one type in terms of another. <a data-type="indexterm" data-primary="prototypal inheritance" id="idm53984"></a>While classical inheritance is planned reuse, true prototypal inheritance is opportunistic.<a data-type="indexterm" data-primary="Taivalsaari, Antero" id="idm53072"></a></p>
<blockquote>
<p>In general, when working with prototypes, one typically chooses not to categorize but to exploit alikeness.</p>
<p data-type="attribution">Antero Taivalsaari, Nokia Research Center</p>
</blockquote>

<p>In JavaScript, every object references a prototype object from which it can inherit properties. JavaScript prototypes are great instruments for reuse: a single prototype instance can define properties for an infinite number of dependent instances. Prototypes may also inherit from other prototypes, thus forming prototype chains.</p>

<p>So far, so good. But, with a view to emulating Java, JavaScript tied the <code>prototype</code> property to the constructor. As a consequence, more often than not, multilevel object inheritance is achieved by chaining constructor-prototype couplets. The standard implementation of a JavaScript prototype chain is too grisly to appear in a book about beautiful JavaScript, but suffice it to say, creating a new instance of a base prototype in order to define the initial properties of its inheritor is neither graceful nor intuitive. The alternative—manually copying properties between prototypes and then meddling with the <code>constructor</code> property to fake real prototypal inheritance—is even less <span class="keep-together">becoming</span>.</p>

<p>Syntactic awkwardness aside, constructor-prototype chaining requires upfront planning and results in structures that more closely resemble the traditional hierarchies of classical languages than a true prototypal relationship: constructors represent types (classes), each type is defined as a subtype of one (and only one) supertype, and all properties are inherited via this type chain. The ES6 <code>class</code> keyword merely formalizes the existing semantics. Leaving aside the gnarly and distinctly unbeautiful syntax characteristic in constructor-prototype chains, traditional JavaScript is clearly less prototypal than some would claim.</p>

<p>In an attempt to support less rigid, more opportunistic prototypes, the ES5 specification introduced <code>Object.create</code>. This method allows a prototype to be assigned to an object directly and therefore liberates JavaScript prototypes from constructors (and thus categorization) so that, in theory, an object can acquire behavior from any other arbitrary object and be free from the constraints of typecasting:</p>

<pre><code>var circle = Object.create({
  area: function() {
    return Math.PI * this.radius * this.radius;
  },
  grow: function() {
    this.radius++;
  },
  shrink: function() {
    this.radius--;
  }
});</code></pre>

<p><code>Object.create</code> accepts an optional second argument representing the object to be extended. Sadly, instead of accepting the object itself (in the form of a literal, variable, or argument), the method expects a full-blown <code>meta</code> property definition:</p>

<pre><code>var circle = Object.create({
  /*see above*/
}, {
  radius: {
    writable:true, configurable:true, value: 7
  }
});</code></pre>

<p>Assuming no one actually uses these unwieldy beasts in real code, all that remains is to manually assign properties to the instance after it has been created. Even then, the <code>Object.create</code> syntax still only enables an object to inherit the properties of a single prototype. In real scenarios, we often want to acquire behavior from multiple prototype objects: for example, a person can be an employee and a manager.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Mixins"><div class="sect1" id="idp48208">
<h2>Mixins</h2>

<p><a data-type="indexterm" data-primary="mixins" id="ix_1-Beautiful-Mixins-Angus-Croll-asciidoc0"></a>Fortunately, JavaScript offers viable alternatives to inheritance chaining. In contrast to objects in more rigidly structured languages, JavaScript objects can invoke any function property regardless of lineage. In other words, JavaScript functions don't need to be inheritable to be visible—and with that simple observation, the entire justification for inheritance hierarchies collapses like a house of cards.</p>

<p>The most basic approach to function reuse is manual delegation—any public function can be invoked directly via <code>call</code> or <code>apply</code>. It's a powerful and easily overlooked feature. However, aside from the verbosity of serial <code>call</code> or <code>apply</code> directives, such delegation is so convenient that, paradoxically, it sometimes actually works against structural discipline in your code—the invocation process is sufficiently ad hoc that in theory there is no need for developers to organize their code at all.</p>

<p>Mixins are a good compromise: by encouraging the organization of functionality along thematic lines they offer something of the descriptive prowess of the class hierarchy, yet they are light and flexible enough to avoid the premature organization traps (and head-spinning dizziness) associated with deeply chained, single-ancestry models. Better still, mixins require minimal syntax and play very well with unchained JavaScript prototypes.</p>








<section data-type="sect2" data-pdf-bookmark="The Basics"><div class="sect2" id="idp10363664">
<h2>The Basics</h2>

<p><a data-type="indexterm" data-primary="mixins" data-secondary="traditional definition" id="idp10364864"></a>Traditionally, a mixin is a class that defines a set of functions that would otherwise be defined by a concrete entity (a person, a circle, an observer). However, mixin classes are considered abstract in that they will not themselves be instantiated—instead, their functions are copied (or <em>borrowed</em>) by concrete classes as a means of inheriting behavior without entering into a formal relationship with the behavior provider.</p>

<p><a data-type="indexterm" data-primary="mixins" data-secondary="JavaScript definition" id="idp10367088"></a>Okay, but this is JavaScript, and we have no classes per se. This is actually a good thing because it means we can use objects (instances) instead, which offer clarity and flexibility: our mixin can be a regular object, a prototype, a function, whatever, and the mixin process becomes transparent and obvious.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="The Use Case"><div class="sect2" id="idp10368768">
<h2>The Use Case</h2>

<p><a data-type="indexterm" data-primary="mixins" data-secondary="use case schematic" id="idp10369936"></a>I'm going to discuss a number of mixin techniques, but all the coding examples are directed toward one use case: creating circular, oval, or rectangular buttons (something that would not be readily possible using conventional classical inheritance techniques). Here's a schematic representation: square boxes represent mixin objects, and rounded boxes represent the actual buttons.</p>

<figure><div class="figure">
<img src="https://www.safaribooksonline.com/library/view/beautiful-javascript/9781449371142/assets/bujs_01in01.png" alt="Button reuse plan" width="1304" height="664">
<h6></h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Classic Mixins"><div class="sect2" id="idp10373232">
<h2>Classic Mixins</h2>

<p><a data-type="indexterm" data-primary="mixins" data-secondary="classic" id="idp10374672"></a>Scanning the first two pages returned from a Google search for "javascript mixin," I noticed the majority of authors define the mixin object as a full-blown constructor type with its function set defined in the prototype. This could be seen as a natural progression—early mixins were classes, and this is the closest thing JavaScript has to a class. Here's a circle mixin modeled after that style:</p>

<pre><code>var Circle = function() {};
Circle.prototype = {
  area: function() {
    return Math.PI * this.radius * this.radius;
  },
  grow: function() {
    this.radius++;
  },
  shrink: function() {
    this.radius--;
  }
};</code></pre>

<p>In practice, however, such a heavyweight mixin is unnecessary. A simple object literal will suffice:</p>

<pre><code>var circleFns = {
  area: function() {
    return Math.PI * this.radius * this.radius;
  },
  grow: function() {
    this.radius++;
  },
  shrink: function() {
    this.radius--;
  }
};</code></pre>

<p>Here's another mixin defining button behavior (for the sake of demonstration, I've substituted a simple log call for the working implementation of some function <span class="keep-together">properties</span>):</p>

<pre><code>var clickableFns = {
  hover: function() {
    console.log('hovering');
  },
  press: function() {
    console.log('button pressed');
  },
  release: function() {
    console.log('button released');
  },
  fire: function() {
    this.action.fire();
  }
};</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="The extend Function"><div class="sect2" id="idp10522080">
<h2>The extend Function</h2>

<p><a data-type="indexterm" data-primary="extend function" id="idp10439664"></a><a data-type="indexterm" data-primary="mixins" data-secondary="and extend function" id="idp10440592"></a>How does a mixin object get mixed into your object? <a data-type="indexterm" data-primary="augmentation (extend function)" id="idp10441664"></a>By means of an <code>extend</code> function (sometimes known as <em>augmentation</em>). Usually <code>extend</code> simply copies (not clones) the mixin's functions into the receiving object. A quick survey reveals some minor variations in this implementation. For example, the Prototype.js framework omits a <code>hasOwnProperty</code> check (suggesting the mixin is not expected to have enumerable properties in its prototype chain), while other versions assume you want to copy only the mixin's prototype object. Here's a version that is both safe and flexible:</p>

<pre><code>function extend(destination, source) {
  for (var key in source) {
    if (source.hasOwnProperty(key)) {
      destination[key] = source[key];
    }
  }
  return destination;
}</code></pre>

<p>Now let's extend a base prototype with the two mixins we created earlier to make a <code>RoundButton.prototype</code>:</p>

<pre><code>var RoundButton = function(radius, label) {
  this.radius = radius;
  this.label = label;
};

extend(RoundButton.prototype, circleFns);
extend(RoundButton.prototype, clickableFns);

var roundButton = new RoundButton(3, 'send');
roundButton.grow();
roundButton.fire();</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Functional Mixins"><div class="sect2" id="idp10656928">
<h2>Functional Mixins</h2>

<p><a data-type="indexterm" data-primary="functional mixins" id="idp10683616"></a><a data-type="indexterm" data-primary="mixins" data-secondary="functional" id="idp10684320"></a>If the functions defined by mixins are intended solely for the use of other objects, why bother creating mixins as regular objects at all? Isn't it more intuitive to think of mixins as processes instead of objects? Here are the circle and button mixins rewritten as functions. We use the context (<code>this</code>) to represent the mixin's target object:</p>

<pre><code>var withCircle = function() {
  this.area = function() {
    return Math.PI * this.radius * this.radius;
  };
  this.grow = function() {
    this.radius++;
  };
  this.shrink = function() {
    this.radius--;
  };
};

var withClickable = function() {
  this.hover = function() {
    console.log('hovering');
  };
  this.press = function() {
    console.log('button pressed');
  };
  this.release = function() {
    console.log('button released');
  };
  this.fire = function() {
    this.action.fire();
  };
}</code></pre>

<p>And here's our <code>RoundButton</code> constructor. We'll want to apply the mixins to <span class="keep-together"><code>RoundButton.prototype</code></span>:</p>

<pre><code>var RoundButton = function(radius, label, action) {
    this.radius = radius;
    this.label = label;
    this.action = action;
};</code></pre>

<p>Now the target object can simply inject itself into the functional mixin by means of <code>Function.prototype.call</code>, cutting out the middleman (the <code>extend</code> function) entirely:</p>

<pre><code>withCircle.call(RoundButton.prototype);
withClickable.call(RoundButton.prototype);

var button1 = new RoundButton(4, 'yes!', function() {return 'you said yes!'});
button1.fire(); //'you said yes!'</code></pre>

<p>This approach feels right. Mixins as verbs instead of nouns; lightweight one-stop function shops. There are other things to like here too. The programming style is natural and concise: <code>this</code> always refers to the receiver of the function set instead of an abstract object we don't need and will never use; moreover, in contrast to the traditional approach, we don't have to protect against inadvertent copying of inherited properties, and (for what it's worth) functions are now cloned instead of copied.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Adding Options"><div class="sect2" id="idp10921328">
<h2>Adding Options</h2>

<p><a data-type="indexterm" data-primary="mixins" data-secondary="and options argument" id="idp10922288"></a>This functional strategy also allows mixed in behaviors to be parameterized by means of an <code>options</code> argument. The following example creates a <code>withOval</code> mixin with a custom grow and shrink factor:</p>

<pre><code>var withOval = function(options) {
  this.area = function() {
    return Math.PI * this.longRadius * this.shortRadius;
  };
  this.ratio = function() {
    return this.longRadius/this.shortRadius;
  };
  this.grow = function() {
    this.shortRadius += (options.growBy/this.ratio());
    this.longRadius += options.growBy;
  };
  this.shrink = function() {
    this.shortRadius -= (options.shrinkBy/this.ratio());
    this.longRadius -= options.shrinkBy;
  };
}

var OvalButton = function(longRadius, shortRadius, label, action) {
  this.longRadius = longRadius;
  this.shortRadius = shortRadius;
  this.label = label;
  this.action = action;
};

withButton.call(OvalButton.prototype);
withOval.call(OvalButton.prototype, {growBy: 2, shrinkBy: 2});

var button2 = new OvalButton(3, 2, 'send', function() {return 'message sent'});
button2.area(); //18.84955592153876
button2.grow();
button2.area(); //52.35987755982988
button2.fire(); //'message sent'</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Adding Caching"><div class="sect2" id="idp10924752">
<h2>Adding Caching</h2>

<p><a data-type="indexterm" data-primary="caching" data-secondary="mixins and" id="idp10926000"></a><a data-type="indexterm" data-primary="functional mixins" id="idp10926976"></a><a data-type="indexterm" data-primary="mixins" data-secondary="and caching" id="idp11202640"></a>You might be concerned that this approach creates additional performance overhead because we're redefining the same functions on every call. Bear in mind, however, that when we're applying functional mixins to prototypes, the work only needs to be done once: during the definition of the constructors. The work required for instance creation is unaffected by the mixin process, since all the behavior is preassigned to the shared prototype. This is how we support all function sharing on the <em>twitter.com</em> site, and it produces no noticeable latency. Moreover, it's worth noting that performing a classical mixin requires property getting as well as setting, and in fact <a data-type="indexterm" data-primary="Chrome browser" id="idp11204800"></a>functional mixins appear to benchmark quicker in the Chrome browser than traditional ones (although this is obviously subject to considerable variance).</p>

<p>That said, it is possible to optimize functional mixins further. By forming a closure around the mixins we can cache the results of the initial definition run, and the performance improvement is impressive. Functional mixins now easily outperform classic mixins in every browser.</p>

<p>Here's a version of the <code>withRectangle</code> mixin with added caching:</p>

<pre><code>var withRectangle = (function() {
  function area() {
    return this.length * this.width;
  }
  function grow() {
    this.length++, this.width++;
  }
  function shrink() {
    this.length--, this.width--;
  }
  return function() {
    this.area = area;
    this.grow = grow;
    this.shrink = shrink;
    return this;
  };
})();

var RectangularButton = function(length, width, label, action) {
  this.length = length;
  this.width = width;
  this.label = label;
  this.action = action;
}

withClickable.call(RectangularButton.prototype);
withRectangle.call(RectangularButton.prototype);

var button3 =
  new RectangularButton(4, 2, 'delete', function() {return 'deleted'});
button3.area(); //8
button3.grow();
button3.area(); //15
button3.fire(); //'deleted'</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Advice"><div class="sect2" id="idp11208720">
<h2>Advice</h2>

<p><a data-type="indexterm" data-primary="advice mixins" id="idp11210160"></a><a data-type="indexterm" data-primary="mixins" data-secondary="and advice" id="idp11210864"></a>One danger with any kind of mixin technique is that a mixin function will accidentally overwrite a property of the target object that, coincidentally, has the same name. <a data-type="indexterm" data-primary="Flight (Twitter framework)" id="idp11623120"></a>Twitter's Flight framework, which makes use of functional mixins, guards against clobbering by temporarily locking existing properties (using the <code>writable</code> meta property) during the mixin process.</p>

<p>Sometimes, however, instead of generating a collision error we might want the mixin to augment the corresponding method on the target object. <code>advice</code> redefines a function by adding custom code before, after, or around the original implementation. The <a href="http://underscorejs.org/">Underscore framework</a> implements a basic function wrapper that enables <code>advice</code>:</p>

<pre><code>button.press = function() {
  mylib.appendClass('pressed');
};

//after pressing button, reduce shadow (using underscore)
button.pressWithShadow = _.wrap(button.press, function(fn) {
  fn();
  button.reduceShadow();
}</code></pre>

<p>The Flight framework takes this a stage further: now the <code>advice</code> object is itself a <a href="http://bit.ly/advice_flight">functional mixin</a> that can be mixed into target objects to enable advice for subsequent <span class="keep-together">mixins</span>.</p>

<p>Let's use this <code>advice</code> mixin to augment our rectangular button actions with shadow behavior. First we apply the <code>advice</code> mixin, followed by the two mixins we used earlier:</p>

<pre><code>withAdvice.call(RectangularButton.prototype);
withClickable.call(RectangularButton.prototype);
withRectangle.call(RectangularButton.prototype);</code></pre>

<p>And now the <code>withShadow</code> mixin that will take advantage of the <code>advice</code> mixin:</p>

<pre><code>var withShadow = function() {
  this.after('press', function() {
    console.log('shadow reduced');
  };
  this.after('release', function() {
    console.log('shadow reset');
  };
};

withShadow.call(RectangularButton.prototype);
var button4 = new RectangularButton(5, 4);
button4.press(); //'button pressed' 'shadow reduced'
button4.release(); //'button released' 'shadow reset'</code></pre>

<p>The Flight framework sugarcoats this process. All flight components get <code>withAdvice</code> mixed in for free, and there's also a <code>defineComponent</code> method that accepts multiple mixins at a time. So, if we were using Flight we could further simplify the process (in Flight, constructor properties such as rectangle dimensions are defined as <code>attr</code> properties in the mixins):</p>

<pre><code>var RectangularButton =
  defineComponent(withClickable, withRectangle, withShadow);
var button5 = new RectangularButton(3, 2);
button5.press(); //'button pressed' 'shadow reduced'
button5.release(); //'button released' 'shadow reset'</code></pre>

<p>With <code>advice</code> we can define functions on mixins without having to guess whether they're also implemented on the target object, so the mixin can be defined in isolation (perhaps by another vendor). Conversely, <code>advice</code> allows us to augment third-party library functions without resorting to monkey patching.</p>
</div></section>

</div></section>

<section data-type="sect1" data-pdf-bookmark="Wrapup"><div class="sect1" id="idp10357504">
<h2>Wrapup</h2>
<blockquote>
  <p>When possible, cut with the grain. The grain tells you which direction the wood <em>wants</em> to be cut. If you cut against the grain, you're just making more work for yourself, and making it more likely you'll spoil the cut.</p>
  <p data-type="attribution">Charles Miller<sup><a data-type="noteref" id="idp11954832-marker" href="ch01.html#idp11954832">1</a></sup></p>
</blockquote>
<!--[Charles has asked that we link to the blog where he made this quote in a footnote or endnote http://fishbowl.pastiche.org/2004/04/04/cut_with_the_grain/]-->

<p><a data-type="indexterm" data-primary="Miller, Charles" id="idp11957024"></a><a data-type="indexterm" data-primary="classical inheritance" data-secondary="mixins vs." id="idp11957728"></a><a data-type="indexterm" data-primary="mixins" data-secondary="classical inheritance vs." id="idp11958672"></a>As programmers, we're encouraged to believe that certain techniques are indispensable. Ever since the early 1990s, object-oriented programming has been hot, and classical inheritance has been its poster child. It's not hard to see how a developer eager to master a new language would feel under considerable pressure to fit classical inheritance under the hood.</p>

<p>But peer pressure is not an agent of beautiful code, and neither is serpentine logic. When you find yourself writing <code>Circle.prototype.constructor = Circle</code>, ask yourself if the pattern is serving you, or you're serving the pattern. The best patterns tread lightly on your process and don't interfere with your ability to use the full power of the <span class="keep-together">language</span>.</p>

<p>By repeatedly defining an object solely in terms of another, classical inheritance establishes a series of tight couplings that glue the hierarchy together in an orgy of mutual dependency. Mixins, in contrast, are extremely agile and make very few organizational demands on your codebase—mixins can be created at will, whenever a cluster of common, shareable behavior is identified, and all objects can access a mixin's functionality regardless of their role within the overall model. Mixin relationships are entirely ad hoc: any combination of mixins can be applied to any object, and objects can have any number of mixins applied to them. Here, at last, is the opportunistic reuse that prototypal inheritance promised us.<a data-type="indexterm" data-startref="ix_1-Beautiful-Mixins-Angus-Croll-asciidoc0" id="idp11820272"></a></p>
</div></section>

<div data-type="footnotes"><p data-type="footnote" id="idp11954832"><sup><a href="ch01.html#idp11954832-marker">1</a></sup> See Charles Miller's entire post at his blog, <a href="http://bit.ly/cut_with_the_grain">The Fishbowl</a>.</p></div></div></section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-64" name="t-64"></a><h1>64 : JavaScript and Functional Programming</h1>
					<div class="tutorial__content">
<span>https://bethallchurch.github.io/JavaScript-and-Functional-Programming/</span>
<div class="entry">
    <p class="description">This is a write up of my notes (plus some further research) from Kyle Simpson's excellent class <b>Functional-Light JavaScript</b> (slides <a href="https://speakerdeck.com/getify/functional-light-javascript">here</a>) on 29 of June, 2016.</p>

<p>Object-oriented programming has long been the dominant paradigm in JavaScript. Recently, however, there has been a growing interest in functional programming. Functional programming is a style of programming that emphasises minimising the number of changes to a program's state (known as <em>side effects</em>). To this end, it encourages the use of <em>immutable</em> data and <em>pure</em> (side effect-free) functions. It also favours a <em>declarative</em> style and encourages the use of well-named functions that allow you to write programs by describing what you want to happen, with the implementation details packaged away out of immediate sight.</p>

<p>Although there are tensions between object-oriented and functional approaches, they are not mutually exclusive. JavaScript has the tools to support both paradigms. Even without using it exclusively as a functional language, there are concepts and best practices from the functional approach that we can use to make our own code cleaner, more readable, and easier to reason about.</p>

<h2 id="minimise-side-effects">Minimise Side Effects</h2>

<p>A <em>side effect</em> is a change that is not local to the function that caused it. A function might do something like manipulate the DOM, modify the value of a variable in a higher level scope or write data to a database. The results of these actions are side effects.</p>

<div class="language-javascript highlighter-rouge"><pre><code>// A function with a side effect
var x = 10;

const myFunc = function ( y ) {
  x = x + y;
};

myFunc( 3 );
console.log( x ); // 13

myFunc( 3 );
console.log( x ); // 16
</code></pre>
</div>

<p>Side effects are not inherently evil. A program that produced no side effects would not affect the world, and so there would be no point to it (other than perhaps as a theoretical curiousity). They are, however, dangerous and should be avoided wherever they are not strictly necessary.</p>

<p>When a function produces a side effect you have to know more than just its inputs and output to understand what that function does. You need to know about the context and history of the state of the program, which makes the function harder to understand. Side effects can cause bugs by interacting in unpredictable ways, and the functions that produce them are harder to test thanks to their reliance on the context and history of the program's state.</p>

<p>Minimising side effects is such a fundamental principle of functional programming that most of the following sections can be understood as outlining techniques to avoid them.</p>

<h2 id="treat-data-as-immutable">Treat Data as Immutable</h2>

<p>A mutation is an in-place change to a value. An immutable value is a value that, once created, can never be changed. In JavaScript, simple values like numbers, strings and booleans are immutable. However, data structures like objects and arrays are mutable.</p>

<div class="language-javascript highlighter-rouge"><pre><code>// the push method mutates the array it's called on
const x = [1, 2];
console.log( x ); // [1, 2]

x.push( 3 );
console.log( x ); // [1, 2, 3]
</code></pre>
</div>

<p>Why would we want to avoid mutating data?</p>

<p>A mutation is a side effect. The fewer things that change in a program, the less there is to keep track of, and the result is a simpler program.</p>

<p>JavaScript only has limited tools available to enforce immutability on data structures like objects and arrays. Object immutability can be enforced with <code class="highlighter-rouge">Object.freeze</code>, but only one level deep:</p>

<div class="language-javascript highlighter-rouge"><pre><code>const frozenObject = Object.freeze( { valueOne : 1, valueTwo : { nestedValue : 1 } } );
frozenObject.valueOne = 2; // not allowed
frozenObject.valueTwo.nestedValue = 2; // allowed!
</code></pre>
</div>

<p>There are, however, several excellent libraries out there that solve this issue, the most well-known of which is <a href="https://facebook.github.io/immutable-js/">Immutable</a>.</p>

<p>For most applications, using a library to enforce immutability is overkill. In most cases you will gain most of the benefits of immutable data simply by treating data as though it were immutable.</p>

<h3 id="avoiding-mutations-arrays">Avoiding Mutations: Arrays</h3>

<p>Array methods in JavaScript can broadly be divided into <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype#Mutator_methods">mutator methods</a> and non-mutator methods. Mutator methods should be avoided where possible.</p>

<p>For example, <code class="highlighter-rouge">concat</code> can be used instead of <code class="highlighter-rouge">push</code>. <code class="highlighter-rouge">push</code> mutates the original array, whereas <code class="highlighter-rouge">concat</code> returns a new array comprised of the array it was called on and the array provided as its argument, leaving the original array intact.</p>

<div class="language-javascript highlighter-rouge"><pre><code>// push mutates arrays.
const arrayOne = [1, 2, 3];
arrayOne.push( 4 );

console.log( arrayOne ); // [1, 2, 3, 4]

// concat creates a new array and leaves the original unchanged.
const arrayTwo = [1, 2, 3];
const arrayThree = arrayTwo.concat([ 4 ]);

console.log( arrayTwo ); // [1, 2, 3]
console.log( arrayThree ); // [1, 2, 3, 4]
</code></pre>
</div>

<p>Other useful non-mutator array methods include <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code class="highlighter-rouge">map</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code class="highlighter-rouge">filter</code></a>, and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce"><code class="highlighter-rouge">reduce</code></a>.</p>

<h3 id="avoiding-mutations-objects">Avoiding Mutations: Objects</h3>

<p>Instead of directly editing objects, you can use <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign"><code class="highlighter-rouge">Object.assign</code></a>, which copies the properties of source objects into a target object and then returns it. If you always use an empty object as the target object, you can use <code class="highlighter-rouge">Object.assign</code> to avoid directly editing objects.</p>

<div class="language-javascript highlighter-rouge"><pre><code>const objectOne = { valueOne : 1 };
const objectTwo = { valueTwo : 2 };

const objectThree = Object.assign( {}, objectOne, objectTwo );

console.log( objectThree ); // { valueOne : 1, valueTwo : 2 }
</code></pre>
</div>

<h3 id="note-on-const">Note on <code class="highlighter-rouge">const</code></h3>

<p><code class="highlighter-rouge">const</code> is useful, but it does not make your data immutable. It prevents your variables from being reassigned. These two things should not be conflated.</p>

<div class="language-javascript highlighter-rouge"><pre><code>const x = 1;
x = 2; // not allowed

const myArray = [1, 2, 3];
myArray = [0, 2, 3]; // not allowed

myArray[0] = 0; // allowed!
</code></pre>
</div>

<h2 id="write-pure-functions">Write Pure Functions</h2>

<p>A <em>pure function</em> is a function that does not change the program's state and does not produce an observable side effect. The output of a pure function relies solely on its input values. Wherever and whenever a pure function is called, its return value will always be the same when given the same inputs.</p>

<p>Pure functions are an important tool for keeping side effects to a minimum. In addition, their indifference to context make them highly testable and reusable.</p>

<p><code class="highlighter-rouge">myFunc</code> from the section on side effects is an impure function: note how it's called twice with the same input and gives a different result each time. It could, however, be re-written as a pure function:</p>

<div class="language-javascript highlighter-rouge"><pre><code>// Make the global variable local.
const myFunc = function ( y ) {
  const x = 10;
  return x + y;
}

console.log(myFunc( 3 )); // 13
console.log(myFunc( 3 )); // 13
</code></pre>
</div>

<div class="language-javascript highlighter-rouge"><pre><code>// Pass x as an argument.
const x = 10;

const myFunc = function ( x, y ) {
  return x + y;
}

console.log(myFunc( x, 3 )); // 13
console.log(myFunc( x, 3 )); // 13
</code></pre>
</div>

<p>Ultimately, your program will always produce some side effects. Where they occur they should be handled carefully and their effects constrained and contained as much as possible.</p>

<h2 id="write-function-generating-functions">Write Function-Generating Functions</h2>

<p>Find someone who has never programmed before and ask them to guess what the following pieces of code do.</p>

<p>Example One:</p>

<div class="language-javascript highlighter-rouge"><pre><code>const numbers = [1, 2, 3];

for ( let i = 0; i &lt; numbers.length; i++ ) {
  console.log( numbers[i] );
}
</code></pre>
</div>

<p>Example Two:</p>

<div class="language-javascript highlighter-rouge"><pre><code>const numbers = [1, 2, 3];

const print = function ( input ) {
  console.log( input );
};

numbers.forEach( print );
</code></pre>
</div>

<p>Everyone I've tried this test on has had more luck with the second example. Example One exemplifies an <em>imperative</em> approach to printing out a list of numbers. Example Two exemplifies a <em>declarative</em> approach. By packaging away the details of how to loop through an array and how to print to the console into the functions <code class="highlighter-rouge">forEach</code> and <code class="highlighter-rouge">print</code>, respectively, we can express <em>what</em> we want our program to do without needing to go into <em>how</em> to do it. This makes for highly readable code. The last line of Example Two is very close to English.</p>

<p>Adopting this approach involves writing a lot of functions. This process can be made <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>-er by writing functions to generate new functions from existing ones.</p>

<p>There are two features of JavaScript in particular that make this kind of function generation possible. The first is <em>closure</em>. Closure is the ability of functions to access variables from containing scopes, even when those scopes no longer exist. The second is that JavaScript treats functions as values. This makes it possible to write <em>higher-order functions</em>, which are functions that take other functions as arguments and / or return functions as their output.</p>

<p>Combined, these features allow you to write functions that return other functions which "remember" the arguments passed to the function that generated them, and are able to use those arguments elsewhere in the program.</p>

<h3 id="function-composition">Function Composition</h3>

<p>Functions can be combined to form new functions through <em>function composition</em>. Here is an example:</p>

<div class="language-javascript highlighter-rouge"><pre><code>// The function addThenSquare is made by combining the functions add and square.
const add = function ( x, y ) {
  return x + y;	
};

const square = function ( x ) {
  return x * x;
};

const addThenSquare = function ( x, y ) {
  return square(add( x, y ));
};
</code></pre>
</div>

<p>You may find yourself repeating this pattern of generating a more complex function from smaller functions. Often it's more efficient to write a function that does the composition for you:</p>

<div class="language-javascript highlighter-rouge"><pre><code>const add = function ( x, y ) {
  return x + y;	
};

const square = function ( x ) {
  return x * x;
};

const composeTwo = function ( f, g ) {
  return function ( x, y ) {
    return g( f ( x, y ) );	
  };
};

const addThenSquare = composeTwo( add, square );
</code></pre>
</div>

<p>You could go even further and write a more general composition functions:</p>

<div class="language-javascript highlighter-rouge"><pre><code>// This version of composeTwo can accept any number of arguments for the initial function.
const composeTwo = function ( f, g ) {
  return function ( ...args ) {
    return g( f( ...args ) );
  };
};

// composeMany can accept any number of functions as well as any number of arguments for the 
// initial function.
const composeMany = function ( ...args ) {
  const funcs = args;
  return function ( ...args ) {
    funcs.forEach(( func ) =&gt; {
      args = [func.apply( this, args )]; 
    });
    return args[0];
  };
};
</code></pre>
</div>

<p>The exact form of your composition function will depend on the level of generality you need and the kind of API you prefer.</p>

<h3 id="partial-function-application">Partial Function Application</h3>

<p><em>Partial function application</em> is the process of fixing the value of one or more of a function's arguments, and then returning the function to be fully invoked later.</p>

<p>In the following example, <code class="highlighter-rouge">double</code>, <code class="highlighter-rouge">triple</code>, and <code class="highlighter-rouge">quadruple</code> are partial applications of <code class="highlighter-rouge">multiply</code>.</p>

<div class="language-javascript highlighter-rouge"><pre><code>const multiply = function ( x, y ) {
  return x * y;
};

const partApply = function ( fn, x ) {
  return function ( y ) {
    return fn( x, y );
  };
};

const double = partApply( multiply, 2 );
const triple = partApply( multiply, 3 );
const quadruple = partApply( multiply, 4 );
</code></pre>
</div>

<h3 id="currying">Currying</h3>

<p><em>Currying</em> is the process of translating a function that takes multiple arguments into a series of functions that each take one argument.</p>

<div class="language-javascript highlighter-rouge"><pre><code>const multiply = function ( x, y ) {
  return x * y;
};

const curry = function ( fn ) {
  return function ( x ) {
    return function ( y ) {
      return fn( x, y );
    };
  };	
};

const curriedMultiply = curry( multiply );

const double = curriedMultiply( 2 );
const triple = curriedMultiply( 3 );
const quadruple = curriedMultiply( 4 );

console.log(triple( 6 )); // 18
</code></pre>
</div>

<p>Currying and partial application are conceptually similar (and you'll probably never need both), but still distinct. The main difference is that currying will always produce a nested chain of functions that each accept only one argument, whereas partial application can return functions that accept more than one argument. This distinction is clearer when you compare their effects on functions that accept at least three arguments:</p>

<div class="language-javascript highlighter-rouge"><pre><code>const multiply = function ( x, y, z ) {
	return x * y * z;	
};

const curry = function ( fn ) {
  return function ( x ) {
    return function ( y ) {
      return function ( z ) {
        return fn( x, y, z );
      };
    };
  };	
};

const partApply = function ( fn, x ) {
  return function ( y, z ) {
    return fn( x, y, z );
  };
};

const curriedMultiply = curry( multiply );
const partiallyAppliedMultiply = partApply( multiply, 10 );

console.log(curriedMultiply( 10 )( 5 )( 2 )); // 100
console.log(partiallyAppliedMultiply( 5, 2 )); // 100
</code></pre>
</div>

<h2 id="recursion">Recursion</h2>

<p>A <em>recursive</em> function is a function that calls itself until it reaches a base condition. Recursive functions are highly declarative. They're also elegant and very satisfying to write!</p>

<p>Here's an example of a function that recursively calculates the factorial of a number:</p>

<div class="language-javascript highlighter-rouge"><pre><code>const factorial = function ( n ) {
  if ( n === 0 ) {
    return 1;
  }
  return n * factorial( n - 1 );
};

console.log(factorial( 10 )); // 3628800
</code></pre>
</div>

<p>Using recursive functions in JavaScript requires some care. Every function call adds a new call frame to the call stack, and that call frame is popped off the call stack when the function returns. Recursive functions call themselves before they return, and so it's very easy for a recursive function to exceed the limits of the call stack and crash the program.</p>

<p>However, this can be avoided with <em>tail call optimisation</em>.</p>

<h3 id="tail-call-optimisation">Tail Call Optimisation</h3>

<p>A tail call is a function call that is the last action of a function. Tail call optimisation is when the language compiler recognises tail calls and reuses the same call frame for them. This means that if you write recursive functions with tail calls, the limits of the call stack will never be exceeded by them as it will reuse the same frame over and over.</p>

<p>Here is the recursive function from above rewritten to take advantage of tail call optimisation:</p>

<div class="language-javascript highlighter-rouge"><pre><code>const factorial = function ( n, base ) {
  if ( n === 0 ) {
    return base;
  }
  base *= n;
  return factorial( n - 1, base );
};

console.log(factorial( 10, 1 )); // 3628800
</code></pre>
</div>

<p>Support for proper tail calls is included in the <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-tail-position-calls">ES2015 language specification</a>, but is currently unsupported in most environments. You can check whether you can use them <a href="https://kangax.github.io/compat-table/es6/">here</a>.</p>

<h2 id="summary">Summary</h2>

<p>Functional programming contains many ideas that we can use to make our own code simpler and better. Pure functions and immutable data minimise the hazards of side effects. Declarative programming maximises code readability. These are important tools that should be embraced in the fight against complexity.</p>

<h2 id="corrections">Corrections</h2>

<ul>
  <li>[09-09-2016] Forgot to return the innermost function in <code class="highlighter-rouge">partApply</code>, in the section on partial function application. Thank you to Richard Bultitude for spotting the mistake!</li>
</ul>

  </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-65" name="t-65"></a><h1>65 : Functional programming with Javascript</h1>
					<div class="tutorial__content">
<span>https://stephen-young.me.uk/2013/01/20/functional-programming-with-javascript.html</span>
<article class="article">
			
			
			<p>This post will discuss what functional programming is, how it compares to object-oriented programming and how you can program functionally in Javascript.</p>

<h2 id="themes-of-functional-programming">Themes of functional programming</h2>

<p>Throughout the examples and concepts discussed in this post there are three key themes:</p>

<ul>
  <li>Computation as the application of functions</li>
  <li>Statelessness</li>
  <li>Avoiding side effects</li>
</ul>

<h3 id="computation-as-the-application-of-functions">Computation as the application of functions</h3>

<p>Object-oriented programming also uses functions but functional programming is unique in that functions are values (the technical term for this is that functions are "first class"). You can store functions in variables, return them as the value of other functions and pass them in as arguments to other functions. As a result functional programs produce answers by applying these functions in different ways.</p>

<h3 id="statelessness">Statelessness</h3>

<p>Programming languages have the notion of "state". This is a snapshot of a program's current environment: all the variables that have been declared, functions created and what is currently being executed.</p>

<p>An expression in a programming language can be "stateful" or "stateless". A stateful expression is one that changes a program's current environment. A very simple example in Javascript would be incrementing a variable by 1:</p>

<pre><code>var number = 1;
var increment = function() {
    return number += 1;
};
increment();
</code></pre>

<p>A stateless expression, on the other hand, is one that does not modify a program's environment:</p>

<pre><code>var number = 1;
var increment = function(n) {
    return n + 1;
};
increment(number);
</code></pre>

<p>Unlike the previous example when we call <code>increment</code> here we do not change the value of <code>number</code> we merely return a new value.</p>

<p>Object-oriented programming works by changing program state to produce answers. Conversely, functional programming produces answers through stateless operations. The clearest contrast can be seen in how both methodologies handle looping. An object-oriented approach would be to use a <code>for</code> loop:</p>

<pre><code>var loop = function() {
    for (var x = 0; x &lt; 10; x += 1) {
        console.log(x);
    }
};
loop();
</code></pre>

<p>The loop produces its results by constantly changing the value of <code>x</code>. A functional approach would involve recursion (covered in more detail later on):</p>

<pre><code>var loop = function(n) {
    if (n &gt; 9) {
        console.log(n);
        return;
    } else {
        console.log(n);
        loop(n + 1);
    }
};
loop(0);
</code></pre>

<p>In this case we get our results by calling the <code>loop</code> function each time with a new value rather than modifying the program's state.</p>

<p>So, functional programming requires us to write stateless expressions and keep our data immutable.</p>

<h3 id="avoiding-side-effects">Avoiding side effects</h3>

<p>When a function executes it can change a program's state aside from returning a value:</p>

<pre><code>var number = 2;
var sideEffect = function(n) {
    number = n * 3;
    return number * n;
};
sideEffect(3);
</code></pre>

<p>The side effect of this function is that it changes the value of <code>number</code> each time it executes. Functional programming promotes the use of "pure functions": functions that have no side effects. In the example above changing the value of <code>number</code> would be disallowed under this paradigm. If we can always write functions that have no side effects our program becomes "referentially transparent". This means if we input the same value into a program we will always get the same result.</p>

<p>The example above is not referentially transparent because if we always called <code>sideEffect</code> with 3 we would get a different result each time.</p>

<h2 id="pure-functional-programming-in-javascript">Pure functional programming in Javascript</h2>

<p>If we wanted to program in a pure functional manner in Javascript we can set the following rules:</p>

<ul>
  <li>No assignment i.e. changing the value of something already created with <code>=</code> (<code>var</code> statements with <code>=</code> are fine)</li>
  <li>No <code>for</code> or <code>while</code> loops (use recursion instead)</li>
  <li>Freeze all objects and arrays (since modifying an existing object or array would be a stateful expression)</li>
  <li>Disallow <code>Date</code> (since it always produces a new value no matter what the inputs are)</li>
  <li>Disallow <code>Math.random</code> (same reason as <code>Date</code>)</li>
</ul>

<h2 id="why-program-functionally">Why program functionally?</h2>

<p>After looking at the themes of functional programming and the rules we need to set to ensure we can write pure programs, it may seem like we need to jump through a lot of hoops just to get anything done. Indeed functional programming does look inferior when faced with environments that are constantly in flux. This is particularly true of the DOM (one of Javascript's main interactions) which can constantly change through insertions, deletions, animations etc. In fact the creators of the Haskell programming language developed <a href="http://www.haskell.org/haskellwiki/Monad">Monads</a> as a way of managing changing state but retaining functional purity (Douglas Crockford also gave a talk on <a href="http://www.youtube.com/watch?v=dkZFtimgAcM">implementing Monad's in Javascript</a>).</p>

<p>The big advantage functional programming gives us is that we can reason about and test our programs much more easily. This can help us to be more productive, reduce bugs and write better software. It is not always possible to write everything in a purely functional manner but it is something to strive for. John Carmack of Id Software wrote a good article discussing the <a href="http://www.altdevblogaday.com/2012/04/26/functional-programming-in-c/">practical considerations of functional programming</a>.</p>

<h2 id="concepts-in-functional-programming">Concepts in functional programming</h2>

<h3 id="first-class-and-higher-order-functions">First class and higher-order functions</h3>

<p>We've already discussed first class functions and how they can be stored and passed around as values. Of course these are very simple expressions in Javascript:</p>

<pre><code>var funcAsValue = function(y) {
    return y * 4;
};

var returnFunc = function(z) {
    return function(a) {
        return a * z;
    };
};

var funcAsArgument = function(a, func) {
    return func(a);
};
</code></pre>

<p>The latter two expressions are examples of "higher-order" functions. These are functions that either return functions as their result or take other functions as arguments.</p>

<h3 id="closures">Closures</h3>

<p>In Javascript functions can access variables in their outer scope:</p>

<pre><code>var func = function() {
    var a = 3;
    return function(b) {
        return b * a;
    };
};

var closure = func();
closure(4) // 12
</code></pre>

<p>In this example the function returned by <code>closure</code> can still access <code>a</code> since it is in its outer scope.</p>

<p>When functions return they "take a picture" of their current environment which they can read the latest values from. So, in essence, closures are functions which, as well as having an expression body and taking arguments, also record an outer scope or environment. Importantly, closures always have access to the latest value of a variable. If we rewrite the example above to always increment <code>a</code> we can see how this is the case (although this breaks our functional principles):</p>

<pre><code>var func = function() {
    var a = 3;
    return function(b) {
        a = ++a;
        return b * a;
    };
};

var closure = func();
closure(4) // 16
closure(5) // 25
</code></pre>

<h3 id="recursion">Recursion</h3>

<p>A recursive function is a function that quite simply calls itself:</p>

<pre><code>var recursive = function(n) {
    if (n &lt; 1) {
        return n;
    } else {
        return recursive(n - 1);
    }
};

recursive(1); // 0
</code></pre>

<p>Functional programming favours recursion for looping rather than traditional <code>while</code> or <code>for</code> loops since we can maintain statelessness and avoid side effects. For example, to compute the <a href="http://en.wikipedia.org/wiki/Factorial">factorial</a> of value <code>n</code> statefully we might do:</p>

<pre><code>var factorial = function(n) {
    var result = 1;
    for (var x = 1; x &lt;= n; x += 1) {
        result = x * result;
    }
    return result;
};

factorial(5) // 120
</code></pre>

<p>A stateless approach would be:</p>

<pre><code>var recursiveFactorial = function(n) {
    if (n &lt; 2) {
        return n;
    } else {
        return n * recursiveFactorial(n - 1);
    }
};

recursiveFactorial(5) // 120
</code></pre>

<h4 id="tail-call-optimisation">Tail call optimisation</h4>

<p>Most functional programming languages implement "tail call optimisation" for recursive functions. In order to understand this it would be best to begin by looking at what happens when recursion is not optimised in this manner.</p>

<p>Each time a function is called additional space is taken up on the call stack. If you're using a Javascript environment that supports <code>console.trace</code> logging you can see the call stack for the <code>recursiveFactorial</code> function above:</p>

<pre><code>var recursiveFactorial = function(n) {
    if (n &lt; 2) {
        console.trace();
        return n;
    } else {
        console.trace();
        return n * recursiveFactorial(n - 1);
    }
};

recursiveFactorial(5);
</code></pre>

<p>This stack is built up so when a value is returned the program knows where to go back to.</p>

<p>A "tail call" is a call to a function that occurs as the last action of another function. Our recursive calls above are not tail calls since the final action of the function is to multiply what is returned by <code>recursiveFactorial</code> by <code>n</code>. Let's change this around so they are:</p>

<pre><code>var recursiveFactorial = function(n) {
    var recur = function(x, y) {
        if (y === n) {
            console.trace()
            return x * y;
        } else {
            console.trace()
            return recur(x * y, y + 1);
        }
    }
    return recur(1, 1);
};

recursiveFactorial(5);
</code></pre>

<p>Since Javascript does not implement tail call optimisation we can see in the console that we build up the stack each time <code>recur</code> is called.</p>

<p>In programming languages that do support tail call optimisation a large call stack like this would not be built up. The language can determine that if a call is in tail position extra space does not need to be created for it on the stack each time it is called. A <a href="http://en.wikipedia.org/wiki/Tail_call#Example_programs">Wikipedia example illustrates the procedure quite nicely</a>.</p>

<p>Unfortunately since Javascript does not implement tail call optimisation recursion is much slower than traditional <code>for</code> or <code>while</code> loops. However, in <a href="http://wiki.ecmascript.org/doku.php?id=harmony:proper_tail_calls">ECMAScript 6 tail calls will be optimised</a>.</p>

<h3 id="continuation-passing-style">Continuation passing style</h3>

<p>For the time being we can still write loops in a recursive manner without taking up extra space on the call stack. This can be done with continuation passing style (CPS).</p>

<p>In CPS we use "continuations" (functions) to represent the next stage of a computation. A continuation is passed as an argument to a higher-order function which is then called by that function when a previous operation is complete. This pattern is very common in Javascript. AJAX requests and Node.js use CPS so that computation can be performed asynchronously. For example:</p>

<pre><code>$.get('url', function(data) {
    console.log(data);
});
</code></pre>

<p>In this example we pass a continuation to our <code>get</code> method when the data has been retrieved.</p>

<p>A more complex example is factorial in CPS:</p>

<pre><code>var CPSFactorial = function(n, cont) {
    if (n &lt; 2) {
        return cont(n);
    } else {
        var new_cont = function(v) {
            var result = v * n;
            return cont(result);
        };
        return CPSFactorial(n - 1, new_cont);
    }
};

CPSFactorial(5, function(v) {
    return v;
});
</code></pre>

<p>With our original recursive factorial example, once we reached the end of the "loop" each result had to be returned to its original caller meaning the program had to go all the way back through the stack to get the final result.</p>

<p>On the other hand, with CPS once the "loop" is at an end the function returns the result of applying the continuation with 1. This in turn applies the result of that function to another continuation and so on until we get the final result. So, rather than going all the way back through the call stack the <code>CPSFactorial</code> function creates new functions that each represent the next stage of the computation.</p>

<h3 id="thunks-and-trampolines">Thunks and trampolines</h3>

<p>With CPS there is still some recursion: <code>CPSFactorial</code> calls itself several times during the computation. We can avoid recursion completely with "thunks" and "trampolines".</p>

<p>A thunk is much like a continuation except that it is stored as a data structure for use at a later time. A trampoline manages the execution and return values of thunks (so called because it bounces thunks around). In Javascript we can represent a thunk as follows:</p>

<pre><code>var thunk = function (f, lst) {
    return { tag: "thunk", func: f, args: lst };
};

var thunkValue = function (x) {
    return { tag: "value", val: x };
};
</code></pre>

<p>In this case our <code>thunk</code> stores a function and a list of arguments to be executed at a later time. Thanks to closures thunks have a record of their environment when they are stored. The <code>thunkValue</code> function simply returns the final value of our computation.</p>

<p>We can handle all of the thunks we create with a trampoline:</p>

<pre><code>var trampoline = function (thk) {
    while (true) {
        if (thk.tag === "value") {
            return thk.val;
        }
        if (thk.tag === "thunk") {
            thk = thk.func.apply(null, thk.args));
        }
    }
};
</code></pre>

<p>Here <code>trampoline</code> takes a thunk and calls its function with its arguments if it has the correct tag otherwise it returns a value. This example breaks our rule of statelessness (since we reassign <code>thk</code> to a new value each time) so we could write this as follows:</p>

<pre><code>var trampoline = function (thk) {
    if (thk.tag === "value") {
        return thk.val;
    }
    if (thk.tag === "thunk") {
        return trampoline(thk.func.apply(null, thk.args));
    }
};
</code></pre>

<p>However, we are then back to using recursion again.</p>

<p>We can use thunks and a trampoline to calculate factorial:</p>

<pre><code>var thunk = function (f, lst) {
    return { tag: "thunk", func: f, args: lst };
};

var thunkValue = function (x) {
    return { tag: "value", val: x };
};

var thunkFactorial = function(n, cont) {
    if (n &lt; 2) {
        return thunk(cont, [n]);
    } else {
        var new_cont = function(v) {
            var result = v * n;
            return thunk(cont, [result]);
        };
        return thunk(thunkFactorial, [n - 1, new_cont]);
    }
};

var trampoline = function (thk) {
    while (true) {
        if (thk.tag === "value") {
            return thk.val;
        }
        if (thk.tag === "thunk") {
            thk = thk.func.apply(null, thk.args);
        }
    }
};

trampoline(thunkFactorial(5, thunkValue));
</code></pre>

<p>In this example we avoid recursion completely since we're always creating new thunks to be executed rather than functions invoking themselves.</p>

<p>A fun (but pointless) implementation of this is a <a href="https://github.com/stephendeyoung/jquery.trampoline">jQuery plugin that can act as a replacement for jQuery's <code>each</code> method</a>.</p>

<h2 id="optimisations-in-functional-programming">Optimisations in functional programming</h2>

<h3 id="partial-application-currying">Partial application (currying)</h3>

<p>Since Javascript has higher-order functions we can call functions with some of its arguments pre-filled. This is known as partial application or currying. The simplest example of this is Javascript's <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Function/bind"><code>bind</code></a> method. <code>bind</code> simply returns a new function with a custom context and arguments pre-filled:</p>

<pre><code>var bindExample = function(a, b) {
    return a / b;
};

var test = bindExample.bind(null, 3);

test(4); // 0.75
</code></pre>

<p>Here <code>test</code> creates a new function which when invoked already has the <code>a</code> argument filled in as 3.</p>

<p><code>bind</code> is an ECMAScript 5 method so it is not available in all Javascript environments. We can write a custom <code>bind</code> as follows:</p>

<pre><code>var bind = function(a, func) {
    return function() {
        return func.apply(null, [a].concat(Array.prototype.slice.call(arguments)));
    };
};

var bindExample = function(a, b) {
    return a / b;
};

var test = bind(3, bindExample);

test(4); // 0.75
</code></pre>

<p>Exactly like the ES5 method, the <code>bind</code> function in this case returns a new function which when called applies the function we passed into it with an argument pre-filled.</p>

<h3 id="memoisation">Memoisation</h3>

<p>Functions that are expensive to run can be optimised with memoisation. This involves using a closure to cache the results of previous calls to the function. A very simple example would be:</p>

<pre><code>var memoise = function(func) {
    var cache = {};
    return function(arg) {
        if (arg in cache) {
            console.log(arg + ' in cache');
            return cache[arg];
        } else {
            console.log(arg + 'not in cache');
            return cache[arg] = func(arg);
        }
    };
};

var memo = memoise(function(n) {
    return n * 2;
});

memo(1) // 2 (1 not in cache)
memo(1) // 2 (1 in cache)
</code></pre>

<p>Here we pass a function to <code>memoise</code> whose results we wish to cache. When we call <code>memo</code> it will either retrieve the value from the cache or it will call the memoised function and store its value in the cache. It's worth noting that in order for us to be able to memoise a function it must be referentially transparent otherwise no results will ever be cached.</p>

<p>Of course this example breaks our rule of avoiding side effects. Unfortunately it is quite problematic to use memoisation without changing state since we have to keep updating our cache. It is easier in a language like Haskell that can use <a href="http://conal.net/blog/posts/nonstrict-memoization">lazy evaluation to memoise</a>.</p>

<p>Memoisation is most useful where a function is likely to be calculating many of the same results such as the fibonacci sequence.</p>

<h2 id="conclusion">Conclusion</h2>

<p>This article has looked at functional programming's key themes, its main concepts and optimisations the paradigm can make.</p>

<p>Whilst functional programming has many benefits including more rigorous code and enhancements to productivity, it can be difficult at times to write programs in a purely functional manner in Javascript. Consequently, some pragmatism is required.</p>

<p>In a future post I hope to discuss how all of this can be tied together to create a functional application.</p>


		</article>
		
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-66" name="t-66"></a><h1>66 : Understanding JavaScript's async await</h1>
					<div class="tutorial__content">
<span>https://ponyfoo.com/articles/understanding-javascript-async-await</span>
					
<section class="md-markdown at-body"><h1 id="using-promises"><a href="#using-promises" class="md-heading">Using Promises</a></h1> <p>Let's suppose we had code like the following. Here I'm wrapping an HTTP request in a <code class="md-code md-code-inline">Promise</code>. The promise fulfills with the <code class="md-code md-code-inline">body</code> when successful, and is rejected with an <code class="md-code md-code-inline">err</code> reason otherwise. It pulls the HTML for a random article from this blog every time.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> request = <span class="md-code-built_in">require</span>(<span class="md-code-string">'request'</span>);

<span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">getRandomPonyFooArticle</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">return</span> <span class="md-code-keyword">new</span> Promise((resolve, reject) =&gt; {
    request(<span class="md-code-string">'https://ponyfoo.com/articles/random'</span>, (err, res, body) =&gt; {
      <span class="md-code-keyword">if</span> (err) {
        reject(err); <span class="md-code-keyword">return</span>;
      }
      resolve(body);
    });
  });
}
</code></pre> <p>Typical usage of the promised code shown above is below. There, we build a promise chain transforming the HTML page into Markdown of a subset of its DOM, and then into Terminal-friendly output, to finally print it using <code class="md-code md-code-inline">console.log</code>. Always remember to add <code class="md-code md-code-inline">.catch</code> handlers to your promises.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> hget = <span class="md-code-built_in">require</span>(<span class="md-code-string">'hget'</span>);
<span class="md-code-keyword">var</span> marked = <span class="md-code-built_in">require</span>(<span class="md-code-string">'marked'</span>);
<span class="md-code-keyword">var</span> Term = <span class="md-code-built_in">require</span>(<span class="md-code-string">'marked-terminal'</span>);

printRandomArticle();

<span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">printRandomArticle</span> <span class="md-code-params">()</span> </span>{
  getRandomPonyFooArticle()
    .then(html =&gt; hget(html, {
      markdown: <span class="md-code-literal">true</span>,
      root: <span class="md-code-string">'main'</span>,
      ignore: <span class="md-code-string">'.at-subscribe,.mm-comments,.de-sidebar'</span>
    }))
    .then(md =&gt; marked(md, {
      renderer: <span class="md-code-keyword">new</span> Term()
    }))
    .then(txt =&gt; <span class="md-code-built_in">console</span>.log(txt))
    .catch(reason =&gt; <span class="md-code-built_in">console</span>.error(reason));
}
</code></pre> <p>When ran, that snippet of code produces output as shown in the following screenshot.</p> <figure class=" figure-has-loaded"><a href="https://github.com/bevacqua/read-ponyfoo/blob/966b4ce513250561826871b52cea436e0edbce09/cli" target="_blank" aria-label="bevacqua/read-ponyfoo on GitHub"><img alt="Screenshot" class="js-only" draggable="true" data-bukket-ext-bukket-draggable="true" src="https://i.imgur.com/ArxlARC.png"><noscript>&amp;lt;img src="https://i.imgur.com/ArxlARC.png" alt="Screenshot"&amp;gt;</noscript></a><figcaption>Screenshot</figcaption></figure> <p>That code was <em>"better than using callbacks"</em>, when it comes to how sequential it feels to read the code.</p> <h1 id="using-generators"><a href="#using-generators" class="md-heading">Using Generators</a></h1> <p>We've already explored generators as a way of making the <code class="md-code md-code-inline">html</code> available in a synthetic <em>"synchronous"</em> manner <a href="/articles/es6-generators-in-depth" aria-label="ES6 Generators in Depth on Pony Foo">in the past</a>. Even though the code is now somewhat synchronous, there's quite a bit of wrapping involved, and generators may not be the most straightforward way of accomplishing the results that we want, so we might end up sticking to Promises anyways.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">let</span> request = <span class="md-code-built_in">require</span>(<span class="md-code-string">'request'</span>);
<span class="md-code-keyword">let</span> hget = <span class="md-code-built_in">require</span>(<span class="md-code-string">'hget'</span>);
<span class="md-code-keyword">let</span> marked = <span class="md-code-built_in">require</span>(<span class="md-code-string">'marked'</span>);

<span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title"><mark class="md-mark md-code-mark">getRandomPonyFooArticle</mark></span> <span class="md-code-params">(gen)</span> </span>{
  <span class="md-code-keyword">var</span> g = gen();
  g.next(); <span class="md-code-comment">// Important! Otherwise stops execution on `var html = yield`.</span>
  
  request(<span class="md-code-string">'https://ponyfoo.com/articles/random'</span>, (err, res, body) =&gt; {
    <span class="md-code-keyword">if</span> (err) {
      g.throw(err); <span class="md-code-keyword">return</span>;
    }
    
    g.next(body);
  });
}

getRandomPonyFooArticle(<span class="md-code-function"><span class="md-code-keyword">function</span>* <span class="md-code-title">printRandomArticle</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> html = <span class="md-code-keyword">yield</span>;
  
  <span class="md-code-keyword">var</span> md = hget(html, {
    markdown: <span class="md-code-literal">true</span>,
    root: <span class="md-code-string">'main'</span>,
    ignore: <span class="md-code-string">'.at-subscribe,.mm-comments,.de-sidebar'</span>
  });
  
  <span class="md-code-keyword">var</span> txt = marked(md, {
    renderer: <span class="md-code-keyword">new</span> marked.Renderer()
  });
  
  <span class="md-code-built_in">console</span>.log(txt);
});
</code></pre> <blockquote> <p>Keep in mind you should wrap the <code class="md-code md-code-inline">yield</code> call in a <code class="md-code md-code-inline">try</code> / <code class="md-code md-code-inline">catch</code> block to preserve the error handling we had added when using promises.</p> </blockquote> <p>Needless to say, using generators like this <em>doesn't scale well</em>. Besides involving an unintuitive syntax into the mix, your iterator code will be highly coupled to the generator function that's being consumed. That means you'll have to change it often as you add new <code class="md-code md-code-inline">await</code> expressions to the generator. A better alternative is to use the upcoming <strong>Async Function</strong>.</p> <h1 id="using-async-await"><a href="#using-async-await" class="md-heading">Using <code class="md-code md-code-inline">async</code> / <code class="md-code md-code-inline">await</code></a></h1> <p>When <em>Async Functions</em> finally hit the road, we'll be able to take our <code class="md-code md-code-inline">Promise</code>-based implementation and have it take advantage of the synchronous-looking generator style. Another benefit in this approach is that you won't have to change <code class="md-code md-code-inline">getRandomPonyFooArticle</code> at all, as long as it returns a promise, it can be awaited.</p> <p><strong>Note that <code class="md-code md-code-inline">await</code> may only be used in functions marked with the <code class="md-code md-code-inline">async</code> keyword.</strong> It works similarly to generators, suspending execution in your context until the promise settles. If the awaited expression isn't a promise, its casted into a promise.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">read();

<mark class="md-mark md-code-mark">async</mark> <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">read</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> html = <mark class="md-mark md-code-mark">await getRandomPonyFooArticle()</mark>;
  <span class="md-code-keyword">var</span> md = hget(html, {
    markdown: <span class="md-code-literal">true</span>,
    root: <span class="md-code-string">'main'</span>,
    ignore: <span class="md-code-string">'.at-subscribe,.mm-comments,.de-sidebar'</span>
  });
  <span class="md-code-keyword">var</span> txt = marked(md, {
    renderer: <span class="md-code-keyword">new</span> Term()
  });
  <span class="md-code-built_in">console</span>.log(txt);
}
</code></pre> <blockquote> <p>Again, – and just like with generators – keep in mind that you should wrap <code class="md-code md-code-inline">await</code> in <code class="md-code md-code-inline">try</code> / <code class="md-code md-code-inline">catch</code> so that you can capture and handle errors in awaited promises from within the <code class="md-code md-code-inline">async</code> function.</p> </blockquote> <p>Furthermore, an <em>Async Function</em> always returns a <code class="md-code md-code-inline">Promise</code>. That promise is rejected in the case of uncaught exceptions, and it's otherwise resolved to the return value of the <code class="md-code md-code-inline">async</code> function. This enables us to invoke an <code class="md-code md-code-inline">async</code> function and mix that with regular promise-based continuation as well. The following example shows how the two may be combined <em><a href="https://t.co/QgSKcLpww9" target="_blank" aria-label="The following code snippet in the Babel REPL">(see Babel REPL)</a></em>.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">async <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">asyncFun</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> value = await Promise
    .resolve(<span class="md-code-number">1</span>)
    .then(x =&gt; x * <span class="md-code-number">3</span>)
    .then(x =&gt; x + <span class="md-code-number">5</span>)
    .then(x =&gt; x / <span class="md-code-number">2</span>);
  <span class="md-code-keyword">return</span> value;
}
asyncFun().then(x =&gt; <span class="md-code-built_in">console</span>.log(`x: ${x}`));
<span class="md-code-comment">// &lt;- 'x: 4'</span>
</code></pre> <p>Going back to the previous example, that'd mean we could <code class="md-code md-code-inline">return txt</code> from our <code class="md-code md-code-inline">async read</code> function, and allow consumers to do continuation using promises or yet another <em>Async Function</em>. That way, your <code class="md-code md-code-inline">read</code> function becomes only concerned with pulling terminal-readable Markdown from a random article on Pony Foo.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">async <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">read</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> html = await getRandomPonyFooArticle();
  <span class="md-code-keyword">var</span> md = hget(html, {
    markdown: <span class="md-code-literal">true</span>,
    root: <span class="md-code-string">'main'</span>,
    ignore: <span class="md-code-string">'.at-subscribe,.mm-comments,.de-sidebar'</span>
  });
  <span class="md-code-keyword">var</span> txt = marked(md, {
    renderer: <span class="md-code-keyword">new</span> Term()
  });
  <mark class="md-mark md-code-mark">return</mark> txt;
}
</code></pre> <p>Then, you could further <code class="md-code md-code-inline">await read()</code> in another <em>Async Function</em>.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">async <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">write</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> txt = await read();
  <span class="md-code-built_in">console</span>.log(txt);
}
</code></pre> <p>Or you could just use promises for further continuation.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">read().then(txt =&gt; <span class="md-code-built_in">console</span>.log(txt));
</code></pre> <h1 id="fork-in-the-road"><a href="#fork-in-the-road" class="md-heading">Fork in the Road</a></h1> <p>In asynchronous code flows, it is commonplace to execute two or more tasks concurrently. While <strong>Async Functions</strong> make it easier to write asynchronous code, they also lend themselves to code that is <em>serial</em>. That is to say: code that executes <strong>one operation at a time</strong>. A function with multiple <code class="md-code md-code-inline">await</code> expressions in it will be suspended once at a time on each <code class="md-code md-code-inline">await</code> expression until that <code class="md-code md-code-inline">Promise</code> is settled, before unsuspending execution and moving onto the next <code class="md-code md-code-inline">await</code> expression <em>– not unlike the case we observe with generators and <code class="md-code md-code-inline">yield</code>.</em></p> <p>To work around that you can use <a href="https://ponyfoo.com/articles/es6-promises-in-depth#leveraging-promiseall-and-promiserace" target="_blank" aria-label="Leveraging Promise.all and Promise.race on Pony Foo"><code class="md-code md-code-inline">Promise.all</code></a> to create a single promise that you can <code class="md-code md-code-inline">await</code> on. Of course, the biggest problem is getting in the habit of using <code class="md-code md-code-inline">Promise.all</code> instead of leaving everything to run in a series, as it'll otherwise make a dent in your code's performance.</p> <p>The following example shows how you could <code class="md-code md-code-inline">await</code> on three different promises that could be resolved concurrently. Given that <code class="md-code md-code-inline">await</code> suspends your <code class="md-code md-code-inline">async</code> function and the <code class="md-code md-code-inline">await Promise.all</code> expression ultimately resolves into a <code class="md-code md-code-inline">results</code> array, we can use destructuring to pull individual results out of that array.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">async <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">concurrent</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> [r1, r2, r3] = <mark class="md-mark md-code-mark">await Promise.all([p1, p2, p3])</mark>;
}
</code></pre> <p>At some point, there was an <code class="md-code md-code-inline">await*</code> alternative to the piece of code above, where you didn't have to wrap your promises with <code class="md-code md-code-inline">Promise.all</code>. <em>Babel 5</em> still supports it, but <strong>it was dropped from the spec</strong> (and from Babel 6) <em><a href="https://github.com/rwaldron/tc39-notes/blob/aad8937063ab32eb33ec2a5b40325b1d9f171180/es6/2014-04/apr-10.md#preview-of-asnycawait" target="_blank" aria-label="TC39 Meeting Notes on GitHub">– because reasons</a></em>.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">async <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">concurrent</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> [r1, r2, r3] = <mark class="md-mark md-code-mark">await* [p1, p2, p3]</mark>;
}
</code></pre> <p>You could still do something like <code class="md-code md-code-inline">all = Promise.all.bind(Promise)</code> to obtain a terse alternative to using <code class="md-code md-code-inline">Promise.all</code>. An upside of this is that you could do the same for <code class="md-code md-code-inline">Promise.race</code>, which didn't have an equivalent to <code class="md-code md-code-inline">await*</code>.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">const</span> all = Promise.all.bind(Promise);
async <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">concurrent</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> [r1, r2, r3] = <mark class="md-mark md-code-mark">await all([p1, p2, p3])</mark>;
}
</code></pre> <h1 id="error-handling"><a href="#error-handling" class="md-heading">Error Handling</a></h1> <p>Note that <strong>errors are swallowed <em>"silently"</em></strong> within an <code class="md-code md-code-inline">async</code> function <em>– just like inside normal Promises.</em> Unless we add <code class="md-code md-code-inline">try</code> / <code class="md-code md-code-inline">catch</code> blocks around <code class="md-code md-code-inline">await</code> expressions, uncaught exceptions – regardless of whether they were raised in the body of your <code class="md-code md-code-inline">async</code> function or while its suspended during <code class="md-code md-code-inline">await</code> – will reject the promise returned by the <code class="md-code md-code-inline">async</code> function.</p> <p>Naturally, this can be seen as a strength: you're able to leverage <code class="md-code md-code-inline">try</code> / <code class="md-code md-code-inline">catch</code> conventions, something you were unable to do with callbacks – and <em>somewhat</em> able to with Promises. In this sense, <em>Async Functions</em> are akin to <a href="/articles/es6-generators-in-depth" aria-label="ES6 Generators in Depth on Pony Foo">generators</a>, where you're also able to leverage <code class="md-code md-code-inline">try</code> / <code class="md-code md-code-inline">catch</code> thanks to function execution suspension turning asynchronous flows into synchronous code.</p> <p>Furthermore, you're able to catch these exceptions from outside the <code class="md-code md-code-inline">async</code> function, simply by adding a <code class="md-code md-code-inline">.catch</code> clause to the promise they return. While this is a flexible way of combining the <code class="md-code md-code-inline">try</code> / <code class="md-code md-code-inline">catch</code> error handling flavor with <code class="md-code md-code-inline">.catch</code> clauses in <em>Promises</em>, it can also lead to confusion and ultimately cause to errors going unhandled.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">read()
  .then(txt =&gt; <span class="md-code-built_in">console</span>.log(txt))
  .catch(reason =&gt; <span class="md-code-built_in">console</span>.error(reason));
</code></pre> <p>We need to be careful and educate ourselves as to the different ways in which we can notice exceptions and then handle, log, or prevent them.</p> <h1 id="using-async-await-today"><a href="#using-async-await-today" class="md-heading">Using <code class="md-code md-code-inline">async</code> / <code class="md-code md-code-inline">await</code> Today</a></h1> <p>One way of using <em>Async Functions</em> in your code today is through Babel. This involves a series of modules, but <a href="/articles/controversial-state-of-javascript-tooling" aria-label="The Controversial State of JavaScript Tooling on Pony Foo">you could always come up with a module</a> that wraps all of these in a single one if you prefer that. I included <a href="https://github.com/timoxley/npm-run" target="_blank" aria-label="timoxley/npm-run on GitHub"><code class="md-code md-code-inline">npm-run</code></a> as a helpful way of keeping everything in locally installed packages.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">npm i -g npm-run
npm i -D \
  browserify \
  babelify \
  babel-preset-es2015 \
  babel-preset-stage-<span class="md-code-number">3</span> \
  babel-runtime \
  babel-plugin-transform-runtime

<span class="md-code-built_in">echo</span> <span class="md-code-string">'{
  "presets": ["es2015", "stage-3"],
  "plugins": ["transform-runtime"]
}'</span> &gt; .babelrc
</code></pre> <p>The following command will compile <code class="md-code md-code-inline">example.js</code> through <code class="md-code md-code-inline">browserify</code> while using <code class="md-code md-code-inline">babelify</code> to enable support for <strong>Async Functions</strong>. You can then pipe the script to <code class="md-code md-code-inline">node</code> or save it to disk.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">npm-run browserify -t babelify example.js | node
</code></pre> <h1 id="further-reading"><a href="#further-reading" class="md-heading">Further Reading</a></h1> <p>The <a href="https://tc39.github.io/ecmascript-asyncawait/" target="_blank" aria-label="Async Functions Specification Draft">specification draft for <strong>Async Functions</strong></a> is surprisingly short, and should make up for an interesting read if you're keen on learning more about this upcoming feature.</p> <p>I've pasted a piece of code below that's meant to help you understand how <code class="md-code md-code-inline">async</code> functions will work internally. Even though we can't polyfill new keywords, its helpful in terms of understanding what goes on behind the curtains of <code class="md-code md-code-inline">async</code> / <code class="md-code md-code-inline">await</code>.</p> <blockquote> <p>Namely, it should be useful to learn that <em>Async Functions</em> internally leverage both <strong>generators and promises</strong>.</p> </blockquote> <p>First off, then, the following bit shows how an <code class="md-code md-code-inline">async function</code> declaration could be dumbed down into a regular <code class="md-code md-code-inline">function</code> that returns the result of feeding <code class="md-code md-code-inline">spawn</code> with a generator function <em>– where we'll consider <code class="md-code md-code-inline">await</code> as the syntactic equivalent for <code class="md-code md-code-inline">yield</code>.</em></p> <pre class="md-code-block"><code class="md-code md-lang-javascript">async <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">example</span> <span class="md-code-params">(a, b, c)</span> </span>{
  <mark class="md-mark md-code-mark">example <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">body</span></span></mark>
}

<span class="md-code-title">function</span> <span class="md-code-title">example</span> <span class="md-code-params">(a, b, c)</span> {
  <span class="md-code-keyword">return</span> spawn(<span class="md-code-function"><span class="md-code-keyword">function</span>* <span class="md-code-params">()</span> </span>{
    <mark class="md-mark md-code-mark">example <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">body</span></span></mark>
  }, <span class="md-code-title">this</span>);
}
</code></pre> <p>In <code class="md-code md-code-inline">spawn</code>, a promise is wrapped around code that will step through the generator function <em>– made out of user code –</em> in series, forwarding values to your <em>"generator" code</em> (the <code class="md-code md-code-inline">async</code> function's body). In this sense, we can observe that <em>Async Functions</em> really <strong>are syntactic sugar</strong> on top of generators and promises, which makes it important that you understand how each of these things work in order to get a better understanding into how you can mix, match, and combine these different flavors of asynchronous code flows together.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">spawn</span> <span class="md-code-params">(genF, self)</span> </span>{
  <span class="md-code-keyword">return</span> <span class="md-code-keyword">new</span> Promise(<span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-params">(resolve, reject)</span> </span>{
    <span class="md-code-keyword">var</span> gen = genF.call(self);
    step(() =&gt; <mark class="md-mark md-code-mark">gen.next(<span class="md-code-literal">undefined</span>)</mark>);
    <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-title">step</span> <span class="md-code-params">(nextF)</span> </span>{
      <span class="md-code-keyword">var</span> next;
      <span class="md-code-keyword">try</span> {
        next = nextF();
      } <span class="md-code-keyword">catch</span>(e) {
        <span class="md-code-comment">// finished with failure, reject the promise</span>
        <mark class="md-mark md-code-mark">reject(e);</mark>
        <span class="md-code-keyword">return</span>;
      }
      <span class="md-code-keyword">if</span> (next.done) {
        <span class="md-code-comment">// finished with success, resolve the promise</span>
        <mark class="md-mark md-code-mark">resolve(next.value);</mark>
        <span class="md-code-keyword">return</span>;
      }
      <span class="md-code-comment">// not finished, chain off the yielded promise and `step` again</span>
      Promise.resolve(next.value).then(
        <mark class="md-mark md-code-mark">v</mark> =&gt; step(() =&gt; <mark class="md-mark md-code-mark">gen.next(v)</mark>),
        <mark class="md-mark md-code-mark">e</mark> =&gt; step(() =&gt; <mark class="md-mark md-code-mark">gen.throw(e)</mark>)
      );
    }
  });
}
</code></pre> <blockquote> <p>The highlighted bits of code should aid you in understanding how the <code class="md-code md-code-inline">async</code> / <code class="md-code md-code-inline">await</code> algorithm iterates over the generator sequence <em>(of <code class="md-code md-code-inline">await</code> expressions)</em>, wrapping each item in the sequence in a promise and then chaining that with the next step in the sequence. When the <strong>sequence is over or one of the promises is rejected</strong>, the promise returned by the <em>underlying generator function</em> is settled.</p> </blockquote> <p><em>Special thanks to <a href="https://twitter.com/ljharb" target="_blank">@ljharb</a>, <a href="https://twitter.com/jaydson" target="_blank">@jaydson</a>, <a href="https://twitter.com/calvinf" target="_blank">@calvinf</a>, <a href="https://twitter.com/ericclemmons" target="_blank">@ericclemmons</a>, <a href="https://twitter.com/sherman3ero" target="_blank">@sherman3ero</a>, <a href="https://twitter.com/matthewmolnar3" target="_blank">@matthewmolnar3</a>, and <a href="https://twitter.com/rauschma" target="_blank">@rauschma</a> for reviewing drafts of this article.</em></p></section>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-67" name="t-67"></a><h1>67 : Gettin' Freaky Functional w/Curried JavaScript</h1>
					<div class="tutorial__content">
<span>http://blog.carbonfive.com/2015/01/14/gettin-freaky-functional-wcurried-javascript/</span>
 <p><a href="http://blog.carbonfive.com/2015/01/05/tidying-up-a-javascript-application-with-higher-order-functions/">Partial application</a> refers to the practice of filling in a functions parameters with arguments, deferring others to be provided at a later time. JavaScript libraries like Underscore facilitate partial function application – but the API isn't for everyone. I, for one, feel icky sprinkling calls to <code>_.partial</code> and <code>_.bind</code> throughout my application.</p>
<p>Curried functions (found in Haskell and supported by Scala, among others) can be partially-applied with little ceremony; no special call format is required. In this blog post, I'll demonstrate an approach to currying JavaScript functions at the time of their definition in a way that enables partial function application without introducing lots of annoying parens and nested function expressions.</p>
<p><span id="more-10573"></span></p>
<h3>Currying in JavaScript: Usually a Huge Pain</h3>
<p>A function can be said to have been "curried" if implemented as a series of evaluations of nested unary functions (representing each "parameter") instead of as a single, multiple-arity function (currying a unary function isn't all that interesting).</p>
<p>This binary function:</p>
<pre>//
// (Number, Number) → Number
//
function sum(x, y) {
  return x + y;
}
</pre>
<p>…could be rewritten as a curried function like this:</p>
<pre>//
// Number → Number → Number
//
function sum(x) {
  return function(y) {
    return x + y;
  };
}

var addTen = sum(10); // type: Number → Number

addTen(20); // 30
addTen(55); // 65
</pre>
<p>This approach starts to become unwieldy as the number of values to be provided by the caller grows:</p>
<pre>//
//  type: Number → Number → Number → Number → Number
//
function sumFour(w) {
  return function (x) {
    return function (y) {
      return function (z) {
        return w + x + y + z;
      }
    }
  }
}

sumFour(1)(2)(10)(20); // 33

var addTen = sumFour(3)(3)(4);
addTen(20); // 30
</pre>
<p>Yuck. We get partial application – but with a very low signal-to-noise ratio. Four sets of parens are required to call <code>sumFour</code> – and its implementation requires three nested function expressions.</p>
<h3>Higher-Order Currying for the Lazy</h3>
<p>As luck may have it (thanks, Brendan Eich), we can write a higher-order currying function that can be applied to a fixed-arity function, returning a curried version of the original. Making things even sweeter, our curried function can be called like an idiomatic JavaScript function (one set of parens and comma-separated arguments) instead of like the <code>sumFour</code> mess above – all without losing the ability to perform low-ceremony partial application.</p>
<p>We'll jump straight into the implementation:</p>
<pre>function curry(fx) {
  var arity = fx.length;

  return function f1() {
    var args = Array.prototype.slice.call(arguments, 0);
    if (args.length &gt;= arity) {
      return fx.apply(null, args);
    }
    else {
      return function f2() {
        var args2 = Array.prototype.slice.call(arguments, 0);
        return f1.apply(null, args.concat(args2)); 
      }
    }
  };
}
</pre>
<p>Calling <code>curry</code> with a multiple arity function produces a new function which, when called, either returns a partially applied version of the original or the result of full application. Leveraging <code>Function.prototype.length</code>, we can compare the number of provided arguments (which we cache in <code>args</code> after each function call) with the arity of the original. If we've received enough arguments to fully apply, the original function is called. If not, we recurse into our helper (<code>f1</code>)… returning a new, partially applied function.</p>
<p>Let's see what it looks like to call this function – and how to interact with the resulting function.</p>
<pre>var sumFour = curry(function(w, x, y, z) {
  return w + x + y + z;
});
</pre>
<p>The name <code>sumFour</code> is now bound to a curried function returned from our call to <code>curry</code> in which we passed an anonymous, four-parameter function expression. Calling the resulting function will either result in a value (the sum of all four numbers) or a new function with some of its parameters filled in with values provided by the caller.</p>
<pre>var 
  f1 = sumFour(10),         // returns a function awaiting three arguments
  f2 = sumFour(1)(2, 3),    // returns a function awaiting one argument
  f3 = sumFour(1, 2, 7),    // returns a function awaiting one argument
  x  = sumFour(1, 2, 3, 4); // sumFour has been fully applied; x is equal to 1+2+3+4=10
  x2 = sumFour(1)(2)(3)(4); // fully applied; x2 equals 10
</pre>
<p>There are a few things of importance in this last example:</p>
<ol>
<li>Our curried function can be applied to multiple arguments without the need for multiple sets of parameters</li>
<li>Our curried function can be partially applied with library support (beyond what was required to create the function bound to <code>sumFour</code></li>
<li>The result of partially applying our curried function to arguments results in a function that is also curried</li>
</ol>
<p>Cool, right?</p>
<p>In hopes of illustrating how this crazy function works, let's walk through the evaluation of the expression <code>(sumFour(1)(2, 3, 4))</code>:</p>
<ol>
<li>Evaluate the subexpression <code>sumFour(1)</code>, which (you guessed it) applies <code>sumFour</code> to <code>1</code></li>
<li>Call <code>f1</code> with a single argument <code>1</code></li>
<li>Check to see if <code>f1</code> has been called with a number of arguments greater or equal to the number of parameters expressed in the anonymous function passed to <code>curry</code> (four: w, x, y, and z). The predicate returns false and <code>f2</code> is returned.</li>
<li><code>f2</code> is called with three arguments <code>2</code> and <code>3</code> and <code>4</code></li>
<li>Concatenate the first argument <code>1</code> with new arguments and apply <code>f1</code> to all four</li>
<li>Check number of arguments (now 4) against arity of original function (4) which satisfies predicate. The original function is then (fully) applied to all four arguments. </li>
</ol>
<h3>In Summary</h3>
<p>JavaScript implementations don't make things easy for programmers that want to work with partially-applied and curried functions (lots of parens, nested function expressions). In this blog post, you've seen a demonstration of how one might roll a higher-order currying function that allows for partial function application without a ton of hassle.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-68" name="t-68"></a><h1>68 : Composing Synchronous and Asynchronous Functions in JavaScript</h1>
					<div class="tutorial__content">
<span>http://blog.carbonfive.com/2015/01/29/composing-synchronous-and-asynchronous-functions-in-javascript/</span>
<p>Our example application implements a function <code>createEmployee</code> that is used to create an employee from a personId.</p>
<p>To create an employee, our system loads some data from our database, validates that data, and then performs an insert. Some of our functions are written in continuation-passing style (they accept a callback) and some are written in a direct style (they return values and/or throw exceptions). We'd like to compose these functions in such a way that they succeed or fail as a single unit – that any error in any segment of the sequence will cause subsequent steps to be skipped with a failure – but with some of our validations happening synchronously and some asynchronously, this can be difficult to do.</p>
<p><span id="more-10621"></span></p>
<p>To work around this problem, programmers will inline anonymous functions to thread return values and exceptions from direct-style code to our callbacks. For example:</p>
<pre>function hasWildHair(person) {
    return person.hairColor !== 'Green' || person.hairColor !== 'Pink'
}

function isOfAge(person) {
    return person.age &gt; 17;
}

function ensureDriversLicense(person, callback) {
    Database.getDriversLicenseByPersonId(person.id, function(err, license) {
      if (err) {
          callback(err);
      }
      else if (license.expired) {
          callback('Person must have valid license.');
      }
      else {
          callback(null, person);
      }
    });
}

function createEmployee(personId, callback) {
    var workflow = async.compose(
        Database.createEmployee,
        ensureDriversLicense,
        ensureWashingtonAddress,
        function(person, callback) {
            if (hasWildHair(person)) {
                callback(null, person);   
            }
            else {
                callback('Person must have wild hair.');
            }
        },
        function(person, callback) {
            if (isOfAge(person)) {
                callback(null, person);
            }
            else {
                callback('Person must be 18+ years of age.');
            }
        }
        Database.getPersonById);
    
    workflow(personId, callback);
}
</pre>
<p>There are a few problems with this approach:</p>
<ol>
<li>We've introduced two throwaway function expressions which add visual noise and some maintenance overhead.</li>
<li>Our direct-style code (hair color and of-age validations) isn't accessible outside of the CPS function that wraps it.</li>
<li>Our throwaway functions contain the logic to transmute the predicate-failures to error messages. Check for wild hair in ten places in your codebase? Ten places to add the check for null and hitting a callback with 'Person must have wild hair.'</li>
</ol>
<p>In this post, I'll demonstrate an approach to using higher-order functions to lift direct-style functions into the world of callbacks – enabling composition without the introduction of boilerplate function expressions. Once done, the above code will look like this:</p>
<pre>var createEmployee = async.compose(
    Database.createEmployee,
    ensureDriversLicense,
    ensureWashingtonAddress,
    asyncify(ensureWildHair),
    asyncify(ensureOfAge),
    Database.getPersonById);
</pre>
<h3>Step 1: Writing Failable Functions</h3>
<p>First, we'll write a higher-order function that accepts a predicate, a value to which we'll apply the predicate, and an error to throw in the event that our value does not satisfy the predicate. Why throw an error? This helps consuming functions differentiate the function's success from failure.</p>
<pre>function ensure(predicate, error, value) {
    if (predicate(value) {
        return value;
    }
    else {
        throw error;
    }
}
</pre>
<p>We can now compose <code>ensure</code> with our predicates, creating reusable failable validators:</p>
<pre>var ensureWildHair = _.partial(ensure, hasWildHair, 'Person must have wild hair.');
var ensureOfAge    = _.partial(ensure, ofAge, 'Person must be 18+ years of age.');
</pre>
<p>…which moves some of the error handling out of our larger, employee-creation function:</p>
<pre>function createEmployee(personId, callback) {
    var workflow = async.compose(
        Database.createEmployee,
        ensureDriversLicense,
        ensureWashingtonAddress,
        function(person, callback) {
            try {
                callback(null, ensureHasWildHair(person));
            }
            catch (e) {
                callback(e);
            }
        },
        function(person, callback) {
            try {
                callback(null, ensureOfAge(person));
            }
            catch (e) {
                callback(e);
            }
        }
        Database.getPersonById);
    
    workflow(personId, callback);
}
</pre>
<h3>Step 2: Working in the World of Callbacks</h3>
<p>We've dumbed down the responsibilities of the throwaway function expressions and centralized error creation and predicate handling into a generalized utility function <code>ensure</code>. Now, we'll write some code that will allow us to use a direct-style function in a continuation-passing style context.</p>
<pre>function asyncify(f) {
  return function _asyncify() {
    var args = Array.prototype.slice.call(arguments, 0);
    var argsWithoutLast = args.slice(0, -1);
    var callback = args[args.length-1];
    var result, error;

    try {
      result = f.apply(this, argsWithoutLast);
    }
    catch (e) {
      error = e;
    }

    setTimeout(function() {
      callback(error, result);
    }, 0);
  }
}
</pre>
<p>This new function allows us to map any n-ary function that either returns a value or throws an error to a (n+1)-ary function whose last argument is expected to be a Node.js-style callback whose first argument is the thrown error (if it exists) and second argument will be the returned value (if we didn't throw).</p>
<p>An example:</p>
<pre>function head(xs) {
    if (_.isArray(xs) &amp;&amp; !_.isEmpty(xs)) {
        return xs[0];
    }
    else {
        throw "Can't get head of empty array.";
    }
}

var cbHead = asyncify(head);

cbHead([1, 2, 3], function(err, result) {
    // result === 1
});

cbHead([], function(err, result) {
    // err === "Can't get head of empty array.";
});
</pre>
<p>We can now use <code>asyncify</code> function to reshape our direct-style functions into functions that accept callbacks.</p>
<pre>function createEmployee(personId, callback) {
    var workflow = async.compose(
        Database.createEmployee,
        ensureDriversLicense,
        ensureWashingtonAddress,
        asyncify(ensureHasWildHair),
        asyncify(ensureOfAge),
        Database.getPersonById);
    
    workflow(personId, callback);
}
</pre>
<p>Finally, we can eliminate the function expression completely; we can instead define <code>createEmployee</code> as the composition of our other functions. Since the expression does nothing more than delegate to a function with the same signature, we can safely eliminate it.</p>
<pre>var createEmployee = async.compose(
    Database.createEmployee,
    ensureDriversLicense,
    ensureWashingtonAddress,        
    asyncify(ensureHasWildHair), 
    asyncify(ensureOfAge),
    Database.getPersonById);
</pre>
<h3>In Summary</h3>
<p>Our final implementation reduce the code bespoke code required to validate and create an employee to an absolute minimum. Our resulting application is highly modular; <code>ensure</code> and <code>asyncify</code> allow the bits to be used in a variety of contexts outside of <code>createEmployee</code>. In the end, we've generalized things to the point where our job is to simply compose generalized functions together to create something specific to the problem at hand.</p>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-69" name="t-69"></a><h1>69 : Tidying Up a JavaScript Application with Higher-Order Functions</h1>
					<span>http://blog.carbonfive.com/2015/01/05/tidying-up-a-javascript-application-with-higher-order-functions/</span>
					<div class="tutorial__content">


<article role="article" id="post_10528" class="post-10528 post type-post status-publish format-standard hentry category-web tag-functional-programming tag-javascript">
        
                <p><em>Higher-order</em> functions are functions that can do one or both of the following:</p>
<ol>
<li>Take a function or functions as arguments</li>
<li>Return a function as an argument</li>
</ol>
<p>Most programmers by now are familiar with higher-order functions such as <code>map</code>, <code>reduce</code>, and <code>filter</code>. These functions abstract away the boilerplate when processing collections. For example…</p>
<p>Given a string-capitalizing function and an array of arrays of strings:</p>
<div><pre><code>function capitalize(s) {
&nbsp;&nbsp;return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();
}
&nbsp;
var fruitsOfTheWorld = [
&nbsp;&nbsp;["apple", "pineapple", "pear"],
&nbsp;&nbsp;["manzana", "pera", "piña"],
&nbsp;&nbsp;["poma", "perera", "ananàs"]
];
</code></pre></div>
<p>…we can turn this:</p>
<div><pre><code>var results = [], 
&nbsp;&nbsp;&nbsp;&nbsp;i = fruitsOfTheWorld.length;
&nbsp;
while (i--) {
&nbsp;&nbsp;results.unshift([]);
&nbsp;&nbsp;var j = fruitsOfTheWorld[i].length;
&nbsp;&nbsp;while (j--) {
&nbsp;&nbsp;&nbsp;&nbsp;results[0].unshift(capitalize(fruitsOfTheWorld[i][j]));
&nbsp;&nbsp;}
}
&nbsp;
return results;
</code></pre></div>
<p>…into this:</p>
<div><pre><code>return fruitsOfTheWorld.map(function(fruits) {
&nbsp;&nbsp;return fruits.map(capitalize);
});
</code></pre></div>
<p>In this post, I'll demonstrate the usage of higher-order functions outside of a collection-processing context – with the ultimate goal of reducing boilerplate code in your real-world applications (as <code>filter</code> did above). We'll start with partial function application (facilitated by Underscore's <code>_.partial</code>) and move on to writing our own higher-order functions.</p>
<p><span id="more-10528"></span></p>
<h3>What is Partial Function Application?</h3>
<div><pre><code>function sum(x, y) {
&nbsp;&nbsp;return x + y;
}
</code></pre></div>
<p>Given the code above, partial application refers to the application of the function <code>sum</code> to between 0 and n-1 arguments, where n is equal to the number of parameters declared by the function. The result of partially applying a function to arguments is a new function with some (or none) of its parameters filled in with values:</p>
<div><pre><code>var sumWithXFixedToTen = _.partial(sum, 10);
&nbsp;
(typeof sumWithXFixedToTen); // Function
</code></pre></div>
<p>The name <code>sumWithXFixedToTen</code> is bound to a new function returned by <code>_.partial</code> that behaves like <code>sum</code> – but where <code>x</code> will always be the value 10 (that is to say, <code>sumWithXFixedToTen(y)</code> equals <code>sum(10, y)</code> for all <code>y</code>). Moving forward, this new function can be fully-applied with just a single argument (since <code>sum</code> was already partially-applied to <code>10</code>).</p>
<div><pre><code>sumWithXFixedToTen(20); // 30
sumWithXFixedToTen(99); // 109
</code></pre></div>
<h3>Implementing Partial Function Application</h3>
<p>To better understand what is going on behind-the-scenes of libraries like Underscore, we will now work through our own implementation of <code>partial</code>:</p>
<div><pre><code>function partial(fx) {
&nbsp;&nbsp;var firstArgs = Array.prototype.slice.call(arguments, 1);
&nbsp;
&nbsp;&nbsp;return function fx2() {
&nbsp;&nbsp;&nbsp;&nbsp;var secondArgs = Array.prototype.slice.call(arguments, 0);
&nbsp;&nbsp;&nbsp;&nbsp;return fx.apply(null, firstArgs.concat(secondArgs));
&nbsp;&nbsp;};
}
</code></pre></div>
<p>Our higher-order <code>partial</code> function:</p>
<ol>
<li>Takes as its first argument, a function <code>fx</code> to partially apply</li>
<li>Takes as its 2nd…n arguments (it is variadic), values to which <code>fx</code> will be partially applied (<code>firstArgs</code>)</li>
<li>Returns a new function <code>fx2</code> that, when called, returns the result of applying <code>fx</code> to the both <code>firstArgs</code> and <code>secondArgs</code></li>
</ol>
<p>This version of <code>partial</code> provides a convenient way of applying a function to some number of arguments – but lacks some of the nice features found in similar implementations provided by Underscore's <a href="http://underscorejs.org/#partial" onclick="javascript:window.open('http://underscorejs.org/#partial'); return false;"><code>partial</code></a> and <a href="http://underscorejs.org/#bind" onclick="javascript:window.open('http://underscorejs.org/#bind'); return false;"><code>bind</code></a>, such as preservation of execution context and parameter-skipping. For the rest of this article, I'll be using Underscore's functions. For the curious, <a href="https://github.com/jashkenas/underscore/blob/master/underscore.js#L725" onclick="javascript:window.open('https://github.com/jashkenas/underscore/blob/master/underscore.js#L725'); return false;">take a look at their implementation</a> to see what ours is missing.</p>
<h2>Real-World Higher-Order Functions</h2>
<h3>Eliminating Anonymous Function Expressions</h3>
<p>When working with libraries like <a href="https://github.com/caolan/async" onclick="javascript:window.open('https://github.com/caolan/async'); return false;">async</a>, programmers often find themselves relying on function expressions to shim application code into the signatures required by <code>waterfall</code>, <code>series</code>, and the like. Partial application of async-agnostic functions to known arguments can eliminate the need for these shims, significantly reducing overall code volume.</p>
<p>For a concrete example, let's take a look at some real-life client code I came across today:</p>
<div><pre><code>function createAccount(email, password, done) {
&nbsp;&nbsp;var id = uuid();
&nbsp;
&nbsp;&nbsp;async.waterfall([
&nbsp;&nbsp;&nbsp;&nbsp;function(callback) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Services.Accounts.provision(email, password, callback);
&nbsp;&nbsp;&nbsp;&nbsp;}, 
&nbsp;&nbsp;&nbsp;&nbsp;function(accountId, callback) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Services.Account.enable(email, accountId, callback);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;],
&nbsp;&nbsp;function(err, auth) {
&nbsp;&nbsp;&nbsp;&nbsp;done(err, id, auth);
&nbsp;&nbsp;});
}
</code></pre></div>
<p>Using Underscore, we can eliminate the anonymous function expressions completely:</p>
<div><pre><code>function createAccount(email, password, done) {
&nbsp;&nbsp;var id = uuid();
&nbsp;
&nbsp;&nbsp;async.waterfall([
&nbsp;&nbsp;&nbsp;&nbsp;_.partial(Services.Accounts.provision, email, password),
&nbsp;&nbsp;&nbsp;&nbsp;_.partial(Services.Notification.confirm, email)
&nbsp;&nbsp;],
&nbsp;&nbsp;_.partial(done, _, id, _));
}
</code></pre></div>
<p>Something to note about Underscore's <code>partial</code> function is that it can accept a placeholder <code>_</code> which indicates that an argument should not be pre-filled – but rather provided at call time. In our example, the <code>done</code> function has had only its <code>id</code> parameter pre-filled, leaving <code>err</code> and <code>auth</code> to be provided once our series of asynchronous operations completes.</p>
<h3>Higher-Order Error Handling</h3>
<p>A pet-peeve of mine is seeing Node.js-style error handling sprinkled all over a codebase:</p>
<div><pre><code>expressRouter.get("/api/ledgers/:id", function(req, res) {
&nbsp;&nbsp;UserService.getLedgerById(req.params.id, function(err, ledger) {
&nbsp;&nbsp;&nbsp;&nbsp;if (err) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.status(404).json({"message": "Not Found"});
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;else {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.status(200).json(ledger);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;});
});
&nbsp;
expressRouter.patch("/api/users/:id", function(req, res) {
&nbsp;&nbsp;UserService.getUserById(req.params.id, function(err, user) {
&nbsp;&nbsp;&nbsp;&nbsp;if (err) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.status(404).json({"message": "Not Found"});
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;else {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserService.updateUser(id, req.body, function(err, user) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (err) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.status(400).json({"message": "Invalid data provided"});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.status(200).json(user);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;});
}
</code></pre></div>
<p>Notice a pattern here? In the asynchronously-executed callbacks that we provide for both <code>getUserById</code> and <code>updateUser</code>, we check the value bound to the first parameter of each callback (<code>err</code>) and respond with some error code and response if its value is truthy. This pattern of checking for and responding to errors can be abstracted into a higher-order function, leaving the application's happy path free of crufty control logic.</p>
<div><pre><code>function ensure(notOkCode, notOkMessage, response, okFx) {
&nbsp;&nbsp;return function(err) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (err) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.status(notOkCode).json({"message": notOkMessage});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;okFx.apply(okFx, Array.prototype.slice.call(arguments, 1));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;};
}
&nbsp;
var ensureFound = _.partial(ensure, 404, "Not Found"),
&nbsp;&nbsp;&nbsp;&nbsp;ensureValid = _.partial(ensure, 400, "Bad Request");
&nbsp;
expressRouter.get("/api/ledgers/:id", function(req, res) {
&nbsp;&nbsp;UserService.getLedgerById(req.params.id, ensureFound(res, function(ledger) {
&nbsp;&nbsp;&nbsp;&nbsp;res.status(200).json(ledger);
&nbsp;&nbsp;}));
});
&nbsp;
expressRouter.patch("/api/users/:id", function(req, res) {
&nbsp;&nbsp;UserService.getUserById(req.params.id, ensureFound(res, function(user) {
&nbsp;&nbsp;&nbsp;&nbsp;UserService.updateUser(user, req.body, ensureValid(res, function(updated) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.status(200).json(updated);
&nbsp;&nbsp;&nbsp;&nbsp;}));
&nbsp;&nbsp;}));
});
</code></pre></div>
<h2>Takeaways</h2>
<p>Higher-order functions will help you write JavaScript with less cruft. By familiarizing yourself with Underscore's <code>partial</code> function (or something you write yourself), you'll have one more tool for factoring out common patterns into reusable, higher-order little chunks. Functional programming FTW!</p>
</article>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-70" name="t-70"></a><h1>70 : Building a simple offline-capable Notepad app using ServiceWorker</h1>
					<span class="ref-site">https://dev.to/amit_merchant/building-a-simple-offline-capable-notepad-app-using-serviceworker</span>
					<div class="tutorial__content">
<div class="body">
    <p>Today, We are going to build a progressive Notepad app which can very well be used in offline mode, be responsive on all available devices and which saves the content locally on device. So, the core functionality of this Notepad here is to make it work offline. To fulfill this requirement, we'll use <a href="https://developers.google.com/web/fundamentals/getting-started/primers/service-workers">ServiceWorkers</a> which I'm going to cover next.</p>

<h1>Foreward</h1>

<h2>What is a ServiceWorker?</h2>

<p><em>A service worker is a script that runs in the background, separate from your web page. It responds to events, including network requests made from pages it serves. A service worker has an intentionally short lifetime. It wakes up when it gets an event and runs only as long as it needs to process it.</em></p>

<p>The first and foremost feature ServiceWorkers provides is to give the ability to webapp to work offline. Apart from this ServiceWorkers also includes features like <a href="https://developers.google.com/web/updates/2015/03/push-notifications-on-the-open-web">push notifications</a> and <a href="https://developers.google.com/web/updates/2015/12/background-sync">background sync</a>. In the future service workers will support other things like periodic sync or geofencing. The core feature discussed in this tutorial is the ability to intercept and handle network requests, including programmatically managing a cache of responses.</p>

<h2>Now, let's talk about what is a Progressive Web App?</h2>

<p><em>A Progressive Web App uses modern web capabilities to deliver an app-like user experience. They evolve from pages in browser tabs to immersive, top-level apps, maintaining the web's low friction at every moment.</em></p>

<ul>
<li>This means a progressive web app should be responsive, connection-independent, app-like, fresh, installable and so forth. So, to make our Notepad a progressive web app, we need to include all above features. Let's get started.</li>
</ul>

<h1>Building the Notepad</h1>

<p>Let's start by creating a folder called Notepad in your favorite local web server(in my case I have used <a href="https://www.apachefriends.org/index.html">XAMPP</a>) and add following files into it:</p>

<ul>
<li><code>index.html</code></li>
<li>
<code>sw.js</code> - This where we'll write our ServiceWorker logic</li>
<li>
<code>manifest.json</code> - The manifest enables your web app to have a more native-like presence on the user's homescreen. It allows the app to be launched in full-screen mode (without a URL bar being present), provides control over the screen orientation and in recent versions of Chrome on Android supports defining a <a href="https://developers.google.com/web/updates/2015/10/splashscreen?hl=en">Splash Screen</a> and <a href="https://developers.google.com/web/updates/2014/11/Support-for-theme-color-in-Chrome-39-for-Android?hl=en">theme color</a> for the address bar. It is also used to define a set of icons by size and density used for the aforementioned Splash screen and homescreen icon.</li>
</ul>

<p>Now, first thing we will do is register a <code>ServiceWorker</code> when our app hits the browser for the first time. For this, create a folder called <code>js</code> in root and add file <code>app.js</code> into it and add the following code in that file.</p>
<pre><code>// Registering ServiceWorker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').then(function(registration) {
    // Registration was successful
    console.log('ServiceWorker registration successful with scope: ',    registration.scope);
  }).catch(function(err) {
    // registration failed :(
    console.log('ServiceWorker registration failed: ', err);
  });
}
</code></pre>
<p>Above code will try to check if the current browser supports <code>ServiceWorker</code> and if yes, it will register one. Notice, we have passed a file called <code>sw.js</code> in the register function which we haven't created yet.</p>

<p>Create a file called <code>sw.js</code> in the root and add the following content into it.</p>
<pre><code>importScripts('js/cache-polyfill.js');

var CACHE_VERSION = 'app-v1';

self.addEventListener('install', function (event) {
    event.waitUntil(
        caches.open(CACHE_VERSION)
            .then(function (cache) {
                console.log('Opened cache');
                return cache.addAll(CACHE_FILES);
            })
    );
});

self.addEventListener('fetch', function (event) {
    event.respondWith(
        caches.match(event.request).then(function(res){
            if(res){
                return res;
            }
            requestBackend(event);
        })
    )
});

function requestBackend(event){
    var url = event.request.clone();
    return fetch(url).then(function(res){
        //if not a valid response send the error
        if(!res || res.status !== 200 || res.type !== 'basic'){
            return res;
        }

        var response = res.clone();

        caches.open(CACHE_VERSION).then(function(cache){
            cache.put(event.request, response);
        });

        return res;
    })
}

self.addEventListener('activate', function (event) {
    event.waitUntil(
        caches.keys().then(function(keys){
            return Promise.all(keys.map(function(key, i){
                if(key !== CACHE_VERSION){
                    return caches.delete(keys[i]);
                }
            }))
        })
    )
});
</code></pre>
<p>Notice, If you want to import any external script in the Service Worker, you can do it using importScripts() . In this example we'll be using the <a href="https://github.com/coonsta/cache-polyfill">cache-polyfill</a> since the support for cache is limited.</p>

<p>Now, We need to cache all files that we want to be cached the first time <code>ServiceWorker</code> registered. In order to do this, we'll add the following content after <code>var CACHE_VERSION = 'app-v10';</code> line:</p>
<pre><code>var CACHE_FILES = [
    '/',
    'index.html',
    'js/app.js',
    'css/style.css',
    'favicon.ico',
    'manifest.json'
];
</code></pre>
<p>All this files will get cached for the offline use. Here you can see we call <code>caches.open()</code> with our desired cache name(which in our case is <code>CACHE_VERSION</code>), after which we call cache.addAll() and pass in our array of files i.e <code>CACHE_FILES</code>.</p>

<p>Next, we'll add following content into the file <code>manifest.json</code>.</p>
<pre><code>{
  "short_name": "Notepad",
  "name": "Notepad",
  "display": "standalone",
  "icons": [
    {
      "src": "img/icon-48.png",
      "sizes": "48x48",
      "type": "image/png"
    },
    {
      "src": "img/icon-96.png",
      "sizes": "96x96",
      "type": "image/png"
    },
    {
      "src": "img/icon-144.png",
      "sizes": "144x144",
      "type": "image/png"
    },
    {
      "src": "img/icon-196.png",
      "sizes": "196x196",
      "type": "image/png"
    }
  ],
  "start_url": "index.html",
  "theme_color": "#9b59b6",
  "background_color": "#EEEEEE"
}
</code></pre>
<p>You can see here, we have provided our application name in <code>short_name</code>, default orientation for application is <code>standalone</code> and we have also provided different sized icons of our application which you can get from <a href="https://github.com/amitmerchant1990/notepad/tree/master/img">here</a>.</p>

<p>Let's now move to the <code>index.html</code> and add following content:</p>
<pre><code>
  
    &lt;title>Notepad - Offline capable&lt;/title>
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge">
    &lt;meta name="viewport" content="width=device-width, initial-scale=1">
    &lt;meta name="theme-color" content="#9b59b6">
    &lt;meta name="description" content="An offline capable notepad powered by ServiceWorker">
    &lt;meta name="keywords" content="note,offline,mobile,web,notepad">
    &lt;meta name="author" content="Amit Merchant">
    &lt;meta name="application-name" content="Notepad">
    &lt;link href="css/bootstrap.min.css" rel="stylesheet">
    &lt;link href="css/style.css" rel="stylesheet">
    &lt;link rel="icon" href="favicon.ico">
    &lt;link rel="manifest" href="manifest.json">
  
  
    &lt;nav class="navbar-default navbar-inverse navbar-fixed-top">
      &lt;div class="container">
        &lt;div class="navbar-header">
          &lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            &lt;span class="sr-only">Toggle navigation&lt;/span>
            &lt;span class="icon-bar">&lt;/span>
            &lt;span class="icon-bar">&lt;/span>
            &lt;span class="icon-bar">&lt;/span>
          &lt;/button>
          &lt;a class="navbar-brand" href="#">Notepad - Offline capable&lt;/a>
        &lt;/div>
        &lt;div id="navbar" class="collapse navbar-collapse">
          &lt;ul class="nav navbar-nav">
            &lt;li>&lt;a href="#about" data-toggle="modal" data-target="#myModal">About&lt;/a>&lt;/li>
          &lt;/ul>
        &lt;/div>
      &lt;/div>
    &lt;/nav>

    &lt;div class="container">
      &lt;div class="starter-template">
        &lt;textarea id="note" placeholder="Type your notes here and when you come back all your notes will be right here...">&lt;/textarea>
      &lt;/div>
    &lt;/div>
    &lt;div id="myModal" class="modal fade" role="dialog">
      &lt;div class="modal-dialog">

        &lt;!-- Modal content-->
        &lt;div class="modal-content">
          &lt;div class="modal-header">
            &lt;button type="button" class="close" data-dismiss="modal">×&lt;/button>
            &lt;h4 class="modal-title">Notepad - Offline capable&lt;/h4>
          &lt;/div>
          &lt;div class="modal-body">
            &lt;p>An offline capable notepad powered by ServiceWorker&lt;/p>
            &lt;a href="https://github.com/amitmerchant1990/notepad" target="_blank">Go to the repository&lt;/a>
          &lt;/div>
          &lt;div class="modal-footer">
            &lt;button type="button" class="btn btn-default" data-dismiss="modal">Close&lt;/button>
          &lt;/div>
        &lt;/div>

      &lt;/div>
    &lt;/div>
    &lt;script src="js/jquery.min.js">&lt;/script>
    &lt;script src="js/bootstrap.min.js">&lt;/script>
    &lt;script src="js/app.js">&lt;/script>
  

</code></pre>
<p>So, as you can see here we have taken a textarea and have given it <code>id</code>=<code>note</code> which we will use to keep track of <code>onKeyUp</code> event of textarea. For this, purpose we'll use <a href="https://jquery.com/">jQuery</a>. Let's also note here that, to make the app responsive on all device, we have used <a href="http://getbootstrap.com/">Bootstrap</a>. You can I have included all of the necessary files in <code>index.html</code>. You can get all the necessary file from <a href="https://github.com/amitmerchant1990/notepad/tree/master/js">here</a> and <a href="https://github.com/amitmerchant1990/notepad/tree/master/css">here</a> and add them to the relevant folders. I have also included file <a href="https://github.com/amitmerchant1990/notepad/blob/master/css/style.css">style.css</a> which will make some necessary changes on the page to make it responsive.</p>

<p>Now, again move to the file <code>js/app.js</code> and add the following content:</p>
<pre><code>// Commented out for brevity

$(document).ready(function(){
  $('#note').bind('input propertychange', function(){
    localStorage.setItem("note", $(this).val());
  });

  if(localStorage.getItem("note") &amp;&amp; localStorage.getItem("note")!=''){
    var noteItem = localStorage.getItem("note")
    $('#note').val(noteItem);
  }
});
</code></pre>
<p>As you can see, we have <code>bind</code> the textarea's <code>propertychange</code> event so that it will get the text while user types and it to the `localStorage</p>
<pre><code>if(localStorage.getItem("note") &amp;&amp; localStorage.getItem("note")!=''){
    var noteItem = localStorage.getItem("note")
    $('#note').val(noteItem);
  }
</code></pre>
<p>Above code will check if there's anything into the <code>localStorage</code> and if found will fill the <code>textarea</code> with the available content when the next time user visits the website.</p>

<p>Lastly, move to <code>sw.js</code> file once again and add all the remaining files into <code>CACHE_FILES</code>.</p>
<pre><code>var CACHE_FILES = [
    '/',
    'index.html',
    'js/app.js',
    'js/jquery.min.js',
    'js/bootstrap.min.js',
    'css/bootstrap.min.css',
    'css/style.css',
    'manifest.json',
    'img/icon-48.png',
    'img/icon-96.png',
    'img/icon-144.png',
    'img/icon-196.png'
];
</code></pre>
<p>Putting all above bits and pieces at correct place, our Notepad app is now ready to be used offline. Head over to the <a href="http://localhost">http://localhost</a> or relevant local web server URL and check the final app.</p>

<p>You can check the whole <a href="https://github.com/amitmerchant1990/notepad">codebase</a> or checkout the <a href="https://www.amitmerchant.com/notepad/">demo</a>.</p>

<p>Found any typo or want to contribute? Help us improve our documentation by forking and sending your fixes and suggestions. <a href="https://github.com/amitmerchant1990/amitmerchant1990.github.io/blob/master/_posts/2016-11-15-Building-Simple-Offline-Notepad-Using-Service-Worker.md">Improve this Page!</a></p>

<p><em>Thanks for reading!</em></p>

  </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article>
					<a id="t-71" name="t-71"></a><h1>71 : Getting Started with Service Workers</h1>
					<span class="ref-site">https://dev.to/tarun_garg2/getting-started-with-service-worker</span>
					<div class="tutorial__content">
<div class="body">
    <h2>What is a Service Worker?</h2>

<p>A Service Worker can be thought of as a JavaScript file that runs in the context of  <a href="https://developer.mozilla.org/en/docs/Web/API/SharedWorker">Shared Worker </a>. It acts as a proxy between the browser and network. </p>

<p>Service Workers help developers build  <code>offline first</code> web applications, what we meant by offline first is even if there is no/slow internet connection on user's device in those scenarios also, we will be able to serve our app, or something, to user which is at par or better than native apps that work offline. </p>

<p>Service Workers run in a different thread than normal JavaScript thread, hence all communication between the Service Worker thread and main thread happen through messages sent via <a href="https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage"><code>postMessage</code></a>.  One of the less talked features is that it is completely asynchronous and all synchronous web APIs won't go well with it.</p>

<p>Service Workers sits between our browser and network, so in order to prevent our web app from middle man attacks, Service Workers run only on HTTPS [ localhost is an exception ].</p>

<p>Service Workers make heavy use of modern web constructs, listed below :</p>

<ul>
<li><a href="http://www.html5rocks.com/en/tutorials/es6/promises/">Promise API</a></li>
<li><a href="https://developers.google.com/web/updates/2015/03/introduction-to-fetch">Fetch API</a></li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">Cache API</a><br>
</li>
<li>Chrome dev tools features</li>
</ul>

<p>It is recommended that you get familiar with above APIs before going further. </p>

<p>The Service Worker API is still a new feature in web, so is supported (or partially supported) by few browsers, you can check compatibility <a href="https://jakearchibald.github.io/isserviceworkerready/">here</a>.</p>

<h2>Registration</h2>

<p>In order to be able to use Service Workers in our app, we have to first register it. Registering a Service Worker is nice and easy.</p>

<p>First, we'll detect if our browser supports Service Worker or not.</p>
<pre><code>// check if Service Worker support exists in browser or not
if( 'serviceWorker' in navigator ) {
    //Service Worker support exists
} else {
    //still not supported
}
</code></pre>
<p>Now that we have detected if Service Worker support exists or not in the browser, it's time to register it.</p>

<p>The below code registers a Service Worker present in <code>service-worker.js</code> file which has the scope of the whole of our application.</p>
<pre><code>// check if Sevice Worker support exist in browser or not
if( 'serviceWorker' in navigator ) {
    navigator.serviceWorker  
                       .register( 'service-worker.js' , { scope : ' ' } )  
                       .then( function( ) { 
                           console.log('Congratulations!!Service Worker Registered');
                       })
                       .catch( function( err) {
                           console.log(`Aagh! Some kind of Error :- ${err}`);
                       });
} else {
    //still not supported
}
</code></pre>
<p>In the above code snippet</p>

<ul>
<li>We are detecting if Service Worker support exists in our browser or not.</li>
<li>If support exists, we are registering a file named <code>service-worker.js</code>(You can name your file anything). Note that, ideally <code>service-worker.js</code> file should be in the root directory. If our Service Worker file is present in some other directory like <code>directory/service-worker.js</code> then Service Worker will get in action only when something from <code>directory/</code> is being fetched.</li>
<li>We are passing an object as the second argument to <code>register()</code> function which has a scope key whose value is ' ', that means we want to register Service worker in the scope of the current directory. You can also manually set Service Worker scope to any directory of your choice.</li>
<li>Finally, since whole Service worker is 'promise based', we are catching if Service Worker is registered or not.</li>
</ul>

<p><em>If you don't pass anything as the second argument to <code>register()</code> function then Service Worker is registered against the directory in which Service Worker file is present.</em></p>

<p><strong>Now registration of Service Worker is complete.</strong></p>

<p>Let's dig in a bit deeper. As we discussed earlier that Service Worker communicate with main thread using <code>messages/events</code>. Whenever we do a network fetch, the network request goes through the Service Worker and triggers a <code>fetch event</code>. </p>

<p>Now in our <code>service-worker.js</code> let's add a listener for this event.</p>
<pre><code>self.addEventListener( "fetch" , function (event) {
    //fetch request as specified by event object 
    console.log(event.request); //Note that Request and Response are also objects 
});
</code></pre>
<p>Above code does nothing fancy. It simply logs out <code>Request object</code> to browser console.</p>

<p>Once we have the request object, we could intercept this request the way we wanted it to be. We'll do all this heroics later.</p>

<p>Seems easy till now? Ok, let's move to hardest, but most important, part.</p>

<h2>The Service Worker LifeCycle</h2>

<p>If we try to run above example in our browser and look at the console, we see below message </p>

<p><code>Congratulations!! Service Worker Registered</code> </p>

<p>But this message is for <strong>first time load</strong> only and when we <strong>refresh our page again then we get all request objects printed in console</strong>. </p>

<p>This behavior is due to the fact that when we first loaded the page there was no Service Worker registered so the listener for <code>fetch</code> event can't be triggered, so at the first, we could only see Service Worker being registered.</p>

<p>Now when we refreshed the page, a new web client is spawned and it saw that there is already a Service Worker registered against this domain so <code>fetch</code> event listener comes to action and we could see request objects printed in the browser console.</p>

<p>Now if you try to change something in your <code>fetch</code> event listener, let's suppose we change to this:- </p>
<pre><code>self.addEventListener( "fetch" , function (event) {
    //fetch request from event object 
    console.log("Resource requested is :- ",event.request.url);
});
</code></pre>
<p>And now if we refresh the page we could not see any change in the console. <strong>Seems weird???</strong></p>

<p>The main culprit for this kind of sin is the Service Worker lifecycle.</p>

<p>A Service Worker has a life cycle which consists of following stages:</p>

<ul>
<li>Install</li>
<li>Activate</li>
<li>Wait</li>
<li>Terminated/Redundant</li>
</ul>

<p>Let's analyze above scenario where we changed something and it was not reflected when we refreshed the page.</p>

<p>In this case, we already had an old Service Worker registered for the page in <code>active</code> state and when we refreshed the page, browser saw that the Service Worker file has been updated. It <code>installs</code> new Service worker but keeps this new one in <code>waiting state</code> because old one has not been <code>terminated</code>. The old one can only be terminated by closing all pages that reference it or by navigating to other domain over which this Service Worker has no control. If we terminate our Service Worker by the above-mentioned methods and again head over to our page we should see the changes in effect because now no active page was referencing an old Service Worker so new ones becomes <code>active</code> and old one becomes <code>redundant</code>. As soon as the new Service Worker takes control, it will fire an <code>activate</code> event.</p>

<p>Now, how, as a developer, do we know which state is our Service Worker in and how can we manually alter lifecycle to make our development easy.</p>

<p>Here comes Chrome Dev Tools to rescue. </p>

<p>In chrome dev tools [Can be opened by pressing F12 or CTRL+SHIFT+I or Ctrl+Shift+J].  Head over to <code>Application</code> panel and we can see a separate resource written as <code>Service Workers</code>. </p>

<p>Here, we can see in which state we are in. We can also manually unregister, update &amp; stop any Service Worker and we can also see when one was received.</p>

<p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--0Sys45L0--/c_limit,f_auto,fl_progressive,q_auto,w_725/https://cdn.scotch.io/1925/deRKdGFzScmthGVyv8h7_Capture.JPG" alt="" draggable="true" data-bukket-ext-bukket-draggable="true" class="loaded"></p>

<p>There is more to it.</p>

<p>Suppose we as a developer want that, every time we reload/change something in our page new Service Worker should be active without going to waiting state, we can do that too. But remember it only effects on developer's site, for this to become active on consumer site too we'll cover that in future ;).</p>

<p>For doing above mentioned, just check checkbox corresponding to Update on Reload.</p>

<p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--H9J-ehu1--/c_limit,f_auto,fl_progressive,q_auto,w_725/https://cdn.scotch.io/1925/RSHNC1ykQcCJTDDip8d3_Capture.JPG" alt="" draggable="true" data-bukket-ext-bukket-draggable="true" class="loaded"></p>

<p>You can also do more things like going offline for testing, bypassing network, using push and sync for Service Worker. All in all, there's great tooling support available for Service Workers now and it is fairly stable.</p>

<hr>

<h2>Let's Code</h2>

<p>We now have a basic understanding of all know hows of Service Worker. Let's go and see how can we use them in our applications.</p>

<p>Before getting our hands dirty in code, we'll recollect what we have learned so far.</p>

<ul>
<li>The Service Worker acts as a proxy between our browser and network.</li>
<li>These are essentially worker threads that run in a different context and has scope defined.</li>
<li>They run on HTTPS only exception is localhost.</li>
<li>A new Service Worker is kept on waiting state till all pages that reference old Service-worker have not been closed.</li>
</ul>

<p>Now, for the sake of programming something with the Service Worker API, we'll set up a project with a folder structure like below:</p>
<pre><code>- [styles/](https://github.com/tarungarg546/service-worker-intro/tree/master/styles)
- [fonts/](https://github.com/tarungarg546/service-worker-intro/tree/master/fonts)
- [scripts/](https://github.com/tarungarg546/service-worker-intro/tree/master/scripts)
- [index.html](https://github.com/tarungarg546/service-worker-intro/blob/master/index.html)
- [service-worker.js](https://github.com/tarungarg546/service-worker-intro/blob/master/service-worker.js)
</code></pre>
<p>Where <code>styles/</code> contain usual stylesheets, <code>fonts/</code> contains usual fonts, <code>scripts/contains</code> usual JavaScript files, <code>service-worker.js</code> is the file where we'll deal with Service Worker.</p>

<p>For styling purposes, we'll use bootstrap here because in this tutorial our main concern is using and deploying Service Worker, not styles.</p>

<p>Copy the following in <a href="https://github.com/tarungarg546/service-worker-intro/blob/master/index.html">index.html</a> :</p>
<pre><code>&lt;!DOCTYPE html&gt;
    &lt;!--Set Meta tags-->
    &lt;meta charset="UTF-8">
    &lt;meta name="description" content="Service Worker introductory tutorial">
    &lt;meta name="author" content="Tarun Garg">
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0">
    &lt;title>Service Workers intro&lt;/title>
    &lt;!-- Compiled and minified CSS -->
    &lt;link rel="stylesheet" href="styles/bootstrap.min.css">
    &lt;script type="text/javascript">
        //detect if browser supports Service Worker
        if('serviceWorker' in navigator) {  
            //browser supports now register it
            navigator.serviceWorker  
                   .register('service-worker.js') //Note that we have not passed scope object here now by default it will pick root scope 
                   .then(function() { 
                        console.log('Service Worker Registered'); 
                    })
                    .catch(function(err) {
                        console.error(err);
                    })
        } else {
            console.log("Ahh! Your browser does not supports serviceWorker");
        }
    &lt;/script>


    &lt;div class="container">
        Hello world!
    &lt;/div>
</code></pre>
<p>In the above snippet, we are registering a file named <code>service-worker.js</code> which has all Service Worker logic.</p>

<p>Now when we serve this for the first time, we will see <code>Service Worker Registered</code> message in our browser console.</p>

<p>Now in our <a href="https://github.com/tarungarg546/service-worker-intro/blob/b5191cdafda1e44e887e78b5e002101d0ffa4782/service-worker.js">service-worker.js</a>.<br>
Let's add code for <code>fetch</code> and <code>install</code> events.</p>
<pre><code>var log = console.log.bind(console);//bind our console to a variable
//Add event listener for install
self.addEventListener("install", function(event) {
    log('[ServiceWorker] Installed!');
});
//Add event listener for fetch
self.addEventListener("fetch", function(event) {
    log('[ServiceWorker] Requested url :-', event.request.url);
});
</code></pre>
<p>If we refresh our browser and head over to <code>Application</code> panel in our Chrome dev tools, we will see one the Service Worker in an active state and other is in waiting state. </p>

<p>We can now understand, why it's in a waiting state. To put it in a current state, either close and reopen this tab or go to any page that is not controlled by this Service Worker and come back. You will see correct console messages and Service Worker being active.</p>

<p>Until now, we have worked with the Service worker API in seldom now it's time to integrate it other API such as <code>Cache API</code>.</p>

<p>Since, Cache API is <strong>key-value store for Request and Response objects</strong> and have access to window scope as well as Service-worker scope.</p>

<p>Since next step in the Service worker lifecycle after registering is <code>installing</code> . So we'll cache all the resource in this event handler of Service Worker. And when we fetch we'll see if the requested resources are present in the cache or not, if they are present then return those cached files else fetch from the network.</p>

<p>Edit your <a href="https://github.com/tarungarg546/service-worker-intro/blob/ba2f511e50ce7e60bba8e20b79c2e5a167ab9bcb/service-worker.js">service-worker.js</a> with this :- </p>
<pre><code>var log = console.log.bind(console);//bind our console to a variable
var version = "0.0.1";
var cacheName = "sw-demo";
var cache = cacheName + "-" + version;
var filesToCache = [
                    'scripts/bootstrap.min.js',
                    'styles/bootstrap.min.css',
                    'index.html',
                    "/",//Note that this is different from below 
                    "/?app=true"//This is different from above in request object's terminology
                 ];

//Add event listener for install
self.addEventListener("install", function(event) {
    log('[ServiceWorker] Installing....');

    //service-worker will be in installing state till event.waitUntil completes
    event.waitUntil(caches
                        .open(cache)//open this cache from caches and it will return a Promise
                        .then(function(cache) { //catch that promise
                            log('[ServiceWorker] Caching files');
                            cache.addAll(filesToCache);//add all required files to cache it also returns a Promise
                        })
                    ); 
});

//Add event listener for fetch
self.addEventListener("fetch", function(event) {
    //note that event.request.URL gives URL of the request so you could also intercept request and send response based on your URL
    //e.g. you make want to send gif if anything in jpeg form is requested.
    event.respondWith(
    //it either expects a Response object as a parameter or a promise that resolves to a Response object
                        caches.match(event.request)//If there is a match in the cache of this request object
                            .then(function(response) {
                                if(response) {
                                    log("Fulfilling "+event.request.url+" from cache.");
                                    //returning response object
                                    return response;
                                } else {
                                    log(event.request.url+" not found in cache fetching from network.");
                                    //return promise that resolves to Response object
                                    return fetch(event.request);
                                }
                            })
                    );
});
</code></pre>
<p>In above code <code>install</code> and <code>fetch</code> looks easy. The important thing is <code>fileToCache</code> Array and <code>cache</code> which is just a variable which is a combination of <code>version</code> and <code>cacheName</code>.</p>

<p>We are maintaining version number because when we update any file present in the <code>fileToCache</code> array, Service Worker does not automatically pick up this change, the only change it picks up is a change in <code>service-worker.js</code> file itself. So, in those cases it's easy to just change the version then Service Worker would see that there are changes in its own code so it will install new Service Worker and in the process of installing new Service Worker it will cache new resource and put that in the new cache with separate version. You can check out the cache as below in chrome dev tools.</p>

<p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cYPOw3Q2--/c_limit,f_auto,fl_progressive,q_auto,w_725/https://cdn.scotch.io/1925/PuJCdMe3THutwf8XgNM2_Capture.JPG" alt="" draggable="true" data-bukket-ext-bukket-draggable="true" class="loaded"></p>

<p>Now if we change our version, our Service Worker will pick up that change and the new Service Worker will go through the same cycle of registering,  installing and then waiting, since the old Service Worker has not been terminated yet. And since new Service Worker is installed, the new cache will be created without affecting old version. That is the purpose of versioning. With a single keystroke, you can do all these things and simultaneously not breaking old caches.</p>

<p>When the future new Service Worker becomes active, what we ideally want is to delete old cache because it'll be no longer wanted. For this purpose, we will utilize <code>activate</code> event. </p>

<p>Update your <a href="https://github.com/tarungarg546/service-worker-intro/blob/da417281a4b36e70c2b2d0c0d6481a6f0600e4e3/service-worker.js">service-worker.js</a> with this :-</p>
<pre><code>var log = console.log.bind(console);//bind our console to a variable
var version = "0.0.2";
var cacheName = "sw-demo";
var cache = cacheName + "-" + version;
var filesToCache = [
                    'scripts/bootstrap.min.js',
                    'styles/bootstrap.min.css',
                    'index.html',
                    "/",//Note that this is different from below 
                    "/?app=true"//This is different from above in request object's terminology
                 ];

//Add event listener for install
self.addEventListener("install", function(event) {
    log('[ServiceWorker] Installing....');
    event.waitUntil(caches
                        .open(cache)//open this cache from caches and it will return a Promise
                        .then(function(cache) { //catch that promise
                            log('[ServiceWorker] Caching files');
                            cache.addAll(filesToCache);//add all required files to cache it also returns a Promise
                        })
                    ); 
});

//Add event listener for fetch
self.addEventListener("fetch", function(event) {
    //note that event.request.url gives URL of the request so you could also intercept the request and send a response based on your URL
    //e.g. you make want to send gif if anything in jpeg form is requested.
    event.respondWith(//it either takes a Response object as a parameter or a promise that resolves to a Response object
                        caches.match(event.request)//If there is a match in the cache of this request object
                            .then(function(response) {
                                if(response) {
                                    log("Fulfilling "+event.request.url+" from cache.");
                                    //returning response object
                                    return response;
                                } else {
                                    log(event.request.url+" not found in cache fetching from network.");
                                    //return promise that resolves to Response object
                                    return fetch(event.request);
                                }
                            })
                    );
});

self.addEventListener('activate', function(event) {
  log('[ServiceWorker] Activate');
  event.waitUntil(
                    caches.keys()//it will return all the keys in the cache as an array
                    .then(function(keyList) {
                            //run everything in parallel using Promise.all()
                            Promise.all(keyList.map(function(key) {
                                    if (key !== cacheName) {
                                        log('[ServiceWorker] Removing old cache ', key);
                                        //if key doesn`t matches with present key
                                        return caches.delete(key);
                                    }
                                })
                            );
                        })
                );
});
</code></pre>
<p>In the above code, we are getting all keys from the cache and then checking if a key does not equal to current cache name then delete it. </p>

<p>Now if you try to go offline and reload the page you'll still see your web app working as if you are online because when you do a network request it is being intercepted and fulfilled from the cache. This way, you can give your user a soothing experience of your web app when there is no internet OR slow internet on user's site.</p>

<p>This is just a small tutorial to get you started with Service Workers. There is a lot more to it but for "getting started", this should work as a tonic.</p>

<p>Hope you enjoyed this post :).</p>

  </div>
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
				<!--================= START :: Tutorial =================-->
				<article style="display:none;">
					<a id="t1" name="t1"></a><h1>Index</h1>
					<span class="ref-site"></span>
					<div class="tutorial__content">
						
					</div>
				</article>
				<!--================= END :: Tutorial =================-->
				
			</section>
			
		</main>
	
			</body></html>