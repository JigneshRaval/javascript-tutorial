<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Javascript :: Part 3</title>
		<meta name="title" content="" />
		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!--<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>-->
		<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i|PT+Serif:400,700" rel="stylesheet">
		<style>
			body { 
			font-family: 'Open Sans', sans-serif;
			font-size: 15px;
			line-height: 1.8;
			padding: 0.5em;
			font-family: 'PT Sans', sans-serif;;
			}
			img { display: block; margin: 0 auto; max-width: 100%; }
			pre { border: 1px dashed #333; padding: 1em 2em; font-family: Consolas,monospace; background-color: #EEE; overflow-x: scroll; font-size: 0.8em;  white-space: pre-wrap; word-wrap: break-word; }
			code { background-color: #EEE; padding: 3px; font-family: Consolas,monospace; }
			pre code { background-color: transparent; padding: 0;}
			h1 { font-size: 1.8em; border-bottom: 2px solid #000; font-family: 'PT Serif', serif; padding: 10px 0; margin: 0; }
			h2 { 
			font-size: 1.2em;
			font-family: 'PT Serif', serif;
			padding-left: 1em;
			border-left: 2px solid; 
			}
			.cf:before,
.cf:after {
    content: " ";
    display: table;
}
.cf:after {
    clear: both;
}
		</style>	
	</head>
	<body>
	
		<main class="main">
			
			<section class="section__one">
			
			<!-- START :: Tutorial -->
				<article>
					<h1>Dealing with Design Patterns</h1>
					<div class="tutorial__content">
	<h2>Introduction</h2>
	<p class="readmore">Last months I was dealing with Design Patterns, trying to understand how them work and how to implement in javascript, because of the Didgeridoo IDE development, and today I'll write about Module Pattern and Module Revealing Pattern. These are the ones I used for a part of the Didgeridoo project.</p>

	<p>By the way, it's better if you know something about Design Patterns before. Creational Patterns, Structural Patterns and Behavioral Patterns. That three categories you should keep in mind (There also exist Concurrency Patterns, but I will not write about these for now).</p>

	<h2>Brief Descriptions</h2>
	<h3>Creational Patterns:</h3>
	<p>This kind of patterns define the way objects are created in a manner that they can be decoupled from the system. Some of those are:</p>
	<ul>
		<li>Abstract Factory</li>
		<li>Builder</li>
		<li>Factory Method</li>
		<li>Prototype</li>
		<li>Singleton</li>
	</ul>
	<h3>Structural Patterns:</h3>
	<p>This kind of patterns define the way classes and/or objects are structured. Some of those are:</p>
	<ul>
		<li>Adapter</li>
		<li>Bridge</li>
		<li>Composite</li>
		<li>Decorator</li>
		<li>Facade</li>
		<li>Flyweight</li>
		<li>Proxy</li>
	</ul>
	<h3>Behavioral Patterns:</h3>
	<p>This kind of patterns define the way classes and/or objects behave when used to manage algorithms, relationships and responsibilities between them. Some of those are:</p>
	<ul>
		<li>Chain of Responsibility</li>
		<li>Command</li>
		<li>Interpreter</li>
		<li>Iterator</li>
		<li>Mediator</li>
		<li>Memento</li>
		<li>Observer</li>
		<li>State</li>
		<li>Strategy</li>
		<li>Template Method</li>
		<li>Visitor</li>
	</ul>
	<h2>The Module Pattern</h2>

	<p>As of some programming languages provide mechanism for Module Pattern, in javascript we have to get a little bit tricky to simulate it.</p>

	<pre><code class="js hljs ">
<span class="hljs-keyword">var</span> basketModule = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> basket = []; <span class="hljs-comment">//private</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomethingPrivate</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-comment">//...</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomethingElsePrivate</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-comment">//...</span>
    }
    <span class="hljs-keyword">return</span> { <span class="hljs-comment">//exposed to public</span>
        addItem: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(values)</span> {</span>
            basket.push(values);
        },
        getItemCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> basket.length;
        },
        doSomething: doSomethingPrivate(),
        getTotal: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
           <span class="hljs-keyword">var</span> q = <span class="hljs-keyword">this</span>.getItemCount(),p=<span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span>(q--){
                p+= basket[q].price;
            }
            <span class="hljs-keyword">return</span> p;
        }
    }
}());

<span class="hljs-comment">//basketModule is an object with properties which can also be methods</span>
basketModule.addItem({item:<span class="hljs-string">'bread'</span>,price:<span class="hljs-number">0.5</span>});
basketModule.addItem({item:<span class="hljs-string">'butter'</span>,price:<span class="hljs-number">0.3</span>});

console.log(basketModule.getItemCount());
console.log(basketModule.getTotal());

<span class="hljs-comment">//however, the following will not work:</span>
console.log(basketModule.basket);<span class="hljs-comment">// (undefined as not inside the returned object)</span>
console.log(basket); <span class="hljs-comment">//(only exists within the scope of the closure)</span>
	</code></pre>

	<p>
		<em><small>Example by Addy Osmani (<a title="Essential Javascript Design Patterns" href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/" target="_blank">http://addyosmani.com/resources/essentialjsdesignpatterns/book/</a>).</small></em>
	</p>

	<p>At the beginning, the Module Pattern in javascript was thought as a way to simulate Classes with their own Execution Contexts and Scope in a DRY (Don't Repeat Yourself) manner. To understand how we can simulate modules in javascript, first we have to know about the concept of <a title="Closures" href="http://jibbering.com/faq/notes/closures/" target="_blank">Closures</a>.</p>

	<p>In the example above you can see that the public part is done by returning an object, which acts like an interface for the basketModule module. And there also exists a private part that has its own scope and maintain chainability with the global scope. That way, public parts of your code are able to touch the private parts, however the outside world is unable to touch the class's private parts (nice joke Addy Osmani and David Engfer).</p>

	<p>Note that the Module Pattern itself belongs to Creational Patterns, due to this define the way you should create the objects/modules, and also belongs to Structural Patterns, due to the nature of organizing the code in modules is a way of code structuring. So, many people, consider the Module Pattern as a different kind of "category" apart from the others. I think it's just a pattern that define both aspects (creational and structural).</p>

	<h2>The Revealing Module Pattern</h2>

	<p>This pattern is an improved version of the Module Pattern by Christian Heilmann (Mozilla).</p>
	<p>It consists in a better way of organizing the code, like not writing the code of the public methods in the returning part of the code, but pointing to them in the private part. In other words, define all your methods and variables in the private part and keep the public part clean, as follow:</p>

	<pre><code class="js hljs ">
<span class="hljs-keyword">var</span>&nbsp;myRevealingModule&nbsp;=&nbsp;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>

    <span class="hljs-keyword">var</span>&nbsp;name&nbsp;=&nbsp;<span class="hljs-string">'John Smith'</span>;
    <span class="hljs-keyword">var</span>&nbsp;age&nbsp;=&nbsp;<span class="hljs-number">40</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">updatePerson</span><span class="hljs-params">()</span>{</span>
        name&nbsp;=&nbsp;<span class="hljs-string">'John&nbsp;Smith&nbsp;Updated'</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">setPerson</span>&nbsp;<span class="hljs-params">()</span>&nbsp;{</span>
        name&nbsp;=&nbsp;<span class="hljs-string">'John&nbsp;Smith&nbsp;Set'</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title">getPerson</span>&nbsp;<span class="hljs-params">()</span>&nbsp;{</span>
        <span class="hljs-keyword">return</span>&nbsp;name;
    }

    <span class="hljs-comment">//Public interface</span>
    <span class="hljs-keyword">return</span> {
        set:&nbsp;setPerson,
        get:&nbsp;getPerson
    };
}());

<span class="hljs-comment">// Sample usage:</span>
myRevealingModule.get();
	</code></pre>

	<p>It seems like there's no difference but it will help you to maintain your code well organized and clean.</p>

					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Index</h1>
					<div class="tutorial__content">

<p>This post will go over the Javascript language from the point of view of a Java developer, focusing on the differences between the two languages and the frequent pain points. We will go over the following:</p>

<ul>
<li>Objects Only, No Classes</li>
<li>Functions are just Values</li>
<li>The 'this' Keyword </li>
<li>Classic vs Prototypal Inheritance</li>
<li>Constructors vs Constructor Functions</li>
<li>Closures vs Lambdas</li>
<li>Encapsulation and Modules</li>
<li>Block Scope and Hoisting </li>
</ul>

<h3 id="whyjavascriptinthejavaworld">Why Javascript in the Java World ?</h3>

<p>A lot of Java frontend development work is done using Java/XML based frameworks like JSF or GWT. The framework developers themselves need to know Javascript, but in principle the application developers don't. However the reality is that:</p>

<ul>
<li>For doing custom component development in for example Primefaces (JSF), it's important to know Javascript and jQuery. </li>
<li>In GWT, integrating at least some third-party Javascript widgets is common and cost effective.</li>
</ul>

<p>The end result is that Javascript is usually needed to do at least the last 5 to 10% of frontend work, even using Java frameworks. Also it's starting to get more and more used for polyglot enterprise development, alongside <a href="http://angularjs.org">Angular</a> for example.</p>

<p>The good news is that, besides a few gotchas that we will get into, Javascript is a very learneable language for a Java developer. </p>

<h3 id="objectsonlynoclasses">Objects Only - No Classes</h3>

<p>One of the most surprising things about Javascript is that although it's an object oriented language, there are no classes (although the <a href="http://wiki.ecmascript.org/doku.php?id=harmony:classes">new Ecmascript 6 version</a> will have them).</p>

<p>Take for example this program, that initializes an empty object and set's two properties:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=01-object-example.js"></script>

<p>Javascript objects are just like a Java HashMap of related properties, where the keys are Strings only. The following would be the 'equivalent' Java code:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=02-map-example.js"></script>

<p>This means that a Javascript object is just a multi-level 'hash map' of key/value pairs, with no class definition needed. </p>

<h3 id="functionsarejustvalues">Functions Are Just Values</h3>

<p>Functions in Javascript are just values of type <code>Function</code>, it's a simple as that! Take for example:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=03-functions-are-just-values.js"></script>

<p>This creates a function (a value of type <code>Function</code>) and assigns it to a variable <code>flyFunction</code>. A new property named <code>fly</code> is then created in the superhero object, that can be invoked like this:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=04-fly.js"></script>

<p>Java does <strong>not</strong> have the equivalent of the Javascript <code>Function</code> type, but almost.  Take for example the <code>SuperHero</code> class that takes a <code>Power</code> function:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=05-interface.java"></script>

<p>This is how to pass <code>SuperHero</code> a function in Java 7 and 8:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=06-java8-equivalent.java"></script>

<p>So although a <code>Function</code> type does not exist in Java 8, this ends up not preventing a 'Javascript-like' functional programming style. </p>

<p>But if we pass functions around, what happens to the meaning of the <br />
<code>this</code> keyword?</p>

<h3 id="thethiskeywordusage">The 'this' Keyword Usage</h3>

<p>What Javascript allows to do with <code>this</code> is quite surprising compared to the Java world. Let's start with an example:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=07-this-keyword.js"></script>

<p>This program creates an object <code>superman</code> with two properties: a String <br />
<code>heroName</code> and a <code>Function</code> named <code>sayHello</code>. Running this program outputs as expected <code>Hello, I'm Superman</code>. </p>

<h4 id="whatifwepassthefunctionaround">What if we pass the function around?</h4>

<p>By passing around <code>sayHello</code>, we can easily end up in a context where there is no <code>heroName</code> property:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=08-pass-function.js"></script>

<p>Running this snippet would give as output: <code>Hello, I'm undefined</code>. </p>

<h4 id="whydoesthisnotworkanymore">Why does <code>this</code> not work anymore?</h4>

<p>This is because the variable <code>failThis</code> belongs to the global scope, which contains no member variable named <code>heroName</code>.  To solve this:</p>

<blockquote>
  <p>In Javascript the value of the <code>this</code> keyword is completely overridable to be anything that we want!</p>
</blockquote>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=09-override-this.js"></script>

<p>The snippet above would print again <code>Hello, I'm Superman</code>. This means that the value of <code>this</code> depends on both the context on which the function is called, and on <em>how</em> the function is called.</p>

<h3 id="classicvsprototypalinheritance">Classic vs Prototypal Inheritance</h3>

<p>In Javascript, there is no class inheritance, instead objects can inherit directly from other objects. The way this works is that each object has an implicit property that points to a 'parent' object.</p>

<p>That property is called <code>__proto__</code>, and the parent object is called the object's <strong>prototype</strong>, hence the name Prototypal Inheritance.  </p>

<h4 id="howdoesprototypework">How does <code>prototype</code> work?</h4>

<p>When looking up a property, Javascript will try to find the property in the object itself. If it does not find it then it tries in it's prototype, and so on. For example:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=10-prototype.js"></script>

<p>This snippet will output <code>Iron Man is copyrighted by Marvel</code>. </p>

<p>As we can see, although the <code>ironMan</code> object is empty, it's prototype does contain the property <code>editor</code>, which get's found. </p>

<h4 id="howdoesthiscomparewithjavainheritance">How does this compare with Java inheritance?</h4>

<p>Let's now say that the rights for the Avengers where bought by DC Comics:</p>

<pre><code>avengersHero.editor = 'DC Comics';
</code></pre>

<p>If we call <code>ironMan.editor</code> again, we now get <code>Iron Man is copyrighted by DC Comics</code>. All the existing object instances with the <code>avengersHero</code> prototype now see <code>DC Comics</code> <em>without</em> having to be recreated.</p>

<p>This mechanism is very simple and very powerful. Anything that can be done with class inheritance can be done with prototypal inheritance. But what about constructors?</p>

<h3 id="constructorsvsconstructorfunctions">Constructors vs Constructor Functions</h3>

<p>In Javascript an attempt was made to make object creation similar to  languages like Java. Let's take for example:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=11-constructor-functions.js"></script>

<p>Notice the capitalized name, indicating that it's a constructor function. Let's see how it can be used:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=13-constructor-functions.js"></script>

<p>This code snippet outputs <code>Hello, my name is Superman</code>. </p>

<p>You might think that this looks just like Java, and that is exactly the point! What this <code>new</code> syntax really does is to it creates a new empty object, and then calls the constructor function by forcing <code>this</code> to be the newly created object.</p>

<h4 id="whyisthissyntaxnotrecommendedthen">Why is this syntax not recommended then?</h4>

<p>Let's say that we want to specify that all super heroes have a <br />
<code>sayHello</code> method. This could be done by putting the <code>sayHello</code> function in a common prototype object:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=14-prototypical-inheritance.js"></script>

<p>This would output <code>Hello, my name is Superman</code>. </p>

<p>But the syntax <code>SuperHero.prototype.sayHello</code> looks anything but Java like! The <code>new</code> operator mechanism sort of half looks like Java but at the same time is completely different.</p>

<h4 id="istherearecommendedalternativetonew">Is there a recommended alternative to <code>new</code>?</h4>

<p>The recommended way to go is to ignore the Javascript <code>new</code> operator altogether  and use <code>Object.create</code>:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=15-alternative-to-new.js"></script>

<p>Unlike the <code>new</code> operator, one thing that Javascript absolutely got right where Closures.</p>

<h3 id="closuresvslambdas">Closures vs Lambdas</h3>

<p>Javascript Closures are not that different from Java anonymous inner classes used in a certain way. take for example the <code>FlyingHero</code> class:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=16-closures-vs-lambdas.java"></script>

<p>We can can pass it a fly command like this in Java 8:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=17-fly-command.java"></script>

<p>The output of this snippet is <code>Flying to Mars</code>. Notice that the  <code>FlyCommand</code> lambda had to 'remember' the variable <code>destination</code>, because it needs it for executing the <code>fly</code> method later.</p>

<p>This notion of a function that remembers about variables outside it's block scope for later use is called a <strong>Closure</strong> in Javascript. For further details, have a look at this blog post <a href="http://blog.jhades.org/really-understanding-javascript-closures/">Really Understanding Javascript Closures</a>.</p>

<h4 id="whatisthemaindifferencebetweenlambdasandclosures">What is the main difference between Lambdas and Closures?</h4>

<p>In Javascript a closure looks like this:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=18-closures.js"></script>

<p>The Javascript closure, unlike the Java Lambda does not have the constraint that the <code>destination</code> variable must be immutable (or effectively immutable since Java 8).</p>

<p>This seemingly innocuous difference is actually a 'killer' feature of Javascript closures, because it allows them to be used for creating encapsulated modules.</p>

<h3 id="modulesandencapsulation">Modules and Encapsulation</h3>

<p>There are no classes in Javascript and no <code>public</code>/ <code>private</code> modifiers, but then again take a look at this:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=19-modules.js"></script>

<p>Here a function <code>createHero</code> is being defined, which returns an object which has a function <code>fly</code>. The <code>fly</code> function 'remembers' <code>name</code> when needed. </p>

<h4 id="howdoclosuresrelatetoencapsulation">How do Closures relate to Encapsulation?</h4>

<p>When the <code>createHero</code> function returns, noone else will ever be able to directly access <code>name</code>, except via <code>fly</code>. Let's try this out:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=20-closures-encapsulation.js"></script>

<p>The output of this snippet is <code>SuperMan flying to The Moon</code>. But happens if we try to access <code>name</code> directly ?</p>

<pre><code>console.log('Hero name = ' + superman.name);  
</code></pre>

<p>The result is <code>Hero name = undefined</code>. The function <code>createHero</code> is said to a be a Javascript encapsulated <strong>module</strong>, with closed 'private' member variables and a 'public' interface returned as an object with functions.</p>

<h3 id="blockscopeandhoisting">Block Scope and Hoisting</h3>

<p>Understanding block scope in Javascript is simple: there is no block scope! Take a look at this example:</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=21-block-scoping.js"></script>

<p>By looking at this coming from Java, you might expect:</p>

<ul>
<li>error at line 3: 'variable i does not exist'</li>
<li>values 0, 1, 2 are printed </li>
<li>error at line 9: 'variable i does not exist'</li>
</ul>

<p>It turns out that only one of these three things is true, and the output is actually this:</p>

<pre><code>counter before declaration = undefined  
counter = 0 
counter = 1 
counter = 2 
counter after loop = 3 
</code></pre>

<p>Because there is no block scope, the loop variable i is visible for the <strong>whole</strong> function. This means:</p>

<ul>
<li>line 3 sees the variable declared but not initialized</li>
<li>line 9 sees i after the loop has terminated</li>
</ul>

<p>What might be the most puzzling is that line 3 actually sees the variable declared but undefined, instead of throwing <code>i is not defined</code>.</p>

<p>This is because the Javascript interpreter first scans the function for a list of variables, and then goes back to interpret the function code lines one by one.</p>

<p>The end result is that it's like the variable i was <strong>hoisted</strong> to the top, and this is what the Javascript runtime actually 'sees':</p>

<script src="https://gist.github.com/jhades/0ff91346682e257b91550518b0c60a5d.js?file=32-hosting-sees.js"></script>

<p>To prevent surprises caused by hoisting and lack of block scoping, it's a recommended practice to declare variables always at the top of functions.</p>

<p>This makes hoisting explicit and visible by the developer, and helps to avoid bugs. The next version of Javascript (Ecmascript 6) will include a <a href="http://wiki.ecmascript.org/doku.php?id=harmony:let">new keyword 'let' to allow block scoping</a>.</p>

<h3 id="conclusions">Conclusions</h3>

<p>The Javascript language shares a lot of similarities with Java, but also some huge differences. Some of the differences like inheritance and constructor functions are important, but much less than one would expect for day to day programming.</p>

<p>Some of these features are needed mostly by library developers, and not necessarily for day to day application programming. This is unlike some of their Java counterparts which are needed every day.</p>

<p>So if you are hesitant to give it a try, don't let some of these features prevent you from going further into the language. </p>

<p>One thing is for sure, at least <em>some</em> Javascript is more or less inevitable when doing Java frontend development, so it's really worth to give it a try. </p>

<h3 id="ifyouareinterestedintypesafefrontenddevelopment">If you are interested in Type-Safe Frontend Development</h3>

<p>If that is the case, you might want to have a look at our ongoing YouTube course on Angular 2 - Getting Started With Angular 2:</p>

					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Seven JavaScript Quirks I Wish I’d Known About</h1>
					<div class="tutorial__content">

          

          <p>If you are new to JavaScript or it has only been a minor part of your development effort until recently, you may be feeling frustrated. All languages have their quirks – but the paradigm shift from strongly typed server-side languages to JavaScript can feel especially confusing at times. I’ve been there! A few years ago, when I was thrust into full time JavaScript development, there were <em>many</em> things I wish I’d known going into it. In this article, I’ll share a few of these quirks in hopes that I might spare you some of the headaches I endured. This isn’t an exhaustive list – just a sampling – but hopefully it will shed some light on the language as well as show how powerful it can be once you get past these kinds of hurdles.</p>
<h4>The Quirks We’ll look at:</h4>
<ol>
<li><a href="#equality">Equality</a></li>
<li><a href="#notation">Dot Notation vs Bracket Notation</a></li>
<li><a href="#functions">Function Context</a></li>
<li><a href="#expdec">Function Declarations vs Function Expressions</a></li>
<li><a href="#anon">Named vs Anonymous Functions</a></li>
<li><a href="#iife">Immediately Invoked Function Expressions</a></li>
<li><a href="#typechecking"><code>typeof</code> vs <code>Object.prototype.toString</code></a></li>
</ol>
<h2 id="equality">1.) Equality</h2>
<p>Coming from C#, I was well familiar with the <code>==</code> comparison operator. Value types (&amp; strings) are either equal (have the same value) or they aren’t. Reference types are either equal – as in pointing to the same reference – or NOT. (Let’s just pretend you’re not overloading the <code>==</code> operator, or implementing your own <code>Equals</code> and <code>GetHashCode</code> methods.) I was surprised to learn that JavaScript has <em>two</em> equality operators: <code>==</code> and <code>===</code>. Most of the code I’d initially seen used <code>==</code>, so I followed suit and wasn’t aware of what JavaScript was doing for me as I ran code like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"YAY! They're equal!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>So what dark magic is <em>this</em>? How can the <em>integer</em> 1 equal the <em>string</em> “1”?</p>
<p>In JavaScript, there’s equality (<code>==</code>) and then there’s <em>strict</em> equality (<code>===</code>). The equality comparison operator will coerce the operands to the same type and <em>then</em> perform a strict equality comparison. So in the above example, the string “1” is being converted, behind the scenes, to the integer 1, and then compared to our variable <code>x</code>.</p>
<p>Strict equality doesn’t coerce the types for you. If the operands aren’t of the same type (as in the integer 1 and string “1”), then they <em>aren’t</em> equal:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// with strict equality, the types must be the *same* for it to be true
</span><span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"Sadly, I'll never write this to the console"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"YES! Strict Equality FTW."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>You might already be thinking of the kinds of horrors that could occur when type coercion is done for you – the sort of assumptions that you could make that misrepresent the true nature of the values in your app which lead to difficult-to-find-yet-hiding-in-plain-sight bugs. It’s no surprise, then, that the general rule of thumb recommended by experienced JavaScript developers is to <em>always use strict equality</em>.</p>
<h2 id="notation">2.) Dot Notation vs Bracket Notation</h2>
<p>Depending on what other languages you hail from, you probably weren’t too surprised to see these forms of accessing a property on an object and accessing an element in an array in JavaScript:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token comment" spellcheck="true">// getting the "firstName" value from the person object:
</span><span class="token keyword">var</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span>firstName<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// getting the 3rd element in an array:
</span><span class="token keyword">var</span> theOneWeWant <span class="token operator">=</span> myArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // remember, 0-based index</span></code></pre>
<p>However, did you know it’s possible to use bracket notation to reference object members as well? For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> name <span class="token operator">=</span> person<span class="token punctuation">[</span><span class="token string">"firstName"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>Why would this be useful? While you’ll probably use dot notation the majority of the time, there are a few instances where bracket notation makes certain approaches possible that couldn’t be done otherwise. For example, I will often refactor large <code>switch</code> statements into a <a href="https://en.wikipedia.org/wiki/Dispatch_table">dispatch table</a>, so that something like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> doSomething <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doWhat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">switch<span class="token punctuation">(</span></span>doWhat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        case <span class="token string">"doThisThing"</span><span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // more code...
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
        case <span class="token string">"doThatThing"</span><span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // more code...
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
        case <span class="token string">"doThisOtherThing"</span><span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // more code....
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token comment" spellcheck="true"> // additional cases here, etc.
</span>        default<span class="token punctuation">:</span>
           <span class="token comment" spellcheck="true"> // default behavior
</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Can be transformed into something like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> thingsWeCanDo <span class="token operator">=</span> <span class="token punctuation">{</span>
    doThisThing      <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    doThatThing      <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    doThisOtherThing <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    default          <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* behavior */</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> doSomething <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doWhat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> thingToDo <span class="token operator">=</span> thingsWeCanDo<span class="token punctuation">.</span><span class="token function">hasOwnProperty<span class="token punctuation">(</span></span>doWhat<span class="token punctuation">)</span> <span class="token operator">?</span> doWhat <span class="token punctuation">:</span> <span class="token string">"default"</span>
    thingsWeCanDo<span class="token punctuation">[</span>thingToDo<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>There’s nothing inherently wrong with using a <code>switch</code> (and in many cases, if you’re iterating and performance is a huge concern, a <code>switch</code> may outperform the dispatch table). However, dispatch tables offer a nice way to organize and extend behavior, and bracket notation makes it possible by allowing you to reference a property dynamically at runtime.</p>
<h2 id="functions">3.) Function Context</h2>
<p>There have been a number of great blog posts about properly understanding the “<code>this</code> context” in JavaScript (and I’ll link to several at the bottom of this post), but it definitely makes my list of “things I wish I’d known” right away. It’s really not difficult to look at code and confidently know what <code>this</code> is at any point – you just have to learn a couple of rules. Unfortunately, many explanations I read about it early on just added to my confusion. As a result, I’ve tried to simplify the explanation for developers new to JavaScript.</p>
<h3>First – Start With a Global Assumption</h3>
<p>By default, until there’s a reason for the execution context to change, <code>this</code> refers to the <em>global object</em>. In the browser, that would be the <code>window</code> object (or <code>global</code> in node.js).</p>
<h3>Second – the Value of <code>this</code> in Methods</h3>
<p>When you have an object with a member that is a function, invoking that method <em>from the parent object</em> makes <code>this</code> the parent object. For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> marty <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Marty"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"McFly"</span><span class="token punctuation">,</span>
    timeTravel<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

marty<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span><span class="token number">1955</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Marty McFly is time traveling to 1955</span></code></pre>
<p>You might already know that you can take the <code>marty</code> object’s <code>timeTravel</code> method and create a new reference to it from another object. This is actually quite a powerful feature of JavaScript – enabling us to apply behavior (functions) to more than one target instance:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> doc <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Emmett"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"Brown"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

doc<span class="token punctuation">.</span>timeTravel <span class="token operator">=</span> marty<span class="token punctuation">.</span>timeTravel<span class="token punctuation">;</span></code></pre>
<p>So – what happens if we invoke <code>doc.timeTravel(1885)</code>?</p>
<pre class=" language-javascript"><code class=" language-javascript">doc<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span><span class="token number">1885</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Emmett Brown is time traveling to 1885</span></code></pre>
<p>Again – deep dark magic. Well, not really. Remember, when you’re invoking a <em>method</em>, the <code>this</code> context is the parent object it’s being invoked from. Hold on to your DeLoreans, though, cause it’s about the get heavy.</p>
<div style="font-size:x-small;font-style:italic">(Note: I’ve updated this section for clarity and to make some corrections from the original post.)</div>
<p>What happens when we save a reference to the <code>marty.TimeTravel</code> method and invoke our saved reference? Let’s look:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> getBackInTime <span class="token operator">=</span> marty<span class="token punctuation">.</span>timeTravel<span class="token punctuation">;</span>
<span class="token function">getBackInTime<span class="token punctuation">(</span></span><span class="token number">2014</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// undefined undefined is time traveling to 2014</span></code></pre>
<p>Why “undefined undefined”?! Why not “Marty McFly”?</p>
<p>Let’s ask an important question: <em>What’s the parent/owning object when we invoke our <code>getBackInTime</code> function?</em> While the <code>getBackInTime</code> function will technically exist on the window, we’re invoking it as a <em>function</em>, not a method of an object. When we invoke a function like this – with no owning object – the <code>this</code> context will be the global object. <a href="http://davidshariff.com/blog/javascript-this-keyword/">David Shariff</a> has a great way of describing this: </p>
<blockquote><p>
Whenever a function is called, we must look at the immediate left side of the brackets / parentheses “()”. If on the left side of the parentheses we can see a reference, then the value of “this” passed to the function call is exactly of which that object belongs to, otherwise it is the global object.
</p></blockquote>
<p>Since <code>getBackInTime</code>‘s <code>this</code> context is the <code>window</code> – which does not have <code>firstName</code> and <code>lastName</code> properties – that explains why we see “undefined undefined”.</p>
<p>So we know that invoking a function directly – no owning object – results in the <code>this</code> context being the global object. But I also said that I knew our <code>getBackInTime</code> function would exist on the window. How do I know this? Well, unless I’ve wrapped the <code>getBackInTime</code> in a different scope (which we’ll investigate when we discuss immediately-invoked-function-expressions), then any vars I declare get attached to the window. Here’s proof from Chrome’s console:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_1.png"><img class="alignnone size-full wp-image-491" alt="jsquirks_afjq_1" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_1.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_1.png 1522w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_1-300x28.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_1-1024x96.png 1024w"></a></p>
<p>This is the perfect time to talk about one of the main areas that <code>this</code> trips up developers: subscribing event handlers.</p>
<h3>Third (really just an extension of #2) – The Value of <code>this</code> in Methods When Invoked Asynchronously</h3>
<p>So, let’s pretend we want to invoke our <code>marty.timeTravel</code> method when someone clicks a button:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> flux <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById<span class="token punctuation">(</span></span><span class="token string">"flux-capacitor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
flux<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> marty<span class="token punctuation">.</span>timeTravel<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>With the above code, when the user clicks the button, we’ll see “undefined undefined is time traveling to [object MouseEvent]”. WAT?! Well – the first, and most obvious, issue is that we’re not providing the <code>year</code> argument to our <code>timeTravel</code> method. Instead, we subscribed the method directly as an event handler, and the <code>MouseEvent</code> argument is being passed to the event handler as the first arg. That’s easy to fix, but the real issue is that we’re seeing “undefined undefined” again. Don’t despair – you already know why this is the case (even if you don’t realize it yet). Let’s make a change to our <code>timeTravel</code> function to log whatever <code>this</code> is to help give us some insight:</p>
<pre class=" language-javascript"><code class=" language-javascript">marty<span class="token punctuation">.</span>timeTravel <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Now – when we click the button, we should see something similar to the following output in our browser console:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_2.png"><img class="alignnone size-full wp-image-501" alt="jsquirks_afjq_2" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_2.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_2.png 970w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_2-300x25.png 300w" ></a></p>
<p>Our second <code>console.log</code> shows us the <code>this</code> context when the method was invoked – and it’s the actual button element which we subscribed to. Does this surprise you? Just like earlier – when we assigned the <code>marty.timeTravel</code> reference to our <code>getBackInTime</code> var – a reference to <code>marty.timeTravel</code> was saved as our event handler and is being invoked, but not from the “owning” <code>marty</code> object. In this case, it’s being invoked asynchronously by the underlying <a href="http://en.wikipedia.org/wiki/Event-driven_architecture">event emitting</a> implementation of the button element instance.</p>
<p>So – is it possible make <code>this</code> what we want it to be? Absolutely! In this case, the solution is deceptively simple. Instead of subscribing <code>marty.timeTravel</code> directly as the event handler, we can use an anonymous function as our event handler, and call marty.timeTravel from within it. This also provides the opportunity to fix our issue with the missing <code>year</code> parameter.</p>
<pre class=" language-javascript"><code class=" language-javascript">flux<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    marty<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span>someYearValue<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Clicking the button now will result in something similar to this output on the console:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquicks_afjq_3.png"><img class="alignnone size-full wp-image-511" alt="jsquicks_afjq_3" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquicks_afjq_3.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquicks_afjq_3.png 1134w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquicks_afjq_3-300x24.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquicks_afjq_3-1024x83.png 1024w" ></a></p>
<p>Success! But why did this work? Think of how we’re invoking the <code>timeTravel</code> method. In our first button click example, we subscribed the method reference <em>itself</em> as the event handler, so it was not being called from the parent object of <code>marty</code>. In the second example, it’s our anonymous function that will have a <code>this</code> of the button element, and when we invoke <code>marty.timeTravel</code>, we’re calling it from the <code>marty</code> parent object, and the <code>this</code> will be <code>marty</code>.</p>
<h3>Fourth – The Value of <code>this</code> Inside Constructor Functions.</h3>
<p>When you use a constructor function to create a new instance of an object, the <code>this</code> value inside the function is the new object that’s being created. For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> TimeTraveler <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fName<span class="token punctuation">,</span> lName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>firstName <span class="token operator">=</span> fName<span class="token punctuation">;</span>
    this<span class="token punctuation">.</span>lastName <span class="token operator">=</span> lName<span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true"> // Constructor functions return the
</span>   <span class="token comment" spellcheck="true"> // newly created object for us unless
</span>   <span class="token comment" spellcheck="true"> // we specifically return something else
</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> marty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimeTraveler</span><span class="token punctuation">(</span><span class="token string">"Marty"</span><span class="token punctuation">,</span> <span class="token string">"McFly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>marty<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> marty<span class="token punctuation">.</span>lastName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Marty McFly</span></code></pre>
<h3>Using Call, Apply &amp; Bind</h3>
<p>You might already suspect, given the above examples, that there might be some language-level features that would allow us to invoke a function and tell it at runtime what <code>this</code> should be. You’d be right. The <code>call</code> and <code>apply</code> methods that exist on the <code>Function</code> prototype both allow us to invoke a function and pass in a <code>this</code> value.</p>
<p><code>call</code>‘s method signature takes the <code>this</code> arg, followed by the parameters the function being invoked would take as separate arguments:</p>
<pre class=" language-javascript"><code class=" language-javascript">someFn<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>this<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>`apply` takes `this` as the first arg, followed by an array of the remaining arguments:</p>
<pre class=" language-javascript"><code class=" language-javascript">someFn<span class="token punctuation">.</span><span class="token function">apply<span class="token punctuation">(</span></span>this<span class="token punctuation">,</span> <span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Our `doc` and `marty` instances can time travel on their own, but <a href="http://backtothefuture.wikia.com/wiki/Einstein">Einstein</a> needed their help to time travel. So let’s add a method to our `doc` instance from earlier (the one we copied the `timeTravel` method to), so that `doc` can cause an `einstein` instance to travel in time:</p>
<pre class=" language-javascript"><code class=" language-javascript">doc<span class="token punctuation">.</span>timeTravelFor <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>timeTravel<span class="token punctuation">.</span><span class="token function">call<span class="token punctuation">(</span></span>instance<span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true"> // alternate syntax if you used apply would be
</span>   <span class="token comment" spellcheck="true"> // this.timeTravel.apply(instance, [year]);
</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Now it’s possible to send Einstein on his way:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> einstein <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Einstein"</span><span class="token punctuation">,</span> 
    lastName<span class="token punctuation">:</span> <span class="token string">"(the dog)"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">timeTravelFor<span class="token punctuation">(</span></span>einstein<span class="token punctuation">,</span> <span class="token number">1985</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">
// Einstein (the dog) is time traveling to 1985</span></code></pre>
<p>I know this is a contrived example, but it’s enough to give you a glimpse of the power of applying functions to other objects.</p>
<p>There’s still one other possibility we haven’t explored. Let’s give our <code>marty</code> instance a <code>goHome</code> method that’s simply a shortcut to calling <code>this.timeTravel(1985)</code>:</p>
<pre class=" language-javascript"><code class=" language-javascript">marty<span class="token punctuation">.</span>goHome <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span><span class="token function">timeTravel<span class="token punctuation">(</span></span><span class="token number">1985</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>However, we know that if we subscribe <code>marty.goHome</code> as the event handler to our button’s click event, that <code>this</code> will be the button – and unfortunately buttons don’t have a <code>timeTravel</code> method. We could use our approach from earlier – where an anonymous function was the event handler, and it invoked the method on the <code>marty</code> instance – but we have another option, the <code>bind</code> function:</p>
<pre class=" language-javascript"><code class=" language-javascript">flux<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> marty<span class="token punctuation">.</span>goHome<span class="token punctuation">.</span><span class="token function">bind<span class="token punctuation">(</span></span>marty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The <code>bind</code> function actually returns a <em>new</em> function, with the <code>this</code> value of the new function set to what you provide as the argument. If you’re supporting older browsers (less than IE9, for example), then you’ll need to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">shim the <code>bind</code> function</a> (or, if you’re using jQuery, you can use <code>$.proxy</code>; both underscore &amp; lodash provide <code>_.bind</code>).</p>
<blockquote><p>One important thing to remember is that if you use <code>bind</code> on a <em>prototype</em> method, it creates an instance-level method, which bypasses the advantages of having methods on the prototype. It’s not <em>wrong</em>, just something to be aware of. I write more about this particular issue <a href="http://freshbrewedcode.com/jimcowart/2013/02/12/getting-into-context-binds/">here</a>.</p></blockquote>
<h2 id="expdec">4.) Function Expressions vs Function Declarations</h2>
<p>There are two main ways you will typically see functions defined in JavaScript (though ES6 will introduce <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope#The_arrow_function_expression_(.3D">another</a>)): function declarations and function expressions.</p>
<p>Function Declarations do not require a <code>var</code> keyword. In fact, as <a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">Angus Croll says</a>: <em>“It’s helpful to think of them as siblings of Variable Declarations.”</em> For example:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">function</span> <span class="token function">timeTravel<span class="token punctuation">(</span></span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>The function name <code>timeTravel</code> in the above example is visible not only inside the scope it was declared, but inside the function itself as well (this is especially useful for recursive function calls). Function declarations are, by nature, <em>named functions</em>. In other words, the above function’s <code>name</code> property is <code>timeTravel</code>.</p>
<p>Function Expressions define a function and assign it to a variable. They typically look like this:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> someFn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"I like to express myself..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>It’s possible to name function expressions as well – though, unlike function declarations, a named function expression’s name is only accessible <em>inside</em> its scope:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> someFn <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">iHazName<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span><span class="token string">"I like to express myself..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>needsMoreExpressing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">iHazName<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // the function's name can be used here
</span>    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// you can call someFn() here, but not iHazName()
</span><span class="token function">someFn<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote><p>Discussing function expressions and declarations wouldn’t be complete without at least mentioning “hoisting” – where function and variable declarations are moved to the top of the containing scope by the interpreter. We’re not going to cover hoisting here, but be sure to read two great explanations by <a href="http://www.adequatelygood.com/JavaScript-Scoping-and-Hoisting.html">Ben Cherry</a> and <a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">Angus Croll</a>.</p></blockquote>
<h2 id="anon">5.) Named vs Anonymous Functions</h2>
<p>Based on what we’ve just discussed, you might have guessed that an “anonymous” function is a function without a name. Most JavaScript developers would quickly recognize the second argument below as an anonymous function:</p>
<pre class=" language-javascript"><code class=" language-javascript">someElement<span class="token punctuation">.</span><span class="token function">addEventListener<span class="token punctuation">(</span></span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> // I'm anonymous!
</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>However, it’s also true that our <code>marty.timeTravel</code> method is anonymous as well:</p>
<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> marty <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">"Marty"</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token string">"McFly"</span><span class="token punctuation">,</span>
    timeTravel<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log<span class="token punctuation">(</span></span>this<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">" is time traveling to "</span> <span class="token operator">+</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Since function declarations must have a name, only function <em>expressions</em> can be anonymous.</p>
<h2 id="iife">6.) Immediately Invoked Function Expressions</h2>
<p>And since we’re talking about function expressions, one thing I wish I’d known right away: the Immediately Invoked Function Expression (IIFE). There are a number of good posts on IIFEs (I’ll list a few at the end), but in a nutshell, it’s a function expression that is not assigned to a variable to be executed later, it’s executed <em>immediately</em>. It might help to see this take shape in a browser console.</p>
<h3>First – let’s start with just entering a function expression – but not assigning it – and see what happens:</h3>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_4.png"><img class="alignnone size-full wp-image-521" alt="jsquirks_afjq_4" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_4.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_4.png 604w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_4-300x40.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_4-600x82.png 600w" ></a></p>
<p>That’s not valid JavaScript syntax – it’s a function declaration missing its name. However, to make it an expression, we just need to surround it with parentheses:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png"><img class="alignnone size-full wp-image-531" alt="jsquirks_afjq_6" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6.png 656w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6-300x33.png 300w" ></a> <a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_5.png"><img class="alignnone size-full wp-image-551" alt="jsquirks_afjq_5" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_5.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_5.png 624w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_5-300x41.png 300w"></a></p>
<p>Making this an expression immediately returns our anonymous function to the console (remember, we’re not assigning it, but since it’s an expression we get its value back). So – we have the “function expression” part of “immediately invoked function expression”. To get the “immediately invoked” aspect, we call what the expression returns by adding another set of parentheses after the expression (just like we’d invoke any other function):</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png"><img class="alignnone size-full wp-image-531" alt="jsquirks_afjq_6" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_6.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6.png 656w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_6-300x33.png 300w" ></a></p>
<p>“But wait, Jim! I think I’ve seen this before with the invocation parentheses <em>inside</em> the expression parentheses”. Indeed you probably have – it’s perfectly legal syntax (and is well known to be Douglas Crockford’s preferred syntax):</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_7.png"><img class="alignnone size-full wp-image-561" alt="jsquirks_afjq_7" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_7.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_7.png 700w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_7-300x36.png 300w" ></a></p>
<p>Either approach on where to put the invocation parentheses is usable, however I highly recommend reading <a href="https://github.com/airbnb/javascript/issues/21#issuecomment-10203921">one of the best explanations ever</a> on why &amp; when it could matter.</p>
<p>Ok, great – now we know <em>what</em> an IIFE <em>is</em> – why is it useful?</p>
<p>It helps us control <em>scope</em> – an essential part of any JavaScript endeavor! The <code>marty</code> instance we’ve looked at earlier was created in the <em>global</em> scope. This means that the window (assuming we’re in a browser), will have a <code>marty</code> property. If we write all of our JavaScript code this way, we’ll quickly end up with a metric ton of vars declared in the global scope, polluting the window with our app’s code. Even in the best case scenarios, it’s bad practice to leak that many details into the global scope, but what happens when someone names a variable the same name as an <em>already existing</em> property on the window? It gets overwritten!</p>
<p>For example, if your favorite “Amelia Earhart” fan site declares a <code>navigator</code> variable in the global scope, this is a before and after look at what happens:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_8.png"><img class="alignnone size-full wp-image-571" alt="jsquirks_afjq_8" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_8.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_8.png 1290w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_8-300x65.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_8-1024x222.png 1024w"></a></p>
<p>OOPS!</p>
<p>Obviously – polluting the global scope is <strong>bad</strong>. JavaScript utilizes <em>function scope</em> (not block scope, if you’re coming from C# or Java, this is important!), so the way to keep our code from polluting the global scope is to create a <em>new</em> scope, and we can use an IIFE to do this since its contents will be inside its own function scope. In the example below, I’m showing you the <code>window.navigator</code> value in the console, and then I create an IIFE to wrap the behavior and data specific to Amelia Earhart. This IIFE happens to return an object that will serve as our “application namespace”. Inside the IIFE I declare a <code>navigator</code> variable to show that it will <em>not</em> overwrite the window.navigator value.</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_9.png"><img class="alignnone size-full wp-image-581" alt="jsquirks_afjq_9" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_9.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_9.png 1372w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_9-300x132.png 300w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_9-1024x450.png 1024w" ></a></p>
<p>As an added bonus, the IIFE we created above is the beginnings of a <a>module pattern</a> in JavaScript. I’ll include some links at the end so you can explore module patterns further.</p>
<h2 id="typechecking">7.) The `typeof` Operator and `Object.prototype.toString`</h2>
<p>Eventually, you’ll probably find yourself in a situation where you need to inspect the type of a value passed into a function, or something similar. The <code>typeof</code> operator might seem the obvious choice, however, it’s not terribly helpful. For example, what happens when we call <code>typeof</code> on an object, an array, a string and a regular expression?</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_10.png"><img class="alignnone size-full wp-image-591" alt="jsquirks_afjq_10" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_10.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_10.png 422w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_10-300x231.png 300w"></a></p>
<p>Well – at least we can tell our strings apart from objects, arrays and regular expressions, right? Thankfully, we can take a different approach to get more accurate information about type we’re inspecting. We’ll use the <code>Object.prototype.toString</code> function and apply our knowledge of the <code>call</code> method from earlier:</p>
<p><a href="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_11.png"><img class="alignnone size-full wp-image-601" alt="jsquirks_afjq_11" src="http://tdn.azurewebsites.net/wp-content/uploads/2014/04/jsquirks_afjq_11.png" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_11.png 822w, http://developer.telerik.com/wp-content/uploads/2014/04/jsquirks_afjq_11-300x118.png 300w"></a></p>
<p>Why are we using the <code>toString</code> on <code>Object.prototype</code>? Because it’s possible for 3rd party libraries, as well as your own code, to override the <code>toString</code> method with an instance method. By going to the <code>Object.prototype</code>, we can force the original <code>toString</code> behavior on an instance.</p>
<p>If you know what <code>typeof</code> will return and you don’t need to check beyond what it will give you (for example, you just need to know if something is a string or not), then using <code>typeof</code> is perfectly fine. However, if you need to tell arrays from objects, regexes from objects, etc., use <code>Object.prototype.toString</code>.</p>
<h2>Where to Go Next</h2>
<p>I’ve benefitted tremendously from the insights of other JavaScript developers, so please check these links out and give these people a pat on the back for teaching the rest of us!</p>
<ul>
<li>Axel Rauschmayer’s great post on <a href="http://www.2ality.com/2011/12/strict-equality-exemptions.html">When is it OK to use == in JavaScript?</a> (hint: <em>never</em>)</li>
<li><a href="http://javascriptweblog.wordpress.com/2011/08/08/fixing-the-javascript-typeof-operator/">Fixing the typeof Operator</a> by Angus Croll</li>
<li><a href="https://github.com/airbnb/javascript/issues/21#issuecomment-10203921">Airbnb Github Issue comment</a> that’s the single best explanation on IIFE parens placement</li>
<li><a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">Function Declarations vs. Function Expressions</a> – by Angus Croll</li>
<li><a href="http://freshbrewedcode.com/jimcowart/2013/02/12/getting-into-context-binds/">Getting Into Context Binds</a> by yours truly</li>
<li><a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">Immediately-Invoked Function Expression (IIFE)</a> by Ben Alman</li>
<li><a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">Learning JavaScript Design Patterns</a> by Addy Osmani</li>
<li><a href="http://unschooled.org/2012/03/understanding-javascript-this/">Understanding the “this” keyword in JavaScript</a> by Nicholas Bergson-Shilcock</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">MDN – Function.prototype.bind</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">MDN – Function.prototype.apply</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call">MDN – Function.prototype.call</a></li>
<li><a href="http://kangax.github.io/nfe/">Named function expressions demystified</a> by Juriy “kangax” Zaytsev</li>
<li><a href="http://www.2ality.com/2013/06/basic-javascript.html">Basic JavaScript for the impatient programmer</a> by Axel Rauschmayer</li>
<li><a href="http://www.adequatelygood.com/JavaScript-Scoping-and-Hoisting.html">JavaScript Scoping and Hoisting</a> by Ben Cherry</li>
<li><a href="http://davidshariff.com/blog/javascript-this-keyword/">JavaScript’s ‘this’ Keyword</a> by David Shariff</li>
<li><a href="http://davidshariff.com/blog/what-is-the-execution-context-in-javascript/">What is the Execution Context &amp; Stack in JavaScript?</a> by David Shariff
</li></ul>
<div align="center"><a href="http://www.telerik.com/campaigns/kendo-ui-build-free?utm_campaign=kui-build-free&amp;utm_medium=social+media&amp;utm_source=TDN"><img src="http://developer.telerik.com/wp-content/uploads/2014/04/BuildFree_Blog_banner.jpeg" alt="BuildFree_Blog_banner" class="aligncenter size-full wp-image-2111" srcset="http://developer.telerik.com/wp-content/uploads/2014/04/BuildFree_Blog_banner.jpeg 570w, http://developer.telerik.com/wp-content/uploads/2014/04/BuildFree_Blog_banner-300x52.jpeg 300w" ></a></div>

            
        
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Named function expressions demystified</h1>
					<div class="tutorial__content">
<ol>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#expr-vs-decl">Function expressions vs. Function declarations</a></li>
        <li><a href="#function-statements">Function Statements</a></li>
        <li><a href="#named-expr">Named function expressions</a></li>
        <li><a href="#names-in-debuggers">Function names in debuggers</a></li>
        <li><a href="#jscript-bugs">JScript bugs</a></li>
        <li><a href="#jscript-memory-management">JScript memory management</a></li>
        <li><a href="#tests">Tests</a></li>
        <li><a href="#safari-bug">Safari bug</a></li>
        <li><a href="#spidermonkey-peculiarity">SpiderMonkey peculiarity</a></li>
        <li><a href="#solution">Solution</a></li>
        <li><a href="#alt-solution">Alternative solution</a></li>
        <li><a href="#webkit-displayName">WebKit's displayName</a></li>
        <li><a href="#future-considerations">Future considerations</a></li>
        <li><a href="#credits">Credits</a></li>
      </ol>

      <h2 id="introduction">Introduction</h2>

      <p>Surprisingly, a topic of named function expressions doesn&#8217;t seem to be covered well enough on the web. This is probably why there are so many misconceptions floating around. In this article, I&#8217;ll try to summarize both — theoretical and practical aspects of these wonderful Javascript constructs; the good, bad and ugly parts of them.</p>

      <p>In a nutshell, named function expressions are useful for one thing only — <strong>descriptive function names in debuggers and profilers</strong>. Well, there is also a possibility of using function names for recursion, but you will soon see that this is often impractical nowadays. If you don&#8217;t care about debugging experience, you have nothing to worry about. Otherwise, read on to see some of the cross-browser glitches you would have to deal with and tips on how work around them.</p>

      <p>I&#8217;ll start with a general explanation of what function expressions are how modern debuggers handle them. Feel free to skip to a <a href="#solution">final solution</a>, which explains how to use these constructs safely.</p>

      <h2 id="expr-vs-decl">Function expressions vs. Function declarations</h2>

      <p>One of the two most common ways to create a function object in ECMAScript is by means of either <em>Function Expression</em> or <em>Function Declaration</em>. The difference between two is <strong>rather confusing</strong>. At least it was to me. The only thing ECMA specs make clear is that <em>Function Declaration</em> must always have an <em>Identifier</em> (or a function name, if you prefer), and <em>Function Expression</em> may omit it:</p>

      <blockquote>
        <p>FunctionDeclaration :<br>
        function Identifier ( FormalParameterList <sub>opt</sub> ){ FunctionBody }</p>

        <p>FunctionExpression :<br>

        function Identifier <sub>opt</sub> ( FormalParameterList <sub>opt</sub> ){ FunctionBody }</p>
      </blockquote>

      <p>We can see that when identifier is omitted, that &#8220;something&#8221; can only be an expression. But what if identifier is present? How can one tell whether it is a function declaration or a function expression — they look identical after all? It appears that ECMAScript differentiates between two based on a context. If a <code>function foo(){}</code> is part of, say, assignment expression, it is considered a function expression. If, on the other hand, <code>function foo(){}</code> is contained in a function body or in a (top level of) program itself — it is parsed as a function declaration.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){}</span> <span class="c1">// declaration, since it&#39;s part of a &lt;em&gt;Program&lt;/em&gt;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){};</span> <span class="c1">// expression, since it&#39;s part of an &lt;em&gt;AssignmentExpression&lt;/em&gt;</span>

<span class="k">new</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">(){};</span> <span class="c1">// expression, since it&#39;s part of a &lt;em&gt;NewExpression&lt;/em&gt;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">function</span> <span class="nx">bar</span><span class="p">(){}</span> <span class="c1">// declaration, since it&#39;s part of a &lt;em&gt;FunctionBody&lt;/em&gt;</span>
<span class="p">})();</span></code></pre></div>

<p>A somewhat less obvious example of function expression is the one where function is wrapped with parenthesis — <code>(function foo(){})</code>. The reason it is an expression is again due to a context: "(" and ")" constitute a grouping operator and grouping operator can only contain an expression:</p>

<p>To demonstrate with examples:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){}</span> <span class="c1">// function declaration</span>
<span class="p">(</span><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){});</span> <span class="c1">// function expression: due to grouping operator</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// grouping operator can only contain expression, not a statement (which `var` is)</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// SyntaxError</span>
<span class="p">}</span></code></pre></div>

<p>You might also recall that when evaluating JSON with <code>eval</code>, the string is usually wrapped with parenthesis — <code>eval('(' + json + ')')</code>. This is of course done for the same reason — grouping operator, which parenthesis are, forces JSON brackets to be parsed as expression rather than as a block:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="p">{</span> <span class="s2">&quot;x&quot;</span><span class="o">:</span> <span class="mi">5</span> <span class="p">};</span> <span class="c1">// &quot;{&quot; and &quot;}&quot; are parsed as a block</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// SyntaxError</span>
<span class="p">}</span>

<span class="p">({</span> <span class="s2">&quot;x&quot;</span><span class="o">:</span> <span class="mi">5</span> <span class="p">});</span> <span class="c1">// grouping operator forces &quot;{&quot; and &quot;}&quot; to be parsed as object literal</span></code></pre></div>

      <p>There&#8217;s a subtle difference in behavior of declarations and expressions.</p>

      <p>First of all, function declarations are parsed and evaluated before any other expressions are. Even if declaration is positioned last in a source, it will be evaluated <strong>foremost any other expressions</strong> contained in a scope. The following example demonstrates how <code>fn</code> function is already defined by the time <code>alert</code> is executed, even though it&#8217;s being declared right after it:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">alert</span><span class="p">(</span><span class="nx">fn</span><span class="p">());</span>

<span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s1">&#39;Hello world!&#39;</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

      <p>Another important trait of function declarations is that declaring them conditionally is non-standardized and varies across different environments. You should never rely on functions being declared conditionally and use function expressions instead.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Never do this!</span>
<span class="c1">// Some browsers will declare `foo` as the one returning &#39;first&#39;,</span>
<span class="c1">// while others — returning &#39;second&#39;</span>

<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;first&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;second&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Instead, use function expressions:</span>
<span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;first&#39;</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;second&#39;</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span></code></pre></div>

      <p>If you're curious about actual production rules of function declarations, read on. Otherwise, feel free to skip the following excerpt.</p>

      <div id="function-declarations-in-blocks" class="well bg-success">
        <p>
          <em>FunctionDeclaration</em>s are only allowed to appear in <em>Program</em> or <em>FunctionBody</em>.
          Syntactically, they <strong>can not appear in <em>Block</em></strong> (<code>{ ... }</code>) — such as that of <code>if</code>,
          <code>while</code> or <code>for</code> statements. This is because <em>Block</em>s can only contain <em>Statement</em>s,
          not <em>SourceElement</em>s, which <em>FunctionDeclaration</em> is.
          If we look at production rules carefully, we can see that the only way <em>Expression</em> is allowed directly within <em>Block</em>
          is when it is part of <em>ExpressionStatement</em>. However, <em>ExpressionStatement</em> is explicitly defined
          <strong>to not begin with "function" keyword</strong>, and this is exactly why <em>FunctionDeclaration</em> cannot appear directly within a <em>Statement</em> or <em>Block</em> (note that <em>Block</em> is merely a list of <em>Statement</em>s).
        </p>
        <p>
          Because of these restrictions, whenever function appears directly in a block (such as in the previous example) it should actually be
          <strong>considered a syntax error</strong>, not function declaration or expression. The problem is that almost none of the
          implementations I've seen parse these functions strictly per rules (exceptions are <a href="http://sourceforge.net/projects/besen/">BESEN</a> and <a href="http://www.digitalmars.com/dscript/">DMDScript</a>). They interpret them in proprietary ways instead.
        </p>
      </div>

      <p>It's worth mentioning that as per specification, implementations are allowed to introduce <strong>syntax extensions</strong> (see section 16), yet still be fully conforming. This is exactly what happens in so many clients these days. Some of them interpret function declarations in blocks as any other function declarations — simply hoisting them to the top of the enclosing scope; Others — introduce different semantics and follow slightly more complex rules.</p>

      <h2 id="function-statements">Function statements</h2>

      <div>
        <p>
          One of such syntax extensions to ECMAScript is <strong>Function Statements</strong>,
          currently implemented in Gecko-based browsers (tested in Firefox 1-3.7a1pre on Mac OS X).
          Somehow, this extension doesn't seem to be widely known, either for good or bad (<a href="https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference:Functions#Conditionally_defining_a_function">MDC mentions them</a>, but very briefly).
          Please remember, that we are discussing it here only for learning purposes and to satisfy our curiosity;
          unless you're writing scripts for specific Gecko-based environment,
          <strong>I do not recommend relying on this extension</strong>.
        </p>

        <p>
          So, here are some of the traits of these non-standard constructs:
        </p>

        <ol>
          <li>Function statements are allowed to be anywhere where plain <em>Statement</em>s are allowed. This, of course, includes <em>Block</em>s:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(){</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(){</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>
        </li>
          <li>Function statements are interpreted as any other statements, including conditional execution:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 1</span>
<span class="c1">// Note that other clients interpet `foo` as function declaration here,</span>
<span class="c1">// overwriting first `foo` with the second one, and producing &quot;2&quot;, not &quot;1&quot; as a result</span></code></pre></div>
        </li>
        <li>
          Function statements are NOT declared during variable instantiation. They are declared at run time, just like function expressions.
          However, once declared, function statement's identifier <strong>becomes available to the entire scope</strong> of the function.
          This identifier availability is what makes function statements different from function expressions (you will see exact behavior of named function expressions in next chapter).
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// at this point, `foo` is not yet declared</span>
<span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// &quot;undefined&quot;</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// once block is entered, `foo` becomes declared and available to the entire scope</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="c1">// this block is never entered, and `foo` is never redeclared</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// &quot;function&quot;</span></code></pre></div>
  Generally, we can emulate function statements behavior from the previous example with this standards-compliant (and unfortunately, more verbose) code:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">};</span>
<span class="p">}</span></code></pre></div>
        </li>
        <li>
          String representation of functions statements is similar to that of function declarations or named function expressions (and includes identifier — "foo" in this example):
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nb">String</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// function foo() { return 1; }</span></code></pre></div>
        </li>
        <li>
Finally, what appears to be a bug in earlier Gecko-based implementations (present in &lt;= Firefox 3), is the way function statements overwrite function declarations. Earlier versions were somehow failing to overwrite function declarations with function statements:
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// function declaration</span>
<span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// overwritting with function statement</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 1 in FF&lt;= 3, 2 in FF3.5 and later</span>

<span class="c1">// however, this doesn&#39;t happen when overwriting function expression</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 2 in all versions</span></code></pre></div>
        </li>
        </ol>
        <p id="function-statements-in-safari">
          Note that older Safari (at least 1.2.3, 2.0 - 2.0.4 and 3.0.4, and possibly earlier versions too) implement function statements <strong>identically to SpiderMonkey</strong>.
          All examples from this chapter, except the last "bug" one, produce same results in those versions of Safari as they do in, say, Firefox. Another browser that seems to
          follow same semantics is Blackberry one (at least 8230, 9000 and 9530 models). This diversity in behavior demonstrates once again what a bad idea it is to rely on these extensions.
        </p>
      </div>

      <h2 id="named-expr">Named function expressions</h2>

      <p>Function expressions can actually be seen quite often. A common pattern in web development is to &#8220;fork&#8221; function definitions based on some kind of a feature test, allowing for the best performance. Since such forking usually happens in the same scope, it is almost always necessary to use function expressions. After all, as we know by now, function declarations should not be executed conditionally:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// `contains` is part of &quot;APE Javascript library&quot; (http://dhtmlkitchen.com/ape/) by Garrett Smith</span>
<span class="kd">var</span> <span class="nx">contains</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">compareDocumentPosition</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">contains</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">el</span> <span class="o">!==</span> <span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">el</span> <span class="o">!=</span> <span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">el</span> <span class="o">===</span> <span class="nx">b</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">})();</span></code></pre></div>

<p>Quite obviously, when a function expression has a name (technically — <em>Identifier</em>), it is called a <strong>named function expression</strong>. What you&#8217;ve seen in the very first example — <code>var bar = function foo(){};</code> — was exactly that — a named function expression with <code>foo</code> being a function name. An important detail to remember is that this name is <strong>only available in the scope of a newly-defined function</strong>; specs mandate that an identifier should not be available to an enclosing scope:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// &quot;foo&quot; is available in this inner scope</span>
<span class="p">};</span>
<span class="c1">// `foo` is never visible &quot;outside&quot;</span>
<span class="k">typeof</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// &quot;undefined&quot;</span>
<span class="nx">f</span><span class="p">();</span> <span class="c1">// &quot;function&quot;</span></code></pre></div>

      <p>So what&#8217;s so special about these named function expressions? Why would we want to give them names at all? </p>

      <p>It appears that named functions make for a much more pleasant debugging experience. When debugging an application, having a call stack with descriptive items makes a huge difference.</p>

      <h2 id="names-in-debuggers">Function names in debuggers</h2>

      <p>When a function has a corresponding identifier, debuggers show that identifier as a function name, when inspecting call stack. Some debuggers (e.g. Firebug) helpfully show names of even anonymous functions — making them identical to names of variables that functions are assigned to. Unfortunately, these debuggers usually rely on simple parsing rules; Such extraction is usually quite fragile and often produces false results. </p>

      <p>Let&#8217;s look at a simple example:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">bar</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Here, we used function declarations when defining all of 3 functions</span>
<span class="c1">// When debugger stops at the `debugger` statement,</span>
<span class="c1">// the call stack (in Firebug) looks quite descriptive:</span>
<span class="nx">baz</span>
<span class="nx">bar</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>We can see that <code>foo</code> called <code>bar</code> which in its turn called <code>baz</code> (and that <code>foo</code> itself was called from the global scope of <code>expr_test.html</code> document). What&#8217;s really nice, is that Firebug manages to parse the &#8220;name&#8221; of a function even when an anonymous expression is used:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Call stack</span>
<span class="nx">baz</span>
<span class="nx">bar</span><span class="p">()</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>What&#8217;s not very nice, though, is that if a function expression gets any more complex (which, in real life, it almost always is) all of the debugger&#8217;s efforts turn out to be pretty useless; we end up with a shiny question mark in place of a function name:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">})();</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Call stack</span>
<span class="nx">baz</span>
<span class="p">(</span><span class="o">?</span><span class="p">)()</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>Another confusion appears when a function is being assigned to more than one variable:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">baz</span> <span class="o">=</span> <span class="nx">bar</span><span class="p">;</span>
<span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;spoofed&#39;</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Call stack:</span>
<span class="nx">bar</span><span class="p">()</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>You can see call stack showing that <code>foo</code> invoked <code>bar</code>. Clearly, that&#8217;s not what has happened. The confusion is due to the fact that <code>baz</code> was &#8220;exchanged&#8221; references with another function — the one alerting &#8220;spoofed&#8221;. As you can see, such parsing — while great in simple cases — is often useless in any non-trivial script. </p>

      <p>What it all boils down to is the fact that named <strong>function expressions is the only way to get a truly robust stack inspection</strong>. Let&#8217;s rewrite our previous example with named functions in mind. Notice how both of the functions returning from self-executing wrapper, are named as <code>bar</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">bar</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">baz</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">})();</span>
<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
  <span class="kr">debugger</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// And, once again, we have a descriptive call stack!</span>
<span class="nx">baz</span>
<span class="nx">bar</span>
<span class="nx">foo</span>
<span class="nx">expr_test</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span></code></pre></div>

      <p>Before we start dancing happily celebrating this holy grail finding, I&#8217;d like to bring a beloved JScript into the picture.</p>

      <h2 id="jscript-bugs">JScript bugs</h2>

      <p>Unfortunately, JScript (i.e. Internet Explorer&#8217;s ECMAScript implementation) seriously messed up named function expressions. JScript is responsible for named function expressions <strong>being recommended against</strong> by many people these days. It's also quite sad that even <strong>last version of JScript — 5.8 — used in Internet Explorer 8, still exhibits every single quirk described below</strong></p>

      <p>Let&#8217;s look at what exactly is wrong with its broken implementation. Understanding all of its issues will allow us to work around them safely. Note that I broke these discrepancies into few examples — for clarity — even though all of them are most likely a consequence of one major bug.</p>

      <h3 id="example_1_function_expression_identifier_leaks_into_an_enclosing_scope">Example #1: Function expression identifier leaks into an enclosing scope</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
<span class="k">typeof</span> <span class="nx">g</span><span class="p">;</span> <span class="c1">// &quot;function&quot;</span></code></pre></div>

      <p>Remember how I mentioned that an identifier of named function expression is <strong>not available in an enclosing scope</strong>? Well, JScript doesn&#8217;t agree with specs on this one — <code>g</code> in the above example resolves to a function object. This is a most widely observed discrepancy. It&#8217;s dangerous in that it inadvertedly pollutes an enclosing scope — a scope that might as well be a global one — with an extra identifier. Such pollution can, of course, be a source of hard-to-track bugs.</p>

      <h3 id="example_2_named_function_expression_is_treated_as_both_function_declaration_and_function_expression">Example #2: Named function expression is treated as BOTH — function declaration AND function expression</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">typeof</span> <span class="nx">g</span><span class="p">;</span> <span class="c1">// &quot;function&quot;</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span></code></pre></div>

      <p>As I explained before, function declarations are parsed foremost any other expressions in a particular execution context. The above example demonstrates how <strong>JScript actually treats named function expressions as function declarations</strong>. You can see that it parses <code>g</code> before an &#8220;actual declaration&#8221; takes place. </p>

      <p>This brings us to a next example:</p>

      <h3 id="example_3_named_function_expression_creates_two_distinct_function_objects">Example #3: Named function expression creates TWO DISTINCT function objects!</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
<span class="nx">f</span> <span class="o">===</span> <span class="nx">g</span><span class="p">;</span> <span class="c1">// false</span>

<span class="nx">f</span><span class="p">.</span><span class="nx">expando</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">expando</span><span class="p">;</span> <span class="c1">// undefined</span></code></pre></div>

      <p>This is where things are getting interesting. Or rather — completely nuts. Here we are seeing the dangers of having to deal with two distinct objects — augmenting one of them obviously does not modify the other one; This could be quite troublesome if you decided to employ, say, caching mechanism and store something in a property of <code>f</code>, then tried accessing it as a property of <code>g</code>, thinking that it is the same object you&#8217;re working with.</p>

      <p>Let&#8217;s look at something a bit more complex.</p>

      <h3 id="example_4_function_declarations_are_parsed_sequentially_and_are_not_affected_by_conditional_blocks">Example #4: Function declarations are parsed sequentially and are not affected by conditional blocks</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
<span class="nx">g</span><span class="p">();</span> <span class="c1">// 2</span></code></pre></div>

      <p>An example like this could cause even harder to track bugs. What happens here is actually quite simple. First, <code>g</code> is being parsed as a function declaration, and since declarations in JScript are independent of conditional blocks, <code>g</code> is being declared as a function from the &#8220;dead&#8221; <code>if</code> branch — <code>function g(){ return 2 }</code>. Then all of the &#8220;regular&#8221; expressions are being evaluated and <code>f</code> is being assigned another, newly created function object to. &#8220;dead&#8221; <code>if</code> branch is never entered when evaluating expressions, so <code>f</code> keeps referencing first function — <code>function g(){ return 1 }</code>. It should be clear by now, that if you&#8217;re not careful enough, and call <code>g</code> from within <code>f</code>, you&#8217;ll end up calling a completely unrelated <code>g</code> function object.</p>

      <p>You might be wondering how all this mess with different function objects compares to <code>arguments.callee</code>. Does <code>callee</code> reference <code>f</code> or <code>g</code>? Let&#8217;s take a look:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span> <span class="o">==</span> <span class="nx">f</span><span class="p">,</span>
    <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span> <span class="o">==</span> <span class="nx">g</span>
  <span class="p">];</span>
<span class="p">};</span>
<span class="nx">f</span><span class="p">();</span> <span class="c1">// [true, false]</span>
<span class="nx">g</span><span class="p">();</span> <span class="c1">// [false, true]</span></code></pre></div>

      <p>As you can see, <code>arguments.callee</code> references whatever function is being invoked. This is actually good news, as you will see later on.</p>

      <p>Another interesting example of "unexpected behavior" can be observed when using named <strong>function expression in undeclared assignment</strong>, but only when function is "named" the same way as identifier it's being assigned to:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
<span class="p">})();</span></code></pre></div>
      <p>As you might know, undeclared assignment (which is <strong>not recommended</strong> and is only used here for demonstration purposes) should result in creation of global <code>f</code> property. This is exactly what happens in conforming implementations. However, JScript bug makes things a bit more confusing. Since named function expression is parsed as function declaration (see <a href="#example_2_named_function_expression_is_treated_as_both_function_declaration_and_function_expression">example #2</a>), what happens here is that <code>f</code> becomes declared as a local variable during the phase of variable declarations. Later on, when function execution begins, assignment is no longer undeclared, so <code>function f(){}</code> on the right hand side is simply assigned to this newly created <strong>local</strong> <code>f</code> variable. Global <code>f</code> is never created.</p>

      <p>This demonstrates how failing to understand JScript peculiarities can lead to drastically different behavior in code.</p>

      <p>Looking at JScript deficiencies, it becomes pretty clear what exactly we need to avoid. First, we need <strong>to be aware of a leaking identifier</strong> (so that it doesn&#8217;t pollute enclosing scope). Second, we should <strong>never reference identifier used as a function name</strong>; A troublesome identifier is <code>g</code> from the previous examples. Notice how many ambiguities could have been avoided if we were to forget about <code>g</code>&#8217;s existance. Always referencing function via <code>f</code> or <code>arguments.callee</code> is the key here. If you use named expression, think of that name as something that&#8217;s only being used for debugging purposes. And finally, a bonus point is to <strong>always clean up an extraneous function</strong> created erroneously during NFE declaration.</p>

      <p>I think last point needs a bit of an explanation:</p>

      <h2 id="jscript-memory-management">JScript memory management</h2>

      <p>Being familiar with JScript discrepancies, we can now see a potential problem with memory consumption when using these buggy constructs. Let&#8217;s look at a simple example:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
<span class="p">})();</span></code></pre></div>

      <p>We know that a function returned from within this anonymous invocation — the one that has <code>g</code> identifier — is being assigned to outer <code>f</code>. We also know that named function expressions produce superfluous function object, and that this object is not the same as returned function. The memory issue here is caused by this extraneous <code>g</code> function being literally &#8220;trapped&#8221; in a closure of returning function. This happens because inner function is declared in the same scope as that pesky <code>g</code> one. Unless we <strong>explicitly break reference to <code>g</code> function</strong> it will keep consuming memory.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">g</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="c1">// null `g`, so that it doesn&#39;t reference extraneous function any longer</span>
  <span class="nx">g</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>Note that we explicitly declare <code>g</code> as well, so that <code>g = null</code> assignment wouldn&#8217;t create a global <code>g</code> variable in conforming clients (i.e. non-JScript ones). By <code>null</code>ing reference to <code>g</code>, we allow garbage collector to wipe off this implicitly created function object that <code>g</code> refers to.</p>

      <p>When taking care of JScript NFE memory leak, I decided to run a simple series of tests to confirm that <code>null</code>ing <code>g</code> actually does free memory.</p>

      <h2 id="tests">Tests</h2>

      <p>The test was simple. It would simply create 10000 functions via named function expressions and store them in an array. I would then wait for about a minute and check how high the memory consumption is. After that I would null-out the reference and repeat the procedure again. Here&#8217;s a test case I used:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">createFn</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span>
        <span class="k">return</span> <span class="s1">&#39;standard&#39;</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span>
        <span class="k">return</span> <span class="s1">&#39;alternative&#39;</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span>
        <span class="k">return</span> <span class="s1">&#39;fallback&#39;</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="c1">// var F = null;</span>
    <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
  <span class="p">})();</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">createFn</span><span class="p">();</span>
<span class="p">}</span></code></pre></div>

      <p>Results as seen in Process Explorer on Windows XP SP2 were:</p>

<pre>
  IE6:

    without `null`:   7.6K -> 20.3K
    with `null`:      7.6K -> 18K

  IE7:

    without `null`:   14K -> 29.7K
    with `null`:      14K -> 27K
</pre>

      <p>The results somewhat confirmed my assumptions — explicitly nulling superfluous reference did free memory, but the difference in consumption was relatively insignificant. For 10000 function objects, there would be a ~3MB difference. This is definitely something that should be kept in mind when designing large-scale applications, applications that will run for either long time or on devices with limited memory (such as mobile devices). For any small script, the difference probably doesn&#8217;t matter.</p>

      <p>You might think that it&#8217;s all finally over, but we are not just quite there yet :) There&#8217;s a tiny little detail that I&#8217;d like to mention and that detail is Safari 2.x</p>

      <h2 id="safari-bug">Safari bug</h2>

      <p>
      Even less widely known bug with NFE is present in older versions of Safari; namely, Safari 2.x series. I&#8217;ve seen some <a href="http://meyerweb.com/eric/thoughts/2005/07/11/safari-syntaxerror/">claims on the web</a> that Safari 2.x does not support NFE at all. This is not true. Safari does support it, but has bugs in its implementation which you will see shortly.</p>

      <p>When encountering function expression in a certain context, Safari 2.x fails to parse the program entirely. It doesn&#8217;t throw any errors (such as <code>SyntaxError</code> ones). It simply bails out:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(){})();</span> <span class="c1">// &lt;== NFE</span>
<span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// this line is never reached, since previous expression fails the entire program</span></code></pre></div>

      <p>After fiddling with various test cases, I came to conclusion that Safari 2.x <strong>fails to parse named function expressions, if those are not part of assignment expressions</strong>. Some examples of assignment expressions are:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// part of variable declaration</span>
<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// part of simple assignment</span>
<span class="nx">f</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">g</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// part of return statement</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">})();</span></code></pre></div>

      <p>This means that putting named function expression into an assignment makes Safari &#8220;happy&#8221;:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span> <span class="c1">// fails</span>

<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span> <span class="c1">// works</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span> <span class="c1">// fails</span>
<span class="p">})();</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span> <span class="c1">// works</span>
<span class="p">})();</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(){</span> <span class="p">},</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// fails</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">say</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">say</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="c1">// fails</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">say</span><span class="p">(){</span> <span class="p">...</span> <span class="p">};</span> <span class="c1">// works</span></code></pre></div>

      <p>It also means that we can&#8217;t use such common pattern as returning named function expression without an assignment:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Instead of this non-Safari-2x-compatible syntax:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
<span class="p">})();</span>

<span class="c1">// we should use this slightly more verbose alternative:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
<span class="p">})();</span>

<span class="c1">// or another variation of it:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
<span class="p">})();</span>

<span class="cm">/*</span>
<span class="cm">  Unfortunately, by doing so, we introduce an extra reference to a function</span>
<span class="cm">  which gets trapped in a closure of returning function. To prevent extra memory usage,</span>
<span class="cm">  we can assign all named function expressions to one single variable.</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">__temp</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">f</span><span class="p">(){});</span>
<span class="p">})();</span>

<span class="p">...</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">featureTest2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){});</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">__temp</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){});</span>
<span class="p">})();</span>

<span class="cm">/*</span>
<span class="cm">  Note that subsequent assignments destroy previous references,</span>
<span class="cm">  preventing any excessive memory usage.</span>
<span class="cm">*/</span></code></pre></div>

      <p>If Safari 2.x compatibility is important, we need to make sure <strong>&#8220;incompatible&#8221; constructs do not even appear in the source</strong>. This is of course quite irritating, but is definitely possible to achieve, especially when knowing the root of the problem.</p>

      <p>It&#8217;s also worth mentioning that declaring a function as NFE in Safari 2.x exhibits another minor glitch, where function representation does not contain function identifier:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">g</span><span class="p">(){};</span>

<span class="c1">// Notice how function representation is lacking `g` identifier</span>
<span class="nb">String</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span> <span class="c1">// function () { }</span></code></pre></div>

      <p>This is not really a big deal. As I have already mentioned before, function decompilation is something that <a href="http://perfectionkills.com/those-tricky-functions/">should not be relied upon</a> anyway. </p>

      <h2 id="spidermonkey-peculiarity">SpiderMonkey peculiarity</h2>

      <p>
        We know that identifier of named function expression is only available to the local scope of a function.
        But how does this "magic" scoping actually happen? It appears to be very simple.
        When named function expression is evaluated, a <strong>special object is created</strong>.
        The sole purpose of that object is to hold a property with the name corresponding to function identifier, and value corresponding to function itself.
        That object is then injected into the front of the current scope chain, and this "augmented" scope chain is then used to initialize a function.
      </p>

      <p>
        The interesting part here, however, is the way ECMA-262 defines this "special" object — the one that holds function identifier.
        Spec says that an object is created <strong>"as if by expression new Object()"</strong> which, when interpreted literally,
        makes this object an instance of built-in <code>Object</code> constructor. However, only one implementation — SpiderMonkey —
        followed this specification requirement literally. In SpiderMonkey, it is possible to interfere with function local variables by augmenting <code>Object.prototype</code>:
      </p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;outer&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">    `foo` function here has a special object in its scope chain — to hold an identifier. That object is practically a —</span>
<span class="cm">    `{ foo: &lt;function object&gt; }`. When `x` is being resolved through the scope chain, it is first searched for in</span>
<span class="cm">    `foo`&#39;s local context. When not found, it is searched in the next object from the scope chain. That object turns out</span>
<span class="cm">    to be the one that holds identifier — { foo: &lt;function object&gt; } and since it inherits from `Object.prototype`,</span>
<span class="cm">    `x` is found right here, and is the one that&#39;s `Object.prototype.x` (with value of &#39;outer&#39;). Outer function&#39;s scope</span>
<span class="cm">    (with x === &#39;inner&#39;) is never even reached.</span>
<span class="cm">  */</span>

  <span class="p">(</span><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>

    <span class="nx">alert</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// alerts `outer`</span>

  <span class="p">})();</span>
<span class="p">})();</span></code></pre></div>

<p>
  Note that later versions of SpiderMonkey actually <strong>changed this behavior</strong>,
  as it was probably considered a security hole. A "special" object no longer inherits from <code>Object.prototype</code>.
  You can, however, still see it in Firefox &lt;=3.
</p>

<p id="activation-object-in-blackberry-browser">
  Another environment implementing internal object as an instance of global <code>Object</code> is <strong>Blackberry browser</strong>.
  Only this time, it's <em>Activation Object</em> that inherits from <code>Object.prototype</code>. Note that specification actually
  doesn't codify <em>Activation Object</em> to be created "as if by expression new Object()" (as is the case with NFE's identifier holder object).
  It states that <em>Activation Object</em> is merely a specification mechanism.
</p>

<p>So, let's see what happens in Blackberry browser:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;outer&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">;</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

    <span class="cm">/*</span>
<span class="cm">    When `x` is being resolved against scope chain, this local function&#39;s Activation Object is searched first.</span>
<span class="cm">    There&#39;s no `x` in it, of course. However, since Activation Object inherits from `Object.prototype`, it is</span>
<span class="cm">    `Object.prototype` that&#39;s being searched for `x` next. `Object.prototype.x` does in fact exist and so `x`</span>
<span class="cm">    resolves to its value — &#39;outer&#39;. As in the previous example, outer function&#39;s scope (Activation Object)</span>
<span class="cm">    with its own x === &#39;inner&#39; is never even reached.</span>
<span class="cm">    */</span>

    <span class="nx">alert</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// alerts &#39;outer&#39;</span>

  <span class="p">})();</span>
<span class="p">})();</span></code></pre></div>

<p>
  This might look bizarre, but what's really disturbing is that there's even more chance of conflict with
  already existing <code>Object.prototype</code> members:
</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">constructor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

    <span class="nx">constructor</span><span class="p">();</span> <span class="c1">// evaluates to an object `{ }`, not `1`</span>

    <span class="nx">constructor</span> <span class="o">===</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="p">;</span> <span class="c1">// true</span>
    <span class="nx">toString</span> <span class="o">===</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span> <span class="c1">// true</span>

    <span class="c1">// etc.</span>

  <span class="p">})();</span>
<span class="p">})();</span></code></pre></div>

<p>
  Solution to this Blackberry discrepancy is obvious: avoid naming variables as <code>Object.prototype</code> properties
  — <code>toString</code>, <code>valueOf</code>, <code>hasOwnProperty</code>, and so on.
</p>

      <h2 id="solution">JScript solution</h2>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="c1">// declare a variable to assign function object to</span>
  <span class="kd">var</span> <span class="nx">f</span><span class="p">;</span>

  <span class="c1">// conditionally create a named function</span>
  <span class="c1">// and assign its reference to `f`</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span> <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span> <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">F</span><span class="p">(){</span> <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Assign `null` to a variable corresponding to a function name</span>
  <span class="c1">// This marks the function object (referred to by that identifier)</span>
  <span class="c1">// available for garbage collection</span>
  <span class="kd">var</span> <span class="nx">F</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="c1">// return a conditionally defined function</span>
  <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>Finally, here&#8217;s how we would apply this &#8220;techinque&#8221; in real life, when writing something like a cross-browser <code>addEvent</code> function:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 1) enclose declaration with a separate scope</span>
<span class="kd">var</span> <span class="nx">addEvent</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

  <span class="c1">// 2) declare a variable to assign function to</span>
  <span class="kd">var</span> <span class="nx">fn</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">docEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 3) make sure to give function a descriptive identifier</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">addEvent</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">docEl</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">addEvent</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">addEvent</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">[</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 4) clean up `addEvent` function created by JScript</span>
  <span class="c1">//    make sure to either prepend assignment with `var`,</span>
  <span class="c1">//    or declare `addEvent` at the top of the function</span>
  <span class="kd">var</span> <span class="nx">addEvent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="c1">// 5) finally return function referenced by `fn`</span>
  <span class="k">return</span> <span class="nx">fn</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <h2 id="alt-solution">Alternative solution</h2>

      <p>It&#8217;s worth mentioning that there actually exist alternative ways of having descriptive names in call stacks. Ways that don&#8217;t require one to use named function expressions. First of all, it is often possible to define function via declaration, rather than via expression. This option is only viable when you don&#8217;t need to create more than one function:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">hasClassName</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="c1">// define some private variables</span>
  <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>

  <span class="c1">// use function declaration</span>
  <span class="kd">function</span> <span class="nx">hasClassName</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_className</span> <span class="o">=</span> <span class="s1">&#39;(?:^|\\s+)&#39;</span> <span class="o">+</span> <span class="nx">className</span> <span class="o">+</span> <span class="s1">&#39;(?:\\s+|$)&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">_className</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">_className</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">_className</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">className</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// return function</span>
  <span class="k">return</span> <span class="nx">hasClassName</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>This obviously wouldn&#8217;t work when forking function definitions. Nevertheless, there&#8217;s an interesting pattern that I first seen used by <a href="http://tobielangel.com/">Tobie Langel</a>. The way it works is by <strong>defining all functions upfront using function declarations, but giving them slightly different identifiers</strong>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">addEvent</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">docEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">addEventListener</span><span class="p">(){</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">attachEvent</span><span class="p">(){</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">addEventAsProperty</span><span class="p">(){</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">addEventListener</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">docEl</span><span class="p">.</span><span class="nx">attachEvent</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">attachEvent</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">addEventAsProperty</span><span class="p">;</span>
<span class="p">})();</span></code></pre></div>

      <p>While it&#8217;s an elegant approach, it has its own drawbacks. First, by using different identifiers, you lose naming consistency. Whether it&#8217;s good or bad thing is not very clear. Some might prefer to have identical names, while others wouldn&#8217;t mind varying ones; after all, different names can often &#8220;speak&#8221; about implementation used. For example, seeing &#8220;attachEvent&#8221; in debugger, would let you know that it is an <code>attachEvent</code>-based implementation of <code>addEvent</code>. On the other hand, implementation-related name might not be meaningful at all. If you&#8217;re providing an API and name &#8220;inner&#8221; functions in such way, the user of API could easily get lost in all of these implementation details. </p>

      <p>A solution to this problem might be to employ different naming convention. Just be careful not to introduce extra verbosity. Some alternatives that come to mind are:</p>

<pre>
  `addEvent`, `altAddEvent` and `fallbackAddEvent`
  // or
  `addEvent`, `addEvent2`, `addEvent3`
  // or
  `addEvent_addEventListener`, `addEvent_attachEvent`, `addEvent_asProperty`
</pre>

      <p>Another minor issue with this pattern is increased memory consumption. By defining all of the function variations upfront, you implicitly create N-1 unused functions. As you can see, if <code>attachEvent</code> is found in <code>document.documentElement</code>, then neither <code>addEventListener</code> nor <code>addEventAsProperty</code> are ever really used. Yet, they already consume memory; memory which is never deallocated for the same reason as with JScript&#8217;s buggy named expressions — both functions are &#8220;trapped&#8221; in a closure of returning one. </p>

      <p>This increased consumption is of course hardly an issue. If a library such as Prototype.js was to use this pattern, there would be not more than 100-200 extra function objects created. As long as functions are not created in such way repeatedly (at runtime) but only once (at load time), you probably shouldn&#8217;t worry about it.</p>

      <h2 id="webkit-displayName">WebKit's displayName</h2>

      <p>A somewhat different approach was taken by WebKit team. Frustrated with poor representation of functions — both, anonymous and named — WebKit introduced "special" <code>displayName</code> property (essentially a string) that when assigned to a function is displayed in debugger/profiler in place of that function's "name". <a href="http://www.alertdebugging.com/2009/04/29/building-a-better-javascript-profiler-with-webkit/">Francisco Tolmasky explains in details</a> the rationale and implementation of this solution.</p>

      <h2 id="future-considerations">Future considerations</h2>

      <p>Upcoming version of ECMAScript — <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" title="Standard ECMA-262">ECMA-262, 5th edition</a> — introduces so-called <strong>strict mode</strong>. The purpose of strict mode is to disallow certain parts of the language which are considered to be fragile, unreliable or dangerous. One of such parts is <code>arguments.callee</code>, "banned" presumably due to security concerns. When in strict mode, access to <code>arguments.callee</code> results in <code>TypeError</code> (see section 10.6). The reason I'm bringing up strict mode is because inability to use <code>arguments.callee</code> for recursion in 5th edition will most likely result in increased use of named function expressions. Understanding their semantics and bugs will become even more important.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Before, you could use arguments.callee</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">})(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// In strict mode, an alternative solution is to use named function expression</span>
<span class="p">(</span><span class="kd">function</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">})(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// or just fall back to slightly less flexible function declaration</span>
<span class="kd">function</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">factorial</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span></code></pre></div>

      <h2 id="credits">Credits</h2>

      <p><strong><em>Richard Cornford</em></strong>, for being one of the first people <a href="http://groups.google.com/group/comp.lang.javascript/msg/5b508b03b004bce8">to explain JScript bug with named function expressions</a>. Richard explains most of the bugs mentioned in this article. I highly recommend reading his explanation. I would also like to thank <strong><em>Yann-Erwan Perio</em></strong> and <strong><em>Douglas Crockford</em></strong> for <a href="http://groups.google.com/group/comp.lang.javascript/msg/03d53d114d176323">mentioning and discussing NFE issues in comp.lang.javascript</a> as far back as in 2003.</p>

      <p><strong><em>John-David Dalton</em></strong>, for giving useful suggestions about &#8220;final solution&#8221;.</p>

      <p><strong><em>Tobie Langel</em></strong>, for ideas presented in &#8220;alternative solution&#8221;.</p>

      <p><strong><em>Garrett Smith</em></strong> and <strong><em>Dmitry A. Soshnikov</em></strong> for various additions and corrections.</p>

      <p>For an extensive explanation of functions in ECMAScript in Russian, see <a href="http://dmitrysoshnikov.com/ecmascript/ru-chapter-5-functions/">this article by Dmitry A. Soshnikov</a>.</p>
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>"Real" Mixins with JavaScript Classes</h1>
					<div class="tutorial__content">
 <h2 id="mixinsandjavascriptthegoodthebadandtheugly">Mixins and Javascript: The Good, the Bad, and the Ugly.</h2>

<p>Mixins and JavaScript are a like the classic Clint Eastwood movie.</p>

<p>The good is that composing objects out of small pieces of implementation is even possible due to JavaScript's flexible nature, and that mixins are fairly popular in certain circles.</p>

<p>The bad is a long list: there's no common idea of what the concept of a mixin even is in JavaScript; there's no common pattern for them; they require helper libraries to use; more advanced composition (like coordination between mixins and prototypes) is complicated and does not fall out naturally from the patterns; they're difficult to statically analyze and introspect; finally, most mixin libraries mutate objects or their prototypes, causing problems for VMs and some programmers to avoid them.</p>

<p>The ugly is that the result of all this is a balkanized ecosystem of mixin libraries and mixins, with often incompatible construction and semantics across libraries. As far as I can tell, no particular library is popular enough to even be called common. You're more likely to see a project implement its own mixin function than see a mixin library used.</p>

<p>JavaScript mixins so far have simply fallen well short of their potential, of how mixins are described in academic literature and even implemented in a few good languages.</p>

<p>For someone who loves mixins, and thinks they should be used as much as possible, this is terrible. Mixins solve a number of issues that single-inheritance languages have, and to me, most of the complaints that the prototypal crowd has against classes in JavaScript. I would argue all inheritance should be mixin inheritance - subclassing is just a degenerate form of mixin application.</p>

<p>Luckily, there's light at the end of the tunnel with JavaScript classes. Their arrival finally gives JavaScript very easy to use syntax for inheritance. JavaScript classes are more powerful than most people realize, and are a great foundation for building <em>real</em> mixins.</p>

<p>In this post I'll explore what mixins should do, what's wrong with current JavaScript mixins, and how simple it is to build a very capable mixin system in JavaScript that plays extremely well with classes.</p>

<h2 id="whatexactlyaremixins">What, Exactly, are Mixins?</h2>

<p>To understand what a mixin implementation should do, let's first look at what mixins are:</p>

<blockquote>
  <p>A mixin is an abstract subclass; i.e. a subclass definition that may be applied to different superclasses to create a related family of modified classes.</p>
  
  <p><cite>Gilad Bracha and William Cook, <a href="http://www.bracha.org/oopsla90.pdf">Mixin-based Inheritance</a></cite></p>
</blockquote>

<p>This is the best definition of mixins I've been able to find. It clearly shows the difference between a mixin and a normal class, and strongly hints at how mixins can be implemented in JavaScript.</p>

<p>To dig deeper into the implications of this definition, let's add two terms to our mixin lexicon:</p>

<ul>
<li><em>mixin definition</em>: The definition of a class that may be applied to different superclasses.</li>
<li><em>mixin application</em>: The application of a mixin definition to a specific superclass, producing a new subclass.</li>
</ul>

<p>The mixin definition is really a <em>subclass factory</em>, parameterized by the superclass, which produces mixin applications. A mixin application sits in the inheritance hierarchy between the subclass and superclass.</p>

<p>The real, and only, difference between a mixin and normal subclass is that a normal subclass has a fixed superclass, while a mixin definition doesn't yet have a superclass. Only the <em>mixin applications</em> have their own superclasses. You can even look at normal subclass inheritance as a degenerate form of mixin inheritance where the superclass is known at class definition time, and there's only one application of it.  </p>

<h3 id="examples">Examples</h3>

<p>Here's an example of <a href="https://www.dartlang.org/articles/mixins/">mixins in Dart</a>, which has a nice syntax for mixins while being similar to JavaScript:</p>

<pre><code class="language-dart">class B extends A with M {}  
</code></pre>

<p>Here <em>A</em> is a base class, <em>B</em> the subclass, and <em>M</em> a mixin. The mixin application is the specific combination of <em>M</em> mixed into <em>A</em>, often called <em>A-with-M</em>. The superclass of <em>A-with-M</em> is <em>A</em>, and the actual superclass of <em>B</em> is not <em>A</em>, as you might expect, but <em>A-with-M</em>.</p>

<p>Some class declarations and diagrams might be helpful to show what's going on. </p>

<p>Let's start with a simple class hierarchy, with class <em>B</em> inheriting from class <em>A</em>:</p>

<pre><code class="language-dart">class B extends A {}  
</code></pre>



<p>Now let's add the mixin:</p>

<pre><code class="language-dart">class B extends A with M {}  
</code></pre>

<p><img src="/content/images/2015/06/class-hierarchy-2.svg" alt="" pagespeed_url_hash="2919893995" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"/></p>

<p>As you can see, the mixin application <em>A-with-M</em> is inserted into the hierarchy between the subclass and superclass.</p>

<p>Note: I'm using long-dashed line to represent the mixin declartion (<em>B</em> includes <em>M</em>), and the short-dashed line to represent the mixin application's definition.</p>

<h4 id="multiplemixins">Multiple Mixins</h4>

<p>In Dart, multiple mixins are applied in left-to-right order, resulting in multiple mixin applications being added to the inheritance hierarchy:</p>

<pre><code class="language-dart">class B extends A with M1, M2 {}

class C extends A with M1, M2 {}  
</code></pre>

<p><img src="/content/images/2015/06/class-hierarchy-3.svg" alt="" pagespeed_url_hash="3214393916" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"/></p>

<h2 id="traditionaljavascriptmixins">Traditional JavaScript Mixins</h2>

<p>The ability to freely modify objects in JavaScript means that it's very easy to copy functions around to achieve code reuse without relying on inheritance.</p>

<p>Mixin libraries like <a href="https://github.com/onsi/cocktail">Cocktail</a>, <a href="http://soft.vub.ac.be/~tvcutsem/traitsjs/">traits.js</a>, and patterns described in many blog posts (like one of the latest to hit Hacker News: <a href="http://raganwald.com/2015/06/26/decorators-in-es7.html">Using ES7 Decorators as Mixins</a>), generally work by modifying objects in place, copying in properties from mixin objects and overwriting existing properties.</p>

<p>This is often implemented via a function similar to this:</p>

<pre><code class="language-javascript">function mixin(source, target) {  
  for (var prop in source) {
    if (source.hasOwnProperty(prop)) {
      target[prop] = source[prop];
    }
  }
}
</code></pre>

<p>A version of this has even made it into JavaScript as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a>.</p>

<p><code>mixin()</code> is usually then called on a prototype:</p>

<pre><code class="language-javascript">mixin(MyMixin, MyClass.prototype);  
</code></pre>

<p>and now <code>MyClass</code> has all the properties defined in <code>MyMixin</code>.</p>

<h3 id="whatssobadaboutthat">What's So Bad About That?</h3>

<p>Simply copying properties into a target object has a few issues. Some of this can be worked around with smart enough mixin functions, but the common examples usually have these problems:</p>

<h4 id="prototypesaremodifiedinplace">Prototypes are modified in place.</h4>

<p>When using mixin libraries against prototype objects, the prototypes are directly mutated. This is a problem if the prototype is used anywhere else that the mixed-in properties are not wanted. Mixins that add state can create slower objects in VMs that try to understand the shape of objects at allocation time. It also goes against the idea that a mixin application should create a new class by composing existing ones.</p>

<h4 id="superdoesntwork"><code>super</code> doesn't work.</h4>

<p>With JavaScript finally supporting <code>super</code>, so should mixins: A mixin's methods should be able to delegate to an overridden method up the prototype chain. Since <code>super</code> is essentially lexically bound, this won't work with copying functions.</p>

<h4 id="incorrectprecedence">Incorrect precedence.</h4>

<p>This isn't necessarily always the case, but as often shown in examples, by overwriting properties, mixin methods take precedence over those in the subclass. They should only take precedence over methods in the superclass, allowing the subclass to override methods on the mixin.</p>

<h4 id="compositioniscompromised">Composition is compromised</h4>

<p>Mixins often need to delegate to other mixins or objects on the prototype chain, but there's no natural way to do this with traditional mixins. Since functions are copied onto objects, naive implementations overwrite existing methods. More sophisticated libraries will remember the existing methods, and call multiple methods of the same name, but the library has to invent its own composition rules: What order the methods are called, what arguments are passed, etc.</p>

<p>References to functions are duplicated across all applications of a mixin, where in many cases they could be bundled in a shared prototype. By overwriting properties, the structure of protytpes and some of the dynamic nature of JavaScript is reduced: you can't easily introspect the mixins or remove or re-order mixins, because the mixin has been expanded directly into the target object.</p>

<p>If we actually use the prototype chain, all of this goes away with very little work.</p>

<h2 id="bettermixinsthroughclassexpressions">Better Mixins Through Class Expressions</h2>

<p>Now let's get to the good stuff: <em>Awesome Mixins™ 2015 Edition</em>.</p>

<p>Let's quickly list the features we'd like to enable, so we can judge our implementation against them:</p>

<ol>
<li>Mixins are added to the prototype chain.  </li>
<li>Mixins are applied without modifying existing objects.  </li>
<li>Mixins do no magic, and don't define new semantics on top of the core language.  </li>
<li><code>super.foo</code> property access works within mixins and subclasses.  </li>
<li><code>super()</code> calls work in constructors.  </li>
<li>Mixins are able to extend other mixins.  </li>
<li><code>instanceof</code> works.  </li>
<li>Mixin definitions do not require library support - they can be written in a universal style.</li>
</ol>

<h3 id="subclassfactorieswiththisoneweirdtrick">Subclass Factories with this One Weird Trick</h3>

<p>Above I referred to mixins as "subclass factories, parameterized by the superclass", and in this formulation they are literally just that.</p>

<p>We rely on two features of JavaScript classes:</p>

<ol>
<li><code>class</code> can be used as an expression as well as a statement. As an expression it returns a new class each time it's evaluated. (sort of like a factory!)  </li>
<li>The <code>extends</code> clause accepts arbitrary expressions that return classes or constructors.</li>
</ol>

<p>The key is that classes in JavaScript are first-class: they are values that can be passed to and returned from functions.</p>

<p>All we need to define a mixin is a function that accepts a superclass and creates a new subclass from it, like this:</p>

<pre><code class="language-javascript">let MyMixin = (superclass) =&gt; class extends superclass {  
  foo() {
    console.log('foo from MyMixin');
  }
};
</code></pre>

<p>Then we can use it in an <code>extends</code> clause like this:</p>

<pre><code class="language-javascript">class MyClass extends MyMixin(MyBaseClass) {  
  /* ... */
}
</code></pre>

<p>And <code>MyClass</code> now has a <code>foo</code> method via mixin inheritance:</p>

<pre><code class="language-javascript">let c = new MyClass();  
c.foo(); // prints "foo from MyMixin"  
</code></pre>

<p>Incredibly simple, and incredibly powerful! By just combining function application and class expressions we get a complete mixin solution, that generalizes well too.</p>

<p>Applying multiple mixins works as expected:</p>

<pre><code class="language-javascript">class MyClass extends Mixin1(Mixin2(MyBaseClass)) {  
  /* ... */
}
</code></pre>

<p>Mixins can easily inherit from other mixins by passing the superclass along:</p>

<pre><code class="language-javascript">let Mixin2 = (superclass) =&gt; class extends Mixin1(superclass) {  
  /* Add or override methods here */
}
</code></pre>

<p>And you can use normal function composition to compose mixins:</p>

<pre><code class="language-javascript">let CompoundMixin = (superclass) =&gt; Mixin2(Mixin3(superclass));  
</code></pre>

<h3 id="benefitsofmixinsassubclassfactories">Benefits of Mixins as Subclass Factories</h3>

<p>This approach gives us a very good implementation of mixins</p>

<h4 id="subclassescanoverridemixinmethods">Subclasses can override mixin methods.</h4>

<p>As I mentioned before, many examples of JavaScript mixins get this wrong, and mixins override the subclass. With our approach subclasses correctly override mixin methods which override superclass methods.</p>

<h4 id="superworks"><code>super</code> works.</h4>

<p>One of the biggest benefits is that <code>super</code> works inside methods of the subclass and the mixins. Since we don't ever over<em>write</em> methods on classes or mixins, they're available for <code>super</code> to address.</p>

<p><code>super</code> calls can be a little unintuitive for those new to mixins because the superclass isn't known at mixin definition, and sometimes developers expect <code>super</code> to point to the declared superclass (the parameter to the mixin), not the mixin application. Thinking about the final prototype chain helps here.</p>

<h4 id="compositionispreserved">Composition is preserved.</h4>

<p>This is really just a consequence of the other benefits, but two mixins can define the same method, and as long as they call <code>super</code>, both of them will be invoked then applied.</p>

<p>Sometimes a mixin will not know if a superclass even has a particular property or method, so it's best to guard the super call:</p>

<pre><code class="language-javascript">let Mixin1 = (superclass) =&gt; class extends superclass {  
  foo() {
    console.log('foo from Mixin1');
    if (super.foo) super.foo();
  }
};

let Mixin2 = (superclass) =&gt; class extends superclass {  
  foo() {
    console.log('foo from Mixin2');
    if (super.foo) super.foo();
  }
};

class S {  
  foo() {
    console.log('foo from S');
  }
}

class C extends Mixin1(Mixin2(S)) {  
  foo() {
    console.log('foo from C');
    super.foo();
  }
}

new C().foo();  
</code></pre>

<p>prints:</p>

<pre><code>foo from C  
foo from Mixin1  
foo from Mixin2  
foo from S  
</code></pre>

<h3 id="improvingthesyntax">Improving the Syntax</h3>

<p>I find applying mixins as functions to be both elegantly simple - describing exactly what's going on, but a little bit ugly at the same time. My biggest concern is that this construction isn't optimized for readers unfamiliar with this pattern.</p>

<p>I'd like a syntax that was easier on the eyes and at least that gave new readers something to search for to explain what's going on, like the Dart syntax. I'd also like to add some more features like memoizing the mixin applications and automatically implementing <code>instanceof</code> support.</p>

<p>For that we can write a simple helper which applies a list of mixins to a superclass, in a fluent-like API:</p>

<pre><code class="language-javascript">class MyClass extends mix(MyBaseClass).with(Mixin1, Mixin2) {  
  /* ... */
}
</code></pre>

<p>Here's the code:</p>

<pre><code class="language-javascript">let mix = (superclass) =&gt; new MixinBuilder(superclass);

class MixinBuilder {  
  constructor(superclass) {
    this.superclass = superclass;
  }

  with(...mixins) { 
    return mixins.reduce((c, mixin) =&gt; mixin(c), this.superclass);
  }
}
</code></pre>

<p>That's it! It's still extremely simple for the features and nice syntax it enables.</p>

<h3 id="constructorsandinitialization">Constructors and Initialization</h3>

<p>Constructors are a potential source of confusion with mixins. They essentially behave like methods, except that overriden methods tend to have the same signature, while constructors in a inheritance hierarchy often have different signatures.</p>

<p>Since a mixin likely does not know what superclass it's being applied to, and therefore its super-constructor signature, calling <code>super()</code> can be tricky. The best way to deal with this is to always pass along all constructor arguments to <code>super()</code>, either by not defining a constructor at all, or by using the spread operator: <code>super(...arguments)</code>.</p>

<p>This means that passing arguments specifically to a mixin's constructor is difficult. One easy workaround is to just have an explicit initialization method on the mixin if it requires arguments.</p>

<h2 id="furtherexploration">Further Exploration</h2>

<p>This is just the beginning of many topics related to mixins in JavaScript. I'll post more about things like:</p>

<ul>
<li><a href="http://justinfagnani.com/2016/01/07/enhancing-mixins-with-decorator-functions/">Enhancing Mixins with Decorator Functions</a>  new post that covers:
<ul><li>Caching mixin applications so that the same mixin applied to the same superclass reuses a prototype.</li>
<li>Getting <code>instanceof</code> to work.</li></ul></li>
<li>How mixin inheritance can address the fear that ES6 classes and classical inheritance are bad for JavaScript.</li>
<li>Using subclass-factory-style mixins in ES5.</li>
<li>De-duplicating mixins so mixin composition is more usable.</li>
</ul>

<h2 id="themixwithjsproject">The mixwith.js project</h2>

<p>I started a project on GitHub to build a library around this pattern: <a href="https://github.com/justinfagnani/mixwith.js">https://github.com/justinfagnani/mixwith.js</a> It can be found on npm: <a href="https://www.npmjs.com/package/mixwith">https://www.npmjs.com/package/mixwith</a></p>
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>JavaScript Mixins</h1>
					<div class="tutorial__content">
 <p>Let&#39;s start by defining what a mixin is. I would explain it as <em>a way to share set of data (functions, methods, variables…) with objects</em>.</p>

<p>How does that look like? Let&#39;s say we have two functions <code>Clark</code> and <code>Bruce</code> and that we want to implement two methods <code>sayName</code> and <code>secretIdentity</code> to their prototypes.</p>

<p>This is how our functions would look like:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Clark</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'Clark Kent'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span> <span class="o">=</span> <span class="s1">'Superman'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">Clark</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fly</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fly</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">Bruce</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'Bruce Wayne'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span> <span class="o">=</span> <span class="s1">'Batman'</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">Bruce</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">talk</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">"I'm Batman"</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Most common ways of adding the methods these functions are:</p>

<h4>1. Extending objects</h4>

<p>Extending object doesn&#39;t really fit our description of mixins, since we are <strong>extending</strong> instead <strong>mixing</strong>, though idea is the same. At least that&#39;s the way I see it.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Superhero</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">sayName</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">secretIdentity</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Here we extend function prototypes with object using jQuery.extend</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Clark</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Superhero</span><span class="p">);</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Bruce</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Superhero</span><span class="p">);</span></code></pre></figure>

<p>Biggest downside to this approach is that you&#39;ll either need <code>extend</code> function available from some library like <em>Underscore</em> or <em>jQuery</em> or you would have to write it.</p>

<h4>2. Functional mixin</h4>

<p>They don&#39;t require any additional library and they are faster compared to extending. Also I find this implementation frequently overlooked.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">Superhero</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sayName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">secretIdentity</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">alterego</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Here we extend function prototypes with using mixin function</span>
<span class="nx">Superhero</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Clark</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
<span class="nx">Superhero</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">Bruce</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span></code></pre></figure>

<p>Which approach do you prefer?</p>

					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Building a simple PubSub system in JavaScript</h1>
					<div class="tutorial__content">
						<div id="content">
          <div class="author">
            <div>
              <strong>Paul Kinlan</strong>
              <span><time pubdate="">December 8 2016</time></span>
            </div>
          </div>
          
          
          <p>In a recent project building a <a href="/designing-a-webpush-service">web push</a>
service I wanted to have my UI respond to application level events (semantically
if you will) because there were a couple of components that require information
from the system but are not dependent with each other and I wanted them to be
able to manage themselves independently of the ‘business logic’.</p>

<p>I looked around at lots of different tools to help me, but because I frequently
have a heavy case of NIH syndrome and the fact that I think people can implement
their own infrastructural elements pretty quickly, I decided to quickly knock-up
a simple client-side PubSub service — it worked pretty well for my
needs.</p>

<p>I debated whether I should use a custom DOM <code>Event</code> and use the existing
infrastructure that the DOM already provides to developers — the ability
to events and consuming events using <code>addEventListener</code> — but the only
problem was that you have to hang the event handler off a DOM Element or the
window because you can’t have a model that inherits or mixes in <code>EventTarget</code>.</p>

<p><em><strong>Thought:</strong> having <code>EventTarget</code> as an object would help obviate the need for
creating custom PubSub systems.</em></p>

<p>With this constraint in mind, a will to code something up, and a propensity for
not minding bugs that I create myself, I sketched out a rough plan:</p>

<pre><code>/* When a user is added, do something useful (like update UI) */
EventManager.subscribe('useradded', function(user) {
  console.log(user)
});

/* The UI submits the data, lets publish the event. */
form.onsubmit(function(e) {
  e.preventDefault();

  // do something with user fields

  EventManager.publish('useradded', user);
})
</code></pre>

<p>All of this isn’t new. Redux and many other systems already do this and in many
cases they also help you manage state. In my head, I don’t really have state
that needs a model that is septate to the state already in the browser.</p>

<p>The implementation is pretty simple to implement and the abstraction is quite
useful for me at least.</p>

<pre><code>var EventManager = new (function() {
  var events = {};

  this.publish = function(name, data) {
    var handlers = events[name];
    if(!!handlers === false) return;
    handlers.forEach(function(handler) {
      handler.call(this, data);
    });
  };

  this.subscribe = function(name, handler) {
    var handlers = events[name];
    if(!!handlers === false) {
      handlers = events[name] = [];
    }
    handlers.push(handler);
  };

  this.unsubscribe = function(name, handler) {
    var handlers = events[name];
    if(!!handlers === false) return;

    var handlerIdx = handlers.indexOf(handler);
    handlers.splice(handlerIdx);
  };
});
</code></pre>

<p>Edit: Removed the use of promise.</p>

<p>And there we are. A simple pubsub system that is likely full of bugs, but I like
it. :) I’ve put it on <a href="https://github.com/PaulKinlan/EventManager">github</a> if
you are interested in it.</p>

          
          
          
          
          
        </div>
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Build A Simple Javascript App The MVC Way</h1>
					<div class="tutorial__content">
<p>One of the best parts of JavaScript, can also be the worst. This is the undoubtedly simplistic ability to add an opening and closing script tag to the head of the HTML document and throw some spaghetti code in there. And voila! It works! Or does it? What is spaghetti code you ask? Spaghetti code is an unflattering term for code that is messy, has a tangled control structure, and is all over the place. It is nearly impossible to maintain and debug, usually has very poor structure, and is prone to errors. <a href="http://minneapolisdesigngroup.com/why-web-design-in-todays-industry-is-so-challenging/" target="_blank">Web design and development</a> is already challenging enough, don’t make your job any harder than it has to be!
</p>
<p>So how do you quit writing this kind of code? In my humble opinion, you only have two options. Again, this is just my opinion. One, you use any of the umpteen number of JavaScript frameworks available at your disposal. Or two, you learn how to write JavaScript code with some sort of pattern or structure. MVC, MVP, and MVVM are a few of the common patterns to help guide developers toward creating abstracted and decoupled solutions. The main difference between these patterns boils down to 
how the Data Layer, Presentation Layer, and Application Logic are handled. In this blog post, you will be focusing on the MVC or Model-View-Controller Pattern.  </p>
<p>Model (Data Layer)- This is where the data is stored for your app. The model is decoupled from the views and controllers and has deliberate ignorance from the wider context. Whenever a model changes, it will notify its observers that a change has occurred using an Event Dispatcher. You will read about the Event Dispatcher shortly. In your To Do List App you will be building, the Model will hold the list of tasks and be responsible for any actions taken upon each task object.  </p>
<p>View (Presentation Layer)- This part of your App has access to the DOM and is responsible for setting up Event Handlers such as: click, onmouseover, onmouseout, etc. The view is also responsible for the presentation of the HTML. In your To Do List App, the view will be responsible for displaying the list of tasks to the user. However, whenever a user enters in a new task through the input field, the view will use an Event Dispatcher to notify the controller, then the controller will update the model. This allows for swift decoupling of the view from the model.
</p>
<p>Controller (Application Logic)- The controller is the glue between the model and the view. The controller processes and responds to events set off by either the model or view. It updates the model whenever the user manipulates the view, and can also be used to update the view whenever the model changes. In this tutorial, you will be updating the view directly from your model by dispatching an event. But, either way is completely acceptable. In your To Do list App, when the user clicks the add task button, the click is forwarded to the controller, and the controller modifies the model by adding the task to it. Any other decision making or logic can also be performed here, such as: saving the data using HTML local storage, making an asynchronous save to the database/server, and more. 
</p>
<p>Event Dispatcher - The Event Dispatcher is an object that allows you to attach an unlimited number of functions/methods to it. When you finally call the notify method on that Event object, every method you attached to that Event will be ran. You will see this happening a lot in the source code below. 
</p>

<p>Now that you have a basic understanding of why you should use a JavaScript Design Pattern, and what the MVC architecture is all about, now you can start building the app. Here is a quick overview of how this tutorial will work. First, I will present the code to you. This will give you the opportunity to examine and walk through it. Second, I will go into detail about a few of the core concepts that the below code base is using, and try to shed some light upon any potential hazy or gray areas that might come across as confusing. In conclusion, I will show you a couple of screenshots of the final component. To get the most out of this tutorial, I suggest you go through this a couple of times until you feel comfortable creating this app on your own. This tutorial assumes prior HTML and JavaScript experience. If you are new to JavaScript, I recommend taking a quick look at <a href="http://www.w3schools.com/Js/" target="_blank">http://www.w3schools.com/Js/</a>. You can also find the project on GitHub at <a href="https://github.com/joshcrawmer4/Javascript-MVC-App" target="_blank">https://github.com/joshcrawmer4/Javascript-MVC-App</a>. Go ahead and get started!
</p>
<h2>Start Writing Some Code
</h2>
<p>Create an <b>index.html</b> file with the below code in it:</p>
<pre><code data-language="html">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;title&gt;Javascript MVC&lt;/title&gt;
    &lt;script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"&gt;&lt;/script&gt;

    &lt;style&gt;

    &lt;/style&gt;

&lt;/head&gt;


&lt;body&gt;

    &lt;div class="js-container"&gt;

        &lt;input type="text" class="js-task-textbox"&gt;
        &lt;input type="button" class="js-add-task-button" value="Add Task"&gt;

        &lt;div class="js-tasks-container"&gt;&lt;/div&gt;
        &lt;!-- end tasks --&gt;
        &lt;input type="button" class="js-complete-task-button" value="Complete Tasks"&gt;
        &lt;input type="button" class="js-delete-task-button" value="Delete Tasks"&gt;

    &lt;/div&gt;
    &lt;!-- end js-container --&gt;



    &lt;script src="EventDispatcher.js"&gt;&lt;/script&gt;
    &lt;script src="TaskModel.js"&gt;&lt;/script&gt;
    &lt;script src="TaskView.js"&gt;&lt;/script&gt;
    &lt;script src="TaskController.js"&gt;&lt;/script&gt;
    &lt;script src="App.js"&gt;&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<p>Next create an <b>EventDispatcher.js</b> file with the below code:</p>
<pre><code data-language="javascript">var Event = function (sender) {
    this._sender = sender;
    this._listeners = [];
}

Event.prototype = {

    attach: function (listener) {
        this._listeners.push(listener);
    },

    notify: function (args) {
        for (var i = 0; i &lt; this._listeners.length; i += 1) {
            this._listeners[i](this._sender, args);
        }
    }

};
</code></pre>
<p>Next Create a <b>TaskModel.js</b> file with the below code:</p>
<pre><code data-language="javascript">var TaskModel = function () {
     this.tasks = [];
     this.selectedTasks = [];
     this.addTaskEvent = new Event(this);
     this.removeTaskEvent = new Event(this);
     this.setTasksAsCompletedEvent = new Event(this);
     this.deleteTasksEvent = new Event(this);

 };

 TaskModel.prototype = {

     addTask: function (task) {
         this.tasks.push({
             taskName: task,
             taskStatus: 'uncompleted'
         });
         this.addTaskEvent.notify();
     },

     getTasks: function () {
         return this.tasks;
     },

     setSelectedTask: function (taskIndex) {
         this.selectedTasks.push(taskIndex);
     },

     unselectTask: function (taskIndex) {
         this.selectedTasks.splice(taskIndex, 1);
     },

     setTasksAsCompleted: function () {
         var selectedTasks = this.selectedTasks;
         for (var index in selectedTasks) {
             this.tasks[selectedTasks[index]].taskStatus = 'completed';
         }

         this.setTasksAsCompletedEvent.notify();

         this.selectedTasks = [];

     },


     deleteTasks: function () {
         var selectedTasks = this.selectedTasks.sort();

         for (var i = selectedTasks.length - 1; i &gt;= 0; i--) {
             this.tasks.splice(this.selectedTasks[i], 1);
         }

         // clear the selected tasks
         this.selectedTasks = [];

         this.deleteTasksEvent.notify();

     }


 };
</code></pre>
<p>Next Create a <b>TaskView.js</b> file with the below code:</p>
<pre><code data-language="javascript">var TaskView = function (model) {
    this.model = model;
    this.addTaskEvent = new Event(this);
    this.selectTaskEvent = new Event(this);
    this.unselectTaskEvent = new Event(this);
    this.completeTaskEvent = new Event(this);
    this.deleteTaskEvent = new Event(this);

    this.init();
};

TaskView.prototype = {

    init: function () {
        this.createChildren()
            .setupHandlers()
            .enable();
    },

    createChildren: function () {
        // cache the document object
        this.$container = $('.js-container');
        this.$addTaskButton = this.$container.find('.js-add-task-button');
        this.$taskTextBox = this.$container.find('.js-task-textbox');
        this.$tasksContainer = this.$container.find('.js-tasks-container');

        return this;
    },

    setupHandlers: function () {

        this.addTaskButtonHandler = this.addTaskButton.bind(this);
        this.selectOrUnselectTaskHandler = this.selectOrUnselectTask.bind(this);
        this.completeTaskButtonHandler = this.completeTaskButton.bind(this);
        this.deleteTaskButtonHandler = this.deleteTaskButton.bind(this);

        /**
        Handlers from Event Dispatcher
        */
        this.addTaskHandler = this.addTask.bind(this);
        this.clearTaskTextBoxHandler = this.clearTaskTextBox.bind(this);
        this.setTasksAsCompletedHandler = this.setTasksAsCompleted.bind(this);
        this.deleteTasksHandler = this.deleteTasks.bind(this);

        return this;
    },

    enable: function () {

        this.$addTaskButton.click(this.addTaskButtonHandler);
        this.$container.on('click', '.js-task', this.selectOrUnselectTaskHandler);
        this.$container.on('click', '.js-complete-task-button', this.completeTaskButtonHandler);
        this.$container.on('click', '.js-delete-task-button', this.deleteTaskButtonHandler);

        /**
         * Event Dispatcher
         */
        this.model.addTaskEvent.attach(this.addTaskHandler);
        this.model.addTaskEvent.attach(this.clearTaskTextBoxHandler);
        this.model.setTasksAsCompletedEvent.attach(this.setTasksAsCompletedHandler);
        this.model.deleteTasksEvent.attach(this.deleteTasksHandler);

        return this;
    },

    addTaskButton: function () {
        this.addTaskEvent.notify({
            task: this.$taskTextBox.val()
        });
    },

    completeTaskButton: function () {
        this.completeTaskEvent.notify();
    },

    deleteTaskButton: function () {
        this.deleteTaskEvent.notify();
    },

    selectOrUnselectTask: function () {

        var taskIndex = $(event.target).attr("data-index");

        if ($(event.target).attr('data-task-selected') == 'false') {
            $(event.target).attr('data-task-selected', true);
            this.selectTaskEvent.notify({
                taskIndex: taskIndex
            });
        } else {
            $(event.target).attr('data-task-selected', false);
            this.unselectTaskEvent.notify({
                taskIndex: taskIndex
            });
        }

    },

    show: function () {
        this.buildList();
    },

    buildList: function () {
        var tasks = this.model.getTasks();
        var html = "";
        var $tasksContainer = this.$tasksContainer;

        $tasksContainer.html('');

        var index = 0;
        for (var task in tasks) {

            if (tasks[task].taskStatus == 'completed') {
                html += "&lt;div style="color:green;"&gt;";
            } else {
                html += "&lt;div&gt;";
            }

            $tasksContainer.append(html + "&lt;label&gt;&lt;input type="checkbox" class="js-task" data-index="" + index + "" data-task-selected="false"&gt;" + tasks[task].taskName + "&lt;/label&gt;&lt;/div&gt;");

            index++;
        }

    },



    /* -------------------- Handlers From Event Dispatcher ----------------- */

    clearTaskTextBox: function () {
        this.$taskTextBox.val('');
    },

    addTask: function () {
        this.show();
    },

    setTasksAsCompleted: function () {
        this.show();

    },

    deleteTasks: function () {
        this.show();

    }

    /* -------------------- End Handlers From Event Dispatcher ----------------- */


};
</code>




</pre>
<p>Next Create a <b>TaskController.js</b> file with the below code:</p>
<pre><code data-language="javascript">var TaskController = function (model, view) {
    this.model = model;
    this.view = view;

    this.init();
};

TaskController.prototype = {

    init: function () {
        this.createChildren()
            .setupHandlers()
            .enable();
    },

    createChildren: function () {
        // no need to create children inside the controller
        // this is a job for the view
        // you could all as well leave this function out
        return this;
    },

    setupHandlers: function () {

        this.addTaskHandler = this.addTask.bind(this);
        this.selectTaskHandler = this.selectTask.bind(this);
        this.unselectTaskHandler = this.unselectTask.bind(this);
        this.completeTaskHandler = this.completeTask.bind(this);
        this.deleteTaskHandler = this.deleteTask.bind(this);
        return this;
    },

    enable: function () {

        this.view.addTaskEvent.attach(this.addTaskHandler);
        this.view.completeTaskEvent.attach(this.completeTaskHandler);
        this.view.deleteTaskEvent.attach(this.deleteTaskHandler);
        this.view.selectTaskEvent.attach(this.selectTaskHandler);
        this.view.unselectTaskEvent.attach(this.unselectTaskHandler);

        return this;
    },


    addTask: function (sender, args) {
        this.model.addTask(args.task);
    },

    selectTask: function (sender, args) {
        this.model.setSelectedTask(args.taskIndex);
    },

    unselectTask: function (sender, args) {
        this.model.unselectTask(args.taskIndex);
    },

    completeTask: function () {
        this.model.setTasksAsCompleted();
    },

    deleteTask: function () {
        this.model.deleteTasks();
    }

};
</code></pre>
<p>Next Create a <b>App.js</b> file with the below code:</p>
<pre><code data-language="javascript">$(function () {
     var model = new TaskModel(),
         view = new TaskView(model),
         controller = new TaskController(model, view);
 });

</code></pre>
<h2>Overview
</h2>
<p>Okay, so what is going on in each file!</p>
<p><b>Index.html</b> - Not much new here. Including the jQuery CDN, setting up some basic HTML, and loading the JavaScript files that we will be using in this project. Wow! That was easy!
</p>
<p><b>EventDispatcher.js</b> - This is a class with two methods, <b>attach()</b> and <b>notify()</b>. The <b>attach()</b> method accepts a function as a parameter. You can call <b>attach()</b> as many times as you want, and the function you pass can contain whatever code inside you want. Once you call the notify method on that Event object, each function you attached to that Event will be ran. 
</p>
<p><b>TaskModel.js</b> - This class has some basic methods for adding and deleting actual task objects from the <b>tasks</b> array. Setting up three Event objects inside the constructor function, allows the model to call the <b>notify()</b> method on each event object after a task has been added, marked as complete, or deleted. This, in turn, passes on the responsibility to the view to re-render the HTML to show the updated list of tasks. The main thing to recognize is that the Model passes off responsibility to the View. <b>Model -&gt; View</b>.
</p>
<p><b>TaskView.js</b> - This is the largest file in this project and could have been abstracted into multiple views. But for simplicity’s sake, I put everything into one class. The constructor function sets up five Event objects. This allows the view to call the <b>notify()</b> method on each Event object, thus passing the responsibility onto the controller. Next, you see that the constructor calls the <b>init()</b> method. This init method uses method chaining to set up the backbone of this class. 
</p>
<p><b>createChildren()</b> - Caches the <b>$('.js-container')</b> DOM element in a <b>this.$container</b> variable, then refers to that variable for each element thereafter it needs to <b>find()</b>. This is merely a performance thing, and allows jQuery to pull any elements from the variable instead of requerying/crawling the DOM. Notice the use of <b>return this</b>. This allows for the method chaining inside the previous <b>init()</b> call.
</p>
<p><b>setupHandlers()</b> - This part can be a little tricky to wrap your head around for the first time. This method is setting up the event handlers and changing the scope of the <b>this</b> keyword inside that handler. Basically, whenever you run into a JavaScript event handler and plan to use the ever so famous <b>this</b> keyword inside that callback function, then this is going to reference the actual object or element the event took place on. This is not desirable in many cases, as in the MVC case when you want <b>this</b> to reference the actual class itself. Here, you are calling the <b>bind(this)</b> method on a JavaScript callback function. This changes the <b>this</b> keyword scope to point to that of the class instead of the object or element that initialized that event. Mozilla Foundation has a good tutorial explaining how to use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank">scope bound functions</a>. 
</p>
<p><b>enable()</b> - This method sets up any DOM events and attaches any functions to the Event Dispatcher that were created by the Model. Look at this line of code:
</p>
<p><b>this.model.addTaskEvent.attach(this.addTaskHandler);
</b></p>
<p>What is actually happening here? When the model calls <b>addTaskEvent.notify()</b> your view will run the <b>this.addTaskHandler()</b> method. Sweet! You're actually seeing how the EventDispatcher works! This allows your classes to talk to each other while also staying decoupled. The <b>addTaskHandler()</b> method then calls the <b>show()</b> method which in turn calls the <b>buildList()</b> method and re-renders the HTML list. 
</p>
<p>So what should you take from all of this? Basically, once the model passes responsibility to the view, the view then re-renders the HTML to show the most up-to-date task objects. Also, whenever a user manipulates the view through a DOM event the view then passes off responsibility to the controller. The view does not work directly with the model. 
</p>
<p><b>TaskController.js</b> - This class sits between the view and the model and acts as the glue that binds them together. It allows for easy decoupling of your model and view. Whenever the view uses the EventDispatcher, the controller will be there to listen and then update the model. Besides that, all the method declarations inside this file should look relatively similar to the View and Model. 
</p>
<p><b>App.js</b> - This file is responsible for kicking off the app. An instance of the Model-View-Controller gets created here. </p>
<p><img src="http://www.awwwards.com/awards/gallery/2016/08/mvc-js-tasks.jpg" alt="mvc js tasks app"></p>
<h2>Conclusion
</h2>
<p>As a developer you must always be striving to stay current. Whether this is getting involved with projects on GitHub, dabbling in a new language, or learning design patterns and principles. But one thing is for certain, you must always be moving forward. Now that you have a basic overview of how to write JavaScript the MVC way, you see how it is possible to quit writing spaghetti code and how you can start writing cleaner and more maintainable code. Feel free to reach out to me on GitHub or post any questions in the comments section below.</p>
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>PubSub Design Pattern</h1>
					<div class="tutorial__content">
<div id="post-36" class="post-36 post type-post status-publish format-standard hentry category-javascript category-webdev">
    
          
    
    <p>Welcome to this humble article on the PubSub design pattern in Javascript. If you have ever written a relatively big Javascript app you’ll know that it can get out of hand pretty quickly, for that very reason there are lots of solutions out there that you can use to aid you in this issue, <strong>design patterns</strong> are one of the most generic solutions and very often serve as a base for another more abstract solution, like an MV* framework such as Angular and Backbone.</p>
<p>A design pattern is simply a general reusable solution to a common problem, as you might expect the implementation is up to you, nevertheless a lot of production-ready implementations can be found out there, as we’ll discuss later on this article.</p>
<p>The good thing about design patterns is that they are robust and generally accepted solutions, so you are in good hands if you decide to use a certain pattern. It’s important to remember though, that when you have a hammer everything looks like a nail, you must know when to use it and when not to; in order to do this you need to clearly understand the advantages and disadvantages of the pattern you plan to use.</p>
<p>The PubSub design pattern stands for Publish/Subscribe, and might also be called Observer pattern. This is one of the most popular design patterns in modern Javascript, and for a good reason! The general idea of this pattern is to promote loose coupling, instead of objects calling other object’s methods directly, they subscribe to an event and they get notified whenever that event occurs.</p>
<p>Let’s get our feet wet with some code, as this is all quite abstract! A nice thing about PubSub is that it’s not a complex design pattern at all, in fact, the idea is pretty simple as we just want to be notified when something happens, so if we had a pubsub implementation, our code would look something like this:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b623522657014" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">function myCallback() {
    console.log('Event 1 triggered!');
}
pubsub.subscribe('event1', myCallback);
pubsub.publish('event1');
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b623522657014-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b623522657014-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b623522657014-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b623522657014-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b623522657014-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b623522657014-6" style="height: 15px;">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b623522657014-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">myCallback</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b623522657014-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Event 1 triggered!'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b623522657014-3"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b623522657014-4"><span class="crayon-v">pubsub</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">'event1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">myCallback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b623522657014-5"><span class="crayon-v">pubsub</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">'event1'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b623522657014-6">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<p>As you can see the <code>pubsub</code> object exposes two methods, <code>subscribe</code> and <code>publish</code>, when we want to know whenever an event occurs we <strong>subscribe</strong> to that event, later on we can <strong>publish</strong> that event whenever in our code.</p>
<p>The pattern also exposes an <code>unsubscribe</code> method which simply removes a listener for a given event name.</p>
<h3>Advantages of the PubSub Pattern</h3>
<p>One of the most relevant advantages of this pattern is that it allows us to easily decouple our code, which inherently makes it more maintainable and easier to test. Another advantage is that it helps us to think in term of relationships between the different parts of our app, identifying which layers need to listen and which need to publish events.</p>
<p>We are also able to easily create dynamic relationships between the different entities of our app, making it quite flexible, as Addy Osmani says in his <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">Javascript Design Patterns</a> book:</p>
<blockquote><p>
  Whilst it may not always be the best solution to every problem, it remains one of the best tools for designing decoupled systems and should be considered an important tool in any JavaScript developer’s utility belt.
</p></blockquote>
<h3>Disadvantages of the PubSub Pattern</h3>
<p>The main disadvantage of this pattern is that as we highly decouple the different parts of our app, it can get hard to guarantee that a part of our app is working correctly.<br>
Also, as the dependencies are dynamic they can get hard to track.</p>
<h3>Implementing the PubSub Pattern</h3>
<p>Now that you have an idea of the pattern, let’s implement it! This is actually quite easy, one simplistic implementation could be as follows:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b637493324303" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">var subs = {};
var pubsub = {
    subscribe: function (evt, callback) {
        if(!subs[evt]) subs[evt] = [];
        subs[evt].push(callback);
        return callback;
    },
    publish: function (evt) {
        var args = Array.prototype.slice.call(arguments, 1);
        subs[evt].forEach(function (callback) {
            callback.apply(null, args);
        });
    },
    unsubscribe: function (evt, callback) {
        var idx = subs[evt].indexOf(callback);
        subs.splice(idx, 1);
    }
};
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b637493324303-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-9" style="height: 15px;">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-10" style="height: 15px;">10</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-11" style="height: 15px;">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-12" style="height: 15px;">12</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-13" style="height: 15px;">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-14" style="height: 15px;">14</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-15" style="height: 15px;">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-16" style="height: 15px;">16</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-17" style="height: 15px;">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b637493324303-18" style="height: 15px;">18</div><div class="crayon-num" data-line="crayon-5864ad158b637493324303-19" style="height: 15px;">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b637493324303-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">subs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">pubsub</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">subscribe</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">evt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">subs</span><span class="crayon-sy">[</span><span class="crayon-v">evt</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">subs</span><span class="crayon-sy">[</span><span class="crayon-v">evt</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">subs</span><span class="crayon-sy">[</span><span class="crayon-v">evt</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">push</span><span class="crayon-sy">(</span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">publish</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">evt</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">Array</span><span class="crayon-sy">.</span><span class="crayon-v">prototype</span><span class="crayon-sy">.</span><span class="crayon-v">slice</span><span class="crayon-sy">.</span><span class="crayon-e">call</span><span class="crayon-sy">(</span><span class="crayon-v">arguments</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">subs</span><span class="crayon-sy">[</span><span class="crayon-v">evt</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">apply</span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">unsubscribe</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">evt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">idx</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">subs</span><span class="crayon-sy">[</span><span class="crayon-v">evt</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">indexOf</span><span class="crayon-sy">(</span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">subs</span><span class="crayon-sy">.</span><span class="crayon-e">splice</span><span class="crayon-sy">(</span><span class="crayon-v">idx</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b637493324303-18"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b637493324303-19">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0036 seconds] -->
<p></p>
<p>We can use this implementation as follows:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b643936522491" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">pubsub.subscribe('greet', function (name) {
    console.log('Hello ' + name + '!');
});
pubsub.publish('greet', 'Federico');
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b643936522491-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b643936522491-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b643936522491-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b643936522491-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b643936522491-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b643936522491-1"><span class="crayon-v">pubsub</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">'greet'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b643936522491-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Hello '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'!'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b643936522491-3"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b643936522491-4"><span class="crayon-v">pubsub</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">'greet'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'Federico'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b643936522491-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p></p>
<p>That would produce a message in the developer console <code>Hello Federico!</code>, as you can see it’s pretty easy to implement and use.</p>
<h3>Other PubSub Implementations</h3>
<p>There are a bunch of PubSub implementations, the one I like the most is <a href="https://gist.github.com/661855">Ben Alman’s Gist</a>, which is really solid and succinct. Other alternatives include <a href="http://amplifyjs.com/">AmplifyJS</a> and <a href="https://github.com/mroderick/PubSubJS">PubSubJS</a>.</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b64b555162642" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">/* jQuery Tiny Pub/Sub - v0.7 - 10/27/2011
 * http://benalman.com/
 * Copyright (c) 2011 "Cowboy" Ben Alman; Licensed MIT, GPL */

(function($) {

  var o = $({});

  $.subscribe = function() {
    o.on.apply(o, arguments);
  };

  $.unsubscribe = function() {
    o.off.apply(o, arguments);
  };

  $.publish = function() {
    o.trigger.apply(o, arguments);
  };

}(jQuery));
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-9" style="height: 15px;">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-10" style="height: 15px;">10</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-11" style="height: 15px;">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-12" style="height: 15px;">12</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-13" style="height: 15px;">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-14" style="height: 15px;">14</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-15" style="height: 15px;">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-16" style="height: 15px;">16</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-17" style="height: 15px;">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-18" style="height: 15px;">18</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-19" style="height: 15px;">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-20" style="height: 15px;">20</div><div class="crayon-num" data-line="crayon-5864ad158b64b555162642-21" style="height: 15px;">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b64b555162642-22" style="height: 15px;">22</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b64b555162642-1"><span class="crayon-c">/* jQuery Tiny Pub/Sub - v0.7 - 10/27/2011</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-2"><span class="crayon-c"> * http://benalman.com/</span></div><div class="crayon-line" id="crayon-5864ad158b64b555162642-3"><span class="crayon-c"> * Copyright (c) 2011 "Cowboy" Ben Alman; Licensed MIT, GPL */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-4">&nbsp;</div><div class="crayon-line" id="crayon-5864ad158b64b555162642-5"><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-6">&nbsp;</div><div class="crayon-line" id="crayon-5864ad158b64b555162642-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">o</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-8">&nbsp;</div><div class="crayon-line" id="crayon-5864ad158b64b555162642-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-v">subscribe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">o</span><span class="crayon-sy">.</span><span class="crayon-v">on</span><span class="crayon-sy">.</span><span class="crayon-e">apply</span><span class="crayon-sy">(</span><span class="crayon-v">o</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">arguments</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b64b555162642-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-12">&nbsp;</div><div class="crayon-line" id="crayon-5864ad158b64b555162642-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-v">unsubscribe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">o</span><span class="crayon-sy">.</span><span class="crayon-v">off</span><span class="crayon-sy">.</span><span class="crayon-e">apply</span><span class="crayon-sy">(</span><span class="crayon-v">o</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">arguments</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b64b555162642-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-16">&nbsp;</div><div class="crayon-line" id="crayon-5864ad158b64b555162642-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-v">publish</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">o</span><span class="crayon-sy">.</span><span class="crayon-v">trigger</span><span class="crayon-sy">.</span><span class="crayon-e">apply</span><span class="crayon-sy">(</span><span class="crayon-v">o</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">arguments</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b64b555162642-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-20">&nbsp;</div><div class="crayon-line" id="crayon-5864ad158b64b555162642-21"><span class="crayon-sy">}</span><span class="crayon-sy">(</span><span class="crayon-v">jQuery</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b64b555162642-22">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0024 seconds] -->
<p></p>
<h3>Using PubSub with AJAX</h3>
<p>A very popular use for PubSub is whenever we are working with AJAX and async code, in the following example I illustrate a case where an user wants to search for posts, whenever the user clicks the <code>#btn-search</code> button our app should:</p>
<ul>
<li>Send an AJAX request to fetch posts which correspond to a keyword</li>
<li>Update the search history with the new keyword</li>
</ul>
<p>We could just do everything in one function, but let’s keep everything organized and decouple each task we need to perform:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b653324943211" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">// USING BEN ALMAN'S PUBSUB IMPLEMENTATION
// Subscribers
$.subscribe('posts/search', function (e, keyword) {
    $.ajax('/posts', { keyword: keyword }, function (data) {
        $.publish('/posts/all', data);
    });
})
$.subscribe('posts/search', drawHistory);
$.subscribe('posts/all', drawResults);
// Publishers
$('#btn-search').click(function () {
    var keyword = $('#search-input').val();
    $.publish('posts/search', keyword);
});
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b653324943211-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b653324943211-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b653324943211-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b653324943211-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b653324943211-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b653324943211-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b653324943211-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b653324943211-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5864ad158b653324943211-9" style="height: 15px;">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b653324943211-10" style="height: 15px;">10</div><div class="crayon-num" data-line="crayon-5864ad158b653324943211-11" style="height: 15px;">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b653324943211-12" style="height: 15px;">12</div><div class="crayon-num" data-line="crayon-5864ad158b653324943211-13" style="height: 15px;">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b653324943211-14" style="height: 15px;">14</div><div class="crayon-num" data-line="crayon-5864ad158b653324943211-15" style="height: 15px;">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b653324943211-1"><span class="crayon-c">// USING BEN ALMAN'S PUBSUB IMPLEMENTATION</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b653324943211-2"><span class="crayon-c">// Subscribers</span></div><div class="crayon-line" id="crayon-5864ad158b653324943211-3"><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">'posts/search'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">keyword</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b653324943211-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">ajax</span><span class="crayon-sy">(</span><span class="crayon-s">'/posts'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">keyword</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">keyword</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b653324943211-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">'/posts/all'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b653324943211-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b653324943211-7"><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b653324943211-8"><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">'posts/search'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">drawHistory</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b653324943211-9"><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">'posts/all'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">drawResults</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b653324943211-10"><span class="crayon-c">// Publishers</span></div><div class="crayon-line" id="crayon-5864ad158b653324943211-11"><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'#btn-search'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b653324943211-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">keyword</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'#search-input'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">val</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b653324943211-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">publish</span><span class="crayon-sy">(</span><span class="crayon-s">'posts/search'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">keyword</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b653324943211-14"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b653324943211-15">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p></p>
<p>As you can see we don’t need to wait for the AJAX request to finish to draw the search history, we can do it as soon as the button is clicked, on the other hand we do have to wait in order to draw the results. This somehow complex behaviour is easily and clearly implemented using the PubSub pattern. This scenario is pretty common in MV* frameworks such as <a href="http://backbonejs.org/">Backbone</a> which are getting increasingly popular, PubSub allows Backbone to easily decouple it’s different layers/actors from each other.</p>
<h3>A Real World Example</h3>
<p>Not too long ago I faced this issue and I was glad how easily PubSub solved it. Consider you are working in a quite big WordPress plugin which is divided into modules, each module must be independant of each other, meaning it’s possible to swap those modules anytime and their tests must not have any hard dependency, to archieve this this modules must able to “talk” to each other indirectly. How can we do this? Well we know that PubSub excels at decoupling so let’s try it out!</p>
<p>Out of all our modules, we are interested in two: <code>favs</code> and <code>images</code>. They both have a JS file: <code>favs.js</code> and <code>images.js</code> respectively.</p>
<p>We are given the task to implement “adding an image to favorites”; <code>favs.js</code> is in charge of favs, so without using pubsub a very bare-bones implementation of <code>images.js</code> might look similar to this:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b65e013299172" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">(function ($) {
    'use strict';
    function onAdded() { /* display OK message */ }
    function onFailed() { /* display FAIL message */ }
    // add to favs
    function addToFavs(id) {
        window.favs.addToFavs(id, onAdded, onFailed);
    }
    // When a #fav element is clicked save to favs
    $('#fav').click(addToFavs);
})(jQuery);
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b65e013299172-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b65e013299172-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b65e013299172-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b65e013299172-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b65e013299172-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b65e013299172-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b65e013299172-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b65e013299172-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5864ad158b65e013299172-9" style="height: 15px;">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b65e013299172-10" style="height: 15px;">10</div><div class="crayon-num" data-line="crayon-5864ad158b65e013299172-11" style="height: 15px;">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b65e013299172-12" style="height: 15px;">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b65e013299172-1"><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b65e013299172-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'use strict'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b65e013299172-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">onAdded</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* display OK message */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b65e013299172-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">onFailed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* display FAIL message */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5864ad158b65e013299172-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// add to favs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b65e013299172-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">addToFavs</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b65e013299172-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">window</span><span class="crayon-sy">.</span><span class="crayon-v">favs</span><span class="crayon-sy">.</span><span class="crayon-e">addToFavs</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">onAdded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">onFailed</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b65e013299172-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5864ad158b65e013299172-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// When a #fav element is clicked save to favs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b65e013299172-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'#fav'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-v">addToFavs</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b65e013299172-11"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">jQuery</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b65e013299172-12">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p>
<p>There are some issues with that code, one is that we have to make some kind of global variable to be able to use the <code>favs</code> API from <code>favs.js</code>, we also assume that the <code>favs.js</code> file will be loaded <strong>before</strong> <code>images.js</code>; this isn’t a very big deal as we could fix it by using something like <code>requirejs</code> but still, what if we want to test that code? Testing the <code>addToFavs</code> function would depend on the <code>window.favs</code> object.</p>
<p>Using <strong>PubSub</strong> we can rewrite our code as follows:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b666129872711" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">(function ($) {
    'use strict';
    function onAdded() { /* display OK message */ }
    function onFailed() { /* display FAIL message */ }
    // When a #fav element is clicked save to favs
    $('#fav').click(function () {
        // favs.js is subscribed to this event
        pubsub.trigger('favs/add');
    });
    pubsub.subscribe('favs/added', onAdded);
    pubsub.subscribe('favs/failed', onFailed);
})(jQuery);
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b666129872711-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b666129872711-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b666129872711-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b666129872711-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b666129872711-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b666129872711-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b666129872711-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b666129872711-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5864ad158b666129872711-9" style="height: 15px;">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b666129872711-10" style="height: 15px;">10</div><div class="crayon-num" data-line="crayon-5864ad158b666129872711-11" style="height: 15px;">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b666129872711-12" style="height: 15px;">12</div><div class="crayon-num" data-line="crayon-5864ad158b666129872711-13" style="height: 15px;">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b666129872711-1"><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b666129872711-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'use strict'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b666129872711-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">onAdded</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* display OK message */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b666129872711-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">onFailed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* display FAIL message */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5864ad158b666129872711-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// When a #fav element is clicked save to favs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b666129872711-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-s">'#fav'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">click</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b666129872711-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// favs.js is subscribed to this event</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b666129872711-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pubsub</span><span class="crayon-sy">.</span><span class="crayon-e">trigger</span><span class="crayon-sy">(</span><span class="crayon-s">'favs/add'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b666129872711-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b666129872711-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pubsub</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">'favs/added'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">onAdded</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b666129872711-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pubsub</span><span class="crayon-sy">.</span><span class="crayon-e">subscribe</span><span class="crayon-sy">(</span><span class="crayon-s">'favs/failed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">onFailed</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b666129872711-12"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">jQuery</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b666129872711-13">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p></p>
<p>Where did <code>window.favs</code> go? We don’t need it anymore! We just <strong>publish</strong> a <code>favs/add</code> event (note that it is a good practice to namespace your event names), the <code>favs.js</code> file will be listening and will react accordingly, triggering the <code>favs/added</code> and <code>favs/failed</code> events as needed. We have <strong>decoupled</strong> our little module, as a result we no longer need to use a global variable, have more flexibility on the loading order of the scripts, and more importantly we can now easily test our code by simply publishing events as needed; as a bonus this allows our tests to be more behaviour-driven rather than feature-driven, which is also a good practice :)</p>
<h3>Promises: Another solution for async code</h3>
<p>Promises are another tool we can use to deal with async code, they are gaining popularity and for a good reason! They can be quite helpful so it’s important to know what they are and when they should be used, they also plays nice with the PubSub design pattern.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Mozilla Developer Network</a> defines promises as follows:</p>
<blockquote><p>
  The Promise interface represents a proxy for a value not necessarily known when the promise is created. It allows you to associate handlers to an asynchronous action’s eventual success or failure. This lets asynchronous methods return values like synchronous methods: instead of the final value, the asynchronous method returns a promise of having a value at some point in the future.<br>
  A pending promise can become either fulfilled with a value, or rejected with a reason. When either of these happens, the associated handlers queued up by a promise’s then method are called.
</p></blockquote>
<p>That definition might be a bit hard to swallow, but it’s in fact pretty simple. Promises represent an entity which still doesn’t have a value, but it’s guaranteed that it will eventually either have a value (<strong>succeed</strong>) or <strong>fail</strong>.</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b66d101272944" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">// A simple promise
var promise = new MyPromise();
promise.then(onPromiseFinished, onPromiseFailed, onProgress);
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b66d101272944-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b66d101272944-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b66d101272944-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b66d101272944-4" style="height: 15px;">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b66d101272944-1"><span class="crayon-c">// A simple promise</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b66d101272944-2"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">promise</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MyPromise</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b66d101272944-3"><span class="crayon-v">promise</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-v">onPromiseFinished</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">onPromiseFailed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">onProgress</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b66d101272944-4">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p></p>
<p>A Promise <strong>must</strong> have a <code>then</code> function which accepts 3 callbacks, the first two are for success and failure respectively, the third one is to notify the consumer on progress, useful for very long operations but seldom used.</p>
<p>Something nice about promises is that they are <strong>chainable</strong>.</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b672793820692" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">var promise = new MyPromise();
promise.then(function () {
    console.log('First callback');
}).then(function () {
    console.log('Second callback');
});
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b672793820692-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b672793820692-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b672793820692-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b672793820692-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b672793820692-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b672793820692-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b672793820692-7" style="height: 15px;">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b672793820692-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">promise</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MyPromise</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b672793820692-2"><span class="crayon-v">promise</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b672793820692-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'First callback'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b672793820692-4"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b672793820692-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'Second callback'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b672793820692-6"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b672793820692-7">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p></p>
<p>This code will print <code>First callback</code> and then <code>Second callback</code>. Something important to not is that if one callback fails, the following won’t get executed.</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b677624020392" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">var promise = new MyPromise();
promise.then(function () {
    console.log('I get executed');
    throw 'Error';
}).then(function () {
    console.log('I don't get executed');
});
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b677624020392-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b677624020392-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b677624020392-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b677624020392-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b677624020392-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b677624020392-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b677624020392-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b677624020392-8" style="height: 15px;">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b677624020392-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">promise</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">MyPromise</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b677624020392-2"><span class="crayon-v">promise</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b677624020392-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'I get executed'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b677624020392-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-s">'Error'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b677624020392-5"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b677624020392-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-s">'I don'</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-e">get </span><span class="crayon-i">executed</span>'<span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b677624020392-7"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b677624020392-8">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p></p>
<p>This allows us to execute async code in a synchronous manner, as we are used to. Also, if one of your callbacks returns a promise, the subsequent <code>then</code> call will be evaluated on that promise you returned, this makes chaining Promises easy as pie.</p>
<h3>Common Promise Scenario #1</h3>
<p>So by now you’ve read quite a lot on abstract promises, let’s get down to a real use case! I’ll illustrate two, the first one is for caching AJAX requests. First let’s write an implementation <strong>without</strong> promises:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b67b127855212" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">var cache = {};
function loadSong(id, callback) {
    if(!cache[id] !== null) {
        callback(cache[id]);
        return;
    }
    if(cache[id] === null) {
        return;
    }
    cache[id] = null;
    $.post('/songs', { id: id }, function (data) {
        cache[id] = data;
        callback(cache[id]);
    });
}
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-9" style="height: 15px;">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-10" style="height: 15px;">10</div><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-11" style="height: 15px;">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-12" style="height: 15px;">12</div><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-13" style="height: 15px;">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-14" style="height: 15px;">14</div><div class="crayon-num" data-line="crayon-5864ad158b67b127855212-15" style="height: 15px;">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b67b127855212-16" style="height: 15px;">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b67b127855212-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">cache</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-2"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">loadSong</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b67b127855212-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">!==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b67b127855212-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5864ad158b67b127855212-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">===</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b67b127855212-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b67b127855212-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/songs'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">id</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b67b127855212-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">callback</span><span class="crayon-sy">(</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b67b127855212-15"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b67b127855212-16">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p></p>
<p>The code above simply loads a song by <code>id</code> only once and then executes a <code>callback</code>. Not too bad, a lot of Javascript code looks like that, but we can do better! Let’s use Promises! Because Promises only get resolved once, if <code>then</code> is called when a Promise is already resolved, the callback will be executed <strong>immediatly</strong>, because of this and also taking advantage of jQuery’s promises implementation we can easily cache AJAX requests as jQuery AJAX functions actually return promises:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b681771687683" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">var cache = {};
function loadSong(id, callback) {
    if(!cache[id]) {
        cache[id] = $.post('/songs', { 'id': id }).promise();
    }
    cache[id].done(callback);
}
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b681771687683-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b681771687683-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b681771687683-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b681771687683-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b681771687683-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b681771687683-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b681771687683-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b681771687683-8" style="height: 15px;">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b681771687683-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">cache</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b681771687683-2"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">loadSong</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b681771687683-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b681771687683-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/songs'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-s">'id'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">id</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">promise</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b681771687683-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b681771687683-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">cache</span><span class="crayon-sy">[</span><span class="crayon-v">id</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">done</span><span class="crayon-sy">(</span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b681771687683-7"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b681771687683-8">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p>
<p>Much better! You might notice the use of <code>.promise()</code>, this is because jQuery uses <a href="http://api.jquery.com/category/deferred-object/">Deferred</a>, which is a superset of Promise. In this case we just want to return a Promise object which can be resolved only once, so we use <code>.promise()</code>. The code would also work if we returned a <code>Deferred</code> but it’s a good jQuery practice to always return Promises.</p>
<p><strong>Note on jQuery’s Promises</strong>: There is a catch with jQuery Promises, they aren’t fully compatible with the Promises specification as you can see in <a href="http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/">Domenic Denicola’s article</a> so there are some edge cases, but I find it convenient to use jQuery’s implementation to demonstrate the concept as it’s used by a wide variety of developers. If you want a more loyal implementation you can try other libraries such as <a href="https://github.com/kriskowal/q">Q</a>, <a href="https://github.com/tildeio/rsvp.js">rsvp</a> or <a href="https://github.com/cujojs/when">when.js</a> as Domenic suggests.</p>
<h3>Common Promise Scenario #2</h3>
<p>This situation it’s also quite common, it happens whenever we have to wait for several async actions to finish before proceeding, for example:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b687861649262" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">// Get latest comments based on user and latest posts
$.post('/user/get_current_user', function (user) {
    $.post('/posts/latest', function (posts) {
        $.post('/coments/latest', {
            user: user,
            posts: posts
        }, drawToDOM);
    });
});
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b687861649262-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b687861649262-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b687861649262-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b687861649262-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b687861649262-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b687861649262-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b687861649262-7" style="height: 15px;">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b687861649262-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5864ad158b687861649262-9" style="height: 15px;">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b687861649262-10" style="height: 15px;">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b687861649262-1"><span class="crayon-c">// Get latest comments based on user and latest posts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b687861649262-2"><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/user/get_current_user'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b687861649262-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/posts/latest'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">posts</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b687861649262-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/coments/latest'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b687861649262-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">user</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">user</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b687861649262-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">posts</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">posts</span></div><div class="crayon-line" id="crayon-5864ad158b687861649262-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">drawToDOM</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b687861649262-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b687861649262-9"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b687861649262-10">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p></p>
<p>Now <strong>that’s ugly</strong>, callback spaghetti should always be avoided! Luckly a lot of libraries which implement Promises also provide method called <code>when</code> which resolves when all it’s arguments (which are promises) are resolved, knowing this we can simply code:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b68b492110187" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">$.when(
    $.post('/user/get_current_user'),
    $.post('/posts/latest')
).then(function (users, posts) {
    $.post('/comments/latest', drawToDom);
});
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b68b492110187-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b68b492110187-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b68b492110187-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b68b492110187-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b68b492110187-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b68b492110187-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b68b492110187-7" style="height: 15px;">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b68b492110187-1"><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b68b492110187-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/user/get_current_user'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5864ad158b68b492110187-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/posts/latest'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b68b492110187-4"><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">users</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">posts</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b68b492110187-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/comments/latest'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">drawToDom</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b68b492110187-6"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5864ad158b68b492110187-7">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<p>That’s much better, now the first two AJAX requests are executed at the same time, so it will be considerably faster. Moreover, the code is much cleaner, but we can still improve! Remember that we can chain <code>then</code> calls? Let’s try that:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5864ad158b690987855544" class="crayon-syntax crayon-theme-github crayon-font-liberation-mono crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;">$.when(
    $.post('/user/get_current_user'),
    $.post('/posts/latest')
).then(function (users, posts) {
    return $.post('/comments/latest');
}).then(drawToDom)
</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5864ad158b690987855544-1" style="height: 15px;">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b690987855544-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5864ad158b690987855544-3" style="height: 15px;">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b690987855544-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5864ad158b690987855544-5" style="height: 15px;">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5864ad158b690987855544-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5864ad158b690987855544-7" style="height: 15px;">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5864ad158b690987855544-1"><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">when</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b690987855544-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/user/get_current_user'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5864ad158b690987855544-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/posts/latest'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b690987855544-4"><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">users</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">posts</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5864ad158b690987855544-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">.</span><span class="crayon-e">post</span><span class="crayon-sy">(</span><span class="crayon-s">'/comments/latest'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5864ad158b690987855544-6"><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">then</span><span class="crayon-sy">(</span><span class="crayon-v">drawToDom</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5864ad158b690987855544-7">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p></p>
<p>Looking good! Promises are awesome, don’t be afraid to use them and try them out. If you want to know more about Promises I highly reccommend watching <a href="https://www.youtube.com/watch?v=juRtEEsHI9E">this <strong>great</strong> jQuery conference talk</a> by Alex McPherson. I also <a href="http://gosukiwi.svbtle.com/the-right-way-of-caching-ajax-requests-with-jquery">wrote a brief article on the subject</a>.</p>
<h3>Conclusion</h3>
<p>PubSub as well as all design patterns has known advantages and disadvantages which you should know very well. It’s main strength is highly decoupling the different parts of your application, but it also helps us work with async code and is pretty easy to use and get started, so don’t hesitate to try it out in your next project!</p>
<p>Promises can be used in conjunction with the PubSub pattern and are a very important tool we can use to deal with complex async events, as well as avoiding <a href="http://callbackhell.com/">callback hell</a>.</p>
<h3>References</h3>
<p>The following are references I used for writing this article and are recommended reads on the subject.</p>
<ul>
<li><a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">Javascript Design Patterns</a> by Addy Osmany</li>
<li><a href="http://www.objectmentor.com/resources/articles/Principles_and_Patterns.pdf">Design Principles and Design Patterns</a> by Robert C. Martin</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/">Mozilla Developer Network</a></li>
<li><a href="http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/">You’re Missing the Point of Promises</a> by Domenic Denicola</li>
</ul>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-36" class="share-facebook sd-button share-icon" href="http://federicoramirez.name/object-oriented-javascript/?share=facebook&amp;nb=1" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-36" class="share-twitter sd-button share-icon" href="http://federicoramirez.name/object-oriented-javascript/?share=twitter&amp;nb=1" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-36" class="share-google-plus-1 sd-button share-icon" href="http://federicoramirez.name/object-oriented-javascript/?share=google-plus-1&amp;nb=1" target="_blank" title="Click to share on Google+"><span>Google</span></a></li><li class="share-tumblr"><a rel="nofollow" data-shared="" class="share-tumblr sd-button share-icon" href="http://federicoramirez.name/object-oriented-javascript/?share=tumblr&amp;nb=1" target="_blank" title="Click to share on Tumblr"><span>Tumblr</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id="jp-relatedposts" class="jp-relatedposts" style="display: block;">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
<div class="jp-relatedposts-items jp-relatedposts-items-minimal"><p class="jp-relatedposts-post jp-relatedposts-post0" data-post-id="64" data-post-format="false"><span class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="http://federicoramirez.name/using-vim-in-modern-webdev/" title="Using Vim in modern WebDev

Vim is old, there's no surprise there. It is though, one of the most used tools by developers all over the world. Why? You might ask. In this post I'll try to elaborate on my reasons to use this editor and basically just let you know why I enjoy Vim…" rel="nofollow" data-origin="36" data-position="0">Using Vim in modern WebDev</a></span><span class="jp-relatedposts-post-date">November 15, 2014</span><span class="jp-relatedposts-post-context">In "vim"</span></p><p class="jp-relatedposts-post jp-relatedposts-post1" data-post-id="5" data-post-format="false"><span class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="http://federicoramirez.name/choosing-a-font/" title="Choosing a Font

For web developers creating themes, choosing a font --- or shall I say typeface, can be quite daunting and might even be quite random. A common question developers ask designers is &quot;Which font should I use?&quot;. That's like asking &quot;Which framework should I use?&quot;, the answer will most likely vary…" rel="nofollow" data-origin="36" data-position="1">Choosing a Font</a></span><span class="jp-relatedposts-post-date">November 6, 2014</span><span class="jp-relatedposts-post-context">In "typography"</span></p><p class="jp-relatedposts-post jp-relatedposts-post2" data-post-id="174" data-post-format="false"><span class="jp-relatedposts-post-title"><a class="jp-relatedposts-post-a" href="http://federicoramirez.name/why-i-prefer-bourbon-over-bootstrap/" title="Why I prefer Bourbon over Bootstrap

I wouldn't say I'm a performance addict, but I do like to write code which is efficient, easy to read and maintain. Most of the time that can be summed up as Keep It Simple, Stupid! But sometimes what might seem simple at first ends up beeing not-so-simple in the…" rel="nofollow" data-origin="36" data-position="2">Why I prefer Bourbon over Bootstrap</a></span><span class="jp-relatedposts-post-date">December 27, 2014</span><span class="jp-relatedposts-post-context">In "frontend"</span></p></div></div>
    
    <div class="more">
		    </div>
  </div>
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Glossary of Modern JavaScript Concepts: Part 1</h1>
					<h3>Learn the fundamentals of functional programming, reactive programming, and functional reactive programming in JavaScript.</h3>
					<div class="tutorial__content">
						<div class="entry-content js-entry-content" itemprop="articleBody">
              <p class="selectionShareable"><strong>TL;DR:</strong> In the first part of the Glossary of Modern JS Concepts series, we'll gain an understanding of <em>functional programming</em>, <em>reactive programming</em>, and <em>functional reactive programming</em>. To do so, we'll learn about purity, statefulness and statelessness, immutability and mutability, imperative and declarative programming, higher-order functions, observables, and the FP, RP, and FRP paradigms.</p>

<hr>

<h2>Introduction</h2>

<p class="selectionShareable">Modern JavaScript has experienced massive proliferation over recent years and shows no signs of slowing. Numerous concepts appearing in JS blogs and documentation are still unfamiliar to many front-end developers. In this post series, we'll learn intermediate and advanced concepts in the current front-end programming landscape and explore how they apply to modern JavaScript.</p>

<hr>

<h2>Concepts</h2>

<p class="selectionShareable">In this article, we'll address concepts that are crucial to understanding <strong>functional programming, reactive programming, and functional reactive programming and their use with JavaScript</strong>.</p>

<p class="selectionShareable">You can jump straight into each concept here, or continue reading to learn about them in order.</p>

<ul>
<li><a href="#purity" target="_self">Purity: Pure Functions, Impure Functions, Side Effects</a></li>
<li><a href="#state" target="_self">State: Stateful and Stateless</a></li>
<li><a href="#immutable-mutable" target="_self">Immutability and Mutability</a></li>
<li><a href="#imperative-declarative" target="_self">Imperative and Declarative Programming</a></li>
<li><a href="#higher-order-functions" target="_self">Higher-order Functions</a></li>
<li><a href="#functional-programming" target="_self">Functional Programming</a></li>
<li><a href="#observables" target="_self">Observables: Hot and Cold</a></li>
<li><a href="#reactive-programming" target="_self">Reactive Programming</a></li>
<li><a href="#functional-reactive-programming" target="_self">Functional Reactive Programming</a></li>
</ul>


<hr>

<h2><span id="purity"></span>Purity: Pure Functions, Impure Functions, Side Effects</h2>

<h3>Pure Functions</h3>

<p class="selectionShareable">A <strong>pure function</strong>'s <em>return value</em> is determined only by its <em>input values</em> (arguments) with no side effects. When given the same argument, the result will always be the same. Here is an example:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">half</span>(<span class="params">x</span>) </span>{
  <span class="keyword">return</span> x / <span class="number">2</span>;
}
</code></pre>

<p class="selectionShareable">The <code>half(x)</code> function takes a number <code>x</code> and returns a value of half of <code>x</code>. If we pass an argument of <code>8</code> to this function, the function will always return <code>4</code>. When invoked, a pure function can be replaced by its result. For example, we could replace <code>half(8)</code> with <code>4</code> wherever used in our code with no change to the final outcome. This is called <a href="https://en.wikipedia.org/wiki/Referential_transparency" target="_blank"><em>referential transparency</em></a>.</p>

<p class="selectionShareable">Pure functions only depend on what's passed to them. For example, a pure function cannot reference variables from a parent scope unless they are explicitly passed into the function as arguments. Even then, the function can <em>not modify</em> the parent scope.</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> someNum = <span class="number">8</span>;

<span class="comment">// this is NOT a pure function</span>
<span class="function"><span class="keyword">function</span> <span class="title">impureHalf</span>(<span class="params"></span>) </span>{
  <span class="keyword">return</span> someNum / <span class="number">2</span>;
}
</code></pre>

<p class="selectionShareable">In summary:</p>

<ul>
<li>Pure functions must take arguments.</li>
<li>The same input (arguments) will always produce the same output (return).</li>
<li>Pure functions rely only on local state and do not mutate external state (<em>note:</em> <code>console.log</code> changes global state).</li>
<li>Pure functions do not produce <a href="https://en.wikipedia.org/wiki/Side_effect_%28computer_science%29" target="_blank">side effects</a>.</li>
<li>Pure functions cannot call impure functions.</li>
</ul>


<h3>Impure Functions</h3>

<p class="selectionShareable">An <strong>impure function</strong> mutates state outside its scope. Any function that has <em>side effects</em> (see below) is impure. Procedural functions with no utilized return value are also impure.</p>

<p class="selectionShareable">Consider the following examples:</p>

<pre><code class="js hljs javascript"><span class="comment">// impure function producing a side effect</span>
<span class="function"><span class="keyword">function</span> <span class="title">showAlert</span>(<span class="params"></span>) </span>{
  alert(<span class="string">'This is a side effect!'</span>);
}

<span class="comment">// impure function mutating external state</span>
<span class="keyword">var</span> globalVal = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">incrementGlobalVal</span>(<span class="params">x</span>) </span>{
  globalVal += x;
}

<span class="comment">// impure function calling pure functions procedurally</span>
<span class="function"><span class="keyword">function</span> <span class="title">proceduralFn</span>(<span class="params"></span>) </span>{
  <span class="keyword">const</span> result1 = pureFnFirst(<span class="number">1</span>);
  <span class="keyword">const</span> result2 = pureFnLast(<span class="number">2</span>);
  <span class="built_in">console</span>.log(<span class="string">`Done with <span class="subst">${result1}</span> and <span class="subst">${result2}</span>!`</span>);
}

<span class="comment">// impure function that resembles a pure function,</span>
<span class="comment">// but returns different results given the same inputs</span>
<span class="function"><span class="keyword">function</span> <span class="title">getRandomRange</span>(<span class="params">min, max</span>) </span>{
  <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;
}
</code></pre>

<h3>Side Effects in JavaScript</h3>

<p class="selectionShareable">When a function or expression modifies state outside its own context, the result is a <strong>side effect</strong>. Examples of side effects include making a call to an API, manipulating the DOM, raising an alert dialog, writing to a database, etc. If a function produces side effects, it is considered <em>impure</em>. Functions that cause side effects are less predictable and harder to test since they result in changes outside their local scope.</p>

<h3>Purity Takeaways</h3>

<p class="selectionShareable">Plenty of quality code consists of <em>impure</em> functions that procedurally invoke <em>pure</em> functions. This still produces advantages for testing and immutability. Referential transparency also enables <a href="https://www.interviewcake.com/concept/python/memoization" target="_blank"><em>memoization</em></a>: caching and storing function call results and <a href="https://www.sitepoint.com/implementing-memoization-in-javascript/" target="_blank">reusing the cached results</a> when the same inputs are used again. It can be a challenge to determine when functions are truly pure.</p>

<p class="selectionShareable">To learn more about <strong>purity</strong>, check out the following resources:</p>

<ul>
<li><a href="https://toddmotto.com/pure-versus-impure-functions" target="_blank">Pure versus impure functions</a></li>
<li><a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976#.kt48h2bfa" target="_blank">Master the JavaScript Interview: What is a Pure Function?</a></li>
<li><a href="https://www.sitepoint.com/functional-programming-pure-functions/" target="_blank">Functional Programming: Pure Functions</a></li>
</ul>


<hr>

<h2><span id="state"></span>State</h2>

<p class="selectionShareable"><strong>State</strong> refers to the information a program has access to and can operate on at a point in time. This includes data stored in memory as well as OS memory, input/output ports, database, etc. For example, the contents of variables in an application at any given instant are representative of the application's <em>state</em>.</p>

<h3>Stateful</h3>

<p class="selectionShareable"><strong>Stateful</strong> programs, apps, or components store data in memory about the current state. They can modify the state as well as access its history. The following example is <em>stateful</em>:</p>

<pre><code class="js hljs javascript"><span class="comment">// stateful</span>
<span class="keyword">var</span> number = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>{
  <span class="keyword">return</span> number++;
}
increment(); <span class="comment">// global variable modified: number = 2</span>
</code></pre>

<h3>Stateless</h3>

<p class="selectionShareable"><strong>Stateless</strong> functions or components perform tasks as though running them for the first time, every time. This means they do not reference or utilize any information from earlier in their execution. Statelessness enables <em>referential transparency</em>. Functions depend only on their arguments and do not access or need knowledge of anything outside their scope. <a href="#purity" target="_self">Pure functions</a> are stateless. See the following example:</p>

<pre><code class="js hljs javascript"><span class="comment">// stateless</span>
<span class="keyword">var</span> number = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params">n</span>) </span>{
  <span class="keyword">return</span> n + <span class="number">1</span>;
}
increment(number); <span class="comment">// global variable NOT modified: returns 2</span>
</code></pre>

<p class="selectionShareable">Stateless applications <em>do</em> still manage state. However, they return their current state without <em>mutating</em> previous state. This is a tenet of <a href="#functional-programming" target="_blank">functional programming</a>.</p>

<h3>State Takeaways</h3>

<p class="selectionShareable">State management is important for any complex application. Stateful functions or components modify state and store history, but are more difficult to test and debug. Stateless functions rely only on their inputs to produce outputs. A stateless program returns new state rather than <em>modifying</em> existing state.</p>

<p class="selectionShareable">To learn more about <strong>state</strong>, check out the following resources:</p>

<ul>
<li><a href="https://en.wikipedia.org/wiki/State_(computer_science)" target="_blank">State</a></li>
<li><a href="http://stackoverflow.com/questions/844536/advantages-of-stateless-programming" target="_blank">Advantages of stateless programming</a></li>
<li><a href="https://toddmotto.com/stateful-stateless-components" target="_blank">Stateful and stateless components, the missing manual</a></li>
<li><a href="http://redux.js.org/" target="_blank">Redux: predictable state container for JavaScript apps</a></li>
</ul>


<hr>

<h2><span id="immutable-mutable"></span>Immutability and Mutability</h2>

<p class="selectionShareable">The concepts of <strong>immutability and mutability</strong> are slightly more nebulous in JavaScript than in some other programming languages. However, you will hear a lot about immutability when reading about <a href="#functional-programming" target="_self">functional programming</a> in JS. It's important to know what these terms mean classically and also how they are referenced and implemented in JavaScript. The definitions are simple enough:</p>

<h3>Immutable</h3>

<p class="selectionShareable">If an object is <strong>immutable</strong>, its value cannot be modified after creation.</p>

<h3>Mutable</h3>

<p class="selectionShareable">If an object is <strong>mutable</strong>, its value can be modified after creation.</p>

<h3>By Design: Immutability and Mutability in JavaScript</h3>

<p class="selectionShareable">In JavaScript, strings and number literals are <em>immutable by design</em>. This is easily understandable if we consider how we operate on them:</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> str = <span class="string">'Hello!'</span>;
<span class="keyword">var</span> anotherStr = str.substring(<span class="number">2</span>);
<span class="comment">// result: str = 'Hello!' (unchanged)</span>
<span class="comment">// result: anotherStr = 'llo!' (new string)</span>
</code></pre>

<p class="selectionShareable">Using the <code>.substring()</code> method on our <code>Hello!</code> string does <em>not</em> modify the original string. Instead, it creates a <em>new</em> string. We could reassign the <code>str</code> <em>variable value</em> to something else, but once we've created our <code>Hello!</code> string, it will always be <code>Hello!</code>.</p>

<p class="selectionShareable">Number literals are immutable as well. The following will always have the same result:</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> three = <span class="number">1</span> + <span class="number">2</span>;
<span class="comment">// result: three = 3</span>
</code></pre>

<p class="selectionShareable">Under no circumstances could <code>1 + 2</code> evaluate to anything other than <code>3</code>.</p>

<p class="selectionShareable">This demonstrates that immutability by design does exist in JavaScript. However, JS developers are aware that the language allows most things to be changed. For example, objects and arrays are <em>mutable by design</em>. Consider the following:</p>

<pre><code class="js hljs javascript"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];
arr.push(<span class="number">4</span>);
<span class="comment">// result: arr = [1, 2, 3, 4]</span>

<span class="keyword">var</span> obj = { greeting: <span class="string">'Hello'</span> };
obj.name = <span class="string">'Jon'</span>;
<span class="comment">// result: obj = { greeting: 'Hello', name: 'Jon' }</span>
</code></pre>

<p class="selectionShareable">In these examples, the <em>original</em> objects are mutated. New objects are not returned.</p>

<p class="selectionShareable">To learn more about mutability in other languages, check out <a href="https://www.interviewcake.com/concept/java/mutable" target="_blank">Mutable vs Immutable Objects</a>.</p>

<h3>In Practice: Immutability in JavaScript</h3>

<p class="selectionShareable"><a href="#functional-programming" target="_self">Functional programming</a> in JavaScript has gained a lot of momentum. But by design, JS is a very mutable, multi-paradigm language. Functional programming emphasizes <em>immutability</em>. Other functional languages will raise errors when a developer tries to mutate an immutable object. So how can we reconcile the innate mutability of JS when writing functional or functional reactive JS?</p>

<p class="selectionShareable">When we talk about functional programming in JS, the word "immutable" is used a lot, but it's the responsibility of the developer to write their code with immutability <em>in mind</em>. For example, <a href="https://egghead.io/lessons/javascript-redux-the-single-immutable-state-tree" target="_blank">Redux relies on a single, immutable state tree</a>. However, <em>JavaScript itself</em> is capable of mutating the state object. To implement an immutable state tree, we need to <a href="https://egghead.io/lessons/javascript-redux-avoiding-array-mutations-with-concat-slice-and-spread" target="_blank">return a <em>new</em></a> <a href="https://egghead.io/lessons/javascript-redux-avoiding-object-mutations-with-object-assign-and-spread" target="_blank">state object</a> each time the state changes.</p>

<p class="selectionShareable">JavaScript objects <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" target="_blank">can also be frozen</a> with <code>Object.freeze(obj)</code> <a href="http://adripofjavascript.com/blog/drips/immutable-objects-with-object-freeze.html" target="_blank">to make them immutable</a>. Note that this is <em>shallow</em>, meaning object values within a frozen object can still be mutated. To further ensure immutability, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" target="_blank">functions like Mozilla's deepFreeze()</a> and <a href="https://www.npmjs.com/package/deep-freeze" target="_blank">npm deep-freeze</a> can recursively freeze objects. Freezing is most practical when used in <em>tests</em> rather than in application JS. Tests will alert developers when mutations occur so they can be corrected or avoided in the actual build without <code>Object.freeze</code> cluttering up the core code.</p>

<p class="selectionShareable">There are also libraries available to support immutability in JS. <a href="http://swannodette.github.io/mori/" target="_blank">Mori</a> delivers persistent data structures based on Clojure. <a href="https://facebook.github.io/immutable-js/" target="_blank">Immutable.js</a> by Facebook also provides <a href="https://auth0.com/blog/intro-to-immutable-js/" target="_blank">immutable collections for JS</a>. Utility libraries like <a href="http://underscorejs.org" target="_blank">Underscore.js</a> and <a href="http://www.lodash.com" target="_blank">lodash</a> provide methods and modules to promote a more immutable <a href="https://github.com/lodash/lodash/wiki/FP-Guide" target="_blank">functional programming <em>style</em></a>.</p>

<h3>Immutability and Mutability Takeaways</h3>

<p class="selectionShareable">Overall, JavaScript is a very mutable language. Some styles of JS coding <em>rely</em> on this innate mutability. However, when writing functional JS, implementing immutability requires mindfulness. JS will not natively throw errors when you modify something unintentionally. Testing and libraries can assist, but working with immutability in JS takes practice and methodology.</p>

<p class="selectionShareable">Immutability has advantages. It results in code that is simpler to reason about. It also enables <a href="https://en.wikipedia.org/wiki/Persistence_(computer_science)" target="_blank"><em>persistency</em></a>, the ability to keep older versions of a data structure and copy only the parts that have changed.</p>

<p class="selectionShareable">The disadvantage of immutability is that many algorithms and operations cannot be implemented efficiently.</p>

<p class="selectionShareable">To learn more about <strong>immutability and mutability</strong>, check out the following resources:</p>

<ul>
<li><a href="https://www.sitepoint.com/immutability-javascript/" target="_blank">Immutability in JavaScript</a></li>
<li><a href="http://adripofjavascript.com/blog/drips/immutable-objects-with-object-freeze.html" target="_blank">Immutable Objects with Object Freeze</a></li>
<li><a href="https://www.interviewcake.com/concept/java/mutable" target="_blank">Mutable vs Immutable Objects</a></li>
<li><a href="http://jlongster.com/Using-Immutable-Data-Structures-in-JavaScript" target="_blank">Using Immutable Data Stuctures in JavaScript</a></li>
<li><a href="https://egghead.io/courses/getting-started-with-redux" target="_blank">Getting Started with Redux</a> (includes examples for addressing immutable state)</li>
</ul>


<hr>

<h2><span id="imperative-declarative"></span>Imperative and Declarative Programming</h2>

<p class="selectionShareable">While some languages were designed to be <strong>imperative</strong> (C, PHP) or <strong>declarative</strong> (SQL, HTML), JavaScript (and others like <a href="http://openjdk.java.net/projects/lambda/" target="_blank">Java</a> and <a href="https://msdn.microsoft.com/en-us/library/bb534803(v=vs.110).aspx" target="_blank">C#</a>) can support both programming paradigms.</p>

<p class="selectionShareable">Most developers familiar with even the most basic JavaScript have written imperative code: instructions informing the computer <em>how</em> to achieve a desired result. If you've written a <code>for</code> loop, you've written imperative JS.</p>

<p class="selectionShareable">Declarative code tells the computer <em>what</em> you want to achieve rather than how, and the computer takes care of how to achieve the end result without explicit description from the developer. If you've used <code>Array.map</code>, you've written declarative JS.</p>

<h3>Imperative Programming</h3>

<p class="selectionShareable"><strong>Imperative programming</strong> describes <em>how</em> a program's logic works in explicit commands with statements that modify the program state.</p>

<p class="selectionShareable">Consider a function that increments every number in an array of integers. An imperative JavaScript example of this might be:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">incrementArray</span>(<span class="params">arr</span>) </span>{
  <span class="keyword">let</span> resultArr = [];
  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) {
    resultArr.push(arr[i] + <span class="number">1</span>);
  }
  <span class="keyword">return</span> resultArr;
}
</code></pre>

<p class="selectionShareable">This function shows exactly <em>how</em> the function's logic works: we iterate over the array and explicitly increase each number, pushing it to a new array. We then return the resulting array. This is a step-by-step description of the function's logic.</p>

<h3>Declarative Programming</h3>

<p class="selectionShareable"><strong>Declarative programming</strong> describes <em>what</em> a program's logic accomplishes <em>without</em> describing how.</p>

<p class="selectionShareable">A very straightforward example of declarative programming can be demonstrated with <a href="https://www.khanacademy.org/computing/computer-programming/sql" target="_blank">SQL</a>. We can query a database table (<code>People</code>) for people with the last name <code>Smith</code> like so:</p>

<pre><code class="sql hljs"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> People <span class="keyword">WHERE</span> LastName = <span class="string">'Smith'</span>
</code></pre>

<p class="selectionShareable">This code is easy to read and describes <em>what</em> we want to accomplish. There is no description of <em>how</em> the result should be achieved. The computer takes care of that.</p>

<p class="selectionShareable">Now consider the <code>incrementArray()</code> function we implemented imperatively above. Let's implement this declaratively now:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">incrementArray</span>(<span class="params">arr</span>) </span>{
  <span class="keyword">return</span> arr.map(item =&gt; item + <span class="number">1</span>);
}
</code></pre>

<p class="selectionShareable">We show <em>what</em> we want to achieve, but not how it works. The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" target="_blank"><code>Array.map()</code> method</a> returns a new array with the results of running the callback on each item from the passed array. This approach does not modify existing values, nor does it include any sequential logic showing <em>how</em> it creates the new array.</p>

<blockquote><p class="selectionShareable"><strong>Note:</strong> JavaScript's <a href="https://www.sitepoint.com/map-reduce-functional-javascript/" target="_blank"><code>map</code>, <code>reduce</code>,</a> <a href="https://danmartensen.svbtle.com/javascripts-map-reduce-and-filter" target="_blank">and <code>filter</code></a> are declarative, <a href="#functional-programming" target="_self">functional</a> array methods. Utility libraries like <a href="https://lodash.com/" target="_blank">lodash</a> provide methods like <a href="https://lodash.com/docs/4.17.4#every" target="_blank"><code>every</code></a>, <a href="https://lodash.com/docs/4.17.4#sortBy" target="_blank"><code>sortBy</code></a>, <a href="https://lodash.com/docs/4.17.4#uniq" target="_blank"><code>uniq</code></a>, and more in addition to <code>map</code>, <code>reduce</code>, and <code>filter</code>.</p></blockquote>

<h3>Imperative and Declarative Programming Takeaways</h3>

<p class="selectionShareable">As a language, JavaScript allows both <strong>imperative and declarative programming</strong> paradigms. Much of the JS code we read and write is imperative. However, with the rise of <a href="#functional-programming" target="_self">functional programming</a> in JS, declarative approaches are becoming more common.</p>

<p class="selectionShareable">Declarative programming has obvious advantages with regard to brevity and readability, but at the same time it can feel magical.  Many JavaScript beginners can benefit from gaining experience writing imperative JS before diving too deep into declarative programming.</p>

<p class="selectionShareable">To learn more about <strong>imperative and declarative programming</strong>, check out the following resources:</p>

<ul>
<li><a href="https://tylermcginnis.com/imperative-vs-declarative-programming/" target="_blank">Imperative vs Declarative Programming</a></li>
<li><a href="http://softwareengineering.stackexchange.com/questions/117092/whats-the-difference-between-imperative-procedural-and-structured-programming" target="_blank">What's the Difference Between Imperative, Procedural, and Structured Programming?</a></li>
<li><a href="http://www.redotheweb.com/2015/09/18/declarative-imperative-js.html" target="_blank">Imperative and (Functional) Declarative JS In Practice</a></li>
<li><a href="https://danmartensen.svbtle.com/javascripts-map-reduce-and-filter" target="_blank">JavaScript's Map, Reduce, and Filter</a></li>
</ul>


<hr>

<h2><span id="higher-order-functions"></span>Higher-order Functions</h2>

<p class="selectionShareable">A <strong>higher-order function</strong> is a function that:</p>

<ul>
<li>accepts another function as an argument, or</li>
<li>returns a function as a result.</li>
</ul>


<p class="selectionShareable">In JavaScript, functions are <a href="http://helephant.com/2008/08/19/functions-are-first-class-objects-in-javascript/" target="_blank"><em>first-class objects</em></a>. They can be stored and passed around as <em>values</em>: we can assign a function to a variable or pass a function to another function.</p>

<pre><code class="js hljs javascript"><span class="keyword">const</span> double = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>{
  <span class="keyword">return</span> x * <span class="number">2</span>;
}
<span class="keyword">const</span> timesTwo = double;

timesTwo(<span class="number">4</span>); <span class="comment">// result: returns 8</span>
</code></pre>

<p class="selectionShareable">One example of taking a function as an argument is a <em>callback</em>. Callbacks can be inline anonymous functions or named functions:</p>

<pre><code class="js hljs javascript"><span class="keyword">const</span> myBtn = <span class="built_in">document</span>.getElementById(<span class="string">'myButton'</span>);

<span class="comment">// anonymous callback function</span>
myBtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>{ <span class="built_in">console</span>.log(<span class="string">`Click event: <span class="subst">${e}</span>`</span>); });

<span class="comment">// named callback function</span>
<span class="function"><span class="keyword">function</span> <span class="title">btnHandler</span>(<span class="params">e</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">`Click event: <span class="subst">${e}</span>`</span>);
}
myBtn.addEventListener(<span class="string">'click'</span>, btnHandler);
</code></pre>

<p class="selectionShareable">We can also pass a function as an argument to any other function we create and then execute that argument:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>) </span>{
  alert(<span class="string">'Hi!'</span>);
}
<span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">greeting</span>) </span>{
  greeting();
}
greet(sayHi); <span class="comment">// alerts "Hi!"</span>
</code></pre>

<blockquote><p class="selectionShareable"><strong>Note:</strong> When <em>passing a named function as an argument</em>, as in the two examples above, we don't use parentheses <code>()</code>. This way we're passing the function as an object. Parentheses <em>execute</em> the function and pass the result instead of the function itself.</p></blockquote>

<p class="selectionShareable">Higher-order functions can also return another function:</p>

<pre><code class="js hljs javascript"><span class="function"><span class="keyword">function</span> <span class="title">whenMeetingJohn</span>(<span class="params"></span>) </span>{
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    alert(<span class="string">'Hi!'</span>);
  }
}
<span class="keyword">var</span> atLunchToday = whenMeetingJohn();

atLunchToday(); <span class="comment">// alerts "Hi!"</span>
</code></pre>

<h3>Higher-order Function Takeaways</h3>

<p class="selectionShareable">The nature of JavaScript functions as first-class objects make them prime for facilitating <a href="#functional-programming" target="_self">functional programming</a>.</p>

<p class="selectionShareable">To learn more about <strong>higher-order functions</strong>, check out the following resources:</p>

<ul>
<li><a href="http://helephant.com/2008/08/19/functions-are-first-class-objects-in-javascript/" target="_blank">Functions are first class objects in JavaScript</a></li>
<li><a href="https://www.sitepoint.com/higher-order-functions-javascript/" target="_blank">Higher-Order Functions in JavaScript</a></li>
<li><a href="https://www.youtube.com/watch?v=BMUiFMZr7vk" target="_blank">Higher-order functions - Part 1 of Functional Programming in JavaScript</a></li>
<li><a href="http://eloquentjavascript.net/05_higher_order.html" target="_blank">Eloquent JavaScript - Higher-order Functions</a></li>
<li><a href="https://medium.com/functional-javascript/higher-order-functions-78084829fff4#.dwg58papp" target="_blank">Higher Order Functions</a></li>
</ul>


<hr>

<h2><span id="functional-programming"></span>Functional Programming</h2>

<p class="selectionShareable">Now we've learned about purity, statelessness, immutability, declarative programming, and higher-order functions. These are all concepts that are important in understanding the functional programming paradigm.</p>

<h3>In Practice: Functional Programming with JavaScript</h3>

<p class="selectionShareable"><strong>Functional programming</strong> encompasses the above concepts in the following ways:</p>

<ul>
<li>Core functionality is implemented using pure functions without side effects.</li>
<li>Data is immutable.</li>
<li>Functional programs are stateless.</li>
<li>Imperative container code manages side effects and executes declarative, pure core code.*</li>
</ul>


<blockquote><p class="selectionShareable">*If we tried to write a JavaScript web application composed of nothing but pure functions with no side effects, it couldn't interact with its environment and therefore wouldn't be particularly useful.</p></blockquote>

<p class="selectionShareable">Let's explore an example. Say we have some text copy and we want to get its word count. We also want to find keywords that are longer than five characters. Using functional programming, our resulting code might look something like this:</p>

<pre><code class="js hljs javascript"><span class="keyword">const</span> fpCopy = <span class="string">`Functional programming is powerful and enjoyable to write. It's very cool!`</span>;

<span class="comment">// remove punctuation from string </span>
<span class="keyword">const</span> stripPunctuation = (str) =&gt;
  str.replace(<span class="regexp">/[.,\/#!$%\^&amp;\*;:{}=\-_`~()]/g</span>, <span class="string">''</span>);

<span class="comment">// split passed string on spaces to create an array</span>
<span class="keyword">const</span> getArr = (str) =&gt;
  str.split(<span class="string">' '</span>);

<span class="comment">// count items in the passed array</span>
<span class="keyword">const</span> getWordCount = (arr) =&gt;
  arr.length;

<span class="comment">// find items in the passed array longer than 5 characters</span>
<span class="comment">// make items lower case</span>
<span class="keyword">const</span> getKeywords = (arr) =&gt;
  arr
    .filter(item =&gt; item.length &gt; <span class="number">5</span>)
    .map(item =&gt; item.toLowerCase());

<span class="comment">// process copy to prep the string, create an array, count words, and get keywords</span>
<span class="function"><span class="keyword">function</span> <span class="title">processCopy</span>(<span class="params">str, prepFn, arrFn, countFn, kwFn</span>) </span>{
  <span class="keyword">const</span> copyArray = arrFn(prepFn(str));

  <span class="built_in">console</span>.log(<span class="string">`Word count: <span class="subst">${countFn(copyArray)}</span>`</span>);
  <span class="built_in">console</span>.log(<span class="string">`Keywords: <span class="subst">${kwFn(copyArray)}</span>`</span>);
}

processCopy(fpCopy, stripPunctuation, getArr, getWordCount, getKeywords);
<span class="comment">// result: Word count: 11</span>
<span class="comment">// result: Keywords: functional,programming,powerful,enjoyable</span>
</code></pre>

<p class="selectionShareable">This code is available to run at this <a href="https://jsfiddle.net/kmaida/xxc7g0ve/" target="_blank">JSFiddle: Functional Programming with JavaScript</a>. It's broken into digestible, declarative functions with clear purpose. If we step through it and read the comments, no further explanation of the code should be necessary. Each <em>core</em> function is modular and relies only on its inputs (<a href="#purity" target="_self">pure</a>). The last function processes the core to generate the collective outputs. This function, <code>processCopy()</code>, is the impure container that executes the core and manages side effects. We've used a <a href="#higher-order-functions" target="_self">higher-order function</a> that accepts the other functions as arguments to maintain the functional style.</p>

<h3>Functional Programming Takeaways</h3>

<p class="selectionShareable">Immutable data and statelessness mean that the program's existing state is not modified. Instead, new values are returned. Pure functions are used for core functionality. In order to implement the program and handle necessary side effects, impure functions can call pure functions imperatively.</p>

<p class="selectionShareable">To learn more about <strong>functional programming</strong>, check out the following resources:</p>

<ul>
<li><a href="https://auth0.com/blog/intro-to-immutable-js/" target="_blank">Introduction to Immutable.js and Functional Programming Concepts</a></li>
<li><a href="http://www.defmacro.org/ramblings/fp.html" target="_blank">Functional Programming For The Rest of Us</a></li>
<li><a href="http://stephen-young.me.uk/2013/01/20/functional-programming-with-javascript.html" target="_blank">Functional Programming with JavaScript</a></li>
<li><a href="https://www.smashingmagazine.com/2014/07/dont-be-scared-of-functional-programming/" target="_blank">Don't be Scared of Functional Programming</a></li>
<li><a href="https://medium.com/@cscalfani/so-you-want-to-be-a-functional-programmer-part-1-1f15e387e536#.q8a7nwjat" target="_blank">So You Want to be a Functional Programmer</a></li>
<li><a href="https://github.com/lodash/lodash/wiki/FP-Guide" target="_blank">lodash - Functional Programming Guide</a></li>
<li><a href="http://stackoverflow.com/questions/17826380/what-is-difference-between-functional-and-imperative-programming-languages" target="_blank">What is the difference between functional and imperative programming languages?</a></li>
<li><a href="http://eloquentjavascript.net/1st_edition/chapter6.html" target="_blank">Eloquent JavaScript, 1st Edition - Functional Programming</a></li>
<li><a href="http://tobyho.com/2015/11/09/functional-programming-by-example/" target="_blank">Functional Programming by Example</a></li>
<li><a href="https://www.youtube.com/watch?v=BMUiFMZr7vk&amp;list=PL0zVEGEvSaeEd9hlmCXrk5yUyqUag-n84" target="_blank">Functional Programming in JavaScript - Video Series</a></li>
<li><a href="https://medium.com/functional-javascript/introduction-to-functional-javascript-45a9dca6c64a#.2qjh0i04y" target="_blank">Introduction to Functional JavaScript</a></li>
<li><a href="http://stackoverflow.com/questions/18172947/how-to-perform-side-effects-in-pure-functional-programming" target="_blank">How to perform side effects in pure functional programming</a></li>
<li><a href="https://davidwalsh.name/preventing-sideeffects-javascript" target="_blank">Preventing Side Effects in JavaScript</a></li>
</ul>


<hr>

<h2><span id="observables"></span>Observables</h2>

<p class="selectionShareable"><strong>Observables</strong> are similar to arrays, except instead of being stored in memory, items arrive asynchronously over time (also called <em>streams</em>). We can <em>subscribe</em> to observables and react to events emitted by them. JavaScript observables are an implementation of the <a href="http://stackoverflow.com/a/15596243" target="_blank"><em>observer pattern</em></a>. <a href="http://reactivex.io/" target="_blank">Reactive Extensions</a> (commonly known as Rx*) provides an observables library for JS via <a href="https://github.com/ReactiveX/rxjs" target="_blank">RxJS</a>.</p>

<p class="selectionShareable">To demonstrate the concept of observables, let's consider a simple example: resizing the browser window. It's easy to understand observables in this context. Resizing the browser window emits a stream of events over a period of time as the window is dragged to its desired size. We can create an observable and subscribe to it to react to the stream of resize events:</p>

<pre><code class="js hljs javascript"><span class="comment">// create window resize stream</span>
<span class="comment">// throttle resize events</span>
<span class="keyword">const</span> resize$ = 
  Rx.Observable
    .fromEvent(<span class="built_in">window</span>, <span class="string">'resize'</span>)
    .throttleTime(<span class="number">350</span>);

<span class="comment">// subscribe to the resize$ observable</span>
<span class="comment">// log window width x height</span>
<span class="keyword">const</span> subscription = 
  resize$.subscribe((event) =&gt; {
    <span class="keyword">let</span> t = event.target;
    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">${t.innerWidth}</span>px x <span class="subst">${t.innerHeight}</span>px`</span>);
  });
</code></pre>

<p class="selectionShareable">The example code above shows that as the window size changes, we can throttle the observable stream and subscribe to the changes to respond to new values in the collection. This is an example of a <em>hot observable</em>.</p>

<h3>Hot Observables</h3>

<p class="selectionShareable">User interface events like button clicks, mouse movement, etc. are <em>hot</em>. <strong>Hot observables</strong> will always push even if we're not specifically reacting to them with a subscription. The window resize example above is a hot observable: the <code>resize$</code> observable fires whether or not <code>subscription</code> exists.</p>

<h3>Cold Observables</h3>

<p class="selectionShareable">A <strong>cold observable</strong> begins pushing <em>only</em> when we subscribe to it. If we subscribe again, it will start over.</p>

<p class="selectionShareable">Let's create an observable collection of numbers ranging from <code>1</code> to <code>5</code>:</p>

<pre><code class="js hljs javascript"><span class="comment">// create source number stream</span>
<span class="keyword">const</span> source$ = Rx.Observable.range(<span class="number">1</span>, <span class="number">5</span>);

<span class="comment">// subscribe to source$ observable</span>
<span class="keyword">const</span> subscription = source$.subscribe(
  (value) =&gt; { <span class="built_in">console</span>.log(<span class="string">`Next: <span class="subst">${value}</span>`</span>); }, <span class="comment">// onNext</span>
  (event) =&gt; { <span class="built_in">console</span>.log(<span class="string">`Error: <span class="subst">${event}</span>`</span>); }, <span class="comment">// onError</span>
  () =&gt; { <span class="built_in">console</span>.log(<span class="string">'Completed!'</span>); }  <span class="comment">// onCompleted</span>
);
</code></pre>

<p class="selectionShareable">We can <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/subscribe.md" target="_blank"><code>subscribe()</code></a> to the <code>source$</code> observable we just created. Upon subscription, the values are sent in sequence to the observer. The <code>onNext</code> callback logs the values: <code>Next: 1</code>, <code>Next: 2</code>, etc. until completion: <code>Completed!</code>. The cold <code>source$</code> observable we created doesn't push unless we <em>subscribe</em> to it.</p>

<h3>Observables Takeaways</h3>

<p class="selectionShareable">Observables are streams. We can observe any stream: from resize events to existing arrays to API responses. We can create observables from almost anything. A <em>promise</em> is an observable with a single emitted value, but observables can return many values over time.</p>

<p class="selectionShareable">We can operate on observables in many ways. <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators" target="_blank">RxJS utilizes numerous operator methods</a>. Observables are often visualized using points on a line, as demonstrated on the <a href="http://rxmarbles.com" target="_blank">RxMarbles</a> site. Since the stream consists of asynchronous events over <em>time</em>, it's easy to conceptualize this in a linear fashion and use such visualizations to understand Rx* operators. For example, the following RxMarbles image illustrates the <a href="http://rxmarbles.com/#filter" target="_blank">filter operator</a>:</p>

<p class="selectionShareable"><img src="https://cdn.auth0.com/blog/jsglossary/rxmarbles.png" alt="reactive programming with Rx observables: filter operator from rxmarbles.com"></p>

<p class="selectionShareable">To learn more about <strong>observables</strong>, check out the following resources:</p>

<ul>
<li><a href="http://reactivex.io/documentation/observable.html" target="_blank">Reactive Extensions: Observable</a></li>
<li><a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/creating.md" target="_blank">Creating and Subscribing to Simple Observable Sequences</a></li>
<li><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754#request-and-response" target="_blank">The introduction to Reactive Programming you've been missing: Request and Response</a></li>
<li><a href="https://egghead.io/lessons/javascript-introducing-the-observable" target="_blank">Introducing the Observable</a></li>
<li><a href="http://rxmarbles.com/" target="_blank">RxMarbles</a></li>
<li><a href="https://xgrommx.github.io/rx-book/content/observable/index.html" target="_blank">Rx Book - Observable</a></li>
<li><a href="https://egghead.io/lessons/javascript-introducing-the-observable" target="_blank">Introducing the Observable</a></li>
</ul>


<hr>

<h2><span id="reactive-programming"></span>Reactive Programming</h2>

<p class="selectionShareable"><strong>Reactive programming</strong> is concerned with propagating and responding to incoming events over time, <a href="#imperative-declarative" target="_self">declaratively</a> (describing <em>what</em> to do rather than <em>how</em>).</p>

<p class="selectionShareable">Reactive programming is often associated with <a href="http://reactivex.io/" target="_blank">Reactive Extensions</a>, an API for asynchronous programming with <a href="#observables" target="_self">observable streams</a>. Reactive Extensions (abbreviated Rx*) <a href="http://reactivex.io/languages.html" target="_blank">provides libraries for a variety of languages</a>, including JavaScript (<a href="https://github.com/Reactive-Extensions/RxJS" target="_blank">RxJS</a>).</p>

<h3>In Practice: Reactive Programming with JavaScript</h3>

<p class="selectionShareable">Here is an example of reactive programming with observables. Let's say we have an input where the user can enter a six-character confirmation code and we want to print out the latest valid code attempt. Our HTML might look like this:</p>

<div class="highlight"><pre><code class="language-html hljs xml" data-lang="html"><span class="c"><span class="comment">&lt;!-- HTML --&gt;</span></span>
<span class="nt"><span class="tag">&lt;<span class="name">input</span></span></span><span class="tag"> </span><span class="na"><span class="tag"><span class="attr">id</span>=</span></span><span class="s"><span class="tag"><span class="string">"confirmation-code"</span></span></span><span class="tag"> </span><span class="na"><span class="tag"><span class="attr">type</span>=</span></span><span class="s"><span class="tag"><span class="string">"text"</span></span></span><span class="nt"><span class="tag">&gt;</span></span>
<span class="nt"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span>
  <span class="nt"><span class="tag">&lt;<span class="name">strong</span>&gt;</span></span>Valid code attempt:<span class="nt"><span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span>
  <span class="nt"><span class="tag">&lt;<span class="name">code</span></span></span><span class="tag"> </span><span class="na"><span class="tag"><span class="attr">id</span>=</span></span><span class="s"><span class="tag"><span class="string">"attempted-code"</span></span></span><span class="nt"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span>
<span class="nt"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></code></pre></div>


<p class="selectionShareable">We'll use RxJS and create a stream of input events to implement our functionality, like so:</p>

<pre><code class="js hljs javascript"><span class="comment">// JS</span>
<span class="keyword">const</span> confCodeInput = <span class="built_in">document</span>.getElementById(<span class="string">'confirmation-code'</span>);
<span class="keyword">const</span> attemptedCode = <span class="built_in">document</span>.getElementById(<span class="string">'attempted-code'</span>);

<span class="keyword">const</span> confCodes$ = 
  Rx.Observable
    .fromEvent(confCodeInput, <span class="string">'input'</span>)
    .map(e =&gt; e.target.value)
    .filter(code =&gt; code.length === <span class="number">6</span>);

<span class="keyword">const</span> subscription = confCodes$.subscribe(
  (value) =&gt; attemptedCode.innerText = value,
  (event) =&gt; { <span class="built_in">console</span>.warn(<span class="string">`Error: <span class="subst">${event}</span>`</span>); },
  () =&gt; { <span class="built_in">console</span>.info(<span class="string">'Completed!'</span>); }
);
</code></pre>

<p class="selectionShareable">This code can be run at this <a href="https://jsfiddle.net/kmaida/v1ozuwgu/" target="_blank">JSFiddle: Reactive Programming with JavaScript</a>. We'll observe <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/fromevent.md" target="_blank">events from</a> the <code>confCodeInput</code> input element. Then we'll use the <a href="http://reactivex.io/documentation/operators/map.html" target="_blank"><code>map</code> operator</a> to get the <code>value</code> from each input event. Next, we'll <a href="http://reactivex.io/documentation/operators/filter.html" target="_blank"><code>filter</code></a> any results that are not six characters so they won't appear in the returned stream. Finally, we'll <a href="http://reactivex.io/documentation/operators/subscribe.html" target="_blank"><code>subscribe</code></a> to our <code>confCodes$</code> observable and print out the latest valid confirmation code attempt. Note that this was done in response to events over time, declaratively: this is the crux of reactive programming.</p>

<h3>Reactive Programming Takeaways</h3>

<p class="selectionShareable">The reactive programming paradigm involves observing and reacting to events in asynchronous data streams. RxJS is used in <a href="https://medium.com/google-developer-experts/angular-introduction-to-reactive-extensions-rxjs-a86a7430a61f#.41aap1i8a" target="_blank">Angular</a> and is gaining popularity as a JavaScript solution for reactive programming.</p>

<p class="selectionShareable">To learn more about <strong>reactive programming</strong>, check out the following resources:</p>

<ul>
<li><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754" target="_blank">The introduction to Reactive Programming you've been missing</a></li>
<li><a href="http://www.introtorx.com/" target="_blank">Introduction to Rx</a></li>
<li><a href="http://www.reactivemanifesto.org/" target="_blank">The Reactive Manifesto</a></li>
<li><a href="https://auth0.com/blog/understanding-reactive-programming-and-rxjs/" target="_blank">Understanding Reactive Programming and RxJS</a></li>
<li><a href="http://paulstovell.com/blog/reactive-programming" target="_blank">Reactive Programming</a></li>
<li><a href="https://davidwalsh.name/modernization-reactivity" target="_blank">Modernization of Reactivity</a></li>
<li><a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core" target="_blank">Reactive-Extensions RxJS API Core</a></li>
</ul>


<hr>

<h2><span id="functional-reactive-programming"></span>Functional Reactive Programming</h2>

<p class="selectionShareable">In simple terms, functional reactive programming could be summarized as declaratively responding to events or behaviors over time. To understand the tenets of FRP in more depth, let's take a look at FRP's formulation. Then we'll examine its use in relation to JavaScript.</p>

<h3>What is Functional Reactive Programming?</h3>

<p class="selectionShareable">A <a href="http://stackoverflow.com/a/5386908" target="_blank">more complete definition</a> from <a href="https://twitter.com/conal" target="_blank">Conal Elliot, FRP's formulator</a>, would be that <strong>functional reactive programming</strong> is "<a href="https://en.wikibooks.org/wiki/Haskell/Denotational_semantics" target="_blank">denotative</a> and temporally continuous". Elliot mentions that he prefers to describe this programming paradigm as <em>denotative continuous-time programming</em> as opposed to "functional reactive programming".</p>

<p class="selectionShareable"><strong>Functional reactive programming</strong>, at its most basic, original  definition, has two fundamental properties:</p>

<ul>
<li><strong>denotative</strong>: the meaning of each function or type is precise, simple, and implementation-independent ("functional" references this)</li>
<li><strong>continuous time</strong>: <a href="https://en.wikipedia.org/wiki/Discrete_time_and_continuous_time#Continuous_time" target="_blank">variables have a particular value for a very short time: between any two points are an infinite number of other points</a>; provides transformation flexibility, efficiency, modularity, and accuracy ("reactive" references this)</li>
</ul>


<p class="selectionShareable">Again, when we put it simply: <a href="https://www.quora.com/What-is-Functional-Reactive-Programming" target="_blank"><strong>functional reactive programming</strong> is programming declaratively with time-varying values</a>.</p>

<p class="selectionShareable">To understand <em>continuous time / temporal continuity</em>, consider an analogy using vector graphics. Vector graphics have an <em>infinite resolution</em>. Unlike bitmap graphics (discrete resolution), vector graphics scale indefinitely. They never pixellate or become indistinct when particularly large or small the way bitmap graphics do.</p>

<blockquote><p class="selectionShareable">"FRP expressions describe entire evolutions of values over time, representing these evolutions directly as first-class values."</p>

<p class="selectionShareable">—<em>Conal Elliot</em></p></blockquote>

<p class="selectionShareable">Functional reactive programming should be:</p>

<ul>
<li>dynamic: can react over time <em>or</em> to input changes</li>
<li>time-varying: reactive <em>behaviors</em> can change continually while reactive <em>values</em> change discretely</li>
<li>efficient: minimize amount of processing necessary when inputs change</li>
<li>historically aware: pure functions map state from a previous point in time to the next point in time; state changes concern the local element and not the global program state</li>
</ul>


<p class="selectionShareable">Conal Elliot's slides on the <a href="http://conal.net/talks/essence-and-origins-of-frp-lambdajam-2015.pdf" target="_blank">Essence and Origins of FRP can be viewed here</a>. The programming language <a href="https://wiki.haskell.org/Functional_Reactive_Programming" target="_blank">Haskell</a> lends itself to true FRP due to its functional, pure, and lazy nature. Evan Czaplicki, the creator of <a href="http://elm-lang.org" target="_blank">Elm</a>, gives a great overview of FRP in his talk <a href="https://www.youtube.com/watch?v=Agu6jipKfYw" target="_blank">Controlling Time and Space: Understanding the Many Formulations of FRP</a>.</p>

<p class="selectionShareable">In fact, let's talk briefly about <a href="http://people.seas.harvard.edu/~chong/pubs/pldi13-elm.pdf" target="_blank">Evan Czapliki</a>'s <a href="https://auth0.com/blog/creating-your-first-elm-app-part-1/" target="_blank">Elm</a>. Elm is a functional, typed language for building web applications. It compiles to JavaScript, CSS, and HTML. <a href="https://guide.elm-lang.org/architecture/" target="_blank">The Elm Architecture</a> was the inspiration for the <a href="http://redux.js.org/" target="_blank">Redux</a> state container for JS apps. <a href="https://www.youtube.com/watch?v=Agu6jipKfYw" target="_blank">Elm was originally considered a true functional reactive programming language</a>, but as of version 0.17, it implemented <em>subscriptions</em> instead of signals in the interest of making the language easier to learn and use. In doing so, Elm <a href="http://elm-lang.org/blog/farewell-to-frp" target="_blank">bid farewell to FRP</a>.</p>

<h3>In Practice: Functional Reactive Programming and JavaScript</h3>

<p class="selectionShareable">The traditional definition of FRP can be difficult to grasp, especially for developers who don't have experience with languages like Haskell or Elm. However, the term has come up more frequently in the front-end ecosystem, so let's shed some light on its application in JavaScript.</p>

<p class="selectionShareable">In order to reconcile what you may have read about FRP in JS, it's important to understand that <a href="https://www.sitepoint.com/functional-reactive-programming-rxjs/" target="_blank">Rx*</a>, <a href="https://baconjs.github.io/" target="_blank">Bacon.js</a>, <a href="http://blog.angular-university.io/functional-reactive-programming-for-angular-2-developers-rxjs-and-observables/" target="_blank">Angular</a>, and others are <em>not</em> consistent with the two primary fundamentals of Conal Elliot's definition of FRP. <a href="https://stackoverflow.com/questions/5875929/specification-for-a-functional-reactive-programming-language#comment36554089_5878525" target="_blank">Elliot states that Rx* and Bacon.js are not FRP. Instead, they are "compositional event systems <em>inspired</em> by FRP"</a>.</p>

<p class="selectionShareable">Functional reactive programming, <em>as it relates specifically to JavaScript implementations</em>, refers to programming in a <a href="#functional-programming" target="_self">functional</a> style while creating and reacting to <a href="#observables" target="_self">streams</a>. This is fairly far from Elliot's original formulation (which <a href="http://conal.net/talks/essence-and-origins-of-frp-lambdajam-2015.pdf" target="_blank">specifically <em>excludes</em> streams as a component</a>), but is nevertheless inspired by traditional FRP.</p>

<p class="selectionShareable">It's also crucial to understand that JavaScript inherently interacts with the user and UI, the DOM, and often a backend. <a href="#purity" target="_self">Side effects</a> and <a href="#imperative-declarative" target="_self">imperative</a> code are par for the course, even when taking a <a href="#functional-programming" target="_self">functional</a> or functional reactive approach. <em>Without</em> imperative or impure code, a JS web application with a UI wouldn't be much use because it couldn't interact with its environment.</p>

<p class="selectionShareable">Let's take a look at an example to demonstrate the basic principles of <em>FRP-inspired</em> JavaScript. This sample uses RxJS and prints out mouse movements over a period of ten seconds:</p>

<pre><code class="js hljs javascript"><span class="comment">// create a time observable that adds an item every 1 second</span>
<span class="comment">// map so resulting stream contains event values</span>
<span class="keyword">const</span> time$ = 
  Rx.Observable
    .timer(<span class="number">0</span>, <span class="number">1000</span>)
    .timeInterval()
    .map(e =&gt; e.value);

<span class="comment">// create a mouse movement observable</span>
<span class="comment">// throttle to every 350ms</span>
<span class="comment">// map so resulting stream pushes objects with x and y coordinates</span>
<span class="keyword">const</span> move$ = 
  Rx.Observable
    .fromEvent(<span class="built_in">document</span>, <span class="string">'mousemove'</span>)
    .throttleTime(<span class="number">350</span>)
    .map(e =&gt; { <span class="keyword">return</span> {x: e.clientX, y: e.clientY} });

<span class="comment">// merge time + mouse movement streams</span>
<span class="comment">// complete after 10 seconds</span>
<span class="keyword">const</span> source$ = 
  Rx.Observable
    .merge(time$, move$)
    .takeUntil(Rx.Observable.timer(<span class="number">10000</span>));

<span class="comment">// subscribe to merged source$ observable</span>
<span class="comment">// if value is a number, createTimeset()</span>
<span class="comment">// if value is a coordinates object, addPoint()</span>
<span class="keyword">const</span> subscription = 
  source$.subscribe(
    <span class="comment">// onNext</span>
    (x) =&gt; { 
      <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">'number'</span>) {
        createTimeset(x);
      } <span class="keyword">else</span> {
        addPoint(x);
      }
    },
    <span class="comment">// onError</span>
    (err) =&gt; { <span class="built_in">console</span>.warn(<span class="string">'Error:'</span>, err); },
    <span class="comment">// onCompleted</span>
    () =&gt; { <span class="built_in">console</span>.info(<span class="string">'Completed'</span>); }
  );

<span class="comment">// add element to DOM to list out points touched in a particular second</span>
<span class="function"><span class="keyword">function</span> <span class="title">createTimeset</span>(<span class="params">n</span>) </span>{
  <span class="keyword">const</span> elem = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);
  <span class="keyword">const</span> num = n + <span class="number">1</span>;
  elem.id = <span class="string">'t'</span> + num;
  elem.innerHTML = <span class="string">`&lt;strong&gt;<span class="subst">${num}</span>&lt;/strong&gt;: `</span>;
  <span class="built_in">document</span>.body.appendChild(elem);
}

<span class="comment">// add points touched to latest time in stream</span>
<span class="function"><span class="keyword">function</span> <span class="title">addPoint</span>(<span class="params">pointObj</span>) </span>{
  <span class="comment">// add point to last appended element</span>
  <span class="keyword">const</span> numberElem = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>].lastChild;
  numberElem.innerHTML += <span class="string">` (<span class="subst">${pointObj.x}</span>, <span class="subst">${pointObj.y}</span>) `</span>;
}
</code></pre>

<p class="selectionShareable">You can check out this code in action in this <a href="https://jsfiddle.net/kmaida/3v8yw02s/" target="_blank">JSFiddle: FRP-inspired JavaScript</a>. Run the fiddle and move your mouse over the result area of the screen as it counts up to 10 seconds. You should see mouse coordinates appear along with the counter. This indicates where your mouse was during each 1-second time interval.</p>

<p class="selectionShareable">Let's briefly discuss this implementation step-by-step.</p>

<p class="selectionShareable">First, we'll create an <a href="#observables" target="_self">observable</a> called <code>time$</code>. This is a timer that adds a value to the collection every <code>1000ms</code> (every second). We need to <code>map</code> the timer event to extract its <code>value</code> and push it in the resulting stream.</p>

<p class="selectionShareable">Next, we'll create a <code>move$</code> observable from the <code>document.mousemove</code> event. Mouse movement is <em>continuous</em>. At any point in the sequence, there are an infinite number of points in between. We'll throttle this so the resulting stream is more manageable. Then we can <code>map</code> the event to return an object with <code>x</code> and <code>y</code> values to represent mouse coordinates.</p>

<p class="selectionShareable">Next we want to <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/merge.md" target="_blank">merge</a> the <code>time$</code> and <code>move$</code> streams. This is a <em>combining operator</em>. This way we can plot which mouse movements occurred during each time interval. We'll call the resulting observable <code>source$</code>. We'll also limit the <code>source$</code> observable so that it completes after ten seconds (<code>10000ms</code>).</p>

<p class="selectionShareable">Now that we have our merged stream of time and movement, we'll create a <code>subscription</code> to the <code>source$</code> observable so we can react to it. In our <code>onNext</code> callback, we'll check to see if the value is a <code>number</code> or not. If it is, we want to call a function called <code>createTimeset()</code>. If it's a coordinates object, we'll call <code>addPoint()</code>. In the <code>onError</code> and <code>onCompleted</code> callbacks, we'll simply log some information.</p>

<p class="selectionShareable">Let's look at the <code>createTimeset(n)</code> function. We'll create a new <code>div</code> element for each second interval, label it, and append it to the DOM.</p>

<p class="selectionShareable">In the <code>addPoint(pointObj)</code> function, we'll print out the latest coordinates in the most recent timeset <code>div</code>. This will associate each set of coordinates with its corresponding time interval. We can now read where the mouse has been over time.</p>

<blockquote><p class="selectionShareable"><strong>Note:</strong> These functions are <a href="#purity" target="_self">impure</a>: they have no return value and they also produce side effects. The side effects are DOM manipulations. As mentioned earlier, the JavaScript we need to write for our apps frequently interacts with scope outside its functions.</p></blockquote>

<h3>Functional Reactive Programming Takeaways</h3>

<p class="selectionShareable">FRP encodes actions that react to events using pure functions that map state from a previous point in time to the next point in time.  FRP in JavaScript doesn't adhere to the two primary fundamentals of Conal Elliot's FRP, but there is certainly value in abstractions of the original concept. JavaScript relies heavily on side effects and imperative programming, but we can certainly take advantage of the power of FRP concepts to improve our JS.</p>

<p class="selectionShareable">Finally, consider this quote from the <a href="http://eloquentjavascript.net/1st_edition/" target="_blank">first edition of Eloquent JavaScript</a> (the <a href="http://eloquentjavascript.net" target="_blank">second edition is available here</a>):</p>

<blockquote><p class="selectionShareable">"Fu-Tzu had written a small program that was full of global state and dubious shortcuts. Reading it, a student asked 'You warned us against these techniques, yet I find them in your program. How can this be?'</p>

<p class="selectionShareable">Fu-Tzu said 'There is no need to fetch a water hose when the house is not on fire.' {This is not to be read as an encouragement of sloppy programming, but rather as a warning against neurotic adherence to rules of thumb.}"</p>

<p class="selectionShareable">—<em>Marijn Haverbeke, <a href="http://eloquentjavascript.net/1st_edition/chapter6.html" target="_blank">Eloquent JavaScript, 1st Edition, Chapter 6</a></em></p></blockquote>

<p class="selectionShareable">To learn more about <strong>functional reactive programming (FRP)</strong>, check out the following resources:</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=vLmaZxegahk" target="_blank">Functional Reactive Programming for Beginners</a></li>
<li><a href="https://sideeffects.xyz/2015/the-functional-reactive-misconception/" target="_blank">The Functional Reactive Misconception</a></li>
<li><a href="http://stackoverflow.com/questions/1028250/what-is-functional-reactive-programming/1030631#1030631" target="_blank">What is Functional Reactive Programming?</a></li>
<li><a href="https://wiki.haskell.org/Functional_Reactive_Programming" target="_blank">Haskell - Functional Reactive Programming</a></li>
<li><a href="http://conal.net/fran/tutorial.htm" target="_blank">Composing Reactive Animations</a></li>
<li><a href="https://stackoverflow.com/questions/5875929/specification-for-a-functional-reactive-programming-language#5878525" target="_blank">Specification for a functional reactive programming language</a></li>
<li><a href="https://github.com/conal/talk-2015-more-elegant-frp" target="_blank">A more elegant specification for FRP</a></li>
<li><a href="https://www.youtube.com/watch?v=vLmaZxegahk" target="_blank">Functional Reactive Programming for Beginners</a></li>
<li><a href="http://elm-lang.org/blog/farewell-to-frp" target="_blank">Elm - A Farewell to FRP</a></li>
<li><a href="http://conal.net/blog/posts/early-inspirations-and-new-directions-in-functional-reactive-programming" target="_blank">Early inspirations and new directions in functional reactive programming</a></li>
<li><a href="https://blogs.janestreet.com/breaking-down-frp/" target="_blank">Breaking Down FRP</a></li>
<li><a href="https://twitter.com/ReactiveX/status/483625917491970048" target="_blank">Rx* is not FRP</a></li>
</ul>


<hr>

<h2>Conclusion</h2>

<p class="selectionShareable">We'll conclude with another excellent quote from the first edition of <a href="http://eloquentjavascript.net/1st_edition/" target="_blank">Eloquent JavaScript</a>:</p>

<blockquote><p class="selectionShareable">"A student had been sitting motionless behind his computer for hours, frowning darkly. He was trying to write a beautiful solution to a difficult problem, but could not find the right approach. Fu-Tzu hit him on the back of his head and shouted '<em>Type something!</em>' The student started writing an ugly solution. After he had finished, he suddenly understood the beautiful solution."</p>

<p class="selectionShareable">—<em>Marijn Haverbeke, <a href="http://eloquentjavascript.net/1st_edition/chapter6.html" target="_blank">Eloquent JavaScript, 1st Edition, Chapter 6</a></em></p></blockquote>

<p class="selectionShareable">The concepts necessary for understanding <a href="#functional-programming" target="_self">functional programming</a>, <a href="#reactive-programming" target="_self">reactive programming</a>, and <a href="#functional-reactive-programming" target="_self">functional reactive programming</a> can be difficult to grasp, let alone <em>master</em>. Writing code that takes advantage of a paradigm's fundamentals is the initial step, even if it isn't entirely faithful at first. Practice illuminates the path ahead and also reveals potential revisions.</p>

<p class="selectionShareable">With this glossary as a starting point, you can begin taking advantage of these concepts and programming paradigms to increase your JavaScript expertise. If anything is still unclear regarding these topics, please consult the links in each section for additional resources. We'll cover more concepts in the next Modern JS Glossary post!</p>

            </div>
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>ES6 Features</h1>
					<div class="tutorial__content">
						<a href="https://codetower.github.io/es6-features/">https://codetower.github.io/es6-features/</a>
						
<h2 id="arrow-functions">Arrow Functions</h2>
<p>A short hand notation for <code>function()</code>, but it does not bind <code>this</code>.</p>
<pre><code class="lang-javascript">no-eval
var odds = evens.map(v =&gt; v + 1);  // no parentes and no brackets
var nums = evens.map((v, i) =&gt; v + i);
var pairs = evens.map(v =&gt; ({even: v, odd: v + 1}));

// Statement bodies
nums.forEach(v =&gt; {
  if (v % 5 === 0)
    fives.push(v);
});
</code></pre>
<p>How does <code>this</code> work?</p>
<pre><code class="lang-javascript">var object = {
    name: &quot;Name&quot;, 
    arrowGetName: () =&gt; this.name,
    regularGetName: function() { return this.name },
    arrowGetThis: () =&gt; this,
    regularGetThis: function() { return this }
}

console.log(this.name)
console.log(object.arrowGetName());
console.log(object.arrowGetThis());
console.log(this)
console.log(object.regularGetName());
console.log(object.regularGetThis());
</code></pre>

<h2 id="classes">Classes</h2>
<p>As we know them from &quot;real&quot; languages. Syntactic sugar on top of prototype-inheritence. </p>
<pre><code class="lang-javascript">no-eval
class SkinnedMesh extends THREE.Mesh {
  constructor(geometry, materials) {
    super(geometry, materials);

    this.idMatrix = SkinnedMesh.defaultMatrix();
    this.bones = [];
    this.boneMatrices = [];
    //...
  }
  update(camera) {
    //...
    super.update();
  }
  get boneCount() {
    return this.bones.length;
  }
  set matrixType(matrixType) {
    this.idMatrix = SkinnedMesh[matrixType]();
  }
  static defaultMatrix() {
    return new THREE.Matrix4();
  }
}
</code></pre>
<p><a href="https://lebab.io/#">Lebab.io</a></p>
<h2 id="enhanced-object-literals">Enhanced Object Literals</h2>
<pre><code class="lang-javascript">var theProtoObj = {
  toString: function() {
    return &quot;The ProtoOBject To string&quot;
  }
}

var handler = () =&gt; &quot;handler&quot;


var obj = {
    // __proto__
    __proto__: theProtoObj,

    // Shorthand for ‘handler: handler’
    handler,

    // Methods
    toString() {

     // Super calls
     return &quot;d &quot; + super.toString();
    },

    // Computed (dynamic) property names
    [ &quot;prop_&quot; + (() =&gt; 42)() ]: 42
};

console.log(obj.handler)
console.log(obj.handler())
console.log(obj.toString())
console.log(obj.prop_42)
</code></pre>
<h2 id="string-interpolation">String interpolation</h2>
<p>Nice syntax for string interpolation (but sligthly worse performance, <a href="http://stackoverflow.com/questions/29055518/are-es6-template-literals-faster-than-string-concatenation">Source</a>)</p>
<pre><code class="lang-javascript">var name = &quot;Bob&quot;, time = &quot;today&quot;;

var multiLine = `This

Line

Spans Multiple

Lines`


console.log(`Hello ${name},how are you ${time}?`)
console.log(multiLine)
</code></pre>
<h2 id="destructuring">Destructuring</h2>
<pre><code class="lang-javascript">// list &quot;matching&quot;
var [a, , b] = [1,2,3];
console.log(a)
console.log(b)
</code></pre>
<p> Objects can be destructured as well. </p>
<pre><code class="lang-javascript">nodes = () =&gt; { return {op: &quot;a&quot;, lhs: &quot;b&quot;, rhs: &quot;c&quot;}}
var { op: a, lhs: b , rhs: c } = nodes()
console.log(a)
console.log(b)
console.log(c)
</code></pre>
<p> Using Shorthand notation.</p>
<pre><code class="lang-javascript">nodes = () =&gt; { return {lhs: &quot;a&quot;, op: &quot;b&quot;, rhs: &quot;c&quot;}}

// binds `op`, `lhs` and `rhs` in scope
var {op, lhs, rhs} = nodes()

console.log(op)
console.log(lhs)
console.log(rhs)
</code></pre>
<p>Can be used in parameter position</p>
<pre><code class="lang-javascript">
function g({name: x}) {
  return x
}

function m({name}) {
  return name
}

console.log(g({name: 5}))
console.log(m({name: 5}))
</code></pre>
<p>Fail-soft destructuring</p>
<pre><code class="lang-javascript">var [a] = []
var [b = 1] = []
var c = [];
console.log(a)
console.log(b);
console.log(c);
</code></pre>
<h2 id="default">Default</h2>
<pre><code class="lang-javascript">function f(x, y=12) {
  return x + y;
}

console.log(f(3))
</code></pre>
<h2 id="spread">Spread</h2>
<p>In functions</p>
<pre><code class="lang-javascript">function f(x, y, z) {
  return x + y + z;
}
// Pass each elem of array as argument
console.log(f(...[1,2,3]))
</code></pre>
<p>In arrays</p>
<pre><code class="lang-javascript">var parts = [&quot;shoulders&quot;, &quot;knees&quot;];
var lyrics = [&quot;head&quot;, ...parts, &quot;and&quot;, &quot;toes&quot;]; 

console.log(lyrics)
</code></pre>
<h2 id="spread-object-literals">Spread + Object Literals</h2>
<p>We can do cool stuff with this in object creations.</p>
<pre><code class="lang-javascript">no-eval
let { x, y, ...z } = { x: 1, y: 2, a: 3, b: 4 };
console.log(x); // 1
console.log(y); // 2
console.log(z); // { a: 3, b: 4 }

// Spread properties
let n = { x, y, ...z };
console.log(n); // { x: 1, y: 2, a: 3, b: 4 }
console.log(obj)
</code></pre>
<p>Sadly it is not support yet</p>
<p><code>npm install --save-dev babel-plugin-transform-object-rest-spread</code></p>
<h2 id="rest">Rest</h2>
<pre><code class="lang-javascript">function demo(part1, ...part2) {
    return ({part1, part2})
}

console.log(demo(1,2,3,4,5,6))
</code></pre>
<h2 id="let">Let</h2>
<p><code>Let</code> is the new <code>var</code>. As it has &quot;sane&quot; bindings.</p>
<pre><code class="lang-javascript">{
   var globalVar = &quot;from demo1&quot;
}

{
   let globalLet = &quot;from demo2&quot;;
}

console.log(globalVar)
console.log(globalLet)
</code></pre>
<p>However, it does not assigne anything to <code>window</code></p>
<pre><code class="lang-javascript">let me = &quot;go&quot;;  // globally scoped
var i = &quot;able&quot;; // globally scoped

console.log(window.me); 
console.log(window.i);
</code></pre>
<p>It is not possible to redeclare a variable using <code>let</code></p>
<pre><code class="lang-javascript">
let me = &quot;foo&quot;;
let me = &quot;bar&quot;; 
console.log(me);
</code></pre>
<pre><code class="lang-javascript">
var me = &quot;foo&quot;;
var me = &quot;bar&quot;; 
console.log(me)
</code></pre>
<h2 id="const">Const</h2>
<p><code>Const</code> is for read only variables</p>
<pre><code class="lang-javascript">const a = &quot;b&quot;
a = &quot;a&quot;
</code></pre>
<h2 id="for-of">For..of</h2>
<p>New type of iterators with an alternative to the <code>for..in</code>. It returns the value instead of the <code>keys</code>.</p>
<pre><code class="lang-javascript">let list = [4, 5, 6];

console.log(list)

for (let i in list) {
   console.log(i);
}
</code></pre>
<pre><code class="lang-javascript">let list = [4, 5, 6];

console.log(list)


for (let i of list) {
   console.log(i); 
}
</code></pre>
<h3 id="iterators">Iterators</h3>
<p>The iterator is a more dynamic type than arrays. </p>
<pre><code class="lang-javascript">let infinite = {
  [Symbol.iterator]() {
    let c = 0;
    return {
      next() {
        c++;
        return { done: false, value: c }
      }
    }
  }
}

console.log(&quot;start&quot;);

for (var n of infinite) {
  // truncate the sequence at 1000
  if (n &gt; 10)
    break;
  console.log(n);
}
</code></pre>
<p>Using Typescript interfaces we can see how it looks</p>
<pre><code class="lang-javascript">no-eval
interface IteratorResult {
  done: boolean;
  value: any;
}
interface Iterator {
  next(): IteratorResult;
}
interface Iterable {
  [Symbol.iterator](): Iterator
}
</code></pre>
<h3 id="generators">Generators</h3>
<p>Generators create iterators, and are more dynamic than iterators. They do not have to keep track of state in the same manner and does not support the concept of done. </p>
<pre><code class="lang-javascript">var infinity = {
  [Symbol.iterator]: function*() {
    var c = 1;
    for (;;) {   
      yield c++;
    }
  }
}

console.log(&quot;start&quot;)
for (var n of infinity) {
  // truncate the sequence at 1000
  if (n &gt; 10)
    break;
  console.log(n);
}
</code></pre>
<p>Using typescript again to show the interfaces. </p>
<pre><code class="lang-javascript">no-eval
interface Generator extends Iterator {
    next(value?: any): IteratorResult;
    throw(exception: any);
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*">function*</a>
<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Guide/Iterators_and_Generators">Iterators and generator</a></p>
<p>An example of yield* </p>
<pre><code class="lang-javascript">function* anotherGenerator(i) {
  yield i + 1;
  yield i + 2;
  yield i + 3;
}

function* generator(i) {
  yield i;
  yield* anotherGenerator(i);
  yield i + 10;
}

var gen = generator(10);

console.log(gen.next().value); 
console.log(gen.next().value); 
console.log(gen.next().value); 
console.log(gen.next().value); 
console.log(gen.next().value);
</code></pre>
<h2 id="unicode">Unicode</h2>
<p>ES6 provides better support for Unicode. </p>
<pre><code class="lang-javascript">var regex = new RegExp(&#39;\u{61}&#39;, &#39;u&#39;);

console.log(regex.unicode)
console.log(&quot;\uD842\uDFD7&quot;)
console.log(&quot;\uD842\uDFD7&quot;.codePointAt())
</code></pre>
<h2 id="modules-module-loaders">Modules &amp; Module Loaders</h2>
<p>Native support for modules.</p>
<pre><code class="lang-javascript">no-eval
import defaultMember from &quot;module-name&quot;;
import * as name from &quot;module-name&quot;;
import { member } from &quot;module-name&quot;;
import { member as alias } from &quot;module-name&quot;;
import { member1 , member2 } from &quot;module-name&quot;;
import { member1 , member2 as alias2 , [...] } from &quot;module-name&quot;;
import defaultMember, { member [ , [...] ] } from &quot;module-name&quot;;
import defaultMember, * as name from &quot;module-name&quot;;
import &quot;module-name&quot;;
</code></pre>
<pre><code class="lang-javascript">no-eval
export { name1, name2, …, nameN };
export { variable1 as name1, variable2 as name2, …, nameN };
export let name1, name2, …, nameN; // also var
export let name1 = …, name2 = …, …, nameN; // also var, const

export expression;
export default expression;
export default function (…) { … } // also class, function*
export default function name1(…) { … } // also class, function*
export { name1 as default, … };

export * from …;
export { name1, name2, …, nameN } from …;
export { import1 as name1, import2 as name2, …, nameN } from …;
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">Import</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export">Export</a></p>
<h2 id="set">Set</h2>
<p>Sets as in the mathematical counterpart where all items are unique. </p>
<pre><code class="lang-javascript">var set = new Set();
set.add(&quot;Potato&quot;).add(&quot;Tomato&quot;).add(&quot;Tomato&quot;);
console.log(set.size)
console.log(set.has(&quot;Tomato&quot;))

for(var item of set) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a></p>
<h2 id="weakset">WeakSet</h2>
<p>The <code>WeakSet</code> object lets you store weakly held objects in a collection. Objects without an reference will be garbage collected. </p>
<pre><code class="lang-javascript">var item = { a:&quot;Potato&quot;}
var set = new WeakSet();
set.add({ a:&quot;Potato&quot;}).add(item).add({ a:&quot;Tomato&quot;}).add({ a:&quot;Tomato&quot;});
console.log(set.size)
console.log(set.has({a:&quot;Tomato&quot;}))
console.log(set.has(item))

for(let item of set) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet">WeakSet</a></p>
<h2 id="map">Map</h2>
<p>Maps, also known as dictonary. </p>
<pre><code class="lang-javascript">var map = new Map();
map.set(&quot;Potato&quot;, 12);
map.set(&quot;Tomato&quot;, 34);

console.log(map.get(&quot;Potato&quot;))


for(let item of map) {
   console.log(item)
}


for(let item in map) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a></p>
<h2 id="weakmap">WeakMap</h2>
<p>Uses objects for keys, and only keeps weak reference to the keys.</p>
<pre><code class="lang-javascript">var wm = new WeakMap();

var o1  = {}
var o2  = {}
var o3  = {}


wm.set(o1, 1);
wm.set(o2, 2);
wm.set(o3, {a: &quot;a&quot;});
wm.set({}, 4);

console.log(wm.get(o2));
console.log(wm.has({}))

delete o2;

console.log(wm.get(o3));

for(let item in wm) {
   console.log(item)
}


for(let item of wm) {
   console.log(item)
}
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">WeakMap</a></p>
<h2 id="proxies">Proxies</h2>
<p>Proxies can be used to alter objects behavoir. It allows us to define traps.</p>
<pre><code class="lang-javascript">
var obj = function ProfanityGenerator() {
    return {
       words: &quot;Horrible words&quot;    
    }
}()

var handler = function CensoringHandler() {
        return {
        get: function (target, key) {
            return target[key].replace(&quot;Horrible&quot;, &quot;Nice&quot;);
        },
    }

}()

var proxy = new Proxy(obj, handler);

console.log(proxy.words);
</code></pre>
<p>The following traps are available</p>
<pre><code class="lang-javascript">no-eval
var handler =
{
  get:...,
  set:...,
  has:...,
  deleteProperty:...,
  apply:...,
  construct:...,
  getOwnPropertyDescriptor:...,
  defineProperty:...,
  getPrototypeOf:...,
  setPrototypeOf:...,
  enumerate:...,
  ownKeys:...,
  preventExtensions:...,
  isExtensible:...
}
</code></pre>
<p><a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxies</a></p>
<h2 id="symbols">Symbols</h2>
<p>Symbols are a new type. Can be used to create anomymous properties.</p>
<pre><code class="lang-javascript">var typeSymbol = Symbol(&quot;type&quot;);

class Pet {

  constructor(type) {

    this[typeSymbol] = type;

  }
  getType() {
     return this[typeSymbol];
  }

}


var a = new Pet(&quot;dog&quot;);
console.log(a.getType());
console.log(Object.getOwnPropertyNames(a))


console.log(Symbol(&quot;a&quot;) === Symbol(&quot;a&quot;))
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">More info</a></p>
<h2 id="inheritable-built-ins">Inheritable Built-ins</h2>
<p>We can now inherit from native classes. </p>
<pre><code class="lang-javascript">
class CustomArray extends Array {

}

var a = new CustomArray();

a[0] = 2
console.log(a[0])
</code></pre>
<p>It is not possible to override the getter function without using Proxies of arrays.</p>
<h2 id="new-library">New Library</h2>
<p>Various new methods and constants.</p>
<pre><code class="lang-javascript">console.log(Number.EPSILON)
console.log(Number.isInteger(Infinity))
console.log(Number.isNaN(&quot;NaN&quot;))

console.log(Math.acosh(3))
console.log(Math.hypot(3, 4))
console.log(Math.imul(Math.pow(2, 32) - 1, Math.pow(2, 32) - 2))

console.log(&quot;abcde&quot;.includes(&quot;cd&quot;) )
console.log(&quot;abc&quot;.repeat(3) )


console.log(Array.of(1, 2, 3) )
console.log([0, 0, 0].fill(7, 1) )
console.log([1, 2, 3].find(x =&gt; x == 3) )
console.log([1, 2, 3].findIndex(x =&gt; x == 2)) 
console.log([1, 2, 3, 4, 5].copyWithin(3, 0)) 
console.log([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;].entries() )
console.log([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;].keys() )
console.log([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;].values() )

console.log(Object.assign({}, { origin: new Point(0,0) }))
</code></pre>
<p>Documentation: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Number</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math">Math</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from">Array.from</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/of">Array.of</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/copyWithin">Array.prototype.copyWithin</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a></p>
<h2 id="binary-and-octal">Binary and Octal</h2>
<p>Literals for binary and octal numbering.</p>
<pre><code class="lang-javascript">console.log(0b11111)
console.log(0o2342)

console.log(0xff); // also in es5
</code></pre>
<h2 id="promises">Promises</h2>
<p>The bread and butter for async programing. </p>
<pre><code class="lang-javascript">var p1 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; resolve(&quot;1&quot;), 101)
})
var p2 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; resolve(&quot;2&quot;), 100)
})

Promise.race([p1, p2]).then((res) =&gt; {
   console.log(res)
})

Promise.all([p1, p2]).then((res) =&gt; {
   console.log(res)
})
</code></pre>
<h3 id="quick-promise">Quick Promise</h3>
<p>Need a quick always resolved promise?</p>
<pre><code class="lang-javascript">
var p1 = Promise.resolve(&quot;1&quot;)
var p2 = Promise.reject(&quot;2&quot;)

Promise.race([p1, p2]).then((res) =&gt; {
   console.log(res)
})
</code></pre>
<h3 id="fail-fast">Fail fast</h3>
<p>If a promise fails <code>all</code> and <code>race</code> will reject as well. </p>
<pre><code class="lang-javascript">var p1 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; resolve(&quot;1&quot;), 1001)
})
var p2 = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; reject(&quot;2&quot;), 1)
})

Promise.race([p1, p2]).then((res) =&gt; {
   console.log(&quot;success&quot; + res)
}, res =&gt; {
   console.log(&quot;error &quot; + res)
})

Promise.all([p1, p2]).then((res) =&gt; {
   console.log(&quot;success&quot; + res)
}, res =&gt; {
   console.log(&quot;error &quot; + res)
})
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">More Info</a></p>
<h2 id="reflect">Reflect</h2>
<p>New type of meta programming with new API for existing and also few new methods. </p>
<pre><code class="lang-javascript">
var z = {w: &quot;Super Hello&quot;}
var y = {x: &quot;hello&quot;, __proto__: z};

console.log(Reflect.getOwnPropertyDescriptor(y, &quot;x&quot;));
console.log(Reflect.has(y, &quot;w&quot;));
console.log(Reflect.ownKeys(y, &quot;w&quot;));

console.log(Reflect.has(y, &quot;x&quot;));
console.log(Reflect.deleteProperty(y,&quot;x&quot;))
console.log(Reflect.has(y, &quot;x&quot;));
</code></pre>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect">More Info</a></p>
<h2 id="tail-call-optimization">Tail Call Optimization</h2>
<p>ES6 should fix ensure tail calls does not generate stack overflow. (Not all implementations work).</p>
<pre><code class="lang-javascript">
function factorial(n, acc = 1) {
    if (n &lt;= 1) return acc; 
    return factorial(n - 1, n * acc);
}
console.log(factorial(10))
console.log(factorial(100))
console.log(factorial(1000))
console.log(factorial(10000))
console.log(factorial(100000))
console.log(factorial(1000000))
</code></pre>

<!-- endinject -->

					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Index</h1>
					<div class="tutorial__content">
						
					</div>
				</article>
				<!-- END :: Tutorial -->
				
				<!-- START :: Tutorial -->
				<article>
					<h1>Index</h1>
					<div class="tutorial__content">
						
					</div>
				</article>
				<!-- END :: Tutorial -->
				
			</section>
			
		</main>
	</body>
</html>		