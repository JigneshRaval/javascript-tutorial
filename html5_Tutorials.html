<html>
	<head>
		<style>
		@font-face {
    font-family: 'pt_sansregular';
    src: url('fonts/PTS55F-webfont.eot');
    src: url('fonts/PTS55F-webfont.eot?#iefix') format('embedded-opentype'),
         url('fonts/PTS55F-webfont.woff') format('woff'),
         url('fonts/PTS55F-webfont.ttf') format('truetype'),
         url('fonts/PTS55F-webfont.svg#pt_sansregular') format('svg');
    font-weight: normal;
    font-style: normal;
}
body { font-family: 'pt_sansregular', Arial, Tahoma, Helvetica, FreeSans, sans-serif; line-height: 1.7; font-size: 14px; }
pre {
	border: 1px dashed #888;
	padding: 15px;
    word-break: normal;
    word-break: break-all;
    word-wrap: break-word;
	    font-size: 13px;
    line-height: 1.42857143;
	white-space: pre-wrap;       /* css-3 */
 white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
 white-space: -pre-wrap;      /* Opera 4-6 */
 white-space: -o-pre-wrap;    /* Opera 7 */
 word-wrap: break-word;       /* Internet Explorer 5.5+ */
 position: relative;
}
pre:after {
content: "CODE";
position: absolute;
right: 0;
top: 0;
padding: 5px 10px;
border-left: 1px dashed #888;
border-bottom: 1px dashed #888;
}
h1{ border-top: 1px solid #666; border-bottom: 2px solid #888; padding: 10px 0; font-size: 20px; text-align: center; }
h2, h3 { font-size: 16px; border-left: 6px solid #666; padding: 5px 15px; }
code, kbd, pre, samp {
    font-family: Menlo,Monaco,Consolas,"Courier New",monospace;
}
code {
    padding: 2px 4px;
    font-size: 90%;
    background-color: #f9f2f4;
    border-radius: 4px;
}
blockquote {
    letter-spacing: .01rem;
    font-weight: 400;
    font-style: italic;
    border-left: 3px solid rgba(0,0,0,0.8);
    padding-left: 20px;
    margin-left: -0;
    margin-bottom: 30px;
    padding-bottom: 3px;
}
@media print {
    img {
        display: block;
        page-break-inside: avoid;
		-webkit-column-break-inside : avoid;
    }
	pre, code, pre code, pre span, code span, pre code span {
		page-break-inside: avoid;
		-webkit-column-break-inside : avoid;
	}
}
		</style>
	</head>
	<body>
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>Introduction to the template elements</h1>
		<div itemprop="text" class="description"><p>Templates allow teams to divide their work, allowing designers to focus on views written in HTML and CSS, while other engineers focus on logic and back end integration.</p><p>In this article, you'll learn how to use a new HTML element that is already available on Chrome, Opera, Firefox and Safari.</p><p>For those who prefer to watch instead of read, here is a summary of how it works.</p><hr><h2 id="why-templates-for-browsers-">Why Templates for browsers?</h2><p>"Templates" used to be a technology frequently used with server side technologies such as PHP, Django (Python) or Ruby on Rails. But lately it's becoming more common to use templates in the browser.</p><p>This is primarily driven by the changing landscape of web architecture. Servers are becoming more dedicated to processing data, clients are becoming more dedicated to user interactions and views. MVC (Model, View, Controller) is no longer a server side only pattern, it's becoming a client side thing - look at AngularJS, Backbone.js, Ember.js, etc.</p><p>Solutions for browser side templating in the past used JavaScript. For example, <a href="http://mustache.github.io/">Mustache.js</a>, <a href="http://handlebarsjs.com/">Handlebars.js</a>, <a href="https://angularjs.org/">AngularJS</a>, <a href="http://backbonejs.org/">Backbone.js</a>. But techniques used in those libraries have a few pitfalls.</p><h3 id="using-div-tag-">Using div tag:</h3><p>In the following example, the template is actually a <code>div</code> tag which is hidden with a bit of CSS. The downside of this approach is that the browser will fetch resources from inside the template, even if those resources haven't been used yet. In this case, <code>logo.svg</code>.</p><pre class="highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">"display:none;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Web Components<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"http://webcomponents.org/img/logo.svg"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre><h3 id="using-script-tag-">Using script tag:</h3><p>In the following example, the template content is stored inside of a <code>script</code> tag. The down side of this approach is that the templates will be converted into DOM elements using <code>.innerHTML</code>, which could introduce a cross site scripting vulnerability if an adequate sanity check is not performed.</p><pre class="highlight"><code class="hljs gherkin"><span class="hljs-variable">&lt;script type="text/template"&gt;</span>
  <span class="hljs-variable">&lt;div&gt;</span>
    <span class="hljs-variable">&lt;h1&gt;</span>Web Components<span class="hljs-variable">&lt;/h1&gt;</span>
    <span class="hljs-variable">&lt;img src="http://webcomponents.org/img/logo.svg"&gt;</span>
  <span class="hljs-variable">&lt;/div&gt;</span>
<span class="hljs-variable">&lt;/script&gt;</span>
</code></pre><p>And this is where native <code>&lt;template&gt;</code> comes in. <code>&lt;template&gt;</code> addresses these problems by providing an ability to insert "inert HTML tags" into a document.</p><p>By using "inert HTML tags":</p><ul><li>inlined scripts won't be executed without being stamped out</li><li>resources such as <code>img</code> or <code>video</code> won't be fetched without being stamped out</li></ul><h2 id="how-do-i-use-templates-">How do I use templates?</h2><p>To define a template, simply wrap your content with a <code>&lt;template&gt;</code> tag.</p><pre class="highlight"><code class="hljs nimrod">&lt;<span class="hljs-keyword">template</span> id=<span class="hljs-string">"template"</span>&gt;
  &lt;style&gt;
    ...
  &lt;/style&gt;
  &lt;<span class="hljs-keyword">div</span>&gt;
    &lt;h1&gt;<span class="hljs-type">Web</span> <span class="hljs-type">Components</span>&lt;/h1&gt;
    &lt;img src=<span class="hljs-string">"http://webcomponents.org/img/logo.svg"</span>&gt;
  &lt;/<span class="hljs-keyword">div</span>&gt;
&lt;/<span class="hljs-keyword">template</span>&gt;
</code></pre><p>In order to stamp out the template, you'll need to write a bit of JavaScript.</p><pre class="highlight"><code class="hljs nimrod">&lt;script&gt;
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">template</span> = document.querySelector('<span class="hljs-comment">#template');</span>
  <span class="hljs-keyword">var</span> clone = document.importNode(<span class="hljs-keyword">template</span>.content, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">var</span> host = document.querySelector('<span class="hljs-comment">#host');</span>
  host.appendChild(clone);
&lt;/script&gt;
&lt;<span class="hljs-keyword">div</span> id=<span class="hljs-string">"host"</span>&gt;&lt;/<span class="hljs-keyword">div</span>&gt;
</code></pre><p><a href="http://jsbin.com/qaxiw/7/edit">Here's a live example</a>.</p><p>The <code>template</code> node queried on first line will be cloned using <code>document.importNode()</code>. By assigning <code>true</code> to the 2nd argument, we are creating a deep copy. Appending it to another node will bring the contents of the template to life, in other words</p><ul><li>Included <code>script</code> tags will be executed</li><li>Included resources (<code>img</code>, <code>video</code>, etc) will be fetched</li><li>Included <code>style</code> tags will take effect</li></ul><h2 id="the-template-element-doesn-t-provide-data-binding">The template element doesn't provide data binding</h2><p>If you have experience working with other template engines such as AngularJS, Mustache.js, etc, you may expect to be able to use</p><p><strong>placeholders</strong></p><pre class="highlight"><code class="hljs nimrod">&lt;<span class="hljs-keyword">template</span> <span class="hljs-keyword">bind</span>=<span class="hljs-string">"{{items}}"</span>&gt;&lt;/<span class="hljs-keyword">template</span>&gt;
</code></pre><p><strong>repeaters</strong></p><pre class="highlight"><code class="hljs nimrod">&lt;<span class="hljs-keyword">template</span> repeat=<span class="hljs-string">"{{item in items}}"</span>&gt;&lt;/<span class="hljs-keyword">template</span>&gt;
</code></pre><p><strong>conditionals</strong></p><pre class="highlight"><code class="hljs nimrod">&lt;<span class="hljs-keyword">template</span> <span class="hljs-keyword">if</span>=<span class="hljs-string">"{{item.active}}"</span>&gt;&lt;/<span class="hljs-keyword">template</span>&gt;
</code></pre><p>but these are different concepts from vanilla templating. These concepts are actually called "data binding" and are not implemented in the native template element. If you are interested in using these features, I recommend looking into <a href="http://www.polymer-project.org/">Polymer</a> (<a href="https://github.com/Polymer/TemplateBinding">TemplateBinding</a>) or <a href="http://www.x-tags.org/">x-tags</a>.</p><h2 id="supported-browsers">Supported browsers</h2><p>The template element is supported by Chrome, Opera, Safari and Firefox as of October 2014. To check availability, go to <a href="https://www.chromestatus.com/features/5207287069147136">chromestatus.com</a>. For polyfilling Internet Explorer and other legacy browsers, you can use <a href="https://github.com/polymer/platform">platform.js</a>.</p><h2 id="resources">Resources</h2><p>If you are interested in learning more about the template element, head over to:</p><ul><li><a href="http://goo.gl/JEIWir">HTML's New Template Tag - HTML5Rocks</a></li><li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/scripting-1.html#the-template-element">WhatWG HTML Template specification</a></li></ul></div>
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>HTML Imports</h1>
<h2>#include for the web</h2>
<div id="article-content" class="content">

        

        

<h2 id="why">Why imports?</h2>

<p>Think about how you load different types of resources on the web. For JS, we have <code>&lt;script src&gt;</code>. For CSS, your go-to is probably <code>&lt;link rel="stylesheet"&gt;</code>. For images it's <code>&lt;img&gt;</code>. Video has <code>&lt;video&gt;</code>. Audio, <code>&lt;audio&gt;</code>.... Get to the point! The majority of the web's content has a simple and declarative way to load itself. Not so for HTML. Here's your options:</p>
<ol>
<li><strong><code>&lt;iframe&gt;</code></strong> - tried and true but heavy weight. An iframe's content lives entirely in a separate context than your page. While that's mostly a great feature, it creates additional challenges (shrink wrapping the size of the frame to its content is tough, insanely frustrating to script into/out of, nearly impossible to style).</li>
<li><strong>AJAX</strong> - <a href="http://ericbidelman.tumblr.com/post/31140607367/mashups-using-cors-and-responsetype-document">I love <code>xhr.responseType="document"</code></a>, but you're saying I need JS to load HTML? That doesn't seem right.</li>
<li><strong>CrazyHacks&trade;</strong> - embedded in strings, hidden as comments (e.g. <code>&lt;script type="text/html"&gt;</code>). Yuck!</li>
</ol>
<p>See the irony? <strong>The web's most basic content, HTML, requires the greatest amount
of effort to work with</strong>. Fortunately, <a href="http://w3c.github.io/webcomponents/explainer/">Web Components</a> are here to get us back on track.</p>
<h2 id="started">Getting started</h2>

<p><a href="http://w3c.github.io/webcomponents/spec/imports/">HTML Imports</a>, part of the <a href="http://w3c.github.io/webcomponents/explainer/">Web Components</a> cast, is a way to include HTML documents in other HTML documents. You're not limited to markup either. An import can also include CSS, JavaScript, or anything else an <code>.html</code> file can contain. In other words, this makes imports a <strong>fantastic tool for loading related HTML/CSS/JS</strong>.</p>
<h3 id="basics">The basics</h3>

<p>Include an import on your page by declaring a <code>&lt;link rel="import"&gt;</code>:</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/path/to/imports/stuff.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span></code></pre>
<p>The URL of an import is called an <em>import location</em>. To load content from another domain, the import location needs to be CORS-enabled:</p>
<pre class="prettyprint"><code><span class="com">&lt;!-- Resources on other origins must be CORS-enabled. --&gt;</span><span class="pln">
</span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://example.com/elements.html"</span><span class="tag">&gt;</span></code></pre>
<p class="notice fact">The browser's network stack automatically de-dupes all requests from the same URL. This means that imports that reference the same URL are only retrieved once. No matter how many times an import at the same location is loaded, it only executes once.</p>

<h3 id="featuredetect">Feature detection and support</h3>

<p>To detect support, check if <code>.import</code> exists on the <code>&lt;link&gt;</code> element:</p>
<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> supportsImports</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'import'</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'link'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">supportsImports</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Good to go!</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Use other libraries/require systems to load files.</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>Browser support is still in the early days. Chrome 31 was the first browser to see an implementation. Since then, Chrome 36 was update with the latest spec. You can enable the flag by turning on <strong>Enable experimental Web Platform features</strong> in <code>about:flags</code> in Chrome Canary. For other browsers, <a href="http://www.polymer-project.org/platform/html-imports.html">Polymer's polyfill</a> works great until things are widely supported.</p>
<p class="notice tip">Also <b>Enable experimental Web Platform features</b> to get the other bleeding edge web component goodies.</p>

<h3 id="bundling">Bundling resources</h3>

<p>Imports provide convention for bundling HTML/CSS/JS (even other HTML Imports) into a single deliverable. It's an intrinsic feature, but a powerful one. If you're creating a theme, library, or just want to segment your app into logical chunks, giving users a single URL is compelling. Heck, you could even deliver an entire app via an import. Think about that for a second.</p>
<blockquote class="commentary talkinghead">Using only one URL, you can package together a single relocatable bundle of web goodness for others to consume.
</blockquote>

<p>A real-world example is <a href="http://getbootstrap.com/">Bootstrap</a>. Bootstrap is comprised of
individual files (bootstrap.css, bootstrap.js, fonts), requires JQuery for its plugins, and provides markup examples. Developers like Ã  la carte flexibility. It allows them buy in to the parts of the framework <em>they</em> want to use. That said, I'd wager your typical JoeDeveloper&trade; goes the easy route and downloads all of Bootstrap.</p>
<p>Imports make a ton of sense for something like Bootstrap. I present to you, the future of loading Bootstrap:</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"bootstrap.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span></code></pre>
<p>Users simply load an HTML Import link. They don't need to fuss with the scatter-shot
of files. Instead, the entirety of Bootstrap is managed and wrapped up in an import, bootstrap.html:</p>
<pre class="prettyprint"><code><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"bootstrap.css"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"fonts.css"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"jquery.js"</span><span class="tag">&gt;&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"bootstrap.js"</span><span class="tag">&gt;&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"bootstrap-tooltip.js"</span><span class="tag">&gt;&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"bootstrap-dropdown.js"</span><span class="tag">&gt;&lt;/script&gt;</span><span class="pln">
...

</span><span class="com">&lt;!-- scaffolding markup --&gt;</span><span class="pln">
</span><span class="tag">&lt;template&gt;</span><span class="pln">
  ...
</span><span class="tag">&lt;/template&gt;</span></code></pre>
<p>Let this sit. It's exciting stuff.</p>
<h3 id="events">Load/error events</h3>

<p>The <code>&lt;link&gt;</code> element fires a <code>load</code> event when an import is loaded successfully
and <code>onerror</code> when the attempt fails (e.g. if the resource 404s). </p>
<p>Imports try to load immediately. An easy way avoid headaches
is to use the <code>onload</code>/<code>onerror</code> attributes:</p>
<pre class="prettyprint"><code><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">async</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> handleLoad</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Loaded import: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">href</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> handleError</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Error loading import: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">href</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"file.html"</span><span class="pln">
      </span><span class="atn">onload</span><span class="pun">=</span><span class="atv">"</span><span class="pln">handleLoad</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="atv">"</span><span class="pln"> </span><span class="atn">onerror</span><span class="pun">=</span><span class="atv">"</span><span class="pln">handleError</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="atv">"</span><span class="tag">&gt;</span></code></pre>
<p class="notice tip">Notice the event handlers are defined before the import is loaded on the page. The browser tries to load the import as soon as it encounters the tag. If the functions don't exist yet, you'll get console errors for undefined function names.</p>

<p>Or, if you're creating the import dynamically:</p>
<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'link'</span><span class="pun">);</span><span class="pln">
link</span><span class="pun">.</span><span class="pln">rel </span><span class="pun">=</span><span class="pln"> </span><span class="str">'import'</span><span class="pun">;</span><span class="pln">
link</span><span class="pun">.</span><span class="pln">href </span><span class="pun">=</span><span class="pln"> </span><span class="str">'file.html'</span><span class="pln">
link</span><span class="pun">.</span><span class="pln">onload </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{...};</span><span class="pln">
link</span><span class="pun">.</span><span class="pln">onerror </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{...};</span><span class="pln">
document</span><span class="pun">.</span><span class="pln">head</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">link</span><span class="pun">);</span></code></pre>
<h2 id="usingcontent">Using the content</h2>

<p>Including an import on a page doesn't mean "plop the content of that file here". It means "parser, go off an fetch this document so I can use it". To actually use the content, you have to take action and write script.</p>
<p>A critical <code>aha!</code> moment is realizing that an import is just a document. In fact, the content of an import is called an <em>import document</em>. You're able to <strong>manipulate the guts of an import using standard DOM APIs</strong>!</p>
<h3 id="importprop">link.import</h3>

<p>To access the content of an import, use the link element's <code>.import</code> property:</p>
<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> content </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'link[rel="import"]'</span><span class="pun">).</span><span class="kwd">import</span><span class="pun">;</span></code></pre>
<p><code>link.import</code> is <code>null</code> under the following conditions:</p>
<ul>
<li>The browser doesn't support HTML Imports.</li>
<li>The <code>&lt;link&gt;</code> doesn't have <code>rel="import"</code>.</li>
<li>The <code>&lt;link&gt;</code> has not been added to the DOM.</li>
<li>The <code>&lt;link&gt;</code> has been removed from the DOM.</li>
<li>The resource is not CORS-enabled.</li>
</ul>
<p><strong>Full example</strong></p>
<p>Let's say <code>warnings.html</code> contains:</p>
<pre class="prettyprint"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"warning"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;style</span><span class="pln"> </span><span class="atn">scoped</span><span class="tag">&gt;</span><span class="pln">
    h3 </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> red</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="tag">&lt;/style&gt;</span><span class="pln">
  </span><span class="tag">&lt;h3&gt;</span><span class="pln">Warning!</span><span class="tag">&lt;/h3&gt;</span><span class="pln">
  </span><span class="tag">&lt;p&gt;</span><span class="pln">This page is under construction</span><span class="tag">&lt;/p&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">

</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"outdated"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;h3&gt;</span><span class="pln">Heads up!</span><span class="tag">&lt;/h3&gt;</span><span class="pln">
  </span><span class="tag">&lt;p&gt;</span><span class="pln">This content may be out of date</span><span class="tag">&lt;/p&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></code></pre>
<p>Importers can grab a specific portion of this document and clone it into their page:</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"warnings.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">
  ...
  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'link[rel="import"]'</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> content </span><span class="pun">=</span><span class="pln"> link</span><span class="pun">.</span><span class="kwd">import</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// Grab DOM from warning.html's document.</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> el </span><span class="pun">=</span><span class="pln"> content</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'.warning'</span><span class="pun">);</span><span class="pln">

    document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">el</span><span class="pun">.</span><span class="pln">cloneNode</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">));</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<div id="warning-example-area" class="demoarea"></div>

<p><link href="warning.html" id="warning-example-link" rel="import">
<script>
  var link = document.querySelector('#warning-example-link');
  if ('import' in link) {
    var content = link.import;
    var alertDOM = content.querySelector('div.alert');
    document.querySelector('#warning-example-area').appendChild(alertDOM.cloneNode(true));
  }
</script></p>
<h3 id="includejs">Scripting in imports</h3>

<p>Imports are not in the main document. They're satellite to it. However, your import can still act on the main page even though the main document reigns supreme. An import can access its own DOM and/or the DOM of the page that's importing it:</p>
<p><strong>Example</strong> - import.html that adds one of its stylesheets to the main page</p>
<pre class="prettyprint"><code><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://www.example.com/styles.css"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://www.example.com/styles2.css"</span><span class="tag">&gt;</span><span class="pln">

</span><span class="tag">&lt;style&gt;</span><span class="pln">
  </span><span class="com">/* Note: &lt;style&gt; in an import apply to the main
     document by default. That is, style tags don't need to be
     explicitly added to the main document. */</span><span class="pln">
  </span><span class="pun">#</span><span class="pln">somecontainer </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> blue</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span><span class="pln">
...

</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="com">// importDoc references this import's document</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> importDoc </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">currentScript</span><span class="pun">.</span><span class="pln">ownerDocument</span><span class="pun">;</span><span class="pln">

  </span><span class="com">// mainDoc references the main document (the page that's importing us)</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> mainDoc </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">;</span><span class="pln">

  </span><span class="com">// Grab the first stylesheet from this import, clone it,</span><span class="pln">
  </span><span class="com">// and append it to the importing document.</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> styles </span><span class="pun">=</span><span class="pln"> importDoc</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'link[rel="stylesheet"]'</span><span class="pun">);</span><span class="pln">
  mainDoc</span><span class="pun">.</span><span class="pln">head</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">styles</span><span class="pun">.</span><span class="pln">cloneNode</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">));</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<p>Notice what's going on here. The script inside the import references the imported document (<code>document.currentScript.ownerDocument</code>), and appends part of that document to the importing page (<code>mainDoc.head.appendChild(...)</code>). Pretty gnarly if you ask me.</p>
<blockquote class="commentary talkinghead">A script in an import can either execute code directly, or define functions to be used by the importing page. This is similar to the way <a href="http://docs.python.org/2/tutorial/modules.html#more-on-modules">modules</a> are defined in Python.
</blockquote>

<p>Rules of JavaScript in an import:</p>
<ul>
<li>Script in the import is executed in the context of the window that contains the importing <code>document</code>. So <code>window.document</code> refers to the main page document. This has two useful corollaries:<ul>
<li>functions defined in an import end up on <code>window</code>.</li>
<li>you don't have to do anything crazy like append the import's <code>&lt;script&gt;</code> blocks to the main page. Again, script gets executed.</li>
</ul>
</li>
<li>Imports do not block parsing of the main page. However, scripts inside them are processed in order. This means you get defer-like behavior while maintaining proper script order. More on this below.</li>
</ul>
<h2 id="deliver-webcomponents">Delivering Web Components</h2>

<p>The design of HTML Imports lends itself nicely to loading reusable content on the web. In particular, it's an ideal way to distribute Web Components. Everything from basic <a href="/webcomponents/template/">HTML <code>&lt;template&gt;</code></a>s to full blown <a href="/tutorials/webcomponents/customelements/#registering">Custom Elements</a> with Shadow DOM [<a href="/tutorials/webcomponents/shadowdom/">1</a>, <a href="/tutorials/webcomponents/shadowdom-201/">2</a>, <a href="/tutorials/webcomponents/shadowdom-301/">3</a>]. When these technologies are used in tandem, imports become a <a href="http://en.cppreference.com/w/cpp/preprocessor/include"><code>#include</code></a> for Web Components.</p>
<h3 id="include-templates">Including templates</h3>

<p>The <a href="/tutorials/webcomponents/template/">HTML Template</a> element is a natural fit for HTML Imports. <code>&lt;template&gt;</code> is great for scaffolding out sections of markup for the importing app to use as it desires. Wrapping content in a <code>&lt;template&gt;</code> also gives you the added benefit of making the content inert until used. That is, scripts don't run until the template is added to the DOM). Boom!</p>
<p>import.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;template&gt;</span><span class="pln">
  </span><span class="tag">&lt;h1&gt;</span><span class="pln">Hello World!</span><span class="tag">&lt;/h1&gt;</span><span class="pln">
  </span><span class="com">&lt;!-- Img is not requested until the &lt;template&gt; goes live. --&gt;</span><span class="pln">
  </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"world.png"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">alert</span><span class="pun">(</span><span class="str">"Executed when the template is activated."</span><span class="pun">);</span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span></code></pre>
<p>index.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"import.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'link[rel="import"]'</span><span class="pun">);</span><span class="pln">

    </span><span class="com">// Clone the &lt;template&gt; in the import.</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> template </span><span class="pun">=</span><span class="pln"> link</span><span class="pun">.</span><span class="kwd">import</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'template'</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">importNode</span><span class="pun">(</span><span class="pln">template</span><span class="pun">.</span><span class="pln">content</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">

    document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#container'</span><span class="pun">).</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">clone</span><span class="pun">);</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<h3 id="include-elements">Registering custom elements</h3>

<p><a href="tutorials/webcomponents/customelements/">Custom Elements</a> is another Web Component technology that plays absurdly well with HTML Imports. <a href="#includejs">Imports can execute script</a>, so why not define + register your custom elements so users don't have to? Call it..."auto-registration". </p>
<p>elements.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="com">// Define and register &lt;say-hi&gt;.</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> proto </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="typ">HTMLElement</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">);</span><span class="pln">

  proto</span><span class="pun">.</span><span class="pln">createdCallback </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Hello, &lt;b&gt;'</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                     </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'name'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="str">'?'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">'&lt;/b&gt;'</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">

  document</span><span class="pun">.</span><span class="pln">registerElement</span><span class="pun">(</span><span class="str">'say-hi'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">prototype</span><span class="pun">:</span><span class="pln"> proto</span><span class="pun">});</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;template</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"t"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;style&gt;</span><span class="pln">
    </span><span class="pun">::</span><span class="pln">content </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">color</span><span class="pun">:</span><span class="pln"> red</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="tag">&lt;/style&gt;</span><span class="pln">
  </span><span class="tag">&lt;span&gt;</span><span class="pln">I'm a shadow-element using Shadow DOM!</span><span class="tag">&lt;/span&gt;</span><span class="pln">
  </span><span class="tag">&lt;content&gt;&lt;/content&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> importDoc </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">currentScript</span><span class="pun">.</span><span class="pln">ownerDocument</span><span class="pun">;</span><span class="pln"> </span><span class="com">// importee</span><span class="pln">

    </span><span class="com">// Define and register &lt;shadow-element&gt;</span><span class="pln">
    </span><span class="com">// that uses Shadow DOM and a template.</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> proto2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="typ">HTMLElement</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">);</span><span class="pln">

    proto2</span><span class="pun">.</span><span class="pln">createdCallback </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="com">// get template in import</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> template </span><span class="pun">=</span><span class="pln"> importDoc</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#t'</span><span class="pun">);</span><span class="pln">

      </span><span class="com">// import template into</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">importNode</span><span class="pun">(</span><span class="pln">template</span><span class="pun">.</span><span class="pln">content</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">

      </span><span class="kwd">var</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
      root</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">clone</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">

    document</span><span class="pun">.</span><span class="pln">registerElement</span><span class="pun">(</span><span class="str">'shadow-element'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">prototype</span><span class="pun">:</span><span class="pln"> proto2</span><span class="pun">});</span><span class="pln">
  </span><span class="pun">})();</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<p>This import defines (and registers) two elements, <code>&lt;say-hi&gt;</code> and <code>&lt;shadow-element&gt;</code>. The first shows a basic custom element that registers itself inside the import. The second example shows how to implement a custom element that creates Shadow DOM from a <code>&lt;template&gt;</code>, then registers itself. </p>
<p>The best part about registering custom elements inside an HTML import is that the the importer simply declares your element on their page. No wiring needed.</p>
<p>index.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"elements.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">
  </span><span class="tag">&lt;say-hi</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Eric"</span><span class="tag">&gt;&lt;/say-hi&gt;</span><span class="pln">
  </span><span class="tag">&lt;shadow-element&gt;</span><span class="pln">
    </span><span class="tag">&lt;div&gt;</span><span class="pln">( I'm in the light dom )</span><span class="tag">&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;/shadow-element&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<p><link href="elements.html" rel="import"></p>
<div class="demoarea">
  <say-hi name="Eric"></say-hi><br><br>
</div>

<div class="demoarea">
  <shadow-element>
    <div>( I'm in the light dom )</div>
  </shadow-element>
</div>

<p>In my opinion, this workflow alone makes HTML Imports an ideal way to share Web Components.</p>
<h3 id="depssubimports">Managing dependencies and sub-imports</h3>

<blockquote>
  Yo dawg. I hear you like imports, so I included an import <em>in</em> your import.
</blockquote>

<h4 id="sub-imports">Sub-imports</h4>

<p>It can be useful for one import to include another. For example, if you want to reuse or extend another component, use an import to load the other element(s).</p>
<p>Below is a real example from <a href="http://polymer-project.org">Polymer</a>. It's a new tab component (<code>&lt;polymer-ui-tabs&gt;</code>) that reuses a layout and selector component. The dependencies are managed using HTML Imports. </p>
<p>polymer-ui-tabs.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"polymer-selector.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"polymer-flex-layout.html"</span><span class="tag">&gt;</span><span class="pln">

</span><span class="tag">&lt;polymer-element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"polymer-ui-tabs"</span><span class="pln"> </span><span class="atn">extends</span><span class="pun">=</span><span class="atv">"polymer-selector"</span><span class="pln"> ...</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;template&gt;</span><span class="pln">
    </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"stylesheet"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"polymer-ui-tabs.css"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;polymer-flex-layout&gt;&lt;/polymer-flex-layout&gt;</span><span class="pln">
    </span><span class="tag">&lt;shadow&gt;&lt;/shadow&gt;</span><span class="pln">
  </span><span class="tag">&lt;/template&gt;</span><span class="pln">
</span><span class="tag">&lt;/polymer-element&gt;</span></code></pre>
<p><a href="https://github.com/Polymer/polymer-ui-elements/blob/master/polymer-ui-tabs/polymer-ui-tabs.html">full source</a></p>
<p>App developers can import this new element using:</p>
<pre class="prettyprint"><code><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"polymer-ui-tabs.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;polymer-ui-tabs&gt;&lt;/polymer-ui-tabs&gt;</span></code></pre>
<p>When a new, more awesome <code>&lt;polymer-selector2&gt;</code> comes along in the future, you can swap out <code>&lt;polymer-selector&gt;</code> and start using it straight away. You won't break your users thanks to imports and web components.</p>
<h4 id="deps">Dependency management</h4>

<p>We all know that loading JQuery more than once per page causes errors. Isn't this
going to be a <em>huge</em> problem for Web Components when multiple components use the same library? Not if we use HTML Imports! They can be used to manage dependencies.</p>
<p>By wrapping libraries in an HTML Import, you automatically de-dupe resources.
The document is only parsed once. Scripts are only executed once. As an example, say you define an import, jquery.html, that loads a copy of JQuery.</p>
<p>jquery.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"http://cdn.com/jquery.js"</span><span class="tag">&gt;&lt;/script&gt;</span></code></pre>
<p>This import can be reused in subsequent imports like so:</p>
<p>import2.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"jquery.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;div&gt;</span><span class="pln">Hello, I'm import 2</span><span class="tag">&lt;/div&gt;</span></code></pre>
<p>ajax-element.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"jquery.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"import2.html"</span><span class="tag">&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> proto </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="typ">HTMLElement</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">);</span><span class="pln">

  proto</span><span class="pun">.</span><span class="pln">makeRequest </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> done</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> $</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">(</span><span class="pln">url</span><span class="pun">).</span><span class="pln">done</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      done</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">

  document</span><span class="pun">.</span><span class="pln">registerElement</span><span class="pun">(</span><span class="str">'ajax-element'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">prototype</span><span class="pun">:</span><span class="pln"> proto</span><span class="pun">});</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<p>Even the main page itself can include jquery.html if it needs the library:</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"jquery.html"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"ajax-element.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">

...

</span><span class="tag">&lt;script&gt;</span><span class="pln">
  $</span><span class="pun">(</span><span class="pln">document</span><span class="pun">).</span><span class="pln">ready</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> el </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'ajax-element'</span><span class="pun">);</span><span class="pln">
    el</span><span class="pun">.</span><span class="pln">makeRequest</span><span class="pun">(</span><span class="str">'http://example.com'</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<p>Despite jquery.html being included in many different import trees, it's document is only fetched and processed once by the browser. Examining the network panel proves this:</p>
<figure>
  <img src="requests-devtools.png">
  <figcaption>jquery.html is requested once
</figcaption></figure>

<h2 id="performance">Performance considerations</h2>

<p>HTML Imports are totally awesome but as with any new web technology, you should
use them wisely. Web development best practices still hold true. Below are some things to keep in mind.</p>
<h3 id="perf-concat">Concatenate imports</h3>

<p>Reducing network requests is always important. If you have many top-level import
links, consider combining them into a single resource and importing that file!</p>
<p><a href="https://github.com/Polymer/vulcanize">Vulcanize</a> is an npm build tool from the <a href="http://www.polymer-project.org/">Polymer</a> team that recursively flattens a set of HTML Imports into a single file. Think of it as a concatenation build step for Web Components.</p>
<h3 id="perf-caching">Imports leverage browser caching</h3>

<p>Many people forget that the browser's networking stack has been finely tuned over the years. Imports (and sub-imports) take advantage of this logic too. The <code>http://cdn.com/bootstrap.html</code> import might have sub-resources, but they'll be cached.</p>
<h3 id="perf-inert">Content is useful only when you add it</h3>

<p>Think of content as inert until you call upon its services. Take a normal, dynamically created stylesheet:</p>
<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'link'</span><span class="pun">);</span><span class="pln">
link</span><span class="pun">.</span><span class="pln">rel </span><span class="pun">=</span><span class="pln"> </span><span class="str">'stylesheet'</span><span class="pun">;</span><span class="pln">
link</span><span class="pun">.</span><span class="pln">href </span><span class="pun">=</span><span class="pln"> </span><span class="str">'styles.css'</span><span class="pun">;</span></code></pre>
<p>The browser won't request styles.css until <code>link</code> is added to the DOM:</p>
<pre class="prettyprint"><code><span class="pln">document</span><span class="pun">.</span><span class="pln">head</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">link</span><span class="pun">);</span><span class="pln"> </span><span class="com">// browser requests styles.css</span></code></pre>
<p>Another example is dynamically created markup:</p>
<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> h2 </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'h2'</span><span class="pun">);</span><span class="pln">
h2</span><span class="pun">.</span><span class="pln">textContent </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Booyah!'</span><span class="pun">;</span></code></pre>
<p>The <code>h2</code> is relatively meaningless until you add it to the DOM.</p>
<p>The same concept holds true for the import document. Unless you append it's content to the DOM, it's a no-op. In fact, the only thing that "executes" in the import document directly is <code>&lt;script&gt;</code>. See <a href="#includejs">scripting in imports</a>.</p>
<h3 id="perf-parsing">Optimizing for async loading</h3>

<h4 id="perf-rendering">Imports block rendering</h4>

<p><em>Imports block rendering of the main page</em>. This is similar to what <code>&lt;link rel="stylesheet"&gt;</code> do. The reason the browser blocks rendering on stylesheets in the first place is to minimize FOUC. Imports behave similarly because they can contain stylsheets. </p>
<p>To be completely asynchronous and not block the parser or rendering, use the <code>async</code> attribute:</p>
<pre class="prettyprint"><code><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/path/to/import_that_takes_5secs.html"</span><span class="pln"> </span><span class="atn">async</span><span class="tag">&gt;</span></code></pre>
<p>The reason <code>async</code> isn't the default for HTML Imports is because it requires developers
to do more work. Synchronous by default means that HTML Imports that have custom element definitions inside of them are guaranteed to load and upgrade, in order. In a completely async world, developers would have to manage that dance and upgrade timings themselves.</p>
<h4 id="perf-rendering">Imports do not block parsing</h4>

<p><em>Imports don't block parsing of the main page</em>. Scripts inside imports are processed in order but don't block the importing page. This means you get defer-like behavior while maintaining proper script order. One benefit of putting your imports in the <code>&lt;head&gt;</code> is that it lets the parser start working on the content as soon as possible. With that said, it's critical to remember <code>&lt;script&gt;</code> in the main document <em>still</em> continues to block the page. The first <code>&lt;script&gt;</code> after an import will block page rendering. That's because an import can have script inside that needs to be executed before the script in the main page.</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/path/to/import_that_takes_5secs.html"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'I block page rendering'</span><span class="pun">);</span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span></code></pre>
<p>Depending on your app structure and use case, there are several ways to optimize async behavior. The techniques below mitigate blocking the main page rendering.</p>
<p><strong>Scenario #1 (preferred): you don't have script in <code>&lt;head&gt;</code> or inlined in <code>&lt;body&gt;</code></strong></p>
<p>My recommendation for placing <code>&lt;script&gt;</code> is to avoid immediately following your imports. Move scripts as late in the game as possible...but you're already doing that best practice, AREN'T YOU!? ;)</p>
<p>Here's an example:</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/path/to/import.html"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/path/to/import2.html"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="com">&lt;!-- avoid including script --&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">
  </span><span class="com">&lt;!-- avoid including script --&gt;</span><span class="pln">

  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">

  </span><span class="com">&lt;!-- avoid including script --&gt;</span><span class="pln">
  ...

  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="com">// Other scripts n' stuff.</span><span class="pln">

    </span><span class="com">// Bring in the import content.</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'link[rel="import"]'</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> post </span><span class="pun">=</span><span class="pln"> link</span><span class="pun">.</span><span class="kwd">import</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#blog-post'</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#container'</span><span class="pun">);</span><span class="pln">
    container</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">post</span><span class="pun">.</span><span class="pln">cloneNode</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">));</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<p>Everything is at the bottom.</p>
<p><strong>Scenario 1.5: the import adds itself</strong></p>
<p>Another option is to have the import <a href="#includejs">add its own content</a>. If the
import author establishes a contract for the app developer to follow, the import can add itself to an area of the main page:</p>
<p>import.html:</p>
<pre class="prettyprint"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"blog-post"</span><span class="tag">&gt;</span><span class="pln">...</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> me </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">currentScript</span><span class="pun">.</span><span class="pln">ownerDocument</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> post </span><span class="pun">=</span><span class="pln"> me</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#blog-post'</span><span class="pun">);</span><span class="pln">

  </span><span class="kwd">var</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#container'</span><span class="pun">);</span><span class="pln">
  container</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">post</span><span class="pun">.</span><span class="pln">cloneNode</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">));</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<p>index.html</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"import"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/path/to/import.html"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">
  </span><span class="com">&lt;!-- no need for script. the import takes care of things --&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<p><strong>Scenario #2: you <em>have</em> script in <code>&lt;head&gt;</code> or inlined in <code>&lt;body&gt;</code></strong></p>
<p>If you have an import that takes a long time to load, the first <code>&lt;script&gt;</code> that follows it on the page will block the page from rendering. Google Analytics for example, 
recommends putting the tracking code in the <code>&lt;head&gt;</code>, If you can't avoid putting <code>&lt;script&gt;</code> in the <code>&lt;head&gt;</code>, dynamically adding the import will prevent blocking the page:</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="kwd">function</span><span class="pln"> addImportLink</span><span class="pun">(</span><span class="pln">url</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'link'</span><span class="pun">);</span><span class="pln">
      link</span><span class="pun">.</span><span class="pln">rel </span><span class="pun">=</span><span class="pln"> </span><span class="str">'import'</span><span class="pun">;</span><span class="pln">
      link</span><span class="pun">.</span><span class="pln">href </span><span class="pun">=</span><span class="pln"> url</span><span class="pun">;</span><span class="pln">
      link</span><span class="pun">.</span><span class="pln">onload </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> post </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">import</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#blog-post'</span><span class="pun">);</span><span class="pln">

        </span><span class="kwd">var</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#container'</span><span class="pun">);</span><span class="pln">
        container</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">post</span><span class="pun">.</span><span class="pln">cloneNode</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">));</span><span class="pln">
      </span><span class="pun">};</span><span class="pln">
      document</span><span class="pun">.</span><span class="pln">head</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">link</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    addImportLink</span><span class="pun">(</span><span class="str">'/path/to/import.html'</span><span class="pun">);</span><span class="pln"> </span><span class="com">// Import is added early :)</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="com">// other scripts</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">
   </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">
   ...
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<p>Alternatively, add the import near the end of the <code>&lt;body&gt;</code>:</p>
<pre class="prettyprint"><code><span class="tag">&lt;head&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="com">// other scripts</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;body&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">
  ...

  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="kwd">function</span><span class="pln"> addImportLink</span><span class="pun">(</span><span class="pln">url</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    addImportLink</span><span class="pun">(</span><span class="str">'/path/to/import.html'</span><span class="pun">);</span><span class="pln"> </span><span class="com">// Import is added very late :(</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></code></pre>
<p class="notice"><b>Note:</b> This very last approach is least preferable. The parser doesn't start to work on the import content until late in the page.</p>

<h2 id="tips">Things to remember</h2>

<ul>
<li>
<p>An import's mimetype is <code>text/html</code>.</p>
</li>
<li>
<p>Resources from other origins need to be CORS-enabled.</p>
</li>
<li>
<p>Imports from the same URL are retrieved and parsed once. That means script in an import is only executed the first time the import is seen.</p>
</li>
<li>
<p>Scripts in an import are processed in order, but do not block the main document parsing.</p>
</li>
<li>
<p>An import link doesn't mean "#include the content here". It means "parser, go off an fetch this document so I can use it later". While scripts execute at import time, stylesheets, markup, and other resources need to be added to the main page explicitly. Note, <code>&lt;style&gt;</code> don't need to be added explicitly. This is a major difference between HTML Imports and <code>&lt;iframe&gt;</code>, which says "load and render this content here".</p>
</li>
</ul>
<h2 id="conclusion">Conclusion</h2>

<p>HTML Imports allow bundling HTML/CSS/JS as a single resource. While useful by themselves, this idea becomes extremely powerful in the world of Web Components. Developers can create reusable components for others to consume and bring in to their own app, all delivered through <code>&lt;link rel="import"&gt;</code>.</p>
<p>HTML Imports are a simple concept, but enable a number of interesting use cases
for the platform.</p>
<h3 id="usecases">Use cases</h3>

<ul>
<li><strong>Distribute</strong> related <a href="#bundling">HTML/CSS/JS as a single bundle</a>. Theoretically, you could import an entire web app into another.</li>
<li><strong>Code organization</strong> - segment concepts logically into different files, encouraging modularity &amp; reusability**.</li>
<li><strong>Deliver</strong> one or more <a href="/tutorials/webcomponents/customelements/">Custom Element</a> definitions. An import can be used to <a href="/tutorials/webcomponents/customelements/#registering">register</a> and include them in an app. This practices good software patterns, keeping the element's interface/definition separate from how its used.</li>
<li><a href="#depssubimports"><strong>Manage dependencies</strong></a> - resources are automatically de-duped.</li>
<li>
<p><strong>Chunk scripts</strong> - before imports, a large-sized JS library would have its file wholly parsed in order to start running, which was slow. With imports, the library can start working as soon as chunk A is parsed. Less latency!</p>
<p><code>&lt;link rel="import" href="chunks.html"&gt;</code>:</p>
<pre class="prettyprint"><code><span class="tag">&lt;script&gt;</span><span class="com">/* script chunk A goes here */</span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="com">/* script chunk B goes here */</span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="com">/* script chunk C goes here */</span><span class="tag">&lt;/script&gt;</span><span class="pln">
...</span></code></pre>
</li>
<li>
<p><strong>Parallelizes HTML parsing</strong> - first time the browser has been able to run two (or more) HTML parsers in parallel.</p>
</li>
<li>
<p><strong>Enables switching between debug and non-debug modes</strong> in an app, just by changing the import target itself. Your app doesn't need to know if the import target is a bundled/compiled resource or an import tree. </p>
</li>
</ul>

      </div>
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>HTML's New Template Tag
standardizing client-side templating</h1>
<div id="article-content" class="content">

        

        

<h2 id="toc-intro">Introduction</h2>

<p>The concept of templating is not new to web development. In fact, server-side
<a href="http://en.wikipedia.org/wiki/Template_engine_(web)">templating languages/engines</a> like Django (Python), ERB/Haml (Ruby), and Smarty (PHP)
have been around for a long time. In the last couple of years however, we've seen
an explosion of MVC frameworks spring up. All of them are slightly different,
yet most share a common mechanic for rendering their presentational layer (aka da view): templates.</p>
<p>Let's face it. Templates are fantastic. Go ahead, ask around. Even its <a href="http://www.thefreedictionary.com/template">definition</a> makes you feel warm and cozy:</p>
<blockquote>
<p><strong>template</strong> (n) - A document or file having a preset format, used as a starting point for a particular application so that the format does not have to be recreated each time it is used.</p>
</blockquote>
<p>"...does not have to be recreated each time...." Don't know about you, but I love
avoiding extra work. Why then does the web platform lack
native support for something developers clearly care about?</p>
<p>The <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/scripting-1.html#the-template-element">WhatWG HTML Templates specification</a> is the answer. It defines a
new <code>&lt;template&gt;</code> element which describes a standard DOM-based approach
for client-side templating. Templates allow you to declare fragments of markup which are parsed as HTML, go unused at page load, but can be instantiated
later on at runtime. To quote <a href="https://plus.google.com/111386188573471152118/posts">Rafael Weinstein</a>:</p>
<blockquote>
  They're a place to put a big wad of HTML that you don't want the browser to mess with at all...for any reason.
  <cite>Rafael Weinstein (spec author)</cite>
</blockquote>

<h3 id="toc-detect">Feature Detection</h3>

<p>To feature detect <code>&lt;template&gt;</code>, create the DOM element and check that the <code>.content</code> property exists:</p>
<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> supportsTemplate</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'content'</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'template'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">supportsTemplate</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Good to go!</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Use old templating techniques or libraries.</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<h2 id="toc-started">Declaring template content</h2>

<p>The HTML <code>&lt;template&gt;</code> element represents a template in your markup. It contains
"template contents"; essentially <strong>inert chunks of cloneable DOM</strong>.
Think of templates as pieces of scaffolding that you can use (and reuse) throughout
the lifetime of your app.</p>
<p>To create a templated content, declare some markup and wrap it in the <code>&lt;template&gt;</code> element:</p>
<pre class="prettyprint"><code><span class="tag">&lt;template</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"mytemplate"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="atn">alt</span><span class="pun">=</span><span class="atv">"great image"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"comment"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span></code></pre>
<blockquote class="commentary talkinghead">
The observant reader may notice the empty image. That's perfectly fine
and intentional. A broken image won't 404 or produce console errors because it
won't be fetched on page load. We can dynamically generate the source URL later on. See 
<a href="#toc-pillars">the pillars</a>.
</blockquote>

<h2 id="toc-pillars">The pillars</h2>

<p>Wrapping content in a <code>&lt;template&gt;</code> gives us few important properties.</p>
<ol>
<li>
<p>Its <strong>content is effectively inert until activated</strong>. Essentially,
your markup is hidden DOM and does not render.</p>
</li>
<li>
<p>Any content within a template won't have side effects. <strong>Script doesn't run,
images don't load, audio doesn't play</strong>,...until the template is used.</p>
</li>
<li>
<p><strong>Content is considered not to be in the document</strong>. Using
<code>document.getElementById()</code> or <code>querySelector()</code> in the main page won't return
child nodes of a template.</p>
</li>
<li>
<p>Templates <strong>can</strong> be placed anywhere inside of <code>&lt;head&gt;</code>, <code>&lt;body&gt;</code>, or <code>&lt;frameset&gt;</code> and can
contain any type of content which is allowed in those elements. Note that "anywhere" means
that <code>&lt;template&gt;</code> can safely be used in places that the HTML parser disallows...all
but <a href="http://www.w3.org/TR/html5-diff/#content-model">content model</a> children. It can  also be placed as a child of <code>&lt;table&gt;</code> or <code>&lt;select&gt;</code>:</p>
<pre class="prettyprint"><code><span class="tag">&lt;table&gt;</span><span class="pln">
</span><span class="tag">&lt;tr&gt;</span><span class="pln">
  </span><span class="tag">&lt;template</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"cells-to-repeat"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;td&gt;</span><span class="pln">some content</span><span class="tag">&lt;/td&gt;</span><span class="pln">
  </span><span class="tag">&lt;/template&gt;</span><span class="pln">
</span><span class="tag">&lt;/tr&gt;</span><span class="pln">
</span><span class="tag">&lt;/table&gt;</span></code></pre>
</li>
</ol>
<h2 id="toc-using">Activating a template</h2>

<p>To use a template, you need to activate it. Otherwise its content will never render.
The simplest way to do this is by creating a deep copy of its <code>.content</code> using <code>document.importNode()</code>. The <code>.content</code> property is a read-only <code>DocumentFragment</code> containing the guts of the template. </p>
<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#mytemplate'</span><span class="pun">);</span><span class="pln">
</span><span class="com">// Populate the src at runtime.</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">content</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'img'</span><span class="pun">).</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> </span><span class="str">'logo.png'</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">importNode</span><span class="pun">(</span><span class="pln">t</span><span class="pun">.</span><span class="pln">content</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">clone</span><span class="pun">);</span></code></pre>
<p>After stamping out a template, its content "goes live". In this particular example, the content is cloned, the image request is made, and the final markup is rendered.</p>
<h2 id="toc-using">Demos</h2>

<h3 id="toc-demo-insert">Example: Inert script</h3>

<p>This example demonstrates the inertness of template content. The <code>&lt;script&gt;</code> only
runs when the button is pressed, stamping out the template.</p>
<pre class="prettyprint"><code><span class="tag">&lt;button</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">useIt</span><span class="pun">()</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">Use me</span><span class="tag">&lt;/button&gt;</span><span class="pln">
</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> useIt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> content </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'template'</span><span class="pun">).</span><span class="pln">content</span><span class="pun">;</span><span class="pln">
    </span><span class="com">// Update something in the template DOM.</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> span </span><span class="pun">=</span><span class="pln"> content</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'span'</span><span class="pun">);</span><span class="pln">
    span</span><span class="pun">.</span><span class="pln">textContent </span><span class="pun">=</span><span class="pln"> parseInt</span><span class="pun">(</span><span class="pln">span</span><span class="pun">.</span><span class="pln">textContent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#container'</span><span class="pun">).</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">
        document</span><span class="pun">.</span><span class="pln">importNode</span><span class="pun">(</span><span class="pln">content</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">));</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;template&gt;</span><span class="pln">
  </span><span class="tag">&lt;div&gt;</span><span class="pln">Template used: </span><span class="tag">&lt;span&gt;</span><span class="pln">0</span><span class="tag">&lt;/span&gt;&lt;/div&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">alert</span><span class="pun">(</span><span class="str">'Thanks!'</span><span class="pun">)</span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span></code></pre>
<div class="demoarea">
<button onclick="useIt()">Use me</button>
<div id="container"></div>
<template id="inert-demo"></template>
<script>
  function useIt() {
    var content = document.querySelector('#inert-demo').content;
    var span = content.querySelector('span');
    span.textContent = parseInt(span.textContent) + 1;
    document.querySelector('#container').appendChild(document.importNode(content, true));
  }
</script>
</div>

<h3 id="toc-demo-sd">Example: Creating Shadow DOM from a template</h3>

<p>Most people attach <a href="/webcomponents/shadowdom/">Shadow DOM</a> to a host by setting a string of markup to <code>.innerHTML</code>:</p>
<pre class="prettyprint"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"host"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> shadow </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#host'</span><span class="pun">).</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
  shadow</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;span&gt;Host node&lt;/span&gt;'</span><span class="pun">;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<p>The problem with this approach is that the more complex your Shadow DOM gets,
the more string concatenation you're doing. It doesn't scale, things get messy
fast, and babies start to cry. This approach is also how XSS was born in the first
place! <code>&lt;template&gt;</code> to the rescue.</p>
<p>Something more sane would be to work with DOM directly by appending template
content to a shadow root:</p>
<pre class="prettyprint"><code><span class="tag">&lt;template&gt;</span><span class="pln">
</span><span class="tag">&lt;style&gt;</span><span class="pln">
  </span><span class="pun">:</span><span class="pln">host </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">background</span><span class="pun">:</span><span class="pln"> </span><span class="lit">#f8f8f8</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10px</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">transition</span><span class="pun">:</span><span class="pln"> all </span><span class="lit">400ms</span><span class="pln"> ease-in-out</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">box-sizing</span><span class="pun">:</span><span class="pln"> border-box</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">border-radius</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5px</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">450px</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">max-width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100%</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln"> 
  </span><span class="pun">:</span><span class="pln">host</span><span class="pun">(:</span><span class="pln">hover</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">background</span><span class="pun">:</span><span class="pln"> </span><span class="lit">#ccc</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  div </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">position</span><span class="pun">:</span><span class="pln"> relative</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  header </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5px</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">border-bottom</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1px</span><span class="pln"> solid </span><span class="lit">#aaa</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  h3 </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">margin</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="kwd">!important</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  textarea </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">font-family</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">inherit</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100%</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100px</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">box-sizing</span><span class="pun">:</span><span class="pln"> border-box</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">border</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1px</span><span class="pln"> solid </span><span class="lit">#aaa</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  footer </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">position</span><span class="pun">:</span><span class="pln"> absolute</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">bottom</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10px</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">right</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5px</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/style&gt;</span><span class="pln">
</span><span class="tag">&lt;div&gt;</span><span class="pln">
  </span><span class="tag">&lt;header&gt;</span><span class="pln">
    </span><span class="tag">&lt;h3&gt;</span><span class="pln">Add a Comment</span><span class="tag">&lt;/h3&gt;</span><span class="pln">
  </span><span class="tag">&lt;/header&gt;</span><span class="pln">
  </span><span class="tag">&lt;content</span><span class="pln"> </span><span class="atn">select</span><span class="pun">=</span><span class="atv">"p"</span><span class="tag">&gt;&lt;/content&gt;</span><span class="pln">
  </span><span class="tag">&lt;textarea&gt;&lt;/textarea&gt;</span><span class="pln">
  </span><span class="tag">&lt;footer&gt;</span><span class="pln">
    </span><span class="tag">&lt;button&gt;</span><span class="pln">Post</span><span class="tag">&lt;/button&gt;</span><span class="pln">
  </span><span class="tag">&lt;/footer&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span><span class="pln">

</span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"host"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;p&gt;</span><span class="pln">Instructions go here</span><span class="tag">&lt;/p&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span><span class="pln">

</span><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> shadow </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#host'</span><span class="pun">).</span><span class="pln">createShadowRoot</span><span class="pun">();</span><span class="pln">
  shadow</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'template'</span><span class="pun">).</span><span class="pln">content</span><span class="pun">);</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<p><template id="demo-sd-template"></template></p>
<div id="demo-sd-host">
  <p>Instructions go here</p>
</div>

<script>
(function() {
  var host = document.querySelector('#demo-sd-host');
  var compat = HTMLElement.prototype.webkitCreateShadowRoot ||
               HTMLElement.prototype.createShadowRoot ? true : false;
  if (compat &amp;&amp; 'HTMLTemplateElement' in window) {
    var shadow = host.createShadowRoot();
    shadow.applyAuthorStyles = true;
    shadow.appendChild(document.querySelector('#demo-sd-template').content);
  } else {
    document.querySelector('#unsupportedbrowsersneedscoping').style.display = 'none';
    host.style.display = 'none';
  }
})();
</script>

<h2 id="toc-gotcha">Gotchas</h2>

<p>Here are a few gotchas I've come across when using <code>&lt;template&gt;</code> in the wild:</p>
<ul>
<li>If you're using <a href="http://code.google.com/p/modpagespeed/">modpagespeed</a>, be careful
of this <a href="http://code.google.com/p/modpagespeed/issues/detail?id=625">bug</a>. Templates
that define inline <code>&lt;style scoped&gt;</code>, many be moved to the head with PageSpeed's CSS rewriting
rules.</li>
<li>There's no way to "prerender" a template, meaning you cannot preload assets,
process JS, download initial CSS, etc. That goes for both server and client.
The only time a template renders is when it goes live.</li>
<li>
<p>Be careful with nested templates. They don't behave as you might expect. For example:</p>
<pre class="prettyprint"><code><span class="tag">&lt;template&gt;</span><span class="pln">
  </span><span class="tag">&lt;ul&gt;</span><span class="pln">
    </span><span class="tag">&lt;template&gt;</span><span class="pln">
      </span><span class="tag">&lt;li&gt;</span><span class="pln">Stuff</span><span class="tag">&lt;/li&gt;</span><span class="pln">
    </span><span class="tag">&lt;/template&gt;</span><span class="pln">
  </span><span class="tag">&lt;/ul&gt;</span><span class="pln">
</span><span class="tag">&lt;/template&gt;</span></code></pre>
<p>Activating the outer template will not active inner templates. That is to say,
nested templates require that their children also be manually activated.</p>
</li>
</ul>
<h2 id="toc-old">The road to a standard</h2>

<p>Let's not forget where we came from. The road to standards-based HTML templates
has been a long one. Over the years, we've come up with some pretty clever tricks
for creating reusable templates. Below are two common ones that I've come across.
I'm including them in this article for comparison.</p>
<h3 id="toc-offscreen">Method 1: Offscreen DOM</h3>

<p>One approach people have been using for a long time is to create "offscreen"
DOM and hide it from view using the <code>hidden</code> attribute or <code>display:none</code>.</p>
<pre class="prettyprint"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"mytemplate"</span><span class="pln"> </span><span class="atn">hidden</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"logo.png"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"comment"</span><span class="tag">&gt;&lt;/div&gt;</span><span class="pln">
</span><span class="tag">&lt;/div&gt;</span></code></pre>
<p>While this technique works, there are a number of downsides. The rundown of this technique:</p>
<ul>
<li><label class="good"></label> <em>Using DOM</em> - the browser knows DOM. It's good at it. We can easily clone it.</li>
<li><label class="good"></label> <em>Nothing is rendered</em> - adding <code>hidden</code> prevents the block from showing.</li>
<li><label class="bad"></label> <em>Not inert</em> - even though our content is hidden,
a network request is still made for the image.</li>
<li><label class="bad"></label> <em>Painful styling and theming</em> - an embedding page must prefix all of its
CSS rules with <code>#mytemplate</code> in order to scope styles down to the template. This 
is brittle and there are no guarantees we won't encounter future naming collisions.
For example, we're hosed if the embedding page already has an element with that id.</li>
</ul>
<h3 id="toc-overloadingscript">Method 2: Overloading script</h3>

<p>Another technique is overloading <code>&lt;script&gt;</code> and manipulating its content
as a string. John Resig was probably the first to show this back in 2008 with
his <a href="http://ejohn.org/blog/javascript-micro-templating/">Micro Templating utility</a>.
Now there are many others, including some new kids on the block like <a href="http://handlebarsjs.com/">handlebars.js</a>.</p>
<p>For example:</p>
<pre class="prettyprint"><code><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"mytemplate"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/x-handlebars-template"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="pun">&lt;</span><span class="pln">img src</span><span class="pun">=</span><span class="str">"logo.png"</span><span class="pun">&gt;</span><span class="pln">
  </span><span class="pun">&lt;</span><span class="pln">div </span><span class="kwd">class</span><span class="pun">=</span><span class="str">"comment"</span><span class="pun">&gt;&lt;/</span><span class="pln">div</span><span class="pun">&gt;</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span></code></pre>
<p>The rundown of this technique:</p>
<ul>
<li><label class="good"></label> <em>Nothing is rendered</em> - the browser doesn't render this block because
<code>&lt;script&gt;</code> is <code>display:none</code> by default.</li>
<li><label class="good"></label> <em>Inert</em> - the browser doesn't parse the script content
as JS because its type is set to something other than "text/javascript".</li>
<li><label class="bad"></label> <em>Security issues</em> - encourages the use of <code>.innerHTML</code>.
Run-time string parsing of user-supplied data can easily lead to XSS vulnerabilities.</li>
</ul>
<h2 id="toc-conclusion">Conclusion</h2>

<p>Remember when jQuery made working with DOM dead simple? The result was <code>querySelector()</code>/<code>querySelectorAll()</code>
being added to the platform. Obvious win, right? A library popularized fetching DOM
with CSS selectors and standards later adopted it. It doesn't always work that way, but I <em>love</em> when it does.</p>
<p>I think <code>&lt;template&gt;</code> is a similar case. It standardizes the way we do client-side
templating, but more importantly, it removes the need for <a href="#toc-old">our crazy 2008 hacks</a>.
Making the entire web authoring process more sane, more maintainable, and more
full featured is always a good thing in my book.</p>
<h2 id="toc-resources">Additional resources</h2>



      </div>
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1>Data-binding Revolutions with Object.observe()</h1>
		

        

        

<h2 id="toc-intro">Introduction</h2>

<p>A revolution is coming. Thereâs a new addition to JavaScript thatâs going to change <em>everything</em> you think you know about data-binding. Itâs also going to change how many of your MVC libraries approach observing models for edits and updates. Are you ready for some sweet performance boosts to apps that care about property observation?</p>

<p>Okay. Okay. Without further delay, Iâm happy to announce <a href="http://wiki.ecmascript.org/doku.php?id=harmony:observe">Object.observe() </a> has landed in <a href="http://www.chromestatus.com/features/6147094632988672">Chrome 36</a> stable. <em>[WOOOO. THE CROWD GOES WILD]</em>.</p>

<p><code>Object.observe()</code>, part of a future ECMAScript standard, is a method for asynchronously observing changes to JavaScript objects...without the need for a separate library. It allows an observer to receive a time-ordered sequence of change records which describe the set of changes which took place to a set of observed objects.</p>

<pre class="prettyprint"><span class="com">// Let's say we have a model with data</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> model </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">

</span><span class="com">// Which we then observe</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">model</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">changes</span><span class="pun">){</span><span class="pln">

    </span><span class="com">// This asynchronous callback runs</span><span class="pln">
    changes</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">change</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="com">// Letting us know what changed</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">change</span><span class="pun">.</span><span class="pln">type</span><span class="pun">,</span><span class="pln"> change</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> change</span><span class="pun">.</span><span class="pln">oldValue</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">});</span><span class="pln">

</span><span class="pun">});</span></pre>

<p>Anytime a change is made, it gets reported:</p>

<p><img src="image_0.png"></p>

<p>With <code>Object.observe()</code> (I like to call it O.o() or Oooooooo), you can implement two-way data-binding <a href="http://bitworking.org/news/2014/05/zero_framework_manifesto">without the need for a framework</a>.</p>

<p>Thatâs not to say you shouldnât use one. For large projects with complicated business logic, opinionated frameworks are invaluable and you should continue to use them. They simplify the orientation of new developers, require less code maintenance and impose patterns on how to achieve common tasks. When you donât need one, you can use smaller, more focused libraries like <a href="http://polymer-project.org">Polymer</a> (which already take advantage of O.o()).</p>

<p>Even if you find yourself heavily using a framework or MV* library, O.o() has the potential to provide them with some healthy performance improvements, with a faster, simpler implementation whilst keeping the same API. For example, last year Angular <a href="https://mail.mozilla.org/pipermail/es-discuss/2012-September/024978.html">found </a>that in a benchmark where changes were being made to a model, dirty-checking took 40ms per update and O.o() took 1-2ms per update (an improvement of 20-40x faster).</p>

<p>Data-binding without the need for tons of complicated code also means you no longer have to poll for changes, so longer battery life!</p>

<p>If you're already sold on O.o(), skip-ahead to the feature <a href="#toc-intro-oo">introduction</a>, or read ahead for more on the problems it solves.</p>

<h2 id="toc-what-are-we-observing">What do we want to observe?</h2>

<p>When weâre talking about data observation, weâre usually referring to keeping an eye out for some specific types of changes:</p>

<ul>
<li><p>Changes to raw JavaScript objects</p></li>
<li><p>When properties get added, changed, deleted</p></li>
<li><p>When arrays have elements spliced in and out of them</p></li>
<li><p>Changes to the prototype of the object</p></li>
</ul>


<h2 id="toc-importance">The importance of data-binding</h2>

<p>Data-binding starts to become important when you care about model-view control separation. HTML is a great declarative mechanism, but itâs completely static. Ideally, you just want to declare the relationship between your data and the DOM and keep the DOM up to date. This creates leverage and saves you a lot of time writing really repetitive code that just sends data to and from the DOM between your applicationâs internal state or the server.</p>

<p>Data-binding is particularly useful when you have a complex user-interface where you need to wire up relationships between multiple properties in your data models with multiple elements in your views. This is pretty common in the single-page applications weâre building today.</p>

<p>By baking a way to natively observe data in the browser, we give JavaScript frameworks (and small utility libraries you write) a way to observe changes to model data without relying on some of the slow hacks the world uses today.</p>

<h2 id="toc-world-look-like-today">What the world looks like today</h2>

<p><strong>Dirty-checking</strong></p>

<p>Where have you seen data-binding before? Well, if you use a modern MV* library for building your webapps (e.g Angular, Knockout) youâre probably used to binding model data to the DOM. As a refresher, hereâs an example of a Phone list app where weâre binding the value of each phone in a <code>phones</code> array (defined in JavaScript) to a list item so that our data and UI are always in sync:</p>

<pre class="prettyprint"><span class="tag">&lt;html</span><span class="pln"> </span><span class="atn">ng-app</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;head&gt;</span><span class="pln">
    ...
    </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"angular.js"</span><span class="tag">&gt;&lt;/script&gt;</span><span class="pln">
    </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"controller.js"</span><span class="tag">&gt;&lt;/script&gt;</span><span class="pln">
  </span><span class="tag">&lt;/head&gt;</span><span class="pln">
  </span><span class="tag">&lt;body</span><span class="pln"> </span><span class="atn">ng-controller</span><span class="pun">=</span><span class="atv">"PhoneListCtrl"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;ul&gt;</span><span class="pln">
      </span><span class="tag">&lt;li</span><span class="pln"> </span><span class="atn">ng-repeat</span><span class="pun">=</span><span class="atv">"phone in phones"</span><span class="tag">&gt;</span><span class="pln">
        {{phone.name}}
        </span><span class="tag">&lt;p&gt;</span><span class="pln">{{phone.snippet}}</span><span class="tag">&lt;/p&gt;</span><span class="pln">
      </span><span class="tag">&lt;/li&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ul&gt;</span><span class="pln">
  </span><span class="tag">&lt;/body&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></pre>

<p>and the JavaScript for the controller:</p>

<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> phonecatApp </span><span class="pun">=</span><span class="pln"> angular</span><span class="pun">.</span><span class="kwd">module</span><span class="pun">(</span><span class="str">'phonecatApp'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[]);</span><span class="pln">

phonecatApp</span><span class="pun">.</span><span class="pln">controller</span><span class="pun">(</span><span class="str">'PhoneListCtrl'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">$scope</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  $scope</span><span class="pun">.</span><span class="pln">phones </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">{</span><span class="str">'name'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nexus S'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'snippet'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Fast just got faster with Nexus S.'</span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="str">'name'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Motorola XOOM with Wi-Fi'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'snippet'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'The Next, Next Generation tablet.'</span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="str">'name'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'MOTOROLA XOOM'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'snippet'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'The Next, Next Generation tablet.'</span><span class="pun">}</span><span class="pln">
  </span><span class="pun">];</span><span class="pln">
</span><span class="pun">});</span><span class="pln">	</span></pre>

<p><a href="http://angular.github.io/angular-phonecat/step-2/app/">(Demo)</a></p>

<p>Anytime the underlying model data changes, our list in the DOM gets updated. How does Angular achieve this? Well, behind the scenes itâs doing something called dirty-checking.</p>

<img src="image_1.png">

<p>The basic idea with dirty-checking is that anytime data could have changed, the library has to go and check if it did change via a digest or change cycle. In Angularâs case, a digest cycle identifies all expressions registered to be watched to see if thereâs a change. It <a href="http://stackoverflow.com/questions/9682092/databinding-in-angularjs/9693933#9693933">knows</a> about a modelâs previous values and if they have changed, a change event is fired. For a developer, the main benefit here is that you get to use raw JavaScript object data which is pleasant to use and composes fairly well. The downside is that it has bad algorithmic behavior and is potentially very expensive.</p>

<img src="image_2.png">

<p>The expense of this operation is proportional to the total number of observed objects. I may need to do a lot of dirty checking. Also may need a way to trigger dirty-checking when data *might* have changed. There are lots of clever tricks frameworks use for this. It's unclear if this is ever going to be perfect.</p>

<p>The web ecosystem should have more ability to innovate and evolve its own declarative mechanisms, e.g.</p>

<ul>
<li> Constraint-based model systems
</li><li> Auto-persistence systems (e.g persisting changes to IndexedDB or localStorage)</li>
<li>Container objects (Ember, Backbone)</li>	
</ul>

<p><a href="http://www.slideshare.net/mixonic/containers-di">Container</a> objects are where a framework creates objects which on the inside hold the data. They have accessors to the data and they can capture what you set or get and internally broadcast. This works well. It's relatively performant and has good algorithmic behavior. An example of container objects using Ember can be found below:</p>

<pre class="prettyprint"><span class="com">// Container objects</span><span class="pln">
</span><span class="typ">MyApp</span><span class="pun">.</span><span class="pln">president </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Ember</span><span class="pun">.</span><span class="typ">Object</span><span class="pun">.</span><span class="pln">create</span><span class="pun">({</span><span class="pln">
  name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Barack Obama"</span><span class="pln">
</span><span class="pun">});</span><span class="pln">
 
</span><span class="typ">MyApp</span><span class="pun">.</span><span class="pln">country </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Ember</span><span class="pun">.</span><span class="typ">Object</span><span class="pun">.</span><span class="pln">create</span><span class="pun">({</span><span class="pln">
  </span><span class="com">// ending a property with "Binding" tells Ember to</span><span class="pln">
  </span><span class="com">// create a binding to the presidentName property</span><span class="pln">
  presidentNameBinding</span><span class="pun">:</span><span class="pln"> </span><span class="str">"MyApp.president.name"</span><span class="pln">
</span><span class="pun">});</span><span class="pln">
 
</span><span class="com">// Later, after Ember has resolved bindings</span><span class="pln">
</span><span class="typ">MyApp</span><span class="pun">.</span><span class="pln">country</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"presidentName"</span><span class="pun">);</span><span class="pln">
</span><span class="com">// "Barack Obama"</span><span class="pln">
 
</span><span class="com">// Data from the server needs to be converted</span><span class="pln">
</span><span class="com">// Composes poorly with existing code</span></pre>

<p>The expense of discovering what changed here is proportional to the number of things that changed. Another problem is now you're using this different kind of object. Generally speaking you have to convert from data you're getting from the server to these objects so they're observable.</p>

<p>This doesn't compose particularly well with existing JS code because most code assumes it can operate on raw data. Not for these these specialized kinds of objects.</p>

<h2 id="toc-intro-oo">Introducing Object.observe()</h2>

<p>Ideally what we want is the best of both worlds - a way to observe data with support for raw data objects (regular JavaScript objects) if we choose to AND without the need to dirty-check everything all the time. Something with good algorithmic behavior. Something that composes well and is baked into the platform. This is the beauty of what <code>Object.observe()</code> brings to the table.</p>

<p>It allows us to observe an object, mutate properties and see the change report of what has changed. But enough about the theory, letâs look at some code!</p>

<img src="image_3.png">

<h3>Object.observe() and Object.unobserve()</h3>

<p>Letâs imagine that we have a simple vanilla JavaScript object representing a model:</p>

<pre class="prettyprint"><span class="com">// A model can be a simple vanilla object</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> todoModel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  label</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Default'</span><span class="pun">,</span><span class="pln">
  completed</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="pun">};</span></pre>

<p>We can then specify a callback for whenever mutations (changes) are made to the object:</p>

<pre class="prettyprint"><span class="kwd">function</span><span class="pln"> observer</span><span class="pun">(</span><span class="pln">changes</span><span class="pun">){</span><span class="pln">
  changes</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">change</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">){</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'what property changed? '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> change</span><span class="pun">.</span><span class="pln">name</span><span class="pun">);</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'how did it change? '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> change</span><span class="pun">.</span><span class="pln">type</span><span class="pun">);</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'whats the current value? '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> change</span><span class="pun">.</span><span class="kwd">object</span><span class="pun">[</span><span class="pln">change</span><span class="pun">.</span><span class="pln">name</span><span class="pun">]);</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">change</span><span class="pun">);</span><span class="pln"> </span><span class="com">// all changes</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="pun">}</span></pre>

<p>Note: When the observer callback is invoked, the observed objects may have been changed multiple times, so for each change, the new value (the value following each change) and the current value (the final value) aren't necessarily the same thing.</p>

<p>We can then observe these changes using O.o(), passing in the object as our first argument and the callback as our second:</p>

<pre class="prettyprint"><span class="typ">Object</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">todoModel</span><span class="pun">,</span><span class="pln"> observer</span><span class="pun">);</span></pre>

<p>Letâs start making some changes to our Todos model object:</p>

<pre class="prettyprint"><span class="pln">todoModel</span><span class="pun">.</span><span class="pln">label </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Buy some more milk'</span><span class="pun">;</span></pre>

<p>Looking at the console, we get back some useful information! We know what property changed, how it was changed and what the new value is.</p>

<p><img src="image_4.png"></p>

<p>Woo! Goodbye, dirty-checking! Your tombstone should be carved in Comic Sans. Letâs change another property. This time <code>completeBy</code>:</p>

<pre class="prettyprint"><span class="pln">todoModel</span><span class="pun">.</span><span class="pln">completeBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">'01/01/2014'</span><span class="pun">;</span></pre>

<p>As we can see we once again successfully get back a change report:</p>

<p><img src="image_5.png"></p>

<p>Great. What if we now decided to delete the âcompletedâ property from our object:</p>

<pre class="prettyprint"><span class="kwd">delete</span><span class="pln"> todoModel</span><span class="pun">.</span><span class="pln">completed</span><span class="pun">;</span></pre>

<p><img src="image_6.png"></p>

<p>As we can see, the report of changes returned includes information about the deletion. As expected, the new value of the property is now undefined. So, we now know you can find out when properties have been added. When they've been deleted. Basically, the <em>set</em> of properties on an object ("new", "deleted", "reconfigured") and it's prototype changing (_proto_).</p>

<p>As in any observation system, a method also exists to stop listening out for changes. In this case, itâs <code>Object.unobserve()</code>, which has the same signature as O.o() but can be called as follows:</p>

<pre class="prettyprint"><span class="typ">Object</span><span class="pun">.</span><span class="pln">unobserve</span><span class="pun">(</span><span class="pln">todoModel</span><span class="pun">,</span><span class="pln"> observer</span><span class="pun">);</span></pre>

<p>As we can see below, any mutations made to the object after this has been run no longer result in a list of change records being returned.</p>

<p><img src="image_7.png"></p>

<h3>Specifying changes of interest</h3>

<p>So weâve looked at the basics behind how to get back a list of changes to an observed object. What if youâre interested in only a subset of changes that were made to an object rather than all of them?. Everyone needs a spam filter. Well, observers can specify only those types of changes they wish to hear about through an accept list. This can be specified using the third argument to O.o() as follows:</p>

<pre class="prettyprint"><span class="typ">Object</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">obj</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">,</span><span class="pln"> optAcceptList</span><span class="pun">)</span></pre>

<p>Letâs walk through an example of how this can be used:</p>

<pre class="prettyprint"><span class="com">// Like earlier, a model can be a simple vanilla object</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> todoModel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  label</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Default'</span><span class="pun">,</span><span class="pln">
  completed</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">

</span><span class="pun">};</span><span class="pln">


</span><span class="com">// We then specify a callback for whenever mutations </span><span class="pln">
</span><span class="com">// are made to the object</span><span class="pln">
</span><span class="kwd">function</span><span class="pln"> observer</span><span class="pun">(</span><span class="pln">changes</span><span class="pun">){</span><span class="pln">
  changes</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">change</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">){</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">change</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">})</span><span class="pln">

</span><span class="pun">};</span><span class="pln">

</span><span class="com">// Which we then observe, specifying an array of change </span><span class="pln">
</span><span class="com">// types weâre interested in</span><span class="pln">

</span><span class="typ">Object</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">todoModel</span><span class="pun">,</span><span class="pln"> observer</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'delete'</span><span class="pun">]);</span><span class="pln">

</span><span class="com">// without this third option, the change types provided </span><span class="pln">
</span><span class="com">// default to intrinsic types</span><span class="pln">

todoModel</span><span class="pun">.</span><span class="pln">label </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Buy some milk'</span><span class="pun">;</span><span class="pln"> 

</span><span class="com">// note that no changes were reported</span></pre>

<p>If however we now delete the label, notice that this type of change does get reported:</p>

<pre class="prettyprint"><span class="kwd">delete</span><span class="pln"> todoModel</span><span class="pun">.</span><span class="pln">label</span><span class="pun">;</span></pre>

<p>If you donât specify a list of accept types to O.o(), it defaults to the "intrinsic" object change types ("add", "update", "delete", "reconfigure", "preventExtensions" (for when an object becoming non-extensible isnât observable)).</p>

<h2 id="toc-notifications">Notifications</h2>

<p>O.o() also comes with the notion of notifications. Theyâre nothing like those annoying things you get on a phone, but rather useful. Notifications are similar to <a href="https://developer.mozilla.org/en/docs/Web/API/MutationObserver">Mutation Observers</a>. They happen at the end of the micro-task. In the browser context, this is almost always going to be at the end of the current event handler.</p>

<p>The timing is nice because generally one unit of work is finished and now observers get to do their work. Itâs a nice turn-based processing model.</p>

<p>The workflow for using a notifier looks a little like this:</p>

<p><img src="image_8.png"></p>

<p>Letâs look at an example of how notifiers might be used in practice to define custom notifications for when properties on an object are get or set. Keep an eye on the comments here:</p>

<pre class="prettyprint"><span class="com">// Define a simple model</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> model </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="com">// And a separate variable we'll be using for our model's </span><span class="pln">
</span><span class="com">// getter in just a moment</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> _b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">

</span><span class="com">// Define a new property 'b' under 'a' with a custom</span><span class="pln">
</span><span class="com">// getter and setter</span><span class="pln">

</span><span class="typ">Object</span><span class="pun">.</span><span class="pln">defineProperty</span><span class="pun">(</span><span class="pln">model</span><span class="pun">.</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">get</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> _b</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
    </span><span class="kwd">set</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="com">// Whenever 'b' is set on the model</span><span class="pln">
        </span><span class="com">// notify the world about a specific type</span><span class="pln">
        </span><span class="com">// of change being made. This gives you a huge</span><span class="pln">
        </span><span class="com">// amount of control over notifications</span><span class="pln">
        </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">getNotifier</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">).</span><span class="pln">notify</span><span class="pun">({</span><span class="pln">
            type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'update'</span><span class="pun">,</span><span class="pln">
            name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln">
            oldValue</span><span class="pun">:</span><span class="pln"> _b
        </span><span class="pun">});</span><span class="pln">

        </span><span class="com">// Let's also log out the value anytime it gets</span><span class="pln">
        </span><span class="com">// set for kicks</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'set'</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">);</span><span class="pln">

        _b </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span><span class="pln">

</span><span class="com">// Set up our observer</span><span class="pln">
</span><span class="kwd">function</span><span class="pln"> observer</span><span class="pun">(</span><span class="pln">changes</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    changes</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">change</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">change</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">})</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Begin observing model.a for changes</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">model</span><span class="pun">.</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> observer</span><span class="pun">);</span></pre>

<img src="image_9.png">

<p>Here we report when the value of the data properties change ("update"). Anything else the objectâs implementation chooses to report (<code>notifier.notifyChange()</code>).</p>

<p>Years of experience on the web platform have taught us that a synchronous approach is the first thing you try because its the easiest to wrap your head around. The problem is it creates a fundamentally dangerous processing model. If you're writing code and say, update the property of an object, you don't really want a situation having update the property of that object could have invited some arbitrary code to go do whatever it wanted. It's not ideal to have your assumptions invalidated as you're running through the middle of a function.</p>

<p>If you're an observer, you ideally don't want to be called if someone is in the middle of something. You don't want to be asked to go to do work on an inconsistent state of the world. End up doing a lot more error checking. Trying to tolerate a lot more bad situations and generally, its a hard model to work with. Async is harder to deal with but its a better model at the end of the day.</p>

<p>The solution to this problem is synthetic change records.</p>

<h2 id="toc-synth-change-records">Synthetic change records</h2>

<p>Basically, if you want to have accessors or computed properties it is your responsibility to notify when these values change. Itâs a little extra work but it is designed as a sort of first-class feature of this mechanism and these notifications will be delivered with the rest of the notifications from underlying data objects. From data properties.</p>

<img src="image_10.png">

<p>Observing accessors and computed properties can be solved with notifier.notify - another part of O.o(). Most observation systems want some form of observing derived values. There are lots of ways to do this. O.o makes no judgement as to the "right" way. Computed properties should be accessors which *notify* when the internal (private) state changes.</p>

<p>Again, webdevs should expect libraries to help make notifying and various approaches to computed properties easy (and reduce boilerplate).</p> 

<p>Letâs set up the next example, which is a circle class. The idea here is that we have this circle and thereâs a radius property. In this case the radius is an accessor and when its value changes itâs actually going to notify for itself that the value changed. This will be delivered with all other changes to this object or any other object. Essentially, if youâre implementing an object you want to have synthetic or computed properties or you have to pick a strategy for how this is going to work. Once you do, this will fit into your system as a whole.</p>

<p>Skip past the code to see this working in DevTools.

</p><pre class="prettyprint"><span class="kwd">function</span><span class="pln"> </span><span class="typ">Circle</span><span class="pun">(</span><span class="pln">r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> radius </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
 
  </span><span class="kwd">var</span><span class="pln"> notifier </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">getNotifier</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> notifyAreaAndRadius</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    notifier</span><span class="pun">.</span><span class="pln">notify</span><span class="pun">({</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'update'</span><span class="pun">,</span><span class="pln">
      name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'radius'</span><span class="pun">,</span><span class="pln">
      oldValue</span><span class="pun">:</span><span class="pln"> radius
    </span><span class="pun">})</span><span class="pln">
    notifier</span><span class="pun">.</span><span class="pln">notify</span><span class="pun">({</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'update'</span><span class="pun">,</span><span class="pln">
      name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'area'</span><span class="pun">,</span><span class="pln">
      oldValue</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">radius </span><span class="pun">*</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">PI</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 
  </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">defineProperty</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="str">'radius'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">get</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> radius</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
    </span><span class="kwd">set</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">radius </span><span class="pun">===</span><span class="pln"> r</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
      notifyAreaAndRadius</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">);</span><span class="pln">
      radius </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
 
  </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">defineProperty</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="str">'area'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">get</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">PI</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
    </span><span class="kwd">set</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      r </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(</span><span class="pln">a</span><span class="pun">/</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">PI</span><span class="pun">);</span><span class="pln">
      notifyAreaAndRadius</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">);</span><span class="pln">
      radius </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 
</span><span class="kwd">function</span><span class="pln"> observer</span><span class="pun">(</span><span class="pln">changes</span><span class="pun">){</span><span class="pln">
  changes</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">change</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">){</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">change</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">})</span><span class="pln">
</span><span class="pun">}</span></pre>

<img src="image_11.png">

<h2 id="toc-accessor-props">Accessor properties</h2>

<p>A quick note on accessor properties. We mentioned earlier that only the value changes are observable for data properties. Not for computed properties or accessors. The reason is that JavaScript doesn't really have the notion of changes in value to accessors. An accessor is just a collection of functions.</p>

<p>If you assign to an accessor JavaScript just invokes the function there and from its point of view nothing has changed. It just gave some code the opportunity to run.</p>

<p>The problem is semantically we can look at our above assignment to the value - 5 to it. We ought to be able to know what happened here. This is actually an unsolvable problem. The example demonstrates why. There is really no way for any system to know what is meant by this because this can be arbitrary code. It can do whatever it wants in this case. Itâs updating the value every time it is accessed and so asking whether it changed doesnât make much sense.</p>

<h2 id="toc-single-callback-observers">Observing multiple objects with one callback</h2>

<p>Another pattern possible with O.o() is the notion of a single callback observer. This allows a single callback to be used as an "observer" for lots of different objects. The callback will be delivered the full set of changes to all objects it observes at the âend of the microtaskâ (Note the similarity to Mutation Observers).</p>

<img src="image_12.png">

<h2 id="toc-largescale">Large-scale changes</h2>

<p>Maybe youâre working on a reaaaally big app and regularly have to work with large-scale changes. Objects may wish to describe larger semantic changes which will affect lots of properties in a more compact way (instead of broadcasting tons of property changes).</p>

<p>O.o() helps with this in the form of two specific utilities: <code>notifier.performChange()</code> and <code>notifier.notify()</code>, which weâve already introduced.</p>

<img src="image_13.png">

<p>Letâs look at this in an example of how large-scale changes can be described where we define a Thingy object with some math utilities (multiply, increment, incrementAndMultiply). Any time a utility is used, it tells the system that a collection of work comprises a specific type of change.</p>

<p>For example: <code>notifier.performChange(âfooâ, performFooChangeFn);</code></p>

<pre class="prettyprint"><span class="kwd">function</span><span class="pln"> </span><span class="typ">Thingy</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">a </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">b </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">MULTIPLY </span><span class="pun">=</span><span class="pln"> </span><span class="str">'multiply'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT </span><span class="pun">=</span><span class="pln"> </span><span class="str">'increment'</span><span class="pun">;</span><span class="pln">
</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT_AND_MULTIPLY </span><span class="pun">=</span><span class="pln"> </span><span class="str">'incrementAndMultiply'</span><span class="pun">;</span><span class="pln">


</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">prototype </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  increment</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">amount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> notifier </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">getNotifier</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

    </span><span class="com">// Tell the system that a collection of work comprises </span><span class="pln">
    </span><span class="com">// a given changeType. e.g</span><span class="pln">
    </span><span class="com">// notifier.performChange('foo', performFooChangeFn);</span><span class="pln">
    </span><span class="com">// notifier.notify('foo', 'fooChangeRecord');</span><span class="pln">
    notifier</span><span class="pun">.</span><span class="pln">performChange</span><span class="pun">(</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">a </span><span class="pun">+=</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">b </span><span class="pun">+=</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

    notifier</span><span class="pun">.</span><span class="pln">notify</span><span class="pun">({</span><span class="pln">
      </span><span class="kwd">object</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT</span><span class="pun">,</span><span class="pln">
      incremented</span><span class="pun">:</span><span class="pln"> amount
    </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">},</span><span class="pln">

  multiply</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">amount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> notifier </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">getNotifier</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

    notifier</span><span class="pun">.</span><span class="pln">performChange</span><span class="pun">(</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">MULTIPLY</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">a </span><span class="pun">*=</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">b </span><span class="pun">*=</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

    notifier</span><span class="pun">.</span><span class="pln">notify</span><span class="pun">({</span><span class="pln">
      </span><span class="kwd">object</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">MULTIPLY</span><span class="pun">,</span><span class="pln">
      multiplied</span><span class="pun">:</span><span class="pln"> amount
    </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">},</span><span class="pln">

  incrementAndMultiply</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">incAmount</span><span class="pun">,</span><span class="pln"> multAmount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> notifier </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">getNotifier</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

    notifier</span><span class="pun">.</span><span class="pln">performChange</span><span class="pun">(</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT_AND_MULTIPLY</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">increment</span><span class="pun">(</span><span class="pln">incAmount</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">multiply</span><span class="pun">(</span><span class="pln">multAmount</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

    notifier</span><span class="pun">.</span><span class="pln">notify</span><span class="pun">({</span><span class="pln">
      </span><span class="kwd">object</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT_AND_MULTIPLY</span><span class="pun">,</span><span class="pln">
      incremented</span><span class="pun">:</span><span class="pln"> incAmount</span><span class="pun">,</span><span class="pln">
      multiplied</span><span class="pun">:</span><span class="pln"> multAmount
    </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></pre>

<p>
We then define two observers for our object: one which is a catch-all for changes and another which will only report back on specific accept types weâve defined (Thingy.INCREMENT, Thingy.MULTIPLY, Thingy.INCREMENT_AND_MULTIPLY).
</p>

<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> observer</span><span class="pun">,</span><span class="pln"> observer2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    records</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">,</span><span class="pln">
    callbackCount</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
    reset</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">records </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">callbackCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

observer</span><span class="pun">.</span><span class="pln">callback </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">r</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">r</span><span class="pun">);</span><span class="pln">
    observer</span><span class="pun">.</span><span class="pln">records </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">;</span><span class="pln">
    observer</span><span class="pun">.</span><span class="pln">callbackCount</span><span class="pun">++;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

observer2</span><span class="pun">.</span><span class="pln">callback </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">r</span><span class="pun">){</span><span class="pln">
	console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Observer 2'</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">observe </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">thingy</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Object.observe(obj, callback, optAcceptList)</span><span class="pln">
  </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">thingy</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT</span><span class="pun">,</span><span class="pln">
                                    </span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">MULTIPLY</span><span class="pun">,</span><span class="pln">
                                    </span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">INCREMENT_AND_MULTIPLY</span><span class="pun">,</span><span class="pln">
                                    </span><span class="str">'update'</span><span class="pun">]);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">unobserve </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">thingy</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">unobserve</span><span class="pun">(</span><span class="pln">thingy</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span></pre>

<p>We can now start playing with this code. Letâs define a new Thingy:</p>

<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> thingy </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thingy</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">);</span></pre>

<p>Observe it and then make some changes. OMG, so fun. SO many thingies!</p>

<pre class="prettyprint"><span class="com">// Observe thingy</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">thingy</span><span class="pun">,</span><span class="pln"> observer</span><span class="pun">.</span><span class="pln">callback</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Thingy</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">thingy</span><span class="pun">,</span><span class="pln"> observer2</span><span class="pun">.</span><span class="pln">callback</span><span class="pun">);</span><span class="pln">

</span><span class="com">// Play with the methods thingy exposes</span><span class="pln">
thingy</span><span class="pun">.</span><span class="pln">increment</span><span class="pun">(</span><span class="lit">3</span><span class="pun">);</span><span class="pln">               </span><span class="com">// { a: 5, b: 7 }</span><span class="pln">
thingy</span><span class="pun">.</span><span class="pln">b</span><span class="pun">++;</span><span class="pln">                        </span><span class="com">// { a: 5, b: 8 }</span><span class="pln">
thingy</span><span class="pun">.</span><span class="pln">multiply</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln">                </span><span class="com">// { a: 10, b: 16 }</span><span class="pln">
thingy</span><span class="pun">.</span><span class="pln">a</span><span class="pun">++;</span><span class="pln">                        </span><span class="com">// { a: 11, b: 16 }</span><span class="pln">
thingy</span><span class="pun">.</span><span class="pln">incrementAndMultiply</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln"> </span><span class="com">// { a: 26, b: 36 }</span></pre>


<img src="image_14.png">

<p>&nbsp;</p>

<p>Everything inside of the "perform function" is considered to be the work of âbig-changeâ. Observers which accept âbig-changeâ will only receive the âbig-changeâ record. Observers which do not will receive the underlying changes resulting from the work which âperform functionâ did.</p>

<h2 id="toc-observing-arrays">Observing arrays</h2>

<p>Weâve talked for a while about observing changes to objects but what about arrays?! Great question. When someone tells me, "Great question." I never hear their answer because I'm busy congratulating myself for asking such a great question, but I digress. We have new methods for working with arrays too!</p>

<p><code>Array.observe()</code> is a method that treats large-scale changes to itself - for example - splice, unshift or anything which implicitly changes it length - as a "splice" change record. Internally it uses <code>notifier.performChange(âspliceâ,...)</code>.</p> 

<p>Hereâs an example where we observe a model "array" and similarly get back a list of changes when there are any changes to the underlying data:</p>

<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> model </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Buy some milk'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Learn to code'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Wear some plaid'</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">

</span><span class="typ">Array</span><span class="pun">.</span><span class="pln">observe</span><span class="pun">(</span><span class="pln">model</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">changeRecords</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  count</span><span class="pun">++;</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Array observe'</span><span class="pun">,</span><span class="pln"> changeRecords</span><span class="pun">,</span><span class="pln"> count</span><span class="pun">);</span><span class="pln">
</span><span class="pun">});</span><span class="pln">

model</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Teach Paul Lewis to code'</span><span class="pun">;</span><span class="pln">
model</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Channel your inner Paul Irish'</span><span class="pun">;</span></pre>

<img src="image_15.png">

<h2 id="toc-performance">Performance</h2>

<p>The way to think about the computational performance impact of O.o() is to think about it like a read cache. Generally speaking, a cache is a great choice when (in order of importance):</p>

<ol>
	<li>The frequency of reads dominates the frequency of writes.</li>
	<li>You're able to create a cache which trades the constant amount of work involved during writes for algorithmically better performance during reads.</li>
	<li>The constant time slowdown of writes is acceptable.</li>
</ol>

<p>O.o() is designed for use-cases like 1).</p>

<p>Dirty-checking requires keeping a copy of all the data you're observing. This means you incur a structural memory cost to dirty-checking you just don't get with O.o(). Dirty-checking, whilst a decent stop-gap solution, is also a fundamentally leaky abstraction which can create unnecessary complexity for applications. </p>

<p>Why? Well, dirty-checking has to run any time data *may* have changed. There simply isn't a very robust way to do this and any approach to it has significant downsides (e.g checking on a polling interval risks visual artifacts and race conditions between code concerns). Dirty-checking also requires a global registry of observers, creating memory-leak hazards and tear-down costs O.o() avoids.</p>

<p>Letâs take a look at some numbers. </p>

<p>The below benchmark tests (available on <a href="https://github.com/Polymer/observe-js/tree/master/benchmark">GitHub</a>) allow us to compare dirty-checking vs O.o(). They're structured as graphs of Observed-Object-Set-Size vs Number-Of-Mutations.</p>
<p>The general result is that dirty-checking performance is algorithmically proportional to the number of observed objects while O.o() performance is proportional to the number of mutations which were made. </p>

<strong>Dirty-checking</strong>

<img src="image_16.png">

<strong>Chrome with Object.observe() switched on</strong>

<img src="image_17.png">

<h2 id="toc-polyfills">Polyfilling Object.observe()</h2>

<p>Great - so O.o() can be used in Chrome 36, but what about using it in other browsers? Weâve got you covered. Polymerâs <a href="https://github.com/Polymer/observe-js">Observe-JS</a> is a polyfill for O.o() which will use the native implementation if itâs present, but otherwise polyfills it and includes some useful sugaring on top. It offers an aggregate view of the world that sums up changes and delivers a report of what has changed. Two really powerful things it exposes are:</p>

<p>1) You can observe paths. This means you can say, I would like to observe "foo.bar.baz" from a given object and theyâll tell you when the value at that path changed. If the path is unreachable, it considers the value undefined.</p>

<p>Example of observing a value at a path from a given object:</p>

<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> obj </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> foo</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> bar</span><span class="pun">:</span><span class="pln"> </span><span class="str">'baz'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> observer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PathObserver</span><span class="pun">(</span><span class="pln">obj</span><span class="pun">,</span><span class="pln"> </span><span class="str">'foo.bar'</span><span class="pun">);</span><span class="pln">
observer</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">newValue</span><span class="pun">,</span><span class="pln"> oldValue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// respond to obj.foo.bar having changed value.</span><span class="pln">
</span><span class="pun">});</span></pre>

<p>2) It will tell you about array splices. Array splices are basically the minimal set of splice operations you will have to perform on an array in order to transform the old version of the array into the new version of the array. This is a type of transform or different view of the array. Itâs the minimum amount of work you need to do to move from the old state to the new state.</p>

<p>Example of reporting changes to an array as a minimal set of splices:</p>

<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> arr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> observer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayObserver</span><span class="pun">(</span><span class="pln">arr</span><span class="pun">);</span><span class="pln">
observer</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">splices</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// respond to changes to the elements of arr.</span><span class="pln">
  splices</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">splice</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    splice</span><span class="pun">.</span><span class="pln">index</span><span class="pun">;</span><span class="pln"> </span><span class="com">// index position that the change occurred.</span><span class="pln">
    splice</span><span class="pun">.</span><span class="pln">removed</span><span class="pun">;</span><span class="pln"> </span><span class="com">// an array of values representing the sequence of elements which were removed</span><span class="pln">
    splice</span><span class="pun">.</span><span class="pln">addedCount</span><span class="pun">;</span><span class="pln"> </span><span class="com">// the number of elements which were inserted.</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="pun">});</span></pre>

<h2 id="toc-frameworks">Frameworks and Object.observe()</h2>

<p>As mentioned, O.o() will give frameworks and libraries a huge opportunity to improve the performance of their data-binding in browsers that support the feature.</p>

<p>Yehuda Katz and Erik Bryn from Ember confirmed that adding support for O.o() is in Ember's near-term roadmap. Angular's Misko Hervy wrote a <a href="https://docs.google.com/document/d/10W46qDNO8Dl0Uye3QX0oUDPYAwaPl0qNy73TVLjd1WI/edit">design doc</a> on Angular 2.0's improved change detection. Their long term approach will be to take advantage of Object.observe() when it lands in Chrome stable, opting for <a href="https://github.com/angular/watchtower.js/">Watchtower.js</a>, their own change detection approach until then. Suuuuper exciting.</p>

<h2 id="toc-conclusions">Conclusions</h2>

<p>O.o() is a powerful addition to the web platform which you can go out and use today.</p>

<p>Weâre hopeful that in time the feature will land in more browsers, allowing JavaScript frameworks to get performance boosts from access to native object observation capabilities. Those targeting Chrome should be able to use O.o() in Chrome 36 (and above) and the feature should also be available in a future Opera release.</p>

<p>So, go forth and talk to the authors of JavaScript frameworks about <code>Object.observe()</code> and how theyâre planning on using it to improve the performance of data-binding in your apps. There are most definitely exciting times ahead!</p>

<h2 id="toc-resources">Resources</h2>



<p><em>With thanks to Rafael Weinstein, Jake Archibald, Eric Bidelman, Paul Kinlan and Vivian Cromwell for their input and reviews.</em></p>


      
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
		<h1 class="entry-title">Web Components: Why You're Already an Expert</h1>
		<div class="entry-content"><p><a href="http://w3c.github.io/webcomponents/explainer/">Web Components</a> are going to fundamentally change the nature of HTML.</p>

<p>At first glance, they may seem like a complicated set of new technologies, but Web Components are built around a simple premise. Developers should be free to act like browser vendors, extending the vocabulary of HTML itself.</p>

<p>If youâre intimidated by these new technologies or havenât experimented with them yet, this post has a very simple message for you. If youâre already familiar with HTML elements and DOM APIs, you are already an expert at Web Components.</p>

<h2>âComponentsâ today</h2>

<p>To understand why Web Components are so important, we need look no further than how weâve hacked around the <em>lack</em> of Web Components.</p>

<p>As an example, letâs run through the process of consuming a typical third-party widget.</p>

<p>First, we include the widgetâs CSS and JavaScript:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"my-widget.css"</span> <span class="nt">/&gt;</span>
</span><span class="line"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"my-widget.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>Next, we might need to add placeholder elements to the page where our widgets will be inserted.</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">data-my-widget</span><span class="nt">&gt;&lt;/div&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>Finally, when the DOM is ready, we reach back into the document, find the placeholder elements and instantiate our widgets:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="c1">// jQuery used here for brevity...</span>
</span><span class="line">
</span><span class="line"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">$</span><span class="p">(</span><span class="s1">'[data-my-widget]'</span><span class="p">).</span><span class="nx">myWidget</span><span class="p">();</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>This was a bit of work, but weâre <em>still</em> not finished.</p>

<p>Weâve introduced a custom widget to the page, but it is not aware of the browserâs element lifecycle. This becomes clear if we update the DOM:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;div data-my-widget&gt;&lt;/div&gt;'</span><span class="p">;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>Since this isnât a typical element, we now must manually instantiate any new widgets as we update the document:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'[data-my-widget]'</span><span class="p">).</span><span class="nx">myWidget</span><span class="p">();</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>The most common way to avoid this constant two-step process is to completely abstract away DOM interaction. Unfortunately, thatâs a pretty heavy-handed solution that usually results in widgets being tied to particular libraries or frameworks.</p>

<h2>Component soup</h2>

<p>Once our widgets have been instantiated, our placeholder elements have been filled with third-party markup:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">data-my-widget</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"my-widget-foobar"</span><span class="nt">&gt;</span>
</span><span class="line">      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"my-widget-text"</span> <span class="nt">/&gt;</span>
</span><span class="line">      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"my-widget-button"</span><span class="nt">&gt;</span>Go<span class="nt">&lt;/button&gt;</span>
</span><span class="line">  <span class="nt">&lt;/div&gt;</span>
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>This markup is now sitting in the same context as our application markup.</p>

<p>Its internals are visible when we traverse the DOM, and the styles for this widget exist in the same global context as our styles, leading to a high risk of style clashes. All of their classes must be carefully namespaced with <code>my-widget-</code> (or something similar) to avoid naming collissions.</p>

<p>Our code is now all mixed up with the third-party code, with no clean separation between the two. Basically, there is no <a href="http://en.wikipedia.org/wiki/Encapsulation_object-oriented_programming">encapsulation</a>.</p>

<h2>Web Components to the rescue</h2>

<p>With Web Components, it becomes clear what weâve been missing.</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="c">&lt;!-- Import it: --&gt;</span>
</span><span class="line"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"import"</span> <span class="na">href=</span><span class="s">"my-widget.html"</span> <span class="nt">/&gt;</span>
</span><span class="line">
</span><span class="line"><span class="c">&lt;!-- Use it: --&gt;</span>
</span><span class="line"><span class="nt">&lt;my</span><span class="na">-widget</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>In this case, weâve imported a new custom element with a single import and used it immediately.</p>

<p>More importantly, since <code>&lt;my-widget /&gt;</code> is an actual element, it hooks into the browserâs element lifecycle, allowing us to add a new instance to the page like we would with any native widget:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;my-widget /&gt;'</span><span class="p">;</span>
</span><span class="line"><span class="c1">// The widget is now instantiated</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>When we inspect this element, we can see that it is a single element. However, if we <a href="http://chemicaloliver.net/programming/inspecting-the-shadow-dom-in-google-chrome-inspector/">enable Shadow DOM in our developer tools</a>, we see something very interesting.</p>

<p>Hidden inside this element is its private implementation details, in the form of a <a href="https://developer.mozilla.org/en/docs/Web/API/DocumentFragment">document fragment</a>:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line">#document-fragment
</span><span class="line">  <span class="nt">&lt;div&gt;</span>
</span><span class="line">    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
</span><span class="line">    <span class="nt">&lt;button&gt;</span>Go<span class="nt">&lt;/button&gt;</span>
</span><span class="line">  <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>While these elements are visible to the naked eye, they are hidden from us when we traverse the DOM or write CSS selectors. To the outside world, even when instantiated, our custom widget is still just a single element.</p>

<p>We finally have a simple, encapsulated widget that behaves exactly like a standard HTML element.</p>

<h2>In the interest of time</h2>

<p>When we talk about Web Components, weâre not talking about a single technology.</p>

<p>Weâre talking about a suite of new tools that are each useful in their own right: <a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/">Custom Elements</a>, <a href="http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom/">Shadow DOM</a>, <a href="http://www.html5rocks.com/en/tutorials/webcomponents/template/">HTML Templates</a>, <a href="http://www.html5rocks.com/en/tutorials/webcomponents/imports/">HTML Imports</a>, and <a href="http://w3c.github.io/webcomponents/explainer/#decorator-section">Decorators</a>.</p>

<p>The primary goal of Web Components is to give us the encapsulation weâve been missing. Luckily, this goal can be achieved purely with Custom Elements and Shadow DOM. So, in the interest of time, weâll begin by focusing on these two technologies.</p>

<p>Rather than immediately jumping into a list of new browser features, I find it helpful for us to first reacquaint ourselves with what we already know about the native elements weâve been consuming for years. After all, it doesnât hurt for us to understand what weâre trying to build.</p>

<h2>What we already know about elements</h2>

<p>We know that elements can be instantiated through markup or JavaScript:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>




<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'input'</span><span class="p">);</span>
</span><span class="line"><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;input type="text" /&gt;'</span><span class="p">;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>We know that elements are instances:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'input'</span><span class="p">)</span> <span class="k">instanceof</span> <span class="nx">HTMLInputElement</span><span class="p">;</span> <span class="c1">// true</span>
</span><span class="line"><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span> <span class="k">instanceof</span> <span class="nx">HTMLDivElement</span><span class="p">;</span> <span class="c1">// true</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>We know that elements perform their own initialisation:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="c1">// If we create an input with a value attribute defined...</span>
</span><span class="line"><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;input type="text" value="foobar" /&gt;'</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="c1">// ...the value *property* is already in sync</span>
</span><span class="line"><span class="nx">el</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'input'</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>We know that elements can respond to attribute changes:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="c1">// If we change the value *attribute*...</span>
</span><span class="line"><span class="nx">input</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'Foobar'</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// ...the value *property* updates accordingly</span>
</span><span class="line"><span class="nx">input</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">'Foobar'</span><span class="p">;</span> <span class="c1">// true</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>We know that elements can have hidden internal DOM structures:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="c">&lt;!-- A single 'input' provides a complex calendar  --&gt;</span>
</span><span class="line"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"date"</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>




<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="c1">// Despite its complexity, to us it's still just a single element</span>
</span><span class="line"><span class="nx">dateInput</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// true</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>We know that elements have access to child elements:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="c">&lt;!-- We can provide as many 'option' tags as we like --&gt;</span>
</span><span class="line"><span class="nt">&lt;select&gt;</span>
</span><span class="line">  <span class="nt">&lt;option&gt;</span>1<span class="nt">&lt;/option&gt;</span>
</span><span class="line">  <span class="nt">&lt;option&gt;</span>2<span class="nt">&lt;/option&gt;</span>
</span><span class="line">  <span class="nt">&lt;option&gt;</span>3<span class="nt">&lt;/option&gt;</span>
</span><span class="line"><span class="nt">&lt;/select&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>We know that elements can provide style hooks to their internals:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="css"><span class="line"><span class="nt">dialog</span><span class="o">:</span><span class="nd">:backdrop</span> <span class="p">{</span>
</span><span class="line">  <span class="k">background</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">5</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>Finally, we know that elements can have their own private styles. Unlike the custom widgets of today, we never need to manually include CSS for the browserâs native widgets.</p>

<p>By understanding all of this, weâre well on our way to understanding Web Components. With Custom Elements and Shadow DOM, we can now recreate all of this standard behaviour in our widgets.</p>

<h2>Custom elements</h2>

<p>Registering a new element can be as simple as this:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="kd">var</span> <span class="nx">MyElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'my-element'</span><span class="p">);</span>
</span><span class="line"><span class="c1">// 'document.register' returns a constructor</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>You might have noticed that our element name contains a hyphen. This is an important requirement for Custom Elements to ensure our tag names donât clash with current or future elements.</p>

<p>This element now works like any other native element:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;my</span><span class="na">-element</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>Which, of course, means that our element works with all the standard DOM APIs:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nb">document</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'my-element'</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;my-element /&gt;'</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="nb">document</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'my-element'</span><span class="p">)</span> <span class="k">instanceof</span> <span class="nx">MyElement</span><span class="p">;</span> <span class="c1">// true</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<h2>Breathing life into our custom element</h2>

<p>Currently, this is a pretty useless element. Letâs give it some content:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="c1">// We'll now provide the second argument to 'document.register'</span>
</span><span class="line"><span class="nb">document</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'my-element'</span><span class="p">,</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">prototype</span><span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HTMLElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
</span><span class="line">
</span><span class="line">    <span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">      <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;h1&gt;ELEMENT CREATED!&lt;/h1&gt;'</span><span class="p">;</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="p">})</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>In this example, weâve set up the <a href="http://markdalgleish.com/2012/10/a-touch-of-class-inheritance-in-javascript/">prototype</a> for our custom element, using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create</a> to make a new object that inherits from the <a href="https://developer.mozilla.org/en/docs/Web/API/HTMLElement">HTMLElement</a> prototype.</p>

<p>Weâve defined a <code>createdCallback</code> function which will run every time a new instance of the element is created.</p>

<p>We could also optionally define <code>attributeChangedCallback</code>, <code>enteredViewCallback</code> and <code>leftViewCallback</code>.</p>

<p>Inside our callback we can modify our new element however we like. In this case, weâve set its <code>innerHTML</code>.</p>

<p>So far weâre able to dynamically modify the contents of our custom element, but this isnât too different from the custom widgets of today. In order to complete the picture, we need a way to provide encapsulation to our new element by hiding its internals.</p>

<h2>Encapsulation with Shadow DOM</h2>

<p>Weâre going to modify our <code>createdCallback</code> a bit.</p>

<p>This time, instead of setting the <code>innerHTML</code> directly on our custom element, weâre going to do something quite different:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">var</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
</span><span class="line">    <span class="nx">shadow</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;h1&gt;SHADOW DOM!&lt;/h1&gt;'</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>In this example, you would see the words âSHADOW DOM!â when looking at the page, but inspecting the DOM would reveal a single, empty <code>&lt;my-element /&gt;</code> tag. Instead of modifying the containing page, weâve created a new shadow root inside our custom element using <code>this.createShadowRoot()</code>.</p>

<p>Anything inside of this shadow root, while visible to the naked eye, is hidden from DOM APIs and CSS selectors in the containing page, maintaining the illusion that this widget is only a single element.</p>

<p>If we were writing a custom calendar widget, the shadow root is where our complex calendar markup would go, allowing us to expose a single tag as a simple interface to its hidden complexity.</p>

<h2>Accessing the âlight DOMâ</h2>

<p>So far, our custom element is just an empty tag, but what happens if elements were nested inside our new component? We may want a widget with similar flexibility to the <code>&lt;select&gt;</code> tag, which can contain many <code>&lt;option&gt;</code> tags.</p>

<p>As a working example, letâs assume the following markup.</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;my</span><span class="na">-element</span><span class="nt">&gt;</span>
</span><span class="line">  This is the light DOM.
</span><span class="line">  <span class="nt">&lt;i&gt;</span>hello<span class="nt">&lt;/i&gt;</span>
</span><span class="line">  <span class="nt">&lt;i&gt;</span>world<span class="nt">&lt;/i&gt;</span>
</span><span class="line"><span class="err">&lt;</span>/my-element&gt;
</span></code></pre></td></tr></tbody></table></div></figure>


<p>As soon as a new shadow root is created against this custom element, its child nodes are no longer visible. We refer to these hidden child nodes as the âlight DOMâ. If we inspect the page or traverse the DOM we can see these hidden nodes, but the end user would have no clue these elements exist at all.</p>

<p>Without shadow DOM, this example would simply appear as âThis is the light DOM. <em>hello world</em>â.</p>

<p>When we set up the shadow DOM inside the <code>createdCallback</code> function, we can use the new <code>content</code> tag to distribute elements from the light DOM into the shadow DOM:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">var</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
</span><span class="line">    <span class="c1">// The child nodes, including 'i' tags, have now disappeared</span>
</span><span class="line">
</span><span class="line">    <span class="nx">shadow</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
</span><span class="line">      <span class="s1">'The "i" tags from the light DOM are: '</span> <span class="o">+</span>
</span><span class="line">      <span class="s1">'&lt;content select="i" /&gt;'</span><span class="p">;</span>
</span><span class="line">    <span class="c1">// Now, only the 'i' tags are visible inside the shadow DOM</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>With shadow DOM and the <code>&lt;content&gt;</code> tag, this now appears as âThe âiâ tags from the light DOM are: <em>helloworld</em>â. Note that the <code>&lt;i&gt;</code> tags have rendered next to each other with no whitespace.</p>

<h2>Encapsulating styles</h2>

<p>Whatâs important to understand about Shadow DOM is that weâve created a clean separation between our widgetâs markup and the outside world, known as the shadow boundary.</p>

<p>One powerful feature of Shadow DOM is that styles declared inside do not leak outside of the shadow boundary.</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">var</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
</span><span class="line">    <span class="nx">shadow</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
</span><span class="line">      <span class="s2">"&lt;style&gt;span { color: green }&lt;/style&gt;"</span> <span class="o">+</span>
</span><span class="line">      <span class="s2">"&lt;span&gt;I'm green&lt;/span&gt;"</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>Even though a very gereric <code>span</code> style was defined in the shadow DOM, it has no effect on <code>&lt;span&gt;</code> tags in the containing page:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;my</span><span class="na">-element</span> <span class="nt">/&gt;</span>
</span><span class="line"><span class="nt">&lt;span&gt;</span>I'm not green<span class="nt">&lt;/span&gt;</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>If weâre distributing elements from the light DOM into the shadow DOM, like in our <code>&lt;i&gt;</code> example earlier, itâs important to understand that these nodes donât technically belong to our widget.</p>

<p>Distributed nodes still belong to the containing page, meaning that we canât style these elements by simply writing a standard selector.</p>

<p>Instead, we must style these distributed elements with the <code>::content</code> pseudo-element:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="css"><span class="line"><span class="o">:</span><span class="nd">:content</span> <span class="nt">i</span> <span class="p">{</span>
</span><span class="line">  <span class="k">color</span><span class="o">:</span> <span class="nb">blue</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>Which, in the context of a component, looks something like this:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">var</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
</span><span class="line">    <span class="nx">shadow</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
</span><span class="line">      <span class="s1">'&lt;style&gt;::content i { color: blue; }&lt;/style&gt;'</span> <span class="o">+</span>
</span><span class="line">      <span class="s1">'The "i" tags from the light DOM are: '</span> <span class="o">+</span>
</span><span class="line">      <span class="s1">'&lt;content select="i" /&gt;'</span><span class="p">;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<h2>Exposing style hooks</h2>

<p>When we hide the internal markup of our custom element, it is still sometimes desirable to allow certain aspects of our element to be re-styled from outside.</p>

<p>For example, if we were writing a custom calendar widget, we might want to allow end users to style the buttons, without giving them access to the entirety of our widgetâs markup.</p>

<p>This is where the <code>part</code> attribute and pseudo element comes in:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="js"><span class="line"><span class="nx">createdCallback</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">
</span><span class="line">    <span class="kd">var</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createShadowRoot</span><span class="p">();</span>
</span><span class="line">    <span class="nx">shadow</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'Hello &lt;em part="world"&gt;World&lt;/em&gt;'</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>The <code>::part()</code> pseudo element lets us style any element with a <code>part</code> attribute:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="css"><span class="line"><span class="nt">my-element</span><span class="o">:</span><span class="nd">:part</span><span class="o">(</span><span class="nt">world</span><span class="o">)</span> <span class="p">{</span>
</span><span class="line">  <span class="k">color</span><span class="o">:</span> <span class="nb">green</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></tbody></table></div></figure>


<p>This <code>part</code> contract is essential in maintaining encapsulation. In the previous example, we styled the word âWorldâ, but users of our widget would have no idea that itâs actually an <code>em</code> tag under the hood.</p>

<p>One important benefit of this system is that weâre free to dramatically change the markup inside our widget between versions, so long as the âpartâ attributes are still in place.</p>

<h2>Just the beginning</h2>

<p>Web Components finally give us a way to achieve simple, consistent, reusable, encapsulated and composable widgets, but weâre only just getting started. Itâs a great time to start experimenting.</p>

<p>Before you can begin, you need to make sure your browser has the relevant features enabled. If you use Chrome, head to <code>chrome://flags</code> and enable âexperimental Web Platform featuresâ.</p>

<p>To target browsers that donât have these features enabled, you can use Googleâs <a href="http://www.polymer-project.org/">Polymer</a>, or Mozillaâs <a href="http://www.x-tags.org/">X-Tag</a>.</p>

<h2>Time to experiment</h2>

<p>All of the functionality presented in this article is simply an exercise in emulating standard browser behaviour. Weâve been working with the browserâs native widgets for a long time, so taking the step towards writing our own isnât as difficult as it might seem.</p>

<p>If you havenât created a component before, I urge you to open up the console and experiment. Try making a custom element, then try creating a shadow root (against any element, not just Custom Elements).</p>

<p>This experimentation will naturally raise questions about topics not fully discussed in this article. Do we have to use strings to define the markup in our Shadow DOM? No, this is where <a href="http://www.html5rocks.com/en/tutorials/webcomponents/template/">HTML Templates</a> come in. Can we bundle an HTML template with our componentâs JavaScript? Yes, with <a href="http://www.html5rocks.com/en/tutorials/webcomponents/imports/">HTML Imports</a>.</p>

<p>Even if <a href="http://www.polymer-project.org/faq.html#readiness">itâs too early to use this stuff in production</a>, itâs never too early to be prepared for the future of the web.</p>

<p><em>This article is based on a 15 minute presentation from Web Directions South 2013 in Sydney, Australia <a href="http://markdalgleish.github.io/presentation-web-components/">(Slides)</a>.</em></p>

<p><em>Please note: The Web Component APIs have been in constant flux, so if anything in this article is out of date, please let myself and others know in the comments.</em></p>
</div>
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
			</div>
		<!--=========================
			END : POST
		=============================-->
		<!--=========================
			START : POST
		=============================-->
		<div class="post-wrapper">
			</div>
		<!--=========================
			END : POST
		=============================-->
	</body>
</html>